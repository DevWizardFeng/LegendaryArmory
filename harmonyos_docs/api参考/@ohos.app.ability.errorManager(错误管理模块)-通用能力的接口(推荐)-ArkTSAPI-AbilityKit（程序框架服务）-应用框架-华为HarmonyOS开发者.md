<h1 _ngcontent-jag-c119="" class="doc-title ng-star-inserted" title="@ohos.app.ability.errorManager (错误管理模块)"> @ohos.app.ability.errorManager (错误管理模块) </h1>

<div _ngcontent-jag-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ErrorManager模块提供对错误观测器的注册和注销的能力，主要是观测应用发生js crash和appfreeze等错误。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 9开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronerror" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('error')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronerror" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'error', observer: ErrorObserver): number</p>     <p>注册错误观测器。注册后可以捕获到应用产生的js crash，属于应用崩溃的一种。观测器捕获到该异常时应用不退出，建议在回调函数执行完后，增加同步退出操作。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'error'，表示错误观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-errorobserver">ErrorObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">错误观测器。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">number</td>         <td class="cellrowborder" width="50%">观测器的索引值，与观测器一一对应。可用于errorManager.off函数中的observerId参数。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.4.13.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.13.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000003</td>         <td class="cellrowborder" width="50%">The specified ID does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observer</span>: errorManager.<span class="hljs-property">ErrorObserver</span> = {</li><li>  <span class="hljs-title function_">onUnhandledException</span>(<span class="hljs-params">errorMsg</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onUnhandledException, errorMsg: '</span>, errorMsg);</li><li>  },</li><li>  <span class="hljs-title function_">onException</span>(<span class="hljs-params">errorObj</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onException, name: '</span>, errorObj.<span class="hljs-property">name</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onException, message: '</span>, errorObj.<span class="hljs-property">message</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(errorObj.<span class="hljs-property">stack</span>) === <span class="hljs-string">'string'</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onException, stack: '</span>, errorObj.<span class="hljs-property">stack</span>);</li><li>    }</li><li>  }</li><li>};</li><li><span class="hljs-keyword">let</span> observerId = -<span class="hljs-number">1</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  observerId = errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, observer);</li><li>} <span class="hljs-keyword">catch</span> (paramError) {</li><li>  <span class="hljs-keyword">let</span> code = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>  <span class="hljs-keyword">let</span> message = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${code}</span>, <span class="hljs-subst">${message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronglobalerroroccurred18" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('globalErrorOccurred')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronglobalerroroccurred18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'globalErrorOccurred', observer: GlobalObserver): void</p>     <p>在进程中的任意线程中注册 errormanager.on 接口，监听整个进程中任意线程的异常。观测器捕获到该异常时应用不退出，建议在回调函数执行完后，增加同步退出操作。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'globalErrorOccurred'，表示错误观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#globalobserver18">GlobalObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">自定义异常处理回调函数。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">errorFunc</span>(<span class="hljs-params">observer: errorManager.GlobalError</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result name :"</span> + observer.<span class="hljs-property">name</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result message :"</span> + observer.<span class="hljs-property">message</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result stack :"</span> + observer.<span class="hljs-property">stack</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceName :"</span> + observer.<span class="hljs-property">instanceName</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceType :"</span> + observer.<span class="hljs-property">instanceType</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'globalErrorOccurred'</span>, errorFunc);</li><li>} <span class="hljs-keyword">catch</span> (paramError) {</li><li>  <span class="hljs-keyword">let</span> code = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>  <span class="hljs-keyword">let</span> message = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${code}</span>, <span class="hljs-subst">${message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageroffglobalerroroccurred18" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('globalErrorOccurred')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageroffglobalerroroccurred18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'globalErrorOccurred', observer?: GlobalObserver): void</p>     <p>注销错误观测器，注销之前注册在同一线程的callback全局监听。</p>     <p>如果传入的回调不在通过on方法注册的回调队列中，将抛出16300004错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'globalErrorOccurred'，表示错误观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#globalobserver18">GlobalObserver</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">由on方法注册的callback。建议使用该参数，缺省时默认清除所有通过on注册的相同env的callback，否则删除指定callback。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.6.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16300004</td>         <td class="cellrowborder" width="50%">The observer does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">errorFunc</span>(<span class="hljs-params">observer: errorManager.GlobalError</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result name :"</span> + observer.<span class="hljs-property">name</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result message :"</span> + observer.<span class="hljs-property">message</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result stack :"</span> + observer.<span class="hljs-property">stack</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceName :"</span> + observer.<span class="hljs-property">instanceName</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceType :"</span> + observer.<span class="hljs-property">instanceType</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'globalErrorOccurred'</span>, errorFunc)</li><li>} <span class="hljs-keyword">catch</span> (paramError) {</li><li>  <span class="hljs-keyword">let</span> code = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>  <span class="hljs-keyword">let</span> message = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${code}</span>, <span class="hljs-subst">${message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanagerofferror" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('error')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanagerofferror" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'error', observerId: number, callback: AsyncCallback&lt;void&gt;): void</p>     <p>注销错误观测器。使用callback异步返回。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'error'，表示错误观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observerId</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">由on方法返回的观测器的index值。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">AsyncCallback&lt;void&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示指定的回调方法。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000003</td>         <td class="cellrowborder" width="50%">The specified ID does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> observerId = <span class="hljs-number">100</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">unregisterErrorObserverCallback</span>(<span class="hljs-params">err: BusinessError</span>) {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'------------ unregisterErrorObserverCallback ------------'</span>, err);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'error'</span>, observerId, unregisterErrorObserverCallback);</li><li>} <span class="hljs-keyword">catch</span> (paramError) {</li><li>  <span class="hljs-keyword">let</span> code = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>  <span class="hljs-keyword">let</span> message = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${code}</span>, <span class="hljs-subst">${message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanagerofferror-1" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('error')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanagerofferror-1" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'error', observerId: number): Promise&lt;void&gt;</p>     <p>注销错误观测器。使用Promise异步返回。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'error'，表示错误观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observerId</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">由on方法返回的观测器的index值。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象。无返回结果的Promise对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.13.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.13.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000003</td>         <td class="cellrowborder" width="50%">The specified ID does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> observerId = <span class="hljs-number">100</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'error'</span>, observerId)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'----------- unregisterErrorObserver success ----------'</span>, data);</li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'----------- unregisterErrorObserver fail ----------'</span>, err);</li><li>    });</li><li>} <span class="hljs-keyword">catch</span> (paramError) {</li><li>  <span class="hljs-keyword">let</span> code = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>  <span class="hljs-keyword">let</span> message = (paramError <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error: <span class="hljs-subst">${code}</span>, <span class="hljs-subst">${message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronloopobserver12" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('loopObserver')<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronloopobserver12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'loopObserver', timeout: number, observer: LoopObserver): void</p>     <p>注册主线程消息处理耗时监听器。注册后可以捕获到应用主线程处理消息的具体执行时间。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'loopObserver'，表示注册主线程消息处理耗时监听器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">timeout</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示事件执行阈值（单位：毫秒）。 阈值必须大于0。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-loopobserver">LoopObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">注册主线程消息处理耗时监听器。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observer</span>: errorManager.<span class="hljs-property">LoopObserver</span> = {</li><li>  <span class="hljs-title function_">onLoopTimeOut</span>(<span class="hljs-params">timeout: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Duration timeout: '</span> + timeout);</li><li>  }</li><li>};</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"loopObserver"</span>, <span class="hljs-number">1</span>, observer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronglobalunhandledrejectiondetected18" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('globalUnhandledRejectionDetected')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronglobalunhandledrejectiondetected18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'globalUnhandledRejectionDetected', observer: GlobalObserver): void</p>     <p>在进程中任意线程注册被拒绝promise监听器，注册后可以捕获到当前进程中未被捕获到的promise rejection。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'globalUnhandledRejectionDetected'，表示注册被拒绝promise监听器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#globalobserver18">GlobalObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">注册被拒绝promise的callback。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseFunc</span>(<span class="hljs-params">observer: errorManager.GlobalError</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result name :"</span> + observer.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result message :"</span> + observer.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result stack :"</span> + observer.<span class="hljs-property">stack</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceName :"</span> + observer.<span class="hljs-property">instanceName</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceType :"</span> + observer.<span class="hljs-property">instanceType</span>);</li><li>}</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"globalUnhandledRejectionDetected"</span>, promiseFunc);</li><li><span class="hljs-comment">// 建议在抛出promise异常时，使用async抛出异常。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"uncaught error"</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-title function_">throwError</span>();</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronunhandledrejection12" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('unhandledRejection')<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronunhandledrejection12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'unhandledRejection', observer: UnhandledRejectionObserver): void</p>     <p>注册被拒绝promise监听器。注册后可以捕获到当前线程中未被捕获到的promise rejection。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'unhandledRejection'，表示注册被拒绝promise监听器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#unhandledrejectionobserver12">UnhandledRejectionObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">注册被拒绝promise监听器。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observer</span>: errorManager.<span class="hljs-property">UnhandledRejectionObserver</span> = <span class="hljs-function">(<span class="hljs-params">reason: <span class="hljs-built_in">Error</span>, promise: <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (promise === promise1) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"promise1 is rejected"</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.name: "</span>, reason.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.message: "</span>, reason.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-keyword">if</span> (reason.<span class="hljs-property">stack</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.stack: "</span>, reason.<span class="hljs-property">stack</span>);</li><li>  }</li><li>};</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, observer);</li><li>
</li><li><span class="hljs-keyword">let</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"uncaught error"</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageronfreeze18" device-type="phone,2in1,tablet,wearable,tv">errorManager.on('freeze')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageronfreeze18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'freeze', observer: FreezeObserver): void</p>     <p>注册应用主线程freeze监听。多次注册情况下，取最后一次注册的结果。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>如果该回调函数执行时间超过1s，可能导致<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-apprecovery">AppRecovery</a>功能不可用。通过解析hilog日志中的begin与Freeze callback execution completed两者的时间差可以计算回调函数执行时长，如果超过1秒，可以尝试采用异步处理、减少阻塞操作、优化数据结构等方法优化回调逻辑，降低执行时长。</p>      </div></div></div>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'freeze'，表示应用主线程freeze观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#freezeobserver18">FreezeObserver</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">由on接口注册的freeze监听的callback。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">freezeCallback</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"freezecallback"</span>);</li><li>}</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"freeze"</span>, freezeCallback);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageroffloopobserver12" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('loopObserver')<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageroffloopobserver12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'loopObserver', observer?: LoopObserver): void</p>     <p>注销主线程消息处理监听器。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'loopObserver'，表示应用主线程观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-loopobserver">LoopObserver</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">应用主线程观测器标志。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"loopObserver"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageroffglobalunhandledrejectiondetected18" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('globalUnhandledRejectionDetected')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageroffglobalunhandledrejectiondetected18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'globalUnhandledRejectionDetected', observer?: GlobalObserver): void</p>     <p>注销被拒绝promise监听器，注销后无法监听进程中的promise异常。</p>     <p>如果传入的回调不在通过on方法注册的回调队列中，将抛出16300004错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'globalUnhandledRejectionDetected'，表示注册被拒绝promise监听器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#globalobserver18">GlobalObserver</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">由on接口注册的被拒绝promise的callback。建议使用该参数，缺省时默认清除所有通过on注册的相同env的callback，否则删除指定callback。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16300004</td>         <td class="cellrowborder" width="50%">The observer does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">promiseFunc</span>(<span class="hljs-params">observer: errorManager.GlobalError</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result name :"</span> + observer.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result message :"</span> + observer.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result stack :"</span> + observer.<span class="hljs-property">stack</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceName :"</span> + observer.<span class="hljs-property">instanceName</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result instanceType :"</span> + observer.<span class="hljs-property">instanceType</span>);</li><li>}</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"globalUnhandledRejectionDetected"</span>, promiseFunc);</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">throwError</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"uncaught error"</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-title function_">throwError</span>();</li><li>});</li><li>
</li><li>errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"globalUnhandledRejectionDetected"</span>, promiseFunc);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanageroffunhandledrejection12" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('unhandledRejection')<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanageroffunhandledrejection12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'unhandledRejection', observer?: UnhandledRejectionObserver): void</p>     <p>注销被拒绝promise监听器。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'unhandledRejection'，表示注册被拒绝promise监听器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#unhandledrejectionobserver12">UnhandledRejectionObserver</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">注册了被拒绝promise监听器。建议使用该参数，缺省时默认清除所有通过on注册的相同env的observer，否则删除指定observer。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2.Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16300004</td>         <td class="cellrowborder" width="50%">The observer does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observer</span>: errorManager.<span class="hljs-property">UnhandledRejectionObserver</span> = <span class="hljs-function">(<span class="hljs-params">reason: <span class="hljs-built_in">Error</span>, promise: <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (promise === promise1) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"promise1 is rejected"</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.name: "</span>, reason.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.message: "</span>, reason.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-keyword">if</span> (reason.<span class="hljs-property">stack</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.stack: "</span>, reason.<span class="hljs-property">stack</span>);</li><li>  }</li><li>};</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, observer);</li><li>
</li><li><span class="hljs-keyword">let</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"uncaught error"</span>)</li><li>})</li><li>
</li><li>errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"unhandledRejection"</span>);</li></ol></pre></div></div>     <p>或者</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observer</span>: errorManager.<span class="hljs-property">UnhandledRejectionObserver</span> = <span class="hljs-function">(<span class="hljs-params">reason: <span class="hljs-built_in">Error</span>, promise: <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (promise === promise1) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"promise1 is rejected"</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.name: "</span>, reason.<span class="hljs-property">name</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.message: "</span>, reason.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-keyword">if</span> (reason.<span class="hljs-property">stack</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reason.stack: "</span>, reason.<span class="hljs-property">stack</span>);</li><li>  }</li><li>};</li><li>
</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, observer);</li><li>
</li><li><span class="hljs-keyword">let</span> promise1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {}).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"uncaught error"</span>)</li><li>})</li><li>
</li><li>errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"unhandledRejection"</span>, observer);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanagerofffreeze18" device-type="phone,2in1,tablet,wearable,tv">errorManager.off('freeze')<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanagerofffreeze18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'freeze', observer?: FreezeObserver): void</p>     <p>取消之前注册的应用主线程freeze监听。</p>     <p>仅在主线程中使用。使用线程出错时，将抛出错误码，因此建议使用try-catch逻辑进行处理。</p>     <p>如果传入的回调与通过on方法注册回调不一致，将抛出16300004错误码，因此建议使用try-catch逻辑进行处理。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.9.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.9.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.9.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.9.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">填写'freeze'，表示应用主线程freeze观测器。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">observer</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#freezeobserver18">FreezeObserver</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">由on接口注册的freeze监听的callback。建议使用该参数，如果参数不填会直接清空callback，否则删除指定的callback。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.16.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16300004</td>         <td class="cellrowborder" width="50%">The observer does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">freezeCallback</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"freezecallback"</span>);</li><li>}</li><li>errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"freeze"</span>, freezeCallback);</li><li>errorManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">"freeze"</span>, freezeCallback);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errormanagersetdefaulterrorhandler21" device-type="phone,2in1,tablet,wearable,tv">errorManager.setDefaultErrorHandler<sup>21+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errormanagersetdefaulterrorhandler21" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setDefaultErrorHandler(defaultHandler?: ErrorHandler): ErrorHandler</p>     <p>发生JS_CRASH异常时，支持链式回调，返回上一次注册的处理器，仅限主线程调用。</p>     <p>如果传入非法参数或在子线程调用，将抛出错误码并返回undefined，因此建议使用try-catch逻辑进行处理。</p>     <p>若接口参数为空，后续注册的处理器将无法与前序已注册的处理器建立关联，从而中断链式调用。</p>     <p><strong>元服务API</strong>：从API version 21开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">defaultHandler</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#errorhandler21">ErrorHandler</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">新注册的错误处理器，缺省时默认值为空。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.17.11.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.11.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#errorhandler21">ErrorHandler</a></td>         <td class="cellrowborder" width="50%">返回上一次注册的错误处理器。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.17.14.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.14.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">16000205</td>         <td class="cellrowborder" width="50%">The API is not called in the main thread.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例</strong>：</p>     <div _ngcontent-jag-c106="" class="highlight-div"><div _ngcontent-jag-c106="" class="highlight-div-header"><div _ngcontent-jag-c106="" class="highlight-div-header-left"><div _ngcontent-jag-c106="" class="handle-button expand-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jag-c106="" class="highlight-div-header-right"><div _ngcontent-jag-c106="" class="handle-button ai-button"></div><div _ngcontent-jag-c106="" class="handle-button line-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jag-c106="" class="handle-button theme-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jag-c106="" class="handle-button copy-button"><div _ngcontent-jag-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jag-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { errorManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { process } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">oldHandler</span>: errorManager.<span class="hljs-property">ErrorHandler</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">errorHandler</span>: errorManager.<span class="hljs-property">ErrorHandler</span> = <span class="hljs-function">(<span class="hljs-params">reason: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 自定义的errorHandler实现逻辑</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'[Handler]  Uncaught exception handler invoked.'</span>);</li><li>    <span class="hljs-keyword">if</span> (oldHandler) {</li><li>        <span class="hljs-title function_">oldHandler</span>(reason);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 建议增加判空操作，如果为空采用同步退出方式</span></li><li>        <span class="hljs-keyword">const</span> processManager = <span class="hljs-keyword">new</span> process.<span class="hljs-title class_">ProcessManager</span>();</li><li>        processManager.<span class="hljs-title function_">exit</span>(<span class="hljs-number">0</span>);</li><li>    }</li><li>};</li><li>oldHandler = errorManager.<span class="hljs-title function_">setDefaultErrorHandler</span>(errorHandler);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="errorobserver" device-type="phone,2in1,tablet,wearable,tv">ErrorObserver<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errorobserver" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type ErrorObserver = _ErrorObserver.default</p>     <p>ErrorObserver模块。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-errorobserver">_ErrorObserver.default</a></td>         <td class="cellrowborder" width="50%">ErrorObserver模块。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="loopobserver12" device-type="phone,2in1,tablet,wearable,tv">LoopObserver<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="loopobserver12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type LoopObserver = _LoopObserver</p>     <p>LoopObserver模块。定义异常监听，可作为 errormanager.on 函数的参数，监听并处理当前应用主线程超时的事件。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.19.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-loopobserver">_LoopObserver</a></td>         <td class="cellrowborder" width="50%">LoopObserver模块。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="unhandledrejectionobserver12" device-type="phone,2in1,tablet,wearable,tv">UnhandledRejectionObserver<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="unhandledrejectionobserver12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type UnhandledRejectionObserver = (reason: Error | any, promise: Promise&lt;any&gt;) =&gt; void</p>     <p>定义异常监听，用于捕获Promise异步操作失败的原因。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">reason</td>         <td class="cellrowborder" width="25%">Error | any</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">通常是Error类型，表示被拒绝的理由。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">promise</td>         <td class="cellrowborder" width="25%">Promise&lt;any&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">被拒绝的promise。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="freezeobserver18" device-type="phone,2in1,tablet,wearable,tv">FreezeObserver<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="freezeobserver18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type FreezeObserver = () =&gt; void</p>     <p>定义应用主线程freeze回调，用于应用自定义添加freeze信息。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>    </div>    <div class="tiledSection">     <h2 id="globalobserver18" device-type="phone,2in1,tablet,wearable,tv">GlobalObserver<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="globalobserver18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type GlobalObserver = (reason: GlobalError) =&gt; void</p>     <p>定义异常监听，可以作为<a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#errormanageronglobalerroroccurred18">errorManager.on('globalErrorOccurred')</a>和<a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#errormanageronglobalunhandledrejectiondetected18">errorManager.on('globalUnhandledRejectionDetected')</a>的入参监听当前应用主线程事件处理事件。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">reason</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#globalerror18">GlobalError</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">有关异常事件名字、消息、错误堆栈信息、异常线程名称和类型的对象。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="globalerror18" device-type="phone,2in1,tablet,wearable,tv">GlobalError<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="globalerror18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>有关异常事件名字、消息、错误堆栈信息、异常线程名称和类型的对象。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.23.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">instanceName</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>表示虚拟机实例名称。</p>          <p><strong>说明</strong>：</p>          <p>TaskPool线程中异常的instanceName标识规则：</p>          <p>- globalErrorOccurred：标识为“TaskPool Thread + 方法名”；</p>          <p>- globalUnhandledRejectionDetected：标识为“TaskPool Thread + 任务名”；</p>          <p>- 若仅标识为“TaskPool Thread”，则表明异常源于异步回调内部。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">instanceType</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#instancetype18">InstanceType</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">表示虚拟机的实例类型。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="instancetype18" device-type="phone,2in1,tablet,wearable,tv">InstanceType<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="instancetype18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>虚拟机的实例类型。</p>     <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.AbilityCore</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.4.1.1" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.4.1.2" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.4.1.3" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="33.33333333333333%">MAIN</td>         <td class="cellrowborder" width="33.33333333333333%">0</td>         <td class="cellrowborder" width="33.33333333333333%">表示主虚拟机实例。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">WORKER</td>         <td class="cellrowborder" width="33.33333333333333%">1</td>         <td class="cellrowborder" width="33.33333333333333%">表示工作虚拟机实例。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">TASKPOOL</td>         <td class="cellrowborder" width="33.33333333333333%">2</td>         <td class="cellrowborder" width="33.33333333333333%">表示任务池虚拟机实例。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">CUSTOM</td>         <td class="cellrowborder" width="33.33333333333333%">3</td>         <td class="cellrowborder" width="33.33333333333333%">表示用户通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/napi#napi_create_ark_runtime">napi_create_ark_runtime</a>从本机代码创建的虚拟机实例。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="errorhandler21" device-type="phone,2in1,tablet,wearable,tv">ErrorHandler<sup>21+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errorhandler21" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type ErrorHandler = (errObject: Error) =&gt; void</p>     <p><strong>元服务API</strong>：从API version 21开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>参数</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.25.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">errObject</td>         <td class="cellrowborder" width="25%">Error</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">有关异常事件名字、消息、错误堆栈信息的对象。</td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>