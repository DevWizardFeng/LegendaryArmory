<h1 _ngcontent-pig-c119="" class="doc-title ng-star-inserted" title="@ohos.bluetooth.socket (蓝牙socket模块)"> @ohos.bluetooth.socket (蓝牙socket模块) </h1>

<div _ngcontent-pig-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供一种蓝牙套接字功能，可实现设备间连接和数据传输。当两个设备间进行蓝牙套接字通信交互时，依据设备功能的不同，可区分客户端与服务端。</p>    <p>支持的套接字链路类型包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#rfcomm" target="_blank">RFCOMM</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#l2cap" target="_blank">L2CAP</a>。</p>    <ul>     <li>RFCOMM链路类型也称为串口通信协议（Serial Port Profile, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#spp" target="_blank">SPP</a>），适用于传统蓝牙（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#br" target="_blank">BR</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#edr" target="_blank">EDR</a>）。</li>     <li>L2CAP链路类型适用于传统蓝牙（BR/EDR）和低功耗蓝牙（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#ble" target="_blank">BLE</a>）。</li>    </ul>    <p>通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>创建客户端套接字并向服务端发起连接。</p>    <p>通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>创建服务端套接字并监听客户端的连接。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 10开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { socket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ConnectivityKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketspplisten" device-type="phone,2in1,tablet,wearable,tv">socket.sppListen<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketspplisten" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppListen(name: string, options: SppOptions, callback: AsyncCallback&lt;number&gt;): void</p>     <p>服务端使用，创建一个服务端监听套接字。使用Callback异步回调。</p>     <ul>      <li>通过入参<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#sppoptions">socket.SppOptions</a>的type参数，可以创建不同链路类型的服务端套接字，适用于不同的场景。该操作会在蓝牙子系统中注册对应的服务，表示服务端支持的能力。</li>      <li>客户端可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>向该服务端发起连接请求。</li>      <li>当应用不再需要该服务端套接字时，需通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppcloseserversocket">socket.sppCloseServerSocket</a>主动关闭创建时获取到的套接字，蓝牙子系统会删除此前注册的服务。如果此时客户端发起连接，就会连接失败。</li>     </ul>     <p><strong>需要权限</strong>：ohos.permission.ACCESS_BLUETOOTH</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">name</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">服务的名称，该字符串的字符个数范围为[0, 256]。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#sppoptions">SppOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">用于监听的套接字配置参数。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">AsyncCallback&lt;number&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调函数。当创建服务端套接字成功，err为undefined，data为获取到的服务端套接字的ID，有效值为非负值；否则为错误对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码说明文档</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">201</td>         <td class="cellrowborder" width="50%">Permission denied.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900001</td>         <td class="cellrowborder" width="50%">Service stopped.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900003</td>         <td class="cellrowborder" width="50%">Bluetooth disabled.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900004</td>         <td class="cellrowborder" width="50%">Profile not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> serverNumber = -<span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">serverSocket</span> = (<span class="hljs-params">code: BusinessError, number: number</span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (code) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'sppListen error, code is '</span> + code);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    serverNumber = number;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'sppListen success, serverNumber = '</span> + serverNumber);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 以RFCOMM链路类型套接字为例</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sppOption</span>:socket.<span class="hljs-property">SppOptions</span> = {<span class="hljs-attr">uuid</span>: <span class="hljs-string">'00001810-0000-1000-8000-00805F9B34FB'</span>, <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">type</span>: socket.<span class="hljs-property">SppType</span>.<span class="hljs-property">SPP_RFCOMM</span>};</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppListen</span>(<span class="hljs-string">'server1'</span>, sppOption, serverSocket);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketgetl2cappsm20" device-type="phone,2in1,tablet,wearable,tv">socket.getL2capPsm<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketgetl2cappsm20" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getL2capPsm(serverSocket: number): number</p>     <p>获取服务端L2CAP链路类型套接字的协议/服务多路复用器值（Protocol/Service Multiplexer, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/terminology#psm" target="_blank">PSM</a>），该值用于标识特定的服务数据传输通道。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>需要在服务端调用完<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>后调用该接口，且传入的链路类型<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SppType</a>需是SPP_L2CAP或SPP_L2CAP_BLE。</p>      </div></div></div>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">serverSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>服务端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>接口后，通过其异步callback获取到的。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">number</td>         <td class="cellrowborder" width="50%">          <p>返回L2CAP链路类型套接字的psm值。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SppType</a>设置为SPP_L2CAP_BLE时，返回值的有效值范围为[0x01, 0xFF]。</p>          <p>- <a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SppType</a>设置为SPP_L2CAP时，返回值的有效值范围为[0x0000, 0xFFFF]。</p>          <p>- 服务端通道建立异常或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SppType</a>非L2CAP链路类型时，返回-1。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 服务端获取客户端设备地址。</span></li><li><span class="hljs-keyword">let</span> serverNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 此处serverNumber需赋值为调用sppListen接口后，回调中得到的serverNumber。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">l2capPsm</span>: number = socket.<span class="hljs-title function_">getL2capPsm</span>(serverNumber);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppaccept" device-type="phone,2in1,tablet,wearable,tv">socket.sppAccept<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppaccept" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppAccept(serverSocket: number, callback: AsyncCallback&lt;number&gt;): void</p>     <p>服务端使用，接受客户端的套接字连接请求。使用Callback异步回调。</p>     <ul>      <li>须在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>创建服务端套接字成功后，才能调用该接口监听客户端的连接请求。</li>      <li>客户端可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>向该服务端发起连接请求。</li>      <li>连接建立成功后，即可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppwrite">socket.sppWrite</a>、<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppwriteasync18">socket.sppWriteAsync</a>、<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppreadasync18">socket.sppReadAsync</a>等接口，同客户端进行数据传输。</li>      <li>当服务端不再需要已建立的连接时，可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppcloseclientsocket">socket.sppCloseClientSocket</a>主动断开指定的客户端套接字连接。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">serverSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>服务端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>接口后，通过其异步callback获取到的。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">AsyncCallback&lt;number&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调函数。当收到客户端的连接请求且连接建立成功时，err为undefined，data是用于标识发起此次连接请求的客户端套接字ID，有效值为非负值；否则err为错误对象。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%"><strong>错误码</strong>：</td>         <td class="cellrowborder" width="25%"></td>         <td class="cellrowborder" width="25%"></td>         <td class="cellrowborder" width="25%"></td>        </tr>             </tbody></table></div>     </div>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900001</td>         <td class="cellrowborder" width="50%">Service stopped.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900003</td>         <td class="cellrowborder" width="50%">Bluetooth disabled.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900004</td>         <td class="cellrowborder" width="50%">Profile not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = -<span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> serverNumber = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">acceptClientSocket</span> = (<span class="hljs-params">code: BusinessError, number: number</span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (code) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'sppListen error, code is '</span> + code);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    clientNumber = number; <span class="hljs-comment">// 获取的clientNumber用作客户端后续读/写操作socket的id。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'sppListen success, clientNumber = '</span> + clientNumber);</li><li>  }</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppAccept</span>(serverNumber, acceptClientSocket); <span class="hljs-comment">// serverNumber是sppListen回调中得到的serverNumber。</span></li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppconnect" device-type="phone,2in1,tablet,wearable,tv">socket.sppConnect<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppconnect" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppConnect(deviceId: string, options: SppOptions, callback: AsyncCallback&lt;number&gt;): void</p>     <p>客户端使用，创建一个客户端套接字，并向服务端的特定服务发起连接请求。</p>     <ul>      <li>通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#sppoptions">SppOptions</a>参数的type表示需要连接的服务类型。</li>      <li>需确保服务端设备已具备需要连接的服务。服务端可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>注册并监听连接请求。</li>      <li>连接建立成功后，即可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppwrite">socket.sppWrite</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppwriteasync18">socket.sppWriteAsync</a>接口，同服务端进行数据传输。</li>      <li>当客户端不再需要已建立的连接时，可通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppcloseclientsocket">socket.sppCloseclientSocket</a>主动断开连接。</li>     </ul>     <p><strong>需要权限</strong>：ohos.permission.ACCESS_BLUETOOTH</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">deviceId</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">对端设备地址，例如："XX:XX:XX:XX:XX:XX"。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#sppoptions">SppOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">客户端套接字连接配置参数。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">AsyncCallback&lt;number&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调函数。当客户端发起连接成功，err为undefined，data为当前客户端套接字的ID，有效值为非负值；否则为错误对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">201</td>         <td class="cellrowborder" width="50%">Permission denied.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900001</td>         <td class="cellrowborder" width="50%">Service stopped.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900003</td>         <td class="cellrowborder" width="50%">Bluetooth disabled.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900004</td>         <td class="cellrowborder" width="50%">Profile not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">clientSocket</span> = (<span class="hljs-params">code: BusinessError, number: number</span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (code) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'sppConnect error, code is '</span> + code);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取的number用作客户端后续读/写操作的socket id。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'bluetooth clientSocket Number: '</span> + number);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 以RFCOMM链路类型套接字为例</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sppOption</span>:socket.<span class="hljs-property">SppOptions</span> = {<span class="hljs-attr">uuid</span>: <span class="hljs-string">'00001810-0000-1000-8000-00805F9B34FB'</span>, <span class="hljs-attr">secure</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">type</span>: socket.<span class="hljs-property">SppType</span>.<span class="hljs-property">SPP_RFCOMM</span>};</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppConnect</span>(<span class="hljs-string">'XX:XX:XX:XX:XX:XX'</span>, sppOption, clientSocket);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketgetdeviceid17" device-type="phone,2in1,tablet,wearable,tv">socket.getDeviceId<sup>17+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketgetdeviceid17" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getDeviceId(clientSocket: number): string</p>     <p>客户端和服务端均可使用，获取套接字连接中的对端设备蓝牙地址。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>接口后，通过其异步callback获取到的。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">string</td>         <td class="cellrowborder" width="50%">          <p>返回对端设备地址。</p>          <p>基于信息安全考虑，此处获取的设备地址为虚拟MAC地址。</p>          <p>- 已配对的地址不会变更。</p>          <p>- 若该设备重启蓝牙开关，重新获取到的虚拟地址会立即变更。</p>          <p>- 若取消配对，蓝牙子系统会根据该地址的实际使用情况，决策后续变更时机；若其他应用正在使用该地址，则不会立刻变更。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码说明文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3. Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 服务端获取客户端设备地址。</span></li><li><span class="hljs-keyword">let</span> clientSocket = <span class="hljs-number">1</span>; <span class="hljs-comment">// clientSocket是sppAccept回调中得到的，调用getDeviceId接口前需更新clientSocket。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">deviceAddr</span>: string = socket.<span class="hljs-title function_">getDeviceId</span>(clientSocket);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 客户端获取服务端设备地址。</span></li><li><span class="hljs-comment">// clientSocket是sppConnect回调中得到的，调getDeviceId接口前需更新clientSocket。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">deviceAddr</span>: string = socket.<span class="hljs-title function_">getDeviceId</span>(clientSocket);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppcloseserversocket" device-type="phone,2in1,tablet,wearable,tv">socket.sppCloseServerSocket<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppcloseserversocket" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppCloseServerSocket(socket: number): void</p>     <p>服务端使用，删除指定的服务端套接字。</p>     <ul>      <li>需先调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>并获取到有效的服务端监听套接字标识符。</li>      <li>若服务端无需继续监听，可调用本接口以关闭监听套接字，蓝牙子系统会删除此前注册的服务。如果此时客户端发起连接，就会连接失败。</li>      <li>若服务端此时与其他客户端存在连接，该接口调用后，也会主动断开与客户端的连接。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">socket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>服务端监听套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketspplisten">socket.sppListen</a>接口，通过其异步callback获取到的。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900001</td>         <td class="cellrowborder" width="50%">Service stopped.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> serverNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 此处serverNumber需赋值为调用sppListen接口后，在回调中得到的serverNumber。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppCloseServerSocket</span>(serverNumber);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppcloseclientsocket" device-type="phone,2in1,tablet,wearable,tv">socket.sppCloseClientSocket<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppcloseclientsocket" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppCloseClientSocket(socket: number): void</p>     <p>客户端和服务端均可使用，关闭指定的客户端套接字，并断开客户端和服务端之间的连接。</p>     <ul>      <li>若客户端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>后，且连接成功后使用。</li>      <li>若服务端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>后，且连接成功后使用。</li>      <li>当应用不再需要已建立好的套接字连接时，需主动调用该接口断开客户端和服务端之间的连接。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">socket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900001</td>         <td class="cellrowborder" width="50%">Service stopped.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppCloseClientSocket</span>(clientNumber);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppwrite" device-type="phone,2in1,tablet,wearable,tv">socket.sppWrite<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppwrite" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppWrite(clientSocket: number, data: ArrayBuffer): void</p>     <p>客户端和服务端均可使用，向对端设备发送数据。</p>     <ul>      <li>仅在双方成功建立连接后，调用本接口才有效。</li>      <li>若客户端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>后，且连接成功后使用。</li>      <li>若服务端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>后，且连接成功后使用。</li>      <li>若开发者需感知传输过程中异常断连等错误，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppwriteasync18">socket.sppWriteAsync</a>。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP_BLE</a>时，单次发送数据大小存在限制，单位为Byte，超过限制范围的数据将被截断。链路类型为SPP_L2CAP_BLE时单次发送数据大小范围为[1, 65535]；链路类型为SPP_L2CAP时服务端单次发送数据大小范围为[1, 4091]，客户端单次发送数据大小范围为[1, 8085]。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">data</td>         <td class="cellrowborder" width="25%">ArrayBuffer</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">写入的数据。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2901054</td>         <td class="cellrowborder" width="50%">IO error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li><span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arrayBuffer);</li><li>data[<span class="hljs-number">0</span>] = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppWrite</span>(clientNumber, arrayBuffer);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketonsppread" device-type="phone,2in1,tablet,wearable,tv">socket.on('sppRead')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketonsppread" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: 'sppRead', clientSocket: number, callback: Callback&lt;ArrayBuffer&gt;): void</p>     <p>客户端和服务端均可使用，订阅套接字读请求事件。调用该接口后，当收到对端发送的数据会执行订阅的回调函数。</p>     <ul>      <li>若客户端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>后，且连接成功后使用。</li>      <li>若服务端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>后，且连接成功后使用。</li>      <li>不可以和API version 18开始支持的<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppreadasync18">socket.sppReadAsync</a>接口混用，同一路套接字连接只能使用socket.on('sppRead')接口或者<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppreadasync18">socket.sppReadAsync</a>接口。</li>      <li>若开发者需感知传输过程中异常断连等错误，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppreadasync18">socket.sppReadAsync</a>。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_RFCOMM</a>时，当接收数据大小超过1024字节时，会自动分多次接收，每次接收数据大小范围为[1, 1024]。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP_BLE</a>时，单次接收数据大小存在限制，需一次性读取全部数据，单位为Byte，超过最大接收数据大小限制将被截断。链路类型为SPP_L2CAP_BLE时单次接收数据大小范围为[1, 65535]；链路类型为SPP_L2CAP时服务端和客户端单次接收数据大小范围为[1, 8087]。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>事件回调类型，支持的事件为'sppRead'，表示订阅spp读请求事件。</p>          <p>当收到了对端发送的数据时，触发该事件。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">Callback&lt;ArrayBuffer&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指定订阅的回调函数，会返回读取到的数据。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.16.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2901054</td>         <td class="cellrowborder" width="50%">IO error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">dataRead</span> = (<span class="hljs-params">dataBuffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(dataBuffer);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'bluetooth data length is: '</span> + data.<span class="hljs-property">byteLength</span>);</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">on</span>(<span class="hljs-string">'sppRead'</span>, clientNumber, dataRead);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketoffsppread" device-type="phone,2in1,tablet,wearable,tv">socket.off('sppRead')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketoffsppread" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: 'sppRead', clientSocket: number, callback?: Callback&lt;ArrayBuffer&gt;): void</p>     <p>取消订阅套接字读请求事件。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">事件回调类型，支持的事件为'sppRead'，表示取消订阅spp读请求事件。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%">Callback&lt;ArrayBuffer&gt;</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>指定取消订阅的回调函数通知。</p>          <p>若传参，则需与<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketonsppread">socket.on('sppRead')</a>中的回调函数一致；若无传参，则取消订阅该type对应的所有回调函数通知。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Invalid parameter. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">off</span>(<span class="hljs-string">'sppRead'</span>, clientNumber);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppwriteasync18" device-type="phone,2in1,tablet,wearable,tv">socket.sppWriteAsync<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppwriteasync18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppWriteAsync(clientSocket: number, data: ArrayBuffer): Promise&lt;void&gt;</p>     <p>客户端和服务端均可使用，向对端设备发送数据。使用Promise异步回调。该接口支持断开连接时，会抛出错误码并返回。</p>     <ul>      <li>仅在双方成功建立连接后，调用本接口才有效。</li>      <li>若客户端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>后，且连接成功后使用。</li>      <li>若服务端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>后，且连接成功后使用。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP_BLE</a>时，单次发送数据大小存在限制，单位为Byte，超过限制大小的数据将被截断。链路类型为SPP_L2CAP_BLE时单次发送数据大小范围为[1, 65535]；链路类型为SPP_L2CAP时服务端单次发送数据大小范围为[1, 4091]，客户端单次发送数据大小范围为[1, 8085]。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">data</td>         <td class="cellrowborder" width="25%">ArrayBuffer</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">写入的数据。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.18.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码说明文档</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.18.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2901054</td>         <td class="cellrowborder" width="50%">IO error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> clientNumber = <span class="hljs-number">1</span>; <span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li><span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arrayBuffer);</li><li><span class="hljs-keyword">try</span> {</li><li>    socket.<span class="hljs-title function_">sppWriteAsync</span>(clientNumber, arrayBuffer).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"sppWrite success"</span>);</li><li>    });</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="socketsppreadasync18" device-type="phone,2in1,tablet,wearable,tv">socket.sppReadAsync<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="socketsppreadasync18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>sppReadAsync(clientSocket: number): Promise&lt;ArrayBuffer&gt;</p>     <p>客户端和服务端均可使用，读取对端发送数据的异步接口。使用Promise异步回调。该接口支持断开连接时，会抛出错误码并返回。</p>     <ul>      <li>若客户端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">socket.sppConnect</a>后，且连接成功后使用。</li>      <li>若服务端使用，需在调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">socket.sppAccept</a>后，且连接成功后使用。</li>      <li>不可以和API version 10开始支持的<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketonsppread">socket.on('sppRead')</a>接口混用，同一路socket只能使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketonsppread">socket.on('sppRead')</a>接口或者socket.sppReadAsync接口。</li>      <li>通过Promise异步返回读取的数据，建议在连接成功后循环调用去获取接收到的数据，若不及时调用会丢失接收的数据。</li>      <li>该接口为异步接口，需要等异步回调结果返回后才能进行下一次调用。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_RFCOMM</a>时，当接收数据大小超过1024字节时，会自动分多次接收，每次接收数据大小范围为[1, 1024]。</li>      <li>链路类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SPP_L2CAP_BLE</a>时，单次接收数据大小存在限制，需一次性读取全部数据，单位为Byte，超过最大接收数据大小限制将被截断。链路类型为SPP_L2CAP_BLE时单次接收数据大小范围为[1, 65535]；链路类型为SPP_L2CAP时服务端和客户端单次接收数据大小范围为[1, 8087]。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">clientSocket</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>客户端套接字的ID。</p>          <p>该值是调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppaccept">sppAccept</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketsppconnect">sppConnect</a>接口，通过其异步callback获取到的。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.19.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;ArrayBuffer&gt;</td>         <td class="cellrowborder" width="50%">Promise对象。返回读取的数据。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码</strong>：</p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码说明文档</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-bluetoothmanager">蓝牙服务子系统错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.19.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">801</td>         <td class="cellrowborder" width="50%">Capability not supported.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2901054</td>         <td class="cellrowborder" width="50%">IO error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2900099</td>         <td class="cellrowborder" width="50%">Operation failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pig-c106="" class="highlight-div"><div _ngcontent-pig-c106="" class="highlight-div-header"><div _ngcontent-pig-c106="" class="highlight-div-header-left"><div _ngcontent-pig-c106="" class="handle-button expand-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pig-c106="" class="highlight-div-header-right"><div _ngcontent-pig-c106="" class="handle-button ai-button"></div><div _ngcontent-pig-c106="" class="handle-button line-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pig-c106="" class="handle-button theme-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pig-c106="" class="handle-button copy-button"><div _ngcontent-pig-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pig-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 入参clientNumber由sppAccept或sppConnect接口获取。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">readAsync</span>(<span class="hljs-params">clientNumber: number</span>) {</li><li>  <span class="hljs-keyword">let</span> flag = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">while</span> (flag) { <span class="hljs-comment">// 该接口需业务循环调用读取，具体循环形式按业务需要来实现，这里只是示例。</span></li><li>      <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">await</span> socket.<span class="hljs-title function_">sppReadAsync</span>(clientNumber); <span class="hljs-comment">// 使用await确保顺序读取。</span></li><li>      <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer);</li><li>      <span class="hljs-keyword">if</span> (data) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'sppRead success, data length = '</span> + data.<span class="hljs-property">byteLength</span>);</li><li>        <span class="hljs-comment">// 在此处理接收到的数据。</span></li><li>      }</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startSppRead errCode: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage: '</span> + (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>);</li><li>    socket.<span class="hljs-title function_">sppCloseClientSocket</span>(clientNumber); <span class="hljs-comment">// 发生错误时关闭连接。</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="sppoptions" device-type="phone,2in1,tablet,wearable,tv">SppOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="sppoptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>描述套接字的配置参数。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.4.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.4.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.4.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.4.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.4.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">uuid</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>RFCOMM套接字链路类型的服务UUID，例如"00001101-0000-1000-8000-00805F9B34FB"。</p>          <p>- 建议开发者使用自定义的服务UUID（可通过工具函数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9">util.generateRandomUUID</a>生成），也可以使用标准协议定义的Serial Port UUID服务(00001101-0000-1000-8000-00805F9B34FB)。</p>          <p>- SppType设置为SPP_RFCOMM时该参数必选。</p>          <p>- SppType设置为SPP_L2CAP或SPP_L2CAP_BLE时设置为空字符串。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">secure</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是否是安全通道。true表示是安全通道，false表示非安全通道。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">type</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#spptype">SppType</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">蓝牙套接字链路类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">psm<sup>20+</sup></td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>协议/服务多路复用器值，用于标识特定的服务数据传输通道。不填写该参数时默认值为-1。</p>          <p>对于客户端：</p>          <p>- SppType设置为SPP_RFCOMM时，该参数不填。</p>          <p>- SppType设置为SPP_L2CAP_BLE或SPP_L2CAP时，需和服务端的psm值保持一致。</p>          <p>对于服务端：</p>          <p>- SppType设置为SPP_RFCOMM时，该参数不填。</p>          <p>- SppType设置为SPP_L2CAP_BLE时，psm值必须由系统自动分配，有效值范围为[0x01, 0xFF]。</p>          <p>- SppType设置为SPP_L2CAP时，psm值可以主动设置或蓝牙子系统分配，若为主动设置，其有效范围为[0x00, 0xFFFF]，并且需要满足低位字节最低位必须为1，高位字节最低位必须为0；若为蓝牙子系统分配，该参数不填，可以通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-bluetooth-socket#socketgetl2cappsm20">socket.getL2capPsm</a>接口获取psm值。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="spptype" device-type="phone,2in1,tablet,wearable,tv">SppType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="spptype" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>枚举，蓝牙套接字链路类型。</p>     <ul>      <li>不同类型的蓝牙设备需要选取不同的链路类型。</li>      <li>针对低功耗蓝牙（BLE）设备，必须使用L2CAP链路类型。</li>      <li>针对传统蓝牙（BR/EDR）设备，建议优先采用RFCOMM链路进行连接。其优势在于可通过UUID服务动态协商信道（即设备通过查询服务UUID自动确定通信频道的过程），同时具备更高的安全性和可靠性。</li>     </ul>     <p><strong>系统能力</strong>：SystemCapability.Communication.Bluetooth.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.5.1.4.1.1" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.5.1.4.1.2" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.5.1.4.1.3" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="33.33333333333333%">SPP_RFCOMM</td>         <td class="cellrowborder" width="33.33333333333333%">0</td>         <td class="cellrowborder" width="33.33333333333333%">基于传统蓝牙（BR/EDR）的RFCOMM链路。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">SPP_L2CAP<sup>20+</sup></td>         <td class="cellrowborder" width="33.33333333333333%">1</td>         <td class="cellrowborder" width="33.33333333333333%">基于传统蓝牙（BR/EDR）的L2CAP链路。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">SPP_L2CAP_BLE<sup>20+</sup></td>         <td class="cellrowborder" width="33.33333333333333%">2</td>         <td class="cellrowborder" width="33.33333333333333%">基于低功耗蓝牙（BLE）的L2CAP链路。</td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>