<h1 _ngcontent-amo-c119="" class="doc-title ng-star-inserted" title="@ohos.hiTraceChain (分布式跟踪)"> @ohos.hiTraceChain (分布式跟踪) </h1>

<div _ngcontent-amo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供了端侧业务流程调用链跟踪的打点能力，包括业务流程跟踪的启动、结束、信息埋点等能力。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>本模块首批接口从API version 8开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>  </div></div></div>  <div class="tiledSection"><h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hiTraceChain } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitraceflag" device-type="phone,2in1,tablet,wearable,tv">HiTraceFlag<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitraceflag" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>跟踪标志组合类型枚举。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.1" width="33.33333333333333%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.2" width="33.33333333333333%">值</th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.4.1.3" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%">DEFAULT</td> <td class="cellrowborder" width="33.33333333333333%">0</td> <td class="cellrowborder" width="33.33333333333333%">缺省标志。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">INCLUDE_ASYNC</td> <td class="cellrowborder" width="33.33333333333333%">1</td> <td class="cellrowborder" width="33.33333333333333%"><p>异步调用标志。</p> <p>设置该标志，同时跟踪同步和异步调用；缺省只跟踪同步调用。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">DONOT_CREATE_SPAN</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 1</td> <td class="cellrowborder" width="33.33333333333333%"><p>无分支标志。</p> <p>设置该标志，不创建分支信息；缺省创建分支信息。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">TP_INFO</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 2</td> <td class="cellrowborder" width="33.33333333333333%"><p>埋点标志。</p> <p>调试场景下设置该标志，调用信息埋点接口<a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracechaintracepoint">tracepoint()</a>时，会打印埋点信息hilog日志；缺省不打印埋点信息hilog日志。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">NO_BE_INFO</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 3</td> <td class="cellrowborder" width="33.33333333333333%"><p>无开始结束信息标志。</p> <p>调试场景下设置该标志，调用开始跟踪接口<a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracechainbegin">begin()</a>和结束跟踪接口<a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracechainend">end()</a>时，分别会打印开始、结束跟踪信息hilog日志；缺省不打印开始、结束跟踪信息hilog日志。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">DISABLE_LOG</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 4</td> <td class="cellrowborder" width="33.33333333333333%"><p>日志关联标志。</p> <p>设置该标志，不会在hilog日志中附加HiTraceId信息；缺省会在hilog日志中附加HiTraceId信息。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">FAILURE_TRIGGER</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 5</td> <td class="cellrowborder" width="33.33333333333333%">故障触发标志。预置标志，暂未启用。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">D2D_TP_INFO</td> <td class="cellrowborder" width="33.33333333333333%">1 &lt;&lt; 6</td> <td class="cellrowborder" width="33.33333333333333%"><p>设备间埋点标志。TP_INFO的一个子集，调试场景下使用。</p> <p>当已设置TP_INFO标志时，D2D_TP_INFO标志不生效；</p> <p>当未设置TP_INFO标志时，设置D2D_TP_INFO标志，此时调用信息埋点接口<a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracechaintracepoint">tracepoint()</a>，仅当mode参数为设备间通信DEVICE的情况下，会打印埋点信息hilog日志。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="hitracetracepointtype" device-type="phone,2in1,tablet,wearable,tv">HiTraceTracepointType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracetracepointtype" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>跟踪埋点类型枚举。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.4.1.4.1.1" width="33.33333333333333%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.4.1.2" width="33.33333333333333%">值</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.4.1.3" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%">CS</td> <td class="cellrowborder" width="33.33333333333333%">0</td> <td class="cellrowborder" width="33.33333333333333%">客户端发送。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">CR</td> <td class="cellrowborder" width="33.33333333333333%">1</td> <td class="cellrowborder" width="33.33333333333333%">客户端接收。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">SS</td> <td class="cellrowborder" width="33.33333333333333%">2</td> <td class="cellrowborder" width="33.33333333333333%">服务端发送。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">SR</td> <td class="cellrowborder" width="33.33333333333333%">3</td> <td class="cellrowborder" width="33.33333333333333%">服务端接收。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">GENERAL</td> <td class="cellrowborder" width="33.33333333333333%">4</td> <td class="cellrowborder" width="33.33333333333333%">通用类型，标识CS、CR、SS、SR四种场景之外的埋点。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="hitracecommunicationmode" device-type="phone,2in1,tablet,wearable,tv">HiTraceCommunicationMode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracecommunicationmode" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>跟踪通信类型枚举。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.1" width="33.33333333333333%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.2" width="33.33333333333333%">值</th> <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.3" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%">DEFAULT</td> <td class="cellrowborder" width="33.33333333333333%">0</td> <td class="cellrowborder" width="33.33333333333333%">缺省通信类型。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">THREAD</td> <td class="cellrowborder" width="33.33333333333333%">1</td> <td class="cellrowborder" width="33.33333333333333%">线程间通信。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">PROCESS</td> <td class="cellrowborder" width="33.33333333333333%">2</td> <td class="cellrowborder" width="33.33333333333333%">进程间通信。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">DEVICE</td> <td class="cellrowborder" width="33.33333333333333%">3</td> <td class="cellrowborder" width="33.33333333333333%">设备间通信。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="hitraceid" device-type="phone,2in1,tablet,wearable,tv">HiTraceId<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitraceid" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>此接口为HiTraceId对象接口。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.4.1.6.1.1" width="20%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.6.1.2" width="20%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.6.1.3" width="20%">只读</th> <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.6.1.4" width="20%">可选</th> <th align="left" class="cellrowborder" id="mcps1.3.7.4.1.6.1.5" width="20%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="20%">chainId</td> <td class="cellrowborder" width="20%">bigint</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">跟踪链标识。</td> </tr> <tr><td class="cellrowborder" width="20%">spanId</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">分支标识，默认值为0。</td> </tr> <tr><td class="cellrowborder" width="20%">parentSpanId</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">父分支标识，默认值为0。</td> </tr> <tr><td class="cellrowborder" width="20%">flags</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">跟踪标志位，默认值为0。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="hitracechainbegin" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.begin<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainbegin" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>begin(name: string, flags?: number): HiTraceId</p> <p>开始跟踪，同步接口。</p> <p>当前线程TLS（Thread Local Storage，线程本地存储）中不存在有效的HiTraceId时，生成有效的HiTraceId并设置到当前线程TLS中，返回该HiTraceId。</p> <p>当前线程TLS中已存在有效的HiTraceId时，不会开始新的跟踪，返回各属性值均为0的无效HiTraceId。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">name</td> <td class="cellrowborder" width="25%">string</td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">跟踪业务名。</td> </tr> <tr><td class="cellrowborder" width="25%">flags</td> <td class="cellrowborder" width="25%">number</td> <td class="cellrowborder" width="25%">否</td> <td class="cellrowborder" width="25%">跟踪标志组合，具体可参考<a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceflag">HiTraceFlag</a>，默认值为0。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="50%">HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是INCLUDE_ASYNC与DONOT_CREATE_SPAN的并集。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">INCLUDE_ASYNC</span> | hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DONOT_CREATE_SPAN</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainend" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.end<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainend" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>end(id: HiTraceId): void</p> <p>结束跟踪，同步接口。</p> <p>若给定的HiTraceId有效，且等于当前线程TLS中的HiTraceId，结束跟踪并将当前线程TLS中的HiTraceId设置为无效。</p> <p>若给定的HiTraceId无效，或不等于当前线程TLS中的HiTraceId，结束跟踪失败，打印结束跟踪失败hilog日志。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是DEFAULT。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DEFAULT</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechaingetid" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.getId<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechaingetid" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getId(): HiTraceId</p> <p>获取跟踪标识，同步接口。</p> <p>获取当前线程TLS中的HiTraceId。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.7.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="50%">HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是DEFAULT。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DEFAULT</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，获取当前跟踪标识。</span></li><li><span class="hljs-keyword">let</span> curTraceId = hiTraceChain.<span class="hljs-title function_">getId</span>();</li><li><span class="hljs-comment">// 同一跟踪链获取的跟踪标识的chainId一定相同。</span></li><li><span class="hljs-keyword">if</span> (curTraceId.<span class="hljs-property">chainId</span> != traceId.<span class="hljs-property">chainId</span>) {</li><li><span class="hljs-comment">// 基于异常场景的处理逻辑。</span></li><li>}</li><li><span class="hljs-comment">// 若干业务逻辑完成后，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainsetid" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.setId<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainsetid" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setId(id: HiTraceId): void</p> <p>设置跟踪标识，同步接口。</p> <p>将给定的HiTraceId设置到当前线程TLS中。若给定的HiTraceId无效，则不执行任何操作。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取当前跟踪链中的跟踪标识。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">getId</span>();</li><li><span class="hljs-comment">// 将获取的跟踪标识设置为当前traceId。</span></li><li>hiTraceChain.<span class="hljs-title function_">setId</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainclearid" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.clearId<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainclearid" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>clearId(): void</p> <p>清除跟踪标识，同步接口。</p> <p>将当前线程TLS中的HiTraceId设置为无效。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 业务开始前，尝试清除跟踪标识。</span></li><li>hiTraceChain.<span class="hljs-title function_">clearId</span>();</li><li><span class="hljs-comment">// 开始跟踪，跟踪标志是DEFAULT。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DEFAULT</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechaincreatespan" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.createSpan<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechaincreatespan" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>createSpan(): HiTraceId</p> <p>创建跟踪分支，同步接口。</p> <p>创建一个HiTraceId，使用当前线程TLS中的chainId、spanId初始化HiTraceId的chainId、parentSpanId，并为HiTraceId生成一个新的spanId，返回该HiTraceId。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.7.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="50%">HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是DEFAULT。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DEFAULT</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，创建跟踪分支。</span></li><li><span class="hljs-keyword">let</span> spanTraceId = hiTraceChain.<span class="hljs-title function_">createSpan</span>();</li><li><span class="hljs-comment">// 同一跟踪链的跟踪标识的chainId一定相同。</span></li><li><span class="hljs-keyword">if</span> (spanTraceId.<span class="hljs-property">chainId</span> != traceId.<span class="hljs-property">chainId</span>) {</li><li><span class="hljs-comment">// 基于异常场景的处理逻辑。</span></li><li>}</li><li><span class="hljs-comment">//业务结束，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechaintracepoint" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.tracepoint<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechaintracepoint" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>tracepoint(mode: HiTraceCommunicationMode, type: HiTraceTracepointType, id: HiTraceId, msg?: string): void</p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hitracemeter">HiTraceMeter</a>跟踪信息埋点，同步接口。</p> <p>当type为客户端发送CS和服务端接收SC时，进行同步HiTraceMeter开始打点；当type为客户端接收CC和服务端发送SS时，进行同步HiTraceMeter结束打点；当type为通用类型GENERAL时，不会进行HiTraceMeter打点。</p> <p>type为客户端发送CS和客户端接收CC的信息埋点需配套使用；type为服务端接收SC和服务端发送SS的信息埋点需配套使用。否则，HiTraceMeter开始与结束打点无法正常匹配。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">mode</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracecommunicationmode">HiTraceCommunicationMode</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">信息埋点需要指定的跟踪通信模式。</td> </tr> <tr><td class="cellrowborder" width="25%">type</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitracetracepointtype">HiTraceTracepointType</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">信息埋点需要指定的跟踪埋点类型。</td> </tr> <tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">实施信息埋点操作的HiTraceId实例。</td> </tr> <tr><td class="cellrowborder" width="25%">msg</td> <td class="cellrowborder" width="25%">string</td> <td class="cellrowborder" width="25%">否</td> <td class="cellrowborder" width="25%">HiTraceMeter打点操作传入的trace说明信息。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是INCLUDE_ASYNC与DONOT_CREATE_SPAN的并集。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">INCLUDE_ASYNC</span> | hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DONOT_CREATE_SPAN</span>);</li><li><span class="hljs-comment">// 若干业务逻辑完成后，触发信息埋点操作。</span></li><li>hiTraceChain.<span class="hljs-title function_">tracepoint</span>(hiTraceChain.<span class="hljs-property">HiTraceCommunicationMode</span>.<span class="hljs-property">THREAD</span>, hiTraceChain.<span class="hljs-property">HiTraceTracepointType</span>.<span class="hljs-property">SS</span>, traceId, <span class="hljs-string">"Just a example"</span>);</li><li><span class="hljs-comment">//业务结束，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainisvalid" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.isValid<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainisvalid" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>isValid(id: HiTraceId): boolean</p> <p>判断HiTraceId是否有效，同步接口。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.6.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">需要判断是否有效的HiTraceId实例。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.8.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">boolean</td> <td class="cellrowborder" width="50%">true：HiTraceId有效；false：HiTraceId无效。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是DEFAULT。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DEFAULT</span>);</li><li><span class="hljs-comment">// traceIdIsvalid为true</span></li><li><span class="hljs-keyword">let</span> traceIdIsvalid = hiTraceChain.<span class="hljs-title function_">isValid</span>(traceId);</li><li><span class="hljs-keyword">if</span> (traceIdIsvalid) {</li><li><span class="hljs-comment">// 基于跟踪标识合法性校验成功的场景的处理逻辑。</span></li><li>}</li><li><span class="hljs-comment">//业务结束，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainisflagenabled" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.isFlagEnabled<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainisflagenabled" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>isFlagEnabled(id: HiTraceId, flag: HiTraceFlag): boolean</p> <p>判断HiTraceId是否启用了跟踪标志flag，同步接口。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.16.6.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.16.6.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.16.6.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.16.6.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">需要判断指定跟踪标志是否启用的HiTraceId实例。</td> </tr> <tr><td class="cellrowborder" width="25%">flag</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceflag">HiTraceFlag</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">指定的跟踪标志。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.16.8.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.16.8.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">boolean</td> <td class="cellrowborder" width="50%">true：HiTraceId已启用flag；false：HiTraceId未启用flag。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是INCLUDE_ASYNC。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">INCLUDE_ASYNC</span>);</li><li><span class="hljs-comment">// enabledIncludeAsyncFlag为true。</span></li><li><span class="hljs-keyword">let</span> enabledIncludeAsyncFlag = hiTraceChain.<span class="hljs-title function_">isFlagEnabled</span>(traceId, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">INCLUDE_ASYNC</span>);</li><li><span class="hljs-keyword">if</span> (enabledIncludeAsyncFlag) {</li><li><span class="hljs-comment">// 基于INCLUDE_ASYNC跟踪标志已设置场景的处理逻辑。</span></li><li>}</li><li><span class="hljs-comment">//业务结束，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="hitracechainenableflag" device-type="phone,2in1,tablet,wearable,tv">hiTraceChain.enableFlag<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="hitracechainenableflag" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>enableFlag(id: HiTraceId, flag: HiTraceFlag): void</p> <p>启用HiTraceId中指定的跟踪标志，同步接口。</p> <p><strong>系统能力</strong>：SystemCapability.HiviewDFX.HiTrace</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.17.6.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">id</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid">HiTraceId</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">需要启用指定跟踪标志的HiTraceId实例。</td> </tr> <tr><td class="cellrowborder" width="25%">flag</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceflag">HiTraceFlag</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">指定的跟踪标志。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-amo-c106="" class="highlight-div"><div _ngcontent-amo-c106="" class="highlight-div-header"><div _ngcontent-amo-c106="" class="highlight-div-header-left"><div _ngcontent-amo-c106="" class="handle-button expand-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-amo-c106="" class="highlight-div-header-right"><div _ngcontent-amo-c106="" class="handle-button ai-button"></div><div _ngcontent-amo-c106="" class="handle-button line-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-amo-c106="" class="handle-button theme-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-amo-c106="" class="handle-button copy-button"><div _ngcontent-amo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-amo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 开始跟踪，跟踪标志是INCLUDE_ASYNC。</span></li><li><span class="hljs-keyword">let</span> traceId = hiTraceChain.<span class="hljs-title function_">begin</span>(<span class="hljs-string">"business"</span>, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">INCLUDE_ASYNC</span>);</li><li><span class="hljs-comment">// enabledDoNotCreateSpanFlag为false。</span></li><li><span class="hljs-keyword">let</span> enabledDoNotCreateSpanFlag = hiTraceChain.<span class="hljs-title function_">isFlagEnabled</span>(traceId, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DONOT_CREATE_SPAN</span>);</li><li><span class="hljs-comment">// 设置DONOT_CREATE_SPAN跟踪标志。</span></li><li>hiTraceChain.<span class="hljs-title function_">enableFlag</span>(traceId, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DONOT_CREATE_SPAN</span>);</li><li><span class="hljs-comment">// enabledDoNotCreateSpanFlag为true。</span></li><li>enabledDoNotCreateSpanFlag = hiTraceChain.<span class="hljs-title function_">isFlagEnabled</span>(traceId, hiTraceChain.<span class="hljs-property">HiTraceFlag</span>.<span class="hljs-property">DONOT_CREATE_SPAN</span>);</li><li><span class="hljs-keyword">if</span> (enabledDoNotCreateSpanFlag) {</li><li><span class="hljs-comment">// 基于DONOT_CREATE_SPAN跟踪标志已设置场景的处理逻辑。</span></li><li>}</li><li><span class="hljs-comment">//业务结束，结束跟踪。</span></li><li>hiTraceChain.<span class="hljs-title function_">end</span>(traceId);</li></ol></pre></div></div> </div> </div> <div></div></div>