<h1 _ngcontent-ubh-c119="" class="doc-title ng-star-inserted" title="@ohos.multimedia.movingphotoview (动态照片)"> @ohos.multimedia.movingphotoview (动态照片) </h1>

<div _ngcontent-ubh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>用于播放动态照片文件并控制其播放状态的组件。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>该组件从API Version 12开始支持。后续版本如有新增内容，则采用上角标单独标记该内容的起始版本。</p>      <p>当前不支持在预览器中使用MovingPhotoView组件。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-ubh-c106="" class="highlight-div"><div _ngcontent-ubh-c106="" class="highlight-div-header"><div _ngcontent-ubh-c106="" class="highlight-div-header-left"><div _ngcontent-ubh-c106="" class="handle-button expand-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ubh-c106="" class="highlight-div-header-right"><div _ngcontent-ubh-c106="" class="handle-button ai-button"></div><div _ngcontent-ubh-c106="" class="handle-button line-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ubh-c106="" class="handle-button theme-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ubh-c106="" class="handle-button copy-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ubh-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MovingPhotoView</span>, <span class="hljs-title class_">MovingPhotoViewController</span>, <span class="hljs-title class_">MovingPhotoViewAttribute</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="movingphotoview" device-type="phone,2in1,tablet,tv">MovingPhotoView<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="movingphotoview" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>当前不支持动态属性设置。</li>        <li>当前不支持ArkUI通用属性ComponentOptions中expandSafeArea属性设置。</li>        <li>该组件长按触发播放时组件区域放大为1.1倍。</li>        <li>该组件使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer">AVPlayer</a>进行播放，同时开启的AVPlayer个数不建议超过3个，超过3个可能会出现视频播放卡顿现象。</li>       </ul>      </div></div></div>     <p>MovingPhotoView(options: MovingPhotoViewOptions)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.5.1.2" width="25%">参数类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.5.1.4" width="25%">参数描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotoviewoptions">MovingPhotoViewOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="movingphotoviewoptions" device-type="phone,2in1,tablet,tv">MovingPhotoViewOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="movingphotoviewoptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">movingPhoto</td>         <td class="cellrowborder" width="20%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-movingphoto">photoAccessHelper.MovingPhoto</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>支持媒体库MovingPhoto数据源，具体信息详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-movingphoto">MovingPhoto说明</a>。</p>          <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">controller</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotoviewcontroller">MovingPhotoViewController</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>设置动态照片控制器，可以控制动态照片的播放状态。</p>          <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">imageAIOptions<sup>18+</sup></td>         <td class="cellrowborder" width="20%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-image-common#imageaioptions12">ImageAIOptions</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>设置动态照片AI分析选项，可配置分析类型或绑定一个分析控制器。</p>          <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="属性" device-type="phone,2in1,tablet,tv">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>除支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-component-general-attributes">通用属性</a>外，还支持以下属性：</p>    </div>    <div class="tiledSection">     <h3 id="muted" device-type="phone,2in1,tablet,tv" class="firsth2">muted<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="muted" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>muted(isMuted: boolean)</p>     <p>设置是否静音。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">isMuted</td>         <td class="cellrowborder" width="25%">boolean</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>是否静音。</p>          <p>默认值：false。</p>          <p>false：非静音。</p>          <p>true：静音。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="objectfit" device-type="phone,2in1,tablet,tv">objectFit<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="objectfit" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>objectFit(value: ImageFit)</p>     <p>设置动态照片显示模式。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">value</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-appendix-enums#imagefit">ImageFit</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>视频显示模式。</p>          <p>默认值：Cover。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="autoplayperiod13" device-type="phone,2in1,tablet,tv">autoPlayPeriod<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="autoplayperiod13" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>autoPlayPeriod(startTime: number, endTime: number)</p>     <p>设置自动播放区间，附属于autoPlay的子配置项。</p>     <p>在调用此方法前，需将<a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#autoplay13">autoPlay</a>设置为true，设置自动播放，否则指定的视频区间(startTime, endTime)无法生效。</p>     <p><strong>元服务API：</strong> 从API version 13开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">startTime</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>区间播放开始时间，单位：ms。</p>          <p>取值范围：大于等于0。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">endTime</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>区间播放结束时间，单位：ms。</p>          <p>取值范围：大于startTime。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="autoplay13" device-type="phone,2in1,tablet,tv">autoPlay<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="autoplay13" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>autoPlay(isAutoPlay: boolean)</p>     <p>设置自动播放，自动播放一遍视频。</p>     <p>动态照片加载完成后，准备播放时可以调用，播放完成后显示静态图。</p>     <p><strong>元服务API：</strong> 从API version 13开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">isAutoPlay</td>         <td class="cellrowborder" width="25%">boolean</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>是否自动播放。</p>          <p>false：不自动播放。</p>          <p>true：自动播放。</p>          <p>默认值：false。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="repeatplay13" device-type="phone,2in1,tablet,tv">repeatPlay<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="repeatplay13" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>repeatPlay(isRepeatPlay: boolean)</p>     <p>设置循环播放，重复播放视频。 repeatPlay与autoPlay及长按播放互斥，repeatPlay设置时，autoPlay和长按播放均不生效。</p>     <p><strong>元服务API：</strong> 从API version 13开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">isRepeatPlay</td>         <td class="cellrowborder" width="25%">boolean</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>是否循环播放。</p>          <p>false：不循环播放。</p>          <p>true：循环播放。</p>          <p>默认值：false。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="enableanalyzer18" device-type="phone,2in1,tablet,tv">enableAnalyzer<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="enableanalyzer18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>enableAnalyzer(enabled: boolean)</p>     <p>设置该图片是否支持AI分析，当前支持主体识别、文字识别和对象查找等功能。</p>     <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">enabled</td>         <td class="cellrowborder" width="25%">boolean</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>是否开启AI分析。</p>          <p>false：不开启AI分析。</p>          <p>true：开启AI分析。</p>          <p>默认值：true。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="事件" device-type="phone,2in1,tablet,tv">事件<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="事件" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>除支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-component-general-events">通用事件</a>外，还支持以下事件：</p>    </div>    <div class="tiledSection">     <h3 id="oncomplete13" device-type="phone,2in1,tablet,tv" class="firsth2">onComplete<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oncomplete13" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onComplete(callback: MovingPhotoViewEventCallback)</p>     <p>动态照片加载完成图片时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 13开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片加载完成图片的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onstart" device-type="phone,2in1,tablet,tv">onStart<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onstart" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onStart(callback: MovingPhotoViewEventCallback)</p>     <p>播放时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片开始播放时触发的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onpause" device-type="phone,2in1,tablet,tv">onPause<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onpause" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onPause(callback: MovingPhotoViewEventCallback)</p>     <p>播放暂停时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片播放暂停时触发的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onfinish" device-type="phone,2in1,tablet,tv">onFinish<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onfinish" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onFinish(callback: MovingPhotoViewEventCallback)</p>     <p>播放结束时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片播放结束时触发的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onerror" device-type="phone,2in1,tablet,tv">onError<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onerror" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onError(callback: MovingPhotoViewEventCallback)</p>     <p>播放失败时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片播放失败时触发的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onstop" device-type="phone,2in1,tablet,tv">onStop<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onstop" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onStop(callback: MovingPhotoViewEventCallback)</p>     <p>播放停止时触发该事件(当stop()方法被调用后触发)。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片停止播放时触发的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="onprepared20" device-type="phone,2in1,tablet,tv">onPrepared<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onprepared20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>onPrepared(callback: MovingPhotoViewEventCallback)</p>     <p>动态照片准备播放时触发该事件。</p>     <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ohos-multimedia-movingphotoview#movingphotovieweventcallback">MovingPhotoViewEventCallback</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">动态照片准备播放时的回调。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="movingphotovieweventcallback" device-type="phone,2in1,tablet,tv">MovingPhotoViewEventCallback<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="movingphotovieweventcallback" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>declare type MovingPhotoViewEventCallback = () =&gt; void</p>     <p>动态照片播放状态发生变化时触发的回调。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>    </div>    <div class="tiledSection">     <h2 id="movingphotoviewcontroller" device-type="phone,2in1,tablet,tv">MovingPhotoViewController<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="movingphotoviewcontroller" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>一个MovingPhotoViewController对象可以控制一个MovingPhotoView，可用视频播放实例请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media">@ohos.multimedia.media</a>。</p>    </div>    <div class="tiledSection">     <h3 id="constructor" device-type="phone,2in1,tablet,tv" class="firsth2">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>constructor()</p>     <p>MovingPhotoViewController的构造函数。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>    </div>    <div class="tiledSection">     <h3 id="startplayback" device-type="phone,2in1,tablet,tv">startPlayback<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="startplayback" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>startPlayback()</p>     <p>开始播放，动态照片加载完成后，在播放准备，暂停，完成时调用。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>    </div>    <div class="tiledSection">     <h3 id="stopplayback" device-type="phone,2in1,tablet,tv">stopPlayback<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="stopplayback" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>stopPlayback()</p>     <p>停止播放，再次播放时从头开始播放。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>    </div>    <div class="tiledSection">     <h3 id="refreshmovingphoto18" device-type="phone,2in1,tablet,tv">refreshMovingPhoto<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="refreshmovingphoto18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>refreshMovingPhoto()</p>     <p>强制刷新动态照片组件加载的视频和图片资源，会打断组件当前的行为，使用时要谨慎。</p>     <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.FileManagement.PhotoAccessHelper.Core</p>    </div>    <div class="tiledSection">     <h2 id="示例1多种形式播放动态照片" device-type="phone,2in1,tablet,tv">示例1：多种形式播放动态照片<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="示例1多种形式播放动态照片" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-ubh-c106="" class="highlight-div"><div _ngcontent-ubh-c106="" class="highlight-div-header"><div _ngcontent-ubh-c106="" class="highlight-div-header-left"><div _ngcontent-ubh-c106="" class="handle-button expand-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ubh-c106="" class="highlight-div-header-right"><div _ngcontent-ubh-c106="" class="handle-button ai-button"></div><div _ngcontent-ubh-c106="" class="handle-button line-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ubh-c106="" class="handle-button theme-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ubh-c106="" class="handle-button copy-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ubh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { emitter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { dataSharePredicates } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MovingPhotoView</span>, <span class="hljs-title class_">MovingPhotoViewController</span>, <span class="hljs-title class_">MovingPhotoViewAttribute</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">PHOTO_SELECT_EVENT_ID</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">80001</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MovingPhotoViewDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">src</span>: photoAccessHelper.<span class="hljs-property">MovingPhoto</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isMuted</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">MovingPhotoViewController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MovingPhotoViewController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">on</span>({</li><li>      <span class="hljs-attr">eventId</span>: <span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>,</li><li>      <span class="hljs-attr">priority</span>: emitter.<span class="hljs-property">EventPriority</span>.<span class="hljs-property">IMMEDIATE</span>,</li><li>    }, <span class="hljs-function">(<span class="hljs-params">eventData: emitter.EventData</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">src</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt;(<span class="hljs-string">'mv_data'</span>) <span class="hljs-keyword">as</span> photoAccessHelper.<span class="hljs-property">MovingPhoto</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">off</span>(<span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'PICK'</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">uris</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []</li><li>              <span class="hljs-keyword">const</span> photoSelectOptions = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>()</li><li>              photoSelectOptions.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_VIDEO_TYPE</span></li><li>              photoSelectOptions.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">2</span></li><li>              <span class="hljs-keyword">const</span> photoViewPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>()</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">photoSelectResult</span>: photoAccessHelper.<span class="hljs-property">PhotoSelectResult</span> = <span class="hljs-keyword">await</span> photoViewPicker.<span class="hljs-title function_">select</span>(photoSelectOptions)</li><li>              uris = photoSelectResult.<span class="hljs-property">photoUris</span></li><li>              <span class="hljs-keyword">if</span> (uris[<span class="hljs-number">0</span>]) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handlePickerResult</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!, uris[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaDataHandlerMovingPhoto</span>())</li><li>              }</li><li>            } <span class="hljs-keyword">catch</span> (e) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`pick file failed`</span>)</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">MovingPhotoView</span>({</li><li>            <span class="hljs-attr">movingPhoto</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">src</span>,</li><li>            <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span></li><li>          })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">muted</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span>)</li><li>            .<span class="hljs-title function_">autoPlay</span>(<span class="hljs-literal">true</span>)</li><li>            .<span class="hljs-title function_">repeatPlay</span>(<span class="hljs-literal">false</span>)</li><li>            .<span class="hljs-title function_">autoPlayPeriod</span>(<span class="hljs-number">0</span>, <span class="hljs-number">600</span>)</li><li>            .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Cover</span>)</li><li>            .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Completed'</span>);</li><li>            })</li><li>            .<span class="hljs-title function_">onStart</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onStart'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onFinish</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onFinish'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onStop</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onStop'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onError</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'onError'</span>)</li><li>            })</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'70%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'start'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">startPlayback</span>()</li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'stop'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">stopPlayback</span>()</li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'mute'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span></li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handlePickerResult</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">handler</span>: photoAccessHelper.<span class="hljs-property">MediaAssetDataHandler</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uriPredicates</span>: dataSharePredicates.<span class="hljs-property">DataSharePredicates</span> = <span class="hljs-keyword">new</span> dataSharePredicates.<span class="hljs-title class_">DataSharePredicates</span>();</li><li>    uriPredicates.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'uri'</span>, uri)</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">fetchOptions</span>: photoAccessHelper.<span class="hljs-property">FetchOptions</span> = {</li><li>      <span class="hljs-attr">fetchColumns</span>: [],</li><li>      <span class="hljs-attr">predicates</span>: uriPredicates</li><li>    };</li><li>    <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context)</li><li>    <span class="hljs-keyword">let</span> assetResult = <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">getAssets</span>(fetchOptions)</li><li>    <span class="hljs-keyword">let</span> asset = <span class="hljs-keyword">await</span> assetResult.<span class="hljs-title function_">getFirstObject</span>()</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">requestOptions</span>: photoAccessHelper.<span class="hljs-property">RequestOptions</span> = {</li><li>      <span class="hljs-attr">deliveryMode</span>: photoAccessHelper.<span class="hljs-property">DeliveryMode</span>.<span class="hljs-property">FAST_MODE</span>,</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">requestMovingPhoto</span>(context, asset, requestOptions, handler)</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"request error: "</span>, err)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaDataHandlerMovingPhoto</span> <span class="hljs-keyword">implements</span> photoAccessHelper.<span class="hljs-property">MediaAssetDataHandler</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt; {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDataPrepared</span>(<span class="hljs-params">movingPhoto: photoAccessHelper.MovingPhoto</span>) {</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'mv_data'</span>, movingPhoto)</li><li>    emitter.<span class="hljs-title function_">emit</span>({</li><li>      <span class="hljs-attr">eventId</span>: <span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>,</li><li>      <span class="hljs-attr">priority</span>: emitter.<span class="hljs-property">EventPriority</span>.<span class="hljs-property">IMMEDIATE</span>,</li><li>    }, {</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="957" originwidth="480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115149.18213337167115944511640576840949:50001231000000:2800:16B90EA7EC2BB68033B2CCF2455AD6BA026A7B3745AD5DD9127EB5AB9EFAE556.gif" width="480" height="957"></span></p>    </div>    <div class="tiledSection">     <h2 id="示例2在元服务中使用动态照片" device-type="phone,2in1,tablet,tv">示例2：在元服务中使用动态照片<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="示例2在元服务中使用动态照片" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-ubh-c106="" class="highlight-div"><div _ngcontent-ubh-c106="" class="highlight-div-header"><div _ngcontent-ubh-c106="" class="highlight-div-header-left"><div _ngcontent-ubh-c106="" class="handle-button expand-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ubh-c106="" class="highlight-div-header-right"><div _ngcontent-ubh-c106="" class="handle-button ai-button"></div><div _ngcontent-ubh-c106="" class="handle-button line-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ubh-c106="" class="handle-button theme-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ubh-c106="" class="handle-button copy-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ubh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { photoAccessHelper, <span class="hljs-title class_">MovingPhotoView</span>, <span class="hljs-title class_">MovingPhotoViewController</span>, <span class="hljs-title class_">MovingPhotoViewAttribute</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: photoAccessHelper.<span class="hljs-property">MovingPhoto</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loading</span>(<span class="hljs-params">context: Context</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 需要确保imageFileUri和videoFileUri对应的资源在应用沙箱存在。</span></li><li>    <span class="hljs-keyword">let</span> imageFileUri = <span class="hljs-string">'file://{bundleName}/data/storage/el2/base/haps/entry/files/xxx.jpg'</span>;</li><li>    <span class="hljs-keyword">let</span> videoFileUri = <span class="hljs-string">'file://{bundleName}/data/storage/el2/base/haps/entry/files/xxx.mp4'</span>;</li><li>    data = <span class="hljs-keyword">await</span> photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">loadMovingPhoto</span>(context, imageFileUri, videoFileUri);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'load moving photo successfully'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`load moving photo failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">MovingPhotoViewController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MovingPhotoViewController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-title class_">ImageFit</span>: <span class="hljs-title class_">ImageFit</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span> = <span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">autoPlayFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">repeatPlayFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">autoPlayPeriodStart</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">autoPlayPeriodEnd</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">500</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title function_">loading</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Stack</span>({ <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">BottomStart</span> }) {</li><li>          <span class="hljs-title class_">MovingPhotoView</span>({</li><li>            <span class="hljs-attr">movingPhoto</span>: data,</li><li>            <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span></li><li>          })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">400</span>)</li><li>            .<span class="hljs-title function_">muted</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>)</li><li>            .<span class="hljs-title function_">objectFit</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">ImageFit</span>)</li><li>            .<span class="hljs-title function_">autoPlay</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">autoPlayFlag</span>)</li><li>            .<span class="hljs-title function_">autoPlayPeriod</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">autoPlayPeriodStart</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">autoPlayPeriodEnd</span>)</li><li>            .<span class="hljs-title function_">repeatPlay</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">repeatPlayFlag</span>)</li><li>            .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onComplete'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onStart</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onStart'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onStop</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onStop'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onPause</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onPause'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onFinish</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onFinish'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onError</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onError'</span>)</li><li>            })</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Play'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">startPlayback</span>()</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'StopPlay'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">stopPlayback</span>()</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'refreshMovingPhoto'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">refreshMovingPhoto</span>()</li><li>            })</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'mute'</span>).<span class="hljs-title function_">id</span>(<span class="hljs-string">'MovingPhotoView_true'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = <span class="hljs-literal">false</span></li><li>            })</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="649" originwidth="480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115149.52792223334496287888998323219595:50001231000000:2800:98C283CE3A2AA8210E82C99EAD17AE6DE182A4DFC86F70A98D883AC35A4F30D9.gif" width="480" height="649"></span></p>    </div>    <div class="tiledSection">     <h2 id="示例3图像分析功能使用" device-type="phone,2in1,tablet,tv">示例3：图像分析功能使用<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="示例3图像分析功能使用" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-ubh-c106="" class="highlight-div"><div _ngcontent-ubh-c106="" class="highlight-div-header"><div _ngcontent-ubh-c106="" class="highlight-div-header-left"><div _ngcontent-ubh-c106="" class="handle-button expand-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ubh-c106="" class="highlight-div-header-right"><div _ngcontent-ubh-c106="" class="handle-button ai-button"></div><div _ngcontent-ubh-c106="" class="handle-button line-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ubh-c106="" class="handle-button theme-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ubh-c106="" class="handle-button copy-button"><div _ngcontent-ubh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ubh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { emitter } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { dataSharePredicates } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MovingPhotoView</span>, <span class="hljs-title class_">MovingPhotoViewController</span>, <span class="hljs-title class_">MovingPhotoViewAttribute</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { visionImageAnalyzer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">PHOTO_SELECT_EVENT_ID</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">80001</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MovingPhotoViewDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">src</span>: photoAccessHelper.<span class="hljs-property">MovingPhoto</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isMuted</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">MovingPhotoViewController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MovingPhotoViewController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">aiController</span>: visionImageAnalyzer.<span class="hljs-property">VisionImageAnalyzerController</span> =</li><li>    <span class="hljs-keyword">new</span> visionImageAnalyzer.<span class="hljs-title class_">VisionImageAnalyzerController</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">ImageAIOptions</span> = {</li><li>    <span class="hljs-attr">types</span>: [<span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">SUBJECT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">TEXT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">OBJECT_LOOKUP</span>],</li><li>    <span class="hljs-attr">aiController</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">aiController</span></li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">on</span>({</li><li>      <span class="hljs-attr">eventId</span>: <span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>,</li><li>      <span class="hljs-attr">priority</span>: emitter.<span class="hljs-property">EventPriority</span>.<span class="hljs-property">IMMEDIATE</span>,</li><li>    }, <span class="hljs-function">(<span class="hljs-params">eventData: emitter.EventData</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">src</span> = <span class="hljs-title class_">AppStorage</span>.<span class="hljs-property">get</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt;(<span class="hljs-string">'mv_data'</span>) <span class="hljs-keyword">as</span> photoAccessHelper.<span class="hljs-property">MovingPhoto</span></li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    emitter.<span class="hljs-title function_">off</span>(<span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'PICK'</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">uris</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []</li><li>              <span class="hljs-keyword">const</span> photoSelectOptions = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>()</li><li>              photoSelectOptions.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_VIDEO_TYPE</span></li><li>              photoSelectOptions.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">2</span></li><li>              <span class="hljs-keyword">const</span> photoViewPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>()</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">photoSelectResult</span>: photoAccessHelper.<span class="hljs-property">PhotoSelectResult</span> = <span class="hljs-keyword">await</span> photoViewPicker.<span class="hljs-title function_">select</span>(photoSelectOptions)</li><li>              uris = photoSelectResult.<span class="hljs-property">photoUris</span></li><li>              <span class="hljs-keyword">if</span> (uris[<span class="hljs-number">0</span>]) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handlePickerResult</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getHostContext</span>()!, uris[<span class="hljs-number">0</span>], <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaDataHandlerMovingPhoto</span>())</li><li>              }</li><li>            } <span class="hljs-keyword">catch</span> (e) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`pick file failed`</span>)</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">MovingPhotoView</span>({</li><li>            <span class="hljs-attr">movingPhoto</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">src</span>,</li><li>            <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>,</li><li>            <span class="hljs-attr">imageAIOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">options</span></li><li>          })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>            .<span class="hljs-title function_">muted</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span>)</li><li>            .<span class="hljs-title function_">autoPlay</span>(<span class="hljs-literal">true</span>)</li><li>            .<span class="hljs-title function_">repeatPlay</span>(<span class="hljs-literal">false</span>)</li><li>            .<span class="hljs-title function_">autoPlayPeriod</span>(<span class="hljs-number">0</span>, <span class="hljs-number">600</span>)</li><li>            .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Cover</span>)</li><li>            .<span class="hljs-title function_">enableAnalyzer</span>(<span class="hljs-literal">true</span>)</li><li>            .<span class="hljs-title function_">onComplete</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'Completed'</span>);</li><li>            })</li><li>            .<span class="hljs-title function_">onStart</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onStart'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onFinish</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onFinish'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onStop</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onStop'</span>)</li><li>            })</li><li>            .<span class="hljs-title function_">onError</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">'onError'</span>)</li><li>            })</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'70%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'start'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">startPlayback</span>()</li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'stop'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">stopPlayback</span>()</li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'mute'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">isMuted</span></li><li>          })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'15%'</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">handlePickerResult</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">handler</span>: photoAccessHelper.<span class="hljs-property">MediaAssetDataHandler</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uriPredicates</span>: dataSharePredicates.<span class="hljs-property">DataSharePredicates</span> = <span class="hljs-keyword">new</span> dataSharePredicates.<span class="hljs-title class_">DataSharePredicates</span>();</li><li>    uriPredicates.<span class="hljs-title function_">equalTo</span>(<span class="hljs-string">'uri'</span>, uri)</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">fetchOptions</span>: photoAccessHelper.<span class="hljs-property">FetchOptions</span> = {</li><li>      <span class="hljs-attr">fetchColumns</span>: [],</li><li>      <span class="hljs-attr">predicates</span>: uriPredicates</li><li>    };</li><li>    <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context)</li><li>    <span class="hljs-keyword">let</span> assetResult = <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">getAssets</span>(fetchOptions)</li><li>    <span class="hljs-keyword">let</span> asset = <span class="hljs-keyword">await</span> assetResult.<span class="hljs-title function_">getFirstObject</span>()</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">requestOptions</span>: photoAccessHelper.<span class="hljs-property">RequestOptions</span> = {</li><li>      <span class="hljs-attr">deliveryMode</span>: photoAccessHelper.<span class="hljs-property">DeliveryMode</span>.<span class="hljs-property">FAST_MODE</span>,</li><li>    }</li><li>    <span class="hljs-keyword">try</span> {</li><li>      photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">requestMovingPhoto</span>(context, asset, requestOptions, handler)</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"request error: "</span>, err)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaDataHandlerMovingPhoto</span> <span class="hljs-keyword">implements</span> photoAccessHelper.<span class="hljs-property">MediaAssetDataHandler</span>&lt;photoAccessHelper.<span class="hljs-property">MovingPhoto</span>&gt; {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDataPrepared</span>(<span class="hljs-params">movingPhoto: photoAccessHelper.MovingPhoto</span>) {</li><li>    <span class="hljs-title class_">AppStorage</span>.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'mv_data'</span>, movingPhoto)</li><li>    emitter.<span class="hljs-title function_">emit</span>({</li><li>      <span class="hljs-attr">eventId</span>: <span class="hljs-variable constant_">PHOTO_SELECT_EVENT_ID</span>,</li><li>      <span class="hljs-attr">priority</span>: emitter.<span class="hljs-property">EventPriority</span>.<span class="hljs-property">IMMEDIATE</span>,</li><li>    }, {</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="689" originwidth="480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115149.31606701414616591840683808378995:50001231000000:2800:EC30DAD040BAA0140F35D3F2E8AA31D57078CC699894D96A2BAB0CC663607631.gif" width="480" height="689"></span></p>    </div>   </div>   <div></div></div>