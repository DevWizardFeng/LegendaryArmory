<h1 _ngcontent-kbr-c119="" class="doc-title ng-star-inserted" title="@ohos.net.vpnExtension (VPN 增强管理)"> @ohos.net.vpnExtension (VPN 增强管理) </h1>

<div _ngcontent-kbr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>三方VPN管理模块，支持三方VPN的启动和停止功能。三方VPN是指由第三方提供的VPN服务，它们通常提供更多的功能和更广泛的网络连接选项，包括更多的安全和隐私功能，以及更全面的定制选项。当前提供三方VPN能力主要用于创建虚拟网卡及配置VPN路由信息，连接隧道过程及内部连接的协议需要应用内部自行实现。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从 API version 11 开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>      <p>如下模块不支持在VpnExtensionAbility引用，可能会导致程序异常退出。</p>      <ul>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-contact">@ohos.contact(联系人)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocation">@ohos.geolocation</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-geolocationmanager">@ohos.geoLocationManager(位置服务)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio">@ohos.multimedia.audio(音频管理)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera">@ohos.multimedia.camera(相机管理)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-call">@ohos.telephony.call(拨打电话)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-sim">@ohos.telephony.sim(SIM卡管理)</a></p></li>       <li>        <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-sms">@ohos.telephony.sms(短信服务)</a></p></li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="linkaddress11" device-type="phone,2in1,tablet,wearable,tv">LinkAddress<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="linkaddress11" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type LinkAddress = connection.LinkAddress</p>     <p>获取网络链接信息。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#linkaddress">connection.LinkAddress</a></td>         <td class="cellrowborder" width="50%">网络链路信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="routeinfo11" device-type="phone,2in1,tablet,wearable,tv">RouteInfo<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="routeinfo11" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type RouteInfo = connection.RouteInfo</p>     <p>获取网络路由信息。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#routeinfo">connection.RouteInfo</a></td>         <td class="cellrowborder" width="50%">网络路由信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="vpnextensioncontext11" device-type="phone,2in1,tablet,wearable,tv">VpnExtensionContext<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnextensioncontext11" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type VpnExtensionContext = _VpnExtensionContext</p>     <p>VPN扩展的上下文。它允许访问serviceExtension特定资源。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-vpnextensioncontext">_VpnExtensionContext</a></td>         <td class="cellrowborder" width="50%">VPN扩展的上下文。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="vpnextensionstartvpnextensionability" device-type="phone,2in1,tablet,wearable,tv">vpnExtension.startVpnExtensionAbility<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnextensionstartvpnextensionability" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>startVpnExtensionAbility(want: Want): Promise&lt;void&gt;</p>     <p>启动新的三方VPN功能。使用Promise异步回调。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>模型约束</strong>：此接口仅可在Stage模型下使用。</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">want</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-want">Want</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指示要启动的信息。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">If the input parameter is not valid parameter.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000001</td>         <td class="cellrowborder" width="50%">The specified ability does not exist.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000002</td>         <td class="cellrowborder" width="50%">Incorrect ability type.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000006</td>         <td class="cellrowborder" width="50%">Cross-user operations are not allowed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000008</td>         <td class="cellrowborder" width="50%">The crowdtesting application expires.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000011</td>         <td class="cellrowborder" width="50%">The context does not exist.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000050</td>         <td class="cellrowborder" width="50%">Internal error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>Stage 模型示例：</p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { vpnExtension } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>  <span class="hljs-attr">deviceId</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.myvpndemo"</span>,</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"MyVpnExtAbility"</span>,</li><li>};</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"btn click"</span>)</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start Extension'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          vpnExtension.<span class="hljs-title function_">startVpnExtensionAbility</span>(want).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'startVpnExtensionAbility success'</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startVpnExtensionAbility error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>          })</li><li>        }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'70%'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="vpnextensionstopvpnextensionability" device-type="phone,2in1,tablet,wearable,tv">vpnExtension.stopVpnExtensionAbility<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnextensionstopvpnextensionability" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>stopVpnExtensionAbility(want: Want): Promise&lt;void&gt;</p>     <p>停止同一应用程序中的服务。使用Promise异步回调。</p>     <p><strong>系统能力</strong>：SystemCapability.Ability.AbilityRuntime.Core</p>     <p><strong>模型约束</strong>：此接口仅可在Stage模型下使用。</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">want</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-want">Want</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指示要启动的信息。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-ability">元能力子系统错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.12.1.3.1.1" width="50%">错误码 ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">If the input parameter is not valid parameter.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000001</td>         <td class="cellrowborder" width="50%">The specified ability does not exist.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000002</td>         <td class="cellrowborder" width="50%">Incorrect ability type.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000006</td>         <td class="cellrowborder" width="50%">Cross-user operations are not allowed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000011</td>         <td class="cellrowborder" width="50%">The context does not exist.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16000050</td>         <td class="cellrowborder" width="50%">Internal error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">16200001</td>         <td class="cellrowborder" width="50%">The caller has been released.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>Stage 模型示例：</p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { vpnExtension } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>  <span class="hljs-attr">deviceId</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.myvpndemo"</span>,</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"MyVpnExtAbility"</span>,</li><li>};</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"btn click"</span>)</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start Extension'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          vpnExtension.<span class="hljs-title function_">startVpnExtensionAbility</span>(want).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'startVpnExtensionAbility success'</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startVpnExtensionAbility error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>          })</li><li>        }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'70%'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Stop Extension'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"btn end"</span>)</li><li>          vpnExtension.<span class="hljs-title function_">stopVpnExtensionAbility</span>(want).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'stopVpnExtensionAbility success'</span>);</li><li>          }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'stopVpnExtensionAbility error: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>          })</li><li>        }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'70%'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="vpnextensioncreatevpnconnection" device-type="phone,2in1,tablet,wearable">vpnExtension.createVpnConnection<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnextensioncreatevpnconnection" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>createVpnConnection(context: VpnExtensionContext): VpnConnection</p>     <p>创建一个三方VPN连接对象。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>调用createVpnConnection接口前，需要先调用startVpnExtensionAbility接口启用VPN功能。</p>      </div></div></div>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>模型约束</strong>：此接口仅可在Stage模型下使用。</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">context</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-vpnextensioncontext">VpnExtensionContext</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指定 context。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-net-vpnextension#vpnconnection">VpnConnection</a></td>         <td class="cellrowborder" width="50%">返回一个VPN连接对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.13.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.13.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>Stage 模型示例：</p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: vpnExtension.<span class="hljs-property">VpnExtensionContext</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want</span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"VPN createVpnConnection: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(vpnConnection));</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="vpnconnection" device-type="phone,2in1,tablet,wearable">VpnConnection<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnconnection" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>VPN连接对象。在调用VpnConnection的方法前，需要先通过vpnExt.createVpnConnection创建VPN连接对象。</p>    </div>    <div class="tiledSection">     <h3 id="create" device-type="phone,2in1,tablet,wearable" class="firsth2">create<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="create" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>create(config: VpnConfig): Promise&lt;number&gt;</p>     <p>使用config创建一个VPN网络。使用Promise异步回调。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">config</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-net-vpnextension#vpnconfig">VpnConfig</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指定VPN网络的配置信息。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;number&gt;</td>         <td class="cellrowborder" width="50%">以 Promise 形式返回获取结果，返回指定虚拟网卡的文件描述符 fd。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-net-vpn">VPN错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200001</td>         <td class="cellrowborder" width="50%">Invalid parameter value.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200002</td>         <td class="cellrowborder" width="50%">Operation failed. Cannot connect to service.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200003</td>         <td class="cellrowborder" width="50%">System internal error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2203001</td>         <td class="cellrowborder" width="50%">VPN creation denied, please check the user type.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2203002</td>         <td class="cellrowborder" width="50%">VPN exist already, please execute destroy first.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: vpnExtension.<span class="hljs-property">VpnExtensionContext</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  private <span class="hljs-attr">tunIp</span>: string = <span class="hljs-string">'10.0.0.5'</span>;</li><li>  private <span class="hljs-attr">blockedAppName</span>: string = <span class="hljs-string">'com.example.myvpndemo'</span>;</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want</span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"vpn createVpnConnection: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(vpnConnection));</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">SetupVpn</span>();</li><li>  }</li><li>  <span class="hljs-title class_">SetupVpn</span>() {</li><li>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Address</span> {</li><li>            <span class="hljs-attr">address</span>: string;</li><li>            <span class="hljs-attr">family</span>: number;</li><li>
</li><li>            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">address: string, family: number</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">address</span> = address;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">family</span> = family;</li><li>            }</li><li>        }</li><li>
</li><li>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">AddressWithPrefix</span> {</li><li>            <span class="hljs-attr">address</span>: <span class="hljs-title class_">Address</span>;</li><li>            <span class="hljs-attr">prefixLength</span>: number;</li><li>
</li><li>            <span class="hljs-title function_">constructor</span>(<span class="hljs-params">address: Address, prefixLength: number</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">address</span> = address;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">prefixLength</span> = prefixLength;</li><li>            }</li><li>        }</li><li>
</li><li>        <span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {</li><li>            <span class="hljs-attr">addresses</span>: <span class="hljs-title class_">AddressWithPrefix</span>[];</li><li>            <span class="hljs-attr">mtu</span>: number;</li><li>            <span class="hljs-attr">dnsAddresses</span>: string[];</li><li>            <span class="hljs-attr">trustedApplications</span>: string[];</li><li>            <span class="hljs-attr">blockedApplications</span>: string[];</li><li>
</li><li>            <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span></li><li><span class="hljs-params">                tunIp: string,</span></li><li><span class="hljs-params">                blockedAppName: string</span></li><li><span class="hljs-params">            </span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">addresses</span> = [</li><li>                    <span class="hljs-keyword">new</span> <span class="hljs-title class_">AddressWithPrefix</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Address</span>(tunIp, <span class="hljs-number">1</span>), <span class="hljs-number">24</span>)</li><li>                ];</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">mtu</span> = <span class="hljs-number">1400</span>;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">dnsAddresses</span> = [<span class="hljs-string">"114.114.114.114"</span>];</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">trustedApplications</span> = [];</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">blockedApplications</span> = [blockedAppName];</li><li>            }</li><li>        }</li><li>
</li><li>        <span class="hljs-keyword">let</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">tunIp</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">blockedAppName</span>);</li><li>
</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>            vpnConnection.<span class="hljs-title function_">create</span>(config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'developTag'</span>, <span class="hljs-string">'tunfd: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data) ?? <span class="hljs-string">''</span>);</li><li>            })</li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'developTag'</span>, <span class="hljs-string">'VPN setUp fail: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error) ?? <span class="hljs-string">''</span>);</li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="protect" device-type="phone,2in1,tablet,wearable">protect<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="protect" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>protect(socketFd: number): Promise&lt;void&gt;</p>     <p>保护套接字不受VPN连接影响，通过该套接字发送的数据将直接基于物理网络收发，因此其流量不会通过VPN转发。使用Promise方式作为异步方法。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">socketFd</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">指定保护的 socketfd，该文件描述符通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-socket#getsocketfd10-1">getSocketFd</a>获取。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-net-vpn">VPN错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200001</td>         <td class="cellrowborder" width="50%">Invalid parameter value.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200002</td>         <td class="cellrowborder" width="50%">Operation failed. Cannot connect to service.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200003</td>         <td class="cellrowborder" width="50%">System internal error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2203004</td>         <td class="cellrowborder" width="50%">Invalid socket file descriptor.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> g_tunnelFd = -<span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: vpnExtension.<span class="hljs-property">VpnExtensionContext</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  private <span class="hljs-attr">vpnServerIp</span>: string = <span class="hljs-string">'192.168.31.13'</span>;</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want</span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"VPN createVpnConnection: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(vpnConnection));</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">CreateTunnel</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">Protect</span>();</li><li>  }</li><li>  <span class="hljs-title class_">CreateTunnel</span>() {</li><li>      g_tunnelFd = <span class="hljs-number">8888</span>;</li><li>  }</li><li>  <span class="hljs-title class_">Protect</span>() {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'developTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'VPN Protect'</span>);</li><li>        <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>        vpnConnection.<span class="hljs-title function_">protect</span>(g_tunnelFd).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'developTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'VPN Protect Success'</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err : <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'developTag'</span>, <span class="hljs-string">'VPN Protect Failed %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err) ?? <span class="hljs-string">''</span>);</li><li>        })</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="destroy" device-type="phone,2in1,tablet,wearable">destroy<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="destroy" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>destroy(): Promise&lt;void&gt;</p>     <p>销毁启动的VPN网络。使用Promise异步回调。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-net-vpn">VPN错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200002</td>         <td class="cellrowborder" width="50%">Operation failed. Cannot connect to service.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">2200003</td>         <td class="cellrowborder" width="50%">System internal error.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: vpnExtension.<span class="hljs-property">VpnExtensionContext</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want</span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection : vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"VPN createVpnConnection: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(vpnConnection));</li><li>    vpnConnection.<span class="hljs-title function_">destroy</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"destroy success."</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"destroy fail"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="destroy20" device-type="phone,2in1,tablet,wearable">destroy<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="destroy20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>destroy(vpnId: string): Promise&lt;void&gt;</p>     <p>根据vpnId销毁指定的VPN网络。使用Promise异步回调。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">vpnId</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">vpn唯一标识。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，无返回结果。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-net-vpn">VPN错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">19900001</td>         <td class="cellrowborder" width="50%">Invalid parameter value.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">19900002</td>         <td class="cellrowborder" width="50%">System internal error.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>
</li><li>    <span class="hljs-comment">// 可通过generateVpnId()获取vpnId</span></li><li>    <span class="hljs-keyword">let</span> vpnId = <span class="hljs-string">'testVpnId'</span>;</li><li>    vpnConnection.<span class="hljs-title function_">destroy</span>(vpnId).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"destroy success"</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`destroy fail, Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="generatevpnid20" device-type="phone,2in1,tablet,wearable">generateVpnId<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="generatevpnid20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>generateVpnId(): Promise&lt;string&gt;</p>     <p>生成VPN唯一标识。使用Promise异步回调。</p>     <p>如需使用系统多VPN能力，需调用该接口生成vpnId，配置到VpnConfig中。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;string&gt;</td>         <td class="cellrowborder" width="50%">以Promise形式返回获取结果，返回vpnId。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-net-vpn">VPN错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">19900001</td>         <td class="cellrowborder" width="50%">Invalid parameter value.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">19900002</td>         <td class="cellrowborder" width="50%">System internal error.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension, <span class="hljs-title class_">VpnExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyVpnExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">VpnExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> vpnConnection = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>    vpnConnection.<span class="hljs-title function_">generateVpnId</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (data) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"generateVpnId success, vpnId = "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>      }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`generateVpnId fail, Code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="vpnconfig" device-type="phone,2in1,tablet,wearable">VpnConfig<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="vpnconfig" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>三方VPN配置参数。</p>     <p><strong>系统能力</strong>：SystemCapability.Communication.NetManager.Vpn</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">addresses</td>         <td class="cellrowborder" width="20%">Array&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#linkaddress">LinkAddress</a>&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">VPN虚拟网卡的IP地址。最多支持64个IP地址。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">vpnId<sup>20+</sup></td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">VPN唯一标识。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">routes</td>         <td class="cellrowborder" width="20%">Array&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-net-connection#routeinfo">RouteInfo</a>&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">VPN虚拟网卡的路由信息（目前最多可配置1024条路由）。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">dnsAddresses</td>         <td class="cellrowborder" width="20%">Array&lt;string&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">DNS服务器地址信息。当配置DNS服务器地址后，VPN启动状态下被代理的应用上网时，使用配置的DNS服务器做DNS查询。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">searchDomains</td>         <td class="cellrowborder" width="20%">Array&lt;string&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">DNS的搜索域列表。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">mtu</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">最大传输单元MTU值（单位：字节）。取值范围：[576，1500]。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">isIPv4Accepted</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">是否支持IPV4。true表示支持，false表示不支持, 默认值为true。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">isIPv6Accepted</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">是否支持IPV6。true表示支持，false表示不支持, 默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">isInternal</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">是否支持内置VPN。true表示支持，false表示不支持, 默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">isBlocking</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">是否阻塞模式。true表示阻塞模式，false表示非阻塞模式, 默认值为false。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">trustedApplications</td>         <td class="cellrowborder" width="20%">Array&lt;string&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>受信任的应用信息列表，string类型表示的包名。当配置该列表后，仅该列表中的应用数据才能根据routes被VPN代理。</p>          <p><strong>注意</strong>：trustedApplications和blockedApplications列表不能同时配置。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">blockedApplications</td>         <td class="cellrowborder" width="20%">Array&lt;string&gt;</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>被阻止的应用信息列表，string类型表示的包名。当配置该列表后，该列表中的应用数据不会被VPN代理，其他应用可以根据routes配置被VPN代理。</p>          <p><strong>注意</strong>：trustedApplications和blockedApplications列表不能同时配置。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-kbr-c106="" class="highlight-div"><div _ngcontent-kbr-c106="" class="highlight-div-header"><div _ngcontent-kbr-c106="" class="highlight-div-header-left"><div _ngcontent-kbr-c106="" class="handle-button expand-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbr-c106="" class="highlight-div-header-right"><div _ngcontent-kbr-c106="" class="handle-button ai-button"></div><div _ngcontent-kbr-c106="" class="handle-button line-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbr-c106="" class="handle-button theme-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbr-c106="" class="handle-button copy-button"><div _ngcontent-kbr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbr-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { vpnExtension} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">vpnConfig</span>: vpnExtension.<span class="hljs-property">VpnConfig</span> = {</li><li>  <span class="hljs-attr">addresses</span>: [],</li><li>  <span class="hljs-attr">vpnId</span>: <span class="hljs-string">'123'</span>,</li><li>  <span class="hljs-attr">routes</span>: [{</li><li>    <span class="hljs-attr">interface</span>: <span class="hljs-string">"eth0"</span>,</li><li>    <span class="hljs-attr">destination</span>: {</li><li>      <span class="hljs-attr">address</span>: {</li><li>        <span class="hljs-attr">address</span>:<span class="hljs-string">''</span>,</li><li>        <span class="hljs-attr">family</span>:<span class="hljs-number">1</span>,</li><li>        <span class="hljs-attr">port</span>:<span class="hljs-number">8080</span></li><li>      },</li><li>      <span class="hljs-attr">prefixLength</span>:<span class="hljs-number">1</span></li><li>    },</li><li>    <span class="hljs-attr">gateway</span>: {</li><li>      <span class="hljs-attr">address</span>:<span class="hljs-string">''</span>,</li><li>      <span class="hljs-attr">family</span>:<span class="hljs-number">1</span>,</li><li>      <span class="hljs-attr">port</span>:<span class="hljs-number">8080</span></li><li>    },</li><li>    <span class="hljs-attr">hasGateway</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">isDefaultRoute</span>: <span class="hljs-literal">true</span>,</li><li>  }],</li><li>  <span class="hljs-attr">mtu</span>: <span class="hljs-number">1400</span>,</li><li>  <span class="hljs-attr">dnsAddresses</span>: [<span class="hljs-string">"223.5.5.5"</span>, <span class="hljs-string">"223.6.6.6"</span>],</li><li>  <span class="hljs-attr">trustedApplications</span>: [],</li><li>  <span class="hljs-attr">blockedApplications</span>: [],</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: vpnExtension.<span class="hljs-property">VpnExtensionContext</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">vpnCreate</span>(<span class="hljs-params"></span>){</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">vpnConnection</span>: vpnExtension.<span class="hljs-property">VpnConnection</span> = vpnExtension.<span class="hljs-title function_">createVpnConnection</span>(context);</li><li>  vpnConnection.<span class="hljs-title function_">create</span>(vpnConfig).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"VPN create "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  })</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>