<h1 _ngcontent-ppm-c119="" class="doc-title ng-star-inserted" title="@ohos.test.PerfTest"> @ohos.test.PerfTest </h1>

<div _ngcontent-ppm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>PerfTest提供白盒性能测试能力，供开发者在测试场景使用，支持对指定代码段或指定场景的性能数据测试，支持自动化执行测试代码段，并采集耗时、CPU、内存、时延、帧率等性能数据。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ul><li>本模块首批接口从API version 20开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</li><li>本模块接口在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/unittest-guidelines" target="_blank">单元测试框架</a>中使用。</li><li>本模块接口不支持并发调用。</li><li>本模块接口适用于手机、平板、PC/2in1、智慧屏、车机。</li></ul>  </div></div></div>  <div class="tiledSection"><h2 id="导入模块" device-type="phone,2in1,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-ppm-c106="" class="highlight-div"><div _ngcontent-ppm-c106="" class="highlight-div-header"><div _ngcontent-ppm-c106="" class="highlight-div-header-left"><div _ngcontent-ppm-c106="" class="handle-button expand-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ppm-c106="" class="highlight-div-header-right"><div _ngcontent-ppm-c106="" class="handle-button ai-button"></div><div _ngcontent-ppm-c106="" class="handle-button line-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ppm-c106="" class="handle-button theme-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ppm-c106="" class="handle-button copy-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ppm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span>, <span class="hljs-title class_">PerfMeasureResult</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="perfmetric" device-type="phone,2in1,tablet">PerfMetric<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="perfmetric" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>框架支持采集的性能指标。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.1" width="33.33333333333333%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.2" width="33.33333333333333%">值</th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.3" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%">DURATION</td> <td class="cellrowborder" width="33.33333333333333%">0</td> <td class="cellrowborder" width="33.33333333333333%">代码段执行耗时，单位：ms。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">CPU_LOAD</td> <td class="cellrowborder" width="33.33333333333333%">1</td> <td class="cellrowborder" width="33.33333333333333%">应用进程CPU负载，取值为百分比。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">CPU_USAGE</td> <td class="cellrowborder" width="33.33333333333333%">2</td> <td class="cellrowborder" width="33.33333333333333%">应用进程CPU使用率，取值为百分比。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">MEMORY_RSS</td> <td class="cellrowborder" width="33.33333333333333%">3</td> <td class="cellrowborder" width="33.33333333333333%">代码段单次执行结束时，应用进程占用物理内存（含共享库），单位：KB。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">MEMORY_PSS</td> <td class="cellrowborder" width="33.33333333333333%">4</td> <td class="cellrowborder" width="33.33333333333333%">代码段单次执行结束时，应用进程占用物理内存（不含共享库），单位：KB。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">APP_START_RESPONSE_TIME</td> <td class="cellrowborder" width="33.33333333333333%">5</td> <td class="cellrowborder" width="33.33333333333333%">应用启动的响应时延，单位：ms。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">APP_START_COMPLETE_TIME</td> <td class="cellrowborder" width="33.33333333333333%">6</td> <td class="cellrowborder" width="33.33333333333333%">应用启动的完成时延，单位：ms。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">PAGE_SWITCH_COMPLETE_TIME</td> <td class="cellrowborder" width="33.33333333333333%">7</td> <td class="cellrowborder" width="33.33333333333333%">应用内页面切换的完成时延，单位：ms。</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">LIST_SWIPE_FPS</td> <td class="cellrowborder" width="33.33333333333333%">8</td> <td class="cellrowborder" width="33.33333333333333%">应用内列表滑动的帧率，单位：fps。</td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ol><li>以上指标均用于采集指定应用进程的性能数据，非系统整机性能数据。</li><li>CPU（CPU_LOAD/CPU_USAGE）、内存（MEMORY_RSS/MEMORY_PSS）数据采集说明如下：</li></ol>  <ul><li>测试过程中，代码段执行开始前和代码段执行结束后，会分别采集指定应用进程的CPU和内存数据，因此测试过程中需要保证被测应用进程一直存在。</li></ul>  <ol><li>应用启动时延（APP_START_RESPONSE_TIME/APP_START_COMPLETE_TIME）数据采集说明如下：</li></ol>  <ul><li>应用启动时延数据受系统打点上报限制，开始时间为点击事件上报时间点，响应时延结束时间为点击后系统响应首帧的上屏时间点（首帧显示在屏幕上的时间点），完成时延结束时间为应用启动后的首帧上屏时间点，与端到端用户感知时延存在差异。</li><li>应用启动时延数据采集支持的场景：桌面点击应用图标启动、Dock栏点击应用图标启动、应用中心点击应用图标启动。</li><li>单次测试期间，仅第一次指定应用启动的时延数据会被采集。</li></ul>  <ol><li>页面切换时延（PAGE_SWITCH_COMPLETE_TIME）数据采集说明如下：</li></ol>  <ul><li>页面切换时延计算受系统打点上报限制，开始时间为点击事件上报时间点，完成时延结束时间为页面切换后的首帧上屏时间点，与端到端用户感知时延存在差异。</li><li>页面切换时延数据采集支持的场景：Router、Navigation控件内的页面切换。</li><li>单次测试期间，仅指定应用内第一次页面切换的时延数据会被采集。</li></ul>  <ol><li>列表滑动帧率（LIST_SWIPE_FPS）数据采集说明如下：</li></ol>  <ul><li>列表滑动帧率：指的是在列表滑动时，屏幕每秒钟渲染更新帧的次数。</li><li>列表滑动帧率数据采集支持的场景：ArkUI子系统List、Grid、scroll、waterflow滚动控件列表的滑动。</li><li>单次测试期间，仅指定应用内第一次列表滑动的帧率数据会被采集。</li></ul>  </div></div></div> </div>  <div class="tiledSection"><h2 id="perfteststrategy" device-type="phone,2in1,tablet">PerfTestStrategy<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="perfteststrategy" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>性能测试执行策略。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="20%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="20%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="20%">只读</th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="20%">可选</th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="20%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="20%">metrics</td> <td class="cellrowborder" width="20%">Array&lt;<a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmetric">PerfMetric</a>&gt;</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">被测性能指标列表。</td> </tr> <tr><td class="cellrowborder" width="20%">actionCode</td> <td class="cellrowborder" width="20%">Callback&lt;Callback&lt;boolean&gt;&gt;</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">测试代码段。</td> </tr> <tr><td class="cellrowborder" width="20%">resetCode</td> <td class="cellrowborder" width="20%">Callback&lt;Callback&lt;boolean&gt;&gt;</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">测试结束环境重置代码段。默认为空，框架运行时不执行此代码段。</td> </tr> <tr><td class="cellrowborder" width="20%">bundleName</td> <td class="cellrowborder" width="20%">string</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">被测应用包名。默认为""，框架运行时测试当前测试应用的性能数据。</td> </tr> <tr><td class="cellrowborder" width="20%">iterations</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">测试迭代执行次数，默认值为5。</td> </tr> <tr><td class="cellrowborder" width="20%">timeout</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">单次代码段（actionCode/resetCode）执行的超时时间，默认值为10000ms。</td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>属性actionCode和resetCode的入参类型为回调函数"Callback&lt;boolean&gt;"。在代码段中需要主动调用此回调函数，通知框架代码段执行完成，否则会导致代码段执行超时。</p> <p>其中，回调函数的参数为boolean类型，true代表代码段执行符合预期，false代码段执行不符合预期。<a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#create">代码示例</a>。</p>  </div></div></div> </div>  <div class="tiledSection"><h2 id="perfmeasureresult" device-type="phone,2in1,tablet">PerfMeasureResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="perfmeasureresult" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>性能指标对应测量结果数据。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.1" width="20%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.2" width="20%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.3" width="20%">只读</th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.4" width="20%">可选</th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.5" width="20%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="20%">metric</td> <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmetric">PerfMetric</a></td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">被测性能指标。</td> </tr> <tr><td class="cellrowborder" width="20%">roundValues</td> <td class="cellrowborder" width="20%">Array&lt;number&gt;</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">被测性能指标的各轮测量数据值。当数据采集失败时返回-1。</td> </tr> <tr><td class="cellrowborder" width="20%">maximum</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">各轮测量数据最大值（剔除为-1的数据后计算）。</td> </tr> <tr><td class="cellrowborder" width="20%">minimum</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">各轮测量数据最小值（剔除为-1的数据后计算）。</td> </tr> <tr><td class="cellrowborder" width="20%">average</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">各轮测量数据平均值（剔除为-1的数据后计算）。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="perftest" device-type="phone,2in1,tablet">PerfTest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="perftest" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>PerfTest类为白盒性能测试框架的总入口，提供测试任务创建、测试代码段执行和数据采集、测量结果获取等能力。</p> </div>  <div class="tiledSection"><h3 id="create" device-type="phone,2in1,tablet" class="firsth2">create<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="create" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>static create(strategy: PerfTestStrategy): PerfTest</p> <p>静态方法，构造一个PerfTest对象，并返回该对象。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">strategy</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfteststrategy">PerfTestStrategy</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">性能测试执行策略。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perftest">PerfTest</a></td> <td class="cellrowborder" width="50%">返回构造的PerfTest对象。</td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-perftest">perftest错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.12.1.3.1.1" width="50%">错误码ID</th> <th align="left" class="cellrowborder" id="mcps1.3.8.12.1.3.1.2" width="50%">错误信息</th> </tr><tr><td class="cellrowborder" width="50%">32400001</td> <td class="cellrowborder" width="50%">Initialization failed.</td> </tr> <tr><td class="cellrowborder" width="50%">32400002</td> <td class="cellrowborder" width="50%">Internal error. Possible causes: 1. IPC connection failed. 2. The object does not exist.</td> </tr> <tr><td class="cellrowborder" width="50%">32400003</td> <td class="cellrowborder" width="50%">Parameter verification failed.</td> </tr> <tr><td class="cellrowborder" width="50%">32400007</td> <td class="cellrowborder" width="50%">The API does not support concurrent calls.</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ppm-c106="" class="highlight-div"><div _ngcontent-ppm-c106="" class="highlight-div-header"><div _ngcontent-ppm-c106="" class="highlight-div-header-left"><div _ngcontent-ppm-c106="" class="handle-button expand-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ppm-c106="" class="highlight-div-header-right"><div _ngcontent-ppm-c106="" class="handle-button ai-button"></div><div _ngcontent-ppm-c106="" class="handle-button line-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ppm-c106="" class="handle-button theme-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ppm-c106="" class="handle-button copy-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ppm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>];</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">actionCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; { <span class="hljs-comment">// 定义测试代码段，入参类型'Callback&lt;boolean&gt;'，命名为finish</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) {</li><li>      num++;</li><li>    }</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 调用finish回调函数，通知代码段执行结束，且执行符合预期</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">resetCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; { <span class="hljs-comment">// 定义测试结束环境重置代码段</span></li><li>    num = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {</li><li>    <span class="hljs-attr">metrics</span>: metrics,</li><li>    <span class="hljs-attr">actionCode</span>: actionCode,</li><li>    <span class="hljs-attr">resetCode</span>: resetCode,</li><li>    <span class="hljs-attr">timeout</span>: <span class="hljs-number">30000</span>,</li><li>    <span class="hljs-attr">iterations</span>: <span class="hljs-number">10</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy); <span class="hljs-comment">// 构造一个PerfTest对象，创建测试任务</span></li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="run" device-type="phone,2in1,tablet">run<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="run" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>run(): Promise&lt;void&gt;</p> <p>运行性能测试，迭代执行测试代码段并采集性能数据，使用Promise回调。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.9.7.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">Promise&lt;void&gt;</td> <td class="cellrowborder" width="50%">Promise对象。无返回结果的Promise对象。</td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-perftest">perftest错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.9.10.1.3.1.1" width="50%">错误码ID</th> <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.3.1.2" width="50%">错误信息</th> </tr><tr><td class="cellrowborder" width="50%">32400002</td> <td class="cellrowborder" width="50%">Internal error. Possible causes: 1. IPC connection failed. 2. The object does not exist.</td> </tr> <tr><td class="cellrowborder" width="50%">32400004</td> <td class="cellrowborder" width="50%">Failed to execute the callback. Possible causes: 1. An exception is thrown in the callback. 2. Callback execution timed out.</td> </tr> <tr><td class="cellrowborder" width="50%">32400005</td> <td class="cellrowborder" width="50%">Failed to collect metric data.</td> </tr> <tr><td class="cellrowborder" width="50%">32400007</td> <td class="cellrowborder" width="50%">The API does not support concurrent calls.</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ppm-c106="" class="highlight-div"><div _ngcontent-ppm-c106="" class="highlight-div-header"><div _ngcontent-ppm-c106="" class="highlight-div-header-left"><div _ngcontent-ppm-c106="" class="handle-button expand-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ppm-c106="" class="highlight-div-header-right"><div _ngcontent-ppm-c106="" class="handle-button ai-button"></div><div _ngcontent-ppm-c106="" class="handle-button line-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ppm-c106="" class="handle-button theme-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ppm-c106="" class="handle-button copy-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ppm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>];</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">actionCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) {</li><li>      num++;</li><li>    }</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {</li><li>    <span class="hljs-attr">metrics</span>: metrics,</li><li>    <span class="hljs-attr">actionCode</span>: actionCode</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy);</li><li>  <span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>(); <span class="hljs-comment">// 运行性能测试</span></li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="getmeasureresult" device-type="phone,2in1,tablet">getMeasureResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getmeasureresult" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getMeasureResult(metric: PerfMetric): PerfMeasureResult</p> <p>获取指定性能指标的测量数据。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">metric</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmetric">PerfMetric</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">性能指标。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-perftest#perfmeasureresult">PerfMeasureResult</a></td> <td class="cellrowborder" width="50%">性能指标对应测量结果数据。</td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-perftest">perftest错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.12.1.3.1.1" width="50%">错误码ID</th> <th align="left" class="cellrowborder" id="mcps1.3.10.12.1.3.1.2" width="50%">错误信息</th> </tr><tr><td class="cellrowborder" width="50%">32400002</td> <td class="cellrowborder" width="50%">Internal error. Possible causes: 1. IPC connection failed. 2. The object does not exist.</td> </tr> <tr><td class="cellrowborder" width="50%">32400003</td> <td class="cellrowborder" width="50%">Parameter verification failed.</td> </tr> <tr><td class="cellrowborder" width="50%">32400006</td> <td class="cellrowborder" width="50%">Failed to obtain the measurement result.</td> </tr> <tr><td class="cellrowborder" width="50%">32400007</td> <td class="cellrowborder" width="50%">The API does not support concurrent calls.</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ppm-c106="" class="highlight-div"><div _ngcontent-ppm-c106="" class="highlight-div-header"><div _ngcontent-ppm-c106="" class="highlight-div-header-left"><div _ngcontent-ppm-c106="" class="handle-button expand-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ppm-c106="" class="highlight-div-header-right"><div _ngcontent-ppm-c106="" class="handle-button ai-button"></div><div _ngcontent-ppm-c106="" class="handle-button line-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ppm-c106="" class="handle-button theme-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ppm-c106="" class="handle-button copy-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ppm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>];</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">actionCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) {</li><li>      num++;</li><li>    }</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {</li><li>    <span class="hljs-attr">metrics</span>: metrics,</li><li>    <span class="hljs-attr">actionCode</span>: actionCode</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy);</li><li>  <span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>();</li><li>  <span class="hljs-keyword">let</span> res = perfTest.<span class="hljs-title function_">getMeasureResult</span>(<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>); <span class="hljs-comment">// 获取指定性能指标的测量数据</span></li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="destroy" device-type="phone,2in1,tablet">destroy<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="destroy" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>destroy(): void</p> <p>销毁PerfTest对象。</p> <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong>：SystemCapability.Test.PerfTest</p> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-perftest">perftest错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.1" width="50%">错误码ID</th> <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.2" width="50%">错误信息</th> </tr><tr><td class="cellrowborder" width="50%">32400002</td> <td class="cellrowborder" width="50%">Internal error. Possible causes: 1. IPC connection failed. 2. The object does not exist.</td> </tr> <tr><td class="cellrowborder" width="50%">32400007</td> <td class="cellrowborder" width="50%">The API does not support concurrent calls.</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ppm-c106="" class="highlight-div"><div _ngcontent-ppm-c106="" class="highlight-div-header"><div _ngcontent-ppm-c106="" class="highlight-div-header-left"><div _ngcontent-ppm-c106="" class="handle-button expand-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ppm-c106="" class="highlight-div-header-right"><div _ngcontent-ppm-c106="" class="handle-button ai-button"></div><div _ngcontent-ppm-c106="" class="handle-button line-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ppm-c106="" class="handle-button theme-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ppm-c106="" class="handle-button copy-button"><div _ngcontent-ppm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ppm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PerfMetric</span>, <span class="hljs-title class_">PerfTest</span>, <span class="hljs-title class_">PerfTestStrategy</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.TestKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">demo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metrics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">PerfMetric</span>&gt; = [<span class="hljs-title class_">PerfMetric</span>.<span class="hljs-property">DURATION</span>];</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">actionCode</span> = <span class="hljs-keyword">async</span> (<span class="hljs-params">finish: Callback&lt;<span class="hljs-built_in">boolean</span>&gt;</span>) =&gt; {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; <span class="hljs-number">10000</span>; index++) {</li><li>      num++;</li><li>    }</li><li>    <span class="hljs-title function_">finish</span>(<span class="hljs-literal">true</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTestStrategy</span>: <span class="hljs-title class_">PerfTestStrategy</span> = {</li><li>    <span class="hljs-attr">metrics</span>: metrics,</li><li>    <span class="hljs-attr">actionCode</span>: actionCode</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">perfTest</span>: <span class="hljs-title class_">PerfTest</span> = <span class="hljs-title class_">PerfTest</span>.<span class="hljs-title function_">create</span>(perfTestStrategy);</li><li>  <span class="hljs-keyword">await</span> perfTest.<span class="hljs-title function_">run</span>();</li><li>  perfTest.<span class="hljs-title function_">destroy</span>(); <span class="hljs-comment">// 销毁PerfTest对象</span></li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>