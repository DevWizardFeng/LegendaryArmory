<h1 _ngcontent-efc-c119="" class="doc-title ng-star-inserted" title="@ohos.worker (启动一个Worker)"> @ohos.worker (启动一个Worker) </h1>

<div _ngcontent-efc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted renderOptimization" style="position: relative;">   <div>    <p>Worker是与主线程并行的独立线程。创建Worker的线程称为宿主线程，Worker自身的线程称为Worker线程。创建Worker时传入的URL文件在Worker线程中执行，可以处理耗时操作，但不能直接操作UI。</p>    <p>Worker的主要作用是为应用程序提供多线程运行环境，使应用程序在执行过程中与宿主线程分离，在后台线程中运行脚本处理耗时操作，避免计算密集型或高延迟任务阻塞宿主线程。由于Worker一旦创建不会主动销毁，若不处于任务状态会一直运行，造成资源浪费，应及时销毁空闲的Worker。</p>    <p>Worker的上下文环境和UI线程的上下文环境是独立的，Worker线程不支持UI操作。</p>    <p>请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#worker注意事项" target="_blank">Worker注意事项</a>，了解Worker使用过程中的相关注意点。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 7开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>     </div></div></div>    <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 247px;">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 618px;">     <h2 id="属性" device-type="phone,2in1,tablet,wearable,tv">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">workerPort<sup>9+</sup></td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerglobalscope9">ThreadWorkerGlobalScope</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>Worker线程用于与宿主线程通信的对象。</p>          <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">parentPort<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#dedicatedworkerglobalscopedeprecated">DedicatedWorkerGlobalScope</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>Worker线程用于与宿主线程通信的对象。</p>          <p>此属性从API version 7开始支持，从API version 9开始被废弃。</p>          <p>建议使用workerPort<sup>9+</sup>替代。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 1044px;">     <h2 id="workeroptions" device-type="phone,2in1,tablet,wearable,tv">WorkerOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="workeroptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker构造函数的选项，用于为Worker添加其他信息。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">type</td>         <td class="cellrowborder" width="20%">'classic' | 'module'</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>Worker执行脚本的模式类型，暂不支持module类型，默认值为"classic"。</p>          <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">name</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>Worker的名称，默认值为undefined。</p>          <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">shared</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>表示Worker共享功能，此接口暂不支持。</p>          <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">priority<sup>18+</sup></td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerpriority18">ThreadWorkerPriority</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>表示Worker线程优先级。默认值为MEDIUM。</p>          <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection scroll-inwindow" style="contain-intrinsic-size: auto 1134px;">     <h2 id="threadworkerpriority18" device-type="phone,2in1,tablet,wearable,tv">ThreadWorkerPriority<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="threadworkerpriority18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker线程的优先级枚举，各优先级对应关系请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/qos-guidelines#qos等级定义" target="_blank">QoS等级定义</a>。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.4.1.4.1.1" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.4.1.4.1.2" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.4.1.4.1.3" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="33.33333333333333%">HIGH</td>         <td class="cellrowborder" width="33.33333333333333%">0</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>适用于打开文档等用户触发并且可以看到进展的任务，任务在几秒钟之内完成。对应QOS_USER_INITIATED。</p>          <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">MEDIUM</td>         <td class="cellrowborder" width="33.33333333333333%">1</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>任务完成需要几秒钟。是<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerpriority18">ThreadWorkerPriority</a>的默认值。对应QOS_DEFAULT。</p>          <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">LOW</td>         <td class="cellrowborder" width="33.33333333333333%">2</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>适用于下载等不需要立即看到响应效果的任务，任务完成需要几秒到几分钟。对应QOS_UTILITY。</p>          <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">IDLE</td>         <td class="cellrowborder" width="33.33333333333333%">3</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>适用于数据同步等用户不可见的后台任务，任务完成需要几分钟甚至几小时。对应QOS_BACKGROUND。</p>          <p><strong>元服务API</strong>：从API version 18开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">DEADLINE<sup>20+</sup></td>         <td class="cellrowborder" width="33.33333333333333%">4</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>适用于页面加载等越快越好的关键任务，任务几乎是瞬间完成的。对应QOS_DEADLINE_REQUEST。</p>          <p><strong>元服务API</strong>：从API version 20开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">VIP<sup>20+</sup></td>         <td class="cellrowborder" width="33.33333333333333%">5</td>         <td class="cellrowborder" width="33.33333333333333%">          <p>适用于UI线程、动画渲染等用户交互任务，任务是即时的。对应QOS_USER_INTERACTIVE。</p>          <p><strong>元服务API</strong>：从API version 20开始，该接口支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 182px;">     <h2 id="threadworker9" device-type="phone,2in1,tablet,wearable,tv">ThreadWorker<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="threadworker9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>使用以下方法前，需先构造ThreadWorker实例。ThreadWorker类继承自<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventtarget9">WorkerEventTarget</a>。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2073px;">     <h3 id="属性-1" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">onexit<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(code: number) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示Worker线程销毁时被调用的事件处理程序，该处理程序在宿主线程中执行。回调函数的code参数类型为number，异常退出时code为1，正常退出时code为0。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onerror<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(err: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数，用于处理onmessage回调函数中同步代码产生的异常，处理程序在宿主线程中执行。回调函数的err类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>，表示收到的异常数据。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onAllErrors<sup>18+</sup></td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorcallback18">ErrorCallback</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示Worker线程生命周期内发生异常被调用的事件处理程序，处理程序在宿主线程中执行。</p>          <p><strong>元服务API</strong>：从API version 18开始，该属性支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessage<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(event: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示宿主线程接收到来自其创建的Worker通过workerPort.<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-3">postMessage</a>或workerPort.<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessagewithsharedsendable12-1">postMessageWithSharedSendable</a>接口发送的消息时被调用的事件处理程序，处理程序在宿主线程中执行。其中回调函数中event类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>，表示收到的Worker线程发送的消息数据。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessageerror<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(event: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。用于处理Worker对象接收到的无法被序列化的消息。该处理程序在宿主线程中执行，event类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>，表示收到的Worker消息数据。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>     <p>请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#onallerrors接口与onerror接口之间的行为差异" target="_blank">onAllErrors接口与onerror接口之间的行为差异</a>以了解onerror与onAllErrors的差异。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1268px;">     <h3 id="constructor9" device-type="phone,2in1,tablet,wearable,tv">constructor<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(scriptURL: string, options?: WorkerOptions)</p>     <p>ThreadWorker构造函数。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">scriptURL</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>Worker线程文件的路径。</p>          <p>路径规则详细参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#文件路径注意事项" target="_blank">文件路径注意事项</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workeroptions">WorkerOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">Worker构造的选项。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200003</td>         <td class="cellrowborder" width="50%">Worker initialization failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200007</td>         <td class="cellrowborder" width="50%">The worker file path is invalid.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>以下示例展示了在Stage模型的entry模块Index.ets文件中加载Worker文件的方法，使用Library加载Worker线程文件的场景参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#文件路径注意事项" target="_blank">文件路径注意事项</a>。</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// worker文件所在路径："entry/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/worker.ets'</span>, {<span class="hljs-attr">name</span>: <span class="hljs-string">"WorkerThread"</span>});</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2912px;">     <h3 id="postmessage9" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessage9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(message: Object, transfer: ArrayBuffer[]): void</p>     <p>宿主线程通过转移对象所有权的方式向Worker线程发送消息。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至Worker的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示可转移的ArrayBuffer实例对象数组，该数组中对象的所有权会被转移到Worker线程，在宿主线程中将会变为不可用，仅在Worker线程中可用，数组不可传入null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建worker线程中与宿主线程通信的对象</span></li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li><span class="hljs-comment">// worker线程接收宿主线程信息</span></li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// data：宿主线程发送的信息</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span> = e.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-comment">// 往收到的buffer里写入数据</span></li><li>  <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(data).<span class="hljs-title function_">fill</span>(<span class="hljs-number">3</span>);</li><li>  <span class="hljs-comment">// worker线程向宿主线程发送信息</span></li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(view);</li><li>}</li><li>
</li><li><span class="hljs-comment">// worker线程发生error的回调</span></li><li>workerPort.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker.ets onerror"</span> + err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 宿主线程中创建Worker对象</span></li><li>            <span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/Worker.ets"</span>);</li><li>            <span class="hljs-comment">// 宿主线程向worker线程传递信息</span></li><li>            <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>            workerInstance.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li><li>
</li><li>            <span class="hljs-comment">// 此时buffer的所有权转移到了worker线程，在宿主线程中不可用</span></li><li>            <span class="hljs-comment">// const view = new Int8Array(buffer).fill(3);</span></li><li>
</li><li>            <span class="hljs-comment">// 宿主线程接收worker线程信息</span></li><li>            workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>              <span class="hljs-comment">// data：worker线程发送的信息</span></li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Int8Array</span> = e.<span class="hljs-property">data</span>;</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread data is  "</span> + data);</li><li>              <span class="hljs-comment">// 销毁Worker对象</span></li><li>              workerInstance.<span class="hljs-title function_">terminate</span>();</li><li>            }</li><li>            <span class="hljs-comment">// 在调用terminate后，执行onexit</span></li><li>            workerInstance.<span class="hljs-property">onexit</span> = <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread terminate"</span>);</li><li>            }</li><li>            <span class="hljs-comment">// 监听Worker错误</span></li><li>            workerInstance.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"main error message "</span> + err.<span class="hljs-property">message</span>);</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1628px;">     <h3 id="postmessage9-1" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessage9-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(message: Object, options?: PostMessageOptions): void</p>     <p>宿主线程可以通过转移对象所有权或拷贝数据的方式向Worker线程发送消息。在传递<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">Sendable对象</a>时，使用拷贝数据的方式。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至Worker的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessageoptions">PostMessageOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>当填入该参数时，传输的数据将通过所有权转移的方式发送到Worker线程。这些数据在宿主线程中将变为不可用，仅在Worker线程中可用。</p>          <p>若不填入该参数，默认设置为 undefined，数据将通过拷贝的方式传输到Worker线程。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>
</li><li><span class="hljs-comment">// 填入options参数，buffer的所有权会转移到Worker线程，在宿主线程中将不可用</span></li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li><li>
</li><li><span class="hljs-comment">// 未填入options参数，默认值为undefined，通过拷贝数据的方式将buffer发送到Worker线程</span></li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(buffer);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2228px;">     <h3 id="postmessagewithsharedsendable12" device-type="phone,2in1,tablet,wearable,tv">postMessageWithSharedSendable<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagewithsharedsendable12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessageWithSharedSendable(message: Object, transfer?: ArrayBuffer[]): void</p>     <p>宿主线程向Worker线程发送消息，消息中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">Sendable对象</a>通过引用传递，非Sendable对象通过拷贝数据的方式传递。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至Worker的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">序列化类型说明</a>。如果需要共享数据，支持类型见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable#sendable支持的数据类型" target="_blank">Sendable支持的数据类型</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">可转移的ArrayBuffer实例对象数组。该数组中对象的所有权将转移到Worker线程，在宿主线程中变为不可用，仅在Worker线程中可用，数组不可传入null。默认值为空数组。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-comment">// 新建SendableObject实例并通过宿主线程传递至Worker线程</span></li><li>
</li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SendableObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./sendable'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/Worker.ets"</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">object</span>: <span class="hljs-title class_">SendableObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendableObject</span>();</li><li>workerInstance.<span class="hljs-title function_">postMessageWithSharedSendable</span>(<span class="hljs-built_in">object</span>);</li><li>
</li><li><span class="hljs-comment">// 使用postMessage接口传递Sendable对象，使用拷贝数据的方式传递</span></li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-built_in">object</span>);</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// sendable.ets</span></li><li><span class="hljs-comment">// 定义SendableObject</span></li><li>
</li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendableObject</span> {</li><li>  <span class="hljs-attr">a</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">45</span>;</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker文件路径为：entry/src/main/ets/workers/Worker.ets</span></li><li><span class="hljs-comment">// Worker.ets</span></li><li><span class="hljs-comment">// 接收宿主线程传递至Worker线程的数据并访问</span></li><li>
</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SendableObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/sendable'</span>;</li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">SendableObject</span> = e.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"sendable obj is: "</span> + obj.<span class="hljs-property">a</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1316px;">     <h3 id="on9" device-type="phone,2in1,tablet,wearable,tv">on<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="on9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: string, listener: WorkerEventListener): void</p>     <p>向宿主线程的Worker实例对象添加一个事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#addeventlistener9">addEventListener<sup>9+</sup></a>接口功能一致。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.16.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The invoked API is not supported in workers.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li><span class="hljs-comment">// 使用on添加的事件监听可以多次执行</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1340px;">     <h3 id="once9" device-type="phone,2in1,tablet,wearable,tv">once<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="once9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>once(type: string, listener: WorkerEventListener): void</p>     <p>向宿主线程的Worker实例对象添加一个事件监听，该事件监听只执行一次，执行完后会自动删除。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The invoked API is not supported in workers.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">once</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li><span class="hljs-comment">// 使用once添加的事件监听在执行一次后自动删除，无法多次执行</span></li><li><span class="hljs-comment">// workerInstance.dispatchEvent({type: "alert", timeStamp: 0}); // timeStamp暂未支持</span></li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1652px;">     <h3 id="off9" device-type="phone,2in1,tablet,wearable,tv">off<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="off9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: string, listener?: WorkerEventListener): void</p>     <p>移除宿主线程的Worker实例对象中类型为type的事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#removeeventlistener9">removeEventListener<sup>9+</sup></a>接口功能一致。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要删除的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">需要删除的特定监听器回调函数。如果未传入此参数，则会删除该类型的所有监听器。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The invoked API is not supported in workers.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">handler1</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Handler 1"</span>);</li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">handler2</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Handler 2"</span>);</li><li>
</li><li><span class="hljs-comment">// 注册两个监听器</span></li><li>workerInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">"alert"</span>, handler1);</li><li>workerInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">"alert"</span>, handler2);</li><li>
</li><li><span class="hljs-comment">// 首次触发：两个监听器都会执行</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li><span class="hljs-comment">// 删除 handler1 监听器</span></li><li>workerInstance.<span class="hljs-title function_">off</span>(<span class="hljs-string">"alert"</span>, handler1);</li><li>
</li><li><span class="hljs-comment">// 再次触发：只剩 handler2 会执行</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li><span class="hljs-comment">// 删除"alert"类型所有监听器</span></li><li>workerInstance.<span class="hljs-title function_">off</span>(<span class="hljs-string">"alert"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2113px;">     <h3 id="registerglobalcallobject11" device-type="phone,2in1,tablet,wearable,tv">registerGlobalCallObject<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="registerglobalcallobject11" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>registerGlobalCallObject(instanceName: string, globalCallObject: Object): void</p>     <p>在宿主线程的ThreadWorker实例上注册一个对象，该对象的方法可在Worker线程中调用。详情请参见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#callglobalcallobjectmethod11">callGlobalCallObjectMethod</a>。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">instanceName</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">注册对象时使用的键，调用时通过该键值找到被注册的对象。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">globalCallObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">被注册的对象，ThreadWorker实例会持有被注册对象的强引用。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.19.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestObj</span> {</li><li>  <span class="hljs-keyword">private</span> message : <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a message from TestObj"</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessage</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>;</li><li>  }</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessageWithInput</span>(str : <span class="hljs-built_in">string</span>) : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">" with input: "</span> + str;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> registerObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObj</span>();</li><li><span class="hljs-comment">// 在ThreadWorker实例上注册registerObj</span></li><li>workerInstance.<span class="hljs-title function_">registerGlobalCallObject</span>(<span class="hljs-string">"myObj"</span>, registerObj);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"start worker"</span>);</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用方法无入参</span></li><li>    <span class="hljs-keyword">let</span> res : <span class="hljs-built_in">string</span> = workerPort.<span class="hljs-title function_">callGlobalCallObjectMethod</span>(<span class="hljs-string">"myObj"</span>, <span class="hljs-string">"getMessage"</span>, <span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker:"</span>, res) <span class="hljs-comment">// worker: this is a message from TestObj</span></li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker: error code is "</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">" error message is "</span> + error.<span class="hljs-property">message</span>);</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用方法有入参</span></li><li>    <span class="hljs-keyword">let</span> res : <span class="hljs-built_in">string</span> = workerPort.<span class="hljs-title function_">callGlobalCallObjectMethod</span>(<span class="hljs-string">"myObj"</span>, <span class="hljs-string">"getMessageWithInput"</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"hello there!"</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker:"</span>, res); <span class="hljs-comment">//worker: this is a message from TestObj with input: hello there!</span></li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker: error code is "</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">" error message is "</span> + error.<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1504px;">     <h3 id="unregisterglobalcallobject11" device-type="phone,2in1,tablet,wearable,tv">unregisterGlobalCallObject<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="unregisterglobalcallobject11" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>unregisterGlobalCallObject(instanceName?: string): void</p>     <p>取消在宿主线程ThreadWorker实例上注册的对象，该方法会释放ThreadWorker实例中与该键相匹配的对象的强引用。如果无匹配对象，该方法不会报错。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">instanceName</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">注册对象时使用的键。此参数不填时，会释放ThreadWorker实例中所有已注册的对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestObj</span> {</li><li>  <span class="hljs-keyword">private</span> message : <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a message from TestObj"</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessage</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>;</li><li>  }</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessageWithInput</span>(str : <span class="hljs-built_in">string</span>) : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">" with input: "</span> + str;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> registerObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObj</span>();</li><li>workerInstance.<span class="hljs-title function_">registerGlobalCallObject</span>(<span class="hljs-string">"myObj"</span>, registerObj);</li><li><span class="hljs-comment">// 取消对象注册</span></li><li>workerInstance.<span class="hljs-title function_">unregisterGlobalCallObject</span>(<span class="hljs-string">"myObj"</span>);</li><li><span class="hljs-comment">// 取消ThreadWorker实例上的所有对象注册</span></li><li><span class="hljs-comment">//workerInstance.unregisterGlobalCallObject();</span></li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"start worker"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 794px;">     <h3 id="terminate9" device-type="phone,2in1,tablet,wearable,tv">terminate<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="terminate9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>terminate(): void</p>     <p>销毁Worker线程并停止Worker线程接收消息。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">terminate</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1292px;">     <h3 id="addeventlistener9" device-type="phone,2in1,tablet,wearable,tv">addEventListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="addeventlistener9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>addEventListener(type: string, listener: WorkerEventListener): void</p>     <p>向宿主线程的Worker实例对象添加一个事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#on9">on<sup>9+</sup></a>接口功能一致。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The invoked API is not supported in workers.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li><span class="hljs-comment">// 执行 alert 事件类型的回调</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1285px;">     <h3 id="removeeventlistener9" device-type="phone,2in1,tablet,wearable,tv">removeEventListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removeeventlistener9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeEventListener(type: string, callback?: WorkerEventListener): void</p>     <p>移除宿主线程的Worker实例对象中类型为type的事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#off9">off<sup>9+</sup></a>接口功能一致。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要删除的监听事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">回调函数，删除监听事件后执行。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.23.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>workerInstance.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"alert"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1454px;">     <h3 id="dispatchevent9" device-type="phone,2in1,tablet,wearable,tv">dispatchEvent<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="dispatchevent9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>dispatchEvent(event: Event): boolean</p>     <p>在宿主线程将事件对象分发到Worker线程的事件系统，该系统会自动触发该类型事件对应的所有监听器回调。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.24.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要分发的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.24.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">分发的结果。true表示分发成功，false表示分发失败。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.24.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.24.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">Boolean</span> = workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"dispatchEvent result is: "</span>, result);</li></ol></pre></div></div>     <p>分发事件（dispatchEvent）可与监听接口（on、once、addEventListener）搭配使用，完整示例请参考<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#分发事件与监听接口搭配使用示例">分发事件与监听接口搭配使用示例</a>。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 866px;">     <h3 id="removealllistener9" device-type="phone,2in1,tablet,wearable,tv">removeAllListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removealllistener9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeAllListener(): void</p>     <p>移除宿主线程中Worker实例对象的所有事件监听。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.25.8.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.8.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>workerInstance.<span class="hljs-title function_">removeAllListener</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 182px;">     <h2 id="workereventtarget9" device-type="phone,2in1,tablet,wearable,tv">WorkerEventTarget<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="workereventtarget9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>用于管理Worker的监听事件。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1252px;">     <h3 id="addeventlistener9-1" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">addEventListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="addeventlistener9-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>addEventListener(type: string, listener: WorkerEventListener): void</p>     <p>向Worker线程的实例对象添加事件监听。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.27.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.27.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.27.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.27.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.27.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.27.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The called API is not supported in the worker thread.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>  })</li><li>};</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1285px;">     <h3 id="removeeventlistener9-1" device-type="phone,2in1,tablet,wearable,tv">removeEventListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removeeventlistener9-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeEventListener(type: string, callback?: WorkerEventListener): void</p>     <p>移除Worker线程实例对象中类型为type的事件监听。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要删除的监听事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">回调函数，删除监听事件后执行。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.28.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>  });</li><li>
</li><li>  workerPort.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"alert"</span>);</li><li>};</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1430px;">     <h3 id="dispatchevent9-1" device-type="phone,2in1,tablet,wearable,tv">dispatchEvent<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="dispatchevent9-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>dispatchEvent(event: Event): boolean</p>     <p>在Worker线程将事件对象分发到Worker线程的事件系统，并触发该类型事件的所有监听器回调。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要分发的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.29.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">分发的结果。true表示分发成功，false表示分发失败。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.29.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>  });</li><li>
</li><li>  workerPort.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>};</li></ol></pre></div></div>     <p>分发事件（dispatchEvent）可与监听接口（addEventListener）搭配使用，完整示例请参考<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#分发事件与监听接口搭配使用示例">分发事件与监听接口搭配使用示例</a>。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 962px;">     <h3 id="removealllistener9-1" device-type="phone,2in1,tablet,wearable,tv">removeAllListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removealllistener9-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeAllListener(): void</p>     <p>移除Worker线程的实例对象所有的事件监听。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.30.8.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.30.8.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>  });</li><li>
</li><li>  workerPort.<span class="hljs-title function_">removeAllListener</span>();</li><li>};</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 182px;">     <h2 id="threadworkerglobalscope9" device-type="phone,2in1,tablet,wearable,tv">ThreadWorkerGlobalScope<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="threadworkerglobalscope9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker线程用于与宿主线程通信的类。ThreadWorkerGlobalScope类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#globalscope9">GlobalScope</a>。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1194px;">     <h3 id="属性-2" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性-2" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.32.3.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.32.3.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.32.3.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.32.3.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.32.3.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">onmessage<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(this: ThreadWorkerGlobalScope, ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示Worker线程收到来自其宿主线程通过<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-1">postMessage</a>或<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessagewithsharedsendable12">postMessageWithSharedSendable</a>接口发送的消息时被调用的事件处理程序，处理程序在Worker线程中执行。其中this指调用者对象本身<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerglobalscope9">ThreadWorkerGlobalScope</a>，ev类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>，表示收到的宿主线程发送的消息数据。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessageerror<sup>9+</sup></td>         <td class="cellrowborder" width="20%">(this: ThreadWorkerGlobalScope, ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示当Worker线程的Worker对象接收到一条无法被反序列化的消息时被调用的事件处理程序，处理程序在Worker线程中执行。其中this指调用者对象本身<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerglobalscope9">ThreadWorkerGlobalScope</a>，ev类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageevents9">MessageEvents</a>，表示收到的消息数据。默认值为undefined。</p>          <p><strong>元服务API</strong>：从API version 11开始，该属性支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1688px;">     <h3 id="postmessage9-2" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessage9-2" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(messageObject: Object, transfer: ArrayBuffer[]): void;</p>     <p>Worker线程通过转移对象所有权的方式向宿主线程发送消息。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.33.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.33.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.33.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.33.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">messageObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示可转移的ArrayBuffer实例对象数组，该数组中对象的所有权会被转移到宿主线程，在Worker线程中将会变为不可用，仅在宿主线程中可用，数组不可传入null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.33.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.33.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive data from worker.ets"</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1784px;">     <h3 id="postmessage9-3" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessage9-3" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(messageObject: Object, options?: PostMessageOptions): void</p>     <p>Worker线程通过转移对象所有权或拷贝数据的方式向宿主线程发送消息。在传递<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">Sendable对象</a>时，使用拷贝数据的方式进行传递。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.34.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.34.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.34.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.34.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">messageObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessageoptions">PostMessageOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>当填入该参数时，其作用与传入ArrayBuffer[]相同，该数组中对象的所有权会被转移到宿主线程，在Worker线程中将变为不可用，仅在宿主线程中可用。</p>          <p>若不填入该参数，默认设置为 undefined，通过拷贝数据的方式传输信息到宿主线程。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.34.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.34.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive data from worker.ets"</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"receive data from main thread"</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2204px;">     <h3 id="postmessagewithsharedsendable12-1" device-type="phone,2in1,tablet,wearable,tv">postMessageWithSharedSendable<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagewithsharedsendable12-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessageWithSharedSendable(message: Object, transfer?: ArrayBuffer[]): void</p>     <p>Worker线程向宿主线程发送消息，消息中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">Sendable对象</a>通过引用传递，非Sendable对象通过拷贝数据的方式传递。</p>     <p><strong>元服务API</strong>：从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.35.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.35.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.35.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.35.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化或可共享，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">序列化类型说明</a>，共享支持类型见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable#sendable支持的数据类型" target="_blank">Sendable支持的数据类型</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">表示可转移的ArrayBuffer实例对象数组，该数组中对象的所有权会被转移到宿主线程，在Worker线程中将会变为不可用，仅在宿主线程中可用，数组不可传入null。默认值为空数组。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.35.10.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.35.10.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker文件路径为：entry/src/main/ets/workers/Worker.ets</span></li><li><span class="hljs-comment">// Worker.ets</span></li><li><span class="hljs-comment">// 新建SendableObject实例并通过Worker线程传递至宿主线程</span></li><li>
</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SendableObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/sendable'</span>;</li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">object</span>: <span class="hljs-title class_">SendableObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SendableObject</span>();</li><li>  workerPort.<span class="hljs-title function_">postMessageWithSharedSendable</span>(<span class="hljs-built_in">object</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// sendable.ets</span></li><li><span class="hljs-comment">// 定义SendableObject</span></li><li>
</li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SendableObject</span> {</li><li>  <span class="hljs-attr">a</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">45</span>;</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-comment">// 接收Worker线程传递至宿主线程的数据并访问其属性</span></li><li>
</li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">SendableObject</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./sendable'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/Worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-number">1</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">SendableObject</span> = e.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"sendable index obj is: "</span> + obj.<span class="hljs-property">a</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 3026px;">     <h3 id="callglobalcallobjectmethod11" device-type="phone,2in1,tablet,wearable,tv">callGlobalCallObjectMethod<sup>11+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="callglobalcallobjectmethod11" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>callGlobalCallObjectMethod(instanceName: string, methodName: string, timeout: number, ...args: Object[]): Object</p>     <p>Worker线程调用宿主线程上注册的对象的指定方法，此调用对Worker线程同步，对宿主线程异步，返回值通过数据拷贝传递。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.36.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.36.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.36.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.36.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">instanceName</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">注册对象时使用的键，用于在宿主线程中查找对象。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">methodName</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">在已注册对象上调用的方法名。该方法不能使用async修饰，也不能基于底层异步机制返回结果，否则会抛出异常。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">timeout</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>表示从Worker线程发起调用开始到在主线程中执行目标方法的最大等待时间，单位为ms，取整数，取值范围为[1-5000]ms。也可取特殊值0，此时表示本次调用等待时间为5000ms。</p>          <p>API version 21 之前，在debug模式下受此参数设置的最大等待时间限制。</p>          <p>从API version 21 开始，在debug模式下不受此参数设置的最大等待时间限制，可一直等待。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">args</td>         <td class="cellrowborder" width="25%">Object[]</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">注册对象上所调用方法的参数数组。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.36.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.36.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Object</td>         <td class="cellrowborder" width="50%">返回值为调用方法在宿主线程的返回值，该返回值必须是可序列化的，具体可见序列化支持类型。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.36.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.36.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200006</td>         <td class="cellrowborder" width="50%">An exception occurred during serialization.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200019</td>         <td class="cellrowborder" width="50%">The globalCallObject is not registered.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200020</td>         <td class="cellrowborder" width="50%">The method to be called is not callable or is an async method or a generator.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200021</td>         <td class="cellrowborder" width="50%">The global call exceeds the timeout.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestObj</span> {</li><li>  <span class="hljs-keyword">private</span> message : <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a message from TestObj"</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessage</span>() : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>;</li><li>  }</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getMessageWithInput</span>(str : <span class="hljs-built_in">string</span>) : <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">" with input: "</span> + str;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> registerObj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TestObj</span>();</li><li><span class="hljs-comment">// 在ThreadWorker实例上注册registerObj</span></li><li>workerInstance.<span class="hljs-title function_">registerGlobalCallObject</span>(<span class="hljs-string">"myObj"</span>, registerObj);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"start worker"</span>);</li><li><span class="hljs-comment">// 需要在组件生命周期结束时调用：</span></li><li><span class="hljs-comment">// workerInstance.unregisterGlobalCallObject("myObj");</span></li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用方法无入参</span></li><li>    <span class="hljs-keyword">let</span> res : <span class="hljs-built_in">string</span> = workerPort.<span class="hljs-title function_">callGlobalCallObjectMethod</span>(<span class="hljs-string">"myObj"</span>, <span class="hljs-string">"getMessage"</span>, <span class="hljs-number">0</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker:"</span>, res); <span class="hljs-comment">// worker: this is a message from TestObj</span></li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker: error code is "</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">" error message is "</span> + error.<span class="hljs-property">message</span>);</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用方法有入参</span></li><li>    <span class="hljs-keyword">let</span> res : <span class="hljs-built_in">string</span> = workerPort.<span class="hljs-title function_">callGlobalCallObjectMethod</span>(<span class="hljs-string">"myObj"</span>, <span class="hljs-string">"getMessageWithInput"</span>, <span class="hljs-number">0</span>, <span class="hljs-string">"hello there!"</span>) <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker:"</span>, res); <span class="hljs-comment">//worker: this is a message from TestObj with input: hello there!</span></li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-comment">// 异常处理</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker: error code is "</span> + error.<span class="hljs-property">code</span> + <span class="hljs-string">" error message is "</span> + error.<span class="hljs-property">message</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1046px;">     <h3 id="close9" device-type="phone,2in1,tablet,wearable,tv">close<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="close9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>close(): void</p>     <p>销毁Worker线程，终止Worker接收消息。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.37.8.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.37.8.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">The Worker instance is not running.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    workerPort.<span class="hljs-title function_">close</span>();</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 182px;">     <h2 id="workereventlistener9" device-type="phone,2in1,tablet,wearable,tv">WorkerEventListener<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="workereventlistener9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>事件监听类。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1354px;">     <h3 id="event-event9" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">(event: Event)<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="event-event9" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>(event: Event): void | Promise&lt;void&gt;</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.39.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.39.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.39.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.39.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件类。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.39.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.39.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">void | Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">无返回值或者以Promise形式返回。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.39.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.39.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200004</td>         <td class="cellrowborder" width="50%">Worker instance is not running.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200005</td>         <td class="cellrowborder" width="50%">The invoked API is not supported in workers.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">Event</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkTS"</span></li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">(<span class="hljs-params">event: Event</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"event type is: "</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(event.<span class="hljs-property">type</span>));</li><li>});</li><li>
</li><li><span class="hljs-keyword">const</span> eventToDispatch : <span class="hljs-title class_">Event</span> = { <span class="hljs-attr">type</span>: <span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span> }; <span class="hljs-comment">// timeStamp暂未支持</span></li><li>workerInstance.<span class="hljs-title function_">dispatchEvent</span>(eventToDispatch);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 639px;">     <h2 id="globalscope9" device-type="phone,2in1,tablet,wearable,tv">GlobalScope<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="globalscope9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker线程自身的运行环境，GlobalScope类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventtarget9">WorkerEventTarget</a>。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.40.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.40.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.40.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.40.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.40.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">name</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">Worker的名字，new Worker时指定。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">self</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#globalscope9">GlobalScope</a> &amp; typeof globalThis</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">GlobalScope本身。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onerror</td>         <td class="cellrowborder" width="20%">(ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">Worker在执行过程中发生异常被调用的回调函数，在Worker线程中执行，ev表示收到的异常数据。默认值为undefined。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 381px;">     <h2 id="messageevents9" device-type="phone,2in1,tablet,wearable,tv">MessageEvents<sup>9+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="messageevents9" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>消息类，持有Worker线程间传递的数据，MessageEvents类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a>。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.41.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.41.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.41.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.41.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.41.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">data</td>         <td class="cellrowborder" width="20%">any</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">线程间传递的数据。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 528px;">     <h2 id="messagetype7" device-type="phone,2in1,tablet,wearable,tv">MessageType<sup>7+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="messagetype7" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type MessageType = 'message' | 'messageerror';</p>     <p>表示消息类型。预留数据类型，暂未实现。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">'message'</td>         <td class="cellrowborder" width="50%">表示消息类型为message，值固定为'message'字符串。</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">'messageerror'</td>         <td class="cellrowborder" width="50%">表示消息类型为messageerror，值固定为'messageerror'字符串。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 501px;">     <h2 id="errorcallback18" device-type="phone,2in1,tablet,wearable,tv">ErrorCallback<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errorcallback18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type ErrorCallback = (err: ErrorEvent) =&gt; void</p>     <p>表示异常回调类型。</p>     <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.43.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.43.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.43.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.43.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">err</td>         <td class="cellrowborder" width="25%">ErrorEvent</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">错误事件类，表示Worker执行过程中出现的异常信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 274px;">     <h2 id="workerdeprecated" device-type="phone,2in1,tablet,wearable,tv">Worker<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="workerdeprecated" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>使用以下方法前，均需先构造Worker实例，Worker类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventtargetdeprecated">EventTarget</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworker9">ThreadWorker<sup>9+</sup></a>替代。</p>      </div></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1908px;">     <h3 id="属性-3" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性-3" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.45.3.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.45.3.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.45.3.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.45.3.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.45.3.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">onexit<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(code: number) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示Worker销毁时被调用的事件处理程序，处理程序在宿主线程中执行。其中回调函数中code类型为number，异常退出为1，正常退出为0。默认值为undefined。</p>          <p><strong>说明</strong>：从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-1">ThreadWorker.onexit</a>替代。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onerror<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(err: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示Worker在执行过程中发生异常被调用的事件处理程序，处理程序在宿主线程中执行。其中回调函数中err类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>，表示收到的异常数据。默认值为undefined。</p>          <p><strong>说明</strong>：从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-1">ThreadWorker.onerror</a>替代。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessage<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(event: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示宿主线程接收到来自其创建的Worker通过workerPort.postMessage接口发送的消息时被调用的事件处理程序，处理程序在宿主线程中执行。其中回调函数中event类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>，表示收到的Worker消息数据。默认值为undefined。</p>          <p><strong>说明</strong>：从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-1">ThreadWorker.onmessage</a>替代。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessageerror<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(event: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数。表示当Worker对象接收到一条无法被序列化的消息时被调用的事件处理程序，处理程序在宿主线程中执行。其中回调函数中event类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>，表示收到的Worker消息数据。默认值为undefined。</p>          <p><strong>说明</strong>：从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-1">ThreadWorker.onmessageerror</a>替代。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 911px;">     <h3 id="constructordeprecated" device-type="phone,2in1,tablet,wearable,tv">constructor<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructordeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(scriptURL: string, options?: WorkerOptions)</p>     <p>Worker构造函数。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#constructor9">ThreadWorker.constructor<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.46.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.46.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.46.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.46.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">scriptURL</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">Worker线程文件的路径，详细参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#文件路径注意事项" target="_blank">文件路径注意事项</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workeroptions">WorkerOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">Worker构造的选项。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>此处以在Stage模型的entry模块Index.ets文件中加载Worker文件为例，使用Library加载Worker线程文件的场景参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction#文件路径注意事项" target="_blank">文件路径注意事项</a>。</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// worker文件所在路径："entry/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">'entry/ets/workers/worker.ets'</span>, {<span class="hljs-attr">name</span>: <span class="hljs-string">"WorkerThread"</span>});</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 983px;">     <h3 id="postmessagedeprecated" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagedeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(message: Object, transfer: ArrayBuffer[]): void</p>     <p>宿主线程通过转移对象所有权的方式向Worker线程发送消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9">ThreadWorker.postMessage<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.47.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.47.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.47.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.47.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至Worker的数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示可转移的ArrayBuffer实例对象数组，所有权会转移到Worker线程，仅在该线程中可用。数组不可传入null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1199px;">     <h3 id="postmessagedeprecated-1" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagedeprecated-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(message: Object, options?: PostMessageOptions): void</p>     <p>宿主线程通过转移对象所有权或者拷贝数据的方式向Worker线程发送消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-1">ThreadWorker.postMessage<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.48.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.48.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.48.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.48.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">message</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至Worker的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessageoptions">PostMessageOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>当填入该参数时，与传入ArrayBuffer[]的作用一致，该数组中对象的所有权会被转移到Worker线程，在宿主线程中将变为不可用，仅在Worker线程中可用。</p>          <p>若不填入该参数，默认设置为undefined，通过拷贝数据的方式传输信息到Worker线程。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 863px;">     <h3 id="ondeprecated" device-type="phone,2in1,tablet,wearable,tv">on<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="ondeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>on(type: string, listener: EventListener): void</p>     <p>向Worker添加一个事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#addeventlistenerdeprecated">addEventListener<sup>(deprecated)</sup></a>接口功能一致。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#on9">ThreadWorker.on<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.49.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.49.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.49.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.49.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventlistenerdeprecated">EventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 863px;">     <h3 id="oncedeprecated" device-type="phone,2in1,tablet,wearable,tv">once<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oncedeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>once(type: string, listener: EventListener): void</p>     <p>向Worker添加一个事件监听，该事件监听只执行一次，执行完后会自动删除。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#once9">ThreadWorker.once<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.50.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.50.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.50.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.50.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventlistenerdeprecated">EventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">once</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 863px;">     <h3 id="offdeprecated" device-type="phone,2in1,tablet,wearable,tv">off<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="offdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>off(type: string, listener?: EventListener): void</p>     <p>移除类型为type的事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#removeeventlistenerdeprecated">removeEventListener<sup>(deprecated)</sup></a>接口功能一致。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#off9">ThreadWorker.off<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.51.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.51.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.51.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.51.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要删除的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventlistenerdeprecated">EventListener</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">移除监听事件后所执行的回调事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li><span class="hljs-comment">//使用on接口、once接口或addEventListener接口创建“alert”事件，使用off接口删除事件。</span></li><li>workerInstance.<span class="hljs-title function_">off</span>(<span class="hljs-string">"alert"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 619px;">     <h3 id="terminatedeprecated" device-type="phone,2in1,tablet,wearable,tv">terminate<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="terminatedeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>terminate(): void</p>     <p>销毁Worker线程，终止Worker接收消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#terminate9">ThreadWorker.terminate<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">terminate</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 226px;">     <h2 id="eventtargetdeprecated" device-type="phone,2in1,tablet,wearable,tv">EventTarget<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="eventtargetdeprecated" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventtarget9">WorkerEventTarget<sup>9+</sup></a>替代。</p>      </div></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 871px;">     <h3 id="addeventlistenerdeprecated" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">addEventListener<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="addeventlistenerdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>addEventListener(type: string, listener: EventListener): void</p>     <p>向Worker添加一个事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#ondeprecated">on<sup>(deprecated)</sup></a>接口功能一致。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#addeventlistener9">addEventListener<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.54.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.54.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.54.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.54.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">监听的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">listener</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventlistenerdeprecated">EventListener</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">事件触发时的回调函数。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 959px;">     <h3 id="removeeventlistenerdeprecated" device-type="phone,2in1,tablet,wearable,tv">removeEventListener<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removeeventlistenerdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeEventListener(type: string, callback?: EventListener): void</p>     <p>移除Worker的事件监听，该接口与<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#offdeprecated">off<sup>(deprecated)</sup></a>接口功能一致。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#removeeventlistener9">removeEventListener<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要移除的事件类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventlistenerdeprecated">EventListener</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">回调函数，删除监听事件后执行。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerPort.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">'alert'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1757px;">     <h3 id="dispatcheventdeprecated" device-type="phone,2in1,tablet,wearable,tv">dispatchEvent<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="dispatcheventdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>dispatchEvent(event: Event): boolean</p>     <p>分发定义在Worker的事件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#dispatchevent9">dispatchEvent<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.56.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.56.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.56.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.56.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">需要分发的事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.56.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.56.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">分发的结果。true表示分发成功，false表示分发失败。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert_add"</span>, <span class="hljs-function">()=&gt;</span>{</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerPort.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">'alert_add'</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li></ol></pre></div></div>     <p>分发事件（dispatchEvent）可与监听接口（addEventListener）搭配使用，示例如下：</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive data from worker.ets"</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">()=&gt;</span>{</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  workerPort.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>:<span class="hljs-string">"alert"</span>, <span class="hljs-attr">timeStamp</span>:<span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 739px;">     <h3 id="removealllistenerdeprecated" device-type="phone,2in1,tablet,wearable,tv">removeAllListener<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="removealllistenerdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>removeAllListener(): void</p>     <p>移除Worker所有的事件监听。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#removealllistener9">removeAllListener<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert_add"</span>, <span class="hljs-function">()=&gt;</span>{</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li><li>
</li><li>workerPort.<span class="hljs-title function_">removeAllListener</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 274px;">     <h2 id="dedicatedworkerglobalscopedeprecated" device-type="phone,2in1,tablet,wearable,tv">DedicatedWorkerGlobalScope<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="dedicatedworkerglobalscopedeprecated" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker线程用于与宿主线程通信的类。DedicatedWorkerGlobalScope类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workerglobalscopedeprecated">WorkerGlobalScope</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#threadworkerglobalscope9">ThreadWorkerGlobalScope<sup>9+</sup></a>替代。</p>      </div></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1266px;">     <h3 id="属性-4" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性-4" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.59.3.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.59.3.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.59.3.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.59.3.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.59.3.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">onmessage<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(this: DedicatedWorkerGlobalScope, ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数，表示Worker线程收到来自其宿主线程通过postMessage接口发送的消息时被调用的事件处理程序，处理程序在Worker线程中执行。其中this指调用者对象本身<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#dedicatedworkerglobalscopedeprecated">DedicatedWorkerGlobalScope</a>，ev类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>，表示收到的Worker消息数据。默认值为undefined。</p>          <p><strong>说明</strong>：从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-2">ThreadWorkerGlobalScope.onmessage</a>替代。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onmessageerror<sup>(deprecated)</sup></td>         <td class="cellrowborder" width="20%">(this: DedicatedWorkerGlobalScope, ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>回调函数，表示当Worker对象接收到一条无法被反序列化的消息时被调用的事件处理程序，处理程序在Worker线程中执行。其中this指调用者对象本身<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#dedicatedworkerglobalscopedeprecated">DedicatedWorkerGlobalScope</a>，ev类型为<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#messageeventt">MessageEvent</a>，表示收到的Worker消息数据。从API version 7开始支持，默认值为undefined。</p>          <p><strong>说明</strong>：从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#属性-2">ThreadWorkerGlobalScope.onmessageerror</a>替代。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 630px;">     <h3 id="postmessagedeprecated-2" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagedeprecated-2" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(messageObject: Object, transfer: Transferable[]): void</p>     <p>Worker线程通过转移对象所有权的方式向宿主线程发送消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>此接口暂不支持使用，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-2">ThreadWorkerGlobalScope<sup>9+</sup>.postMessage<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.60.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.60.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.60.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.60.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">messageObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">Transferable[]</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">暂不支持该参数类型。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1451px;">     <h3 id="postmessagedeprecated-3" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagedeprecated-3" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(messageObject: Object, transfer: ArrayBuffer[]): void</p>     <p>Worker线程通过转移对象所有权的方式向宿主线程发送消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>DedicatedWorkerGlobalScope类自API version 9开始废弃，本接口建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-2">ThreadWorkerGlobalScope<sup>9+</sup>.postMessage<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.61.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.61.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.61.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.61.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">messageObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">transfer</td>         <td class="cellrowborder" width="25%">ArrayBuffer[]</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">表示可转移的ArrayBuffer实例对象数组，该数组中对象的所有权会被转移到宿主线程，在Worker线程中将会变为不可用，仅在宿主线程中可用，数组不可传入null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-comment">// let data = e.data;</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive data from worker.ets"</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">DedicatedWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">DedicatedWorkerGlobalScope</span> = worker.<span class="hljs-property">parentPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-comment">// let data = e.data;</span></li><li>    <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">5</span>)</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1427px;">     <h3 id="postmessagedeprecated-4" device-type="phone,2in1,tablet,wearable,tv">postMessage<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessagedeprecated-4" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postMessage(messageObject: Object, options?: PostMessageOptions): void</p>     <p>Worker线程通过转移对象所有权或者拷贝数据的方式向宿主线程发送消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessage9-3">ThreadWorkerGlobalScope<sup>9+</sup>.postMessage<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.62.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.62.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.62.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.62.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">messageObject</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">发送至宿主线程的数据，该数据对象必须是可序列化对象，序列化支持类型见<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#序列化支持类型">其他说明</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#postmessageoptions">PostMessageOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>当填入该参数时，与传入ArrayBuffer[]的作用一致，该数组中对象的所有权会被转移到宿主线程，在Worker线程中将会变为不可用，仅在宿主线程中可用。</p>          <p>若不填入该参数，默认设置为 undefined，通过拷贝数据的方式传输信息到宿主线程。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive data from worker.ets"</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> parentPort = worker.<span class="hljs-property">parentPort</span>;</li><li>parentPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  parentPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"receive data from main thread"</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 871px;">     <h3 id="closedeprecated" device-type="phone,2in1,tablet,wearable,tv">close<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="closedeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>close(): void</p>     <p>销毁Worker线程，终止Worker接收消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#close9">ThreadWorkerGlobalScope<sup>9+</sup>.close<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"hello world"</span>);</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> parentPort = worker.<span class="hljs-property">parentPort</span>;</li><li>parentPort.<span class="hljs-property">onmessage</span> = (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    parentPort.<span class="hljs-title function_">close</span>()</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 453px;">     <h2 id="postmessageoptions" device-type="phone,2in1,tablet,wearable,tv">PostMessageOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postmessageoptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>明确数据传递过程中需要转移所有权的对象，这些对象必须是ArrayBuffer，在发送方的上下文中将变为不可用，仅在接收方可用。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.64.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.64.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.64.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.64.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.64.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">transfer</td>         <td class="cellrowborder" width="20%">Object[]</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">ArrayBuffer数组，用于传递所有权。该数组中不可传入null。默认值为undefined。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 474px;">     <h2 id="event" device-type="phone,2in1,tablet,wearable,tv">Event<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="event" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>事件类。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.65.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.65.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.65.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.65.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.65.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">type</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">指定事件的类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">timeStamp</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">事件创建时的时间戳（精度为毫秒），目前不支持。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 274px;">     <h2 id="eventlistenerdeprecated" device-type="phone,2in1,tablet,wearable,tv">EventListener<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="eventlistenerdeprecated" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>事件监听类用于处理事件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workereventlistener9">WorkerEventListener<sup>9+</sup></a>替代。</p>      </div></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 925px;">     <h3 id="evt-eventdeprecated" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">(evt: Event)<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="evt-eventdeprecated" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>(evt: Event): void | Promise&lt;void&gt;</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event-event9">(event:Event)<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.67.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.67.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.67.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.67.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">evt</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">回调的事件类。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.67.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.67.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">void | Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">无返回值或者以Promise形式返回。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">Worker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert"</span>, <span class="hljs-function">()=&gt;</span>{</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback"</span>);</li><li>})</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 609px;">     <h2 id="errorevent" device-type="phone,2in1,tablet,wearable,tv">ErrorEvent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="errorevent" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>错误事件类用于表示Worker执行过程中出现异常的详细信息，该类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a>。</p>     <p><strong>元服务API</strong>：从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.68.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.68.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.68.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.68.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.68.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">message</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">异常发生的错误信息。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">filename</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">出现异常所在的文件。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">lineno</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">异常所在的行数。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">colno</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">异常所在的列数。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">error</td>         <td class="cellrowborder" width="20%">Object</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">异常类型。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 381px;">     <h2 id="messageeventt" device-type="phone,2in1,tablet,wearable,tv">MessageEvent&lt;T&gt;<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="messageeventt" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>消息类，持有Worker线程间传递的数据，MessageEvent类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#event">Event</a>。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.69.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.69.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.69.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.69.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.69.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">data</td>         <td class="cellrowborder" width="20%">T</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">线程间传递的数据。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 683px;">     <h2 id="workerglobalscopedeprecated" device-type="phone,2in1,tablet,wearable,tv">WorkerGlobalScope<sup>(deprecated)</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="workerglobalscopedeprecated" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Worker线程自身的运行环境，WorkerGlobalScope类继承<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#eventtargetdeprecated">EventTarget</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 7开始支持，从API version 9开始废弃，建议使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#globalscope9">GlobalScope<sup>9+</sup></a>替代。</p>      </div></div></div>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.70.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.70.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.70.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.70.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.70.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">name</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">Worker的名字，new Worker时指定。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">self</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#workerglobalscopedeprecated">WorkerGlobalScope</a> &amp; typeof globalThis</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">WorkerGlobalScope本身。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">onerror</td>         <td class="cellrowborder" width="20%">(ev: <a href="/consumer/cn/doc/harmonyos-references/js-apis-worker#errorevent">ErrorEvent</a>) =&gt; void</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">Worker在执行过程中发生异常被调用的回调函数，在Worker线程中执行，ev表示收到的异常数据，默认值为undefined。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 146px;">     <h2 id="其他说明" device-type="phone,2in1,tablet,wearable,tv">其他说明<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="其他说明" tips="复制节点链接"></i></h2>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1293px;">     <h3 id="序列化支持类型" class="firsth2">序列化支持类型<i class="anchor-icon anchor-icon-link" anchorid="序列化支持类型" tips="复制节点链接"></i></h3>          <p>序列化支持类型包括：除Symbol之外的基础类型、Date、String、RegExp、Array、Map、Set、Object（仅限简单对象，比如通过"{}"或者"new Object"创建，普通对象仅支持传递属性，不支持传递其原型及方法）、ArrayBuffer、TypedArray。</p>     <p>特例：传递通过自定义class创建出来的object时，不会发生序列化错误，但是自定义class的属性（如Function）无法通过序列化传递。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>以API version 9的FA工程为例。</p>      </div></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"workers/worker.ets"</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"message from main thread to worker"</span>);</li><li>workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">d</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// 当Worker线程传递obj2时，data即为obj2。data没有Init、SetName的方法</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>  = d.<span class="hljs-property">data</span>;</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyModel</span> {</li><li>    name = <span class="hljs-string">"undefined"</span>;</li><li>    <span class="hljs-title class_">Init</span>() {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"MyModel"</span>;</li><li>    }</li><li>}</li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">d</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker.ets onmessage"</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = d.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title function_">func1</span> = (<span class="hljs-params"></span>) =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"post message is function"</span>);</li><li>  }</li><li>  <span class="hljs-comment">// workerPort.postMessage(func1); 传递func1发生序列化错误</span></li><li>  <span class="hljs-keyword">let</span> obj2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyModel</span>();</li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(obj2);     <span class="hljs-comment">// 传递obj2不会发生序列化错误，obj2中的函数会丢失</span></li><li>}</li><li>workerPort.<span class="hljs-property">onmessageerror</span> = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker.ets onmessageerror"</span>);</li><li>}</li><li>workerPort.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker.ets onerror"</span> + err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 228px;">     <h3 id="内存模型">内存模型<i class="anchor-icon anchor-icon-link" anchorid="内存模型" tips="复制节点链接"></i></h3>          <p>Worker基于Actor并发模型实现。在Worker的交互流程中，宿主线程可以创建多个Worker子线程，各个Worker线程间运行环境相互隔离，并通过序列化、引用传递或转移所有权的方式传递对象，等到Worker线程完成计算任务，再把结果返回给宿主线程。</p>     <p>Actor并发模型的交互原理：各个Actor并发地处理宿主线程任务，每个Actor内部都有一个消息队列和单线程执行模块。消息队列负责接收宿主线程及其他Actor的请求，而单线程执行模块则负责串行地处理这些请求、向其他Actor发送请求以及创建新的Actor。由于Actor采用的是异步方式，各个Actor之间相互隔离且没有数据竞争，因此Actor可以高并发运行。</p>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 250px;">     <h2 id="完整示例" device-type="phone,2in1,tablet,wearable,tv">完整示例<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>API version 8及之前的版本仅支持FA模型，如需使用，注意更换构造Worker的接口和创建Worker线程中与宿主线程通信的对象的两个方法。</p>      </div></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 1741px;">     <h3 id="fa模型" class="firsth2">FA模型<i class="anchor-icon anchor-icon-link" anchorid="fa模型" tips="复制节点链接"></i></h3>          <p>此处以API version 9的工程为例。</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// main thread(同级目录为例)</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 宿主线程中创建Worker对象</span></li><li><span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"workers/worker.ets"</span>);</li><li>
</li><li><span class="hljs-comment">// 宿主线程向worker线程传递信息</span></li><li><span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>workerInstance.<span class="hljs-title function_">postMessage</span>(buffer, [buffer]);</li><li>
</li><li><span class="hljs-comment">// 宿主线程接收worker线程信息</span></li><li>workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-comment">// data：worker线程发送的信息</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Int8Array</span> = e.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread onmessage"</span>);</li><li>
</li><li>    <span class="hljs-comment">// 销毁Worker对象</span></li><li>    workerInstance.<span class="hljs-title function_">terminate</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// 在调用terminate后，执行回调onexit</span></li><li>workerInstance.<span class="hljs-property">onexit</span> = <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread terminate"</span>);</li><li>}</li><li>
</li><li>workerInstance.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"main error message "</span> + err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建worker线程中与宿主线程通信的对象</span></li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li><span class="hljs-comment">// worker线程接收宿主线程信息</span></li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-comment">// data：宿主线程发送的信息</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span> = e.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(data).<span class="hljs-title function_">fill</span>(<span class="hljs-number">3</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker.ets onmessage"</span>);</li><li>
</li><li>    <span class="hljs-comment">// worker线程向宿主线程发送信息</span></li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(view);</li><li>}</li><li>
</li><li><span class="hljs-comment">// worker线程发生error的回调</span></li><li>workerPort.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker.ets onerror"</span>);</li><li>}</li></ol></pre></div></div>     <p>在模块级entry/build-profile.json5配置文件中添加如下配置:</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-attr">"buildOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"sourceOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"workers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"./src/main/ets/entryability/workers/worker.ets"</span></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2069px;">     <h3 id="stage模型">Stage模型<i class="anchor-icon anchor-icon-link" anchorid="stage模型" tips="复制节点链接"></i></h3>          <p>此处以API version 18的工程为例。</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 宿主线程中创建Worker对象</span></li><li>            <span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/Worker.ets"</span>);</li><li>            <span class="hljs-comment">// 宿主线程向worker线程传递信息</span></li><li>            <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">8</span>);</li><li>            workerInstance.<span class="hljs-title function_">postMessage</span>(buffer);</li><li>            <span class="hljs-comment">// 宿主线程接收worker线程信息</span></li><li>            workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>              <span class="hljs-comment">// data：worker线程发送的信息</span></li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Int8Array</span> = e.<span class="hljs-property">data</span>;</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread data is  "</span> + data);</li><li>              <span class="hljs-comment">// 销毁Worker对象</span></li><li>              workerInstance.<span class="hljs-title function_">terminate</span>();</li><li>            }</li><li>            <span class="hljs-comment">// 在调用terminate后，执行onexit</span></li><li>            workerInstance.<span class="hljs-property">onexit</span> = <span class="hljs-function">(<span class="hljs-params">code</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"main thread terminate"</span>);</li><li>            }</li><li>
</li><li>            workerInstance.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"main error message "</span> + err.<span class="hljs-property">message</span>);</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Worker.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建worker线程中与宿主线程通信的对象</span></li><li><span class="hljs-keyword">const</span> workerPort = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li><span class="hljs-comment">// worker线程接收宿主线程信息</span></li><li>workerPort.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// data：宿主线程发送的信息</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">ArrayBuffer</span> = e.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-comment">// 往收到的buffer里写入数据</span></li><li>  <span class="hljs-keyword">const</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(data).<span class="hljs-title function_">fill</span>(<span class="hljs-number">3</span>);</li><li>  <span class="hljs-comment">// worker线程向宿主线程发送信息</span></li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(view);</li><li>}</li><li>
</li><li><span class="hljs-comment">// worker线程发生error的回调</span></li><li>workerPort.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"worker.ets onerror"</span> + err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div>     <p>在模块级entry/build-profile.json5配置文件中添加如下配置:</p>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-attr">"buildOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"sourceOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"workers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"./src/main/ets/workers/Worker.ets"</span></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection" style="contain-intrinsic-size: auto 2453px;">     <h3 id="分发事件与监听接口搭配使用示例">分发事件与监听接口搭配使用示例<i class="anchor-icon anchor-icon-link" anchorid="分发事件与监听接口搭配使用示例" tips="复制节点链接"></i></h3>          <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">alignRules</span>({</li><li>          <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>          <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>        })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">"entry/ets/workers/worker.ets"</span>);</li><li>
</li><li>          <span class="hljs-comment">// 用法一:</span></li><li>          workerInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">"alert_on"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback: alert_on"</span>);</li><li>          })</li><li>          workerInstance.<span class="hljs-title function_">once</span>(<span class="hljs-string">"alert_once"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback: alert_once"</span>);</li><li>          })</li><li>          workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"alert_add"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"alert listener callback: alert_add"</span>);</li><li>          })</li><li>
</li><li>          <span class="hljs-comment">// once接口创建的事件执行一次便会删除。</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert_once"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>          <span class="hljs-comment">// on接口创建的事件可以一直被分发，不能主动删除。</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert_on"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert_on"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>          <span class="hljs-comment">// addEventListener接口创建的事件可以一直被分发，不能主动删除。</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert_add"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"alert_add"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>          <span class="hljs-comment">// 用法二:</span></li><li>          <span class="hljs-comment">// event类型的type支持自定义，同时存在"message"/"messageerror"/"error"特殊类型，如下所示</span></li><li>          <span class="hljs-comment">// 当type = "message"，onmessage接口定义的方法同时会执行。</span></li><li>          <span class="hljs-comment">// 当type = "messageerror"，onmessageerror接口定义的方法同时会执行。</span></li><li>          <span class="hljs-comment">// 当type = "error"，onerror接口定义的方法同时会执行。</span></li><li>          <span class="hljs-comment">// 若调用removeEventListener接口或者off接口取消事件时，能且只能取消使用addEventListener/on/once创建的事件。</span></li><li>
</li><li>          workerInstance.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"message"</span>, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"message listener callback"</span>);</li><li>          })</li><li>          workerInstance.<span class="hljs-property">onmessage</span> = (<span class="hljs-attr">e</span>: <span class="hljs-title class_">MessageEvents</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onmessage : message listener callback"</span>);</li><li>          }</li><li>          <span class="hljs-comment">// 调用dispatchEvent分发“message”事件，addEventListener和onmessage中定义的方法都会被执行。</span></li><li>          workerInstance.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"message"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>          <span class="hljs-comment">// 向worker线程发送消息</span></li><li>          workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">"test"</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-efc-c106="" class="highlight-div"><div _ngcontent-efc-c106="" class="highlight-div-header"><div _ngcontent-efc-c106="" class="highlight-div-header-left"><div _ngcontent-efc-c106="" class="handle-button expand-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-efc-c106="" class="highlight-div-header-right"><div _ngcontent-efc-c106="" class="handle-button ai-button"></div><div _ngcontent-efc-c106="" class="handle-button line-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-efc-c106="" class="handle-button theme-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-efc-c106="" class="handle-button copy-button"><div _ngcontent-efc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-efc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">event: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"worker thread recv data is: "</span>, event.<span class="hljs-property">data</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = event.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">workerHandler1</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Handler 1 is: "</span>, data);</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-title function_">workerHandler2</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Handler 2 is: "</span>, data);</li><li>
</li><li>  <span class="hljs-comment">// 注册两个监听器</span></li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"workerListener"</span>, workerHandler1);</li><li>  workerPort.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">"workerListener"</span>, workerHandler2);</li><li>
</li><li>  <span class="hljs-comment">// 事件workerListener注册了两个监听器，两个监听器都会执行</span></li><li>  workerPort.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"workerListener"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>  <span class="hljs-comment">// 删除workerHandler1监听器</span></li><li>  workerPort.<span class="hljs-title function_">removeEventListener</span>(<span class="hljs-string">"workerListener"</span>, workerHandler1); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>  <span class="hljs-comment">// workerHandler1监听器已删除，只有workerHandler2执行</span></li><li>  workerPort.<span class="hljs-title function_">dispatchEvent</span>({<span class="hljs-attr">type</span>: <span class="hljs-string">"workerListener"</span>, <span class="hljs-attr">timeStamp</span>: <span class="hljs-number">0</span>}); <span class="hljs-comment">// timeStamp暂未支持</span></li><li>
</li><li>  <span class="hljs-comment">// 删除所有事件监听</span></li><li>  workerPort.<span class="hljs-title function_">removeAllListener</span>();</li><li>};</li></ol></pre></div></div>    </div>   </div>   <div></div></div>