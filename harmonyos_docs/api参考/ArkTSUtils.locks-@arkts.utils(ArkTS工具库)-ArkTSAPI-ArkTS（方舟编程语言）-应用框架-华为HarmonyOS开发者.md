<h1 _ngcontent-vvl-c119="" class="doc-title ng-star-inserted" title="ArkTSUtils.locks"> ArkTSUtils.locks </h1>

<div _ngcontent-vvl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了解决多并发实例间的数据竞争问题，ArkTS语言基础库引入了异步锁能力。为了开发者的开发效率，AsyncLock对象支持跨并发实例引用传递。</p>    <p>由于ArkTS语言支持异步操作，阻塞锁容易产生死锁问题，因此我们在ArkTS中仅支持异步锁（非阻塞式锁）。</p>    <p>使用异步锁的方法需要标记为async，调用方需要await修饰调用，才能保证时序正确。因此会导致外层调用函数全部标记成async。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 12开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>      <p>此模块仅支持在ArkTS文件（文件后缀为.ets）中导入使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ArkTSUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="asynclockcallback" device-type="phone,2in1,tablet,wearable,tv">AsyncLockCallback<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclockcallback" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type AsyncLockCallback&lt;T&gt; = () =&gt; T | Promise&lt;T&gt;</p>     <p>这是一个补充类型别名，表示<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>函数所有重载中的回调。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h2 id="asynclock" device-type="phone,2in1,tablet,wearable,tv">AsyncLock<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclock" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>实现异步锁功能的类，允许在锁下执行异步操作。该类使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">@Sendable装饰器</a>装饰。</p>    </div>    <div class="tiledSection">     <h3 id="属性" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">name</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">锁的名称。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例一：</span></li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {</li><li>  <span class="hljs-attr">count_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">lock</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span> = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span>.<span class="hljs-title function_">request</span>(<span class="hljs-string">"lock_1"</span>);</li><li>    <span class="hljs-keyword">return</span> lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count_</span>;</li><li>    })</li><li>  }</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setCount</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">lock</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span> = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span>.<span class="hljs-title function_">request</span>(<span class="hljs-string">"lock_1"</span>);</li><li>    <span class="hljs-keyword">await</span> lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count_</span> = count;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 示例二：</span></li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {</li><li>  <span class="hljs-attr">count_</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">lock_</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCount</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">number</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock_</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count_</span>;</li><li>    })</li><li>  }</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setCount</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock_</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count_</span> = count;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Concurrent</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">a: A</span>) {</li><li>  <span class="hljs-keyword">await</span> a.<span class="hljs-title function_">setCount</span>(<span class="hljs-number">10</span>)</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="constructor" device-type="phone,2in1,tablet,wearable,tv">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor()</p>     <p>默认构造函数。创建一个异步锁。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="request" device-type="phone,2in1,tablet,wearable,tv">request<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="request" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>static request(name: string): AsyncLock</p>     <p>使用指定的名称查找或创建（如果未找到）异步锁实例。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">name</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">按指定名称查找或创建异步锁实例。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclock">AsyncLock</a></td>         <td class="cellrowborder" width="50%">返回查找到或创建后的异步锁实例。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lockName = <span class="hljs-string">'isAvailableLock'</span>;</li><li><span class="hljs-keyword">let</span> lock = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span>.<span class="hljs-title function_">request</span>(lockName);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="query" device-type="phone,2in1,tablet,wearable,tv">query<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="query" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>static query(name: string): AsyncLockState</p>     <p>查询指定异步锁的信息。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">name</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">要查询的锁的名称，仅可查询通过<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#request">request接口</a>获取的锁（即与<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#request">request接口</a>入参锁名称保持一致）。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockstate">AsyncLockState</a></td>         <td class="cellrowborder" width="50%">包含状态描述的异步锁状态实例。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">The input parameters are invalid.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200030</td>         <td class="cellrowborder" width="50%">The lock does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 你已经在别的地方创建了一个锁。</span></li><li><span class="hljs-comment">// let lock = ArkTSUtils.locks.AsyncLock.request("queryTestLock");</span></li><li><span class="hljs-keyword">let</span> state = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span>.<span class="hljs-title function_">query</span>(<span class="hljs-string">'queryTestLock'</span>);</li><li><span class="hljs-keyword">if</span> (!state) {</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'测试失败：期望有效的状态，但得到的是 '</span> + state);</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">pending</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockInfo</span>[] = state.<span class="hljs-property">pending</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">held</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockInfo</span>[] = state.<span class="hljs-property">held</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="queryall" device-type="phone,2in1,tablet,wearable,tv">queryAll<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="queryall" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>static queryAll(): AsyncLockState[]</p>     <p>查询所有现有锁的信息。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockstate">AsyncLockState</a>[]</td>         <td class="cellrowborder" width="50%">包含锁状态信息的异步锁状态数组。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">states</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockState</span>[] = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span>.<span class="hljs-title function_">queryAll</span>();</li><li><span class="hljs-keyword">if</span> (states.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'测试失败：期望至少有1个状态，但得到的是 '</span> + states.<span class="hljs-property">length</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="lockasync" device-type="phone,2in1,tablet,wearable,tv">lockAsync<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="lockasync" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>lockAsync&lt;T&gt;(callback: AsyncLockCallback&lt;T&gt;): Promise&lt;T&gt;</p>     <p>在获取的锁下执行操作。该方法首先获取锁，然后调用回调，最后释放锁。回调在调用<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>的同一线程中以异步方式执行。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockcallback">AsyncLockCallback&lt;T&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">获取锁后要调用的函数。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;T&gt;</td>         <td class="cellrowborder" width="50%">回调执行后将解决的Promise。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">The input parameters are invalid.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200030</td>         <td class="cellrowborder" width="50%">The lock does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li><span class="hljs-keyword">let</span> p1 = lock.<span class="hljs-property">lockAsync</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 执行某些操作</span></li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="lockasync-1" device-type="phone,2in1,tablet,wearable,tv">lockAsync<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="lockasync-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>lockAsync&lt;T&gt;(callback: AsyncLockCallback&lt;T&gt;, mode: AsyncLockMode): Promise&lt;T&gt;</p>     <p>在获取的锁下执行操作。该方法首先获取锁，然后调用回调，最后释放锁。回调在调用<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>的同一线程中以异步方式执行。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockcallback">AsyncLockCallback&lt;T&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">获取锁后要调用的函数。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">mode</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockmode">AsyncLockMode</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">锁的操作模式。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;T&gt;</td>         <td class="cellrowborder" width="50%">回调执行后将解决的Promise。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">The input parameters are invalid.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200030</td>         <td class="cellrowborder" width="50%">The lock does not exist.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li><span class="hljs-keyword">let</span> p1 = lock.<span class="hljs-property">lockAsync</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 执行某些操作</span></li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="lockasync-2" device-type="phone,2in1,tablet,wearable,tv">lockAsync<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="lockasync-2" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>lockAsync&lt;T, U&gt;(callback: AsyncLockCallback&lt;T&gt;, mode: AsyncLockMode, options: AsyncLockOptions&lt;U&gt;): Promise&lt;T | U&gt;</p>     <p>在获取的锁下执行操作。该方法首先获取锁，然后调用回调，最后释放锁。回调在调用<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>的同一线程中以异步方式执行。在<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockoptions">AsyncLockOptions</a>中可以提供一个可选的超时值。在这种情况下，如果超时前未能获取锁，lockAsync将返回被拒绝的Promise并带上一个BusinessError实例。这种情况下，错误信息将包含持有的锁和等待的锁的信息以及可能的死锁警告。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">callback</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockcallback">AsyncLockCallback&lt;T&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">获取锁后要调用的函数。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">mode</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockmode">AsyncLockMode</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">锁的操作模式。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockoptions">AsyncLockOptions&lt;U&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">锁的操作选项。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;T | U&gt;</td>         <td class="cellrowborder" width="50%">回调执行后解决的Promise，或者在超时情况下被拒绝。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-utils">语言基础类库错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.15.12.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.15.12.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">The input parameters are invalid.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200030</td>         <td class="cellrowborder" width="50%">The lock does not exist.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">10200031</td>         <td class="cellrowborder" width="50%">Timeout exceeded.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li><span class="hljs-keyword">let</span> options = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockOptions</span>&lt;<span class="hljs-built_in">void</span>&gt;();</li><li>options.<span class="hljs-property">timeout</span> = <span class="hljs-number">1000</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">p</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; = lock.<span class="hljs-property">lockAsync</span>&lt;<span class="hljs-built_in">void</span>, <span class="hljs-built_in">void</span>&gt;(</li><li>    <span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 执行某些操作</span></li><li>    },</li><li>    <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>,</li><li>    options</li><li>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="asynclockmode" device-type="phone,2in1,tablet,wearable,tv">AsyncLockMode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclockmode" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>锁操作对应的模式枚举。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.5.1.4.1.1" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.5.1.4.1.2" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.5.1.4.1.3" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="33.33333333333333%">SHARED</td>         <td class="cellrowborder" width="33.33333333333333%">1</td>         <td class="cellrowborder" width="33.33333333333333%">共享锁模式。如果指定了此模式，允许​​多个线程或并发任务同时获取锁并执行操作。多用于读操作、无数据竞争的并行任务。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">EXCLUSIVE</td>         <td class="cellrowborder" width="33.33333333333333%">2</td>         <td class="cellrowborder" width="33.33333333333333%">独占锁模式。如果指定了此模式，仅允许持有锁的任务执行。 它与任何其他锁均不兼容​​，包括其他独占锁和共享锁。多用于写操作、数据更新、状态修改等可能产生竞争的场景。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li><span class="hljs-comment">// shared0可获取锁并开始执行</span></li><li>lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'shared0'</span>);</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));</li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>);</li><li><span class="hljs-comment">// shared1可获取锁并开始执行，无需等待shared0</span></li><li>lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'shared1'</span>);</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));</li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>);</li><li><span class="hljs-comment">// exclusive0需等待shared0、1执行完后才可获取锁并执行</span></li><li>lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'exclusive0'</span>);</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));</li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>);</li><li><span class="hljs-comment">// shared2需等待exclusive0执行完后才可获取锁并执行</span></li><li>lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'shared2'</span>);</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));</li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>);</li><li><span class="hljs-comment">// shared3需等待exclusive0执行完后才可获取锁并执行，无需等待shared2</span></li><li>lock.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'shared3'</span>);</li><li>    <span class="hljs-keyword">await</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> <span class="hljs-built_in">setTimeout</span>(resolve, <span class="hljs-number">1000</span>));</li><li>}, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="asynclockoptions" device-type="phone,2in1,tablet,wearable,tv">AsyncLockOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclockoptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>class AsyncLockOptions&lt;T&gt;</p>     <p>表示锁操作选项的类。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h3 id="constructor-1" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor-1" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor()</p>     <p>默认构造函数。创建一个所有属性均具有默认值的异步锁配置项实例。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">s</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AbortSignal</span>&lt;<span class="hljs-built_in">string</span>&gt; = { <span class="hljs-attr">aborted</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">reason</span>: <span class="hljs-string">'Aborted'</span> };</li><li><span class="hljs-keyword">let</span> options = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockOptions</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>options.<span class="hljs-property">isAvailable</span> = <span class="hljs-literal">false</span>;</li><li>options.<span class="hljs-property">signal</span> = s;</li><li><span class="hljs-keyword">let</span> lock = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li><span class="hljs-keyword">let</span> p = lock.<span class="hljs-property">lockAsync</span>&lt;<span class="hljs-built_in">void</span>, <span class="hljs-built_in">string</span>&gt;(</li><li>  <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 执行某些操作</span></li><li>  },</li><li>  <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>,</li><li>  options,</li><li>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="属性-1">属性<i class="anchor-icon anchor-icon-link" anchorid="属性-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">isAvailable</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">当前锁是否可用。取值为true，则只有在尚未持有锁定请求时才会授予该锁定请求；为false则表示将等待当前锁被释放。默认为 false。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">signal</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#abortsignal">AbortSignal&lt;T&gt;</a>|null</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">用于终止异步操作的对象。当signal.aborted为true时，锁请求将被丢弃；当signal.aborted为false时，请求会继续等待获取锁；当signal为null时，请求正常排队运行。默认为 null。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">timeout</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">锁的超时时间，单位为毫秒。若该值大于零，且操作运行时间超过该时间，<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>将返回被拒绝的Promise。默认为 0。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="asynclockstate" device-type="phone,2in1,tablet,wearable,tv">AsyncLockState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclockstate" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>用于存储异步锁实例上当前执行的所有锁操作的信息的类。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h3 id="属性-2" class="firsth2">属性<i class="anchor-icon anchor-icon-link" anchorid="属性-2" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.2.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.2.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.2.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.2.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.2.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">held</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockinfo">AsyncLockInfo[]</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">持有的锁信息。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">pending</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockinfo">AsyncLockInfo[]</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">等待中的锁信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="asynclockinfo" device-type="phone,2in1,tablet,wearable,tv">AsyncLockInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="asynclockinfo" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>关于锁的信息。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h3 id="属性-3" class="firsth2">属性<i class="anchor-icon anchor-icon-link" anchorid="属性-3" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.23.2.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.2.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.2.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.2.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.23.2.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">name</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">锁的名称。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">mode</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockmode">AsyncLockMode</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">锁的模式。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">contextId</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#asynclockmode">AsyncLockMode</a>调用者的执行上下文标识符。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="abortsignal" device-type="phone,2in1,tablet,wearable,tv">AbortSignal<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="abortsignal" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>用于终止异步操作的对象。该类的实例必须在其创建的同一线程中访问。从其他线程访问此类的字段会导致未定义的行为。</p>     <p><strong>元服务API</strong>：从API version 12 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h3 id="属性-4" class="firsth2">属性<i class="anchor-icon anchor-icon-link" anchorid="属性-4" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.25.2.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.2.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.2.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.2.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.25.2.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">aborted</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是否终止异步操作。为true时表示终止异步操作，为false时表示异步操作未被终止。</td>        </tr>        <tr>         <td class="cellrowborder" width="20%">reason</td>         <td class="cellrowborder" width="20%">T</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">终止的原因。此值将用于拒绝<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#lockasync">lockAsync</a>返回的Promise。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="conditionvariable18" device-type="phone,2in1,tablet,wearable,tv">ConditionVariable<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="conditionvariable18" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>实现异步等待功能的类，支持异步等待通知操作。该类使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable" target="_blank">@Sendable装饰器</a>装饰。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>    </div>    <div class="tiledSection">     <h3 id="constructor18" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">constructor<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor()</p>     <p>默认构造函数。创建一个异步等待通知操作的对象。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> conditionVariable = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">ConditionVariable</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="request18" device-type="phone,2in1,tablet,wearable,tv">request<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="request18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>static request(name: string): ConditionVariable</p>     <p>使用指定的名称查找或创建（如果未找到）异步等待通知操作的对象。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">name</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">按指定名称查找或创建等待通知操作的对象名称，字符串无特别限制。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-utils-locks#conditionvariable18">ConditionVariable</a></td>         <td class="cellrowborder" width="50%">返回查找到或创建后的异步等待通知操作的实例。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> conditionVariable = <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">ConditionVariable</span>.<span class="hljs-title function_">request</span>(<span class="hljs-string">"conditionName"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="wait18" device-type="phone,2in1,tablet,wearable,tv">wait<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="wait18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>wait(): Promise&lt;void&gt;</p>     <p>异步调用进入等待中，将在被唤醒后继续执行。使用Promise异步回调。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.29.7.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">无返回结果的Promise对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">conditionVariable</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">ConditionVariable</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">ConditionVariable</span>();</li><li>conditionVariable.<span class="hljs-title function_">wait</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Thread being awakened, then continue...`</span>); <span class="hljs-comment">//被唤醒后输出日志</span></li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="waitfor18" device-type="phone,2in1,tablet,wearable,tv">waitFor<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="waitfor18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>waitFor(timeout : number) : Promise&lt;void&gt;</p>     <p>异步调用进入等待中, 将在被唤醒或者等待时间结束后继续执行。使用Promise异步回调。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.30.7.1.5.1.1" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.30.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.30.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.30.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">timeout</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">等待时间，单位为ms，正整数。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.30.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.30.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">无返回结果的Promise对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">conditionVariable</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">ConditionVariable</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">ConditionVariable</span>();</li><li>conditionVariable.<span class="hljs-title function_">waitFor</span>(<span class="hljs-number">3000</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Thread being awakened, then continue...`</span>); <span class="hljs-comment">//被唤醒后输出日志</span></li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="notifyall18" device-type="phone,2in1,tablet,wearable,tv">notifyAll<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="notifyall18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>notifyAll() : void</p>     <p>通知所有等待的线程。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">conditionVariable</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">ConditionVariable</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">ConditionVariable</span>();</li><li>conditionVariable.<span class="hljs-title function_">waitFor</span>(<span class="hljs-number">3000</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Thread being awakened, then continue...`</span>); <span class="hljs-comment">//被唤醒后输出日志</span></li><li>});</li><li><span class="hljs-comment">// 通知所有等待的线程。</span></li><li>conditionVariable.<span class="hljs-title function_">notifyAll</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="notifyone18" device-type="phone,2in1,tablet,wearable,tv">notifyOne<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="notifyone18" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>notifyOne() : void</p>     <p>通知第一个等待的线程。</p>     <p><strong>元服务API</strong>：从API version 18 开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.Utils.Lang</p>     <p><strong>示例：</strong></p>     <div _ngcontent-vvl-c106="" class="highlight-div"><div _ngcontent-vvl-c106="" class="highlight-div-header"><div _ngcontent-vvl-c106="" class="highlight-div-header-left"><div _ngcontent-vvl-c106="" class="handle-button expand-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvl-c106="" class="highlight-div-header-right"><div _ngcontent-vvl-c106="" class="handle-button ai-button"></div><div _ngcontent-vvl-c106="" class="handle-button line-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvl-c106="" class="handle-button theme-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvl-c106="" class="handle-button copy-button"><div _ngcontent-vvl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">conditionVariable</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">ConditionVariable</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">ConditionVariable</span>();</li><li>conditionVariable.<span class="hljs-title function_">waitFor</span>(<span class="hljs-number">3000</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Thread a being awakened, then continue...`</span>); <span class="hljs-comment">//被唤醒后输出日志</span></li><li>});</li><li><span class="hljs-comment">// 通知第一个等待的线程。</span></li><li>conditionVariable.<span class="hljs-title function_">notifyOne</span>();</li></ol></pre></div></div>    </div>   </div>   <div></div></div>