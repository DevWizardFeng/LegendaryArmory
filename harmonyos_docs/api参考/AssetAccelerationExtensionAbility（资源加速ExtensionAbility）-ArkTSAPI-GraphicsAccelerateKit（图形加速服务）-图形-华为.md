<h1 _ngcontent-nlc-c119="" class="doc-title ng-star-inserted" title="AssetAccelerationExtensionAbility（资源加速ExtensionAbility）"> AssetAccelerationExtensionAbility（资源加速ExtensionAbility） </h1>

<div _ngcontent-nlc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块为资源包后台下载框架，为资源包后台下载提供关键的生命周期函数。在后台下载任务成功/失败/结束后支持调用相应的回调函数。本模块存在如下约束：</p> <ul><li>AssetAccelerationExtensionAbility为轻量、独立的子进程，不允许唤醒主进程。</li><li>assetDownloadManager提供的接口仅支持调用如下方法：<ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section81101219425">assetDownloadManager.fetchManifestUrl</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section222042984419">assetDownloadManager.removeAssetDownloadTask</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section918114094718">assetDownloadManager.fetchAllAssetDownloadTasks</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section2809432393">assetDownloadManager.removeAllAssetDownloadTasks</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section93791016111111">assetDownloadManager.fetchGroupAssetDownloadTasks</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section641613495177">assetDownloadManager.removeGroupAssetDownloadTasks</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section17279143882113">assetDownloadManager.limitDownloadTaskSpeed</a></li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1492357144916">assetDownloadManager.reportDownloadProgress</a></li></ul> </li></ul> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="tiledSection"><h2 id="section434372513811" device-type="phone,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section434372513811" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AssetAccelerationExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section14401125712" device-type="phone,tablet">AssetAccelerationExtensionInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section14401125712" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>资源加速ExtensionAbility信息。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>本模块接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.1" width="15%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.2" width="15%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.3" width="10%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.4" width="10%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.5" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>maxBackgroundDownloadSize</p> </td> <td class="cellrowborder" width="15%"><p>number</p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="10%"><p>否</p> </td> <td class="cellrowborder" width="50%"><p>最大的资源大小，单位：字节。只有当用户设备剩余存储空间大于maxBackgroundDownloadSize的三倍时，资源加速ExtensionAbility才会使能。</p> <p>默认值：0。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>domainList</p> </td> <td class="cellrowborder" width="15%"><p>string[]</p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="10%"><p>否</p> </td> <td class="cellrowborder" width="50%"><p>域名白名单列表。域名不在此列表中的下载任务将直接失败。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section48341532123214" device-type="phone,tablet">ContentRequestType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section48341532123214" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>type ContentRequestType = 'INSTALL' | 'UPDATE' | 'IDLE'</p> <p>内容请求类型。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>本模块接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.7.1.3.1.1" width="17.24%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.3.1.2" width="82.76%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="17.24%"><p>'INSTALL'</p> </td> <td class="cellrowborder" width="82.76%"><p>安装。</p> </td> </tr> <tr><td class="cellrowborder" width="17.24%"><p>'UPDATE'</p> </td> <td class="cellrowborder" width="82.76%"><p>更新。</p> </td> </tr> <tr><td class="cellrowborder" width="17.24%"><p>'IDLE'</p> </td> <td class="cellrowborder" width="82.76%"><p>空闲。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section8602414438" device-type="phone,tablet">AssetAccelerationExtensionAbility<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section8602414438" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>资源加速扩展能力类。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> </div> <div class="tiledSection"><h3 id="section17656142461018" device-type="phone,tablet" class="firsth2">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17656142461018" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.1" width="15%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.2" width="15%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.3" width="10%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.4" width="10%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.5" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>context</p> </td> <td class="cellrowborder" width="15%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensioncontext">AssetAccelerationExtensionContext</a></p> </td> <td class="cellrowborder" width="10%"><p>否</p> </td> <td class="cellrowborder" width="10%"><p>否</p> </td> <td class="cellrowborder" width="50%"><p>AssetAccelerationExtensionAbility的上下文环境，继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1643305731014" device-type="phone,tablet">onDownloadContentRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1643305731014" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>onDownloadContentRequest(requestType: ContentRequestType, manifestUrl: string, assetAccelerationExtensionInfo: AssetAccelerationExtensionInfo): Promise&lt;assetDownloadManager.AssetDownloadConfig[]&gt;</p> <p>安装应用、更新应用、设备闲时，执行该方法，获取资源包下载任务列表。返回任务量不超过200条。使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="p"><strong>参数</strong>： <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.7.2.1.5.1.1" width="15%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.2.1.5.1.2" width="25%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.2.1.5.1.3" width="10%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.2.1.5.1.4" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>requestType</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section48341532123214">ContentRequestType</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>内容请求类型。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>manifestUrl</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>资源包下载URL：</p> <ul><li>使用华为CDN托管资源，则此参数不为空。</li><li>使用三方CDN，则此参数为空。</li></ul> <p>默认值：空字符串。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>assetAccelerationExtensionInfo</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section14401125712">AssetAccelerationExtensionInfo</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>资源加速ExtensionAbility信息。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.8.2.1.3.1.1" width="30%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.8.2.1.3.1.2" width="70%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section14401125712">assetDownloadManager.AssetDownloadConfig[]</a>&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。返回资源包下载任务的配置信息列表，最多返回200条配置信息。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>示例</strong>：<div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { assetDownloadManager, <span class="hljs-title class_">AssetAccelerationExtensionAbility</span>, <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>, <span class="hljs-title class_">ContentRequestType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此处以AssetAccelExtAbility继承AssetAccelerationExtensionAbility为例</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDownloadContentRequest</span>(<span class="hljs-attr">requestType</span>: <span class="hljs-title class_">ContentRequestType</span>, <span class="hljs-attr">manifestUrl</span>: <span class="hljs-built_in">string</span>,</li><li>    <span class="hljs-attr">assetAccelerationExtensionInfo</span>: <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>): <span class="hljs-title class_">Promise</span>&lt;assetDownloadManager.<span class="hljs-property">AssetDownloadConfig</span>[]&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onDownloadContentRequest enter, requestType: <span class="hljs-subst">${requestType}</span>, manifestUrl: <span class="hljs-subst">${manifestUrl}</span>.`</span>);</li><li>    <span class="hljs-comment">// 构造资源包下载配置信息，用于函数返回值。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">downloadList</span>: <span class="hljs-title class_">Array</span>&lt;assetDownloadManager.<span class="hljs-property">AssetDownloadConfig</span>&gt; = [];</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">download</span>: assetDownloadManager.<span class="hljs-property">AssetDownloadConfig</span> = {</li><li>        <span class="hljs-attr">identifier</span>: <span class="hljs-string">'identifier'</span>,</li><li>        <span class="hljs-attr">url</span>: <span class="hljs-string">'url'</span>,</li><li>        <span class="hljs-attr">isEssential</span>: <span class="hljs-literal">false</span>,</li><li>        <span class="hljs-attr">groupId</span>:<span class="hljs-string">'groupId'</span>,</li><li>        <span class="hljs-attr">fileName</span>: <span class="hljs-string">'fileName'</span></li><li>      }</li><li>    downloadList.<span class="hljs-title function_">push</span>(download);</li><li>    <span class="hljs-keyword">return</span> downloadList;</li><li>  }</li><li>};</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section1441671271116" device-type="phone,tablet">onDownloadWithAppControl<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1441671271116" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>onDownloadWithAppControl(requestType: ContentRequestType, manifestUrl: string, assetAccelerationExtensionInfo: AssetAccelerationExtensionInfo): Promise&lt;boolean&gt;</p> <p>安装应用、更新应用、设备闲时，执行该方法，触发extension协同下载，如果有资源包下载任务则返回true，否则返回false。使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.1(19)</p> <div class="p"><strong>参数</strong>： <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.7.2.1.5.1.1" width="15%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.2.1.5.1.2" width="25%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.2.1.5.1.3" width="10%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.2.1.5.1.4" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>requestType</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section48341532123214">ContentRequestType</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>内容请求类型。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>manifestUrl</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>资源包下载URL：</p> <ul><li>使用华为CDN托管资源，则此URL由系统提供。</li><li>使用三方CDN，则此参数为空。</li></ul> <p>默认值：空字符串。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>assetAccelerationExtensionInfo</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/graphics-accelerate-extensionability#section14401125712">AssetAccelerationExtensionInfo</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>资源加速ExtensionAbility信息。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.8.2.1.3.1.1" width="30%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.8.2.1.3.1.2" width="70%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;boolean&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。</p> <ul><li>返回true：应用自身下载器已开启资源包下载。</li><li>返回false：应用自身下载器无下载任务。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>示例</strong>：<div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AssetAccelerationExtensionAbility</span>, <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>, <span class="hljs-title class_">ContentRequestType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此处以AssetAccelExtAbility继承AssetAccelerationExtensionAbility为例</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onDownloadWithAppControl</span>(<span class="hljs-attr">requestType</span>: <span class="hljs-title class_">ContentRequestType</span>, <span class="hljs-attr">manifestUrl</span>: <span class="hljs-built_in">string</span>,</li><li>    <span class="hljs-attr">assetAccelerationExtensionInfo</span>: <span class="hljs-title class_">AssetAccelerationExtensionInfo</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onDownloadWithAppControl enter, requestType: <span class="hljs-subst">${requestType}</span>, manifestUrl: <span class="hljs-subst">${manifestUrl}</span>.`</span>);</li><li>    <span class="hljs-comment">// 如果有下载任务，则调用应用自身下载器进行资源下载，并返回true，否则返回false。</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>};</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section7400025191119" device-type="phone,tablet">onBackgroundDownloadSucceeded<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7400025191119" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>onBackgroundDownloadSucceeded(downloadTask: assetDownloadManager.AssetDownloadTask, filePath: string): Promise&lt;void&gt;</p> <p>在系统后台下载任务成功时，执行该方法，通知资源加速ExtensionAbility下载成功。使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="p"><strong>参数</strong>： <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.1" width="15%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.2" width="25%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.3" width="10%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.4" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>downloadTask</p> </td> <td class="cellrowborder" width="25%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1639510932819">assetDownloadManager.AssetDownloadTask</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>下载任务信息。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>filePath</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>下载文件的本地沙箱地址。位于应用程序缓存(cache)目录下，示例路径如下：</p> <div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-swift" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-regexp">/data/</span>storage<span class="hljs-regexp">/el2/</span>base<span class="hljs-regexp">/haps/</span>entry<span class="hljs-regexp">/cache/</span>asset_acceleration<span class="hljs-regexp">/1.8.2/</span>xxx.bin</li></ol></pre></div></div> <p>最大长度512个字符。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.8.2.1.3.1.1" width="30%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.8.2.1.3.1.2" width="70%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>示例</strong>：<div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { assetDownloadManager, <span class="hljs-title class_">AssetAccelerationExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此处以AssetAccelExtAbility继承AssetAccelerationExtensionAbility为例</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>  <span class="hljs-comment">// 接收后台资源包下载成功消息的接口。</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onBackgroundDownloadSucceeded</span>(<span class="hljs-attr">downloadTask</span>: assetDownloadManager.<span class="hljs-property">AssetDownloadTask</span>,</li><li>    <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onBackgroundDownloadSucceeded enter, taskId is <span class="hljs-subst">${downloadTask.taskId}</span>, filePath = <span class="hljs-subst">${filePath}</span>`</span>);</li><li>    <span class="hljs-comment">// 添加文件转移处理逻辑。</span></li><li>  }</li><li>};</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section1348813731114" device-type="phone,tablet">onBackgroundDownloadFailed<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1348813731114" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>onBackgroundDownloadFailed(downloadTask: assetDownloadManager.AssetDownloadTask, fault: assetDownloadManager.DownloadFault): Promise&lt;void&gt;</p> <p>在系统后台下载任务失败时，执行该方法，通知资源加速ExtensionAbility下载失败。使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="p"><strong>参数</strong>： <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.5.1.1" width="15%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.5.1.2" width="25%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.5.1.3" width="10%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.5.1.4" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>downloadTask</p> </td> <td class="cellrowborder" width="25%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section1639510932819">assetDownloadManager.AssetDownloadTask</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>下载任务信息。</p> </td> </tr> <tr><td class="cellrowborder" width="15%"><p>fault</p> </td> <td class="cellrowborder" width="25%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/graphics-accelerate-assetdownloadmanager#section82071855806">assetDownloadManager.DownloadFault</a></p> </td> <td class="cellrowborder" width="10%"><p>是</p> </td> <td class="cellrowborder" width="50%"><p>下载失败的原因。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.14.8.2.1.3.1.1" width="30%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.8.2.1.3.1.2" width="70%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>示例</strong>：<div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { assetDownloadManager, <span class="hljs-title class_">AssetAccelerationExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此处以AssetAccelExtAbility继承AssetAccelerationExtensionAbility为例</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>  <span class="hljs-comment">// 接收后台资源包下载失败消息的接口。</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onBackgroundDownloadFailed</span>(<span class="hljs-attr">downloadTask</span>: assetDownloadManager.<span class="hljs-property">AssetDownloadTask</span>,</li><li>    <span class="hljs-attr">fault</span>: assetDownloadManager.<span class="hljs-property">DownloadFault</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onBackgroundDownloadFailed enter, download url: <span class="hljs-subst">${downloadTask.config.url}</span>, err: <span class="hljs-subst">${fault}</span>`</span>);</li><li>    <span class="hljs-comment">// 添加下载异常处理逻辑</span></li><li>  }</li><li>};</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section144241488119" device-type="phone,tablet">onExtensionWillTerminate<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section144241488119" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>onExtensionWillTerminate(error?: BusinessError&lt;void&gt;): Promise&lt;void&gt;</p> <p>在资源加速ExtensionAbility生命周期即将结束时、调度异常退出后，执行该方法，通知关闭资源包后台下载功能。建议在该方法中执行资源清理等操作，请避免耗时操作。使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.GraphicsGame.AssetAcceleration</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="p"><strong>参数</strong>： <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.1" width="15%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.2" width="25%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.3" width="10%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.4" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15%"><p>error</p> </td> <td class="cellrowborder" width="25%"><p>BusinessError&lt;void&gt;</p> </td> <td class="cellrowborder" width="10%"><p>否</p> </td> <td class="cellrowborder" width="50%"><p>错误码：</p> <ul><li>401：参数错误。</li><li>1016600005：资源加速ExtensionAbility方法执行超时。</li><li>1016600006：资源加速ExtensionAbility生命周期方法出现异常。</li><li>1016600094：服务异常。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.8.2.1.3.1.1" width="30%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.8.2.1.3.1.2" width="70%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>示例</strong>：<div _ngcontent-nlc-c106="" class="highlight-div"><div _ngcontent-nlc-c106="" class="highlight-div-header"><div _ngcontent-nlc-c106="" class="highlight-div-header-left"><div _ngcontent-nlc-c106="" class="handle-button expand-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nlc-c106="" class="highlight-div-header-right"><div _ngcontent-nlc-c106="" class="handle-button ai-button"></div><div _ngcontent-nlc-c106="" class="handle-button line-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nlc-c106="" class="handle-button theme-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nlc-c106="" class="handle-button copy-button"><div _ngcontent-nlc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nlc-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AssetAccelerationExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GraphicsAccelerateKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此处以AssetAccelExtAbility继承AssetAccelerationExtensionAbility为例</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AssetAccelExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">AssetAccelerationExtensionAbility</span> {</li><li>  <span class="hljs-comment">// 当AssetAccelerationExtensionAbility生命周期即将结束时、调度异常退出，会执行该回调</span></li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onExtensionWillTerminate</span>(error?: <span class="hljs-title class_">BusinessError</span>&lt;<span class="hljs-built_in">void</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-comment">// 添加资源清理等处理逻辑，请避免耗时操作</span></li><li>    <span class="hljs-keyword">if</span> (!error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onExtensionWillTerminate enter, BusinessError is null;`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'AssetAccelDemo'</span>, <span class="hljs-string">`onExtensionWillTerminate enter, BusinessError：<span class="hljs-subst">${error?.code}</span>, msg: <span class="hljs-subst">${error?.message}</span>`</span>);</li><li>  }</li><li>};</li></ol></pre></div></div> </div> </div> </div> <div></div></div>