<h1 _ngcontent-auy-c119="" class="doc-title ng-star-inserted" title="BuilderNode"> BuilderNode </h1>

<div _ngcontent-auy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>提供能够挂载系统组件的自定义节点BuilderNode。BuilderNode仅可作为叶子节点使用。使用方式参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode" target="_blank">BuilderNode开发指南</a>。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-ui-dynamic-operations#section153921947151012" target="_blank">组件动态创建-组件动态添加、更新和删除</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 11开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>      <p>若传入的Builder的根节点为语法节点（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-ifelse" target="_blank">Ifelse</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach" target="_blank">foreach</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach" target="_blank">lazyforeach</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-contentslot" target="_blank">ContentSlot</a>…）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan">ContainerSpan</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-symbolspan">SymbolSpan</a>或自定义组件，将额外生成一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>，在节点树中显示为“BuilderProxyNode”，这会导致树结构变化，影响某些测试的传递过程。详情参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#buildernode内的builderproxynode导致树结构发生变化" target="_blank">BuilderNode内的BuilderProxyNode导致树结构发生变化</a>。</p>      <p>如果在跨页面复用BuilderNode时显示异常，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#跨页面复用注意事项" target="_blank">跨页面复用注意事项</a>。</p>      <p>当前不支持在预览器中使用BuilderNode。</p>      <p>BuilderNode下的自定义组件支持使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop" target="_blank">@Prop</a>装饰器。不支持使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link" target="_blank">@Link</a>装饰器来跨越BuilderNode同步外界的数据和状态。</p>      <p>如果BuilderNode的子节点是自定义组件，不支持该自定义组件使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable" target="_blank">@Reusable</a>装饰器，详细内容参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#buildernode在子自定义组件中使用reusable装饰器" target="_blank">BuilderNode在子自定义组件中使用@Reusable装饰器</a>。</p>      <p>从API version 12开始，自定义组件支持接收<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage" target="_blank">LocalStorage</a>实例。可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#自定义组件接收localstorage实例" target="_blank">传递LocalStorage实例</a>来使用LocalStorage相关的装饰器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorageprop" target="_blank">@LocalStorageProp</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstoragelink" target="_blank">@LocalStorageLink</a>。</p>      <p>从API version 20开始，通过配置<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildoptions12">BuildOptions</a>，内部自定义组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume" target="_blank">@Consume</a>支持接收所在页面的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume" target="_blank">@Provide</a>数据。</p>      <p>其余装饰器行为未定义，不建议使用。</p>      <p>仅支持在自定义组件中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat" target="_blank">Repeat</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">RenderOptions</span>, <span class="hljs-title class_">NodeRenderType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="noderendertype" device-type="phone,2in1,tablet,wearable,tv">NodeRenderType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="noderendertype" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>节点渲染类型枚举。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.1" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.2" width="33.33333333333333%">值</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.4.1.3" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="33.33333333333333%">RENDER_TYPE_DISPLAY</td>         <td class="cellrowborder" width="33.33333333333333%">0</td>         <td class="cellrowborder" width="33.33333333333333%">表示该节点将被显示到屏幕上。</td>        </tr>        <tr>         <td class="cellrowborder" width="33.33333333333333%">RENDER_TYPE_TEXTURE</td>         <td class="cellrowborder" width="33.33333333333333%">1</td>         <td class="cellrowborder" width="33.33333333333333%">表示该节点将被导出为纹理。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>RENDER_TYPE_TEXTURE类型目前仅在<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildernode-1">BuilderNode</a>持有组件树的根节点为自定义组件时以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-xcomponentnode">XComponentNode</a>中设置生效。</p>       <p>在<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildernode-1">BuilderNode</a>的情况下，目前在作为根节点的自定义组件中支持纹理导出的有以下组件：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-badge">Badge</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-blank">Blank</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-button">Button</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvasgradient">CanvasGradient</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvaspattern">CanvasPattern</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d">CanvasRenderingContext2D</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvas">Canvas</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-checkboxgroup">CheckboxGroup</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-checkbox">Checkbox</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-circle">Circle</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-columnsplit">ColumnSplit</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-column">Column</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-containerspan">ContainerSpan</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-counter">Counter</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-datapanel">DataPanel</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-divider">Divider</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-ellipse">Ellipse</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-flex">Flex</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-gauge">Gauge</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-hyperlink">Hyperlink</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-imagebitmap">ImageBitmap</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-imagedata">ImageData</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image">Image</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-line">Line</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-loadingprogress">LoadingProgress</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-marquee">Marquee</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-matrix2d">Matrix2D</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-offscreencanvasrenderingcontext2d">OffscreenCanvasRenderingContext2D</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-offscreencanvas">OffscreenCanvas</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-path2d">Path2D</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-path">Path</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-patternlock">PatternLock</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-polygon">Polygon</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-polyline">Polyline</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-progress">Progress</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-qrcode">QRCode</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-radio">Radio</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-rating">Rating</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-rect">Rect</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-relativecontainer">RelativeContainer</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-rowsplit">RowSplit</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-row">Row</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-drawing-components-shape">Shape</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-slider">Slider</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span">Span</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-stack">Stack</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textarea">TextArea</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textclock">TextClock</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-textinput">TextInput</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-texttimer">TextTimer</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text">Text</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-toggle">Toggle</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-media-components-video">Video</a>（不含全屏播放能力）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web">Web</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent">XComponent</a>。</p>       <p>从API version 12开始，新增以下组件支持纹理导出：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-datepicker">DatePicker</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-foreach">ForEach</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid">Grid</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-ifelse" target="_blank">IfElse</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach">LazyForEach</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list">List</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll">Scroll</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper">Swiper</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-timepicker">TimePicker</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component" target="_blank">@Component</a>修饰的自定义组件、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer">NodeContainer</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer">NodeContainer</a>下挂载的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode">RenderNode</a>。</p>       <p>使用方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-same-layer" target="_blank">同层渲染绘制</a>。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="renderoptions" device-type="phone,2in1,tablet,wearable,tv">RenderOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="renderoptions" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>创建BuilderNode时的可选参数。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">selfIdealSize</td>         <td class="cellrowborder" width="20%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-graphics#size">Size</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>节点的理想大小。</p>          <p>默认值：{ width: 0, height: 0 }</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">type</td>         <td class="cellrowborder" width="20%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#noderendertype">NodeRenderType</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>节点的渲染类型。</p>          <p>默认值：NodeRenderType.RENDER_TYPE_DISPLAY</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">surfaceId</td>         <td class="cellrowborder" width="20%">string</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>纹理接收方的surfaceId。纹理接收方一般为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-nativeimage-oh-nativeimage">OH_NativeImage</a>。</p>          <p>surfaceId仅当type为NodeRenderType.RENDER_TYPE_TEXTURE时生效。</p>          <p>默认值：""</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="buildoptions12" device-type="phone,2in1,tablet,wearable,tv">BuildOptions<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="buildoptions12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>build的可选参数。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">nestingBuilderSupported</td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>是否支持Builder嵌套Builder进行使用。其中，true表示支持，false表示不支持。默认值：false</p>          <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">localStorage<sup>20+</sup></td>         <td class="cellrowborder" width="20%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage" target="_blank">LocalStorage</a></td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>给当前BuilderNode设置LocalStorage，挂载在此BuilderNode下的自定义组件共享该LocalStorage。如果自定义组件构造函数同时也传入LocalStorage，优先使用构造函数中传入的LocalStorage。默认值：null</p>          <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">enableProvideConsumeCrossing<sup>20+</sup></td>         <td class="cellrowborder" width="20%">boolean</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">是</td>         <td class="cellrowborder" width="20%">          <p>定义BuilderNode内自定义组件的@Consume是否与BuilderNode外部的@Provide状态互通。true表示支持，false表示不支持。默认值：false</p>          <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="inputeventtype20" device-type="phone,2in1,tablet,wearable,tv">InputEventType<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="inputeventtype20" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type InputEventType = TouchEvent | MouseEvent | AxisEvent</p>     <p><a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#postinputevent20">postInputEvent</a>的参数，定义要发送的输入事件类型。</p>     <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明">TouchEvent</a></td>         <td class="cellrowborder" width="50%">触摸事件。</td>        </tr>        <tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-mouse-key#mouseevent对象说明">MouseEvent</a></td>         <td class="cellrowborder" width="50%">鼠标事件。</td>        </tr>        <tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-axis#axisevent">AxisEvent</a></td>         <td class="cellrowborder" width="50%">轴事件。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="buildernode-1" device-type="phone,2in1,tablet,wearable,tv">BuilderNode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="buildernode-1" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>class BuilderNode&lt;Args extends Object[]&gt;</p>     <p>BuilderNode支持通过无状态的UI方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>生成组件树，并持有组件树的根节点。不支持定义为状态变量。BuilderNode中持有的FrameNode仅用于将该BuilderNode作为子节点挂载到其他FrameNode上。对BuilderNode持有的FrameNode进行属性设置与子节点操作可能会产生未定义行为，因此不建议通过BuilderNode的<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#getframenode">getFrameNode</a>方法和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getrendernode">getRenderNode</a>方法获取RenderNode，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode">RenderNode</a>的接口对其进行属性设置与子节点操作。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>    </div>    <div class="tiledSection">     <h3 id="constructor" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(uiContext: UIContext, options?: RenderOptions)</p>     <p>当将BuilderNode生成的内容嵌入到其它RenderNode中显示时，需要显式指定RenderOptions中的selfIdealSize，否则Builder内的节点默认父组件布局约束为[0, 0]。该场景下，若不设置selfIdealSize则认为BuilderNode中子树的根节点大小为[0, 0]。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">uiContext</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext">UIContext</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">UI上下文，获取方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-node#uicontext获取方法">UIContext获取方法</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#renderoptions">RenderOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>BuilderNode的构造可选参数。</p>          <p>默认值：undefined</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>uiContext的入参需要为一个有效的值，即UI上下文正确，如果传入非法值或者未设置，会导致创建失败。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="build" device-type="phone,2in1,tablet,wearable,tv">build<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="build" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>build(builder: WrappedBuilder&lt;Args&gt;, arg?: Object): void</p>     <p>依照传入的对象创建组件树，并持有组件树的根节点。无状态的UI方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>最多拥有一个根节点。</p>     <p>支持自定义组件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>@Builder嵌套使用的时候需要保证内外的@Builder方法的入参对象一致。</p>       <p>最外层的@Builder只支持一个入参。</p>       <p>build的参数是值传递，需要使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#update">update</a>接口进行更新。</p>       <p>需要操作BuilderNode中的对象时，需要保证其引用不被回收。当BuilderNode对象被虚拟机回收之后，它的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode">RenderNode</a>对象也会与后端节点解引用。即从BuilderNode中获取的FrameNode对象不对应任何一个节点。</p>       <p>BuilderNode对象会持有实体节点的引用。如果不需要使用BuilderNode前端对象管理后端节点，可以调用<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#dispose12">dispose</a>接口，实现前后端对象的解绑。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">builder</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder" target="_blank">WrappedBuilder&lt;Args&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">创建对应节点树的时候所需的无状态UI方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">arg</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>builder的入参。当前仅支持一个入参，且入参对象类型与@Builder定义的入参类型保持一致。</p>          <p>默认值：undefined</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="build12" device-type="phone,2in1,tablet,wearable,tv">build<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="build12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>build(builder: WrappedBuilder&lt;Args&gt;, arg: Object, options: <a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildoptions12">BuildOptions</a>): void</p>     <p>依照传入的对象创建组件树，并持有组件树的根节点。无状态的UI方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>最多拥有一个根节点。</p>     <p>支持自定义组件。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>@Builder进行创建和更新的规格参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>。</p>       <p>最外层的@Builder只支持一个入参。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">builder</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-wrapbuilder" target="_blank">WrappedBuilder&lt;Args&gt;</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">创建对应节点树的时候所需的无状态UI方法<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder" target="_blank">@Builder</a>。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">arg</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">builder的入参。当前仅支持一个入参，且入参对象类型与@Builder定义的入参类型保持一致。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildoptions12">BuildOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">build的配置参数，判断是否支持@Builder中嵌套@Builder的行为。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">NodeContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-comment">// 定义传递参数的接口</span></li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">ParamsInterface</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">func</span>: <span class="hljs-title class_">Function</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildTextWithFunc</span>(<span class="hljs-params">fun: <span class="hljs-built_in">Function</span></span>) {</li><li>  <span class="hljs-title class_">Text</span>(<span class="hljs-title function_">fun</span>())</li><li>    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: ParamsInterface</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>    <span class="hljs-title function_">buildTextWithFunc</span>(params.<span class="hljs-property">func</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"HELLO"</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">content</span>: <span class="hljs-title class_">NodeContent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'addBuilderNode'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> buildNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">ParamsInterface</span>]&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>            <span class="hljs-comment">// 创建节点树</span></li><li>            buildNode.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">ParamsInterface</span>]&gt;(buildText), {</li><li>              <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">func</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-string">"FUNCTION"</span>;</li><li>              }</li><li>            }, { <span class="hljs-attr">nestingBuilderSupported</span>: <span class="hljs-literal">true</span> });</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>.<span class="hljs-title function_">addFrameNode</span>(buildNode.<span class="hljs-title function_">getFrameNode</span>());</li><li>            buildNode.<span class="hljs-title function_">dispose</span>();</li><li>          })</li><li>        <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">id</span>(<span class="hljs-string">"column"</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="getframenode" device-type="phone,2in1,tablet,wearable,tv">getFrameNode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getframenode" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getFrameNode(): FrameNode | null</p>     <p>获取BuilderNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>。在BuilderNode执行build操作之后，才会生成FrameNode。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a> | null</td>         <td class="cellrowborder" width="50%">一个FrameNode对象。若该BuilderNode不包含FrameNode，则返回空对象null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例1：</strong></p>     <p>BuilderNode作为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-nodecontainer">NodeContainer</a>的根节点返回。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-comment">// 定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span>})</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"DEFAULT"</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    <span class="hljs-comment">// 返回当前BuiderNode包含的FrameNode</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>))</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>示例2：</strong></p>     <p>BuilderNode的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode">FrameNode</a>挂到其它FrameNode下。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-comment">// 定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"DEFAULT"</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">150</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 将BuilderNode的FrameNode挂至其他FrameNode</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>?.<span class="hljs-title function_">getFrameNode</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>))</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>示例3：</strong></p>     <p>BuilderNode的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-rendernode">RenderNode</a>挂到其它RenderNode下。由于RenderNode不传递布局约束，不推荐通过该方式挂载节点。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">RenderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"DEFAULT"</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-keyword">let</span> renderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderNode</span>();</li><li>    renderNode.<span class="hljs-property">clipToFrame</span> = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">150</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    <span class="hljs-keyword">const</span> textRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>?.<span class="hljs-title function_">getFrameNode</span>()?.<span class="hljs-title function_">getRenderNode</span>();</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(renderNode);</li><li>    <span class="hljs-comment">// 将BuiderNode的RenderNode挂至其他RenderNode</span></li><li>      renderNode.<span class="hljs-title function_">appendChild</span>(textRenderNode);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>))</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="update" device-type="phone,2in1,tablet,wearable,tv">update<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="update" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>update(arg: Object): void</p>     <p>根据提供的参数更新BuilderNode，该参数与<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#build">build</a>方法调用时传入的参数类型相同。对自定义组件进行update的时候需要在自定义组件中将使用的变量定义为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop" target="_blank">@Prop</a>类型。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">arg</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">用于更新BuilderNode的参数，和<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#build">build</a>调用时传入的参数类型一致。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextBuilder</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"TextBuilder"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span>})</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>    <span class="hljs-title class_">TextBuilder</span>({<span class="hljs-attr">message</span>: params.<span class="hljs-property">text</span>}) <span class="hljs-comment">// 自定义组件</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 根据传入参数更新BuiderNode</span></li><li>  <span class="hljs-title function_">update</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(message));</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNodeController</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-keyword">private</span> count = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Update'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>;</li><li>            <span class="hljs-keyword">const</span> message = <span class="hljs-string">"Update "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">toString</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>.<span class="hljs-title function_">update</span>(message);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="posttouchevent" device-type="phone,2in1,tablet,wearable,tv">postTouchEvent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="posttouchevent" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postTouchEvent(event: TouchEvent): boolean</p>     <p>将原始事件派发到某个BuilderNode创建出的FrameNode上。</p>     <p>postTouchEvent是从组件树的中间节点往下分发，需要变换到父组件坐标系才能分发成功，参考下图。</p>     <p>OffsetA为buildNode相对于父组件的偏移量，可以通过FrameNode中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparent12">getPositionToParent</a>获取。OffsetB为point点相对于buildNode的偏移量，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明">TouchEvent</a> 获取。OffsetC为OffsetA与OffsetB的和，是传给postTouchEvent的最终结果。</p>     <p><span><img originheight="401" originwidth="599" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115736.33123936503135380827298248824732:50001231000000:2800:D98321D0BD6111043AC6C532E7E1F18AFB11321AA9083F6EB66CB0F5E4F2D87B.png" width="599" height="401"></span></p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>传入的坐标值需要转换为px，如果builderNode有仿射变换，则需要再叠加仿射变换。</p>       <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview">webview</a>中，内部已经处理过坐标系变换，可以将TouchEvent事件直接下发。</p>       <p>同一时间戳，postTouchEvent只能调用一次。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.11.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明">TouchEvent</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">触摸事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.14.13.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.13.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">          <p>派发事件是否成功。true为已命中响应事件的组件，false为未命中任何可响应事件的组件。</p>          <p><strong>说明：</strong></p>          <p>如果未按照预期命中组件，需要确认以下几点：</p>          <p>1.坐标系是否转换正确。</p>          <p>2.组件是否可交互状态。</p>          <p>3.是否绑定事件。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">ButtonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">`button `</span> + params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>      .<span class="hljs-title function_">gesture</span>(</li><li>        <span class="hljs-title class_">TapGesture</span>()</li><li>          .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"TapGesture"</span>);</li><li>          })</li><li>      )</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">ButtonBuilder</span>);</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"this is a string"</span> });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 坐标转换示例</span></li><li>  <span class="hljs-title function_">postTouchEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">TouchEvent</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">x</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">y</span>;</li><li>    </li><li>    <span class="hljs-keyword">let</span> changedTouchLen = event.<span class="hljs-property">changedTouches</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; changedTouchLen; i++) {</li><li>      <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>        event.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + event.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span>);</li><li>        event.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + event.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 将事件派发至BuiderNode创建的FrameNode上，result记录派发是否成功</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">postTouchEvent</span>(event);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"result "</span> + result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>
</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-title function_">postTouchEvent</span>(event, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="dispose12" device-type="phone,2in1,tablet,wearable,tv">dispose<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="dispose12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>dispose(): void</p>     <p>立即释放当前BuilderNode对象对<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-node#基本概念" target="_blank">实体节点</a>的引用关系。关于BuilderNode的解绑场景请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#解除实体节点引用关系" target="_blank">节点解绑</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当BuilderNode对象调用dispose之后，会与后端实体节点解除引用关系。若前端对象BuilderNode无法释放，容易导致内存泄漏。建议在不再需要对该BuilderNode对象进行操作时，开发者主动调用dispose释放后端节点，以减少引用关系的复杂性，降低内存泄漏的风险。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TestComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'This is a BuilderNode.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToAppear'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToDisappear'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildComponent</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TestComponent</span>()</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WrappedBuilder</span>(buildComponent));</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">200</span> };</li><li>      rootRenderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xff00ff00</span>;</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 解除当前builderNode与后端实体的引用关系</span></li><li>  <span class="hljs-title function_">dispose</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">dispose</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeBuilderNode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>() !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">4</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'BuilderNode dispose'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">removeBuilderNode</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">dispose</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="reuse12" device-type="phone,2in1,tablet,wearable,tv">reuse<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="reuse12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>reuse(param?: Object): void</p>     <p>触发BuilderNode中的自定义组件的复用。组件复用请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable" target="_blank">@Reusable装饰器：组件复用</a>。关于BuilderNode的解绑场景请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#解除实体节点引用关系" target="_blank">节点解绑</a>。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">param</td>         <td class="cellrowborder" width="25%">Object</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">用于复用BuilderNode的参数。该参数将直接用于BuilderNode中所有顶层自定义组件的复用，应该包含每个自定义组件的构造函数参数所需内容，否则，会导致未定义行为。调用此方法将同步触发内部自定义组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttoreuse10">aboutToReuse</a>生命周期回调，并将该参数作为回调的入参。默认值为undefined，此时BuilderNode中的自定义组件将直接使用构造时的数据源。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="recycle12" device-type="phone,2in1,tablet,wearable,tv">recycle<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="recycle12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>recycle(): void</p>     <ul>      <li>触发BuilderNode中自定义组件的回收。自定义组件的回收是组件复用机制中的环节，具体信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable" target="_blank">@Reusable装饰器：组件复用</a>。</li>      <li>BuilderNode通过reuse和recycle完成其内外自定义组件之间的复用事件传递，具体使用场景请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-arktsnode-buildernode#buildernode调用reuse和recycle接口实现节点复用能力" target="_blank">BuilderNode调用reuse和recycle接口实现节点复用能力</a>。</li>     </ul>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TEST_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Reuse+Recycle"</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义管理数据的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">reloadListener</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span>?.<span class="hljs-title function_">onDataReloaded</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span> = listener;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">unregisterDataChangeListener</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listener</span> = <span class="hljs-literal">null</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span> = item;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildNode</span>(<span class="hljs-params">param: Params = <span class="hljs-keyword">new</span> Params(<span class="hljs-string">"hello"</span>)</span>) {</li><li>  <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`C<span class="hljs-subst">${param.item}</span> -- `</span>)</li><li>    <span class="hljs-title class_">ReusableChildComponent2</span>({ <span class="hljs-attr">item</span>: param.<span class="hljs-property">item</span> }) <span class="hljs-comment">//该自定义组件在BuilderNode中无法被正确复用</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">200</span> } });</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildNode), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>));</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 被回收复用的自定义组件，其状态变量会更新，而子自定义组件ReusableChildComponent3中的状态变量也会更新，但BuilderNode会阻断这一传递过程</span></li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ReusableChildComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">switch</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-property">item</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent aboutToRecycle <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>);</li><li>
</li><li>    <span class="hljs-comment">// 当开关为open，通过BuilderNode的reuse接口和recycle接口传递给其下的自定义组件，例如ReusableChildComponent2，完成复用</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">switch</span> === <span class="hljs-string">'open'</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>?.<span class="hljs-property">builderNode</span>?.<span class="hljs-title function_">recycle</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-built_in">object</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent aboutToReuse <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>`</span>);</li><li>
</li><li>    <span class="hljs-comment">// 当开关为open，通过BuilderNode的reuse接口和recycle接口传递给其下的自定义组件，例如ReusableChildComponent2，完成复用</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">switch</span> === <span class="hljs-string">'open'</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>?.<span class="hljs-property">builderNode</span>?.<span class="hljs-title function_">reuse</span>(params);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`A<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>--`</span>)</li><li>      <span class="hljs-title class_">ReusableChildComponent3</span>({ <span class="hljs-attr">item</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span> })</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ReusableChildComponent2</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"false"</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent2 aboutToReuse <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent2 aboutToRecycle <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`D<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span> })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ReusableChildComponent3</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"false"</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params">params: Record&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">object</span>&gt;</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent3 aboutToReuse <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(params)}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TEST_TAG}</span> ReusableChildComponent3 aboutToRecycle <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`B<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.item}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span> })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(i.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ReusableChildComponent</span>({</li><li>              <span class="hljs-attr">item</span>: item,</li><li>              <span class="hljs-attr">switch</span>: <span class="hljs-string">'open'</span> <span class="hljs-comment">// 将open改为close可观察到，BuilderNode不通过reuse和recycle接口传递复用时，BuilderNode内部的自定义组件的行为表现</span></li><li>            })</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="updateconfiguration12" device-type="phone,2in1,tablet,wearable,tv">updateConfiguration<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="updateconfiguration12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>updateConfiguration(): void</p>     <p>传递<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-configuration">系统环境变化</a>事件，触发节点的全量更新。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>updateConfiguration接口用于通知对象更新，更新所使用的系统环境由应用当前的系统环境变化决定。</p>      </div></div></div>     <p><strong>示例：</strong></p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">FrameCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.ArkUI"</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">ConfigurationConstant</span>, <span class="hljs-title class_">EnvironmentCallback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextBuilder</span> {</li><li>  <span class="hljs-comment">// 作为自定义组件中需要更新的属性，数据类型为基础属性，定义为@Prop</span></li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"TextBuilder"</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">36</span> })</li><li>    <span class="hljs-title class_">TextBuilder</span>({ <span class="hljs-attr">message</span>: params.<span class="hljs-property">text</span> }) <span class="hljs-comment">// 自定义组件</span></li><li>  }.<span class="hljs-title function_">backgroundColor</span>($r(<span class="hljs-string">'sys.color.ohos_id_color_background'</span>))</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>?.<span class="hljs-title function_">getFrameNode</span>() ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>?.<span class="hljs-title function_">getFrameNode</span>() : <span class="hljs-literal">null</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">createNode</span>(<span class="hljs-params">context: UIContext</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>));</li><li>    builderNodeMap.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">deleteNode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> node = builderNodeMap.<span class="hljs-title function_">pop</span>();</li><li>    node?.<span class="hljs-title function_">dispose</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">update</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 调用update进行更新</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(message));</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 记录创建的自定义节点对象</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">builderNodeMap</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt;&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFrameCallback</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FrameCallback</span> {</li><li>  <span class="hljs-title function_">onFrame</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title function_">updateColorMode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">updateColorMode</span>(<span class="hljs-params"></span>) {</li><li>  builderNodeMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">value, index</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 通知BuilderNode环境变量改变，触发深浅色切换</span></li><li>    value.<span class="hljs-title function_">updateConfiguration</span>();</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"hello"</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNodeController</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-keyword">private</span> count = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">environmentCallback</span>: <span class="hljs-title class_">EnvironmentCallback</span> = {</li><li>      <span class="hljs-attr">onMemoryLevel</span>: (<span class="hljs-attr">level</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">MemoryLevel</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onMemoryLevel'</span>);</li><li>      },</li><li>      <span class="hljs-attr">onConfigurationUpdated</span>: (<span class="hljs-attr">config</span>: <span class="hljs-title class_">Configuration</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onConfigurationUpdated '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config));</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">postFrameCallback</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyFrameCallback</span>());</li><li>      }</li><li>    };</li><li>    <span class="hljs-comment">// 注册监听回调</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">on</span>(<span class="hljs-string">'environment'</span>, environmentCallback);</li><li>    <span class="hljs-comment">// 设置应用深浅色跟随系统</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>      .<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_NOT_SET</span>);</li><li>    <span class="hljs-comment">//创建自定义节点并添加至map</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>.<span class="hljs-title function_">createNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">//移除map中的引用，并将自定义节点释放</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>.<span class="hljs-title function_">deleteNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFF0F0F0'</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Update'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>;</li><li>            <span class="hljs-keyword">const</span> message = <span class="hljs-string">"Update "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">toString</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNodeController</span>.<span class="hljs-title function_">update</span>(message);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'切换深色'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>              .<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_DARK</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'设置浅色'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>              .<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-title function_">setColorMode</span>(<span class="hljs-title class_">ConfigurationConstant</span>.<span class="hljs-property">ColorMode</span>.<span class="hljs-property">COLOR_MODE_LIGHT</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="isdisposed20" device-type="phone,2in1,tablet,wearable,tv">isDisposed<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="isdisposed20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>isDisposed(): boolean</p>     <p>查询当前BuilderNode对象是否已解除与后端实体节点的引用关系。前端节点均绑定有相应的后端实体节点，当节点调用dispose接口解除绑定后，再次调用接口可能会出现crash、返回默认值的情况。由于业务需求，可能存在节点在dispose后仍被调用接口的情况。为此，提供此接口以供开发者在操作节点前检查其有效性，避免潜在风险。</p>     <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.19.7.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">后端实体节点是否解除引用。true为节点已与后端实体节点解除引用，false为节点未与后端实体节点解除引用。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>该示例演示了BuilderNode释放节点前后分别使用<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#isdisposed20">isDisposed</a>接口验证节点的状态，释放节点前节点调用isDisposed接口返回true，释放节点后节点调用isDisposed接口返回false。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TestComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'This is a BuilderNode.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToAppear'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToDisappear'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildComponent</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">TestComponent</span>()</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">200</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">100</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">WrappedBuilder</span>(buildComponent));</li><li>
</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-property">size</span> = { <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">300</span> };</li><li>      rootRenderNode.<span class="hljs-property">backgroundColor</span> = <span class="hljs-number">0xffd5d5d5</span>;</li><li>      rootRenderNode.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 释放当前builderNode</span></li><li>  <span class="hljs-title function_">dispose</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">dispose</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 检验当前builderNode是否已被释放</span></li><li>  <span class="hljs-title function_">isDisposed</span>() : <span class="hljs-built_in">string</span>{</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">isDisposed</span>()) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'builderNode isDisposed is true'</span>;</li><li>      }</li><li>      <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'builderNode isDisposed is false'</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'builderNode is null'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeBuilderNode</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> rootRenderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>!.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (rootRenderNode !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> !== <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>() !== <span class="hljs-literal">null</span>) {</li><li>      rootRenderNode.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>!.<span class="hljs-title function_">getFrameNode</span>()!.<span class="hljs-title function_">getRenderNode</span>());</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">4</span> }) {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'BuilderNode dispose'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">removeBuilderNode</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">dispose</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-string">''</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'BuilderNode isDisposed'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">isDisposed</span>();</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="550" originwidth="436" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115736.73159461748436820810528904515690:50001231000000:2800:98D04D2856EE6591E8C13FE5F39DD264F0E1A49813195125E9F1F4962A1976DE.gif" width="436" height="550"></span></p>    </div>    <div class="tiledSection">     <h3 id="postinputevent20" device-type="phone,2in1,tablet,wearable,tv">postInputEvent<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="postinputevent20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>postInputEvent(event: InputEventType): boolean</p>     <p>将事件分发到目标节点。</p>     <p>offsetA为builderNode相对于父组件的偏移，offsetB为命中位置相对于builderNode的偏移，offsetC为offsetA+offsetB，最终输入给postInputEvent中的window信息。</p>     <p><span><img originheight="545" originwidth="868" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.77311013925097531669795464680371:50001231000000:2800:7AB7BBEBEE6E3A9A52029680ACD728BECC52B61D254D063B877DEEBB561B2AC5.png" width="868" height="545"></span></p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>传入的坐标值需要转换为px，坐标转换示例可以参考下面示例代码。</p>       <p>鼠标左键点击事件将转换为触摸事件，转发时应注意不在外层同时绑定触摸事件与鼠标事件，否则可能导致坐标偏移。这是由于在事件转换过程中，SourceType不会发生变化，规格可查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#ontouch">onTouch</a>。</p>       <p>注入事件为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-axis#axisevent">轴事件</a>时，由于轴事件中缺少旋转轴信息，因此注入的事件无法触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-gestures-rotationgesture">rotate旋转手势</a>。</p>       <p>转发的事件会在被分发到的目标组件所在的子树里做touchtest，并触发对应手势，原始事件也会触发当前组件所在组件树中的手势。不保证两类手势的竞争结果。</p>       <p>如果是开发者构造的事件，必填字段必须赋值，比如触摸事件的touches字段，轴事件的scrollStep字段。要保证事件的完整，比如触摸事件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-appendix-enums#touchtype">TouchType</a>中DOWN和UP字段都要有，防止出现未定义行为。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview">webview</a>已经处理过坐标系变换，可以将事件直接下发。</p>       <p>postTouchEvent接口需要提供手势坐标相对于post事件对端内的局部坐标，postInputEvent接口需要提供手势坐标相对于post事件对端内的窗口坐标。</p>       <p>不建议同一个事件转发多次。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">event</td>         <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#inputeventtype20">InputEventType</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">用于透传的输入事件。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.20.12.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.12.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">boolean</td>         <td class="cellrowborder" width="50%">事件是否被成功派发。如果事件派发成功，则返回true；否则，返回false。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>请参考<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#示例1鼠标事件">示例1（鼠标事件）</a>、<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#示例2触摸事件">示例2（触摸事件）</a>、<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#示例3轴事件">示例3（轴事件）</a>。</p>    </div>    <div class="tiledSection">     <h3 id="inheritfreezeoptions20" device-type="phone,2in1,tablet,wearable,tv">inheritFreezeOptions<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="inheritfreezeoptions20" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>inheritFreezeOptions(enabled: boolean): void</p>     <p>查询当前BuilderNode对象是否设置为继承父组件中自定义组件的冻结策略。如果设置继承状态为false，则BuilderNode对象的冻结策略为false。在这种情况下，节点在不活跃状态下不会被冻结。</p>     <p><strong>元服务API：</strong> 从API version 20开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">enabled</td>         <td class="cellrowborder" width="25%">boolean</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">BuilderNode对象是否设置为继承父组件中自定义组件的冻结策略。true为继承父组件中自定义组件的冻结策略，false为不继承父组件中自定义组件的冻结策略。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>该示例演示了BuilderNode设置继承状态为True，继承父自定义组件的冻结策略，在不活跃的时候进行冻结，切换为活跃状态解冻，更新缓存的数据。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">NodeController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span> <span class="hljs-comment">// builder组件</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>
</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">TextBuilder</span>({ <span class="hljs-attr">message</span>: params.<span class="hljs-property">count</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">textNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context, { <span class="hljs-attr">selfIdealSize</span>: { <span class="hljs-attr">width</span>: <span class="hljs-number">150</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">150</span> } });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>)); <span class="hljs-comment">// 创建BuilderNode节点</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">inheritFreezeOptions</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 设置BuilderNode的冻结继承状态为True</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">getFrameNode</span>()); <span class="hljs-comment">// 将BuilderNode上树</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">update</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span> !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textNode</span>.<span class="hljs-title function_">update</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>)); <span class="hljs-comment">// 更新BuilderNode中的数据，可以触发Log</span></li><li>    }</li><li>
</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">textNodeController</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-title function_">pageOneStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title function_">pageTwoStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update builderNode'</span>) <span class="hljs-comment">// 点击更新BuildrNode</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          textNodeController.<span class="hljs-title function_">update</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">// 将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct pageOneStack { <span class="hljs-comment">// 页面一</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> }) <span class="hljs-comment">// 切换至页面二</span></li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> }) <span class="hljs-comment">// 返回主页面</span></li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct pageTwoStack { <span class="hljs-comment">// 页面二</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>, <span class="hljs-attr">logNumber</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNumber</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'BuilderNode处于冻结'</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">48</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">48</span> })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> }) <span class="hljs-comment">// 返回至页面一</span></li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> }) <span class="hljs-comment">// 设置冻结策略为不活跃冻结</span></li><li>struct <span class="hljs-title class_">NavigationContentMsgStack</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">logNumber</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> === <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-title class_">NodeContainer</span>(textNodeController)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> }) <span class="hljs-comment">// 设置冻结策略为不活跃冻结</span></li><li>struct <span class="hljs-title class_">TextBuilder</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">"info"</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> count : <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">info</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`freeze-test TextBuilder message callback change time <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>); <span class="hljs-comment">// 根据message内容变化来打印日志来判断是否冻结</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`freeze-test TextBuilder message callback change massage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>); <span class="hljs-comment">// 根据message内容变化来打印日志来判断是否冻结</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`文本更新内容： <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">48</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">48</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`文本更新次数： <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">48</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">48</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="544" originwidth="258" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.74229540336872719256809856177355:50001231000000:2800:0517D8D1418FA89D1A43886FE8738D21FFD89F8F02EB98ED416A1C414D895474.gif" class="notEnlarge" width="258" height="544"></span></p>    </div>    <div class="tiledSection">     <h2 id="示例" device-type="phone,2in1,tablet,wearable,tv">示例<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="示例" tips="复制节点链接"></i></h2>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>    <div class="tiledSection">     <h3 id="示例1鼠标事件" class="firsth2">示例1（鼠标事件）<i class="anchor-icon anchor-icon-link" anchorid="示例1鼠标事件" tips="复制节点链接"></i></h3>          <p>该示例演示了在自定义组件中截获鼠标事件并进行坐标转换的完整流程。组件通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-mouse-key#onmouse">onMouse</a>回调读取本地x/y，再结合FrameNode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-framenode#getpositiontoparent12">getPositionToParent</a>()得到的偏移量，调用vp2px将相对坐标转换为像素坐标，更新<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-mouse-key#mouseevent对象说明">MouseEvent</a>的windowX/windowY、displayX/displayY。最后通过rootNode.<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#postinputevent20">postInputEvent</a>(event)将转换后的鼠标事件分发给子节点进行处理。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">PromptAction</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">InputEventType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义参数传递的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span></li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span></li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">ButtonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"45%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"30%"</span>)</li><li>      .<span class="hljs-title function_">offset</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span> })</li><li>      .<span class="hljs-title function_">onMouse</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = params.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getPromptAction</span>();</li><li>        promptAction.<span class="hljs-title function_">showToast</span>({</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'onMouse'</span>,</li><li>          <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span></li><li>        });</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onMouse'</span>)</li><li>      })</li><li>      .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = params.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getPromptAction</span>();</li><li>        promptAction.<span class="hljs-title function_">showToast</span>({</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'onTouch'</span>,</li><li>          <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span></li><li>        });</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onTouch'</span>)</li><li>      })</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">ButtonBuilder</span>);</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"This is a string"</span>, uiContext })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postMouseEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">InputEventType</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 读取本地x、y与buildNode相对于父组件的偏移量，转换为像素坐标</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">x</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">y</span>;</li><li>
</li><li>    <span class="hljs-keyword">let</span> mouseEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">MouseEvent</span>;</li><li>    <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>      mouseEvent.<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + mouseEvent.<span class="hljs-property">x</span>)</li><li>      mouseEvent.<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + mouseEvent.<span class="hljs-property">y</span>)</li><li>      mouseEvent.<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + mouseEvent.<span class="hljs-property">x</span>)</li><li>      mouseEvent.<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + mouseEvent.<span class="hljs-property">y</span>)</li><li>      mouseEvent.<span class="hljs-property">x</span> = uiContext.<span class="hljs-title function_">vp2px</span>(mouseEvent.<span class="hljs-property">x</span>)</li><li>      mouseEvent.<span class="hljs-property">y</span> = uiContext.<span class="hljs-title function_">vp2px</span>(mouseEvent.<span class="hljs-property">y</span>)</li><li>    }</li><li>    <span class="hljs-comment">// 将鼠标事件派发至BuiderNode创建的FrameNode上，result记录派发是否成功</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">postInputEvent</span>(event);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postTouchEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">InputEventType</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 读取本地x、y与buildNode相对于父组件的偏移量，转换为像素坐标</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">x</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">y</span>;</li><li>
</li><li>    <span class="hljs-keyword">let</span> touchEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">TouchEvent</span>;</li><li>    <span class="hljs-keyword">let</span> changedTouchLen = touchEvent.<span class="hljs-property">changedTouches</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; changedTouchLen; i++) {</li><li>      <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>        touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span>);</li><li>        touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span>);</li><li>        touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span>);</li><li>        touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">let</span> touchesLen = touchEvent.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; touchesLen; i++) {</li><li>      <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>        touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">x</span>);</li><li>        touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">y</span>);</li><li>        touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">x</span>);</li><li>        touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">y</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-comment">// 将触摸事件派发至BuiderNode创建的FrameNode上，result记录派发是否成功</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">postInputEvent</span>(event);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>        .<span class="hljs-title function_">onMouse</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-title function_">postMouseEvent</span>(event, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-title function_">postTouchEvent</span>(event, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>          }</li><li>        })</li><li>    }.<span class="hljs-title function_">offset</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">100</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="1138" originwidth="702" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.13043960126788081106698582210466:50001231000000:2800:413F5C9034D0E7524F98D4D9DBF9D0EAA37F419365B4BD51928FBA77E145A9F5.gif" width="702" height="1138"></span></p>    </div>    <div class="tiledSection">     <h3 id="示例2触摸事件">示例2（触摸事件）<i class="anchor-icon anchor-icon-link" anchorid="示例2触摸事件" tips="复制节点链接"></i></h3>          <p>该示例演示了在自定义组件中截获触摸事件并对触点坐标进行转换的完整流程。在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#ontouch">onTouch</a>回调中，遍历<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-touch#touchevent对象说明">TouchEvent</a>的changedTouches和touches数组，对每个触点的x/y加上组件偏移量并调用vp2px转换为像素，更新各自的windowX/windowY、displayX/displayY。最后同样通过rootNode.postInputEvent(event)将转换后的触摸事件分发给子节点处理。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">PromptAction</span>, <span class="hljs-title class_">InputEventType</span>  } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span></li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span></li><li>}</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">ButtonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"45%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"30%"</span>)</li><li>      .<span class="hljs-title function_">offset</span>({<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>})</li><li>      .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = params.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getPromptAction</span>();</li><li>        promptAction.<span class="hljs-title function_">showToast</span>({</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'onTouch'</span>,</li><li>          <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span></li><li>        });</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onTouch'</span>)</li><li>      })</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">ButtonBuilder</span>);</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"This is a string"</span>, uiContext })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postInputEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">InputEventType</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 读取本地x、y与buildNode相对于父组件的偏移量，转换为像素坐标</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">x</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">y</span>;</li><li>
</li><li>    <span class="hljs-comment">// 只转发原始事件，不转发鼠标模拟的触摸事件</span></li><li>    <span class="hljs-keyword">if</span> (event.<span class="hljs-property">source</span> == <span class="hljs-title class_">SourceType</span>.<span class="hljs-property">TouchScreen</span>) {</li><li>      <span class="hljs-keyword">let</span> touchEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">TouchEvent</span>;</li><li>      <span class="hljs-keyword">let</span> changedTouchLen = touchEvent.<span class="hljs-property">changedTouches</span>.<span class="hljs-property">length</span>;</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; changedTouchLen; i++) {</li><li>        <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>          touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span>);</li><li>          touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span>);</li><li>          touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">x</span>);</li><li>          touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">changedTouches</span>[i].<span class="hljs-property">y</span>);</li><li>        }</li><li>      }</li><li>      <span class="hljs-keyword">let</span> touchesLen = touchEvent.<span class="hljs-property">touches</span>.<span class="hljs-property">length</span>;</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; touchesLen; i++) {</li><li>        <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>          touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">x</span>);</li><li>          touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">y</span>);</li><li>          touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">x</span>);</li><li>          touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + touchEvent.<span class="hljs-property">touches</span>[i].<span class="hljs-property">y</span>);</li><li>        }</li><li>      }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 将触摸事件派发至BuiderNode创建的FrameNode上，result记录派发是否成功</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">postInputEvent</span>(event);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-title function_">postInputEvent</span>(event, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>          }</li><li>        })</li><li>    }.<span class="hljs-title function_">offset</span>({<span class="hljs-attr">top</span>: <span class="hljs-number">100</span>})</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="1148" originwidth="696" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.47519398752669405040765343959999:50001231000000:2800:7399C59D7AF372836D8FEEC3E5F006D1494D42BC33E4771C20852B330F64CDB4.gif" width="696" height="1148"></span></p>    </div>    <div class="tiledSection">     <h3 id="示例3轴事件">示例3（轴事件）<i class="anchor-icon anchor-icon-link" anchorid="示例3轴事件" tips="复制节点链接"></i></h3>          <p>该示例演示了在自定义组件中截获滚轮或触控板轴事件并进行坐标转换的完整流程。在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-axis#onaxisevent">onAxisEvent</a>回调中，先获取事件的相对x/y，再加上组件偏移量后调用vp2px转换为像素，更新AxisEvent的windowX/windowY、displayX/displayY，最后通过rootNode.postInputEvent(event)将转换后的轴事件分发给子节点进行处理。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span>, <span class="hljs-title class_">PromptAction</span>, <span class="hljs-title class_">InputEventType</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"this is a text"</span></li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span></li><li>}</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">ButtonBuilder</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Button</span>(params.<span class="hljs-property">text</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">"45%"</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"30%"</span>)</li><li>      .<span class="hljs-title function_">offset</span>({<span class="hljs-attr">x</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>})</li><li>      .<span class="hljs-title function_">onAxisEvent</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">promptAction</span>: <span class="hljs-title class_">PromptAction</span> = params.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">getPromptAction</span>();</li><li>        promptAction.<span class="hljs-title function_">showToast</span>({</li><li>          <span class="hljs-attr">message</span>: <span class="hljs-string">'onAxisEvent'</span>,</li><li>          <span class="hljs-attr">duration</span>: <span class="hljs-number">3000</span></li><li>        });</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onAxisEvent'</span>)</li><li>      })</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>}</li><li><span class="hljs-comment">// 继承NodeController实现自定义UI控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">wrapBuilder</span>: <span class="hljs-title class_">WrappedBuilder</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; = <span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">ButtonBuilder</span>);</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(uiContext);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wrapBuilder</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">"This is a string"</span>, uiContext })</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">postInputEvent</span>(<span class="hljs-attr">event</span>: <span class="hljs-title class_">InputEventType</span>, <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 读取本地x、y与buildNode相对于父组件的偏移量，转换为像素坐标</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">node</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">x</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> | <span class="hljs-literal">undefined</span> = node?.<span class="hljs-title function_">getPositionToParent</span>().<span class="hljs-property">y</span>;</li><li>
</li><li>    <span class="hljs-keyword">let</span> axisEvent = event <span class="hljs-keyword">as</span> <span class="hljs-title class_">AxisEvent</span>;</li><li>    <span class="hljs-keyword">if</span> (offsetX != <span class="hljs-literal">null</span> &amp;&amp; offsetY != <span class="hljs-literal">null</span> &amp;&amp; offsetX != <span class="hljs-literal">undefined</span> &amp;&amp; offsetY != <span class="hljs-literal">undefined</span>) {</li><li>      axisEvent.<span class="hljs-property">windowX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + axisEvent.<span class="hljs-property">x</span>)</li><li>      axisEvent.<span class="hljs-property">windowY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + axisEvent.<span class="hljs-property">y</span>)</li><li>      axisEvent.<span class="hljs-property">displayX</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetX + axisEvent.<span class="hljs-property">x</span>)</li><li>      axisEvent.<span class="hljs-property">displayY</span> = uiContext.<span class="hljs-title function_">vp2px</span>(offsetY + axisEvent.<span class="hljs-property">y</span>)</li><li>      axisEvent.<span class="hljs-property">x</span> = uiContext.<span class="hljs-title function_">vp2px</span>(axisEvent.<span class="hljs-property">x</span>)</li><li>      axisEvent.<span class="hljs-property">y</span> = uiContext.<span class="hljs-title function_">vp2px</span>(axisEvent.<span class="hljs-property">y</span>)</li><li>    }</li><li>    <span class="hljs-comment">// 将轴事件派发至BuiderNode创建的FrameNode上，result记录派发是否成功</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">postInputEvent</span>(event);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">nodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>      <span class="hljs-title class_">Column</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Transparent</span>)</li><li>        .<span class="hljs-title function_">onAxisEvent</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event != <span class="hljs-literal">undefined</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">nodeController</span>.<span class="hljs-title function_">postInputEvent</span>(event, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>          }</li><li>        })</li><li>    }.<span class="hljs-title function_">offset</span>({<span class="hljs-attr">top</span>: <span class="hljs-number">100</span>})</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="1152" originwidth="694" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.19973611351002960699095650318400:50001231000000:2800:C11353AE65F2FB8CD080CF66C70B91FBE7F1C9182FC75C71E41A6CBE905DBA36.gif" width="694" height="1152"></span></p>    </div>    <div class="tiledSection">     <h3 id="示例4buildernode共享localstorage">示例4（BuilderNode共享localStorage）<i class="anchor-icon anchor-icon-link" anchorid="示例4buildernode共享localstorage" tips="复制节点链接"></i></h3>          <p>该示例演示了如何在BuilderNode通过build方法传入外部<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-state-management#localstorage9">localStorage</a>，此时挂载在BuilderNode的所有自定义组件共享该localStorage。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义传递参数的类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Params</span> {</li><li>  <span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">text</span> = text;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalBuilderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-title class_">Params</span>]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'BuildNodeContentArea'</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>    <span class="hljs-title class_">CustomComp</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 继承NodeController实现自定义textNode控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-keyword">if</span> (globalBuilderNode === <span class="hljs-literal">null</span>) {</li><li>      globalBuilderNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>      <span class="hljs-comment">// 传入外部localStorage，共享给挂载在当前BuilderNode的所有自定义组件</span></li><li>      globalBuilderNode.<span class="hljs-title function_">build</span>(wrapBuilder&lt;[<span class="hljs-title class_">Params</span>]&gt;(buildText), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Params</span>(<span class="hljs-string">'builder node text'</span>), { <span class="hljs-attr">localStorage</span>: localStorage1 })</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(globalBuilderNode.<span class="hljs-title function_">getFrameNode</span>());</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 创建LocalStorage并设置初始值</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage1</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage1.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(localStorage1)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>();</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span>)</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeLocalstorage'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          localStorage1.<span class="hljs-title function_">set</span>(<span class="hljs-string">'PropA'</span>,<span class="hljs-string">'AfterChange'</span>)</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomComp</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="示例5buildernode支持内部consume接收外部的provide数据">示例5（BuilderNode支持内部@Consume接收外部的@Provide数据）<i class="anchor-icon anchor-icon-link" anchorid="示例5buildernode支持内部consume接收外部的provide数据" tips="复制节点链接"></i></h3>          <p>设置BuilderNode的<a href="/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildoptions12">BuildOptions</a>中enableProvideConsumeCrossing为true，以实现BuilderNode内部自定义组件的@Consume与所在自定义组件的@Provide数据互通。</p>     <div _ngcontent-auy-c106="" class="highlight-div"><div _ngcontent-auy-c106="" class="highlight-div-header"><div _ngcontent-auy-c106="" class="highlight-div-header-left"><div _ngcontent-auy-c106="" class="handle-button expand-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-auy-c106="" class="highlight-div-header-right"><div _ngcontent-auy-c106="" class="handle-button ai-button"></div><div _ngcontent-auy-c106="" class="handle-button line-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-auy-c106="" class="handle-button theme-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-auy-c106="" class="handle-button copy-button"><div _ngcontent-auy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-auy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">NodeContent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-comment">// 自定义组件</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ConsumeChild</span> {</li><li>  <span class="hljs-comment">// 与外部的@Provider数据互通</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">"ChangeData"</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>
</li><li>  <span class="hljs-title class_">ChangeData</span>() {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`ChangeData <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Click to change message to append C"</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 修改Consume的变量</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">"C"</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">CreateText</span>(<span class="hljs-params">textMessage: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Text</span>(textMessage)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    <span class="hljs-title class_">ConsumeChild</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 与内部的@Consumer数据互通</span></li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">content</span>: <span class="hljs-title class_">NodeContent</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NodeContent</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-built_in">string</span>]&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>&lt;[<span class="hljs-built_in">string</span>]&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 设置enableProvideConsumeCrossing为true，支持BuilderNode内部自定义组件ConsumeChild的@Consume与其所在页面中的@Provide数据互通</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(<span class="hljs-title class_">CreateText</span>), <span class="hljs-string">"Test Consume"</span>, { <span class="hljs-attr">enableProvideConsumeCrossing</span>: <span class="hljs-literal">true</span> })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>.<span class="hljs-title function_">addFrameNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>())</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Click to change message to append I"</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> + <span class="hljs-string">"I"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ContentSlot</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="252" originwidth="452" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115737.02122366644813637069131673892433:50001231000000:2800:EA04472F37261547047D6BF4523A00A1E6C3E100C46E2C27BD887F035CF30577.gif" width="452" height="252"></span></p>    </div>   </div>   <div></div></div>