<h1 _ngcontent-kgx-c119="" class="doc-title ng-star-inserted" title="CallerInfoQueryExtensionAbility (来去电信息查询扩展Ability)"> CallerInfoQueryExtensionAbility (来去电信息查询扩展Ability) </h1>

<div _ngcontent-kgx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>CallerInfoQueryExtensionAbility是来去电信息查询扩展Ability，提供通话来去电页面显示企业联系人信息的能力。有如下约束：</p> <ul><li>CallerInfoQueryExtensionAbility需求场景面向企业，仅供企业应用开发者接入。</li><li>CallerInfoQueryExtensionAbility为轻量级独立子进程，不允许唤醒主进程，进程存在最长时间为2秒，超时后自动销毁。</li></ul> <p><strong>起始版本：</strong>5.0.2(14)</p> <div class="tiledSection"><h2 id="section10212628194717" device-type="phone,tablet,2in1,wearable">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10212628194717" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><div _ngcontent-kgx-c106="" class="highlight-div"><div _ngcontent-kgx-c106="" class="highlight-div-header"><div _ngcontent-kgx-c106="" class="highlight-div-header-left"><div _ngcontent-kgx-c106="" class="handle-button expand-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kgx-c106="" class="highlight-div-header-right"><div _ngcontent-kgx-c106="" class="handle-button ai-button"></div><div _ngcontent-kgx-c106="" class="handle-button line-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kgx-c106="" class="handle-button theme-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kgx-c106="" class="handle-button copy-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-keyword">import</span></span> {<span class=""> <span class="hljs-title class_">CallerInfoQueryExtensionAbility</span></span>, <span class=""><span class="hljs-title class_">CallerInfo</span></span> } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section534615186553" device-type="phone,tablet,2in1,wearable">CallerInfoQueryExtensionAbility<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section534615186553" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p><strong>模型约束：</strong>属性仅可在Stage模型下使用。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.NumberIdentifyService</p> <p><strong>起始版本：</strong>5.0.2(14)</p> <p><strong>说明</strong><strong>：</strong>由于调用onQueryCallerInfo方法时，系统先创建应用的AbilityStage实例，请勿在AbilityStage中添加过于复杂耗时的逻辑，避免调用超时。</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.1" width="20%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.2" width="21.759999999999998%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.3" width="7.99%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.4" width="6.74%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.5" width="43.51%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td align="left" class="cellrowborder" width="20%"><p>context</p> </td> <td class="cellrowborder" width="21.759999999999998%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/callservicekit-callerinfoquery-extension-context">CallerInfoQueryExtensionContext</a></p> </td> <td align="left" class="cellrowborder" width="7.99%"><p>否</p> </td> <td align="left" class="cellrowborder" width="6.74%"><p>否</p> </td> <td class="cellrowborder" width="43.51%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/callservicekit-callerinfoquery-extension-context#section414112373819">CallerInfoQueryExtensionContext</a>的上下文环境，继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section261103315167" device-type="phone,tablet,2in1,wearable" class="firsth2">onQueryCallerInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section261103315167" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>onQueryCallerInfo(phoneNumber: string):Promise<span style="color: rgb(128,128,128);">&lt;</span><a href="/consumer/cn/doc/harmonyos-references/callservicekit-callerinfoquery-extension-ability#section1220554318191">CallerInfo</a><span style="color: rgb(128,128,128);">&gt;</span></p> <p>查询企业联系人接口，利用Promise返回查询结果，供来电和去电页面展示。企业应用需继承CallerInfoQueryExtensionAbility实现该接口，接口查询时间建议小于1s。由于通话应用会对已查询过的联系人进行缓存，若需清除该联系人缓存信息请使用resolve({ contactName: '' })。</p> <p><strong>模型约束：</strong>属性仅可在Stage模型下使用。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.NumberIdentifyService</p> <p><strong>起始版本：</strong>5.0.2(14)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>phoneNumber</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>需要查询的号码</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/callservicekit-callerinfoquery-extension-ability#section1220554318191">CallerInfo</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回查询的号码信息。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-kgx-c106="" class="highlight-div"><div _ngcontent-kgx-c106="" class="highlight-div-header"><div _ngcontent-kgx-c106="" class="highlight-div-header-left"><div _ngcontent-kgx-c106="" class="handle-button expand-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kgx-c106="" class="highlight-div-header-right"><div _ngcontent-kgx-c106="" class="handle-button ai-button"></div><div _ngcontent-kgx-c106="" class="handle-button line-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kgx-c106="" class="handle-button theme-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kgx-c106="" class="handle-button copy-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-keyword">import</span></span> { <span class=""><span class="hljs-title class_">CallerInfoQueryExtensionAbility</span></span>, <span class=""><span class="hljs-title class_">CallerInfo</span></span> } <span class=""><span class="hljs-keyword">from</span></span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span>;</li><li>
</li><li><span class=""><span class="hljs-keyword">export</span></span> <span class=""><span class="hljs-keyword">default</span></span> <span class=""><span class="hljs-keyword">class</span></span> <span class=""><span class="hljs-title class_">EntryCallerInfoQueryExtAbility</span></span> <span class=""><span class="hljs-keyword">extends</span></span> <span class=""><span class="hljs-title class_ inherited__">CallerInfoQueryExtensionAbility</span></span> {</li><li>  <span class=""><span class="hljs-title function_">onQueryCallerInfo</span></span>(<span class=""><span class="hljs-attr">phoneNumber</span></span>: <span class=""><span class="hljs-built_in">string</span></span>): <span class=""><span class="hljs-title class_">Promise</span></span>&lt;<span class=""><span class="hljs-title class_">CallerInfo</span></span>&gt; {</li><li>    <span class=""><span class="hljs-keyword">return</span></span> <span class=""><span class="hljs-keyword">new</span></span> <span class=""><span class="hljs-title class_">Promise</span></span>&lt;<span class=""><span class="hljs-title class_">CallerInfo</span></span>&gt;(<span class="hljs-function">(</span><span class=""><span class="hljs-function"><span class="hljs-params">resolve</span></span></span><span class="hljs-function"><span class="hljs-params">, </span></span><span class=""><span class="hljs-function"><span class="hljs-params">reject</span></span></span><span class="hljs-function">) </span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> {</li><li>      <span class=""><span class="hljs-keyword">let</span></span> <span class="">isSuccess</span> = <span class=""><span class="hljs-literal">true</span></span>;</li><li>      <span class=""><span class="hljs-comment">// 在此处实现根据号码查询企业联系人的业务逻辑</span></span></li><li>      <span class=""><span class="hljs-keyword">if</span></span> (<span class="">isSuccess</span>) {</li><li>        <span class=""><span class="hljs-comment">// 查询成功，返回结果</span></span></li><li>        <span class=""><span class="hljs-title function_">resolve</span></span>({</li><li>          <span class=""><span class="hljs-attr">contactName</span>:</span><span class=""><span class="hljs-string">"xxxx"</span></span>,</li><li>          <span class=""><span class="hljs-attr">employeeId</span>:</span><span class=""><span class="hljs-string">"xxxx"</span></span>,</li><li>          <span class=""><span class="hljs-attr">department</span>:</span><span class=""><span class="hljs-string">"xxxx"</span></span>,</li><li>          <span class=""><span class="hljs-attr">position</span>:</span><span class=""><span class="hljs-string">"xxxx"</span></span></li><li>        });</li><li>      } <span class=""><span class="hljs-keyword">else</span></span> {</li><li>        <span class=""><span class="hljs-comment">// 查询失败，返回错误原因</span></span></li><li>        <span class=""><span class="hljs-title function_">reject</span></span>(<span class=""><span class="hljs-string">"error reason"</span></span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> <p><strong>RDB场景示例：</strong></p> <div _ngcontent-kgx-c106="" class="highlight-div"><div _ngcontent-kgx-c106="" class="highlight-div-header"><div _ngcontent-kgx-c106="" class="highlight-div-header-left"><div _ngcontent-kgx-c106="" class="handle-button expand-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kgx-c106="" class="highlight-div-header-right"><div _ngcontent-kgx-c106="" class="handle-button ai-button"></div><div _ngcontent-kgx-c106="" class="handle-button line-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kgx-c106="" class="handle-button theme-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kgx-c106="" class="handle-button copy-button"><div _ngcontent-kgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { relationalStore } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">CallerInfo</span>, <span class="hljs-title class_">CallerInfoQueryExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CallServiceKit'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryCallerInfoQueryExtAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CallerInfoQueryExtensionAbility</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">onQueryCallerInfo</span>(<span class="hljs-attr">phoneNumber</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">CallerInfo</span>&gt; {</li><li>    <span class="hljs-comment">// 使用rdb场景需转化context类型</span></li><li>    <span class="hljs-keyword">const</span> context = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> <span class="hljs-keyword">as</span> common.<span class="hljs-property">ExtensionContext</span>).<span class="hljs-title function_">getApplicationContext</span>();</li><li>    <span class="hljs-keyword">let</span> store = <span class="hljs-keyword">await</span> relationalStore.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-literal">null</span>);</li><li>    <span class="hljs-comment">// 查询rdb数据后返回</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">CallerInfo</span>&gt;(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> isSuccess = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-comment">// 在此处实现根据号码查询企业联系人的业务逻辑</span></li><li>      <span class="hljs-keyword">if</span> (isSuccess) {</li><li>        <span class="hljs-comment">// 查询成功，返回结果</span></li><li>        <span class="hljs-title function_">resolve</span>({</li><li>          <span class="hljs-attr">contactName</span>: <span class="hljs-string">"xxxx"</span>,</li><li>          <span class="hljs-attr">employeeId</span>: <span class="hljs-string">"xxxx"</span>,</li><li>          <span class="hljs-attr">department</span>: <span class="hljs-string">"xxxx"</span>,</li><li>          <span class="hljs-attr">position</span>: <span class="hljs-string">"xxxx"</span></li><li>        });</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 查询失败，返回错误原因</span></li><li>        <span class="hljs-title function_">reject</span>(<span class="hljs-string">"error reason"</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1220554318191" device-type="phone,tablet,2in1,wearable">CallerInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1220554318191" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>联系人信息。</p> <p><strong>模型约束：</strong>属性仅可在Stage模型下使用。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.NumberIdentifyService</p> <p><strong>起始版本：</strong>5.0.2(14)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.1" width="23.12%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.2" width="23.12%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.3" width="15.930000000000003%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.4" width="14.710000000000004%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.6.1.5" width="23.12%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.12%"><p>contactName</p> </td> <td class="cellrowborder" width="23.12%"><p>string</p> </td> <td class="cellrowborder" width="15.930000000000003%"><p>否</p> </td> <td class="cellrowborder" width="14.710000000000004%"><p>否</p> </td> <td class="cellrowborder" width="23.12%"><p>联系人姓名：为保证页面最佳显示效果，字数建议限制在20字以内</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>employeeId</p> </td> <td class="cellrowborder" width="23.12%"><p>string</p> </td> <td class="cellrowborder" width="15.930000000000003%"><p>否</p> </td> <td class="cellrowborder" width="14.710000000000004%"><p>是</p> </td> <td class="cellrowborder" width="23.12%"><p>工号：为保证页面最佳显示效果，字数建议限制在20字以内</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>department</p> </td> <td class="cellrowborder" width="23.12%"><p>string</p> </td> <td class="cellrowborder" width="15.930000000000003%"><p>否</p> </td> <td class="cellrowborder" width="14.710000000000004%"><p>是</p> </td> <td class="cellrowborder" width="23.12%"><p>部门：为保证页面最佳显示效果，字数建议限制在20字以内</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>position</p> </td> <td class="cellrowborder" width="23.12%"><p>string</p> </td> <td class="cellrowborder" width="15.930000000000003%"><p>否</p> </td> <td class="cellrowborder" width="14.710000000000004%"><p>是</p> </td> <td class="cellrowborder" width="23.12%"><p>职位：为保证页面最佳显示效果，字数建议限制在20字以内</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>