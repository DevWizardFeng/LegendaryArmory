<h1 _ngcontent-abs-c119="" class="doc-title ng-star-inserted" title="Class (MeasureUtils)"> Class (MeasureUtils) </h1>

<div _ngcontent-abs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>提供文本宽度、高度等相关计算。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>        <p>本模块首批接口从API version 10开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p></li>       <li>        <p>本Class首批接口从API version 12开始支持。</p></li>       <li>        <p>以下API需先使用UIContext中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getmeasureutils12">getMeasureUtils()</a>方法获取MeasureUtils实例，再通过此实例调用对应方法。</p></li>       <li>        <p>如需更多测算文本参数，建议使用图形对应测算接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#paragraph">Paragraph</a>接口。</p></li>       <li>        <p>调用文本计算接口时，不推荐同时用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetfontsizescale13">ApplicationContext.setFontSizeScale</a>设置应用字体大小缩放比例。为了确保时序正确性，建议开发者自行监听字体缩放变化，以保证测算结果的准确性。</p></li>       <li>        <p>在测算裁剪后的文本时，由于某些Unicode字符（如emoji）的码位长度大于1，直接按字符串长度裁剪会导致不准确的结果。建议基于Unicode码点进行迭代处理，避免错误截断字符，确保测算结果准确，请参考<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-measureutils#measuretextsize12">measureTextSize方法的示例2</a>。</p></li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="measuretext12" device-type="phone,2in1,tablet,wearable,tv">measureText<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="measuretext12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>measureText(options: MeasureOptions): number</p>     <p>计算指定文本作为单行文本显示时的宽度。如果文本包含多行（由换行符\n分隔），则返回其中最长的行的宽度。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>measureText接口的计算结果始终是单行文本的宽度，入参options中配置的布局约束（如constraintWidth、maxLines）对measureText的结果没有影响。如果需要计算布局约束下的宽度，请使用<a href="/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-measureutils#measuretextsize12">measureTextSize</a>方法。</p>      </div></div></div>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-measure#measureoptions">MeasureOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">被计算文本描述信息。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.3.10.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.10.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">number</td>         <td class="cellrowborder" width="50%">          <p>文本宽度。</p>          <p><strong>说明:</strong></p>          <p>浮点数会向上取整。</p>          <p>单位：px</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>通过MeasureUtils的measureText方法获取"Hello World"文字的宽度。</p>     <div _ngcontent-abs-c106="" class="highlight-div"><div _ngcontent-abs-c106="" class="highlight-div-header"><div _ngcontent-abs-c106="" class="highlight-div-header-left"><div _ngcontent-abs-c106="" class="handle-button expand-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-abs-c106="" class="highlight-div-header-right"><div _ngcontent-abs-c106="" class="handle-button ai-button"></div><div _ngcontent-abs-c106="" class="handle-button line-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-abs-c106="" class="handle-button theme-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-abs-c106="" class="handle-button copy-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-abs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MeasureUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uiContextMeasure</span>: <span class="hljs-title class_">MeasureUtils</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getMeasureUtils</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContextMeasure</span>.<span class="hljs-title function_">measureText</span>({</li><li>    <span class="hljs-attr">textContent</span>: <span class="hljs-string">"Hello World"</span>,</li><li>    <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'50px'</span></li><li>  });</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The width of 'Hello World': <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textWidth}</span>`</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="measuretextsize12" device-type="phone,2in1,tablet,wearable,tv">measureTextSize<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="measuretextsize12" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>measureTextSize(options: MeasureOptions): SizeOptions</p>     <p>计算指定文本单行布局下的宽度和高度。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-measure#measureoptions">MeasureOptions</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">被计算文本描述信息。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#sizeoptions">SizeOptions</a></td>         <td class="cellrowborder" width="50%">          <p>返回文本所占布局宽度和高度。</p>          <p><strong>说明:</strong></p>          <p>没有传参constraintWidth的情况下，文本宽度返回值浮点数会向上取整。</p>          <p>文本宽度以及高度返回值单位均为px。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例1：</strong></p>     <p>通过MeasureUtils的measureTextSize方法获取"Hello World"文字的宽度和高度。</p>     <div _ngcontent-abs-c106="" class="highlight-div"><div _ngcontent-abs-c106="" class="highlight-div-header"><div _ngcontent-abs-c106="" class="highlight-div-header-left"><div _ngcontent-abs-c106="" class="handle-button expand-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-abs-c106="" class="highlight-div-header-right"><div _ngcontent-abs-c106="" class="handle-button ai-button"></div><div _ngcontent-abs-c106="" class="handle-button line-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-abs-c106="" class="handle-button theme-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-abs-c106="" class="handle-button copy-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-abs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MeasureUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uiContextMeasure</span>: <span class="hljs-title class_">MeasureUtils</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>.<span class="hljs-title function_">getMeasureUtils</span>();</li><li>  <span class="hljs-attr">textSize</span>: <span class="hljs-title class_">SizeOptions</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContextMeasure</span>.<span class="hljs-title function_">measureTextSize</span>({</li><li>    <span class="hljs-attr">textContent</span>: <span class="hljs-string">"Hello World"</span>,</li><li>    <span class="hljs-attr">fontSize</span>: <span class="hljs-string">'50px'</span></li><li>  });</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The width of 'Hello World': <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textSize.width}</span>`</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The height of 'Hello World': <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textSize.height}</span>`</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>示例2：</strong></p>     <p>通过MeasureUtils的measureTextSize方法和unicode码点计算，手动实现文本截断。与设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#maxlines">maxLines</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#textoverflow">textOverflow</a>实现同样的效果。</p>     <div _ngcontent-abs-c106="" class="highlight-div"><div _ngcontent-abs-c106="" class="highlight-div-header"><div _ngcontent-abs-c106="" class="highlight-div-header-left"><div _ngcontent-abs-c106="" class="handle-button expand-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-abs-c106="" class="highlight-div-header-right"><div _ngcontent-abs-c106="" class="handle-button ai-button"></div><div _ngcontent-abs-c106="" class="handle-button line-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-abs-c106="" class="handle-button theme-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-abs-c106="" class="handle-button copy-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-abs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextDemo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isExpanded</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">displayedText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">defaultFontSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">16</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">150</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">numLength</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">numUnicode</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">fullText</span>: <span class="hljs-built_in">string</span> =</li><li>    <span class="hljs-string">'这是一个超长文本示例，当文本内容超过三行时，超出部分会显示省略号。点击省略号可展开全部内容。此处为测试文本，用于验证多行文本截断效果。'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">maxLines</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">3</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">const</span> codePoints = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCodePoints</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">numLength</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">numUnicode</span> = codePoints.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calculateText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxLines</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getCodePoints</span>(<span class="hljs-attr">text</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">number</span>[] { <span class="hljs-comment">// 使用codePointAt分割文本</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">codePoints</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>    <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (index &lt; text.<span class="hljs-property">length</span>) {</li><li>      <span class="hljs-keyword">const</span> codePoint = text.<span class="hljs-title function_">codePointAt</span>(index);</li><li>      <span class="hljs-keyword">if</span> (codePoint === <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      codePoints.<span class="hljs-title function_">push</span>(codePoint);</li><li>      index += codePoint &gt; <span class="hljs-number">0xFFFF</span> ? <span class="hljs-number">2</span> : <span class="hljs-number">1</span>; <span class="hljs-comment">// 处理四字节字符</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> codePoints;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">lastUnicodeLength</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>) { <span class="hljs-comment">// 获得字符串最后一个字符的unicode长度</span></li><li>    <span class="hljs-keyword">if</span> (!str || str.<span class="hljs-property">length</span> &lt; <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (str.<span class="hljs-property">length</span> &lt; <span class="hljs-number">2</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> lastCodePoint = str.<span class="hljs-title function_">codePointAt</span>(str.<span class="hljs-property">length</span> - <span class="hljs-number">2</span>);</li><li>    <span class="hljs-keyword">if</span> (lastCodePoint == <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> lastStr = <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCodePoint</span>(lastCodePoint);</li><li>    <span class="hljs-keyword">return</span> lastStr.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">calculateText</span>(<span class="hljs-params">maxLines: <span class="hljs-built_in">number</span>, fullText: <span class="hljs-built_in">string</span></span>) { <span class="hljs-comment">// 计算文本是否需要截断</span></li><li>    <span class="hljs-keyword">const</span> noMaxLinesSize = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMeasureUtils</span>().<span class="hljs-title function_">measureTextSize</span>({</li><li>      <span class="hljs-attr">textContent</span>: fullText,</li><li>      <span class="hljs-attr">constraintWidth</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">textWidth</span></li><li>    });</li><li>    <span class="hljs-keyword">const</span> hasMaxLinesSize = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMeasureUtils</span>().<span class="hljs-title function_">measureTextSize</span>({</li><li>      <span class="hljs-attr">textContent</span>: fullText,</li><li>      <span class="hljs-attr">constraintWidth</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">textWidth</span>,</li><li>      <span class="hljs-attr">maxLines</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxLines</span></li><li>    });</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>(noMaxLinesSize.<span class="hljs-property">height</span>) &gt; <span class="hljs-title class_">Number</span>(hasMaxLinesSize.<span class="hljs-property">height</span>)) { <span class="hljs-comment">// 存在截断</span></li><li>      <span class="hljs-keyword">while</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> =</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>,</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>.<span class="hljs-property">length</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">lastUnicodeLength</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>)); <span class="hljs-comment">// 删掉几个字</span></li><li>        <span class="hljs-keyword">let</span> textAfterCut = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> + <span class="hljs-string">"…"</span>; <span class="hljs-comment">// 加上省略号</span></li><li>        <span class="hljs-keyword">let</span> sizeAfterCut = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMeasureUtils</span>().<span class="hljs-title function_">measureTextSize</span>({</li><li>          <span class="hljs-attr">textContent</span>: textAfterCut,</li><li>          <span class="hljs-attr">constraintWidth</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">textWidth</span></li><li>        });</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Number</span>(sizeAfterCut.<span class="hljs-property">height</span>) &lt;= <span class="hljs-title class_">Number</span>(hasMaxLinesSize.<span class="hljs-property">height</span>)) {</li><li>          <span class="hljs-keyword">break</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"displayedText: "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>);</li><li>        }</li><li>      }</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span> + <span class="hljs-string">"…"</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`用length计算的文本长度 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numLength}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`用codePointAt计算的文本长度 <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numUnicode}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'下面是需要截断的文本'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'下面是设置了maxLines和texOverflow'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fullText</span>)</li><li>        .<span class="hljs-title function_">maxLines</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxLines</span>)</li><li>        .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-attr">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span> })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textWidth</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'下面是计算后分割的文本'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">displayedText</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textWidth</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="370" originwidth="338" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115847.35146393749691465103317398939398:50001231000000:2800:AFCB09DF293F135A07FF93C90163CBD0FFB3836F0AC20A7881CC3E59367E8B52.png" width="338" height="370"></span></p>    </div>    <div class="tiledSection">     <h2 id="getparagraphs20" device-type="phone,2in1,tablet,wearable,tv">getParagraphs<sup>20+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getparagraphs20" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getParagraphs(styledString: StyledString, options?: TextLayoutOptions): Array&lt;Paragraph&gt;</p>     <p>将属性字符串根据文本布局选项转换成对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#paragraph">Paragraph</a>数组。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">styledString</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-styled-string#styledstring">StyledString</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">待转换的属性字符串。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#textlayoutoptions对象说明20">TextLayoutOptions</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">文本布局选项。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Array&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#paragraph">Paragraph</a>&gt;</td>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#paragraph">Paragraph</a>的数组。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <p>通过MeasureUtils的getParagraphs方法测算文本，当内容超出最大显示行数的时候，截断文本显示并展示“...全文”的效果。</p>     <div _ngcontent-abs-c106="" class="highlight-div"><div _ngcontent-abs-c106="" class="highlight-div-header"><div _ngcontent-abs-c106="" class="highlight-div-header-left"><div _ngcontent-abs-c106="" class="handle-button expand-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-abs-c106="" class="highlight-div-header-right"><div _ngcontent-abs-c106="" class="handle-button ai-button"></div><div _ngcontent-abs-c106="" class="handle-button line-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-abs-c106="" class="handle-button theme-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-abs-c106="" class="handle-button copy-button"><div _ngcontent-abs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-abs-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LengthMetrics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { drawing } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyCustomSpan</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">CustomSpan</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">word: <span class="hljs-built_in">string</span>, width: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span>, context: UIContext</span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">word</span> = word;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span> = width;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> = height;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span> = context;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMeasure</span>(<span class="hljs-attr">measureInfo</span>: <span class="hljs-title class_">CustomSpanMeasureInfo</span>): <span class="hljs-title class_">CustomSpanMetrics</span> {</li><li>    <span class="hljs-keyword">return</span> { <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>, <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">height</span> };</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDraw</span>(<span class="hljs-params">context: DrawContext, options: CustomSpanDrawInfo</span>) {</li><li>    <span class="hljs-keyword">let</span> canvas = context.<span class="hljs-property">canvas</span>;</li><li>    <span class="hljs-keyword">const</span> brush = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Brush</span>();</li><li>    brush.<span class="hljs-title function_">setColor</span>({</li><li>      <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">red</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">green</span>: <span class="hljs-number">74</span>,</li><li>      <span class="hljs-attr">blue</span>: <span class="hljs-number">175</span></li><li>    });</li><li>    <span class="hljs-keyword">const</span> font = <span class="hljs-keyword">new</span> drawing.<span class="hljs-title class_">Font</span>();</li><li>    font.<span class="hljs-title function_">setSize</span>(<span class="hljs-number">25</span>);</li><li>    <span class="hljs-keyword">const</span> textBlob = drawing.<span class="hljs-property">TextBlob</span>.<span class="hljs-title function_">makeFromString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">word</span>, font, drawing.<span class="hljs-property">TextEncoding</span>.<span class="hljs-property">TEXT_ENCODING_UTF8</span>);</li><li>    canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>    canvas.<span class="hljs-title function_">drawRect</span>({</li><li>      <span class="hljs-attr">left</span>: options.<span class="hljs-property">x</span> + <span class="hljs-number">10</span>,</li><li>      <span class="hljs-attr">right</span>: options.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">vp2px</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">width</span>) - <span class="hljs-number">10</span>,</li><li>      <span class="hljs-attr">top</span>: options.<span class="hljs-property">lineTop</span> + <span class="hljs-number">10</span>,</li><li>      <span class="hljs-attr">bottom</span>: options.<span class="hljs-property">lineBottom</span> - <span class="hljs-number">10</span></li><li>    });</li><li>    brush.<span class="hljs-title function_">setColor</span>({</li><li>      <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>,</li><li>      <span class="hljs-attr">red</span>: <span class="hljs-number">23</span>,</li><li>      <span class="hljs-attr">green</span>: <span class="hljs-number">169</span>,</li><li>      <span class="hljs-attr">blue</span>: <span class="hljs-number">141</span></li><li>    });</li><li>    canvas.<span class="hljs-title function_">attachBrush</span>(brush);</li><li>    canvas.<span class="hljs-title function_">drawTextBlob</span>(textBlob, options.<span class="hljs-property">x</span> + <span class="hljs-number">20</span>, options.<span class="hljs-property">lineBottom</span> - <span class="hljs-number">15</span>);</li><li>    canvas.<span class="hljs-title function_">detachBrush</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setWord</span>(<span class="hljs-params">word: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">word</span> = word;</li><li>  }</li><li>
</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">160</span>;</li><li>  <span class="hljs-attr">word</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"drawing"</span>;</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> =</li><li>    <span class="hljs-string">"Four score and seven years ago our fathers brought forth on this continent, a new nation, conceived in Liberty, and dedicated to the proposition that all men are created equal."</span>;</li><li>  mutableStr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>, [</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontSize</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">20</span>) })</li><li>    },</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Brown</span> })</li><li>    }</li><li>  ]);</li><li>
</li><li>  <span class="hljs-comment">// 测算属性字符串在指定宽度下能显示的行数</span></li><li>  <span class="hljs-title function_">getLineNum</span>(<span class="hljs-params">styledString: StyledString, width: LengthMetrics</span>) {</li><li>    <span class="hljs-keyword">let</span> paragraphArr = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMeasureUtils</span>().<span class="hljs-title function_">getParagraphs</span>(styledString, { <span class="hljs-attr">constraintWidth</span>: width });</li><li>    <span class="hljs-keyword">let</span> res = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paragraphArr.<span class="hljs-property">length</span>; ++i) {</li><li>      res += paragraphArr[i].<span class="hljs-title function_">getLineCount</span>();</li><li>    }</li><li>    <span class="hljs-keyword">return</span> res;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 测算属性字符串显示maxLines行时最多可以显示的字数</span></li><li>  <span class="hljs-title function_">getCorrectIndex</span>(<span class="hljs-params">styledString: MutableStyledString, maxLines: <span class="hljs-built_in">number</span>, width: LengthMetrics</span>) {</li><li>    <span class="hljs-keyword">let</span> low = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">let</span> high = styledString.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;</li><li>    <span class="hljs-comment">// 使用二分查找</span></li><li>    <span class="hljs-keyword">while</span> (low &lt;= high) {</li><li>      <span class="hljs-keyword">let</span> mid = (low + high) &gt;&gt; <span class="hljs-number">1</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"demo: get "</span> + low + <span class="hljs-string">" "</span> + high + <span class="hljs-string">" "</span> + mid);</li><li>      <span class="hljs-keyword">let</span> moreStyledString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-string">"... 全文"</span>, [{</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-number">4</span>,</li><li>        <span class="hljs-attr">length</span>: <span class="hljs-number">2</span>,</li><li>        <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>        <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span> })</li><li>      }]);</li><li>      moreStyledString.<span class="hljs-title function_">insertStyledString</span>(<span class="hljs-number">0</span>, styledString.<span class="hljs-title function_">subStyledString</span>(<span class="hljs-number">0</span>, mid));</li><li>      <span class="hljs-keyword">let</span> lineNum = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getLineNum</span>(moreStyledString, <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">500</span>));</li><li>      <span class="hljs-keyword">if</span> (lineNum &lt;= maxLines) {</li><li>        low = mid + <span class="hljs-number">1</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        high = mid - <span class="hljs-number">1</span>;</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> high;</li><li>  }</li><li>
</li><li>  mutableStrAllContent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>, [</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontSize</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">40</span>) })</li><li>    },</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Brown</span> })</li><li>    }</li><li>  ]);</li><li>  <span class="hljs-attr">customSpan1</span>: <span class="hljs-title class_">MyCustomSpan</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyCustomSpan</span>(<span class="hljs-string">"Hello"</span>, <span class="hljs-number">120</span>, <span class="hljs-number">10</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>());</li><li>  mutableStrAllContent2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>, [</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontSize</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">100</span>) })</li><li>    },</li><li>    {</li><li>      <span class="hljs-attr">start</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">length</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>      <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Brown</span> })</li><li>    }</li><li>  ]);</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextController</span>();</li><li>  <span class="hljs-attr">controller2</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextController</span>();</li><li>  <span class="hljs-attr">textController</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextController</span>();</li><li>  <span class="hljs-attr">textController2</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextController</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent2</span>.<span class="hljs-title function_">insertStyledString</span>(<span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">customSpan1</span>));</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStr2</span>.<span class="hljs-title function_">insertStyledString</span>(<span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">StyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">customSpan1</span>));</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'原文'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-literal">undefined</span>, { <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'500px'</span>).<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">color</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'排版后'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-literal">undefined</span>, { <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">textController</span> }).<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> now = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCorrectIndex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent</span>, <span class="hljs-number">3</span>, <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">500</span>));</li><li>          <span class="hljs-keyword">if</span> (now != <span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {</li><li>            <span class="hljs-keyword">let</span> moreStyledString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-string">"... 全文"</span>, [{</li><li>              <span class="hljs-attr">start</span>: <span class="hljs-number">4</span>,</li><li>              <span class="hljs-attr">length</span>: <span class="hljs-number">2</span>,</li><li>              <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>              <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span> })</li><li>            }]);</li><li>            moreStyledString.<span class="hljs-title function_">insertStyledString</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent</span>.<span class="hljs-title function_">subStyledString</span>(<span class="hljs-number">0</span>, now));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">textController</span>.<span class="hljs-title function_">setStyledString</span>(moreStyledString);</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">textController</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent</span>);</li><li>          }</li><li>        })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'500px'</span>)</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">color</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'原文'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-literal">undefined</span>, { <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller2</span> }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'500px'</span>).<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller2</span>.<span class="hljs-title function_">setStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent2</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">8</span>).<span class="hljs-title function_">color</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'排版后'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-literal">undefined</span>, { <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">textController2</span> }).<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> now = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCorrectIndex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent2</span>, <span class="hljs-number">3</span>, <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">px</span>(<span class="hljs-number">500</span>));</li><li>          <span class="hljs-keyword">let</span> moreStyledString = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-string">"... 全文"</span>, [{</li><li>            <span class="hljs-attr">start</span>: <span class="hljs-number">4</span>,</li><li>            <span class="hljs-attr">length</span>: <span class="hljs-number">2</span>,</li><li>            <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">FONT</span>,</li><li>            <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextStyle</span>({ <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span> })</li><li>          }]);</li><li>          moreStyledString.<span class="hljs-title function_">insertStyledString</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">mutableStrAllContent2</span>.<span class="hljs-title function_">subStyledString</span>(<span class="hljs-number">0</span>, now));</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">textController2</span>.<span class="hljs-title function_">setStyledString</span>(moreStyledString);</li><li>        })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'500px'</span>)</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="2362" originwidth="1251" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115847.64235516528853967912813218619310:50001231000000:2800:2BF018C8EE53E42FECD14672132219135C73597DE527F86DFCBFB8B26ACF1A64.png" width="920" height="1737.0423661071143"></span></p>    </div>   </div>   <div></div></div>