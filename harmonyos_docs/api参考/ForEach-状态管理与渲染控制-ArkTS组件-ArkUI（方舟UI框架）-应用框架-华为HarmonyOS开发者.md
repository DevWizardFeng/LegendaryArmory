<h1 _ngcontent-qjy-c119="" class="doc-title ng-star-inserted" title="ForEach"> ForEach </h1>

<div _ngcontent-qjy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ForEach接口基于数组类型数据来进行循环渲染。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本模块首批接口从API version 7开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</p>     </div></div></div>    <p>开发者指南见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach" target="_blank">ForEach开发者指南</a>。</p>    <div class="tiledSection">     <h2 id="接口" device-type="phone,2in1,tablet,wearable,tv">接口<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="接口" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>ForEach(arr: Array&lt;any&gt;, itemGenerator: (item: any, index: number) =&gt; void, keyGenerator?: (item: any, index: number) =&gt; string)</p>     <p>ForEach接口基于数组类型数据来进行循环渲染，需要与容器组件配合使用，且接口返回的组件应当是允许包含在ForEach父容器组件中的子组件。例如，ListItem组件要求ForEach的父容器组件必须为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list">List</a>组件或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitemgroup">ListItemGroup</a>组件。</p>     <p><strong>卡片能力：</strong> 从API version 9开始，该接口支持在ArkTS卡片中使用。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">arr</td>         <td class="cellrowborder" width="25%">Array&lt;any&gt;</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>数据源，为Array类型的数组。</p>          <p><strong>说明：</strong></p>          <p>- 可以设置为空数组，此时不会创建子组件。</p>          <p>- 可以设置返回值为数组类型的函数，例如arr.slice(1, 3)，但设置的函数不应改变包括数组本身在内的任何状态变量，例如不应使用Array.splice(),Array.sort()或Array.reverse()这些会改变原数组的函数。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">itemGenerator</td>         <td class="cellrowborder" width="25%">(item: any, index: number) =&gt; void</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>组件生成函数。</p>          <p>- 为数组中的每个元素创建对应的组件。</p>          <p>- item参数（可选）：arr数组中的数据项。</p>          <p>- index参数（可选）：arr数组中的数据项索引。</p>          <p><strong>说明：</strong></p>          <p>- 组件的类型必须是ForEach的父容器所允许的。例如，ListItem组件要求ForEach的父容器组件必须为List组件。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">keyGenerator</td>         <td class="cellrowborder" width="25%">(item: any, index: number) =&gt; string</td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>键值生成函数。</p>          <p>- 为数据源arr的每个数组项生成唯一且持久的键值。开发者可以通过该函数自定义键值生成规则。</p>          <p>- item参数（可选）：arr数组中的数据项。</p>          <p>- index参数（可选）：arr数组中的数据项索引。</p>          <p><strong>说明：</strong></p>          <p>- 如果函数缺省，框架默认的键值生成函数为(item: T, index: number) =&gt; { return index + '__' + JSON.stringify(item); }</p>          <p>- 键值生成函数不应改变任何组件状态。</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>ForEach的itemGenerator函数可以包含if/else条件渲染逻辑。另外，也可以在if/else条件渲染语句中使用ForEach组件。</li>        <li>在初始化渲染时，ForEach会加载数据源的所有数据，并为每个数据项创建对应的组件，然后将其挂载到渲染树上。如果数据源非常大或有特定的性能需求，建议使用LazyForEach组件。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-lazyforeach-optimization" target="_blank">使用懒加载优化性能</a>。</li>       </ul>      </div></div></div>     <p>由于数据源的数据项类型为any，缺少类型一致性校验，建议在使用ForEach时保持类型声明一致（详见如下代码片段），不规范写法可能会导致子组件无法正常渲染。</p>     <div _ngcontent-qjy-c106="" class="highlight-div"><div _ngcontent-qjy-c106="" class="highlight-div-header"><div _ngcontent-qjy-c106="" class="highlight-div-header-left"><div _ngcontent-qjy-c106="" class="handle-button expand-button"><div _ngcontent-qjy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qjy-c106="" class="highlight-div-header-right"><div _ngcontent-qjy-c106="" class="handle-button ai-button"></div><div _ngcontent-qjy-c106="" class="handle-button line-button"><div _ngcontent-qjy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qjy-c106="" class="handle-button theme-button"><div _ngcontent-qjy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qjy-c106="" class="handle-button copy-button"><div _ngcontent-qjy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qjy-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 不规范写法</span></li><li><span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Type1</span> | <span class="hljs-title class_">Type2</span>&gt; = [];</li><li>
</li><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: Type1</span>) =&gt;</span> {...}, <span class="hljs-function">(<span class="hljs-params">item: Type2</span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// item类型和数据项类型不一致</span></li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Type1</span> | <span class="hljs-title class_">Type2</span>&gt; = [];</li><li>
</li><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: Type1 | Type2</span>) =&gt;</span> {...}, <span class="hljs-function">(<span class="hljs-params">item: Type1 | Type2</span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// item类型和数据项类型保持一致</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="属性" device-type="phone,2in1,tablet,wearable,tv">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-drag-sorting">拖拽排序</a>属性。</p>    </div>   </div>   <div></div></div>