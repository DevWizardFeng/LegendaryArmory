<h1 _ngcontent-dge-c119="" class="doc-title ng-star-inserted" title="Interface (MediaSource)"> Interface (MediaSource) </h1>

<div _ngcontent-dge-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ul><li>本模块首批接口从API version 6开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</li><li>本Interface首批接口从API version 12开始支持。</li></ul>  </div></div></div> <p>媒体数据信息。来源自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-f#mediacreatemediasourcewithurl12">createMediaSourceWithUrl</a>。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Core</p>  <div class="tiledSection"><h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-dge-c106="" class="highlight-div"><div _ngcontent-dge-c106="" class="highlight-div-header"><div _ngcontent-dge-c106="" class="highlight-div-header-left"><div _ngcontent-dge-c106="" class="handle-button expand-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dge-c106="" class="highlight-div-header-right"><div _ngcontent-dge-c106="" class="handle-button ai-button"></div><div _ngcontent-dge-c106="" class="handle-button line-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dge-c106="" class="handle-button theme-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dge-c106="" class="handle-button copy-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dge-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="setmimetype12" device-type="phone,2in1,tablet,wearable,tv">setMimeType<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="setmimetype12" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setMimeType(mimeType: AVMimeTypes): void</p> <p>设置媒体MIME类型，以帮助播放器处理扩展的媒体源。</p> <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Core</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">mimeType</td> <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#avmimetypes12">AVMimeTypes</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">媒体MIME类型。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="setmediaresourceloaderdelegate18" device-type="phone,2in1,tablet,wearable,tv">setMediaResourceLoaderDelegate<sup>18+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="setmediaresourceloaderdelegate18" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setMediaResourceLoaderDelegate(resourceLoader: MediaSourceLoader): void</p> <p>设置MediaSourceLoader，帮助播放器请求媒体数据。</p> <p><strong>元服务API：</strong> 从API version 18开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Core</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">resourceLoader</td> <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-i#mediasourceloader18">MediaSourceLoader</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">应用实现的媒体数据获取接口，方便播放器获取数据。</td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-dge-c106="" class="highlight-div"><div _ngcontent-dge-c106="" class="highlight-div-header"><div _ngcontent-dge-c106="" class="highlight-div-header-left"><div _ngcontent-dge-c106="" class="handle-button expand-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dge-c106="" class="highlight-div-header-right"><div _ngcontent-dge-c106="" class="handle-button ai-button"></div><div _ngcontent-dge-c106="" class="handle-button line-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dge-c106="" class="handle-button theme-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dge-c106="" class="handle-button copy-button"><div _ngcontent-dge-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dge-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">HashMap</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">headers</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {<span class="hljs-string">"User-Agent"</span> : <span class="hljs-string">"User-Agent-Value"</span>};</li><li><span class="hljs-keyword">let</span> mediaSource : media.<span class="hljs-property">MediaSource</span> = media.<span class="hljs-title function_">createMediaSourceWithUrl</span>(<span class="hljs-string">"http://xxx"</span>,  headers);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">uuid</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">requests</span>: <span class="hljs-title class_">HashMap</span>&lt;<span class="hljs-built_in">number</span>, media.<span class="hljs-property">MediaSourceLoadingRequest</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>();</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sourceOpenCallback</span>: media.<span class="hljs-property">SourceOpenCallback</span> = <span class="hljs-function">(<span class="hljs-params">request: media.MediaSourceLoadingRequest</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Opening resource: <span class="hljs-subst">${request.url}</span>`</span>);</li><li>  <span class="hljs-comment">// 成功打开资源，返回唯一的句柄, 保证uuid和request对应。</span></li><li>  uuid += <span class="hljs-number">1</span>;</li><li>  requests.<span class="hljs-title function_">set</span>(uuid, request);</li><li>  <span class="hljs-keyword">return</span> uuid;</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sourceReadCallback</span>: media.<span class="hljs-property">SourceReadCallback</span> = <span class="hljs-function">(<span class="hljs-params">uuid: <span class="hljs-built_in">number</span>, requestedOffset: <span class="hljs-built_in">number</span>, requestedLength: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Reading resource with handle <span class="hljs-subst">${uuid}</span>, offset: <span class="hljs-subst">${requestedOffset}</span>, length: <span class="hljs-subst">${requestedLength}</span>`</span>);</li><li>  <span class="hljs-comment">// 判断uuid是否合法、存储read请求，不要在read请求阻塞去推送数据和头信息。</span></li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">sourceCloseCallback</span>: media.<span class="hljs-property">SourceCloseCallback</span> = <span class="hljs-function">(<span class="hljs-params">uuid: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Closing resource with handle <span class="hljs-subst">${uuid}</span>`</span>);</li><li>  <span class="hljs-comment">// 清除当前uuid相关资源。</span></li><li>  requests.<span class="hljs-title function_">remove</span>(uuid);</li><li>};</li><li>
</li><li><span class="hljs-comment">// 应用按需实现。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">resourceLoader</span>: media.<span class="hljs-property">MediaSourceLoader</span> = {</li><li>  <span class="hljs-attr">open</span>: sourceOpenCallback,</li><li>  <span class="hljs-attr">read</span>: sourceReadCallback,</li><li>  <span class="hljs-attr">close</span>: sourceCloseCallback</li><li>};</li><li>
</li><li>mediaSource.<span class="hljs-title function_">setMediaResourceLoaderDelegate</span>(resourceLoader);</li></ol></pre></div></div> </div> </div> <div></div></div>