<h1 _ngcontent-rif-c119="" class="doc-title ng-star-inserted" title="Interface (Picture)"> Interface (Picture) </h1>

<div _ngcontent-rif-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>本模块首批接口从API version 6开始支持。后续版本的新增接口，采用上角标单独标记接口的起始版本。</li>       <li>本Interface首批接口从API version 13开始支持。</li>      </ul>     </div></div></div>    <p>一些包含特殊信息的图片可以解码为多图对象，多图对象一般包含主图、辅助图和元数据。其中主图包含图像的大部分信息，主要用于显示图像内容；辅助图用于存储与主图相关但不同的数据，展示图像更丰富的信息；元数据一般用来存储关于图像文件的信息。多图对象类用于读取或写入多图对象。在调用Picture的方法前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-f#imagecreatepicture13">createPicture</a>创建一个Picture实例。</p>    <div class="tiledSection">     <h2 id="导入模块" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="导入模块" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="getmainpixelmap13" device-type="phone,2in1,tablet,wearable,tv">getMainPixelmap<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getmainpixelmap13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getMainPixelmap(): PixelMap</p>     <p>获取主图的pixelmap。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap">PixelMap</a></td>         <td class="cellrowborder" width="50%">同步返回PixelMap对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetMainPixelmap</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">let</span> funcName = <span class="hljs-string">"getMainPixelmap"</span>;</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">mainPixelmap</span>: image.<span class="hljs-property">PixelMap</span> = pictureObj.<span class="hljs-title function_">getMainPixelmap</span>();</li><li>    <span class="hljs-keyword">if</span> (mainPixelmap != <span class="hljs-literal">null</span>) {</li><li>      mainPixelmap.<span class="hljs-title function_">getImageInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">imageInfo: image.ImageInfo</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (imageInfo != <span class="hljs-literal">null</span>) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'GetMainPixelmap information height:'</span> + imageInfo.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> + <span class="hljs-string">' width:'</span> + imageInfo.<span class="hljs-property">size</span>.<span class="hljs-property">width</span>);</li><li>        }</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(funcName, <span class="hljs-string">`Failed error.code: <span class="hljs-subst">${error.code}</span> ,error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PictureObj is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="gethdrcomposedpixelmap13" device-type="phone,2in1,tablet,wearable,tv">getHdrComposedPixelmap<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="gethdrcomposedpixelmap13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getHdrComposedPixelmap(): Promise&lt;PixelMap&gt;</p>     <p>合成hdr图并获取hdr图的pixelmap。使用Promise异步回调。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap">PixelMap</a>&gt;</td>         <td class="cellrowborder" width="50%">Promise对象，返回PixelMap。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">7600901</td>         <td class="cellrowborder" width="50%">Inner unknown error. Please check the logs for detailed information.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">7600201</td>         <td class="cellrowborder" width="50%">Unsupported operation. e.g.,1. The picture does not has a gainmap. 2. MainPixelMap's allocator type is not DMA.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetHdrComposedPixelmap</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">let</span> funcName = <span class="hljs-string">"getHdrComposedPixelmap"</span>;</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) { <span class="hljs-comment">// 图片包含Hdr图。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">hdrComposedPixelmap</span>: image.<span class="hljs-property">PixelMap</span> = <span class="hljs-keyword">await</span> pictureObj.<span class="hljs-title function_">getHdrComposedPixelmap</span>();</li><li>    <span class="hljs-keyword">if</span> (hdrComposedPixelmap != <span class="hljs-literal">null</span>) {</li><li>      hdrComposedPixelmap.<span class="hljs-title function_">getImageInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">imageInfo: image.ImageInfo</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (imageInfo != <span class="hljs-literal">null</span>) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`GetHdrComposedPixelmap information height:<span class="hljs-subst">${imageInfo.size.height}</span> width:<span class="hljs-subst">${imageInfo.size.width}</span>`</span>);</li><li>        }</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(funcName, <span class="hljs-string">`Failed error.code: <span class="hljs-subst">${error.code}</span> ,error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PictureObj is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="getgainmappixelmap13" device-type="phone,2in1,tablet,wearable,tv">getGainmapPixelmap<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getgainmappixelmap13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getGainmapPixelmap(): PixelMap | null</p>     <p>获取增益图的pixelmap。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap">PixelMap</a> | null</td>         <td class="cellrowborder" width="50%">返回Pixelmap对象，如果没有则返回null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetGainmapPixelmap</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">let</span> funcName = <span class="hljs-string">"getGainmapPixelmap"</span>;</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) { <span class="hljs-comment">// 图片包含增益图。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">gainPixelmap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">null</span> = pictureObj.<span class="hljs-title function_">getGainmapPixelmap</span>();</li><li>    <span class="hljs-keyword">if</span> (gainPixelmap != <span class="hljs-literal">null</span>) {</li><li>      gainPixelmap.<span class="hljs-title function_">getImageInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">imageInfo: image.ImageInfo</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (imageInfo != <span class="hljs-literal">null</span>) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`GetGainmapPixelmap information height:<span class="hljs-subst">${imageInfo.size.height}</span> width:<span class="hljs-subst">${imageInfo.size.width}</span>`</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'GainPixelmap is null'</span>);</li><li>        }</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(funcName, <span class="hljs-string">`Failed error.code: <span class="hljs-subst">${error.code}</span> ,error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'GainPixelmap is null'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PictureObj is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="setauxiliarypicture13" device-type="phone,2in1,tablet,wearable,tv">setAuxiliaryPicture<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="setauxiliarypicture13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setAuxiliaryPicture(type: AuxiliaryPictureType, auxiliaryPicture: AuxiliaryPicture): void</p>     <p>设置辅助图。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#auxiliarypicturetype13">AuxiliaryPictureType</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">辅助图类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">auxiliaryPicture</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-auxiliarypicture">AuxiliaryPicture</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">辅助图对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SetAuxiliaryPicture</span>(<span class="hljs-params">context: Context</span>) {</li><li>  <span class="hljs-keyword">const</span> resourceMgr = context.<span class="hljs-property">resourceManager</span>;</li><li>  <span class="hljs-keyword">const</span> rawFile = <span class="hljs-keyword">await</span> resourceMgr.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-string">"hdr.jpg"</span>);<span class="hljs-comment">// 需要支持hdr的图片。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">ops</span>: image.<span class="hljs-property">SourceOptions</span> = {</li><li>    <span class="hljs-attr">sourceDensity</span>: <span class="hljs-number">98</span>,</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(rawFile.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, ops);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">pictureObj</span>: image.<span class="hljs-property">Picture</span> = image.<span class="hljs-title function_">createPicture</span>(pixelMap);</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Create picture succeeded'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Create picture failed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: image.<span class="hljs-property">AuxiliaryPictureType</span> = image.<span class="hljs-property">AuxiliaryPictureType</span>.<span class="hljs-property">GAINMAP</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">auxPictureObj</span>: image.<span class="hljs-property">AuxiliaryPicture</span> | <span class="hljs-literal">null</span> = pictureObj.<span class="hljs-title function_">getAuxiliaryPicture</span>(<span class="hljs-keyword">type</span>);</li><li>    <span class="hljs-keyword">if</span> (auxPictureObj != <span class="hljs-literal">null</span>) {</li><li>      pictureObj.<span class="hljs-title function_">setAuxiliaryPicture</span>(<span class="hljs-keyword">type</span>, auxPictureObj);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="getauxiliarypicture13" device-type="phone,2in1,tablet,wearable,tv">getAuxiliaryPicture<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getauxiliarypicture13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getAuxiliaryPicture(type: AuxiliaryPictureType): AuxiliaryPicture | null</p>     <p>根据类型获取辅助图。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">type</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#auxiliarypicturetype13">AuxiliaryPictureType</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">辅助图类型。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-auxiliarypicture">AuxiliaryPicture</a> | null</td>         <td class="cellrowborder" width="50%">返回AuxiliaryPicture对象，如果没有则返回null。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetAuxiliaryPicture</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: image.<span class="hljs-property">AuxiliaryPictureType</span> = image.<span class="hljs-property">AuxiliaryPictureType</span>.<span class="hljs-property">GAINMAP</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">auxPictureObj</span>: image.<span class="hljs-property">AuxiliaryPicture</span> | <span class="hljs-literal">null</span> = pictureObj.<span class="hljs-title function_">getAuxiliaryPicture</span>(<span class="hljs-keyword">type</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="setmetadata13" device-type="phone,2in1,tablet,wearable,tv">setMetadata<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="setmetadata13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>setMetadata(metadataType: MetadataType, metadata: Metadata): Promise&lt;void&gt;</p>     <p>设置主图的元数据。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">metadataType</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#metadatatype13">MetadataType</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">元数据类型。</td>        </tr>        <tr>         <td class="cellrowborder" width="25%">metadata</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-metadata">Metadata</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">元数据对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;void&gt;</td>         <td class="cellrowborder" width="50%">Promise对象。无返回结果的Promise对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">7600202</td>         <td class="cellrowborder" width="50%">Unsupported metadata. Possible causes: 1. Unsupported metadata type. 2. The metadata type does not match the auxiliary picture type.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SetPictureObjMetadata</span>(<span class="hljs-params">exifContext: Context</span>) {</li><li>  <span class="hljs-keyword">const</span> exifResourceMgr = exifContext.<span class="hljs-property">resourceManager</span>;</li><li>  <span class="hljs-keyword">const</span> exifRawFile = <span class="hljs-keyword">await</span> exifResourceMgr.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-string">"exif.jpg"</span>);<span class="hljs-comment">// 含有exif metadata的图片。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">exifOps</span>: image.<span class="hljs-property">SourceOptions</span> = {</li><li>    <span class="hljs-attr">sourceDensity</span>: <span class="hljs-number">98</span>,</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">exifImageSource</span>: image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(exifRawFile.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, exifOps);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">exifCommodityPixelMap</span>: image.<span class="hljs-property">PixelMap</span> = <span class="hljs-keyword">await</span> exifImageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">exifPictureObj</span>: image.<span class="hljs-property">Picture</span> = image.<span class="hljs-title function_">createPicture</span>(exifCommodityPixelMap);</li><li>  <span class="hljs-keyword">if</span> (exifPictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Create picture succeeded'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Create picture failed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">if</span> (exifPictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">metadataType</span>: image.<span class="hljs-property">MetadataType</span> = image.<span class="hljs-property">MetadataType</span>.<span class="hljs-property">EXIF_METADATA</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">exifMetaData</span>: image.<span class="hljs-property">Metadata</span> = <span class="hljs-keyword">await</span> exifPictureObj.<span class="hljs-title function_">getMetadata</span>(metadataType);</li><li>    exifPictureObj.<span class="hljs-title function_">setMetadata</span>(metadataType, exifMetaData).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Set metadata success'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set metadata. error.code: '</span> +<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error.<span class="hljs-property">code</span>) + <span class="hljs-string">' ,error.message:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error.<span class="hljs-property">message</span>));</li><li>    });</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'exifPictureOb is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="getmetadata13" device-type="phone,2in1,tablet,wearable,tv">getMetadata<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getmetadata13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getMetadata(metadataType: MetadataType): Promise&lt;Metadata&gt;</p>     <p>获取主图的元数据。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">metadataType</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#metadatatype13">MetadataType</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">元数据类型。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%">Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-metadata">Metadata</a>&gt;</td>         <td class="cellrowborder" width="50%">Promise对象。返回元数据。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.11.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.11.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">7600202</td>         <td class="cellrowborder" width="50%">Unsupported metadata. Possible causes: 1. Unsupported metadata type. 2. The metadata type does not match the auxiliary picture type.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetPictureObjMetadataProperties</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">metadataType</span>: image.<span class="hljs-property">MetadataType</span> = image.<span class="hljs-property">MetadataType</span>.<span class="hljs-property">EXIF_METADATA</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">pictureObjMetaData</span>: image.<span class="hljs-property">Metadata</span> = <span class="hljs-keyword">await</span> pictureObj.<span class="hljs-title function_">getMetadata</span>(metadataType);</li><li>    <span class="hljs-keyword">if</span> (pictureObjMetaData != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'get picture metadata success'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'get picture metadata is failed'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">" pictureObj is null"</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="marshalling13" device-type="phone,2in1,tablet,wearable,tv">marshalling<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="marshalling13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>marshalling(sequence: rpc.MessageSequence): void</p>     <p>将picture序列化后写入MessageSequence。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">sequence</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#messagesequence9">rpc.MessageSequence</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">新创建的MessageSequence。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-image">Image错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.1" width="50%">错误码ID</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.2" width="50%">错误信息</th>        </tr><tr>         <td class="cellrowborder" width="50%">401</td>         <td class="cellrowborder" width="50%">Parameter error. Possible causes: 1.Mandatory parameters are left unspecified. 2.Incorrect parameter types. 3.Parameter verification failed.</td>        </tr>        <tr>         <td class="cellrowborder" width="50%">62980097</td>         <td class="cellrowborder" width="50%">IPC error. Possible cause: 1.IPC communication failed. 2. Image upload exception. 3. Decode process exception. 4. Insufficient memory.</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MySequence</span> <span class="hljs-keyword">implements</span> rpc.<span class="hljs-property">Parcelable</span> {</li><li>  <span class="hljs-attr">picture</span>: image.<span class="hljs-property">Picture</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">conPicture: image.Picture</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span> = conPicture;</li><li>  }</li><li>  <span class="hljs-title function_">marshalling</span>(<span class="hljs-params">messageSequence: rpc.MessageSequence</span>) {</li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span> != <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span>.<span class="hljs-title function_">marshalling</span>(messageSequence);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Marshalling success !'</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Marshalling failed !'</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">unmarshalling</span>(<span class="hljs-params">messageSequence : rpc.MessageSequence</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span> = image.<span class="hljs-title function_">createPictureFromParcel</span>(messageSequence);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">picture</span>.<span class="hljs-title function_">getMainPixelmap</span>().<span class="hljs-title function_">getImageInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">imageInfo : image.ImageInfo</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Unmarshalling to get mainPixelmap information height:<span class="hljs-subst">${imageInfo.size.height}</span> width:<span class="hljs-subst">${imageInfo.size.width}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Unmarshalling failed error.code: <span class="hljs-subst">${error.code}</span> ,error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Marshalling_UnMarshalling</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">parcelable</span>: <span class="hljs-title class_">MySequence</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySequence</span>(pictureObj);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: rpc.<span class="hljs-property">MessageSequence</span> = rpc.<span class="hljs-property">MessageSequence</span>.<span class="hljs-title function_">create</span>();</li><li>    <span class="hljs-comment">// 序列化。</span></li><li>    data.<span class="hljs-title function_">writeParcelable</span>(parcelable);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">ret</span>: <span class="hljs-title class_">MySequence</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MySequence</span>(pictureObj);</li><li>    <span class="hljs-comment">// 反序列化。</span></li><li>    data.<span class="hljs-title function_">readParcelable</span>(ret);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PictureObj is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="release13" device-type="phone,2in1,tablet,wearable,tv">release<sup>13+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="release13" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>release(): void</p>     <p>释放picture对象。</p>     <p><strong>系统能力：</strong> SystemCapability.Multimedia.Image.Core</p>     <p><strong>示例：</strong></p>     <div _ngcontent-rif-c106="" class="highlight-div"><div _ngcontent-rif-c106="" class="highlight-div-header"><div _ngcontent-rif-c106="" class="highlight-div-header-left"><div _ngcontent-rif-c106="" class="handle-button expand-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rif-c106="" class="highlight-div-header-right"><div _ngcontent-rif-c106="" class="handle-button ai-button"></div><div _ngcontent-rif-c106="" class="handle-button line-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rif-c106="" class="handle-button theme-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rif-c106="" class="handle-button copy-button"><div _ngcontent-rif-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rif-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Release</span>(<span class="hljs-params">pictureObj : image.Picture</span>) {</li><li>  <span class="hljs-keyword">let</span> funcName = <span class="hljs-string">"Release"</span>;</li><li>  <span class="hljs-keyword">if</span> (pictureObj != <span class="hljs-literal">null</span>) {</li><li>    pictureObj.<span class="hljs-title function_">release</span>();</li><li>    <span class="hljs-keyword">if</span> (pictureObj.<span class="hljs-title function_">getMainPixelmap</span>() == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(funcName, <span class="hljs-string">'Success !'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(funcName, <span class="hljs-string">'Failed !'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PictureObj is null'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>