<h1 _ngcontent-nud-c119="" class="doc-title ng-star-inserted" title="OffscreenCanvas"> OffscreenCanvas </h1>

<div _ngcontent-nud-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>OffscreenCanvas组件用于绘制自定义图形。</p>    <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvas">Canvas</a>组件或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d">CanvasRenderingContext2D</a>对象时，渲染、动画和用户交互通常发生在应用程序的主线程上，与画布动画和渲染相关的计算可能会影响应用程序性能。OffscreenCanvas提供了一个可以在屏幕外渲染的画布，这样可以在单独的线程中运行一些任务，从而避免影响应用程序主线程性能。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>该组件从API version 8开始支持。后续版本如有新增内容，则采用上角标单独标记该内容的起始版本。</p>      <p>OffscreenCanvas无法在ServiceExtensionAbility中使用，ServiceExtensionAbility中建议使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-graphics-drawing">Drawing模块</a>进行离屏绘制。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="子组件" device-type="phone,2in1,tablet,wearable,tv">子组件<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="子组件" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>不支持。</p>    </div>    <div class="tiledSection">     <h2 id="构造函数" device-type="phone,2in1,tablet,wearable,tv">构造函数<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="构造函数" tips="复制节点链接"></i></h2>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>    <div class="tiledSection">     <h3 id="constructor" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(width: number, height: number)</p>     <p>构造用于创建离屏画布对象的OffscreenCanvas。</p>     <p><strong>卡片能力：</strong> 从API version 9开始，该接口支持在ArkTS卡片中使用。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">width</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>OffscreenCanvas组件的宽度。</p>          <p>异常值NaN和Infinity按无效值处理。</p>          <p>默认单位为vp。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">height</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>OffscreenCanvas组件的高度。</p>          <p>异常值NaN和Infinity按无效值处理。</p>          <p>默认单位为vp。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="constructor12" device-type="phone,2in1,tablet,wearable,tv">constructor<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="constructor12" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(width: number, height: number, unit: LengthMetricsUnit)</p>     <p>构造用于创建离屏画布对象的OffscreenCanvas，支持配置OffscreenCanvas的单位模式。</p>     <p><strong>卡片能力：</strong> 从API version 12开始，该接口支持在ArkTS卡片中使用。</p>     <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">width</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>OffscreenCanvas组件的宽度。</p>          <p>异常值NaN和Infinity按无效值处理。</p>          <p>默认单位为vp。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">height</td>         <td class="cellrowborder" width="25%">number</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>OffscreenCanvas组件的高度。</p>          <p>异常值NaN和Infinity按无效值处理。</p>          <p>默认单位为vp。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">unit</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-graphics#lengthmetricsunit12">LengthMetricsUnit</a></td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>用来配置OffscreenCanvas对象的单位模式，配置后无法动态更改，配置方法同<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d">CanvasRenderingContext2D</a>。</p>          <p>异常值NaN和Infinity按默认值处理。</p>          <p>默认值：DEFAULT</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="属性" device-type="phone,2in1,tablet,wearable,tv">属性<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="属性" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>卡片能力：</strong> 从API version 9开始，该接口支持在ArkTS卡片中使用。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p>OffscreenCanvas支持以下属性：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.6.1.1" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.6.1.2" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.6.1.3" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.6.1.4" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.6.1.5" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">width</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>OffscreenCanvas组件的宽度。</p>          <p>默认单位为vp。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">height</td>         <td class="cellrowborder" width="20%">number</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">否</td>         <td class="cellrowborder" width="20%">          <p>OffscreenCanvas组件的高度。</p>          <p>默认单位为vp。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="width" class="firsth2">width<i class="anchor-icon anchor-icon-link" anchorid="width" tips="复制节点链接"></i></h3>          <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OffscreenCanvasPage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">borderColor</span>(<span class="hljs-string">'#057D02'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#CDCDCD'</span></li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-property">width</span>, <span class="hljs-number">150</span>)</li><li>            <span class="hljs-keyword">let</span> image = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>()</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>)</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image)</li><li>          })</li><li>      }</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="644" originwidth="296" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115628.48226572681470191599870206134085:50001231000000:2800:3FFDB684143B628840A389E6D59C91AC90D909E08E82DC77227780B563760D0B.png" class="notEnlarge" width="296" height="644"></span></p>    </div>    <div class="tiledSection">     <h3 id="height">height<i class="anchor-icon anchor-icon-link" anchorid="height" tips="复制节点链接"></i></h3>          <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OffscreenCanvasPage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">200</span>, <span class="hljs-number">300</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">borderColor</span>(<span class="hljs-string">'#057D02'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#CDCDCD'</span></li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">100</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-property">height</span>)</li><li>            <span class="hljs-keyword">let</span> image = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>()</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">setTransform</span>(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>)</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image)</li><li>          })</li><li>      }</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="644" originwidth="296" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115628.78774227701375350386976579419576:50001231000000:2800:66C1B979341BEC109595574F4E234EB244D62D46F3000E69350FDCC2F9413C3E.png" class="notEnlarge" width="296" height="644"></span></p>    </div>    <div class="tiledSection">     <h2 id="方法" device-type="phone,2in1,tablet,wearable,tv">方法<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="方法" tips="复制节点链接"></i></h2>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>    <div class="tiledSection">     <h3 id="transfertoimagebitmap" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">transferToImageBitmap<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="transfertoimagebitmap" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>transferToImageBitmap(): ImageBitmap</p>     <p>从OffscreenCanvas组件中最近渲染的图像创建一个ImageBitmap对象。</p>     <p><strong>卡片能力：</strong> 从API version 9开始，该接口支持在ArkTS卡片中使用。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-imagebitmap">ImageBitmap</a></td>         <td class="cellrowborder" width="50%">创建的ImageBitmap对象。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OffscreenCanvasPage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">400</span>, <span class="hljs-number">600</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">5</span>)</li><li>        .<span class="hljs-title function_">borderColor</span>(<span class="hljs-string">'rgb(39,135,217)'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>          offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#CDCDCD'</span></li><li>          offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">400</span>, <span class="hljs-number">600</span>)</li><li>          offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#000000'</span></li><li>          offContext.<span class="hljs-property">font</span> = <span class="hljs-string">'40px serif bold'</span></li><li>          offContext.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">"Offscreen : Hello World!"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">60</span>)</li><li>          <span class="hljs-keyword">let</span> image = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>()</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image)</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="109" originwidth="242" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115628.57091701230856764630690924494907:50001231000000:2800:EA1B8AD66AE63050022022AC93F0E343E6CF30EED1538FEA0BFC894CD142029E.png" class="notEnlarge" width="242" height="109"></span></p>    </div>    <div class="tiledSection">     <h3 id="getcontext10" device-type="phone,2in1,tablet,wearable,tv">getContext<sup>10+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="getcontext10" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getContext(contextType: "2d", options?: RenderingContextSettings): OffscreenCanvasRenderingContext2D</p>     <p>返回OffscreenCanvas组件的绘图上下文。</p>     <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">contextType</td>         <td class="cellrowborder" width="25%">string</td>         <td class="cellrowborder" width="25%">是</td>         <td class="cellrowborder" width="25%">          <p>OffscreenCanvas组件绘图上下文的类型，当前仅支持"2d"类型。</p>          <p>"2d"：创建一个表示二维渲染上下文的OffscreenCanvasRenderingContext2D对象。</p>          <p>异常值undefined和null按无效值处理，当前接口返回undefined。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">options</td>         <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#renderingcontextsettings">RenderingContextSettings</a></td>         <td class="cellrowborder" width="25%">否</td>         <td class="cellrowborder" width="25%">          <p>用来配置OffscreenCanvasRenderingContext2D对象的参数，见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#renderingcontextsettings">RenderingContextSettings</a>。</p>          <p>异常值undefined和null按<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#renderingcontextsettings">RenderingContextSettings</a>的默认值处理。</p>          <p>默认值：null</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.1" width="50%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.2" width="50%">说明</th>        </tr><tr>         <td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-offscreencanvasrenderingcontext2d">OffscreenCanvasRenderingContext2D</a></td>         <td class="cellrowborder" width="50%">OffscreenCanvas组件的绘图上下文。如果getContext方法的入参contextType为"2d"以外类型（包括null或者undefined），返回undefined，使用前应判断返回值是否为undefined。</td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OffscreenCanvasExamplePage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offscreenCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">600</span>, <span class="hljs-number">800</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offscreenCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>            offContext.<span class="hljs-property">font</span> = <span class="hljs-string">'70px sans-serif'</span></li><li>            offContext.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">"Offscreen : Hello World!"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">60</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"#0000ff"</span></li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">230</span>, <span class="hljs-number">350</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"#EE0077"</span></li><li>            offContext.<span class="hljs-title function_">translate</span>(<span class="hljs-number">70</span>, <span class="hljs-number">70</span>)</li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">230</span>, <span class="hljs-number">350</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"#77EE0077"</span></li><li>            offContext.<span class="hljs-title function_">translate</span>(-<span class="hljs-number">70</span>, -<span class="hljs-number">70</span>)</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"#00ffff"</span></li><li>            offContext.<span class="hljs-title function_">rotate</span>(<span class="hljs-number">45</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>);</li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">180</span>, <span class="hljs-number">120</span>, <span class="hljs-number">50</span>, <span class="hljs-number">50</span>);</li><li>            offContext.<span class="hljs-title function_">rotate</span>(-<span class="hljs-number">45</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> / <span class="hljs-number">180</span>);</li><li>            offContext.<span class="hljs-title function_">beginPath</span>()</li><li>            offContext.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">10</span>, <span class="hljs-number">150</span>)</li><li>            offContext.<span class="hljs-title function_">bezierCurveTo</span>(<span class="hljs-number">20</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">100</span>, <span class="hljs-number">200</span>, <span class="hljs-number">20</span>)</li><li>            offContext.<span class="hljs-title function_">stroke</span>()</li><li>            offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#FF00FF'</span></li><li>            offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">100</span>, <span class="hljs-number">100</span>, <span class="hljs-number">60</span>, <span class="hljs-number">60</span>)</li><li>            <span class="hljs-keyword">let</span> imageData = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offscreenCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>()</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(imageData)</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="719" originwidth="336" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115628.05820517226644847531132021192540:50001231000000:2800:E9D48E6793BA6D421108DB58EE2016A85DF2F2A3164E1D76A88197AB2D4210D2.png" width="336" height="719"></span></p>    </div>    <div class="tiledSection">     <h2 id="offscreencanvas支持并发线程绘制" device-type="phone,2in1,tablet,wearable,tv">OffscreenCanvas支持并发线程绘制<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="offscreencanvas支持并发线程绘制" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>从API version 11开始，当应用创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/worker-introduction" target="_blank">Worker线程</a>，支持使用postMessage将OffscreenCanvas实例传到Worker中进行绘制，并使用onmessage接收Worker线程发送的绘制结果进行显示。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>OffscreenCanvas对象使用getContext获取绘图上下文后，不允许通过postMessage传该对象给其他线程，否则抛出异常。</p>       <p>已经通过postMessage传OffscreenCanvas对象到某一线程，声明该对象的线程不允许该对象使用getContext和transferToImageBitmap方法，否则抛出异常。</p>       <p>已经通过postMessage传OffscreenCanvas对象到某一线程，不允许再将该对象通过postMessage传给其他线程，否则抛出异常。</p>       <p>DevEco Studio的预览器不支持显示在worker线程中绘制的内容。</p>      </div></div></div>     <p><strong>示例：</strong></p>     <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">OffscreenCanvasExamplePage</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> myWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/Worker.ets'</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">imgPixelMap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = context.<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgPixelMap</span> = resourceMgr.<span class="hljs-title function_">getDrawableDescriptor</span>($r(<span class="hljs-string">"app.media.startIcon"</span>).<span class="hljs-property">id</span>).<span class="hljs-title function_">getPixelMap</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"resourceMgr getDrawableDescriptor error, error code: "</span> + error);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span> }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">borderColor</span>(<span class="hljs-string">'#057D02'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> offCanvas = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">600</span>, <span class="hljs-number">800</span>)</li><li>            <span class="hljs-comment">// worker线程中绘制图像</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myWorker</span>.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">myOffCanvas</span>: offCanvas, <span class="hljs-attr">imgPixelMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgPixelMap</span> });</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myWorker</span>.<span class="hljs-property">onmessage</span> = (e): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">myImage</span>) {</li><li>                <span class="hljs-keyword">let</span> <span class="hljs-attr">image</span>: <span class="hljs-title class_">ImageBitmap</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">myImage</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image)</li><li>              }</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>Worker线程在onmessage中接收到主线程postMessage发送的OffscreenCanvas，并进行绘制。</p>     <div _ngcontent-nud-c106="" class="highlight-div"><div _ngcontent-nud-c106="" class="highlight-div-header"><div _ngcontent-nud-c106="" class="highlight-div-header-left"><div _ngcontent-nud-c106="" class="handle-button expand-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nud-c106="" class="highlight-div-header-right"><div _ngcontent-nud-c106="" class="handle-button ai-button"></div><div _ngcontent-nud-c106="" class="handle-button line-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nud-c106="" class="handle-button theme-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nud-c106="" class="handle-button copy-button"><div _ngcontent-nud-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nud-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/ets/workers/Worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span>.<span class="hljs-property">myOffCanvas</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">myOffCanvas</span></li><li>    <span class="hljs-keyword">let</span> offContext = offCanvas.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>)</li><li>    offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#CDCDCD'</span></li><li>    offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>)</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">imgPixelMap</span>: image.<span class="hljs-property">PixelMap</span> = e.<span class="hljs-property">data</span>.<span class="hljs-property">imgPixelMap</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">imgBitmap</span>: <span class="hljs-title class_">ImageBitmap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageBitmap</span>(imgPixelMap)</li><li>    offContext.<span class="hljs-title function_">drawImage</span>(imgBitmap, <span class="hljs-number">0</span>, <span class="hljs-number">200</span>)</li><li>
</li><li>    <span class="hljs-keyword">let</span> path2d = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>(<span class="hljs-string">"M250 150 L150 350 L350 350 Z"</span>)</li><li>    offContext.<span class="hljs-title function_">stroke</span>(path2d)</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">matrix</span>: <span class="hljs-title class_">Matrix2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Matrix2D</span>()</li><li>    matrix.<span class="hljs-property">scaleX</span> = <span class="hljs-number">1</span></li><li>    matrix.<span class="hljs-property">scaleY</span> = <span class="hljs-number">1</span></li><li>    matrix.<span class="hljs-property">rotateX</span> = -<span class="hljs-number">0.5</span></li><li>    matrix.<span class="hljs-property">rotateY</span> = <span class="hljs-number">0.5</span></li><li>    matrix.<span class="hljs-property">translateX</span> = <span class="hljs-number">10</span></li><li>    matrix.<span class="hljs-property">translateY</span> = <span class="hljs-number">10</span></li><li>    offContext.<span class="hljs-title function_">setTransform</span>(matrix)</li><li>    offContext.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">"#707070"</span></li><li>    offContext.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">20</span>, <span class="hljs-number">20</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>)</li><li>
</li><li>    <span class="hljs-keyword">let</span> image = offCanvas.<span class="hljs-title function_">transferToImageBitmap</span>()</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>({ <span class="hljs-attr">myImage</span>: image });</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="185" originwidth="243" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115629.31615185450796678681914503276458:50001231000000:2800:BD69C12183E47D0053FFD62817B7751A3938712FF92AFB70E03BECE395A214B9.png" class="notEnlarge" width="243" height="185"></span></p>    </div>   </div>   <div></div></div>