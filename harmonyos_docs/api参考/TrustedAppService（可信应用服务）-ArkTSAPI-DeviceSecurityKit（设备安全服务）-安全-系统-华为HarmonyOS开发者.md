<h1 _ngcontent-unt-c119="" class="doc-title ng-star-inserted" title="TrustedAppService（可信应用服务）"> TrustedAppService（可信应用服务） </h1>

<div _ngcontent-unt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供应用数据的安全证明服务，支持创建证明密钥、销毁证明密钥、初始化证明会话、结束证明会话和获取安全地理位置，能够为安全摄像头和安全地理位置功能提供安全证明能力，确保图像或位置数据未被篡改。</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="tiledSection"><h2 id="section82301618122011" device-type="phone,tablet,2in1">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section82301618122011" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section81796536265" device-type="phone,tablet,2in1">createAttestKey<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section81796536265" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>createAttestKey(options: AttestOptions): Promise&lt;void&gt;</p> <p>创建证明密钥，在证明密钥不存在或者不可用的条件下调用，使用Promise异步回调。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.1" width="15.65%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.2" width="18.69%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.3" width="18.21%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.4" width="47.449999999999996%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15.65%"><p>options</p> </td> <td class="cellrowborder" width="18.69%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18297145185618">AttestOptions</a></p> </td> <td class="cellrowborder" width="18.21%"><p>是</p> </td> <td class="cellrowborder" width="47.449999999999996%"><p>生成证明密钥的参数，需要指定密钥类型和密钥大小。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.1" width="46.63%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.2" width="53.37%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="46.63%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="53.37%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.4.13.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.13.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>401</p> </td> <td class="cellrowborder" width="75.29%"><p>argument is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500001</p> </td> <td class="cellrowborder" width="75.29%"><p>algorithm param is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500002</p> </td> <td class="cellrowborder" width="75.29%"><p>algorithm param is missing.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500003</p> </td> <td class="cellrowborder" width="75.29%"><p>create attestation key failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500004</p> </td> <td class="cellrowborder" width="75.29%"><p>create anonymous certificate failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500005</p> </td> <td class="cellrowborder" width="75.29%"><p>operating file failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500006</p> </td> <td class="cellrowborder" width="75.29%"><p>IPC communication failed.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_ALGORITHM</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestKeyAlg</span>.<span class="hljs-property">ATTEST_ALG_ECC</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_KEY_SIZE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestKeySize</span>.<span class="hljs-property">ATTEST_ECC_KEY_SIZE_256</span></li><li>  }</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">createAttestKey</span>(options)</li><li>  .<span class="hljs-title function_">then</span>(</li><li>    (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in creating attest key'</span>);</li><li>    }</li><li>  ).<span class="hljs-title function_">catch</span>(</li><li>    (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to create attest key, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    });</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section18297145185618" device-type="phone,tablet,2in1">AttestOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18297145185618" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section81796536265">createAttestKey</a>接口的请求参数。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.1" width="12.34%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.2" width="26.340000000000003%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.3" width="8.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.4" width="8.36%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.5" width="44%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.34%"><p>properties</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>Array&lt;<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section0633210102">AttestParam</a>&gt;</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的用于生成证明密钥的配置信息。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section0633210102" device-type="phone,tablet,2in1">AttestParam<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section0633210102" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18297145185618">AttestOptions</a>配置信息的内容条目。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.1" width="12.34%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.2" width="26.340000000000003%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.3" width="8.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.4" width="8.36%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.5" width="44%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.34%"><p>tag</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section1427551613315">AttestTag</a></p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的标签，用于生成证明密钥的配置信息。</p> </td> </tr> <tr><td class="cellrowborder" width="12.34%"><p>value</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>boolean|number|bigint|Uint8Array</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的标签对应的值，用于生成证明密钥的配置信息。</p> <p><strong>boolean：</strong></p> <p>预留参数，暂未使用；</p> <p><strong>number：</strong></p> <p>1）tag为ATTEST_TAG_ALGORITHM，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section17268105152417">AttestKeyAlg</a>类型；</p> <p>2）tag为ATTEST_TAG_KEY_SIZE，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section932031292912">AttestKeySize</a>类型；</p> <p>3）tag为ATTEST_TAG_DEVICE_TYPE，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section8803148183419">AttestType</a>类型；</p> <p><strong>bigint：</strong></p> <p>tag为ATTEST_TAG_DEVICE_ID，其值为设备ID，取值范围int64类型的随机值；</p> <p><strong>Uint8Array：</strong></p> <p>预留参数，暂未使用；</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1427551613315" device-type="phone,tablet,2in1">AttestTag<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1427551613315" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>配置信息标签类型，使用<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18511411417">AttestTagType</a>扩展定义。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.1" width="21.44%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.2" width="31.869999999999997%"><p><strong>值</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.3" width="46.69%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.44%"><p>ATTEST_TAG_INVALID</p> </td> <td class="cellrowborder" width="31.869999999999997%"><p>AttestTagType.ATTEST_TAG_TYPE_INVALID|0</p> </td> <td class="cellrowborder" width="46.69%"><p>不合法标签。</p> </td> </tr> <tr><td class="cellrowborder" width="21.44%"><p>ATTEST_TAG_ALGORITHM</p> </td> <td class="cellrowborder" width="31.869999999999997%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|1</p> </td> <td class="cellrowborder" width="46.69%"><p>算法标签。</p> </td> </tr> <tr><td class="cellrowborder" width="21.44%"><p>ATTEST_TAG_KEY_SIZE</p> </td> <td class="cellrowborder" width="31.869999999999997%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|2</p> </td> <td class="cellrowborder" width="46.69%"><p>密钥大小标签。</p> </td> </tr> <tr><td class="cellrowborder" width="21.44%"><p>ATTEST_TAG_DEVICE_TYPE</p> </td> <td class="cellrowborder" width="31.869999999999997%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|3</p> </td> <td class="cellrowborder" width="46.69%"><p>设备类型标签。</p> </td> </tr> <tr><td class="cellrowborder" width="21.44%"><p>ATTEST_TAG_DEVICE_ID</p> </td> <td class="cellrowborder" width="31.869999999999997%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|4</p> </td> <td class="cellrowborder" width="46.69%"><p>设备序列号标签。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section18511411417" device-type="phone,tablet,2in1">AttestTagType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18511411417" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>标签类型定义，用于区分数据类型。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.1" width="21.349999999999998%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.2" width="28.310000000000002%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_INVALID</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>0&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>不合法标签类型。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_INT</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>1&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>INT类型。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_UINT</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>2&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>UINT类型。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_ULONG</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>3&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>ULONG类型。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_BOOL</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>4&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>BOOL类型。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_TAG_TYPE_BYTES</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>5&lt;&lt;28</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>BYTES类型。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section17268105152417" device-type="phone,tablet,2in1">AttestKeyAlg<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17268105152417" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>证明密钥算法类型。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.1" width="21.349999999999998%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.2" width="28.310000000000002%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_ALG_ECC</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>1</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>ECC算法类型。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section932031292912" device-type="phone,tablet,2in1">AttestKeySize<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section932031292912" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>证明密钥长度。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.1" width="21.349999999999998%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.2" width="28.310000000000002%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_ECC_KEY_SIZE_256</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>256</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>证明密钥长度，256位。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>ATTEST_ECC_KEY_SIZE_384</p> </td> <td class="cellrowborder" width="28.310000000000002%"><p>384</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>证明密钥长度，384位。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section19260221152819" device-type="phone,tablet,2in1">destroyAttestKey<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section19260221152819" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>destroyAttestKey(): Promise&lt;void&gt;</p> <p>销毁证明密钥，使用Promise异步回调。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.14.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500005</p> </td> <td class="cellrowborder" width="75.29%"><p>operating file failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500006</p> </td> <td class="cellrowborder" width="75.29%"><p>IPC communication failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500007</p> </td> <td class="cellrowborder" width="75.29%"><p>item not found.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.1" width="47.43%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.2" width="52.56999999999999%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="47.43%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="52.56999999999999%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">destroyAttestKey</span>().<span class="hljs-title function_">then</span>(</li><li>  (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in destroying attest key'</span>);</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to destroy attest key, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section166716269293" device-type="phone,tablet,2in1">initializeAttestContext<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section166716269293" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>initializeAttestContext(userData: string, options: AttestOptions): Promise&lt;AttestReturnResult&gt;</p> <p>初始化证明会话，在创建证明密钥成功后使用，使用Promise异步回调。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </div> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.1.5.1.1" width="16.21162116211621%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.1.5.1.2" width="16.72167216721672%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.1.5.1.3" width="17.411741174117413%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.1.5.1.4" width="49.65496549654965%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.21162116211621%"><p>userData</p> </td> <td class="cellrowborder" width="16.72167216721672%"><p>string</p> </td> <td class="cellrowborder" width="17.411741174117413%"><p>是</p> </td> <td class="cellrowborder" width="49.65496549654965%"><p>打开证明会话的参数，传入的用户数据，长度在16到127字节之间。</p> </td> </tr> <tr><td class="cellrowborder" width="16.21162116211621%"><p>options</p> </td> <td class="cellrowborder" width="16.72167216721672%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18297145185618">AttestOptions</a></p> </td> <td class="cellrowborder" width="17.411741174117413%"><p>是</p> </td> <td class="cellrowborder" width="49.65496549654965%"><p>打开证明会话的参数，需要指定设备类型和设备ID。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.23.1.3.1.1" width="45.97%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.1.3.1.2" width="54.03%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="45.97%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section1348925811317">AttestReturnResult</a>&gt;</p> </td> <td class="cellrowborder" width="54.03%"><p>生成的匿名证书链。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.26.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.26.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>401</p> </td> <td class="cellrowborder" width="75.29%"><p>argument is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500002</p> </td> <td class="cellrowborder" width="75.29%"><p>param is missing.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500005</p> </td> <td class="cellrowborder" width="75.29%"><p>operating file failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500006</p> </td> <td class="cellrowborder" width="75.29%"><p>IPC communication failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500007</p> </td> <td class="cellrowborder" width="75.29%"><p>item not found.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500008</p> </td> <td class="cellrowborder" width="75.29%"><p>anonymous certificate verify failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500009</p> </td> <td class="cellrowborder" width="75.29%"><p>anonymous certificate has expired.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500010</p> </td> <td class="cellrowborder" width="75.29%"><p>get attestation key failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500011</p> </td> <td class="cellrowborder" width="75.29%"><p>initialize secure camera failed.</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section8803148183419" device-type="phone,tablet,2in1">AttestType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section8803148183419" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>证明会话类型。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.27.5.1.4.1.1" width="24.63%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.27.5.1.4.1.2" width="25.03%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.27.5.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="24.63%"><p>ATTEST_TYPE_LOCATION</p> </td> <td class="cellrowborder" width="25.03%"><p>1</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全地理位置类型。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="24.63%"><p>ATTEST_TYPE_CAMERA</p> </td> <td class="cellrowborder" width="25.03%"><p>2</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全摄像头类型。</p> </td> </tr> <tr><td class="cellrowborder" width="24.63%"><p>ATTEST_TYPE_SECIMAGE_PROCESS</p> </td> <td class="cellrowborder" width="25.03%"><p>3</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全图像处理类型。起始版本：5.1.0(18)。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1348925811317" device-type="phone,tablet,2in1">AttestReturnResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1348925811317" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section166716269293">initializeAttestContext</a>接口的返回值。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.28.6.1.6.1.1" width="10.63%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.28.6.1.6.1.2" width="23.14%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.28.6.1.6.1.3" width="8.35%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.28.6.1.6.1.4" width="7.8%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.28.6.1.6.1.5" width="50.080000000000005%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="10.63%"><p>certChains</p> </td> <td class="cellrowborder" width="23.14%"><p>Array&lt;string&gt;</p> </td> <td class="cellrowborder" width="8.35%"><p>否</p> </td> <td class="cellrowborder" width="7.8%"><p>否</p> </td> <td class="cellrowborder" width="50.080000000000005%"><p>打开证明会话成功之后返回的匿名证书链</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>示例：</strong></p> <div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// device_id 需要指定为 Bigint类型</span></li><li><span class="hljs-keyword">let</span> device_id_tt = <span class="hljs-number">12581</span>;</li><li><span class="hljs-comment">// userdata的长度需要超过16个Bytes，最大长度为127 Bytes</span></li><li><span class="hljs-keyword">let</span> user_data = <span class="hljs-string">"test_user_data_0000"</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties2</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_TYPE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestType</span>.<span class="hljs-property">ATTEST_TYPE_LOCATION</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_ID</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-title class_">BigInt</span>(device_id_tt)</li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options2</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties2,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">initializeAttestContext</span>(user_data, options2).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">AttestReturnResult</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> chains = returnResult.<span class="hljs-property">certChains</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> item <span class="hljs-keyword">of</span> chains) {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'item: '</span> + item);</li><li>    };</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to initialize attest context, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section941522882520" device-type="phone,tablet,2in1">AttestExceptionErrCode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section941522882520" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>可信应用服务中创建证明密钥、销毁证明密钥、初始化证明会话、结束证明会话、获取当前安全位置等接口的错误码。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.31.5.1.4.1.1" width="48.309999999999995%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.31.5.1.4.1.2" width="20.77%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.31.5.1.4.1.3" width="30.919999999999998%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_NO_PERMISSION</p> </td> <td class="cellrowborder" width="20.77%"><p>201</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>权限校验失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_ILLEGAL_ARGUMENT</p> </td> <td class="cellrowborder" width="20.77%"><p>401</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>参数检查失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_INVALID_ALG_ARGUMENT</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500001</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>无效的算法参数。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_MISSING_ARGUMENT</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500002</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>参数传入不足。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_KEY_GENERATOR_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500003</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>密钥生成失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_CERTS_CREATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500004</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>证书创建失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_FILE_OPERATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500005</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>文件操作失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_COMMUNICATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500006</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>IPC通信失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_ITEM_NOT_FOUND</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500007</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>密钥不存在。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_CERTS_VERIFICATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500008</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>证书校验失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_CERTS_EXPIRED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500009</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>证书已过期。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_KEY_NOT_MATCHED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500010</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>密钥不匹配。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_SECURE_CAMERA_INITIALIZATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500011</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>安全相机初始化失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_CONTEXT_BAD_STATE</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500012</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>证明会话上下文异常。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_KEY_EXPIRED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500013</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>密钥已过期。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_LOCATION_SERVICE_UNAVAILABLE</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500014</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>位置服务不可用。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_LOCATION_SWITCH_OFF</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500015</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>位置信息开关关闭。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_LOCATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500016</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>位置信息获取失败。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_SIGNATURE_VERIFICATION_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500017</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>签名验签失败。</p> <p><strong>起始版本：5.1.0(18)。</strong></p> </td> </tr> <tr><td class="cellrowborder" width="48.309999999999995%"><p>ATTEST_ERROR_SECIMAGE_PROCESS_FAILED</p> </td> <td class="cellrowborder" width="20.77%"><p>1011500018</p> </td> <td class="cellrowborder" width="30.919999999999998%"><p>安全图像处理失败。</p> <p><strong>起始版本：5.1.0(18)。</strong></p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section18667940102912" device-type="phone,tablet,2in1">finalizeAttestContext<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18667940102912" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>finalizeAttestContext(options: AttestOptions): Promise&lt;void&gt;</p> <p>结束证明会话，在结束安全证明服务后调用，使用Promise异步回调。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </div> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.34.1.5.1.1" width="15.141514151415143%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.34.1.5.1.2" width="17.811781178117812%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.34.1.5.1.3" width="17.7017701770177%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.34.1.5.1.4" width="49.344934493449344%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15.141514151415143%"><p>options</p> </td> <td class="cellrowborder" width="17.811781178117812%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18297145185618">AttestOptions</a></p> </td> <td class="cellrowborder" width="17.7017701770177%"><p>是</p> </td> <td class="cellrowborder" width="49.344934493449344%"><p>关闭证明会话的参数，需要指定设备类型。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.36.1.3.1.1" width="45.71%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.36.1.3.1.2" width="54.290000000000006%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="45.71%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="54.290000000000006%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.39.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.39.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>401</p> </td> <td class="cellrowborder" width="75.29%"><p>argument is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500002</p> </td> <td class="cellrowborder" width="75.29%"><p>param is missing.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500006</p> </td> <td class="cellrowborder" width="75.29%"><p>IPC communication failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500007</p> </td> <td class="cellrowborder" width="75.29%"><p>item not found.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">AttestParam</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">AttestTag</span>.<span class="hljs-property">ATTEST_TAG_DEVICE_TYPE</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">AttestType</span>.<span class="hljs-property">ATTEST_TYPE_CAMERA</span></li><li>  }</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: trustedAppService.<span class="hljs-property">AttestOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">finalizeAttestContext</span>(options).<span class="hljs-title function_">then</span>(</li><li>  (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in finalizing attest context'</span>);</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to finalize attest context, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section1744710293017" device-type="phone,tablet">getCurrentSecureLocation<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1744710293017" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>getCurrentSecureLocation(timeout : number, priority: LocatingPriority): Promise&lt;SecureLocation&gt;</p> <p>获取当前安全位置，使用Promise异步回调。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Location</p> <p><strong>需要权限</strong>：ohos.permission.LOCATION 和 ohos.permission.APPROXIMATELY_LOCATION</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </div> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.44.1.5.1.1" width="16.68166816681668%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.44.1.5.1.2" width="18.55185518551855%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.44.1.5.1.3" width="16.43164316431643%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.44.1.5.1.4" width="48.33483348334833%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.68166816681668%"><p>timeout</p> </td> <td class="cellrowborder" width="18.55185518551855%"><p>number</p> </td> <td class="cellrowborder" width="16.43164316431643%"><p>是</p> </td> <td class="cellrowborder" width="48.33483348334833%"><p>单次位置请求的超时时间，单位是毫秒（milliseconds），最小为1000毫秒。取值范围为大于等于1000。</p> </td> </tr> <tr><td class="cellrowborder" width="16.68166816681668%"><p>priority</p> </td> <td class="cellrowborder" width="18.55185518551855%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section6450421300">LocatingPriority</a></p> </td> <td class="cellrowborder" width="16.43164316431643%"><p>是</p> </td> <td class="cellrowborder" width="48.33483348334833%"><p>获取安全地理位置的优先级策略。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.46.1.3.1.1" width="47.63%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.46.1.3.1.2" width="52.370000000000005%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="47.63%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section168048435326">SecureLocation</a>&gt;</p> </td> <td class="cellrowborder" width="52.370000000000005%"><p>获取的安全位置</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.49.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.49.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>201</p> </td> <td class="cellrowborder" width="75.29%"><p>has no permission.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>401</p> </td> <td class="cellrowborder" width="75.29%"><p>argument is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500012</p> </td> <td class="cellrowborder" width="75.29%"><p>attestation context not initialized.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500013</p> </td> <td class="cellrowborder" width="75.29%"><p>attestation key has expired.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500014</p> </td> <td class="cellrowborder" width="75.29%"><p>location service is unavailable.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500015</p> </td> <td class="cellrowborder" width="75.29%"><p>The location switch is off.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500016</p> </td> <td class="cellrowborder" width="75.29%"><p>Failed to obtain the secure geographical location.</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section6450421300" device-type="phone,tablet">LocatingPriority<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section6450421300" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>获取安全地理位置的优先级策略。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Location</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.50.6.1.4.1.1" width="21.349999999999998%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.50.6.1.4.1.2" width="27.49%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.50.6.1.4.1.3" width="51.160000000000004%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.349999999999998%"><p>PRIORITY_ACCURACY</p> </td> <td class="cellrowborder" width="27.49%"><p>0</p> </td> <td class="cellrowborder" width="51.160000000000004%"><p>精度优先，保证获取最高精度。</p> </td> </tr> <tr><td class="cellrowborder" width="21.349999999999998%"><p>PRIORITY_LOCATING_SPEED</p> </td> <td class="cellrowborder" width="27.49%"><p>1</p> </td> <td class="cellrowborder" width="51.160000000000004%"><p>速度优先，保证位置获取速度。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section168048435326" device-type="phone,tablet">SecureLocation<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section168048435326" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>获取的安全地理位置。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Location</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.51.6.1.6.1.1" width="14.948505149485051%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.51.6.1.6.1.2" width="10.268973102689731%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.51.6.1.6.1.3" width="7.519248075192481%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.51.6.1.6.1.4" width="14.64853514648535%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.51.6.1.6.1.5" width="52.614738526147384%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.948505149485051%"><p>originalLocation</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section7212957123210">Location</a></p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.64853514648535%"><p>否</p> </td> <td class="cellrowborder" width="52.614738526147384%"><p>地理位置信息。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>userData</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>String</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.64853514648535%"><p>否</p> </td> <td class="cellrowborder" width="52.614738526147384%"><p>用户数据，长度在16到127字节之间。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>signature</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>String</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.64853514648535%"><p>否</p> </td> <td class="cellrowborder" width="52.614738526147384%"><p>签名结果。</p> <p>当证明密钥长度为256位时，signature长度为96字节；</p> <p>当证明密钥长度为384位时，signature长度为136或者140字节。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section7212957123210" device-type="phone,tablet">Location<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7212957123210" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>获取的安全地理位置信息。</p> <p><strong>元服务API：</strong>从版本5.0.2(14)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Location</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.52.6.1.6.1.1" width="14.948505149485051%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.52.6.1.6.1.2" width="10.268973102689731%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.52.6.1.6.1.3" width="7.519248075192481%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.52.6.1.6.1.4" width="14.7985201479852%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.52.6.1.6.1.5" width="52.46475352464755%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.948505149485051%"><p>latitude</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>number</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>纬度，正值表示北纬，负值表示南纬。取值范围为-90到90。仅支持WGS84坐标系。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>longitude</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>number</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>经度，正值表示东经，负值表示西经。取值范围为-180到180。仅支持WGS84坐标系。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>altitude</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>number</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>高度，单位米。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>accuracy</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>number</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>精度，单位米，取值大于等于0。</p> </td> </tr> <tr><td class="cellrowborder" width="14.948505149485051%"><p>timestamp</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>number</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>时间戳，单位毫秒，取值大于等于0。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>示例：</strong></p> <div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> secureLocation = <span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">getCurrentSecureLocation</span>(<span class="hljs-number">3000</span>, trustedAppService.<span class="hljs-property">LocatingPriority</span>.<span class="hljs-property">PRIORITY_LOCATING_SPEED</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting secure location, result = ${JSON.stringify(secureLocation)}'</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get secure location, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> <div class="tiledSection"><h2 id="section4271646181318" device-type="phone,tablet,2in1">procSecImageTransform<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section4271646181318" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>procSecImageTransform(srcSecImage: ArrayBuffer, procParams: SecImageProcParamsArray): Promise&lt;SecImageBuffer&gt;</p> <p>处理安全图像压缩、裁剪操作，使用Promise异步回调。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.1" width="16.68166816681668%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.2" width="19.251925192519252%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.3" width="15.731573157315731%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.55.7.1.5.1.4" width="48.33483348334833%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.68166816681668%"><p>srcSecImage</p> </td> <td class="cellrowborder" width="19.251925192519252%"><p>ArrayBuffer</p> </td> <td class="cellrowborder" width="15.731573157315731%"><p>是</p> </td> <td class="cellrowborder" width="48.33483348334833%"><p>安全相机返回签名后的安全图像。</p> </td> </tr> <tr><td class="cellrowborder" width="16.68166816681668%"><p>procParams</p> </td> <td class="cellrowborder" width="19.251925192519252%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section1429553183618">SecImageProcParamsArray</a></p> </td> <td class="cellrowborder" width="15.731573157315731%"><p>是</p> </td> <td class="cellrowborder" width="48.33483348334833%"><p>安全图像压缩、裁剪处理的参数。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.55.9.1.3.1.1" width="47.63%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.55.9.1.3.1.2" width="52.370000000000005%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="47.63%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section147282975418">SecImageBuffer</a>&gt;</p> </td> <td class="cellrowborder" width="52.370000000000005%"><p>返回压缩、裁剪处理后签名的安全图像</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-arktsapi-errcode">ArkTS API错误码</a><strong>。</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.55.12.1.3.1.1" width="24.709999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.55.12.1.3.1.2" width="75.29%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="24.709999999999997%"><p>401</p> </td> <td class="cellrowborder" width="75.29%"><p>Parameter error. Possible causes: 1. Mandatory parameters are left unspecified. 2. Incorrect parameter types. 3.Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500012</p> </td> <td class="cellrowborder" width="75.29%"><p>attestation context not initialized.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500013</p> </td> <td class="cellrowborder" width="75.29%"><p>attestation key has expired.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500017</p> </td> <td class="cellrowborder" width="75.29%"><p>signature verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="24.709999999999997%"><p>1011500018</p> </td> <td class="cellrowborder" width="75.29%"><p>secure image process failed.</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1429553183618" device-type="phone,tablet,2in1">SecImageProcParamsArray<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1429553183618" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section4271646181318">procSecImageTransform</a>接口的请求参数。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.56.5.1.6.1.1" width="12.34%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.56.5.1.6.1.2" width="26.340000000000003%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.56.5.1.6.1.3" width="8.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.56.5.1.6.1.4" width="8.36%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.56.5.1.6.1.5" width="44%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.34%"><p>properties</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>Array&lt;<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section152961316368">SecImageProcParams</a>&gt;</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的用于安全图像压缩、裁剪处理的配置信息。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section152961316368" device-type="phone,tablet,2in1">SecImageProcParams<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section152961316368" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section1429553183618">SecImageProcParamsArray</a>配置信息的内容条目。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.57.5.1.6.1.1" width="12.34%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.57.5.1.6.1.2" width="26.340000000000003%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.57.5.1.6.1.3" width="8.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.57.5.1.6.1.4" width="8.36%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.57.5.1.6.1.5" width="44%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.34%"><p>tag</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p><a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section918018974416">SecImageProcTag</a></p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的标签，用于安全图像压缩、裁剪处理的配置信息。</p> </td> </tr> <tr><td class="cellrowborder" width="12.34%"><p>value</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>number | <a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section5236627181910">CropRegion</a></p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>开发者应用传入的标签对应的值，用于安全图像压缩、裁剪处理的配置信息。</p> <p><strong>number：</strong></p> <p>1）tag为SECIMAGE_TAG_SRC_IMAGE_FORMAT或者</p> <p>SECIMAGE_TAG_DEST_IMAGE_FORMAT</p> <p>，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section1429553183618">SecImageProcParamsArray</a>类型；</p> <p>2）tag为SECIMAGE_TAG_PROC_OPERATION，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section118088168584">SecImageProcOperation</a>类型；</p> <p>3）tag为SECIMAGE_TAG_COMPRESSION_QUALITY，其值为1到100之间；</p> <p><strong>CropRegion：</strong></p> <p>tag为SECIMAGE_TAG_CROP_REGION，其值为<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section5236627181910">CropRegion</a>类型。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section918018974416" device-type="phone,tablet,2in1">SecImageProcTag<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section918018974416" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>安全图像压缩、裁剪处理的配置信息标签类型，使用<a href="/consumer/cn/doc/harmonyos-references/devicesecurity-taas-api#section18511411417">AttestTagType</a>扩展定义。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.58.5.1.4.1.1" width="28.76%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.58.5.1.4.1.2" width="30.64%"><p><strong>值</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.58.5.1.4.1.3" width="40.6%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_INVALID</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_INVALID|0</p> </td> <td class="cellrowborder" width="40.6%"><p>不合法标签。</p> </td> </tr> <tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_SRC_IMAGE_FORMAT</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|1</p> </td> <td class="cellrowborder" width="40.6%"><p>原始安全图像的格式。</p> </td> </tr> <tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_DEST_IMAGE_FORMAT</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|2</p> </td> <td class="cellrowborder" width="40.6%"><p>压缩、裁剪处理后的安全图像的格式。</p> </td> </tr> <tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_PROC_OPERATION</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|3</p> </td> <td class="cellrowborder" width="40.6%"><p>安全图像的处理命令，支持：压缩命令、裁剪命令、压缩并裁剪命令。</p> </td> </tr> <tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_COMPRESSION_QUALITY</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|4</p> </td> <td class="cellrowborder" width="40.6%"><p>安全图像压缩处理的压缩质量。</p> </td> </tr> <tr><td class="cellrowborder" width="28.76%"><p>SECIMAGE_TAG_CROP_REGION</p> </td> <td class="cellrowborder" width="30.64%"><p>AttestTagType.ATTEST_TAG_TYPE_UINT|5</p> </td> <td class="cellrowborder" width="40.6%"><p>安全图像裁剪处理的裁剪区域。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section118088168584" device-type="phone,tablet,2in1">SecImageProcOperation<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section118088168584" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>安全图像的处理命令。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.59.5.1.4.1.1" width="37.059999999999995%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.59.5.1.4.1.2" width="12.6%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.59.5.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="37.059999999999995%"><p>SECIMAGE_COMPRESSION</p> </td> <td class="cellrowborder" width="12.6%"><p>0</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全图像压缩命令。</p> </td> </tr> <tr><td class="cellrowborder" width="37.059999999999995%"><p>SECIMAGE_CROPPING</p> </td> <td class="cellrowborder" width="12.6%"><p>1</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全图像裁剪命令。</p> </td> </tr> <tr><td class="cellrowborder" width="37.059999999999995%"><p>SECIMAGE_COMPRESSION_AND_CROPPING</p> </td> <td class="cellrowborder" width="12.6%"><p>2</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>安全图像压缩并裁剪命令。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section493510504112" device-type="phone,tablet,2in1">SecImageProcFormat<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section493510504112" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>安全图像的格式。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.60.5.1.4.1.1" width="27.24%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.60.5.1.4.1.2" width="22.42%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.60.5.1.4.1.3" width="50.339999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="27.24%"><p>SECIMAGE_FORMAT_INVALID</p> </td> <td class="cellrowborder" width="22.42%"><p>0</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>无效的安全图像格式。</p> </td> </tr> <tr><td class="cellrowborder" width="27.24%"><p>SECIMAGE_FORMAT_YUV_NV21</p> </td> <td class="cellrowborder" width="22.42%"><p>1</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>YUV420 NV21格式的安全图像。输入原始安全图像格式，以及裁剪命令返回的安全图像格式均为SECIMAGE_FORMAT_YUV_NV21。</p> </td> </tr> <tr><td class="cellrowborder" width="27.24%"><p>SECIMAGE_FORMAT_JPEG</p> </td> <td class="cellrowborder" width="22.42%"><p>2</p> </td> <td class="cellrowborder" width="50.339999999999996%"><p>JPEG格式的安全图像。压缩命令、压缩并裁剪命令返回的安全图像格式均为SECIMAGE_FORMAT_JPEG。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section5236627181910" device-type="phone,tablet,2in1">CropRegion<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section5236627181910" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>安全图像裁剪处理的裁剪区域。裁剪区域参数作用如下图所示。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.61.5.1.6.1.1" width="12.34%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.61.5.1.6.1.2" width="26.340000000000003%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.61.5.1.6.1.3" width="8.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.61.5.1.6.1.4" width="8.36%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.61.5.1.6.1.5" width="44%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.34%"><p>x</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>number</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>裁剪区域左上角点在水平方向（横向）上相对于整个图像左边界的偏移量，取值范围在 0 到 640 之间的偶数。单位是像素（pixel）。</p> </td> </tr> <tr><td class="cellrowborder" width="12.34%"><p>y</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>number</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>裁剪区域左上角点在垂直方向（纵向）上相对于整个图像上边界的偏移量，取值范围在 0 到 480 之间的偶数。单位是像素（pixel）。</p> </td> </tr> <tr><td class="cellrowborder" width="12.34%"><p>width</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>number</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>裁剪区域的宽度，即横向的长度，取值范围在 0 到 640 之间的偶数，且需满足 x 与 width 的和不大于 640。单位是像素（pixel）。</p> </td> </tr> <tr><td class="cellrowborder" width="12.34%"><p>height</p> </td> <td class="cellrowborder" width="26.340000000000003%"><p>number</p> </td> <td class="cellrowborder" width="8.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="8.36%"><p>否</p> </td> <td class="cellrowborder" width="44%"><p>裁剪区域的高度，即纵向的长度，取值范围在 0 到 480 之间的偶数，且需满足 y 与 height 的和不大于 480。单位是像素（pixel）。</p> </td> </tr>  </tbody></table></div> </div> <p><span><img height="500.61333" originheight="718" originwidth="1096" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115944.09249310932395544143121630114985:50001231000000:2800:38D41F97AFBFE2F9FFCAE33AD38C01908784E1B5C1CD91F99904435FD6646B20.jpg" title="点击放大" width="762.09"></span></p> </div> <div class="tiledSection"><h2 id="section147282975418" device-type="phone,tablet,2in1">SecImageBuffer<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section147282975418" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>获得压缩、裁剪处理后签名的安全图像。</p> <p><strong>系统能力：</strong>SystemCapability.Security.TrustedAppService.Core</p> <p><strong>起始版本：</strong>5.1.0(18)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.62.5.1.6.1.1" width="14.948505149485051%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.62.5.1.6.1.2" width="10.268973102689731%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.62.5.1.6.1.3" width="7.519248075192481%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.62.5.1.6.1.4" width="14.7985201479852%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.62.5.1.6.1.5" width="52.46475352464755%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.948505149485051%"><p>secImage</p> </td> <td class="cellrowborder" width="10.268973102689731%"><p>ArrayBuffer</p> </td> <td class="cellrowborder" width="7.519248075192481%"><p>否</p> </td> <td class="cellrowborder" width="14.7985201479852%"><p>否</p> </td> <td class="cellrowborder" width="52.46475352464755%"><p>返回压缩、裁剪处理后签名的安全图像。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>安全图像压缩示例：</strong><div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> srcSecImageBuffer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>);<span class="hljs-comment">// 实际使用请替换为Camera Kit获取到的安全图像buffer</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">SecImageProcParams</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_PROC_OPERATION</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcOperation</span>.<span class="hljs-property">SECIMAGE_COMPRESSION</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_SRC_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像压缩、裁剪命令输入的原始图像格式都为：YUV420 NV21 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_DEST_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_JPEG</span>, <span class="hljs-comment">// 安全图像压缩命令返回的图像格式为：JPEG 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_COMPRESSION_QUALITY</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-number">90</span>, <span class="hljs-comment">// 实际使用请替换为业务场景需要的压缩质量</span></li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">procParams</span>: trustedAppService.<span class="hljs-property">SecImageProcParamsArray</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">procSecImageTransform</span>(srcSecImageBuffer, procParams).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">SecImageBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> returnSecImageBuffer = returnResult.<span class="hljs-property">secImage</span>;</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to process secureImage compression, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> </div> <div class="p"><strong>安全图像裁剪示例：</strong><div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> srcSecImageBuffer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>);<span class="hljs-comment">// 实际使用请替换为Camera Kit获取到的安全图像buffer</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">SecImageProcParams</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_PROC_OPERATION</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcOperation</span>.<span class="hljs-property">SECIMAGE_CROPPING</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_SRC_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像压缩、裁剪命令输入的原始图像格式都为：YUV420 NV21 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_DEST_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>, <span class="hljs-comment">// 安全图像压缩命令返回的图像格式为：JPEG 格式</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_CROP_REGION</span>,</li><li>    <span class="hljs-attr">value</span>: { x : <span class="hljs-number">0</span>, y ：<span class="hljs-number">0</span>, width : <span class="hljs-number">320</span>, height : <span class="hljs-number">240</span> }, <span class="hljs-comment">// 实际使用请替换为业务场景需要的裁剪区域范围</span></li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">procParams</span>: trustedAppService.<span class="hljs-property">SecImageProcParamsArray</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">procSecImageTransform</span>(srcSecImageBuffer, procParams).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">SecImageBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> returnSecImageBuffer = returnResult.<span class="hljs-property">secImage</span>;</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to process secureImage cropping, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> </div> <div class="p"><strong>安全图像压缩并裁剪示例：</strong><div _ngcontent-unt-c106="" class="highlight-div"><div _ngcontent-unt-c106="" class="highlight-div-header"><div _ngcontent-unt-c106="" class="highlight-div-header-left"><div _ngcontent-unt-c106="" class="handle-button expand-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unt-c106="" class="highlight-div-header-right"><div _ngcontent-unt-c106="" class="handle-button ai-button"></div><div _ngcontent-unt-c106="" class="handle-button line-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unt-c106="" class="handle-button theme-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unt-c106="" class="handle-button copy-button"><div _ngcontent-unt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unt-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { trustedAppService } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceSecurityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> srcSecImageBuffer = <span class="hljs-keyword">new</span>  <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">461844</span>);<span class="hljs-comment">// 实际使用请替换为Camera Kit获取到的安全图像buffer</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">properties</span>: <span class="hljs-title class_">Array</span>&lt;trustedAppService.<span class="hljs-property">SecImageProcParams</span>&gt; = [</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_PROC_OPERATION</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcOperation</span>.<span class="hljs-property">SECIMAGE_COMPRESSION_AND_CROPPING</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_SRC_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_YUV_NV21</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_DEST_IMAGE_FORMAT</span>,</li><li>    <span class="hljs-attr">value</span>: trustedAppService.<span class="hljs-property">SecImageProcFormat</span>.<span class="hljs-property">SECIMAGE_FORMAT_JPEG</span>,</li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_COMPRESSION_QUALITY</span>,</li><li>    <span class="hljs-attr">value</span>: <span class="hljs-number">90</span>, <span class="hljs-comment">// 实际使用请替换为业务场景需要的压缩质量</span></li><li>  },</li><li>  {</li><li>    <span class="hljs-attr">tag</span>: trustedAppService.<span class="hljs-property">SecImageProcTag</span>.<span class="hljs-property">SECIMAGE_TAG_CROP_REGION</span>,</li><li>    <span class="hljs-attr">value</span>: { x : <span class="hljs-number">0</span>, y ：<span class="hljs-number">0</span>, width : <span class="hljs-number">320</span>, height : <span class="hljs-number">240</span> }, <span class="hljs-comment">// 实际使用请替换为业务场景需要的裁剪区域范围</span></li><li>  },</li><li>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">procParams</span>: trustedAppService.<span class="hljs-property">SecImageProcParamsArray</span> = {</li><li>  <span class="hljs-attr">properties</span>: properties,</li><li>};</li><li><span class="hljs-keyword">await</span> trustedAppService.<span class="hljs-title function_">procSecImageTransform</span>(srcSecImageBuffer, options).<span class="hljs-title function_">then</span>(</li><li>  (<span class="hljs-attr">returnResult</span>: trustedAppService.<span class="hljs-property">SecImageBuffer</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> returnSecImageBuffer = returnResult.<span class="hljs-property">secImage</span>;</li><li>  }</li><li>).<span class="hljs-title function_">catch</span>(</li><li>  (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to process secureImage cropping, code:<span class="hljs-subst">${err.code}</span>, message:<span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>);</li></ol></pre></div></div> </div> </div> </div> <div></div></div>