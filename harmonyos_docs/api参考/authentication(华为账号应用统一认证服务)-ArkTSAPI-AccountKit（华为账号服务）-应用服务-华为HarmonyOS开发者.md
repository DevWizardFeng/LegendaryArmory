<h1 _ngcontent-pla-c119="" class="doc-title ng-star-inserted" title="authentication (华为账号应用统一认证服务)"> authentication (华为账号应用统一认证服务) </h1>

<div _ngcontent-pla-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供Account Kit（华为账号服务）认证能力，包括账号登录、授权、取消授权等功能。应用可以使用该能力实现应用账号的登录注册、获取华为账号登录状态、手机号一致性校验状态、用户授权信息等。</p>    <p><strong>起始版本：</strong>4.0.0(10)</p>    <div class="tiledSection">     <h2 id="section164051883419" device-type="phone,2in1,tablet,wearable,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section164051883419" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section816451553012" device-type="phone,2in1,tablet,wearable,tv">HuaweiIDProvider<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section816451553012" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类提供实现认证服务的方法，用于创建登录、授权、取消授权请求对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>HuaweiIDProvider继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section1860064133610">AuthenticationProvider</a>。</p>     <p></p>    </div>    <div class="tiledSection">     <h3 id="section7843123616411" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">createLoginWithHuaweiIDRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7843123616411" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>createLoginWithHuaweiIDRequest(): LoginWithHuaweiIDRequest</p>     <p>创建默认scope和permission登录请求对象，可通过属性值设置请求参数。作为应用使用华为账号登录场景的请求参数。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p class="msonormal"><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.1" width="32.2%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.2" width="67.80000000000001%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.2%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section42261825935">LoginWithHuaweiIDRequest</a></p></td>         <td class="cellrowborder" width="67.80000000000001%">          <p>应用登录场景定义应用使用Account Kit登录请求获取UnionID、OpenID等数据的请求对象。华为账号登录场景请求对象参数请应用根据自身实际场景进行选择。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> huaweiIdProvider = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>();</li><li><span class="hljs-keyword">const</span> loginWithHuaweiIDRequest = huaweiIdProvider.<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section610319714214" device-type="phone,2in1,tablet,wearable,tv">createAuthorizationWithHuaweiIDRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section610319714214" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>createAuthorizationWithHuaweiIDRequest(): AuthorizationWithHuaweiIDRequest</p>     <p>创建一个Account Kit授权请求对象，可通过属性值设置请求参数。作为应用使用华为账号登录场景的请求参数。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p class="msonormal"><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.6.9.1.3.1.1" width="38.24%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.9.1.3.1.2" width="61.760000000000005%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="38.24%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a></p></td>         <td class="cellrowborder" width="61.760000000000005%">          <p>定义应用授权获取用户信息请求对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> huaweiIdProvider = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>();</li><li><span class="hljs-keyword">const</span> request = huaweiIdProvider.<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section110814213429" device-type="phone,2in1,tablet,wearable,tv">createCancelAuthorizationRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section110814213429" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>createCancelAuthorizationRequest(): CancelAuthorizationRequest</p>     <p>创建一个Account Kit取消授权请求对象，可通过属性值设置参数。作为应用取消华为账号授权场景的请求参数。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p class="msonormal"><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section17720275174">CancelAuthorizationRequest</a></p></td>         <td class="cellrowborder" width="67.84%">          <p>定义应用取消Account Kit授权请求对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> huaweiIdProvider = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>();</li><li><span class="hljs-keyword">const</span> cancelAuthorizationRequest = huaweiIdProvider.<span class="hljs-title function_">createCancelAuthorizationRequest</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section102884586336" device-type="phone,2in1,tablet,wearable,tv">getHuaweiIDState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section102884586336" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getHuaweiIDState(request: StateRequest): Promise&lt;StateResult&gt;</p>     <p>获取华为账号登录状态，使用Promise异步回调。在应用需要判断账号是否已登录场景下使用，不依赖网络连接。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.1" width="10.67%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.2" width="27.52%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.3" width="9.64%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.4" width="52.17%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="10.67%">          <p>request</p></td>         <td class="cellrowborder" width="27.52%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section9615740103819">StateRequest</a></p></td>         <td class="cellrowborder" width="9.64%">          <p>是</p></td>         <td class="cellrowborder" width="52.17%">          <p>获取华为账号登录状态请求对象，包含请求参数。</p></td>        </tr>             </tbody></table></div>     </div>     <p class="msonormal"><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.1" width="34.88%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.2" width="65.12%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="34.88%">          <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section18875010506">StateResult</a>&gt;</p></td>         <td class="cellrowborder" width="65.12%">          <p>Promise对象，返回<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section18875010506">StateResult</a>对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account" target="_blank">账号管理错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code">ArkTS错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.14.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.14.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account#section12300001-系统服务异常" target="_blank">12300001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>System service works abnormally.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid input parameter value.</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">stateRequest</span>: authentication.<span class="hljs-property">StateRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span> <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 执行获取华为账号登录状态请求，并处理结果</span></li><li>  <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">getHuaweiIDState</span>(stateRequest).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: authentication.StateResult</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting huaweiIdState result.'</span>);</li><li>    <span class="hljs-keyword">const</span> state = data.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-comment">// 处理state</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">dealAllError</span>(error);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get huaweiIdState, errorCode=<span class="hljs-subst">${error.code}</span>, errorMsg=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section571965992211" device-type="phone,2in1,tablet,wearable,tv">getMobileNumberConsistency<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section571965992211" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getMobileNumberConsistency(request: ConsistencyRequest): Promise&lt;ConsistencyResult&gt;</p>     <p>获取手机号一致性状态，使用Promise异步回调。在应用需要校验华为账号绑定的手机号是否与本机SIM卡一致场景下使用。</p>     <p>开发者在使用获取手机号一致性状态接口前，需要完成quickLoginMobilePhone（华为账号一键登录）的scope权限申请，详情参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#section95093591227" target="_blank">开发前提</a>。scope权限申请审批未完成或未通过，将报错<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section78953611814">1001502014 应用未申请scopes或permissions权限</a>。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>设备行为差异：</strong>该接口在Phone、PC/2in1、Tablet中可正常调用，在其他设备类型中返回801错误码。</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.5.1.1" width="10.530000000000001%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.5.1.2" width="20.87%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.5.1.3" width="25.869999999999997%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.10.1.5.1.4" width="42.730000000000004%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="10.530000000000001%">          <p>request</p></td>         <td class="cellrowborder" width="20.87%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section168131411512">ConsistencyRequest</a></p></td>         <td class="cellrowborder" width="25.869999999999997%">          <p>是</p></td>         <td class="cellrowborder" width="42.730000000000004%">          <p>获取手机号一致性请求对象，包含请求参数。</p></td>        </tr>             </tbody></table></div>     </div>     <p class="msonormal"><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.12.1.3.1.1" width="34.88%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.12.1.3.1.2" width="65.12%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="34.88%">          <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section155352089012">ConsistencyResult</a>&gt;</p></td>         <td class="cellrowborder" width="65.12%">          <p>Promise对象，返回<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section155352089012">ConsistencyResult</a>对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code">ArkTS错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.15.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.15.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Parameter error. Possible causes:</p>          <p>1. Mandatory parameters are left unspecified; 2. Incorrect parameter types; 3. Parameter verification failed.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section801-该设备不支持此api" target="_blank">801</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Capability not supported. Function getMobileNumberConsistency can not work correctly due to limited device capabilities.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1581681312511">1001500001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Failed to check the fingerprint of the app bundle.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section13107132603718">1001500004</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The account does not support this function.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section612754419379">1001500005</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>This function is restricted from being called.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The user has not logged in with HUAWEI ID.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1393125918588">1001502002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The application is not authorized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1281526328">1001502005</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Network error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section17561151616317">1001502009</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Internal error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section78953611814">1001502014</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The app does not have the required scopes or permissions.</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">consistencyRequest</span>: authentication.<span class="hljs-property">ConsistencyRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span>, <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>  <span class="hljs-attr">mobileNumber</span>: <span class="hljs-string">'+86xxxxxxxxxxx'</span> <span class="hljs-comment">// 通过华为账号一键登录功能获取到的明文手机号</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 执行获取手机号一致性状态请求，并处理结果</span></li><li>  <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">getMobileNumberConsistency</span>(consistencyRequest)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: authentication.ConsistencyResult</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in getting getMobileNumberConsistency result = <span class="hljs-subst">${data.state}</span>`</span>);</li><li>      <span class="hljs-keyword">const</span> state = data.<span class="hljs-property">state</span>;</li><li>      <span class="hljs-comment">// 处理state</span></li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title function_">dealAllError</span>(err);</li><li>    })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,</li><li>    <span class="hljs-string">`Failed to get mobileNumberConsistency, errorCode=<span class="hljs-subst">${error.code}</span>, errorMsg=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section42261825935" device-type="phone,2in1,tablet,wearable,tv">LoginWithHuaweiIDRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section42261825935" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>应用登录场景定义应用使用Account Kit登录请求获取UnionID、OpenID等数据的请求对象。华为账号登录场景请求对象参数请应用根据自身实际场景进行选择。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>LoginWithHuaweiIDRequest继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348">AuthenticationRequest</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.6.1.1" width="16%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.6.1.2" width="15.559999999999999%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.6.1.3" width="17.73%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.6.1.4" width="17.01%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.6.1.5" width="33.7%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="16%">          <p>forceLogin</p></td>         <td class="cellrowborder" width="15.559999999999999%">          <p>boolean</p></td>         <td class="cellrowborder" width="17.73%">          <p>否</p></td>         <td class="cellrowborder" width="17.01%">          <p>是</p></td>         <td class="cellrowborder" width="33.7%">          <p>表示是否需要强制拉起华为账号登录页。</p>          <p>如果该值为true，华为账号未登录时，则将拉起华为账号登录页。</p>          <p>如果该值为false，且华为账号未登录，调用<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3975181884311">executeRequest</a>将返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001 用户未登录华为账号</a>。</p>          <p>默认值：true。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16%">          <p>state</p></td>         <td class="cellrowborder" width="15.559999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="17.73%">          <p>否</p></td>         <td class="cellrowborder" width="17.01%">          <p>是</p></td>         <td class="cellrowborder" width="33.7%">          <p>请求体中的state参数，该参数与响应体中返回的state比较，校验是否是当前请求，可防止跨站攻击。</p>          <p>开发者可自定义，字符包含0-9、a-z、A-Z、英文点号、英文冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。</p>          <p>推荐开发者用随机数并做一致性校验。建议生成方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9" target="_blank">util.generateRandomUUID()</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16%">          <p>nonce</p></td>         <td class="cellrowborder" width="15.559999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="17.73%">          <p>否</p></td>         <td class="cellrowborder" width="17.01%">          <p>是</p></td>         <td class="cellrowborder" width="33.7%">          <p>请求体中的nonce参数，该参数会包含在返回的ID Token中，通过校验一致性，可用于防止重放攻击。</p>          <p>字符包含0-9、a-z、A-Z、点号、冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。</p>          <p>如该参数未传、传空，ID Token中nonce默认值：“default”。</p>          <p>推荐开发者用随机数并做一致性校验。建议生成方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9" target="_blank">util.generateRandomUUID()</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16%">          <p>idTokenSignAlgorithm</p></td>         <td class="cellrowborder" width="15.559999999999999%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3339031310">IdTokenSignAlgorithm</a></p></td>         <td class="cellrowborder" width="17.73%">          <p>否</p></td>         <td class="cellrowborder" width="17.01%">          <p>是</p></td>         <td class="cellrowborder" width="33.7%">          <p>用于指定ID Token的签名算法。应用根据实际安全要求、性能、系统环境兼容性进行选择。</p>          <p>默认值：PS256。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 默认值为true，若账号未登录则强制拉起账号登录页</span></li><li>loginRequest.<span class="hljs-property">forceLogin</span> = <span class="hljs-literal">true</span>;</li><li>loginRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>; <span class="hljs-comment">// 默认为PS256</span></li><li>loginRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section3339031310" device-type="phone,2in1,tablet,wearable,tv">IdTokenSignAlgorithm<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section3339031310" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>ID Token签名算法，该类型为枚举，根据IdTokenSignAlgorithm的不同类型，对ID Token进行不同方式的加密。请应用根据实际安全要求、性能、系统环境兼容性进行选择。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.4.1.1" width="34.13%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.4.1.2" width="28.660000000000004%">          <p>值</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.4.1.3" width="37.21%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="34.13%">          <p>PS256</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p>1</p></td>         <td class="cellrowborder" width="37.21%">          <p>RSASSA-PSS使用SHA-256和基于SHA-256的MGF1。为保证安全性建议使用PS256。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>RS256</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p>2</p></td>         <td class="cellrowborder" width="37.21%">          <p>RSASSA-PKCS1-v1_5使用SHA-256。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 默认值为true，若账号未登录则强制拉起账号登录页</span></li><li>loginRequest.<span class="hljs-property">forceLogin</span> = <span class="hljs-literal">true</span>;</li><li>loginRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section15454203811311" device-type="phone,2in1,tablet,wearable,tv">LoginWithHuaweiIDResponse<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section15454203811311" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Account Kit登录请求响应对象，解析响应结果可得到OpenID、UnionID、Authorization Code、ID Token数据。作为华为账号登录成功的返回结果，用于获取或关联华为账号相关信息。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>LoginWithHuaweiIDResponse继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.6.1.1" width="9.969999999999999%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.6.1.2" width="19.88%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.6.1.3" width="19.439999999999998%">          <p><strong>只读</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="9.969999999999999%">          <p>data</p></td>         <td class="cellrowborder" width="19.88%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section17820155561513">LoginWithHuaweiIDCredential</a></p></td>         <td class="cellrowborder" width="19.439999999999998%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>登录结果数据，用于获取或关联华为账号相关信息。包含openID、unionID、authorizationCode、idToken字段。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="9.969999999999999%">          <p>state</p></td>         <td class="cellrowborder" width="19.88%">          <p>string</p></td>         <td class="cellrowborder" width="19.439999999999998%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>响应体中返回的state，账号服务将该字段与请求体中传入的state比较，防止跨站攻击。字符包含“0-9”、“a-z”、“A-Z”、英文点号、英文冒号、斜杠、下划线等，长度限制1-255。校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建登录请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 默认值为true，若账号未登录则强制拉起账号登录页</span></li><li>loginRequest.<span class="hljs-property">forceLogin</span> = <span class="hljs-literal">true</span>;</li><li>loginRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>loginRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>
</li><li><span class="hljs-comment">// 执行登录请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(loginRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> loginWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">LoginWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = loginWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; loginRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in login.'</span>);</li><li>    <span class="hljs-keyword">const</span> loginWithHuaweiIDCredential = loginWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> code = loginWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = loginWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-comment">// 开发者处理code, idToken</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在应用登录涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_INTERNAL_ERROR</span>) {</li><li>    <span class="hljs-comment">// 登录失败，请尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 应用登录失败，请尝试使用其他方式登录</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 内部错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_INTERNAL_ERROR</span> = <span class="hljs-number">1001502009</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section17820155561513" device-type="phone,2in1,tablet,wearable,tv">LoginWithHuaweiIDCredential<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17820155561513" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Account Kit登录成功返回的凭据，用于获取用户相关信息和关联华为账号（OpenID/UnionID）。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.6.1.1" width="19.900000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.6.1.2" width="13.459999999999999%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.6.1.3" width="15.93%">          <p><strong>只读</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="19.900000000000002%">          <p>authorizationCode</p></td>         <td class="cellrowborder" width="13.459999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="15.93%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>Authorization Code。临时凭据，用于获取Access Token，有效时间5分钟，并且只能使用1次。长度限制1-1024。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="19.900000000000002%">          <p>idToken</p></td>         <td class="cellrowborder" width="13.459999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="15.93%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>ID Token。JWT格式的字符串，包含用户信息，用于应用获取部分用户相关信息及验证签名。长度限制1-2048。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="19.900000000000002%">          <p>openID</p></td>         <td class="cellrowborder" width="13.459999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="15.93%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p><span style="color: rgb(53,53,53);">OpenID。OpenID是华为账号用户在不同类型的产品的身份ID</span>，同一个用户，不同应用，OpenID值不同。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="19.900000000000002%">          <p>unionID</p></td>         <td class="cellrowborder" width="13.459999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="15.93%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p><span style="color: rgb(53,53,53);">UnionID。</span><span style="color: rgb(53,53,53);">UnionID是华为账号用户在同一个开发者账号下产品的身份ID</span>，同一个用户，<span style="color: rgb(53,53,53);">同一个开发者账号下</span>管理的不同应用，UnionID值相同。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建登录请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 默认值为true，若账号未登录则强制拉起账号登录页</span></li><li>loginRequest.<span class="hljs-property">forceLogin</span> = <span class="hljs-literal">true</span>;</li><li>loginRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>loginRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>
</li><li><span class="hljs-comment">// 执行登录请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(loginRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> loginWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">LoginWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = loginWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; loginRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>,</li><li>        <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in login.'</span>);</li><li>
</li><li>    <span class="hljs-keyword">const</span> loginWithHuaweiIDCredential = loginWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> code = loginWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = loginWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-comment">// 开发者处理code, idToken</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在应用登录涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_INTERNAL_ERROR</span>) {</li><li>    <span class="hljs-comment">// 登录失败，请尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 应用登录失败，请尝试使用其他方式登录</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 内部错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_INTERNAL_ERROR</span> = <span class="hljs-number">1001502009</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section12940173017165" device-type="phone,2in1,tablet,wearable,tv">AuthorizationWithHuaweiIDRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section12940173017165" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为应用创建的授权请求对象，使用Account Kit请求授权以申请更多的用户信息，包括scopes、permissions等属性。作为向华为账号申请授权的请求对象，应用根据实际场景按需获取。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>AuthorizationWithHuaweiIDRequest继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348">AuthenticationRequest</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.6.1.1" width="17.330000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.6.1.2" width="15.14%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.6.1.3" width="16.82%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.6.1.4" width="16.29%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.16.7.1.6.1.5" width="34.42%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>scopes</p></td>         <td class="cellrowborder" width="15.14%">          <p>string[]</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>scope列表，用于获取用户数据。与permissions属性不能同时为空，否则会返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003 输入参数值无效</a>错误码。如果传入不合法的scope（例如空值等）则直接返回OpenID和UnionID。</p>          <p>默认值：['openid']。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>          <p>scope取值范围：</p>          <ul>           <li>profile：华为账号用户的基本信息，如昵称头像等（元服务从5.1.1(19)开始，支持该scope，并需配合supportAtomicService参数使用）。</li>           <li>openid：华为账号用户的OpenID、UnionID。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</li>           <li>phone：华为账号快速验证手机号（元服务不能直接调用该接口获取手机号，可参考场景化控件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/scenario-fusion-button-getphonenumber" target="_blank">快速验证手机号</a>获取。儿童账号的手机号无法通过该scope获取），使用该scope前需要申请账号权限，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-get-phonenumber#section2011736191112" target="_blank">开发前提</a>。</li>           <li>quickLoginAnonymousPhone：获取华为账号绑定的匿名手机号（该scope只能与openid同时使用，Wearable设备以及海外账号无法获取到手机号，会报<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section116574197436">1001500003 不支持该scopes或permissions</a>），使用该scope前需要申请账号权限，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login#section95093591227" target="_blank">开发前提</a>。            <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">              <p><strong>中国境内（不包含中国香港、中国澳门、中国台湾）匿名手机号的返回格式不包含国际电话区号，其他国家和地区默认包含国际电话区号。</strong></p>             </div></div></div></li>           <li>riskLevel：获取用户风险等级（该scope 仅支持与openid、phone、profile组合使用，元服务不支持与phone组合使用。海外账号不支持获取风险等级），使用该scope前需要申请账号权限，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-get-risklevel-on-demand-acquisition#section13750142919492" target="_blank">开发前提</a>。</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>permissions</p></td>         <td class="cellrowborder" width="15.14%">          <p>string[]</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>permission列表，用于获取用户授权临时凭据和用户身份认证信息。与scopes属性不能同时为空，否则会返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003 输入参数值无效</a>错误码。如果传入不合法的permission（例如空值等）则直接返回OpenID和UnionID。</p>          <p>默认值为空，不返回用户授权临时凭据和用户身份认证信息。</p>          <p>permission取值范围：</p>          <ul>           <li>serviceauthcode：用户授权临时凭据。</li>           <li>idtoken：用户身份认证信息。</li>          </ul>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>forceAuthorization</p></td>         <td class="cellrowborder" width="15.14%">          <p>boolean</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>表示华为账号未登录时，是否需要强制拉起华为账号登录页。</p>          <p>默认值：true。</p>          <p>如果该值为true且用户未登录或未授权，则会拉起用户登录或授权页面。</p>          <p>如果该值为false并且用户未登录，执行授权请求将返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001 用户未登录华为账号</a>。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>state</p></td>         <td class="cellrowborder" width="15.14%">          <p>string</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>请求体中的state参数，开发者可自定义，字符包含0-9、a-z、A-Z、点号、冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。该参数与响应体中返回的state比较，校验是否是当前请求，可防止跨站攻击。</p>          <p>推荐开发者用随机数并做一致性校验。建议生成方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9" target="_blank">util.generateRandomUUID()</a>。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>nonce</p></td>         <td class="cellrowborder" width="15.14%">          <p>string</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>请求体中的nonce参数，字符包含0-9、a-z、A-Z、点号、冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。该参数会包含在返回的ID Token中，通过校验一致性，可用于防止重放攻击。如该参数未传、传空，ID Token中nonce默认值：“default”。</p>          <p>推荐开发者用随机数并做一致性校验。建议生成方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9" target="_blank">util.generateRandomUUID()</a>。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>idTokenSignAlgorithm</p></td>         <td class="cellrowborder" width="15.14%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3339031310">IdTokenSignAlgorithm</a></p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>默认值：PS256，用于指定ID Token的签名算法。应用根据实际安全要求、性能、系统环境兼容性进行选择。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>supportAtomicService</p></td>         <td class="cellrowborder" width="15.14%">          <p>boolean</p></td>         <td class="cellrowborder" width="16.82%">          <p>否</p></td>         <td class="cellrowborder" width="16.29%">          <p>是</p></td>         <td class="cellrowborder" width="34.42%">          <p>在元服务场景下，当传入scopes包含profile时，是否支持获取用户头像昵称。</p>          <p>默认值：false。</p>          <p>如果该值为true，可以正常获取用户头像昵称。</p>          <p>如果该值为false，执行授权请求将返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section116574197436">1001500003 不支持该scopes或permissions</a>。</p>          <p><strong>起始版本</strong>：5.1.1(19)</p>          <p><strong>元服务API：</strong>从版本5.1.1(19)开始，该接口支持在元服务中使用。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>用于元服务场景调用。</p>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li><li>authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'profile'</span>]; <span class="hljs-comment">// 元服务可传supportAtomicService值为true，以使用profile授权能力</span></li><li>authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'idtoken'</span>];</li><li>authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</li><li>authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>authRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section10418450161620" device-type="phone,2in1,tablet,wearable,tv">AuthorizationWithHuaweiIDResponse<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10418450161620" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类封装<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>授权请求对象获取的用户信息结果。作为华为账号授权成功的返回结果，用于获取或关联华为账号用户信息。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>AuthorizationWithHuaweiIDResponse继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.6.1.1" width="11.27%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.6.1.2" width="20.52%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.6.1.3" width="17.48%">          <p><strong>只读</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.6.1.4" width="17.91%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="11.27%">          <p>data</p></td>         <td class="cellrowborder" width="20.52%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section1846111631718">AuthorizationWithHuaweiIDCredential</a></p></td>         <td class="cellrowborder" width="17.48%">          <p>是</p></td>         <td class="cellrowborder" width="17.91%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>用户授权结果数据，用于获取或关联华为账号用户信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="11.27%">          <p>state</p></td>         <td class="cellrowborder" width="20.52%">          <p>string</p></td>         <td class="cellrowborder" width="17.48%">          <p>是</p></td>         <td class="cellrowborder" width="17.91%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>响应体中返回的state，字符包含0-9、a-z、A-Z、英文点号、英文冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。与请求体中传入的state比较，校验是否是当前请求，防止跨站攻击。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建授权请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 'openid'为默认值可不传，开发者若需要获取其他用户信息，可传入其他scope参数，具体请参考AuthorizationWithHuaweiIDRequest类说明</span></li><li>authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'openid'</span>];</li><li>authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'idtoken'</span>, <span class="hljs-string">'serviceauthcode'</span>];</li><li>authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</li><li>authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>authRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>
</li><li><span class="hljs-comment">// 执行授权请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(authRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">AuthorizationWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = authorizationWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; authRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to authorize. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in authentication.'</span>);</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDCredential = authorizationWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = authorizationWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-keyword">const</span> code = authorizationWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-comment">// 开发者处理idToken, code等信息</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain userInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取用户信息失败，请稍后重试</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1846111631718" device-type="phone,2in1,tablet,wearable,tv">AuthorizationWithHuaweiIDCredential<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1846111631718" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>Account Kit授权成功返回的凭据，用于获取用户相关信息（头像昵称、匿名手机号等）和关联华为账号（OpenID/UnionID）。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.6.1.1" width="17.330000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.6.1.2" width="13.569999999999999%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.6.1.3" width="18.39%">          <p><strong>只读</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.18.6.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>authorizationCode</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>Authorization Code。临时凭据，用于获取Access Token。有效时间5分钟，并且只能使用1次。长度限制1-1024。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的permissions中传入'serviceauthcode'参数时返回。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>idToken</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>ID Token。JWT格式的字符串，包含用户信息，用于应用获取部分用户相关信息及验证签名。长度限制1-2048。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的permissions中传入'idtoken'参数时返回。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>openID</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>OpenID。OpenID是华为账号用户在不同类型的产品的身份ID，同一个用户不同应用，OpenID值不同。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p>          <p><strong>返回场景</strong>：默认返回。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>unionID</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>UnionID。<span style="color: rgb(53,53,53);">UnionID是华为账号用户在同一个开发者账号下产品的身份ID</span>，同一个用户，<span style="color: rgb(53,53,53);">同一个开发者账号下</span>管理的不同应用，UnionID值相同。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p>          <p><strong>返回场景</strong>：默认返回。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>avatarUri</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>用户头像链接，有效期较短，建议先将头像下载保存后再使用。</p>          <p>没有长度限制，格式例如：https://xxx/xxx。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的scopes中传入'profile'参数时返回。</p>          <p><strong>元服务API：</strong>从版本6.0.0(20)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>nickName</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>用户昵称。长度限制2-20个字符。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的scopes中传入'profile'参数时返回。</p>          <p><strong>元服务API：</strong>从版本6.0.0(20)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>email</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>用户邮箱。长度限制4-254。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的scopes中传入'email'参数时返回。</p>          <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">            <p>元服务不支持该字段。</p>           </div></div></div></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>authorizedScopes</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>string[]</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>本次授权成功的scope清单，通过设置对应scope授权成功后返回Authorization Code来获取对应用户信息。</p>          <p><strong>返回场景</strong>：默认返回'openid'。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>extraInfo</p></td>         <td class="cellrowborder" width="13.569999999999999%">          <p>Record&lt;string, Object&gt;</p></td>         <td class="cellrowborder" width="18.39%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>扩展信息。可能的key值有quickLoginAnonymousPhone和localNumberConsistency。</p>          <p>如果开发者开启了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation-guide" target="_blank">代码混淆</a>需要配置混淆白名单防止其中包含的属性被混淆。</p>          <p><strong>返回场景</strong>：<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>接口的scopes中传入扩展请求参数（'quickLoginAnonymousPhone'等）时返回。</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>          <p><strong>说明：</strong>华为账号一键登录场景下，可通过"localNumberConsistency"字段获取华为账号绑定手机号和用户本机SIM卡手机号对比结果：</p>          <p>true：华为账号绑定的手机号和本机SIM卡手机号一致。</p>          <p>false：华为账号绑定的手机号和本机SIM卡手机号不一致。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>若用户本机无SIM卡，返回false。</p>            <p>若用户本机有SIM卡，只要其中有1张SIM卡手机号比对成功即返回true，否则返回false。</p>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建授权请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 'openid'为默认值可不传，开发者若需要获取其他用户信息，可传入其他scope参数，具体请参考AuthorizationWithHuaweiIDRequest类说明</span></li><li>authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'openid'</span>];</li><li>authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'idtoken'</span>, <span class="hljs-string">'serviceauthcode'</span>];</li><li>authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</li><li>authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>authRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>
</li><li><span class="hljs-comment">// 执行授权请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(authRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">AuthorizationWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = authorizationWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; authRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to authorize. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in authentication.'</span>);</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDCredential = authorizationWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = authorizationWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-keyword">const</span> code = authorizationWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-comment">// 开发者处理idToken, code等信息</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain userInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取用户信息失败，请稍后重试</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section17720275174" device-type="phone,2in1,tablet,wearable,tv">CancelAuthorizationRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17720275174" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为应用取消Account Kit授权的请求对象，作为华为账号取消授权的请求参数。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>CancelAuthorizationRequest继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348">AuthenticationRequest</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.6.1.1" width="17.330000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.6.1.2" width="11.76%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.6.1.3" width="20.200000000000003%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>state</p></td>         <td class="cellrowborder" width="11.76%">          <p>string</p></td>         <td class="cellrowborder" width="20.200000000000003%">          <p>否</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>请求体中的state参数，开发者可自定义，字符包含0-9、a-z、A-Z、英文点号、英文冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。</p>          <p>该参数与响应体中返回的state比较，校验是否是当前请求，可防止跨站攻击。</p>          <p>推荐开发者用随机数并做一致性校验。建议生成方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#utilgeneraterandomuuid9" target="_blank">util.generateRandomUUID()</a>。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> cancelRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createCancelAuthorizationRequest</span>();</li><li>cancelRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section10706124311177" device-type="phone,2in1,tablet,wearable,tv">CancelAuthorizationResponse<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10706124311177" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为应用取消华为账号授权的响应结果。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>继承：</strong>CancelAuthorizationResponse继承自<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>。</p>     <p><strong>属性：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.22.9.1.6.1.1" width="17.330000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.22.9.1.6.1.2" width="11.76%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.22.9.1.6.1.3" width="20.200000000000003%">          <p><strong>只读</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.22.9.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.22.9.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>state</p></td>         <td class="cellrowborder" width="11.76%">          <p>string</p></td>         <td class="cellrowborder" width="20.200000000000003%">          <p>是</p></td>         <td class="cellrowborder" width="17.89%">          <p>是</p></td>         <td class="cellrowborder" width="32.82%">          <p>响应体中返回的state，字符包含0-9、a-z、A-Z、英文点号、英文冒号、斜杠、下划线等，长度限制1-255，校验规则^[0-9a-zA-Z:/\.\-_]{1,255}$。</p>          <p>与请求体中传入的state比较，校验是否是当前请求，防止跨站攻击。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建取消授权请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> cancelRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createCancelAuthorizationRequest</span>();</li><li>cancelRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>
</li><li><span class="hljs-comment">// 执行取消授权请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(cancelRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> cancelAuthorizationResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">CancelAuthorizationResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = cancelAuthorizationResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; cancelRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to cancel. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in canceling.'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to cancel. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在应用登录涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_INTERNAL_ERROR</span>) {</li><li>    <span class="hljs-comment">// 登录失败，请尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试或者尝试使用其他方式登录</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 应用登录失败，请尝试使用其他方式登录</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 内部错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_INTERNAL_ERROR</span> = <span class="hljs-number">1001502009</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section138902217187" device-type="phone,2in1,tablet,wearable,tv">AuthenticationErrorCode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section138902217187" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该枚举为登录、授权、取消授权等接口的错误码。应用可根据如下错误码进行不同的处理。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.23.6.1.4.1.1" width="34.13%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.23.6.1.4.1.2" width="28.660000000000004%">          <p><strong>值</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.23.6.1.4.1.3" width="37.21%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="34.13%">          <p>PACKAGE_FINGERPRINT_CHECK_ERROR</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1581681312511">1001500001</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>应用指纹证书校验失败。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>DUPLICATE_REQUEST_REJECTED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section134761318124311">1001500002</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>重复请求，当已有相同的请求在处理时，返回此错误码，此错误码不需要处理。你的应用需实现点击控制，防止连续点击发起相同请求。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>SCOPE_OR_PERRMISSION_UNSUPPORTED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section116574197436">1001500003</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>不支持该scopes或permissions。</p>          <p><strong>起始版本</strong>：5.0.0(12)</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>UNSUPPORTED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section13107132603718">1001500004</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>已登录的华为账号不支持该功能。</p>          <p><strong>起始版本</strong>：5.0.0(12)</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>REQUEST_RESTRICTED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section612754419379">1001500005</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>该功能被限制调用。</p>          <p><strong>起始版本</strong>：5.0.0(12)</p>          <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>ACCOUNT_NOT_LOGGED_IN</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>用户未登录华为账号。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>APP_NOT_AUTHORIZED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1393125918588">1001502002</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>应用未授权。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>PARAMETER_INVALID</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>输入参数值无效，接口传参异常等。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>NETWORK_ERROR</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1281526328">1001502005</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>网络异常。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>INTERNAL_ERROR</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section17561151616317">1001502009</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>内部错误，如华为账号服务器错误或其他内部错误等。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>USER_CANCELED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section223413481361">1001502012</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>用户取消授权。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>SCOPE_OR_PERMISSION_NOT_REQUESTED</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section78953611814">1001502014</a></p></td>         <td class="cellrowborder" width="37.21%">          <p>应用未申请scopes或permissions权限。</p>          <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section620452019185" device-type="phone,2in1,tablet,wearable,tv">AuthenticationController<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section620452019185" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为Account Kit登录授权、取消授权请求Controller。用于执行登录授权请求方法。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>    </div>    <div class="tiledSection">     <h3 id="section9716526428" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">constructor<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9716526428" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>constructor(context?: common.Context)</p>     <p>构造器，构造Account Kit登录授权等请求Controller实例。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.25.9.1.5.1.1" width="10.530000000000001%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.25.9.1.5.1.2" width="17.810000000000002%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.25.9.1.5.1.3" width="28.93%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.25.9.1.5.1.4" width="42.730000000000004%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="10.530000000000001%">          <p>context</p></td>         <td class="cellrowborder" width="17.810000000000002%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-common#context" target="_blank">common.Context</a></p></td>         <td class="cellrowborder" width="28.93%">          <p>否</p></td>         <td class="cellrowborder" width="42.730000000000004%">          <p>Context上下文，当需要拉起华为账号登录、授权页面时必须传该参数，否则会报<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a>参数检查失败错误码。</p>          <p>应用可支持的Context有：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiextensioncontext" target="_blank">UIExtensionContext</a>。不支持应用在半模态、弹出框、子窗口等非全页面组件中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiextensioncontext" target="_blank">UIExtensionContext</a>调用。</p>          <p>元服务可支持的Context有：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <ul>             <li>在4.0.0(10)版本，参数类型为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>。</li>             <li>从4.1.0(11)版本开始，参数类型为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">Context</a>。</li>            </ul>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li><span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section164113311433" device-type="phone,2in1,tablet,wearable,tv">executeRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section164113311433" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>executeRequest(request: AuthenticationRequest, callback: AsyncCallback&lt;AuthenticationResponse, Record&lt;string, Object&gt;&gt;): void</p>     <p>执行Account Kit登录、授权等请求。使用callback异步回调。用于应用向华为账号请求登录、授权、取消授权等场景。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.26.9.1.5.1.1" width="10.530000000000001%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.9.1.5.1.2" width="26.290000000000003%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.9.1.5.1.3" width="20.43%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.9.1.5.1.4" width="42.75%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="10.530000000000001%">          <p>request</p></td>         <td class="cellrowborder" width="26.290000000000003%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348">AuthenticationRequest</a></p></td>         <td class="cellrowborder" width="20.43%">          <p>是</p></td>         <td class="cellrowborder" width="42.75%">          <p>登录授权认证请求体。</p>          <p>如该参数未正确传入，会抛出<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a>参数检查失败错误码。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="10.530000000000001%">          <p>callback</p></td>         <td class="cellrowborder" width="26.290000000000003%">          <p>AsyncCallback&lt;<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>, Record&lt;string, Object&gt;&gt;</p></td>         <td class="cellrowborder" width="20.43%">          <p>是</p></td>         <td class="cellrowborder" width="42.75%">          <p>登录授权回调函数。</p>          <p>当获取响应数据成功，err为undefined，data为获取到的<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>对象；否则为错误对象。</p>          <p>如该参数未正确传入，会抛出<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a>参数检查失败错误码。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account" target="_blank">账号管理错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code">ArkTS错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.12.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account#section12300001-系统服务异常" target="_blank">12300001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>System service works abnormally.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The user has not logged in with HUAWEI ID.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1393125918588">1001502002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The application is not authorized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid input parameter value.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1281526328">1001502005</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Network error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section17561151616317">1001502009</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Internal error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1581681312511">1001500001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Failed to check the fingerprint of the app bundle.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section223413481361">1001502012</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The user canceled the authorization.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section78953611814">1001502014</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The app does not have the required scopes or permissions.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section134761318124311">1001500002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>This error code is reported when a request is already being processed.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section116574197436">1001500003</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>The scopes or permissions are not supported.</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建授权请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 'openid'为默认值可不传，开发者若需要获取其他用户信息，可传入其他scope参数，具体请参考AuthorizationWithHuaweiIDRequest类说明</span></li><li>authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'openid'</span>];</li><li>authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'idtoken'</span>, <span class="hljs-string">'serviceauthcode'</span>];</li><li>authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</li><li>authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>authRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>
</li><li><span class="hljs-comment">// 执行授权请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(authRequest, <span class="hljs-function">(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      <span class="hljs-title function_">dealAllError</span>(error);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">AuthorizationWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = authorizationWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; authRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to authorize. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in authentication.'</span>);</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDCredential = authorizationWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = authorizationWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-keyword">const</span> code = authorizationWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-comment">// 开发者处理idToken, code等信息</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError&lt;<span class="hljs-built_in">Object</span>&gt;</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain userInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取用户信息失败，请稍后重试</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section3975181884311" device-type="phone,2in1,tablet,wearable,tv">executeRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section3975181884311" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>executeRequest(request: AuthenticationRequest): Promise&lt;AuthenticationResponse&gt;</p>     <p>执行Account Kit登录授权等请求，使用Promise异步回调。用于应用向华为账号请求登录、授权、取消授权等场景。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>     <p class="msonormal"><strong>参数</strong><strong>：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.27.9.1.5.1.1" width="18.14%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.27.9.1.5.1.2" width="26.56%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.27.9.1.5.1.3" width="7.5200000000000005%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.27.9.1.5.1.4" width="47.78%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="18.14%">          <p>request</p></td>         <td class="cellrowborder" width="26.56%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section3118182610348">AuthenticationRequest</a></p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>是</p></td>         <td class="cellrowborder" width="47.78%">          <p>登录授权认证请求体。如该参数未正确传入，会抛出<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a>参数检查失败错误码。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.27.11.1.3.1.1" width="34.88%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.27.11.1.3.1.2" width="65.12%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="34.88%">          <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>&gt;</p></td>         <td class="cellrowborder" width="65.12%">          <p>登录授权Promise对象，返回<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section2697164193515">AuthenticationResponse</a>对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account" target="_blank">账号管理错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code">ArkTS错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.27.14.1.3.1.1" width="35.39%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.27.14.1.3.1.2" width="64.61%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section88861315453">401</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>Parameter error. Possible causes: 1. Mandatory parameters are left unspecified; 2. Incorrect parameter types.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-account#section12300001-系统服务异常" target="_blank">12300001</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>System service works abnormally.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section539558125020">1001502001</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>The user has not logged in with HUAWEI ID.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1393125918588">1001502002</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>The application is not authorized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>Invalid input parameter value.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1281526328">1001502005</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>Network error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section17561151616317">1001502009</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>Internal error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section1581681312511">1001500001</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>Failed to check the fingerprint of the app bundle.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section223413481361">1001502012</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>The user canceled the authorization.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section78953611814">1001502014</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>The app does not have the required scopes or permissions.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section134761318124311">1001500002</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>This error code is reported when a request is already being processed.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="35.39%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section116574197436">1001500003</a></p></td>         <td class="cellrowborder" width="64.61%">          <p>The scopes or permissions are not supported.</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建授权请求，并设置参数</span></li><li><span class="hljs-keyword">const</span> authRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createAuthorizationWithHuaweiIDRequest</span>();</li><li><span class="hljs-comment">// 'openid'为默认值可不传，开发者若需要获取其他用户信息，可传入其他scope参数，具体请参考AuthorizationWithHuaweiIDRequest类说明</span></li><li>authRequest.<span class="hljs-property">scopes</span> = [<span class="hljs-string">'openid'</span>];</li><li>authRequest.<span class="hljs-property">permissions</span> = [<span class="hljs-string">'idtoken'</span>, <span class="hljs-string">'serviceauthcode'</span>];</li><li>authRequest.<span class="hljs-property">forceAuthorization</span> = <span class="hljs-literal">true</span>;</li><li>authRequest.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>(); <span class="hljs-comment">// 建议使用generateRandomUUID生成state</span></li><li>authRequest.<span class="hljs-property">idTokenSignAlgorithm</span> = authentication.<span class="hljs-property">IdTokenSignAlgorithm</span>.<span class="hljs-property">PS256</span>;</li><li>
</li><li><span class="hljs-comment">// 执行授权请求，并处理结果</span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 此示例为代码片段，实际需在自定义组件实例中使用，以获取UIContext对象作为函数入参</span></li><li>  <span class="hljs-keyword">const</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(authRequest).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">AuthorizationWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">const</span> state = authorizationWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state &amp;&amp; authRequest.<span class="hljs-property">state</span> !== state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to authorize. The state is different, response state: <span class="hljs-subst">${state}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in authentication.'</span>);</li><li>    <span class="hljs-keyword">const</span> authorizationWithHuaweiIDCredential = authorizationWithHuaweiIDResponse?.<span class="hljs-property">data</span>;</li><li>    <span class="hljs-keyword">const</span> idToken = authorizationWithHuaweiIDCredential?.<span class="hljs-property">idToken</span>;</li><li>    <span class="hljs-keyword">const</span> code = authorizationWithHuaweiIDCredential?.<span class="hljs-property">authorizationCode</span>;</li><li>    <span class="hljs-comment">// 开发者处理idToken, code等信息</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">dealAllError</span>(err);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to obtain userInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  <span class="hljs-comment">// 在涉及UI交互场景下，建议按照如下错误码指导提示用户</span></li><li>  <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_LOGIN_OUT</span>) {</li><li>    <span class="hljs-comment">// 用户未登录华为账号，请登录华为账号并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_NETWORK_ERROR</span>) {</li><li>    <span class="hljs-comment">// 网络异常，请检查当前网络状态并重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_USER_CANCEL</span>) {</li><li>    <span class="hljs-comment">// 用户取消授权</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_SYSTEM_SERVICE</span>) {</li><li>    <span class="hljs-comment">// 系统服务异常，请稍后重试</span></li><li>  } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (error.<span class="hljs-property">code</span> === <span class="hljs-title class_">ErrorCode</span>.<span class="hljs-property">ERROR_CODE_REQUEST_REFUSE</span>) {</li><li>    <span class="hljs-comment">// 重复请求，应用无需处理</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 获取用户信息失败，请稍后重试</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">ErrorCode</span> {</li><li>  <span class="hljs-comment">// 账号未登录</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_LOGIN_OUT</span> = <span class="hljs-number">1001502001</span>,</li><li>  <span class="hljs-comment">// 网络错误</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_NETWORK_ERROR</span> = <span class="hljs-number">1001502005</span>,</li><li>  <span class="hljs-comment">// 用户取消授权</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_USER_CANCEL</span> = <span class="hljs-number">1001502012</span>,</li><li>  <span class="hljs-comment">// 系统服务异常</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_SYSTEM_SERVICE</span> = <span class="hljs-number">12300001</span>,</li><li>  <span class="hljs-comment">// 重复请求</span></li><li>  <span class="hljs-variable constant_">ERROR_CODE_REQUEST_REFUSE</span> = <span class="hljs-number">1001500002</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section3118182610348" device-type="phone,2in1,tablet,wearable,tv">AuthenticationRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section3118182610348" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>华为账号登录授权认证请求父类对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>    </div>    <div class="tiledSection">     <h2 id="section2697164193515" device-type="phone,2in1,tablet,wearable,tv">AuthenticationResponse<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section2697164193515" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>华为账号登录授权认证请求响应父类对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>    </div>    <div class="tiledSection">     <h2 id="section1860064133610" device-type="phone,2in1,tablet,wearable,tv">AuthenticationProvider<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1860064133610" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>华为账号登录授权认证请求provider父类对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本4.1.0(11)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>4.0.0(10)</p>    </div>    <div class="tiledSection">     <h2 id="section13891254145017" device-type="phone,2in1,tablet,wearable,tv">IdType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section13891254145017" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该枚举为ID类型枚举对象，作为华为账号登录状态请求参数传入。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.31.7.1.4.1.1" width="41.91%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.31.7.1.4.1.2" width="20.86%">          <p><strong>值</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.31.7.1.4.1.3" width="37.230000000000004%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="41.91%">          <p>USER_ID</p></td>         <td class="cellrowborder" width="20.86%">          <p>1</p></td>         <td class="cellrowborder" width="37.230000000000004%">          <p>华为账号用户的UID。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>该参数仅对系统应用开放。</p>           </div></div></div></td>        </tr>        <tr>         <td class="cellrowborder" width="41.91%">          <p>OPEN_ID</p></td>         <td class="cellrowborder" width="20.86%">          <p>2</p></td>         <td class="cellrowborder" width="37.230000000000004%">          <p>华为账号用户的OpenID。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="41.91%">          <p>UNION_ID</p></td>         <td class="cellrowborder" width="20.86%">          <p>3</p></td>         <td class="cellrowborder" width="37.230000000000004%">          <p>华为账号用户的UnionID。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1687013712515" device-type="phone,2in1,tablet,wearable,tv">State<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1687013712515" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该枚举为华为账号登录状态枚举对象。用于保存华为账号登录状态结果。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.32.7.1.4.1.1" width="39.550000000000004%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.32.7.1.4.1.2" width="23.24%">          <p><strong>值</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.32.7.1.4.1.3" width="37.21%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="39.550000000000004%">          <p>UNLOGGED_IN</p></td>         <td class="cellrowborder" width="23.24%">          <p>0</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号未登录。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="39.550000000000004%">          <p>AUTHORIZED</p></td>         <td class="cellrowborder" width="23.24%">          <p>1</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号已登录且传入账号的UnionID/OpenID与当前账号一致。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="39.550000000000004%">          <p>UNAUTHORIZED</p></td>         <td class="cellrowborder" width="23.24%">          <p>2</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号已登录且传入账号的UnionID/OpenID与当前账号不一致。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section9615740103819" device-type="phone,2in1,tablet,wearable,tv">StateRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9615740103819" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为获取华为账号登录状态请求对象，作为<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section102884586336">getHuaweiIDState</a>传参。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.34.1.6.1.1" width="17.330000000000002%">         <p><strong>名称</strong></p></th>        <th align="left" class="cellrowborder" id="mcps1.3.34.1.6.1.2" width="11.76%">         <p><strong>类型</strong></p></th>        <th align="left" class="cellrowborder" id="mcps1.3.34.1.6.1.3" width="20.200000000000003%">         <p>只读</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.34.1.6.1.4" width="17.89%">         <p>可选</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.34.1.6.1.5" width="32.82%">         <p><strong>说明</strong></p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="17.330000000000002%">         <p>idType</p></td>        <td class="cellrowborder" width="11.76%">         <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section13891254145017">IdType</a></p></td>        <td class="cellrowborder" width="20.200000000000003%">         <p>否</p></td>        <td class="cellrowborder" width="17.89%">         <p>否</p></td>        <td class="cellrowborder" width="32.82%">         <p>属性idValue的ID类型，当前非系统应用只能传IdType.UNION_ID或IdType.OPEN_ID。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="17.330000000000002%">         <p>idValue</p></td>        <td class="cellrowborder" width="11.76%">         <p>string</p></td>        <td class="cellrowborder" width="20.200000000000003%">         <p>否</p></td>        <td class="cellrowborder" width="17.89%">         <p>否</p></td>        <td class="cellrowborder" width="32.82%">         <p>用户获取的UnionID、OpenID值，传递的类型通过idType属性定义。不可为空，否则会报<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-error-code#section289120911112">1001502003 输入参数值无效</a>错误码。长度限制1-256。</p>         <p>UnionID、OpenID值可以通过<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section15454203811311">LoginWithHuaweiIDResponse</a>、<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section10418450161620">AuthorizationWithHuaweiIDResponse</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-loginpanel#section72281234181611">LoginPanel</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button#section1624716107193">LoginWithHuaweiIDButton</a>接口获取，具体方法参考其示例代码。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">request</span>: authentication.<span class="hljs-property">StateRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span> <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section18875010506" device-type="phone,2in1,tablet,wearable,tv">StateResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18875010506" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为获取华为账号登录状态结果对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>元服务API：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.38.1.6.1.1" width="17.330000000000002%">         <p><strong>名称</strong></p></th>        <th align="left" class="cellrowborder" id="mcps1.3.38.1.6.1.2" width="11.76%">         <p><strong>类型</strong></p></th>        <th align="left" class="cellrowborder" id="mcps1.3.38.1.6.1.3" width="20.200000000000003%">         <p>只读</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.38.1.6.1.4" width="17.89%">         <p>可选</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.38.1.6.1.5" width="32.82%">         <p><strong>说明</strong></p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="17.330000000000002%">         <p>state</p></td>        <td class="cellrowborder" width="11.76%">         <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section1687013712515">State</a></p></td>        <td class="cellrowborder" width="20.200000000000003%">         <p>否</p></td>        <td class="cellrowborder" width="17.89%">         <p>否</p></td>        <td class="cellrowborder" width="32.82%">         <p>华为账号登录状态枚举对象。用于保存华为账号登录状态结果。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">stateRequest</span>: authentication.<span class="hljs-property">StateRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span> <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 执行获取华为账号登录状态请求，并处理结果</span></li><li>  <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">getHuaweiIDState</span>(stateRequest).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: authentication.StateResult</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in getting huaweiIdState result.'</span>);</li><li>    <span class="hljs-keyword">const</span> state = data.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-comment">// 处理state</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-title function_">dealAllError</span>(err);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to getHuaweiIdState, errorCode=<span class="hljs-subst">${error.code}</span>, errorMsg=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section1271024585118" device-type="phone,2in1,tablet,wearable,tv">ConsistencyState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1271024585118" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该枚举为手机号一致性状态枚举对象。应用可根据结果进行相应风控处理。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.41.6.1.4.1.1" width="34.13%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.41.6.1.4.1.2" width="28.660000000000004%">          <p><strong>值</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.41.6.1.4.1.3" width="37.21%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="34.13%">          <p>CONSISTENT</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p>0</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号已登录，传入的手机号与当前账号绑定的手机号一致，与当前设备任意一个SIM卡手机号一致。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>INCONSISTENT_WITH_DEVICES</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p>1</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号已登录，传入的手机号与当前账号绑定的手机号一致，与当前设备SIM卡手机号不一致或当前设备无SIM卡。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="34.13%">          <p>INCONSISTENT</p></td>         <td class="cellrowborder" width="28.660000000000004%">          <p>2</p></td>         <td class="cellrowborder" width="37.21%">          <p>华为账号已登录，传入的手机号与当前账号绑定的手机号不一致。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section168131411512" device-type="phone,2in1,tablet,wearable,tv">ConsistencyRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section168131411512" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为获取手机号一致性状态请求对象。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.6.1.1" width="17.330000000000002%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.6.1.2" width="11.76%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.6.1.3" width="20.200000000000003%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.6.1.4" width="17.89%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.42.6.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>idType</p></td>         <td class="cellrowborder" width="11.76%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section13891254145017">IdType</a></p></td>         <td class="cellrowborder" width="20.200000000000003%">          <p>否</p></td>         <td class="cellrowborder" width="17.89%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p>属性idValue的ID类型，当前非系统应用只能传IdType.UNION_ID或IdType.OPEN_ID。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>idValue</p></td>         <td class="cellrowborder" width="11.76%">          <p>string</p></td>         <td class="cellrowborder" width="20.200000000000003%">          <p>否</p></td>         <td class="cellrowborder" width="17.89%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p>用户的UnionID、OpenID值，不可为空，长度限制1-256，传递的类型通过idType属性定义。</p>          <p>UnionID、OpenID值可以通过<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section15454203811311">LoginWithHuaweiIDResponse</a>、<a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section10418450161620">AuthorizationWithHuaweiIDResponse</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-loginpanel#section72281234181611">LoginPanel</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button#section1624716107193">LoginWithHuaweiIDButton</a>接口获取，具体方法参考其示例代码。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.330000000000002%">          <p>mobileNumber</p></td>         <td class="cellrowborder" width="11.76%">          <p>string</p></td>         <td class="cellrowborder" width="20.200000000000003%">          <p>否</p></td>         <td class="cellrowborder" width="17.89%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-huawei-id-button#section1624716107193">LoginWithHuaweiIDButton</a>组件的一键登录功能获取到的手机号，传入完整的手机号需要添加国家码，例如中国境内（不包含中国香港、中国澳门、中国台湾）为+86，值不可为空，长度限制1-256。</p>          <p>手机号示例：+86xxxxxxxxxxx（明文手机号）。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">request</span>: authentication.<span class="hljs-property">ConsistencyRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span>, <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>  <span class="hljs-attr">mobileNumber</span>: <span class="hljs-string">'+86xxxxxxxxxxx'</span> <span class="hljs-comment">// 通过华为账号一键登录功能获取到的明文手机号</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section155352089012" device-type="phone,2in1,tablet,wearable,tv">ConsistencyResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section155352089012" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>该类为获取手机号一致性状态结果对象。应用可根据结果进行相应风控处理。</p>     <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p>     <p><strong>系统能力：</strong>SystemCapability.AuthenticationServices.HuaweiID.Auth</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.43.6.1.6.1.1" width="12.030000000000001%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.43.6.1.6.1.2" width="18.35%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.43.6.1.6.1.3" width="18.23%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.43.6.1.6.1.4" width="18.57%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.43.6.1.6.1.5" width="32.82%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="12.030000000000001%">          <p>state</p></td>         <td class="cellrowborder" width="18.35%">          <p><a href="/consumer/cn/doc/harmonyos-references/account-api-authentication#section1271024585118">ConsistencyState</a></p></td>         <td class="cellrowborder" width="18.23%">          <p>否</p></td>         <td class="cellrowborder" width="18.57%">          <p>否</p></td>         <td class="cellrowborder" width="32.82%">          <p>手机号一致性状态枚举对象。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-pla-c106="" class="highlight-div"><div _ngcontent-pla-c106="" class="highlight-div-header"><div _ngcontent-pla-c106="" class="highlight-div-header-left"><div _ngcontent-pla-c106="" class="handle-button expand-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pla-c106="" class="highlight-div-header-right"><div _ngcontent-pla-c106="" class="handle-button ai-button"></div><div _ngcontent-pla-c106="" class="handle-button line-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pla-c106="" class="handle-button theme-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pla-c106="" class="handle-button copy-button"><div _ngcontent-pla-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pla-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建请求参数</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">consistencyRequest</span>: authentication.<span class="hljs-property">ConsistencyRequest</span> = {</li><li>  <span class="hljs-attr">idType</span>: authentication.<span class="hljs-property">IdType</span>.<span class="hljs-property">UNION_ID</span>,</li><li>  <span class="hljs-attr">idValue</span>: <span class="hljs-string">'</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;可通过华为账号登录接口获取&gt;</span></span></div></i><span class="hljs-string">'</span>, <span class="hljs-comment">// 该值可以通过华为账号登录接口获取</span></li><li>  <span class="hljs-attr">mobileNumber</span>: <span class="hljs-string">'+86xxxxxxxxxxx'</span> <span class="hljs-comment">// 通过华为账号一键登录功能获取到的明文手机号</span></li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 执行获取手机号一致性状态请求，并处理结果</span></li><li>  <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">getMobileNumberConsistency</span>(consistencyRequest)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: authentication.ConsistencyResult</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in getting getMobileNumberConsistency result = <span class="hljs-subst">${data.state}</span>`</span>);</li><li>      <span class="hljs-keyword">const</span> state = data.<span class="hljs-property">state</span>;</li><li>      <span class="hljs-comment">// 处理state</span></li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-title function_">dealAllError</span>(err);</li><li>    })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-title function_">dealAllError</span>(error);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误处理</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">dealAllError</span>(<span class="hljs-params">error: BusinessError</span>): <span class="hljs-built_in">void</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,</li><li>    <span class="hljs-string">`Failed to get mobileNumberConsistency, errorCode=<span class="hljs-subst">${error.code}</span>, errorMsg=<span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>