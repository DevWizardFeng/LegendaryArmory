<h1 _ngcontent-jer-c119="" class="doc-title ng-star-inserted" title="bookParser（书籍解析能力）"> bookParser（书籍解析能力） </h1>

<div _ngcontent-jer-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供书籍解析的能力，支持对txt、epub、mobi、azw、azw3格式的书籍文件进行解析。通过提前导入到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank">应用沙箱目录</a>中的书籍文件，初始化<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section59035422210">BookParserHandler</a>。将书籍基本信息、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/reader-introduction#section2215512152119" target="_blank">书脊</a>内容列表、目录列表和章节内容解析出来。</p>    <p><strong>起始版本：</strong>5.0.4(16)</p>    <div class="tiledSection">     <h2 id="section41484152321" device-type="phone,2in1,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section41484152321" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section38181821125613" device-type="phone,2in1,tablet">BookInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section38181821125613" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>书籍基本信息。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <div class="p">      <strong>起始版本：</strong>5.0.4(16)       <div class="tablenoborder">       <div class="tbBox"><table>        <thead>         <tr>          <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.6.1.1" width="20.7%">           <p><strong>名称</strong></p></th>          <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.6.1.2" width="12.58%">           <p><strong>类型</strong></p></th>          <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.6.1.3" width="7.5200000000000005%">           <p>只读</p></th>          <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.6.1.4" width="6.4799999999999995%">           <p>可选</p></th>          <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.6.1.5" width="52.72%">           <p><strong>说明</strong></p></th>         </tr>        </thead>                 <tbody><tr>          <td class="cellrowborder" width="20.7%">           <p>bookTitle</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>否</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍名称。</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookCreator</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>作者。</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookPublishDate</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>出版日期。（预留字段，暂不支持。）</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookLanguage</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍语言。</p>           <ul>            <li>zh_HK：繁体中文，包括台湾繁体及香港繁体。</li>            <li>zh_CN：中文简体。</li>            <li>zh：中文（不支持或非法语言会使用zh作为默认值）。</li>            <li>en_US：英文。</li>           </ul></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookCoverImage</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书封图片路径。例如：“OEBPS/images/coverpage.jpg”。</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookCharset</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍内容的字符集，根据书籍编码格式决定，例如："utf-8"。具体支持格式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-util#textencoder" target="_blank">TextEncoder</a>定义。（预留字段，暂不支持。）</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>bookType</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍格式： "txt"、"epub"、"mobi"、"azw"、"azw3"。</p></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>isRtl</p></td>          <td class="cellrowborder" width="12.58%">           <p>boolean</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍阅读方向。（预留字段，暂不支持。）</p>           <ul>            <li>true：从右到左排版</li>            <li>false：从左到右排版</li>           </ul></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>renditionLayout</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书籍排版方式。（预留字段，暂不支持。）</p>           <ul>            <li>reflowable：流式排版</li>            <li>pre-paginated：固定版式排版</li>           </ul></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>renditionOrientation</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>横竖屏呈现定义。（预留字段，暂不支持。）</p>           <ul>            <li>landscape：横屏</li>            <li>portrait：竖屏</li>            <li>auto：自适应</li>           </ul></td>         </tr>         <tr>          <td class="cellrowborder" width="20.7%">           <p>renditionSpread</p></td>          <td class="cellrowborder" width="12.58%">           <p>string</p></td>          <td class="cellrowborder" width="7.5200000000000005%">           <p>否</p></td>          <td class="cellrowborder" width="6.4799999999999995%">           <p>是</p></td>          <td class="cellrowborder" width="52.72%">           <p>书脊左右页合并场景。（预留字段，暂不支持。）</p>           <ul>            <li>none：不合并分页</li>            <li>landscape：横屏合并</li>            <li>portrait：竖屏时合并</li>            <li>auto：自动适配</li>           </ul></td>         </tr>               </tbody></table></div>      </div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1029864651619" device-type="phone,2in1,tablet">SpineItem<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1029864651619" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>书脊（spine）内容节点，标识着可阅读的一个内容资源（例如：chapter1.xhtml)。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.1" width="20.7%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.2" width="12.58%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.3" width="7.5200000000000005%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.4" width="6.4799999999999995%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.5" width="52.72%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.7%">          <p>idRef</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>内容节点资源标识，唯一标识一个正文内容文件。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>index</p></td>         <td class="cellrowborder" width="12.58%">          <p>number</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>内容资源索引，从0开始顺序取值。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>href</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>内容资源在书籍内的引用路径。例如："/OEBPS/Txt/chapter01.xhtml"。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>properties</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>当一屏双页展示时，内容节点的呈现方式。（预留字段，暂不支持。）</p>          <ul>           <li>page-spread-left：标识内容在屏幕左侧呈现。</li>           <li>page-spread-right：标识在屏幕右侧呈现。</li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section12325515195" device-type="phone,2in1,tablet">CatalogItem<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section12325515195" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>书籍目录节点，可用于目录列表的展示。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.1" width="20.7%">          <p><strong>名称</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.2" width="12.58%">          <p><strong>类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.3" width="7.5200000000000005%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.4" width="6.4799999999999995%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.5" width="52.72%">          <p><strong>说明</strong></p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.7%">          <p>catalogId</p></td>         <td class="cellrowborder" width="12.58%">          <p>number</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点Id，从0开始取值。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>catalogName</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>否</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点名称。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>catalogLevel</p></td>         <td class="cellrowborder" width="12.58%">          <p>number</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>是</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点层级。</p>          <p>例如：第一章的目录层级是0，下面有子章节，那子章节的目录层级+1，为1。如果子章节下面还有子章节，则继续+1，为2。</p>          <p>开发者根据目录节点顺序及层级，可识别出目录之间的层级关系。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>playOrder</p></td>         <td class="cellrowborder" width="12.58%">          <p>number</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>是</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点阅读顺序，从0开始取值。（预留字段，暂不支持。）</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>idRef</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>是</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点对应内容资源的标识。（预留字段，暂不支持。）</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>href</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>是</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点带锚点的内容资源路径。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.7%">          <p>resourceFile</p></td>         <td class="cellrowborder" width="12.58%">          <p>string</p></td>         <td class="cellrowborder" width="7.5200000000000005%">          <p>否</p></td>         <td class="cellrowborder" width="6.4799999999999995%">          <p>是</p></td>         <td class="cellrowborder" width="52.72%">          <p>目录节点不带锚点的内容资源路径。</p>          <p>以EPUB书籍为例，该字段则标识着资源以/OEBPS为根目录的相对路径。</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>CatalogItem与SpineItem的区别在于，CatalogItem对应一个目录节点，而SpineItem对应一个内容资源文件，两者并不总是一一对应的。例如：epub书籍一章下面有3个子章节，那就有4个CatalogItem。但是这4个CatalogItem有可能只对应一个SpineItem文件，两者通过CatalogItem.resourceFile及SpineItem.href进行对应。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section174676520576" device-type="phone,2in1,tablet">CallbackRes<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section174676520576" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>type CallbackRes&lt;T, V&gt; = (data: T) =&gt; V</p>     <p>书籍资源请求回调接口，在排版引擎渲染界面时调用，需配合ReaderComponentController的注册接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-read-core#section169541417131914">on('resourceRequest')</a>使用。如果有自定义背景及字体资源，需要在此返回对应资源。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.2" width="6.63%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.3" width="5.99%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.8.1.5.1.4" width="62.38%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>data</p></td>         <td class="cellrowborder" width="6.63%">          <p>T</p></td>         <td class="cellrowborder" width="5.99%">          <p>是</p></td>         <td class="cellrowborder" width="62.38%">          <p>资源请求接口中的参数。例如：获取自定义字体时，该字段代表需要获取字体的名称。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.10.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.10.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p>V</p></td>         <td class="cellrowborder" width="67.84%">          <p>资源请求接口中的返回值类型。例如：获取自定义字体时，该返回值代表字体文件的二进制数据流。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser, readerCore, <span class="hljs-title class_">ReadPageComponent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">readerComponentController</span>: readerCore.<span class="hljs-property">ReaderComponentController</span> = <span class="hljs-keyword">new</span> readerCore.<span class="hljs-title class_">ReaderComponentController</span>();</li><li>  <span class="hljs-keyword">private</span> selectFontPath = <span class="hljs-string">'fonts/SourceHanSerifCN-VF.ttf'</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">registerListener</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">registerListener</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">readerComponentController</span>.<span class="hljs-title function_">init</span>(context)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">readerComponentController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'resourceRequest'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">resourceRequest</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to registerListener, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">resourceRequest</span>: bookParser.<span class="hljs-property">CallbackRes</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-title class_">ArrayBuffer</span>&gt; = (<span class="hljs-attr">fileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-function"><span class="hljs-params">ArrayBuffer</span> =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isFont</span>(fileName)) {</li><li>      <span class="hljs-keyword">let</span> res = $rawfile(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectFontPath</span>);</li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li>      <span class="hljs-keyword">if</span> (res &amp;&amp; context) {</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-comment">// 获取资源路径下的字体数据</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">Uint8Array</span> = context.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectFontPath</span>);</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'resourceRequest : get success'</span>);</li><li>          <span class="hljs-keyword">return</span> value.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>;</li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>          <span class="hljs-keyword">let</span> code = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>          <span class="hljs-keyword">let</span> message = (error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`callback getRawFileContent failed, error code: <span class="hljs-subst">${code}</span>, message: <span class="hljs-subst">${message}</span>.`</span>);</li><li>        }</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">isFont</span>(<span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">let</span> options = [<span class="hljs-string">".ttf"</span>, <span class="hljs-string">".woff2"</span>, <span class="hljs-string">".otf"</span>];</li><li>    <span class="hljs-keyword">let</span> path = filePath.<span class="hljs-title function_">toLowerCase</span>();</li><li>    <span class="hljs-keyword">let</span> result = path.<span class="hljs-title function_">indexOf</span>(options[<span class="hljs-number">0</span>]) != -<span class="hljs-number">1</span> || path.<span class="hljs-title function_">indexOf</span>(options[<span class="hljs-number">1</span>]) != -<span class="hljs-number">1</span> || path.<span class="hljs-title function_">indexOf</span>(options[<span class="hljs-number">2</span>]) != -<span class="hljs-number">1</span>;</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'isFont = '</span> + result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">ReadPageComponent</span>({</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">readerComponentController</span>,</li><li>        <span class="hljs-attr">readerCallback</span>: <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: readerCore.ReaderComponentController</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">readerComponentController</span> = data;</li><li>        }</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section896820167243" device-type="phone,2in1,tablet">getDefaultHandler<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section896820167243" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getDefaultHandler(path: string): Promise&lt;BookParserHandler&gt;</p>     <p>获取书籍默认解析器，并通过Promise方式返回执行的结果。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>对于相同路径下的书籍文件，禁止并发调用getDefaultHandler接口。</p>      </div></div></div>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.2" width="25%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.3" width="25%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.4" width="25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>path</p></td>         <td class="cellrowborder" width="25%">          <p>string</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>本地书籍文件路径（仅支持当前应用下的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank">应用沙箱目录</a>）。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section59035422210">BookParserHandler</a>&gt;</p></td>         <td class="cellrowborder" width="67.84%">          <p>BookParserHandler类。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.8.13.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.13.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section401-参数检查失败" target="_blank">401</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Parameter error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1855956131312">1017010003</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book file format is unexpected.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section692725412147">1017010004</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>File is not exist.</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initBookParser</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">initBookParser</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getDefaultHandler succeeded`</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to initBookParser, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section59035422210" device-type="phone,2in1,tablet">BookParserHandler<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section59035422210" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>书籍解析接口类。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>    </div>    <div class="tiledSection">     <h3 id="section599065683812" device-type="phone,2in1,tablet" class="firsth2">getBookInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section599065683812" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getBookInfo(): BookInfo</p>     <p>获取书籍信息。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.8.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p><a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section38181821125613">BookInfo</a></p></td>         <td class="cellrowborder" width="67.84%">          <p>书籍基本信息。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book parser is not initialized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid request.</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getBookInfo</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getBookInfo</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookInfo</span>: bookParser.<span class="hljs-property">BookInfo</span> = bookParserHandler.<span class="hljs-title function_">getBookInfo</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getBookInfo succeeded, bookInfo:`</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(bookInfo));</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getBookInfo, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section14841714114211" device-type="phone,2in1,tablet">getCatalogList<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section14841714114211" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getCatalogList(): CatalogItem[]</p>     <p>获取书籍目录列表。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p><a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section12325515195">CatalogItem</a>[]</p></td>         <td class="cellrowborder" width="67.84%">          <p>目录节点列表。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.11.10.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.10.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book parser is not initialized</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid request</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCatalogList</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getCatalogList</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">catalogList</span>: bookParser.<span class="hljs-property">CatalogItem</span>[] = bookParserHandler.<span class="hljs-title function_">getCatalogList</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getCatalogList succeeded, catalogList:`</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(catalogList));</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getCatalogList, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section61575276477" device-type="phone,2in1,tablet">getSpineList<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section61575276477" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getSpineList(): SpineItem[]</p>     <p>获取书脊内容列表。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.8.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p><a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section1029864651619">SpineItem</a>[]</p></td>         <td class="cellrowborder" width="67.84%">          <p>内容节点列表。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.10.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.10.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book parser is not initialized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid request.</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSpineList</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getSpineList</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">spineList</span>: bookParser.<span class="hljs-property">SpineItem</span>[] = bookParserHandler.<span class="hljs-title function_">getSpineList</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getSpineList succeeded, spineList:`</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(spineList));</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getSpineList, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section10189181765020" device-type="phone,2in1,tablet">getSpineItemContent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10189181765020" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getSpineItemContent(spineIndex: number): Promise&lt;string&gt;</p>     <p>获取单个书脊资源里的内容，当排版引擎获取资源文件对应内容时会调用。如果不需要自定义排版引擎，开发者不需要关注。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.2" width="25%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.3" width="25%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.4" width="25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>spineIndex</p></td>         <td class="cellrowborder" width="25%">          <p>number</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>内容资源索引<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section1029864651619">SpineItem</a>.index。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p>Promise&lt;string&gt;</p></td>         <td class="cellrowborder" width="67.84%">          <p>单个书脊内容字符串。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.12.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.12.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section401-参数检查失败" target="_blank">401</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Parameter error. Possible causes: 1.Incorrect parameter types; 2. Parameter out of range.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book parser is not initialized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section19552151617126">1017010001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid spine item.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid request.</p></td>        </tr>             </tbody></table></div>     </div>     <div class="p">      <strong>示例：</strong>      <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getSpineItemContent</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getSpineItemContent</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">spineList</span>: bookParser.<span class="hljs-property">SpineItem</span>[] = bookParserHandler.<span class="hljs-title function_">getSpineList</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">spineItemContent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-keyword">await</span> bookParserHandler.<span class="hljs-title function_">getSpineItemContent</span>(spineList[<span class="hljs-number">0</span>].<span class="hljs-property">index</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getSpineItemContent succeeded, spineItemContent:`</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(spineItemContent));</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getSpineItemContent, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section17546184255211" device-type="phone,2in1,tablet">getResourceContent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17546184255211" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getResourceContent(spineIndex: number, filePath: string): ArrayBuffer</p>     <p>获取书籍内容资源。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开发者通过此接口可获取书封资源。同时排版引擎获取书籍里的图片等资源时，会优先调用该方法，如果获取不到资源会继续调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-read-core#section169541417131914">on('resourceRequest')</a>获取资源。</p>      </div></div></div>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.5.1.2" width="25%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.5.1.3" width="25%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.14.9.1.5.1.4" width="25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>spineIndex</p></td>         <td class="cellrowborder" width="25%">          <p>number</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>内容资源索引<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section1029864651619">SpineItem</a>.index。如果传负数，如-1，代表获取书封。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="25%">          <p>filePath</p></td>         <td class="cellrowborder" width="25%">          <p>string</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>书籍中资源的路径。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.1" width="32.16%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.2" width="67.84%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="32.16%">         <p>ArrayBuffer</p></td>        <td class="cellrowborder" width="67.84%">         <p>返回文件的二进制数据。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.18.1.3.1.1" width="33.72%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.18.1.3.1.2" width="66.28%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section401-参数检查失败" target="_blank">401</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Parameter error. Possible causes: 1.Incorrect parameter types; 2. Parameter out of range.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Book parser is not initialized.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Other error.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section19552151617126">1017010001</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Invalid spine item.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Invalid request.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getResourceContent</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getResourceContent</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-comment">// 需要替换成实际书籍文件中存在的图片名称</span></li><li>      <span class="hljs-keyword">let</span> imagePath = <span class="hljs-string">'./2188093923226426261_image001.jpg'</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">spineList</span>: bookParser.<span class="hljs-property">SpineItem</span>[] = bookParserHandler.<span class="hljs-title function_">getSpineList</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">resourceContent</span>: <span class="hljs-title class_">ArrayBuffer</span> = bookParserHandler.<span class="hljs-title function_">getResourceContent</span>(spineList[<span class="hljs-number">0</span>].<span class="hljs-property">index</span>, imagePath);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getResourceContent succeeded, resourceContentByteLength:`</span> + resourceContent.<span class="hljs-property">byteLength</span>);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getResourceContent, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section124930457617" device-type="phone,2in1,tablet">getDomPosByCatalogHref<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section124930457617" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getDomPosByCatalogHref(href: string): string</p>     <p>获取阅读起始位置domPos，可用于阅读进度标识（例如：跳转到指定阅读位置）。</p>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.2" width="25%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.3" width="25%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.4" width="25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>href</p></td>         <td class="cellrowborder" width="25%">          <p>string</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>目录节点带锚点的内容资源路径<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section12325515195">CatalogItem</a>.href。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.23.1.3.1.1" width="32.16%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.23.1.3.1.2" width="67.84%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="32.16%">         <p>string</p></td>        <td class="cellrowborder" width="67.84%">         <p>章节的domPos信息。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.25.1.3.1.1" width="33.72%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.25.1.3.1.2" width="66.28%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section401-参数检查失败" target="_blank">401</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Parameter error. Possible causes: 1.Incorrect parameter types; 2. Parameter out of range.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Book parser is not initialized.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Other error.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="33.72%">         <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>        <td class="cellrowborder" width="66.28%">         <p>Invalid request.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDomPosByCatalogHref</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getDomPosByCatalogHref</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">catalogList</span>: bookParser.<span class="hljs-property">CatalogItem</span>[] = bookParserHandler.<span class="hljs-title function_">getCatalogList</span>();</li><li>      <span class="hljs-keyword">let</span> href = catalogList[<span class="hljs-number">1</span>]?.<span class="hljs-property">href</span> || <span class="hljs-string">''</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">domPos</span>: <span class="hljs-built_in">string</span> = bookParserHandler.<span class="hljs-title function_">getDomPosByCatalogHref</span>(href);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getDomPosByCatalogHref succeeded, domPos:`</span> + domPos);</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getDomPosByCatalogHref, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section3773161018157" device-type="phone,2in1,tablet">getAbsoluteResourcePath<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section3773161018157" tips="复制节点链接"></i></h3>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>getAbsoluteResourcePath(spineIndex: number): string</p>     <p>获取资源的完整文件路径。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>此方法一般为排版引擎渲染资源时调用，如果不需要自定义排版引擎，开发者不需要关注。</p>      </div></div></div>     <p><strong>元服务API：</strong>从版本5.0.4(16)开始，该接口支持在元服务中使用。</p>     <p><strong>系统能力：</strong>SystemCapability.Reader.ReaderService.BookParser</p>     <p><strong>起始版本：</strong>5.0.4(16)</p>     <p><strong>参数：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.5.1.1" width="25%">          <p>参数名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.5.1.2" width="25%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.5.1.3" width="25%">          <p>必填</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.28.9.1.5.1.4" width="25%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="25%">          <p>spineIndex</p></td>         <td class="cellrowborder" width="25%">          <p>number</p></td>         <td class="cellrowborder" width="25%">          <p>是</p></td>         <td class="cellrowborder" width="25%">          <p>内容资源索引<a href="/consumer/cn/doc/harmonyos-references/reader-book-parser#section1029864651619">SpineItem</a>.index。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.28.11.1.3.1.1" width="32.16%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.28.11.1.3.1.2" width="67.84%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="32.16%">          <p>string</p></td>         <td class="cellrowborder" width="67.84%">          <p>资源的完整路径</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>错误码：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.28.13.1.3.1.1" width="33.72%">          <p>错误码ID</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.28.13.1.3.1.2" width="66.28%">          <p>错误信息</p></th>        </tr><tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal#section401-参数检查失败" target="_blank">401</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Parameter error. Possible causes: 1.Incorrect parameter types; 2. Parameter out of range.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1427915529104">1017000001</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Book parser is not initialized.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section31031138161116">1017000999</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Other error.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section1115195931210">1017010002</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>Invalid request.</p></td>        </tr>        <tr>         <td class="cellrowborder" width="33.72%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/reader-error-code#section692725412147">1017010004</a></p></td>         <td class="cellrowborder" width="66.28%">          <p>File is not exist.</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-jer-c106="" class="highlight-div"><div _ngcontent-jer-c106="" class="highlight-div-header"><div _ngcontent-jer-c106="" class="highlight-div-header-left"><div _ngcontent-jer-c106="" class="handle-button expand-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jer-c106="" class="highlight-div-header-right"><div _ngcontent-jer-c106="" class="handle-button ai-button"></div><div _ngcontent-jer-c106="" class="handle-button line-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jer-c106="" class="handle-button theme-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jer-c106="" class="handle-button copy-button"><div _ngcontent-jer-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jer-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { bookParser } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ReaderKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Reader</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAbsoluteResourcePath</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAbsoluteResourcePath</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 通过提前导入到</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory" target="_blank"><span class="hljs-comment">应用沙箱目录</span></a><span class="hljs-comment">中的书籍文件，初始化书籍解析器</span></li><li>      <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/abc.epub`</span>;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">bookParserHandler</span>: bookParser.<span class="hljs-property">BookParserHandler</span> = <span class="hljs-keyword">await</span> bookParser.<span class="hljs-title function_">getDefaultHandler</span>(filePath);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">spineList</span>: bookParser.<span class="hljs-property">SpineItem</span>[] = bookParserHandler.<span class="hljs-title function_">getSpineList</span>();</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">resourcePath</span>: <span class="hljs-built_in">string</span> = bookParserHandler.<span class="hljs-title function_">getAbsoluteResourcePath</span>(spineList[<span class="hljs-number">0</span>].<span class="hljs-property">index</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`getAbsoluteResourcePath succeeded, resourcePath:`</span> + resourcePath);</li><li>    } <span class="hljs-keyword">catch</span>(err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`failed to getAbsoluteResourcePath, Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 业务自行实现页面布局</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>