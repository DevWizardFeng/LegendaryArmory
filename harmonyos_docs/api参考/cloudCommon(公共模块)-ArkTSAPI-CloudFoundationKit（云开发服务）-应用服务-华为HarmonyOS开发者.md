<h1 _ngcontent-gka-c119="" class="doc-title ng-star-inserted" title="cloudCommon (公共模块)"> cloudCommon (公共模块) </h1>

<div _ngcontent-gka-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供初始化云开发服务的能力。</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="tiledSection"><h2 id="section9320160142314" device-type="phone,tablet,tv,wearable">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9320160142314" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section15555111210233" device-type="phone,tablet,tv,wearable">cloudCommon.init<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section15555111210233" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>init(options?: CloudOptions): void</p> <p>初始化云开发服务。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.9.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>options</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section6286921112312">CloudOptions</a></p> </td> <td class="cellrowborder" width="25%"><p>否</p> </td> <td class="cellrowborder" width="25%"><p>设置初始化参数。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-arkts-error-code">ArkTS错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.4.12.1.3.1.1" style="border: none;" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.12.1.3.1.2" style="border: none;" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" style="border: none;" width="50%"><p>401</p> </td> <td class="cellrowborder" style="border: none;" width="50%"><p>Parameter error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例</strong>：</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>云函数业务免鉴权，开发云函数无需获取用户凭据。开发云存储或云数据库业务则需要获取用户凭据。获取用户凭据有两种方式，以下代码仅以通过AGC认证服务SDK获取为例，更多信息可参考<a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section136610231214">AuthProvider</a>。</p> </div></div></div> <div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> { request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> auth <span class="hljs-keyword">from</span> <span class="hljs-string">'@hw-agconnect/auth'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> provider = auth.<span class="hljs-title function_">getAuthProvider</span>(); <span class="hljs-comment">// 在用户登录成功的情况下调用此方法获取authProvider</span></li><li>cloudCommon.<span class="hljs-title function_">init</span>({</li><li>  <span class="hljs-attr">region</span>: cloudCommon.<span class="hljs-property">CloudRegion</span>.<span class="hljs-property">CHINA</span>,</li><li>  <span class="hljs-attr">authProvider</span>: provider,</li><li>  <span class="hljs-attr">functionOptions</span>: { <span class="hljs-attr">timeout</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1000</span> },</li><li>  <span class="hljs-attr">storageOptions</span>: { <span class="hljs-attr">mode</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Mode</span>.<span class="hljs-property">BACKGROUND</span>, <span class="hljs-attr">network</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Network</span>.<span class="hljs-property">ANY</span> },</li><li>  <span class="hljs-attr">databaseOptions</span>: { <span class="hljs-attr">schema</span>: <span class="hljs-string">"schema.json"</span>, <span class="hljs-attr">traceId</span>: <span class="hljs-string">"traceId"</span> }</li><li>})</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section6286921112312" device-type="phone,tablet,tv,wearable">CloudOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section6286921112312" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>初始化选项。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力： </strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.7.1.6.1.1" width="23.119999999999997%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.6.1.2" width="23.119999999999997%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.6.1.3" width="7.5200000000000005%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.6.1.4" width="12.97%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.7.1.6.1.5" width="33.269999999999996%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.119999999999997%"><p>region</p> </td> <td class="cellrowborder" width="23.119999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section10763191910114">CloudRegion</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="12.97%"><p>是</p> </td> <td class="cellrowborder" width="33.269999999999996%"><p>存储地，默认为CHINA。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>authProvider</p> </td> <td class="cellrowborder" width="23.119999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section136610231214">AuthProvider</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="12.97%"><p>是</p> </td> <td class="cellrowborder" width="33.269999999999996%"><p>认证提供方。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>functionOptions</p> </td> <td class="cellrowborder" width="23.119999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section11284175361211">FunctionOptions</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="12.97%"><p>是</p> </td> <td class="cellrowborder" width="33.269999999999996%"><p>云函数初始化设置。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>storageOptions</p> </td> <td class="cellrowborder" width="23.119999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section1772621115138">StorageOptions</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="12.97%"><p>是</p> </td> <td class="cellrowborder" width="33.269999999999996%"><p>云存储初始化设置。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>databaseOptions</p> </td> <td class="cellrowborder" width="23.119999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/cloudfoundation-cloudcommon#section2817232171313">DatabaseOptions</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="12.97%"><p>是</p> </td> <td class="cellrowborder" width="33.269999999999996%"><p>云数据库初始化设置。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section10763191910114" device-type="phone,tablet,tv,wearable">CloudRegion<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10763191910114" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>枚举， 存储地类型。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力： </strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.7.1.4.1.1" width="25.73257325732573%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.4.1.2" width="24.59245924592459%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.4.1.3" width="49.67496749674967%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25.73257325732573%"><p>CHINA</p> </td> <td class="cellrowborder" width="24.59245924592459%"><p>0</p> </td> <td class="cellrowborder" width="49.67496749674967%"><p>数据存储到中国境内（不包含中国香港、中国澳门、中国台湾）。</p> </td> </tr> <tr><td class="cellrowborder" width="25.73257325732573%"><p>GERMANY</p> </td> <td class="cellrowborder" width="24.59245924592459%"><p>1</p> </td> <td class="cellrowborder" width="49.67496749674967%"><p>数据存储到德国区。</p> </td> </tr> <tr><td class="cellrowborder" width="25.73257325732573%"><p>RUSSIA</p> </td> <td class="cellrowborder" width="24.59245924592459%"><p>2</p> </td> <td class="cellrowborder" width="49.67496749674967%"><p>数据存储到俄罗斯。</p> </td> </tr> <tr><td class="cellrowborder" width="25.73257325732573%"><p>SINGAPORE</p> </td> <td class="cellrowborder" width="24.59245924592459%"><p>3</p> </td> <td class="cellrowborder" width="49.67496749674967%"><p>数据存储到新加坡。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section136610231214" device-type="phone,tablet,tv,wearable">AuthProvider<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section136610231214" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>认证提供方。开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-auth-introduction-0000002271496181" target="_blank">AGC认证服务SDK</a>获取AuthProvider，或者使用华为账号服务Access Token接口自定义AuthProvider。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </div> <div class="tiledSection"><h3 id="section9723191765120" device-type="phone,tablet,tv,wearable" class="firsth2">getAccessToken<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9723191765120" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>getAccessToken(isForceRefresh: boolean): Promise&lt;string&gt;</p> <p>获取用户凭据。使用Promise异步回调。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数</strong><strong>：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.1" width="15.25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.2" width="23.76%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.3" width="11.39%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.5.1.4" width="49.6%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15.25%"><p>isForceRefresh</p> </td> <td class="cellrowborder" width="23.76%"><p>boolean</p> </td> <td class="cellrowborder" width="11.39%"><p>是</p> </td> <td class="cellrowborder" width="49.6%"><p>是否需要强制刷新返回用户凭据。true表示需要，false表示不需要。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值</strong><strong>：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.1" width="39.12%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.11.1.3.1.2" width="60.88%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="39.12%"><p>Promise&lt;string&gt;</p> </td> <td class="cellrowborder" width="60.88%"><p>Promise对象，返回用户凭据（该用户凭据可使用AGC认证服务SDK或华为账号服务的获取用户级凭证接口生成）。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <ul><li><strong>（推荐）</strong>方式一：使用AGC认证服务SDK获取AuthProvider（SDK会主动调用getAccessToken方法，无需开发者操作）<ol><li>在应用级（一般为entry目录下）“oh-package.json5”文件里面添加认证服务SDK依赖。<div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"dependencies"</span></span><span class="">: </span>{</li><li>  <span class="hljs-string">"@hw-agconnect/auth"</span>: <span class="hljs-string">"^1.0.5"</span></li><li>} </li></ol></pre></div></div> </li><li>使用手机、邮箱或华为账号进行<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-auth-login-0000002271496189" target="_blank">登录认证</a>。</li><li>认证成功后获取AuthProvider。<div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> auth <span class="hljs-keyword">from</span> <span class="hljs-string">'@hw-agconnect/auth'</span>;</li><li><span class="hljs-keyword">import</span> { request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> authProvider = auth.<span class="hljs-title function_">getAuthProvider</span>();</li><li>cloudCommon.<span class="hljs-title function_">init</span>({</li><li>  <span class="hljs-attr">region</span>: cloudCommon.<span class="hljs-property">CloudRegion</span>.<span class="hljs-property">CHINA</span>,</li><li>  <span class="hljs-attr">authProvider</span>: authProvider,</li><li>  <span class="hljs-attr">functionOptions</span>: { <span class="hljs-attr">timeout</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1000</span> },</li><li>  <span class="hljs-attr">storageOptions</span>: { <span class="hljs-attr">mode</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Mode</span>.<span class="hljs-property">BACKGROUND</span>, <span class="hljs-attr">network</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Network</span>.<span class="hljs-property">ANY</span> },</li><li>  <span class="hljs-attr">databaseOptions</span>: { <span class="hljs-attr">schema</span>: <span class="hljs-string">"schema.json"</span>, <span class="hljs-attr">traceId</span>: <span class="hljs-string">"traceId"</span> }</li><li>})</li></ol></pre></div></div> </li></ol> </li><li>方式二：<ol><li>使用华为账号服务的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token" target="_blank">获取用户级凭证</a>接口获取refresh_token，然后基于refresh_token换取access_token自定义AuthProvider。可参考如下示例代码换取：<div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> accessToken = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyAuthProvider</span> <span class="hljs-keyword">implements</span> cloudCommon.<span class="hljs-property">AuthProvider</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getAccessToken</span>(<span class="hljs-attr">isForceRefresh</span>: <span class="hljs-built_in">boolean</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> data =</li><li>      <span class="hljs-string">"grant_type=refresh_token&amp;client_id=xxxx&amp;client_secret=xxxx&amp;refresh_token="</span>;</li><li>    <span class="hljs-keyword">let</span> refreshToken =</li><li>      <span class="hljs-built_in">encodeURIComponent</span>(<span class="hljs-string">'xxxx'</span>); <span class="hljs-comment">// xxxx为使用华为账号服务获取用户级凭证接口获取的refresh_token</span></li><li>    <span class="hljs-comment">// access_token过期则强制刷新</span></li><li>    <span class="hljs-keyword">if</span> (isForceRefresh) {</li><li>      data = data + refreshToken;</li><li>      <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">ohosOptions</span>: http.<span class="hljs-property">HttpRequestOptions</span> = {</li><li>          <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>,</li><li>          <span class="hljs-attr">header</span>: {</li><li>            <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/x-www-form-urlencoded'</span></li><li>          },</li><li>          <span class="hljs-attr">extraData</span>: data,</li><li>        };</li><li>        <span class="hljs-keyword">let</span> url = <span class="hljs-string">"https://oauth-login.cloud.huawei.com/oauth2/v3/token"</span>;</li><li>        <span class="hljs-keyword">let</span> resp = <span class="hljs-keyword">await</span> httpRequest.<span class="hljs-title function_">request</span>(url, ohosOptions);</li><li>        accessToken = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(resp.<span class="hljs-property">result</span>.<span class="hljs-title function_">toString</span>()).<span class="hljs-property">access_token</span>;</li><li>      } <span class="hljs-keyword">catch</span> (err) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to get accessToken, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(accessToken);</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li>使用自定义的AuthProvider完成初始化。<div _ngcontent-gka-c106="" class="highlight-div"><div _ngcontent-gka-c106="" class="highlight-div-header"><div _ngcontent-gka-c106="" class="highlight-div-header-left"><div _ngcontent-gka-c106="" class="handle-button expand-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gka-c106="" class="highlight-div-header-right"><div _ngcontent-gka-c106="" class="handle-button ai-button"></div><div _ngcontent-gka-c106="" class="handle-button line-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gka-c106="" class="handle-button theme-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gka-c106="" class="handle-button copy-button"><div _ngcontent-gka-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gka-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cloudCommon } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CloudFoundationKit'</span>;</li><li><span class="hljs-keyword">import</span> { request } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyAuthProvider</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'xxx'</span>; <span class="hljs-comment">// xxx为您自定义的AuthProvider文件路径</span></li><li>
</li><li><span class="hljs-keyword">let</span> authProvider = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyAuthProvider</span>();</li><li>cloudCommon.<span class="hljs-title function_">init</span>({</li><li>  <span class="hljs-attr">region</span>: cloudCommon.<span class="hljs-property">CloudRegion</span>.<span class="hljs-property">CHINA</span>, <span class="hljs-comment">// 请填写实际数据处理位置</span></li><li>  <span class="hljs-attr">authProvider</span>: authProvider,</li><li>  <span class="hljs-attr">functionOptions</span>: { <span class="hljs-attr">timeout</span>: <span class="hljs-number">10</span> * <span class="hljs-number">1000</span> },</li><li>  <span class="hljs-attr">storageOptions</span>: { <span class="hljs-attr">mode</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Mode</span>.<span class="hljs-property">BACKGROUND</span>, <span class="hljs-attr">network</span>: request.<span class="hljs-property">agent</span>.<span class="hljs-property">Network</span>.<span class="hljs-property">ANY</span> },</li><li>  <span class="hljs-attr">databaseOptions</span>: { <span class="hljs-attr">schema</span>: <span class="hljs-string">"schema.json"</span>, <span class="hljs-attr">traceId</span>: <span class="hljs-string">"traceId"</span> }</li><li>})</li></ol></pre></div></div> </li></ol> </li></ul> </div> <div class="tiledSection"><h2 id="section11284175361211" device-type="phone,tablet,tv,wearable">FunctionOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section11284175361211" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>云函数初始化配置参数。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong><strong>：</strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.1" width="16.07%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.2" width="19.07%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.3" width="7.5200000000000005%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.4" width="14.030000000000001%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.5" width="43.309999999999995%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.07%"><p>timeout</p> </td> <td class="cellrowborder" width="19.07%"><p>number</p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="14.030000000000001%"><p>是</p> </td> <td class="cellrowborder" width="43.309999999999995%"><p>函数请求超时时间，单位毫秒，默认为70*1000毫秒。</p> <p>取值范围无限制，会转成unsigned long类型。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1772621115138" device-type="phone,tablet,tv,wearable">StorageOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1772621115138" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>云存储初始化配置参数。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong><strong>：</strong>SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.7.1.6.1.1" width="14.77%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.6.1.2" width="20.979999999999997%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.6.1.3" width="7.5200000000000005%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.6.1.4" width="14.49%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.6.1.5" width="42.24%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.77%"><p>mode</p> </td> <td class="cellrowborder" width="20.979999999999997%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-request#requestagentmode10" target="_blank">request.agent.Mode</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="14.49%"><p>是</p> </td> <td class="cellrowborder" width="42.24%"><p>任务的模式。前端任务在应用切换到后台一段时间后失败/暂停；后台任务不受影响。默认为BACKGROUND。</p> <ul><li>BACKGROUND：后台任务。</li><li>FOREGROUND：前端任务。</li></ul> </td> </tr> <tr><td class="cellrowborder" width="14.77%"><p>network</p> </td> <td class="cellrowborder" width="20.979999999999997%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-request#requestagentnetwork10" target="_blank">request.agent.Network</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="14.49%"><p>是</p> </td> <td class="cellrowborder" width="42.24%"><p>使用的网络类型。网络不满足设置条件时，未执行的任务等待执行，执行中的任务失败/暂停。默认为Network.ANY。</p> <ul><li>Network.ANY：不限网络类型。</li><li>Network.WIFI：无线网络。</li><li>Network.CELLULAR：蜂窝数据网络。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section2817232171313" device-type="phone,tablet,tv,wearable">DatabaseOptions<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section2817232171313" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>云数据库初始化配置参数。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>元服务API</strong><strong>：</strong>从版本5.0.0(12)开始，该接口支持在元服务中使用。</p> <p><strong>系统能力</strong><strong>：</strong> SystemCapability.DeviceCloudGateway.CloudFoundation</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.7.1.6.1.1" width="11.701170117011701%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.6.1.2" width="10.281028102810282%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.6.1.3" width="7.520752075207521%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.6.1.4" width="8.930893089308931%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.7.1.6.1.5" width="61.56615661566157%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="11.701170117011701%"><p>schema</p> </td> <td class="cellrowborder" width="10.281028102810282%"><p>string</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>否</p> </td> <td class="cellrowborder" width="8.930893089308931%"><p>是</p> </td> <td class="cellrowborder" width="61.56615661566157%"><p>全量数据表结构及权限定义，使用从云端下载的schema.json配置文件，默认读取工程固定目录：rawfile。</p> </td> </tr> <tr><td class="cellrowborder" width="11.701170117011701%"><p>traceId</p> </td> <td class="cellrowborder" width="10.281028102810282%"><p>string</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>否</p> </td> <td class="cellrowborder" width="8.930893089308931%"><p>是</p> </td> <td class="cellrowborder" width="61.56615661566157%"><p>用户自定义的traceId，用于跟踪请求操作。</p> <p>自定义traceId的长度必须大于或等于1个字符，小于或等于32个字符，只能包含以下2种类型：</p> <ul><li>字母（a-f）</li><li>数字（0-9）</li></ul> <p>默认值为空。</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>