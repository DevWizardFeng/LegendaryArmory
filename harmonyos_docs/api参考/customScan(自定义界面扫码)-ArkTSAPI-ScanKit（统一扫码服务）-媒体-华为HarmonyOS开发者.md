<h1 _ngcontent-upg-c119="" class="doc-title ng-star-inserted" title="customScan (自定义界面扫码)"> customScan (自定义界面扫码) </h1>

<div _ngcontent-upg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供自定义界面扫码能力。</p> <p id="ZH-CN_TOPIC_0000002340743137__p5286553165918">为了方便开发者接入，我们提供了详细的样例工程供参考，推荐参考<a href="https://gitcode.com/HarmonyOS_Samples/scan-kit_-sample-code_-clientdemo_-arkts" target="_blank">示例工程</a>接入。</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="tiledSection"><h2 id="section164051883419" device-type="phone,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section164051883419" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section8604949165313" device-type="phone,tablet">ViewControl<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section8604949165313" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>相机控制参数。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="22.567743225677432%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="22.567743225677432%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="11.12888711128887%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="11.218878112188781%"><p><strong>可选</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="32.516748325167484%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="22.567743225677432%"><p>width</p> </td> <td class="cellrowborder" width="22.567743225677432%"><p>number</p> </td> <td class="cellrowborder" width="11.12888711128887%"><p>否</p> </td> <td class="cellrowborder" width="11.218878112188781%"><p>否</p> </td> <td class="cellrowborder" width="32.516748325167484%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>组件的宽，默认使用单位为vp，支持px、lpx和vp。</p> </td> </tr> <tr><td class="cellrowborder" width="22.567743225677432%"><p>height</p> </td> <td class="cellrowborder" width="22.567743225677432%"><p>number</p> </td> <td class="cellrowborder" width="11.12888711128887%"><p>否</p> </td> <td class="cellrowborder" width="11.218878112188781%"><p>否</p> </td> <td class="cellrowborder" width="32.516748325167484%"><p>XComponent组件的高，默认使用单位为vp，支持px、lpx和vp。</p> </td> </tr> <tr><td class="cellrowborder" width="22.567743225677432%"><p>surfaceId</p> </td> <td class="cellrowborder" width="22.567743225677432%"><p>string</p> </td> <td class="cellrowborder" width="11.12888711128887%"><p>否</p> </td> <td class="cellrowborder" width="11.218878112188781%"><p>否</p> </td> <td class="cellrowborder" width="32.516748325167484%"><p>XComponent持有surface的ID。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ol><li>ViewControl的width和height需和XComponent的保持一致，start接口根据设置宽高值会匹配最接近相机分辨率，当未匹配到合适分辨率，接口会返回1000500001内部错误。XComponent组件为预览流提供的Surface，而XComponent的能力由UI提供，相关介绍可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent</a>。</li><li>当开发设备为折叠屏时，折叠态切换时需自行调整XComponent的宽高，start接口会重新适配相机分辨率比例。</li></ol> </div></div></div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">640</span>;</li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'onLoad is called'</span>)</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'viewControl'</span>, <span class="hljs-string">`onLoad surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置ViewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">scanResult: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Succeeded in getting ScanResult by promise, scanResult is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(scanResult)}</span>`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Failed to get ScanResult by promise. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            })</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1670633211200" device-type="phone,tablet">ScanFrame<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1670633211200" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>相机预览流（YUV）。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.1" width="17.46%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.2" width="36.47%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.3" width="8.48%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.4" width="8.55%"><p><strong>可选</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.5" width="29.04%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.46%"><p>byteBuffer</p> </td> <td class="cellrowborder" width="36.47%"><p>ArrayBuffer</p> </td> <td class="cellrowborder" width="8.48%"><p>否</p> </td> <td class="cellrowborder" width="8.55%"><p>否</p> </td> <td class="cellrowborder" width="29.04%"><p>相机预览流的ArrayBuffer数组。</p> </td> </tr> <tr><td class="cellrowborder" width="17.46%"><p>width</p> </td> <td class="cellrowborder" width="36.47%"><p>number</p> </td> <td class="cellrowborder" width="8.48%"><p>否</p> </td> <td class="cellrowborder" width="8.55%"><p>否</p> </td> <td class="cellrowborder" width="29.04%"><p>相机预览流的宽度，单位：px。</p> </td> </tr> <tr><td class="cellrowborder" width="17.46%"><p>height</p> </td> <td class="cellrowborder" width="36.47%"><p>number</p> </td> <td class="cellrowborder" width="8.48%"><p>否</p> </td> <td class="cellrowborder" width="8.55%"><p>否</p> </td> <td class="cellrowborder" width="29.04%"><p>相机预览流的高度，单位：px。</p> </td> </tr> <tr><td class="cellrowborder" width="17.46%"><p>scanCodeRects</p> </td> <td class="cellrowborder" width="36.47%"><p>Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1456184716188">ScanCodeRect</a>&gt;</p> </td> <td class="cellrowborder" width="8.48%"><p>否</p> </td> <td class="cellrowborder" width="8.55%"><p>是</p> </td> <td class="cellrowborder" width="29.04%"><p>相机预览流的码图检测位置信息。</p> <p><strong>设备行为差异：</strong>该属性在带有Kirin NPU（Neural-network Processing Unit，神经网络处理器）的设备可正常返回，在不带有Kirin NPU的设备上返回null。</p> </td> </tr>  </tbody></table></div> </div> <p>示例：</p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span>, <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">640</span>;</li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>[]&gt; =</li><li>    <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">result</span>: scanBarcode.<span class="hljs-property">ScanResult</span>[]) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanResult by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by callback, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>    }</li><li>  <span class="hljs-comment">// 回调获取ScanFrame</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">frameCallback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;customScan.<span class="hljs-property">ScanFrame</span>&gt; =</li><li>    <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">frameResult</span>: customScan.<span class="hljs-property">ScanFrame</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanFrame by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-comment">// byteBuffer相机YUV图像数组</span></li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanFrame.byteBuffer.byteLength:  <span class="hljs-subst">${frameResult.byteBuffer.byteLength}</span>`</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanFrame.scanCodeRect: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(frameResult.scanCodeRects)}</span>`</span>);</li><li>    }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in loading, onLoad is called'</span>);</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in getting surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置ViewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameCallback</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ol><li>scanCodeRects返回为横向预览流中的码图位置检测信息，如需后续处理，需要将位置转换为纵向坐标系，数组中每一个元素left、top、right、bottom参数转换逻辑，以手机设备竖屏、充电口向下为例，以scanCodeRects第一个元素为例：<div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// start接口frameCallback回调返回frameResult数据</span></li><li><span class="hljs-keyword">import</span> { customScan, scanBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-comment">// 模拟相机预览流返回数据frameResult: customScan.ScanFrame</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">frameResult</span>: customScan.<span class="hljs-property">ScanFrame</span> = {</li><li>  <span class="hljs-string">"width"</span>: <span class="hljs-number">1920</span>,</li><li>  <span class="hljs-string">"height"</span>: <span class="hljs-number">1080</span>,</li><li>  <span class="hljs-comment">// buffer 为相机流</span></li><li><span class="hljs-string">"byteBuffer"</span>: buffer,</li><li>  <span class="hljs-string">"scanCodeRects"</span>: [{</li><li>    <span class="hljs-string">"left"</span>: <span class="hljs-number">84</span>,</li><li>    <span class="hljs-string">"top"</span>: <span class="hljs-number">142</span>,</li><li>    <span class="hljs-string">"right"</span>: <span class="hljs-number">1695</span>,</li><li>    <span class="hljs-string">"bottom"</span>: <span class="hljs-number">996</span></li><li>  }]</li><li>};</li><li><span class="hljs-keyword">if</span> (frameResult &amp;&amp; frameResult.<span class="hljs-property">scanCodeRects</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rect</span>: scanBarcode.<span class="hljs-property">ScanCodeRect</span> = frameResult.<span class="hljs-property">scanCodeRects</span>[<span class="hljs-number">0</span>];</li><li>  <span class="hljs-comment">// 预览流尺寸转换为显示组件XComponent尺寸比例，例如设置的scanWidth为360vp</span></li><li>  <span class="hljs-keyword">let</span> scanWidth = <span class="hljs-number">360</span>;</li><li>  <span class="hljs-keyword">let</span> ratio = scanWidth / frameResult.<span class="hljs-property">height</span>;</li><li>  <span class="hljs-keyword">let</span> left = (frameResult.<span class="hljs-property">height</span> - rect.<span class="hljs-property">bottom</span>) * ratio;</li><li>  <span class="hljs-keyword">let</span> top = rect.<span class="hljs-property">left</span> * ratio;</li><li>  <span class="hljs-keyword">let</span> right = (frameResult.<span class="hljs-property">height</span> - rect.<span class="hljs-property">top</span>) * ratio;</li><li>  <span class="hljs-keyword">let</span> bottom = rect.<span class="hljs-property">right</span> * ratio;</li><li>}</li></ol></pre></div></div> </li><li>对应的二维码区域位置可以使用固定定位position({x: left, y: top})，宽度width: right - left，高度height: bottom - top，画出二维码实际区域范围。</li></ol> </div></div></div> </div> <div class="tiledSection"><h2 id="section447114223245" device-type="phone,tablet">customScan.init<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section447114223245" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>init(options?: scanBarcode.ScanOptions): void</p> <p>初始化自定义界面扫码。</p> <p><strong>需要权限：</strong>ohos.permission.CAMERA</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.7.2.1.5.1.1" width="17.858214178582145%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.2.1.5.1.2" width="31.736826317368266%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.2.1.5.1.3" width="7.7792220777922205%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.2.1.5.1.4" width="42.62573742625737%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.858214178582145%"><p>options</p> </td> <td class="cellrowborder" width="31.736826317368266%"><p>scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1285191073117">ScanOptions</a></p> </td> <td class="cellrowborder" width="7.7792220777922205%"><p>否</p> </td> <td class="cellrowborder" width="42.62573742625737%"><p>自定义界面扫码参数。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p> <p>从5.0.2(14)开始，customScan模块的init接口新增错误码201。</p> <ul><li>对于5.0.2(14)之前版本，在未申请相机权限时调用customScan模块init接口，返回错误码1000500001。</li><li>对于5.0.2(14)及之后版本，在未申请相机权限时调用customScan模块init接口，返回错误码201。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.7.12.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.12.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>201</p> </td> <td class="cellrowborder" width="70%"><p>Permission denied.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>401</p> </td> <td class="cellrowborder" width="70%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { scanBarcode, scanCore, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = {</li><li>  <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>],</li><li>  <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">init</span>(options);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to init customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section38711535114711" device-type="phone,tablet">customScan.start<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section38711535114711" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>start(viewControl: ViewControl): Promise&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;</p> <p>启动扫码相机流，使用Promise异步回调获取扫码结果。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>此接口需要在init接口调用后才能使用。</p> </div></div></div> <p><strong>需要权限：</strong>ohos.permission.CAMERA</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.8.2.1.5.1.1" width="18.35%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.2.1.5.1.2" width="20.46%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.2.1.5.1.3" width="12.16%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.2.1.5.1.4" width="49.03%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="18.35%"><p>viewControl</p> </td> <td class="cellrowborder" width="20.46%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-customscan-api#section8604949165313">ViewControl</a></p> </td> <td class="cellrowborder" width="12.16%"><p>是</p> </td> <td class="cellrowborder" width="49.03%"><p>相机控制参数。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.9.2.1.3.1.1" width="46.160000000000004%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.9.2.1.3.1.2" width="53.839999999999996%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="46.160000000000004%"><p>Promise&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;&gt;</p> </td> <td class="cellrowborder" width="53.839999999999996%"><p>Promise对象，返回启动相机流扫码结果对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p> <p>从5.0.2(14)开始，customScan模块的start接口新增错误码201。</p> <ul><li>对于5.0.2(14)之前版本，在未申请相机权限时调用customScan模块start接口，返回错误码1000500001。</li><li>对于5.0.2(14)及之后版本，在未申请相机权限时调用customScan模块start接口，返回错误码201。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.14.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.14.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>201</p> </td> <td class="cellrowborder" width="70%"><p>Permission denied.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>401</p> </td> <td class="cellrowborder" width="70%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">640</span></li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in loading, onLoad is called'</span>);</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in getting surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置ViewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">scanResult: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Succeeded in getting ScanResult by promise, scanResult is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(scanResult)}</span>`</span>);</li><li>            }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>                <span class="hljs-string">`Failed to get ScanResult by promise. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>            });</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section747366165913" device-type="phone,tablet">customScan.start<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section747366165913" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>start(viewControl: ViewControl, callback: AsyncCallback&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;, frameCallback?: AsyncCallback&lt;ScanFrame&gt;): void</p> <p>启动扫码相机流，使用Callback异步回调获取扫码结果、相机预览流（YUV-图像格式NV21基于4:2:0采样）。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>此接口需要在init接口调用后才能使用。</p> </div></div></div> <p><strong>需要权限：</strong>ohos.permission.CAMERA</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.8.2.1.5.1.1" width="17.97%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.2.1.5.1.2" width="34.43%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.2.1.5.1.3" width="6.4%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.2.1.5.1.4" width="41.199999999999996%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.97%"><p>viewControl</p> </td> <td class="cellrowborder" width="34.43%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-customscan-api#section8604949165313">ViewControl</a></p> </td> <td class="cellrowborder" width="6.4%"><p>是</p> </td> <td class="cellrowborder" width="41.199999999999996%"><p>相机控制参数。</p> </td> </tr> <tr><td class="cellrowborder" width="17.97%"><p>callback</p> </td> <td class="cellrowborder" width="34.43%"><p>AsyncCallback&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;&gt;</p> </td> <td class="cellrowborder" width="6.4%"><p>是</p> </td> <td class="cellrowborder" width="41.199999999999996%"><p>回调函数，当启动相机流扫码成功，err为undefined，data为获取到的Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;；否则为错误对象。</p> </td> </tr> <tr><td class="cellrowborder" width="17.97%"><p>frameCallback</p> </td> <td class="cellrowborder" width="34.43%"><p>AsyncCallback&lt;<a href="/consumer/cn/doc/harmonyos-references/scan-customscan-api#section1670633211200">ScanFrame</a>&gt;</p> </td> <td class="cellrowborder" width="6.4%"><p>否</p> </td> <td class="cellrowborder" width="41.199999999999996%"><p>回调函数，当启动相机流成功，err为undefined，data为获取到的相机预览流（YUV）<a href="/consumer/cn/doc/harmonyos-references/scan-customscan-api#section1670633211200">ScanFrame</a>；否则为错误对象。</p> <p><strong>起始版本：</strong>5.0.0(12)</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p> <p>从5.0.2(14)开始，customScan模块的start接口新增错误码201。</p> <ul><li>对于5.0.2(14)之前版本，在未申请相机权限时调用customScan模块start接口，返回错误码1000500001。</li><li>对于5.0.2(14)及之后版本，在未申请相机权限时调用customScan模块start接口，返回错误码201。</li></ul>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.9.13.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.13.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>201</p> </td> <td class="cellrowborder" width="70%"><p>Permission denied.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>401</p> </td> <td class="cellrowborder" width="70%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span>, <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">640</span>;</li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>  <span class="hljs-comment">// 返回自定义扫描结果的回调</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-title class_">Array</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>&gt;&gt; =</li><li>    <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">result</span>: <span class="hljs-title class_">Array</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>&gt;) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanResult by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by callback, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>    }</li><li>  <span class="hljs-comment">// 回调获取ScanFrame</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">frameCallback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;customScan.<span class="hljs-property">ScanFrame</span>&gt; =</li><li>    <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">scanFrame</span>: customScan.<span class="hljs-property">ScanFrame</span>) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanFrame by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanFrame by callback, scanFrame is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(scanFrame)}</span>`</span>);</li><li>    }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in loading, onLoad is called'</span>);</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in getting surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置ViewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">frameCallback</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1693117333508" device-type="phone,tablet">customScan.getFlashLightStatus<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1693117333508" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>getFlashLightStatus(): boolean</p> <p>获取当前相机闪光灯状态。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，相机流初始化、停止和释放阶段使用都会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.7.2.1.3.1.1" width="30%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.2.1.3.1.2" width="70%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>boolean</p> </td> <td class="cellrowborder" width="70%"><p>返回当前相机闪光灯状态。true代表开启，false代表关闭。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">flashLightStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  flashLightStatus = customScan.<span class="hljs-title function_">getFlashLightStatus</span>();</li><li>  <span class="hljs-comment">// 根据当前闪光灯状态，选择打开或关闭闪光灯</span></li><li>  <span class="hljs-keyword">if</span> (flashLightStatus) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      customScan.<span class="hljs-title function_">closeFlashLight</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to closeFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      customScan.<span class="hljs-title function_">openFlashLight</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to openFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to getFlashLightStatus. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section75901948175116" device-type="phone,tablet">customScan.openFlashLight<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section75901948175116" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>openFlashLight(): void</p> <p>开启相机闪光灯。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，相机流初始化、停止和释放阶段使用都会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">flashLightStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  flashLightStatus = customScan.<span class="hljs-title function_">getFlashLightStatus</span>();</li><li>  <span class="hljs-comment">// 根据当前闪光灯状态，选择打开或关闭闪光灯</span></li><li>  <span class="hljs-keyword">if</span> (flashLightStatus) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      customScan.<span class="hljs-title function_">closeFlashLight</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to closeFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      customScan.<span class="hljs-title function_">openFlashLight</span>();</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to openFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to getFlashLightStatus. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section17980725135120" device-type="phone,tablet">customScan.closeFlashLight<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17980725135120" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>closeFlashLight(): void</p> <p>关闭相机闪光灯。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，相机流初始化、停止和释放阶段使用都会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.9.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">flashLightStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  flashLightStatus = customScan.<span class="hljs-title function_">getFlashLightStatus</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to getFlashLightStatus. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li><li><span class="hljs-comment">// 根据当前闪光灯状态，选择打开或关闭闪光灯</span></li><li><span class="hljs-keyword">if</span> (flashLightStatus) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    customScan.<span class="hljs-title function_">closeFlashLight</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to closeFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>} <span class="hljs-keyword">else</span> {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    customScan.<span class="hljs-title function_">openFlashLight</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to openFlashLight. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section070810389567" device-type="phone,tablet">customScan.setZoom<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section070810389567" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>setZoom(zoomValue: number): void</p> <p>设置变焦比。变焦精度最高为小数点后两位，如果设置超过支持的精度范围，则只保留精度范围内数值。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.1" width="16.520000000000003%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.2" width="23.09%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.3" width="10.51%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.2.1.5.1.4" width="49.88%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.520000000000003%"><p>zoomValue</p> </td> <td class="cellrowborder" width="23.09%"><p>number</p> </td> <td class="cellrowborder" width="10.51%"><p>是</p> </td> <td class="cellrowborder" width="49.88%"><p>相机变焦比，精度最高为小数点后两位（例如1.45）。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>401</p> </td> <td class="cellrowborder" width="70%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 设置变焦比</span></li><li><span class="hljs-keyword">let</span> zoomValue = <span class="hljs-number">2.0</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">setZoom</span>(zoomValue);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to setZoom. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section1699185032017" device-type="phone,tablet">customScan.getZoom<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1699185032017" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>getZoom(): number</p> <p>获取当前的变焦比。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.3.1.1" width="30%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.2.1.3.1.2" width="70%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>number</p> </td> <td class="cellrowborder" width="70%"><p>返回当前的变焦比。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 获取变焦比</span></li><li>  <span class="hljs-keyword">let</span> zoomValue = customScan.<span class="hljs-title function_">getZoom</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in getting zoomValue, zoomValue is <span class="hljs-subst">${zoomValue}</span>`</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to get zoomValue. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section288962116197" device-type="phone,tablet">customScan.setFocusPoint<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section288962116197" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>setFocusPoint(point: scanBarcode.Point): void</p> <p>设置相机焦点，焦点应在0-1坐标系内，该坐标系左上角为{0，0}，右下角为{1，1}。此坐标系是以设备充电口在右侧时的横向设备方向为基准的，例如应用的预览界面布局以设备充电口在下侧时的竖向方向为基准，布局宽高为{w，h}，且触碰点为{x，y}，则转换后的坐标点为{y/h，1-x/w}。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.1" width="17.330000000000002%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.2" width="25.56%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.3" width="13.28%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.2.1.5.1.4" width="43.830000000000005%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.330000000000002%"><p>point</p> </td> <td class="cellrowborder" width="25.56%"><p>scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section9634457911">Point</a></p> </td> <td class="cellrowborder" width="13.28%"><p>是</p> </td> <td class="cellrowborder" width="43.830000000000005%"><p>焦点。x、y设置范围应在[0，1]之内，超过范围，如果小于0设置0，大于1设置1。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>401</p> </td> <td class="cellrowborder" width="70%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 设置对焦点</span></li><li>  customScan.<span class="hljs-title function_">setFocusPoint</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0.5</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.5</span> });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to setFocusPoint. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section12891152115196" device-type="phone,tablet">customScan.resetFocus<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section12891152115196" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>resetFocus(): void</p> <p>设置连续自动对焦模式。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.16.9.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.9.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 设置连续自动对焦模式</span></li><li>  customScan.<span class="hljs-title function_">resetFocus</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to resetFocus. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1788353253914" device-type="phone,tablet">customScan.on('lightingFlash')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1788353253914" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>on(type: 'lightingFlash', callback: AsyncCallback&lt;boolean&gt;): void</p> <p>订阅闪光灯状态监听事件，当环境昏、亮状态变化时，使用callback异步回调返回打开时机。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.7.2.1.5.1.1" width="13.020000000000001%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.2.1.5.1.2" width="29.4%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.2.1.5.1.3" width="10.54%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.2.1.5.1.4" width="47.04%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="13.020000000000001%"><p>type</p> </td> <td class="cellrowborder" width="29.4%"><p>string</p> </td> <td class="cellrowborder" width="10.54%"><p>是</p> </td> <td class="cellrowborder" width="47.04%"><p>事件回调类型，固定为'lightingFlash'，当环境亮度发生变时触发。可用于提示用户打开或关闭闪光灯。</p> </td> </tr> <tr><td class="cellrowborder" width="13.020000000000001%"><p>callback</p> </td> <td class="cellrowborder" width="29.4%"><p>AsyncCallback&lt;boolean&gt;</p> </td> <td class="cellrowborder" width="10.54%"><p>是</p> </td> <td class="cellrowborder" width="47.04%"><p>回调函数。返回true表示当前环境暗，可以提示用户打开闪光灯，false表示环境亮，可以提示用户关闭闪光灯。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = (<span class="hljs-params">error: BusinessError, bool: <span class="hljs-built_in">boolean</span></span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to light Flash by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in lighting Flash by callback, bool is <span class="hljs-subst">${bool}</span>`</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">on</span>(<span class="hljs-string">'lightingFlash'</span>, callback);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to listen lightingFlash. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section128574416409" device-type="phone,tablet">customScan.off('lightingFlash')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section128574416409" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>off(type: 'lightingFlash', callback?: AsyncCallback&lt;boolean&gt;): void</p> <p>注销闪光灯状态监听事件。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.18.7.2.1.5.1.1" width="12.24%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.7.2.1.5.1.2" width="36.17%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.7.2.1.5.1.3" width="8.59%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.7.2.1.5.1.4" width="43%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.24%"><p>type</p> </td> <td class="cellrowborder" width="36.17%"><p>string</p> </td> <td class="cellrowborder" width="8.59%"><p>是</p> </td> <td class="cellrowborder" width="43%"><p>事件回调类型，固定为'lightingFlash'，当环境亮度发生变化时触发，可用于提示用户打开或关闭闪光灯。</p> </td> </tr> <tr><td class="cellrowborder" width="12.24%"><p>callback</p> </td> <td class="cellrowborder" width="36.17%"><p>AsyncCallback&lt;boolean&gt;</p> </td> <td class="cellrowborder" width="8.59%"><p>否</p> </td> <td class="cellrowborder" width="43%"><p>需要被注销的回调函数，若callback不填，则注销所有绑定在'lightingFlash'上的回调函数。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">callback</span> = (<span class="hljs-params">error: BusinessError, bool: <span class="hljs-built_in">boolean</span></span>) =&gt; {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to cancel Flash by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in cancelling Flash by callback, bool is <span class="hljs-subst">${bool}</span>`</span>);</li><li>}</li><li><span class="hljs-comment">// 可以不填callback，取消lightingFlash所有监听。填写callback，必须保持和customScan.on中监听的事件保持一致</span></li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">off</span>(<span class="hljs-string">'lightingFlash'</span>, callback);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to listen lightingFlash. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section19244173211169" device-type="phone,tablet">customScan.rescan<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section19244173211169" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>rescan(): void</p> <p>触发一次重新扫码。如果扫描结果不是预期结果，可以调用此接口触发下一次扫描。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后，stop接口之前使用，未启动相机流调用会抛出内部错误的异常。</p> <p>仅对start接口的Callback异步回调有效，Promise异步回调接口无效。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.19.9.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.9.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AsyncCallback</span>, <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanBarcode, customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct customScanPage {</li><li>  <span class="hljs-comment">// 设置预览流高度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">640</span>;</li><li>  <span class="hljs-comment">// 设置预览流宽度，默认单位：vp</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cameraWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">mXComponentController</span>: <span class="hljs-title class_">XComponentController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">XComponentController</span>();</li><li>  <span class="hljs-comment">// 返回自定义扫描结果的回调</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-title class_">Array</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>&gt;&gt; =</li><li>    <span class="hljs-keyword">async</span> (<span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">result</span>: <span class="hljs-title class_">Array</span>&lt;scanBarcode.<span class="hljs-property">ScanResult</span>&gt;) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanResult by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by callback, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>      <span class="hljs-comment">// 重新触发扫码。如需不重启相机并重新触发一次扫码，可以在start接口的Callback异步回调中，调用rescan接口。</span></li><li>      <span class="hljs-keyword">try</span> {</li><li>        customScan.<span class="hljs-title function_">rescan</span>();</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to rescan customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">XComponent</span>({</li><li>        <span class="hljs-attr">id</span>: <span class="hljs-string">'componentId'</span>,</li><li>        <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>,</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span></li><li>      })</li><li>        .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in loading, onLoad is called'</span>);</li><li>          <span class="hljs-comment">// 获取XComponent的surfaceId</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">surfaceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">mXComponentController</span>.<span class="hljs-title function_">getXComponentSurfaceId</span>();</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Succeeded in getting surfaceId: <span class="hljs-subst">${surfaceId}</span>`</span>);</li><li>          <span class="hljs-comment">// 设置ViewControl相应字段</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">viewControl</span>: customScan.<span class="hljs-property">ViewControl</span> = {</li><li>            <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>,</li><li>            <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>,</li><li>            <span class="hljs-attr">surfaceId</span>: surfaceId</li><li>          };</li><li>          <span class="hljs-keyword">try</span> {</li><li>            customScan.<span class="hljs-title function_">start</span>(viewControl, <span class="hljs-variable language_">this</span>.<span class="hljs-property">callback</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>              <span class="hljs-string">`Failed to start customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraHeight</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cameraWidth</span>)</li><li>        .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">position</span>({ <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section17184165841618" device-type="phone,tablet">customScan.setAutoZoomEnabled<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17184165841618" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>setAutoZoomEnabled(enabled: boolean): void</p> <p>设置自动变焦能力的开启和关闭。未调用时默认开启自动变焦。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.1.0(18)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.20.7.2.1.5.1.1" width="12.24%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.2.1.5.1.2" width="36.17%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.2.1.5.1.3" width="8.59%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.2.1.5.1.4" width="43%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.24%"><p>enabled</p> </td> <td class="cellrowborder" width="36.17%"><p>boolean</p> </td> <td class="cellrowborder" width="8.59%"><p>是</p> </td> <td class="cellrowborder" width="43%"><p>是否开启自动变焦能力。true代表开启，false代表关闭。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 开启或关闭自动变焦能力，true为开启，false为关闭</span></li><li>  customScan.<span class="hljs-title function_">setAutoZoomEnabled</span>(<span class="hljs-literal">false</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to setAutoZoomEnabled. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section6949611114915" device-type="phone,tablet">customScan.stop<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section6949611114915" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>stop(): Promise&lt;void&gt;</p> <p>暂停扫码相机流，使用Promise异步回调。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.7.2.1.3.1.1" width="30%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.7.2.1.3.1.2" width="70%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">stop</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in stopping scan by promise'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to stop scan by promise. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to stop customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section031674815483" device-type="phone,tablet">customScan.stop<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section031674815483" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>stop(callback: AsyncCallback&lt;void&gt;): void</p> <p>暂停扫码相机流，使用Callback异步回调。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口必须在启动相机流start接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.22.7.2.1.5.1.1" width="15.09%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.7.2.1.5.1.2" width="28.749999999999996%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.7.2.1.5.1.3" width="8.38%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.7.2.1.5.1.4" width="47.78%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15.09%"><p>callback</p> </td> <td class="cellrowborder" width="28.749999999999996%"><p>AsyncCallback&lt;void&gt;</p> </td> <td class="cellrowborder" width="8.38%"><p>是</p> </td> <td class="cellrowborder" width="47.78%"><p>回调函数。当暂停相机流成功，err为undefined，否则为错误对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">stop</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Failed to stop scan by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in stopping scan by callback'</span>);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to stop customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section1109456134917" device-type="phone,tablet">customScan.release<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1109456134917" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>release(): Promise&lt;void&gt;</p> <p>释放扫码相机流，使用Promise异步回调。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口建议在启动相机流start接口且暂停相机流stop接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.23.7.2.1.3.1.1" width="30%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.7.2.1.3.1.2" width="70%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.23.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">release</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in releasing scan by promise'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to release scan by promise. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to release customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section169321832184912" device-type="phone,tablet">customScan.release<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section169321832184912" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>release(callback: AsyncCallback&lt;void&gt;): void</p> <p>释放扫码相机流，使用Callback异步回调。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>本接口建议在启动相机流start接口且暂停相机流stop接口后使用，未启动相机流调用会抛出内部错误的异常。</p> </div></div></div> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="p"><strong>参数：</strong> <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.24.7.2.1.5.1.1" width="12.93%"><p><strong>参数名</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.7.2.1.5.1.2" width="30.259999999999998%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.7.2.1.5.1.3" width="9.26%"><p><strong>必填</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.7.2.1.5.1.4" width="47.55%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.93%"><p>callback</p> </td> <td class="cellrowborder" width="30.259999999999998%"><p>AsyncCallback&lt;void&gt;</p> </td> <td class="cellrowborder" width="9.26%"><p>是</p> </td> <td class="cellrowborder" width="47.55%"><p>回调函数。当释放相机流成功，err为undefined，否则为错误对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.24.10.1.3.1.1" width="30%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.24.10.1.3.1.2" width="70%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>1000500001</p> </td> <td class="cellrowborder" width="70%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-upg-c106="" class="highlight-div"><div _ngcontent-upg-c106="" class="highlight-div-header"><div _ngcontent-upg-c106="" class="highlight-div-header-left"><div _ngcontent-upg-c106="" class="handle-button expand-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-upg-c106="" class="highlight-div-header-right"><div _ngcontent-upg-c106="" class="handle-button ai-button"></div><div _ngcontent-upg-c106="" class="handle-button line-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-upg-c106="" class="handle-button theme-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-upg-c106="" class="handle-button copy-button"><div _ngcontent-upg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-upg-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { customScan } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  customScan.<span class="hljs-title function_">release</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Failed to release scan by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">'Succeeded in releasing scan by callback'</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>    <span class="hljs-string">`Failed to release customScan. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>