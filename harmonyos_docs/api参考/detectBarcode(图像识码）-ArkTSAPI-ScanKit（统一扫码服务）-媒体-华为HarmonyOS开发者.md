<h1 _ngcontent-iys-c119="" class="doc-title ng-star-inserted" title="detectBarcode (图像识码）"> detectBarcode (图像识码） </h1>

<div _ngcontent-iys-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供本地图片识码和图像数据识码能力，支持对图像中的条形码、二维码、MULTIFUNCTIONAL CODE进行识别，并获得码类型、码值、码位置信息。</p> <p>为了方便开发者接入，我们提供了详细的样例工程供参考，推荐参考<a href="https://gitcode.com/HarmonyOS_Samples/scan-kit_-sample-code_-clientdemo_-arkts" target="_blank">示例工程</a>接入。</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="tiledSection"><h2 id="section112313386277" device-type="phone,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section112313386277" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section2194164873812" device-type="phone,tablet">InputImage<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section2194164873812" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>待识别的图片信息。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="23.119999999999997%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="21.82%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="14.64%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="11.07%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="29.349999999999998%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.119999999999997%"><p>uri</p> </td> <td class="cellrowborder" width="21.82%"><p>string</p> </td> <td class="cellrowborder" width="14.64%"><p>否</p> </td> <td class="cellrowborder" width="11.07%"><p>否</p> </td> <td class="cellrowborder" width="29.349999999999998%"><p>图片路径，例如file://media/Photo/x/xxx.jpg。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><div class="p">推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker" target="_blank">picker</a>获取图片路径。<div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>
</li><li><span class="hljs-keyword">let</span> photoSelectOptions = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>photoSelectOptions.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>photoSelectOptions.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li>photoSelectOptions.<span class="hljs-property">isPhotoTakingSupported</span> = <span class="hljs-literal">false</span>;</li><li>photoSelectOptions.<span class="hljs-property">isEditSupported</span> = <span class="hljs-literal">false</span>;</li><li><span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>photoPicker.<span class="hljs-title function_">select</span>(photoSelectOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: photoAccessHelper.PhotoSelectResult</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (!result || (result.<span class="hljs-property">photoUris</span> &amp;&amp; result.<span class="hljs-property">photoUris</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>)) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">'Failed to get PhotoSelectResult by promise'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">`Succeeded in getting PhotoSelectResult by promise.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">`Failed to get PhotoSelectResult by promise. Code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>});</li></ol></pre></div></div> </div> </div></div></div> </div> <div class="tiledSection"><h2 id="section9221156204617" device-type="phone,tablet">detectBarcode.decode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9221156204617" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>decode(inputImage: InputImage, options?: scanBarcode.ScanOptions): Promise&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;</p> <p>通过配置参数调用图片识码，使用Promise异步回调返回识码结果。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.1" width="21.61%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.2" width="37.28%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.3" width="14.14%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.4" width="26.97%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.61%"><p>inputImage</p> </td> <td class="cellrowborder" width="37.28%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section2194164873812">InputImage</a></p> </td> <td class="cellrowborder" width="14.14%"><p>是</p> </td> <td class="cellrowborder" width="26.97%"><p>待识别的图片信息。</p> </td> </tr> <tr><td class="cellrowborder" width="21.61%"><p>options</p> </td> <td class="cellrowborder" width="37.28%"><p>scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1285191073117">ScanOptions</a></p> </td> <td class="cellrowborder" width="14.14%"><p>否</p> </td> <td class="cellrowborder" width="26.97%"><p>启动图片识码参数。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.8.2.1.3.1.1" width="43.75%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.8.2.1.3.1.2" width="56.25%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="43.75%"><p>Promise&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;&gt;</p> </td> <td class="cellrowborder" width="56.25%"><p>Promise对象，返回识码结果对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.11.1.3.1.1" width="29.909999999999997%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.11.1.3.1.2" width="70.09%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="29.909999999999997%"><p>401</p> </td> <td class="cellrowborder" width="70.09%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="29.909999999999997%"><p>1000500001</p> </td> <td class="cellrowborder" width="70.09%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { scanCore, scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 定义识码参数options</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = { <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>], <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span> };</li><li><span class="hljs-comment">// 通过picker拉起图库并选择图片</span></li><li><span class="hljs-keyword">let</span> photoOption = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>photoPicker.<span class="hljs-title function_">select</span>(photoOption).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 定义识码参数inputImage，其中uri为picker选择图片</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: result.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>] };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用图片识码接口</span></li><li>    detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by promise with options, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Failed to get ScanResult by promise with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to detect Barcode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">`Failed to get PhotoSelectResult by promise. Code: <span class="hljs-subst">${error.code}</span>.`</span>);</li><li>});</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section12482559194718" device-type="phone,tablet">detectBarcode.decode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section12482559194718" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>decode(inputImage: InputImage, options: scanBarcode.ScanOptions, callback: AsyncCallback&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;): void</p> <p>通过配置参数调用图片识码，使用Callback异步回调返回识码结果。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.1" width="13.378662133786623%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.2" width="44.835516448355165%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.3" width="6.85931406859314%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.5.1.4" width="34.92650734926507%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="13.378662133786623%"><p>inputImage</p> </td> <td class="cellrowborder" width="44.835516448355165%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section2194164873812">InputImage</a></p> </td> <td class="cellrowborder" width="6.85931406859314%"><p>是</p> </td> <td class="cellrowborder" width="34.92650734926507%"><p>待识别的图片信息。</p> </td> </tr> <tr><td class="cellrowborder" width="13.378662133786623%"><p>options</p> </td> <td class="cellrowborder" width="44.835516448355165%"><p>scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1285191073117">ScanOptions</a></p> </td> <td class="cellrowborder" width="6.85931406859314%"><p>是</p> </td> <td class="cellrowborder" width="34.92650734926507%"><p>启动图片识码参数。</p> </td> </tr> <tr><td class="cellrowborder" width="13.378662133786623%"><p>callback</p> </td> <td class="cellrowborder" width="44.835516448355165%"><p>AsyncCallback&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;&gt;</p> </td> <td class="cellrowborder" width="6.85931406859314%"><p>是</p> </td> <td class="cellrowborder" width="34.92650734926507%"><p>回调函数，当图片识码成功，err为undefined，data为获取到的识码结果Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;，否则为错误对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.7.10.1.3.1.1" width="25.05%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.10.1.3.1.2" width="74.95%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="25.05%"><p>401</p> </td> <td class="cellrowborder" width="74.95%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="25.05%"><p>1000500001</p> </td> <td class="cellrowborder" width="74.95%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanCore, scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 定义识码参数options</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = { <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>], <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span> }</li><li><span class="hljs-comment">// 通过选择模式拉起photoPicker界面，用户可以选择一个图片</span></li><li><span class="hljs-keyword">let</span> photoOption = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>photoPicker.<span class="hljs-title function_">select</span>(photoOption).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 定义识码参数inputImage，其中uri为picker选择图片</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: result.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>] };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用图片识码接口</span></li><li>    detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, options, <span class="hljs-function">(<span class="hljs-params">error: BusinessError, result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanResult by callback with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by callback with options, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to detect Barcode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">`Failed to get PhotoSelectResult by promise. Code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>});</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section17256144317492" device-type="phone,tablet">detectBarcode.decode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section17256144317492" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>decode(inputImage: InputImage, callback: AsyncCallback&lt;Array&lt;scanBarcode.ScanResult&gt;&gt;): void</p> <p>图片识码，使用Callback异步回调返回识码结果。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.1" width="17.41%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.2" width="31.39%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.3" width="13.100000000000001%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.4" width="38.1%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.41%"><p>inputImage</p> </td> <td class="cellrowborder" width="31.39%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section2194164873812">InputImage</a></p> </td> <td class="cellrowborder" width="13.100000000000001%"><p>是</p> </td> <td class="cellrowborder" width="38.1%"><p>待识别的图片信息。</p> </td> </tr> <tr><td class="cellrowborder" width="17.41%"><p>callback</p> </td> <td class="cellrowborder" width="31.39%"><p>AsyncCallback&lt;Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;&gt;</p> </td> <td class="cellrowborder" width="13.100000000000001%"><p>是</p> </td> <td class="cellrowborder" width="38.1%"><p>回调函数，当图片识码成功，err为undefined，data为获取到的识码结果Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;，否则为错误对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.1" width="28.02%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.2" width="71.98%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="28.02%"><p>401</p> </td> <td class="cellrowborder" width="71.98%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="28.02%"><p>1000500001</p> </td> <td class="cellrowborder" width="71.98%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 通过picker拉起图库并选择图片</span></li><li><span class="hljs-keyword">let</span> photoOption = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>photoOption.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>photoOption.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>photoPicker.<span class="hljs-title function_">select</span>(photoOption).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> {</li><li>  <span class="hljs-comment">// 定义识码参数inputImage，其中uri为picker选择图片</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: result.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>] };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">// 调用图片识码接口</span></li><li>    detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, <span class="hljs-function">(<span class="hljs-params">error: BusinessError, result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>          <span class="hljs-string">`Failed to get ScanResult by callback. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>        <span class="hljs-string">`Succeeded in getting ScanResult by callback, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>    });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to detect Barcode. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'picker'</span>, <span class="hljs-string">`Failed to get PhotoSelectResult by promise. Code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>});</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section596225419382" device-type="phone,tablet">ByteImage<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section596225419382" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>待识别的图像数据。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.1" width="23.12%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.2" width="23.12%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.3" width="15.590000000000003%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.4" width="15.050000000000002%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.5" width="23.12%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.12%"><p>byteBuffer</p> </td> <td class="cellrowborder" width="23.12%"><p>ArrayBuffer</p> </td> <td class="cellrowborder" width="15.590000000000003%"><p>否</p> </td> <td class="cellrowborder" width="15.050000000000002%"><p>否</p> </td> <td class="cellrowborder" width="23.12%"><p>图像数据。</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>width</p> </td> <td class="cellrowborder" width="23.12%"><p>number</p> </td> <td class="cellrowborder" width="15.590000000000003%"><p>否</p> </td> <td class="cellrowborder" width="15.050000000000002%"><p>否</p> </td> <td class="cellrowborder" width="23.12%"><p>图像宽度，单位：px。</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>height</p> </td> <td class="cellrowborder" width="23.12%"><p>number</p> </td> <td class="cellrowborder" width="15.590000000000003%"><p>否</p> </td> <td class="cellrowborder" width="15.050000000000002%"><p>否</p> </td> <td class="cellrowborder" width="23.12%"><p>图像高度，单位：px。</p> </td> </tr> <tr><td class="cellrowborder" width="23.12%"><p>format</p> </td> <td class="cellrowborder" width="23.12%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section326142720394">ImageFormat</a></p> </td> <td class="cellrowborder" width="15.590000000000003%"><p>否</p> </td> <td class="cellrowborder" width="15.050000000000002%"><p>否</p> </td> <td class="cellrowborder" width="23.12%"><p>图像数据类型。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li>
</li><li><span class="hljs-comment">// YUV图像的buffer, height, width数据，可通过相机预览流数据获取，比如获取宽高是1920*1080时</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">byteImg</span>: detectBarcode.<span class="hljs-property">ByteImage</span> = {</li><li>  <span class="hljs-attr">byteBuffer</span>: buffer,</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span>,</li><li>  <span class="hljs-attr">format</span>: detectBarcode.<span class="hljs-property">ImageFormat</span>.<span class="hljs-property">NV21</span></li><li>};</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section326142720394" device-type="phone,tablet">ImageFormat<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section326142720394" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>枚举，图像数据类型。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.1" width="30%"><p><strong>名称</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.2" width="20%"><p><strong>值</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.3" width="50%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="30%"><p>NV21</p> </td> <td class="cellrowborder" width="20%"><p>0</p> </td> <td class="cellrowborder" width="50%"><p>图像格式为NV21。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section655375703713" device-type="phone,tablet">DetectResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section655375703713" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>识别结果。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.1" width="12.659999999999998%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.2" width="33.58%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.3" width="7.16%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.4" width="6.069999999999999%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.5" width="40.53%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.659999999999998%"><p>scanResults</p> </td> <td class="cellrowborder" width="33.58%"><p>Array&lt;scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section10614317162112">ScanResult</a>&gt;</p> </td> <td class="cellrowborder" width="7.16%"><p>否</p> </td> <td class="cellrowborder" width="6.069999999999999%"><p>否</p> </td> <td class="cellrowborder" width="40.53%"><p>扫码结果。</p> </td> </tr> <tr><td class="cellrowborder" width="12.659999999999998%"><p>zoomValue</p> </td> <td class="cellrowborder" width="33.58%"><p>number</p> </td> <td class="cellrowborder" width="7.16%"><p>否</p> </td> <td class="cellrowborder" width="6.069999999999999%"><p>否</p> </td> <td class="cellrowborder" width="40.53%"><p>相机可变焦距比，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-zoom#setzoomratio11" target="_blank">setZoomRatio</a>控制相机实现变焦功能。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ol><li>使用Camera Kit <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-zoom#getzoomratio11" target="_blank">getZoomRatio</a>接口获取相机当前变焦比zoomRatio。</li><li>使用Camera Kit <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-zoom#setzoomratio11" target="_blank">setZoomRatio</a>接口设置targetRatio，目标值为zoomRatio * zoomValue。</li></ol> </div></div></div> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section387381185013" device-type="phone,tablet">detectBarcode.decodeImage<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section387381185013" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span></div><p>decodeImage(image: ByteImage, options?: scanBarcode.ScanOptions): Promise&lt;DetectResult&gt;</p> <p>通过配置参数调用图像数据识码能力，使用Promise异步回调返回识码结果。</p> <p><strong>系统能力：</strong>SystemCapability.Multimedia.Scan.ScanBarcode</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.1" width="21.007899210078993%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.2" width="40.63593640635936%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.3" width="12.128787121287871%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.4" width="26.22737726227377%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.007899210078993%"><p>image</p> </td> <td class="cellrowborder" width="40.63593640635936%"><p><a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section596225419382">ByteImage</a></p> </td> <td class="cellrowborder" width="12.128787121287871%"><p>是</p> </td> <td class="cellrowborder" width="26.22737726227377%"><p>待识别的图像数据。</p> </td> </tr> <tr><td class="cellrowborder" width="21.007899210078993%"><p>options</p> </td> <td class="cellrowborder" width="40.63593640635936%"><p>scanBarcode.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-scanbarcode-api#section1285191073117">ScanOptions</a></p> </td> <td class="cellrowborder" width="12.128787121287871%"><p>否</p> </td> <td class="cellrowborder" width="26.22737726227377%"><p>启动图像数据识码参数。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>返回值：</strong> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.8.2.1.3.1.1" width="30%"><p><strong>类型</strong></p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.8.2.1.3.1.2" width="70%"><p><strong>说明</strong></p> </th> </tr><tr><td class="cellrowborder" width="30%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/scan-imagedecode#section655375703713">DetectResult</a>&gt;</p> </td> <td class="cellrowborder" width="70%"><p>Promise对象，返回图像数据识码结果对象。</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/scan-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.1" width="28.810000000000002%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.2" width="71.19%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="28.810000000000002%"><p>401</p> </td> <td class="cellrowborder" width="71.19%"><p>Parameter error. Possible causes: 1. Incorrect parameter types; 2. Parameter verification failed.</p> </td> </tr> <tr><td class="cellrowborder" width="28.810000000000002%"><p>1000500001</p> </td> <td class="cellrowborder" width="71.19%"><p>Internal error.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-iys-c106="" class="highlight-div"><div _ngcontent-iys-c106="" class="highlight-div-header"><div _ngcontent-iys-c106="" class="highlight-div-header-left"><div _ngcontent-iys-c106="" class="handle-button expand-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-iys-c106="" class="highlight-div-header-right"><div _ngcontent-iys-c106="" class="handle-button ai-button"></div><div _ngcontent-iys-c106="" class="handle-button line-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-iys-c106="" class="handle-button theme-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-iys-c106="" class="handle-button copy-button"><div _ngcontent-iys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-iys-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { scanCore, scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 优先获取图像的YUVByteBuffer, YUVHeight, YUVWidth数据，比如获取宽高是1920*1080时</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">byteImg</span>: detectBarcode.<span class="hljs-property">ByteImage</span> = {</li><li>  <span class="hljs-attr">byteBuffer</span>: <span class="hljs-title class_">YUVByteBuffer</span>,</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-number">1920</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">1080</span>,</li><li>  <span class="hljs-attr">format</span>: detectBarcode.<span class="hljs-property">ImageFormat</span>.<span class="hljs-property">NV21</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> = {</li><li>  <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>],</li><li>  <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">false</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  detectBarcode.<span class="hljs-title function_">decodeImage</span>(byteImg, options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: detectBarcode.DetectResult</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Succeeded in getting DetectResult by promise with options, result is <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(result)}</span>`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>,</li><li>      <span class="hljs-string">`Failed to get DetectResult by promise with options. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">'[Scan Sample]'</span>, <span class="hljs-string">`Failed to decode Image. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>不支持并行调用。</p> </div></div></div> </div> </div> </div> <div></div></div>