<h1 _ngcontent-wiu-c119="" class="doc-title ng-star-inserted" title="devicePicker (设备选择控制器)"> devicePicker (设备选择控制器) </h1>

<div _ngcontent-wiu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>该模块提供设备选择控制器和设备选择面板的能力。设备选择面板没有对外提供直接显示的接口，需要结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationdevicepicker">CollaborationDevicePicker (流转控件)</a>组件一起使用，点击<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationdevicepicker">CollaborationDevicePicker (流转控件)</a>组件后该面板会自动显示。通过设备选择控制器可以和设备选择面板进行交互，设备选择面板中包括：应用的描述信息和发现的已组网设备列表（当前设备列表中只支持显示已组网的可信设备）。</p> <p>用户点击设备后，会触发设备选择控制器对应的接口回调，并返回已选择的设备信息；应用可以通过获取到的设备信息处理分布式业务，比如通过startAbility启动远端UIAbility；待启动远端ability成功后，可以通过<a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section1543619272133">updateState</a>接口更新业务状态，界面上将会显示指定的状态。</p> <p><strong>起始版本：</strong>4.0.0(10)</p> <div class="tiledSection"><h2 id="section16609101116259" device-type="phone,2in1,tablet,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section16609101116259" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="typescipt prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { devicePicker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section43691981888" device-type="phone,2in1,tablet,tv">DeviceEvent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section43691981888" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>type DeviceEvent = 'deviceSelected' | 'deviceUnselected' | 'selectedDeviceOffline'</p> <p>设备事件类型，支持设备选择事件、设备取消事件、已选择设备的下线事件。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.1" width="25.779999999999998%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.3.1.2" width="74.22%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="25.779999999999998%"><p>'deviceSelected'</p> </td> <td class="cellrowborder" width="74.22%"><p>设备选择事件。</p> <p>当设备处于空闲状态时，点击设备会触发该事件。</p> </td> </tr> <tr><td class="cellrowborder" width="25.779999999999998%"><p>'deviceUnselected'</p> </td> <td class="cellrowborder" width="74.22%"><p>设备取消选择事件。</p> <p>当设备处于成功状态时，点击该设备会触发该事件；在设备A处于成功状态时，点击设备B也会触发设备A的deviceUnselected事件。</p> </td> </tr> <tr><td class="cellrowborder" width="25.779999999999998%"><p>'selectedDeviceOffline'</p> </td> <td class="cellrowborder" width="74.22%"><p>已选择设备的下线事件。</p> <p>当已经处于成功状态的设备下线后，会触发该事件。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section25961963517" device-type="phone,2in1,tablet,tv">createDevicePickerController<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section25961963517" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p><span style="color: rgb(73,73,73);">createDevicePickerController(): DevicePickerController</span></p> <p>创建设备选择控制器，通过该控制器提供的接口可以与设备选择面板进行交互。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p class="typescript"><strong>起始版本：</strong>4.0.0(10)</p> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.7.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p><a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section132821135550">DevicePickerController</a></p> </td> <td class="cellrowborder" width="50%"><p>返回设备选择控制器实例，可以与流转控件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationdevicepicker">CollaborationDevicePicker (流转控件)</a>配合使用。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">devicePicker</span>, <span class="hljs-variable">CollaborationDevicePicker</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span></li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">devicePicker</span>.<span class="hljs-title class_">DevicePickerController</span> = <span class="hljs-variable">devicePicker</span>.<span class="hljs-title function_">createDevicePickerController</span>()</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-comment">// 流转控件，应用流转的入口</span></li><li>      <span class="hljs-title function_">CollaborationDevicePicker</span>({</li><li>        <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span>, <span class="hljs-variable">attribute</span>: {</li><li>          <span class="hljs-variable">abilityName</span>: <span class="hljs-string">'流转测试'</span>,</li><li>          <span class="hljs-variable">abilityDesc</span>: <span class="hljs-string">'这是一个流转测试的控件'</span>,</li><li>          <span class="hljs-variable">abilityIcon</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">sys</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">ohos_app_icon</span>'),</li><li>          <span class="hljs-variable">businessDesc</span>: <span class="hljs-string">'流转到'</span></li><li>        }</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section132821135550" device-type="phone,2in1,tablet,tv">DevicePickerController<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section132821135550" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p><span style="color: rgb(73,73,73);">DevicePickerController类提供了与设备选择面板交互的接口。</span></p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> </div> <div class="tiledSection"><h3 id="section1476010417818" device-type="phone,2in1,tablet,tv" class="firsth2">on('deviceSelected' | 'deviceUnselected' | 'selectedDeviceOffline')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1476010417818" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>on(event: DeviceEvent, callback: Callback&lt;distributedDeviceManager.DeviceBasicInfo&gt;): void</p> <p>注册设备相关的事件回调，目前支持：设备选择、设备取消选择、已选择设备的下线事件。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.1" width="13.84%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.2" width="17.83%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.3" width="7.049999999999999%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.5.1.4" width="61.28%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="13.84%"><p>event</p> </td> <td class="cellrowborder" width="17.83%"><p><a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section43691981888">DeviceEvent</a></p> </td> <td class="cellrowborder" width="7.049999999999999%"><p>是</p> </td> <td class="cellrowborder" width="61.28%"><p>设备相关的事件，目前支持：设备选择、设备取消选择、已选择设备的下线事件。</p> </td> </tr> <tr><td class="cellrowborder" width="13.84%"><p>callback</p> </td> <td class="cellrowborder" width="17.83%"><p>Callback&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#devicebasicinfo" target="_blank">distributedDeviceManager.DeviceBasicInfo</a>&gt;</p> </td> <td class="cellrowborder" width="7.049999999999999%"><p>是</p> </td> <td class="cellrowborder" width="61.28%"><p>返回发生对应事件的设备信息，可以在callback中使用返回的设备信息进行跨设备应用ability组件启动。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">common</span><span class="">, </span><span class=""><span class="hljs-title class_">Want</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-title class_">CollaborationDevicePicker</span></span><span class="">, </span><span class="">devicePicker </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.ServiceCollaborationKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">distributedDeviceManager </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.DistributedServiceKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span></li><li>
</li><li><span class=""><span class="hljs-meta">@Entry</span></span></li><li><span class=""><span class="hljs-meta">@Component</span></span></li><li>struct <span class=""><span class="hljs-title class_">CustomControls</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">创建设备选择控制器</span></span></li><li>  <span class=""><span class="hljs-attr">controller</span></span><span class="">: </span><span class="">devicePicker</span><span class="">.</span><span class=""><span class="hljs-property">DevicePickerController</span> </span><span class="">= </span><span class="">devicePicker</span><span class="">.</span><span class=""><span class="hljs-title function_">createDevicePickerController</span></span><span class="">()</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">获取所属</span></span><span class=""><span class="hljs-comment">ability</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">context</span></span></li><li><span class="">  <span class="hljs-attr">context</span></span><span class="">: </span><span class="">common</span><span class="">.</span><span class=""><span class="hljs-property">UIAbilityContext</span> </span><span class="">= </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getHostContext</span></span><span class="">() </span><span class="hljs-keyword">as</span> <span class="">common</span><span class="">.</span><span class=""><span class="hljs-property">UIAbilityContext</span></span></li><li><span class="">  <span class="hljs-attr">abilityId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">number</span> </span><span class="">= </span><span class=""><span class="hljs-number">0</span></span></li><li>
</li><li>  <span class=""><span class="hljs-title function_">aboutToAppear</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">注册设备选择事件</span></span></li><li>    <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'deviceSelected'</span></span><span class="">, </span><span class=""><span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">device</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">distributedDeviceManager</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">DeviceBasicInfo</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">want</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Want</span> </span><span class="">= </span><span class="">{</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">通过</span></span><span class=""><span class="hljs-comment">device</span></span><span class=""><span class="hljs-comment">获取设备的</span></span><span class=""><span class="hljs-comment">id</span></span></li><li>        <span class=""><span class="hljs-attr">deviceId</span></span><span class="">: </span><span class="">device</span><span class="">.</span><span class=""><span class="hljs-property">networkId</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">此处</span></span><span class=""><span class="hljs-comment">bundleName</span></span><span class=""><span class="hljs-comment">和</span></span><span class=""><span class="hljs-comment">abilityName</span></span><span class=""><span class="hljs-comment">是示例，实际使用必须传递远端设备真实存在的</span></span><span class=""><span class="hljs-comment">bundleName</span></span><span class=""><span class="hljs-comment">和</span></span><span class=""><span class="hljs-comment">abilityName</span></span><span class=""><span class="hljs-comment">才能拉起指定服务</span></span></li><li>        <span class=""><span class="hljs-attr">bundleName</span></span><span class="">: </span><span class=""><span class="hljs-string">'com.example.myapplication'</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'ExtensionAbility'</span></span></li><li>      <span class="">}</span></li><li>      <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span><span class="">(</span><span class="">{ </span><span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'device selected'</span> </span><span class="">}</span><span class="">)</span></li><li>      <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">context</span></span><span class="">.</span><span class=""><span class="hljs-title function_">startAbility</span></span><span class="">(</span><span class="">want</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>        <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in starting Ability'</span></span><span class="">)</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">更新设备状态</span></span></li><li>        <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">updateState</span></span><span class="">(</span><span class="">device</span><span class="">.</span><span class=""><span class="hljs-property">networkId</span></span><span class="">, </span><span class="">devicePicker</span><span class="">.</span><span class=""><span class="hljs-property">BusinessState</span></span><span class="">.</span><span class=""><span class="hljs-property">SUCCESSFUL</span></span><span class="">)</span></li><li>      <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>        <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Failed to startAbility'</span></span><span class="">)</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">更新设备状态，同时添加失败的原因，这个原因会展示在设备下方</span></span></li><li>        <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">updateState</span></span><span class="">(</span><span class="">device</span><span class="">.</span><span class=""><span class="hljs-property">networkId</span></span><span class="">, </span><span class="">devicePicker</span><span class="">.</span><span class=""><span class="hljs-property">BusinessState</span></span><span class="">.</span><span class=""><span class="hljs-property">FAILED</span></span><span class="">, </span><span class=""><span class="hljs-string">'the remote device is busy'</span></span><span class="">)</span></li><li>      <span class="">}</span><span class="">)</span></li><li>    <span class="">}</span><span class="">)</span></li><li>
</li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">注册设备取消选择事件</span></span></li><li>    <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'deviceUnselected'</span></span><span class="">, </span><span class=""><span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">device</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">distributedDeviceManager</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">DeviceBasicInfo</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span><span class="">(</span><span class="">{ </span><span class=""><span class="hljs-attr">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'device unselected'</span> </span><span class="">}</span><span class="">)</span></li><li>    <span class="">}</span><span class="">)</span></li><li>  <span class="">}</span></li><li>
</li><li>  <span class=""><span class="hljs-title function_">build</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>    <span class=""><span class="hljs-title class_">Column</span></span><span class="">() </span><span class="">{</span></li><li>      <span class=""><span class="hljs-title class_">CollaborationDevicePicker</span></span><span class="">(</span><span class="">{</span></li><li>        <span class=""><span class="hljs-attr">controller</span></span><span class="">: </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">controller</span></span><span class="">, </span><span class=""><span class="hljs-attr">attribute</span></span><span class="">: </span><span class="">{</span></li><li>          <span class=""><span class="hljs-attr">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">流转测试</span></span><span class=""><span class="hljs-string">'</span></span><span class="">,</span></li><li>          <span class=""><span class="hljs-attr">abilityDesc</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">这是一个流转测试的控件</span></span><span class=""><span class="hljs-string">'</span></span><span class="">,</span></li><li>          <span class=""><span class="hljs-attr">abilityIcon</span></span><span class="">: </span><span class="">$r</span><span class="">(</span><span class=""><span class="hljs-string">'sys.media.ohos_app_icon'</span></span><span class="">)</span><span class="">,</span></li><li>          <span class=""><span class="hljs-attr">businessDesc</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">流转到</span></span><span class=""><span class="hljs-string">'</span></span></li><li>        <span class="">}</span></li><li><span class="">      }</span><span class="">)</span></li><li>    <span class="">}</span><span class="">.</span><span class=""><span class="hljs-title function_">width</span></span><span class="">(</span><span class=""><span class="hljs-string">'100%'</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">alignItems</span></span><span class="">(</span><span class=""><span class="hljs-title class_">HorizontalAlign</span></span><span class="">.</span><span class=""><span class="hljs-property">Center</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table><tbody><tr><td class="cellrowborder" width="46.35%"><div class="fignone"><span class="figcap"><b>图1 </b>设备空闲状态效果图（下图中my phone处于空闲状态，点击该设备后会触发deviceSelected事件）</span><br><span><img originheight="237" originwidth="315" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.26860138619703639883522470630310:50001231000000:2800:9A31EEB559E7403BB8936E1563530E86743A62AD5AFBA76EA334C6154BA321D5.png" width="315" height="237"></span></div> </td> <td class="cellrowborder" width="53.65%"><div class="fignone"><span class="figcap"><b>图2 </b>设备成功状态效果图（下图中my phone处于成功状态，点击该设备后会触发deviceUnselected事件）</span><br><span><img originheight="237" originwidth="312" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.89055779773387907528894015505427:50001231000000:2800:13689E2E19B69425AE28726B2A3BED4279CE14DE2C25DAA877EDDFC53FE16BD6.png" width="312" height="237"></span></div> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1490814165617" device-type="phone,2in1,tablet,tv">off('deviceSelected' | 'deviceUnselected' | 'selectedDeviceOffline')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1490814165617" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>off(event: DeviceEvent, callback?: Callback&lt;distributedDeviceManager.DeviceBasicInfo&gt;): void</p> <p>取消注册设备相关的事件回调，目前支持的事件：设备选择、设备取消选择、已选择设备的下线事件。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.1" width="15.229999999999999%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.2" width="24.48%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.3" width="10.63%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.5.1.4" width="49.66%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="15.229999999999999%"><p>event</p> </td> <td class="cellrowborder" width="24.48%"><p><a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section43691981888">DeviceEvent</a></p> </td> <td class="cellrowborder" width="10.63%"><p>是</p> </td> <td class="cellrowborder" width="49.66%"><p>设备相关的事件，目前支持：设备选择、设备取消选择、已选择设备的下线事件。</p> </td> </tr> <tr><td class="cellrowborder" width="15.229999999999999%"><p>callback</p> </td> <td class="cellrowborder" width="24.48%"><p>Callback&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#devicebasicinfo" target="_blank">distributedDeviceManager.DeviceBasicInfo</a>&gt;</p> </td> <td class="cellrowborder" width="10.63%"><p>否</p> </td> <td class="cellrowborder" width="49.66%"><p>返回发生指定事件的设备信息，与<a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section1476010417818">on('deviceSelected' | 'deviceUnselected' | 'selectedDeviceOffline')</a>接口对应，可以在不需要监听设备事件的位置进行取消。比如在组件生命周期的aboutToAppear()调用了on注册接口，则可以在页面aboutToDisappear()调用off取消注册。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">common</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">distributedDeviceManager</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">CollaborationDevicePicker</span>, <span class="hljs-variable">devicePicker</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span></li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">CustomControls</span> {</li><li>  <span class="hljs-comment">// 创建设备选择控制器</span></li><li>  <span class="hljs-variable">controller</span>: <span class="hljs-title class_">devicePicker</span>.<span class="hljs-title class_">DevicePickerController</span> = <span class="hljs-variable">devicePicker</span>.<span class="hljs-title function_">createDevicePickerController</span>()</li><li>  <span class="hljs-comment">// 获取所属ability的context</span></li><li><span class="">  <span class="hljs-variable">context</span></span><span class="">: </span><span class=""><span class="hljs-title class_">common</span></span><span class="">.</span><span class=""><span class="hljs-title class_">UIAbilityContext</span> </span><span class="">= </span><span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getHostContext</span></span><span class="">() </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">common</span></span><span class="">.</span><span class=""><span class="hljs-variable">UIAbilityContext</span></span></li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>() {</li><li>    <span class="hljs-comment">// 取消注册设备选择事件</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'deviceSelected'</span>, (<span class="hljs-variable">device</span>: <span class="hljs-title class_">distributedDeviceManager</span>.<span class="hljs-title class_">DeviceBasicInfo</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span>({ <span class="hljs-variable">message</span>: <span class="hljs-string">'off device selected'</span> })</li><li>    })</li><li>
</li><li>    <span class="hljs-comment">// 取消注册设备取消选择事件</span></li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-variable">controller</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'deviceUnselected'</span>, (<span class="hljs-variable">device</span>: <span class="hljs-title class_">distributedDeviceManager</span>.<span class="hljs-title class_">DeviceBasicInfo</span>) =&gt; {</li><li>      <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span>({ <span class="hljs-variable">message</span>: <span class="hljs-string">'device unselected'</span> })</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Column</span>() {</li><li>      <span class="hljs-title function_">CollaborationDevicePicker</span>({</li><li>        <span class="hljs-variable">controller</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">controller</span>, <span class="hljs-variable">attribute</span>: {</li><li>          <span class="hljs-variable">abilityName</span>: <span class="hljs-string">'流转测试'</span>,</li><li>          <span class="hljs-variable">abilityDesc</span>: <span class="hljs-string">'这是一个流转测试的控件'</span>,</li><li>          <span class="hljs-variable">abilityIcon</span>: $<span class="hljs-title class_">r</span>('<span class="hljs-title class_">sys</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">ohos_app_icon</span>'),</li><li>          <span class="hljs-variable">businessDesc</span>: <span class="hljs-string">'流转到'</span></li><li>        }</li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">alignItems</span>(<span class="hljs-variable">HorizontalAlign</span>.<span class="hljs-variable">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section1543619272133" device-type="phone,2in1,tablet,tv">updateState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1543619272133" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p><span style="color: rgb(73,73,73);">updateState(networkId: string, state: BusinessState, desc?: ResourceStr): void</span></p> <p>更新设备的业务状态，在设备选择面板上会显示更新后的状态。业务失败情况下，可以传入失败的描述信息，会随着状态一起显示。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.1" width="19.2%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.2" width="25.09%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.3" width="10.489999999999998%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.7.1.5.1.4" width="45.22%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="19.2%"><p><span style="color: rgb(73,73,73);">networkId</span></p> </td> <td class="cellrowborder" width="25.09%"><p><span style="color: rgb(73,73,73);">string</span></p> </td> <td class="cellrowborder" width="10.489999999999998%"><p>是</p> </td> <td class="cellrowborder" width="45.22%"><p>设备的networkId信息。</p> </td> </tr> <tr><td class="cellrowborder" width="19.2%"><p><span style="color: rgb(73,73,73);">state</span></p> </td> <td class="cellrowborder" width="25.09%"><p><a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section843420618418">BusinessState</a></p> </td> <td class="cellrowborder" width="10.489999999999998%"><p>是</p> </td> <td class="cellrowborder" width="45.22%"><p>业务状态，当前支持IDLE、SUCCESSFUL、FAILED三种状态类型。</p> </td> </tr> <tr><td class="cellrowborder" width="19.2%"><p>desc</p> </td> <td class="cellrowborder" width="25.09%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a></p> </td> <td class="cellrowborder" width="10.489999999999998%"><p>否</p> </td> <td class="cellrowborder" width="45.22%"><p>导致业务失败的具体描述信息。在业务失败情况下，可以传入该参数，会将该信息显示在指定设备名字下方。长度限制1-128。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">common</span></span><span class="">, </span><span class=""><span class="hljs-variable">Want</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">CollaborationDevicePicker</span></span><span class="">, </span><span class=""><span class="hljs-variable">devicePicker</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.ServiceCollaborationKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">distributedDeviceManager</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.DistributedServiceKit'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">hilog</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span></li><li>
</li><li><span class="">@<span class="hljs-title function_">Entry</span></span></li><li><span class="">@<span class="hljs-title function_">Component</span></span></li><li><span class="hljs-keyword">struct</span> <span class=""><span class="hljs-title class_">CustomControls</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">创建设备选择控制器</span></span></li><li>  <span class=""><span class="hljs-variable">controller</span></span><span class="">: </span><span class=""><span class="hljs-title class_">devicePicker</span></span><span class="">.</span><span class=""><span class="hljs-title class_">DevicePickerController</span> </span><span class="">= </span><span class=""><span class="hljs-variable">devicePicker</span></span><span class="">.</span><span class=""><span class="hljs-title function_">createDevicePickerController</span></span><span class="">()</span></li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">获取所属</span></span><span class=""><span class="hljs-comment">ability</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">context</span></span></li><li><span class="">  <span class="hljs-variable">context</span></span><span class="">: </span><span class=""><span class="hljs-title class_">common</span></span><span class="">.</span><span class=""><span class="hljs-title class_">UIAbilityContext</span> </span><span class="">= </span><span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getHostContext</span></span><span class="">() </span><span class="hljs-keyword">as</span> <span class=""><span class="hljs-variable">common</span></span><span class="">.</span><span class=""><span class="hljs-variable">UIAbilityContext</span></span></li><li><span class="">  <span class="hljs-variable">abilityId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">number</span> </span><span class="">= </span><span class=""><span class="hljs-number">0</span></span></li><li>
</li><li>  <span class=""><span class="hljs-title function_">aboutToAppear</span></span><span class="">() </span><span class="">{</span></li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">注册设备选择事件</span></span></li><li>    <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'deviceSelected'</span></span><span class="">, </span><span class="">(</span><span class=""><span class="hljs-variable">device</span></span><span class="">: </span><span class=""><span class="hljs-title class_">distributedDeviceManager</span></span><span class="">.</span><span class=""><span class="hljs-title class_">DeviceBasicInfo</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">want</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Want</span> </span><span class="">= </span><span class="">{</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">通过</span></span><span class=""><span class="hljs-comment">device</span></span><span class=""><span class="hljs-comment">获取设备的</span></span><span class=""><span class="hljs-comment">id</span></span></li><li>        <span class=""><span class="hljs-variable">deviceId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">device</span></span><span class="">.</span><span class=""><span class="hljs-title class_">networkId</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">此处</span></span><span class=""><span class="hljs-comment">bundleName</span></span><span class=""><span class="hljs-comment">和</span></span><span class=""><span class="hljs-comment">abilityName</span></span><span class=""><span class="hljs-comment">是示例，实际使用必须传递远端设备真实存在的</span></span><span class=""><span class="hljs-comment">bundleName</span></span><span class=""><span class="hljs-comment">和</span></span><span class=""><span class="hljs-comment">abilityName</span></span><span class=""><span class="hljs-comment">才能拉起指定服务</span></span></li><li>        <span class=""><span class="hljs-variable">bundleName</span></span><span class="">: </span><span class=""><span class="hljs-string">'com.example.myapplication'</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'ExtensionAbility'</span></span></li><li>      <span class="">}</span></li><li>      <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span><span class="">(</span><span class="">{ </span><span class=""><span class="hljs-variable">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'device selected'</span> </span><span class="">}</span><span class="">)</span></li><li>      <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">context</span></span><span class="">.</span><span class=""><span class="hljs-title function_">startAbility</span></span><span class="">(</span><span class=""><span class="hljs-variable">want</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in starting Ability'</span></span><span class="">)</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">更新设备状态</span></span></li><li>        <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">updateState</span></span><span class="">(</span><span class=""><span class="hljs-variable">device</span></span><span class="">.</span><span class=""><span class="hljs-variable">networkId</span></span><span class="">, </span><span class=""><span class="hljs-variable">devicePicker</span></span><span class="">.</span><span class=""><span class="hljs-variable">BusinessState</span></span><span class="">.</span><span class=""><span class="hljs-variable">SUCCESSFUL</span></span><span class="">)</span></li><li>      <span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-keyword">catch</span></span><span class="">(() </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'%{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Failed to startAbility'</span></span><span class="">)</span></li><li>        <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">更新设备状态，同时添加失败的原因，这个原因会展示在设备下方</span></span></li><li>        <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">updateState</span></span><span class="">(</span><span class=""><span class="hljs-variable">device</span></span><span class="">.</span><span class=""><span class="hljs-variable">networkId</span></span><span class="">, </span><span class=""><span class="hljs-variable">devicePicker</span></span><span class="">.</span><span class=""><span class="hljs-variable">BusinessState</span></span><span class="">.</span><span class=""><span class="hljs-variable">FAILED</span></span><span class="">, </span><span class=""><span class="hljs-string">'the remote device is busy'</span></span><span class="">)</span></li><li>      <span class="">}</span><span class="">)</span></li><li>    <span class="">}</span><span class="">)</span></li><li>
</li><li>    <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">注册设备取消选择事件</span></span></li><li>    <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">controller</span></span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'deviceUnselected'</span></span><span class="">, </span><span class="">(</span><span class=""><span class="hljs-variable">device</span></span><span class="">: </span><span class=""><span class="hljs-title class_">distributedDeviceManager</span></span><span class="">.</span><span class=""><span class="hljs-title class_">DeviceBasicInfo</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title function_">getUIContext</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">getPromptAction</span></span><span class="">()</span><span class="">.</span><span class=""><span class="hljs-title function_">showToast</span></span><span class="">(</span><span class="">{ </span><span class=""><span class="hljs-variable">message</span></span><span class="">: </span><span class=""><span class="hljs-string">'device unselected'</span> </span><span class="">}</span><span class="">)</span></li><li>    <span class="">}</span><span class="">)</span></li><li>  <span class="">}</span></li><li>
</li><li>  <span class=""><span class="hljs-title function_">build</span></span><span class="">() </span><span class="">{</span></li><li>    <span class=""><span class="hljs-title function_">Column</span></span><span class="">() </span><span class="">{</span></li><li>      <span class=""><span class="hljs-title function_">CollaborationDevicePicker</span></span><span class="">(</span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">controller</span></span><span class="">: </span><span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-title class_">controller</span></span><span class="">, </span><span class=""><span class="hljs-variable">attribute</span></span><span class="">: </span><span class="">{</span></li><li>          <span class=""><span class="hljs-variable">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">流转测试</span></span><span class=""><span class="hljs-string">'</span></span><span class="">,</span></li><li>          <span class=""><span class="hljs-variable">abilityDesc</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">这是一个流转测试的控件</span></span><span class=""><span class="hljs-string">'</span></span><span class="">,</span></li><li>          <span class=""><span class="hljs-variable">abilityIcon</span></span><span class="">: </span><span class="">$<span class="hljs-title class_">r</span></span><span class="">(</span><span class="">'<span class="hljs-title class_">sys</span>.<span class="hljs-title class_">media</span>.<span class="hljs-title class_">ohos_app_icon</span>'</span><span class="">)</span><span class="">,</span></li><li>          <span class=""><span class="hljs-variable">businessDesc</span></span><span class="">: </span><span class=""><span class="hljs-string">'</span></span><span class=""><span class="hljs-string">流转到</span></span><span class=""><span class="hljs-string">'</span></span></li><li>        <span class="">}</span></li><li><span class="">      }</span><span class="">)</span></li><li>    <span class="">}</span><span class="">.</span><span class=""><span class="hljs-title function_">width</span></span><span class="">(</span><span class=""><span class="hljs-string">'100%'</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">alignItems</span></span><span class="">(</span><span class=""><span class="hljs-variable">HorizontalAlign</span></span><span class="">.</span><span class=""><span class="hljs-variable">Center</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table><tbody><tr><td class="cellrowborder" width="24.417558244175584%"><div class="fignone"><span class="figcap"><b>图3 </b>设备流转过程效果图（下图中my phone处于流转中，设备名称右侧会有流转过程动画）：</span><br><span><img height="148.3163450242562" originheight="428" originwidth="579" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.06389834780880340598840362583634:50001231000000:2800:5F67A093A084EA421F30E9784C99E4EB52DED2BEC2FA05718BA248F893478CFF.png" title="点击放大" width="200.6415358464154"></span></div> </td> <td class="cellrowborder" width="25.187481251874814%"><div class="fignone"><span class="figcap"><b>图4 </b>设备流转成功效果图（下图中my phone流转成功）：</span><br><span><img height="157.79656855917207" originheight="237" originwidth="312" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.42539986677951671854101726220488:50001231000000:2800:E478D87F8AF54CE86EA00C8E1CD1E3BD30BC6048FC8B3F279231EDBB8C8227B9.png" title="点击放大" width="207.72482751724831"></span></div> </td> <td class="cellrowborder" width="22.64773522647735%"><div class="fignone"><span class="figcap"><b>图5 </b>设备流转失败效果图（下图中my phone流转失败，失败原因是对端设备忙）：</span><br><span><img height="142.0154488551145" originheight="446" originwidth="579" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.52353967496153260133536873441993:50001231000000:2800:7DA3F05D415885420E0231E366B6951957DC409C9FC21A99E30453EC711F208F.png" title="点击放大" width="184.35916408359165"></span></div> </td> <td class="cellrowborder" width="27.747225277472253%"><div class="fignone"><span class="figcap"><b>图6 </b>应用描述信息效果图（在设备选择面板的最上方显示应用的相关信息，包括应用图标、应用名称、应用描述信息）</span><br><span><img height="144.83642911811384" originheight="362" originwidth="578" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115952.15335122425372569599172178289628:50001231000000:2800:DF8F5CE978ECFE7D978BD6D3D93B0B61243D08A75C9C99DA721ED32EB2A15F3F.png" title="点击放大" width="231.27447255274473"></span></div> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section182420295917" device-type="phone,2in1,tablet,tv">release<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section182420295917" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p><span style="color: rgb(73,73,73);">release(): void</span></p> <p>释放设备选择控制器，与<a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section25961963517">createDevicePickerController</a><span style="color: rgb(73,73,73);">方法对应</span>。</p> <p>在应用不需要设备选择控制器的时候需要调用release()接口进行释放，比如在应用onCreate()生命周期回调中通过<a href="/consumer/cn/doc/harmonyos-references/servicecollaboration-devicepicker#section25961963517">createDevicePickerController</a><span style="color: rgb(73,73,73);">创建了设备选择控制器，可以在</span>onDestroy()生命周期回调中通过release()进行释放。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> <p><strong>示例：</strong></p> <div _ngcontent-wiu-c106="" class="highlight-div"><div _ngcontent-wiu-c106="" class="highlight-div-header"><div _ngcontent-wiu-c106="" class="highlight-div-header-left"><div _ngcontent-wiu-c106="" class="handle-button expand-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wiu-c106="" class="highlight-div-header-right"><div _ngcontent-wiu-c106="" class="handle-button ai-button"></div><div _ngcontent-wiu-c106="" class="handle-button line-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wiu-c106="" class="handle-button theme-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wiu-c106="" class="handle-button copy-button"><div _ngcontent-wiu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wiu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span></li><li><span class="hljs-keyword">import</span> { devicePicker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ServiceCollaborationKit'</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// 创建设备选择控制器</span></li><li>  <span class="hljs-attr">controller</span>: devicePicker.<span class="hljs-property">DevicePickerController</span> = devicePicker.<span class="hljs-title function_">createDevicePickerController</span>()</li><li>
</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"></span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onDestroy'</span>)</li><li>    <span class="hljs-comment">// 释放设备选择控制器</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">release</span>()</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section13112135131715" device-type="phone,2in1,tablet,tv">DevicePickerAttribute<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section13112135131715" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>设备选择器属性类，在设备选择面板的应用描述部分会显示该属性配置的信息；如果未设置则使用调用者对应的ability配置文件中的标签信息。该属性与流转组件接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/servicecollaboration-collaborationdevicepicker">CollaborationDevicePicker</a>配合使用。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p> </div>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.1.6.1.1" width="17.76%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.1.6.1.2" width="23.22%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.1.6.1.3" width="7.5200000000000005%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.1.6.1.4" width="9.68%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.1.6.1.5" width="41.82%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.76%"><p><span style="color: rgb(73,73,73);">abilityIcon</span></p> </td> <td class="cellrowborder" width="23.22%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="9.68%"><p>是</p> </td> <td class="cellrowborder" width="41.82%"><p><span style="color: rgb(73,73,73);">ability对用户显示的</span><span style="color: rgb(73,73,73);">图标，在设备选择面板的应用描述部分显示；如果不设置该属性，</span><span style="color: rgb(73,73,73);">默认使用</span><span style="color: rgb(73,73,73);">module.json5</span><span style="color: rgb(73,73,73);">中的</span><span style="color: rgb(73,73,73);">icon</span><span style="color: rgb(73,73,73);">标签配置。</span></p> </td> </tr> <tr><td class="cellrowborder" width="17.76%"><p><span style="color: rgb(73,73,73);">abilityName</span></p> </td> <td class="cellrowborder" width="23.22%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="9.68%"><p>是</p> </td> <td class="cellrowborder" width="41.82%"><p>ability对用户显示的名称，<span style="color: rgb(73,73,73);">在设备选择面板的应用描述部分显示</span>；<span style="color: rgb(73,73,73);">如果不设置该属性，</span>默认使用module.json5中的label标签配置。</p> </td> </tr> <tr><td class="cellrowborder" width="17.76%"><p><span style="color: rgb(73,73,73);">abilityDesc</span></p> </td> <td class="cellrowborder" width="23.22%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="9.68%"><p>是</p> </td> <td class="cellrowborder" width="41.82%"><p>ability的描述信息，<span style="color: rgb(73,73,73);">在设备选择面板的应用描述部分显示</span>；<span style="color: rgb(73,73,73);">如果不设置该属性，</span>默认使用module.json5中的description标签配置。</p> </td> </tr> <tr><td class="cellrowborder" width="17.76%"><p><span style="color: rgb(73,73,73);">businessDesc</span></p> </td> <td class="cellrowborder" width="23.22%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>否</p> </td> <td class="cellrowborder" width="9.68%"><p>是</p> </td> <td class="cellrowborder" width="41.82%"><p><span style="color: rgb(73,73,73);">分布式业务描述信息，比如流转业务：“流转到”</span><span style="color: rgb(73,73,73);">，投屏业务</span><span style="color: rgb(73,73,73);">：“投屏到”</span>；<span style="color: rgb(73,73,73);">如果不设置该属性，对于流转业务默认使用“流转到”</span>。</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h2 id="section843420618418" device-type="phone,2in1,tablet,tv">BusinessState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section843420618418" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>业务状态枚举类。</p> <p><strong>系统能力：</strong>SystemCapability.Collaboration.DevicePicker</p> <p><strong>起始版本：</strong>4.0.0(10)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.5.1.4.1.1" width="21.447855214478555%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.5.1.4.1.2" width="28.047195280471954%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.5.1.4.1.3" width="50.50494950504949%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.447855214478555%"><p>IDLE</p> </td> <td class="cellrowborder" width="28.047195280471954%"><p><span style="color: rgb(73,73,73);">0</span></p> </td> <td class="cellrowborder" width="50.50494950504949%"><p>业务空闲状态。</p> </td> </tr> <tr><td class="cellrowborder" width="21.447855214478555%"><p>SUCCESSFUL</p> </td> <td class="cellrowborder" width="28.047195280471954%"><p>1</p> </td> <td class="cellrowborder" width="50.50494950504949%"><p>业务成功状态。</p> </td> </tr> <tr><td class="cellrowborder" width="21.447855214478555%"><p><span style="color: rgb(73,73,73);">FAILED</span></p> </td> <td class="cellrowborder" width="28.047195280471954%"><p>2</p> </td> <td class="cellrowborder" width="50.50494950504949%"><p>业务失败状态。</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>