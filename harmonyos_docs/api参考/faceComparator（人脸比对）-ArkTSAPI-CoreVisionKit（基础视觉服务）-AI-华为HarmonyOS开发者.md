<h1 _ngcontent-slb-c119="" class="doc-title ng-star-inserted" title="faceComparator（人脸比对）"> faceComparator（人脸比对） </h1>

<div _ngcontent-slb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>识别人脸，对人像进行高精度比对，给出置信度分数，判断对象是否为同一个人。人脸比对技术可应用于实现对图库照片的智能分类管理等场景中。基于领先的端侧智能图像识别算法，对人脸识别准确度高，让应用体验更好。</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <div class="tiledSection">     <h2 id="section864718316137" device-type="phone,2in1,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section864718316137" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-slb-c106="" class="highlight-div"><div _ngcontent-slb-c106="" class="highlight-div-header"><div _ngcontent-slb-c106="" class="highlight-div-header-left"><div _ngcontent-slb-c106="" class="handle-button expand-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-slb-c106="" class="highlight-div-header-right"><div _ngcontent-slb-c106="" class="handle-button ai-button"></div><div _ngcontent-slb-c106="" class="handle-button line-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-slb-c106="" class="handle-button theme-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-slb-c106="" class="handle-button copy-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-slb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { faceComparator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section674171818172" device-type="phone,2in1,tablet">VisionInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section674171818172" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>待识别的视觉信息，目前仅支持颜色数据格式为RGBA_8888的PixelMap类型的视觉信息。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Face.Comparator</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.1" width="17.07%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.2" width="17.43%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.4" width="15.920000000000002%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.5" width="38.129999999999995%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.07%">          <p>pixelMap</p></td>         <td class="cellrowborder" width="17.43%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">image.PixelMap</a></p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>是</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>待识别的图片。</p>          <p>具体规格请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/core-vision-introduction#section625292610522" target="_blank">约束与限制</a>。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1518613358392" device-type="phone,2in1,tablet">FaceCompareResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1518613358392" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>人脸比对的结果。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Face.Comparator</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="17.07%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="17.43%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="11.24%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="42.809999999999995%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.07%">          <p>isSamePerson</p></td>         <td class="cellrowborder" width="17.43%">          <p>boolean</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>是</p></td>         <td class="cellrowborder" width="11.24%">          <p>否</p></td>         <td class="cellrowborder" width="42.809999999999995%">          <p>是否是同一个人，true代表为同一个人，false不是同一个人。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>similarity</p></td>         <td class="cellrowborder" width="17.43%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>是</p></td>         <td class="cellrowborder" width="11.24%">          <p>否</p></td>         <td class="cellrowborder" width="42.809999999999995%">          <p>相似度，取值范围是(0,1)的浮点数。值越大说明相似程度越高。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section129681142578" device-type="phone,2in1,tablet">faceComparator.init<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section129681142578" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>init(): Promise&lt;boolean&gt;</p>     <p>初始化人脸比对分析器服务。使用Promise异步回调。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Face.Comparator</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.3.1.1" width="38.440000000000005%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.3.1.2" width="61.56%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="38.440000000000005%">          <p>Promise&lt;boolean&gt;</p></td>         <td class="cellrowborder" width="61.56%">          <p>Promise对象，返回初始化是否成功。</p>          <p>true：初始化成功；false：初始化失败。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-slb-c106="" class="highlight-div"><div _ngcontent-slb-c106="" class="highlight-div-header"><div _ngcontent-slb-c106="" class="highlight-div-header-left"><div _ngcontent-slb-c106="" class="handle-button expand-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-slb-c106="" class="highlight-div-header-right"><div _ngcontent-slb-c106="" class="handle-button ai-button"></div><div _ngcontent-slb-c106="" class="handle-button line-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-slb-c106="" class="handle-button theme-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-slb-c106="" class="handle-button copy-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-slb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { faceComparator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initAndReleaseFaceComparator</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 初始化人脸比较服务</span></li><li>  <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> faceComparator.<span class="hljs-title function_">init</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">`Face comparator initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (initResult) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Face comparator initialized successfully'</span>);</li><li>
</li><li>    <span class="hljs-comment">// 这里可以添加使用人脸比较服务的代码</span></li><li>
</li><li>    <span class="hljs-comment">// 使用完毕后，释放人脸比较服务</span></li><li>    <span class="hljs-keyword">await</span> faceComparator.<span class="hljs-title function_">release</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Face comparator released successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Failed to initialize face comparator'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'initAndReleaseFaceComparator'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 调用函数</span></li><li>        <span class="hljs-title function_">initAndReleaseFaceComparator</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1079524313716" device-type="phone,2in1,tablet">faceComparator.release<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1079524313716" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>release(): Promise&lt;void&gt;</p>     <p>释放人脸比对分析器服务。使用Promise异步回调。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Face.Comparator</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.3.1.1" width="38.440000000000005%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.3.1.2" width="61.56%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="38.440000000000005%">          <p>Promise&lt;void&gt;</p></td>         <td class="cellrowborder" width="61.56%">          <p>Promise对象，释放接口无返回值。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-slb-c106="" class="highlight-div"><div _ngcontent-slb-c106="" class="highlight-div-header"><div _ngcontent-slb-c106="" class="highlight-div-header-left"><div _ngcontent-slb-c106="" class="handle-button expand-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-slb-c106="" class="highlight-div-header-right"><div _ngcontent-slb-c106="" class="handle-button ai-button"></div><div _ngcontent-slb-c106="" class="handle-button line-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-slb-c106="" class="handle-button theme-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-slb-c106="" class="handle-button copy-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-slb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { faceComparator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initAndReleaseFaceComparator</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 初始化人脸比较服务</span></li><li>  <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> faceComparator.<span class="hljs-title function_">init</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">`Face comparator initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (initResult) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Face comparator initialized successfully'</span>);</li><li>
</li><li>    <span class="hljs-comment">// 这里可以添加使用人脸比较服务的代码</span></li><li>
</li><li>    <span class="hljs-comment">// 使用完毕后，释放人脸比较服务</span></li><li>    <span class="hljs-keyword">await</span> faceComparator.<span class="hljs-title function_">release</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Face comparator released successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceComparatorSample'</span>, <span class="hljs-string">'Failed to initialize face comparator'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'initAndReleaseFaceComparator'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 调用函数</span></li><li>        <span class="hljs-title function_">initAndReleaseFaceComparator</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section16178105410532" device-type="phone,2in1,tablet">faceComparator.compareFaces<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section16178105410532" tips="复制节点链接"></i></h2>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div></div>    <p>compareFaces(visionInfo1: VisionInfo, visionInfo2: VisionInfo): Promise&lt;FaceCompareResult&gt;</p>    <p>创建人脸比对实例，使用Promise异步回调。</p>    <p><strong>系统能力：</strong>SystemCapability.AI.Face.Comparator</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <p><strong>参数：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.14.1.5.1.1" width="29.000000000000004%">         <p>参数名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.14.1.5.1.2" width="25.490000000000006%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.14.1.5.1.3" width="16.370000000000005%">         <p>必填</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.14.1.5.1.4" width="29.140000000000004%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="29.000000000000004%">         <p>visionInfo1</p></td>        <td class="cellrowborder" width="25.490000000000006%">         <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-facecomparator-api#section674171818172">VisionInfo</a></p></td>        <td class="cellrowborder" width="16.370000000000005%">         <p>是</p></td>        <td class="cellrowborder" width="29.140000000000004%">         <p>第一张包含人脸的图片。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="29.000000000000004%">         <p>visionInfo2</p></td>        <td class="cellrowborder" width="25.490000000000006%">         <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-facecomparator-api#section674171818172">VisionInfo</a></p></td>        <td class="cellrowborder" width="16.370000000000005%">         <p>是</p></td>        <td class="cellrowborder" width="29.140000000000004%">         <p>第二张包含人脸的图片。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.1" width="50%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.16.1.3.1.2" width="50%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="50%">         <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-facecomparator-api#section1518613358392">FaceCompareResult</a>&gt;</p></td>        <td class="cellrowborder" width="50%">         <p>Promise对象，返回人脸比对的结果。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-error-code">Core Vision Kit错误码</a>。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.19.1.3.1.1" width="50%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.19.1.3.1.2" width="50%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="50%">         <p>200</p></td>        <td class="cellrowborder" width="50%">         <p>Run timed out, please try again later.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>401</p></td>        <td class="cellrowborder" width="50%">         <p>The parameter check failed.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1008400001</p></td>        <td class="cellrowborder" width="50%">         <p>Failed to run, please try again.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1008400002</p></td>        <td class="cellrowborder" width="50%">         <p>The service is abnormal.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-slb-c106="" class="highlight-div"><div _ngcontent-slb-c106="" class="highlight-div-header"><div _ngcontent-slb-c106="" class="highlight-div-header-left"><div _ngcontent-slb-c106="" class="handle-button expand-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-slb-c106="" class="highlight-div-header-right"><div _ngcontent-slb-c106="" class="handle-button ai-button"></div><div _ngcontent-slb-c106="" class="handle-button line-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-slb-c106="" class="handle-button theme-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-slb-c106="" class="handle-button copy-button"><div _ngcontent-slb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-slb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { faceComparator } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">faceCompareTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">chooseImage</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">chooseImage1</span>: <span class="hljs-title class_">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-comment">// 从图库中选择两张图片</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">PhotoSelectOptions</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>  <span class="hljs-title class_">PhotoSelectOptions</span>.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>  <span class="hljs-title class_">PhotoSelectOptions</span>.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">2</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">PhotoSelectResult</span> = <span class="hljs-keyword">await</span> photoPicker.<span class="hljs-title function_">select</span>(<span class="hljs-title class_">PhotoSelectOptions</span>);</li><li>  <span class="hljs-keyword">let</span> uris = <span class="hljs-title class_">PhotoSelectResult</span>.<span class="hljs-property">photoUris</span>;</li><li>
</li><li>  <span class="hljs-keyword">if</span> (uris.<span class="hljs-property">length</span> !== <span class="hljs-number">2</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'selected uris length is not 2'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 将选择的图片转换为PixelMap</span></li><li>  <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(uris[<span class="hljs-number">0</span>], fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>  <span class="hljs-keyword">let</span> imageSource = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>  chooseImage = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li>  fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(uris[<span class="hljs-number">1</span>], fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>  imageSource = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>  chooseImage1 = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li>  <span class="hljs-keyword">if</span> (!chooseImage || !chooseImage1) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'chooseImage or chooseImage1 is undefined'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 调用人脸比对接口</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">visionInfo</span>: faceComparator.<span class="hljs-property">VisionInfo</span> = {</li><li>    <span class="hljs-attr">pixelMap</span>: chooseImage</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">visionInfo1</span>: faceComparator.<span class="hljs-property">VisionInfo</span> = {</li><li>    <span class="hljs-attr">pixelMap</span>: chooseImage1</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: faceComparator.<span class="hljs-property">FaceCompareResult</span> = <span class="hljs-keyword">await</span> faceComparator.<span class="hljs-title function_">compareFaces</span>(visionInfo, visionInfo1);</li><li>  <span class="hljs-keyword">let</span> similarity = (data.<span class="hljs-property">similarity</span> * <span class="hljs-number">100</span>).<span class="hljs-title function_">toFixed</span>(<span class="hljs-number">2</span>);</li><li>  <span class="hljs-keyword">let</span> isSamePerson = data.<span class="hljs-property">isSamePerson</span> ? <span class="hljs-string">'is'</span> : <span class="hljs-string">'is not'</span>;</li><li>  <span class="hljs-keyword">let</span> faceString = <span class="hljs-string">`Similarity: <span class="hljs-subst">${similarity}</span>%. <span class="hljs-subst">${isSamePerson}</span> the same person`</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'faceString data is '</span> + faceString);</li><li>
</li><li>  <span class="hljs-comment">// 释放资源</span></li><li>  <span class="hljs-keyword">if</span> (chooseImage &amp;&amp; chooseImage1) {</li><li>    chooseImage.<span class="hljs-title function_">release</span>();</li><li>    chooseImage1.<span class="hljs-title function_">release</span>();</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (fileSource) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">close</span>(fileSource);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to close fileSource. Code: <span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'faceCompareTest'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">faceCompareTest</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'faceCompareSample'</span>, <span class="hljs-string">`Failed to compare faces. code: <span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        });</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>