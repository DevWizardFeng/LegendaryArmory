<h1 _ngcontent-uwm-c119="" class="doc-title ng-star-inserted" title="libc标准库"> libc标准库 </h1>

<div _ngcontent-uwm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>C标准函数库在C语言程序设计中，提供符合标准的头文件，以及常用的库函数实现（如I/O输入输出和字符串控制）。</p> <p>HarmonyOS采用musl作为C标准库，musl库是一个轻量，快速，简单，免费的开源libc库，详细介绍参考<a href="http://musl.libc.org/manual.html" target="_blank">musl官方参考手册</a>。</p> <p>musl与glibc的差异点请参考<a href="https://wiki.musl-libc.org/functional-differences-from-glibc.html" target="_blank">musl与glibc功能对比</a>。</p> </div>  <div class="tiledSection"><h2 id="标准c库组件介绍">标准C库组件介绍<i class="anchor-icon anchor-icon-link" anchorid="标准c库组件介绍" tips="复制节点链接"></i></h2><p><a href="https://zh.cppreference.com/w/c/header" target="_blank">libc、libm、libdl</a>组合实现C11标准C库。</p> <p>libc：包含线程相关接口，以及大部分标准接口。</p> <p>libm：数学库函数接口，当前在HarmonyOS中是一个链接，实际都在libc中定义。</p> <p>libdl：dlopen等动态链接器接口，当前在HarmonyOS中是一个链接，实际都在libc中定义。</p> </div>  <div class="tiledSection"><h2 id="musl版本号">musl版本号<i class="anchor-icon anchor-icon-link" anchorid="musl版本号" tips="复制节点链接"></i></h2><p>1.2.0</p> <p>从HarmonyOS4.0开始，版本升级到1.2.3</p> <p>从HarmonyOS5.0开始，版本升级到1.2.5</p> </div>  <div class="tiledSection"><h2 id="支持的能力">支持的能力<i class="anchor-icon anchor-icon-link" anchorid="支持的能力" tips="复制节点链接"></i></h2><p>提供兼容C99、C11、POSIX标准的头文件，以及库函数接口，但不是完全兼容；支持armv7a、arm64、x86_64三种架构的支持；</p> <p>为了更好的适配HarmonyOS设备的高性能、低内存、高安全、轻量化、支持多种形态设备的基本特征；在musl开源库的基础上进行了优化，增强，对不适用嵌入式设备的接口进行了裁剪。</p> </div>  <div class="tiledSection"><h3 id="新增能力" class="firsth2">新增能力<i class="anchor-icon anchor-icon-link" anchorid="新增能力" tips="复制节点链接"></i></h3><ol><li>动态加载器支持命名空间隔离能力，应用可以dlopen加载的动态库受系统命名空间限制（比如，无法打开系统侧动态库）。</li><li>支持dlclose真实卸载动态库能力，musl的开源版本不支持。</li><li>支持symbol-versioning功能。</li><li>dlopen支持直接加载zip包中未压缩的文件。</li></ol> </div>  <div class="tiledSection"><h3 id="调试能力">调试能力<i class="anchor-icon anchor-icon-link" anchorid="调试能力" tips="复制节点链接"></i></h3><p>libc提供了动态使能维测log功能（默认关闭），供开发者需要的时候查看libc库异常。使用libc提供的动态使能维测log功能，不需要重新编译libc库，只需设置param属性即可。在正式发布版本中，不建议使能，会影响运行性能。</p> <p><strong>1. musl.log功能</strong></p> <p>设置musl.log.enable属性为true，打开musl维测log打印。打印其他日志，需先打开此开关。</p> <div _ngcontent-uwm-c106="" class="highlight-div"><div _ngcontent-uwm-c106="" class="highlight-div-header"><div _ngcontent-uwm-c106="" class="highlight-div-header-left"><div _ngcontent-uwm-c106="" class="handle-button expand-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uwm-c106="" class="highlight-div-header-right"><div _ngcontent-uwm-c106="" class="handle-button ai-button"></div><div _ngcontent-uwm-c106="" class="handle-button line-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uwm-c106="" class="handle-button theme-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uwm-c106="" class="handle-button copy-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uwm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>param <span class="hljs-built_in">set</span> musl.log.enable <span class="hljs-literal">true</span></li></ol></pre></div></div> <p><strong>2. 加载器log功能</strong></p> <p>加载器是libc中负责程序引导，dlopen，dlclose等动态链接程序，如需要查看动态加载过程异常，可以打开加载器log。用法如下：</p> <ul><li>使能全部应用的加载器log，log量比较大，请谨慎使用。</li></ul> <div _ngcontent-uwm-c106="" class="highlight-div"><div _ngcontent-uwm-c106="" class="highlight-div-header"><div _ngcontent-uwm-c106="" class="highlight-div-header-left"><div _ngcontent-uwm-c106="" class="handle-button expand-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uwm-c106="" class="highlight-div-header-right"><div _ngcontent-uwm-c106="" class="handle-button ai-button"></div><div _ngcontent-uwm-c106="" class="handle-button line-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uwm-c106="" class="handle-button theme-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uwm-c106="" class="handle-button copy-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uwm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>param <span class="hljs-built_in">set</span> musl.log.ld.app <span class="hljs-literal">true</span></li></ol></pre></div></div> <ul><li>使能指定应用的加载器log，{app_name}需要替换成真实需要打印log的应用名字。</li></ul> <div _ngcontent-uwm-c106="" class="highlight-div"><div _ngcontent-uwm-c106="" class="highlight-div-header"><div _ngcontent-uwm-c106="" class="highlight-div-header-left"><div _ngcontent-uwm-c106="" class="handle-button expand-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uwm-c106="" class="highlight-div-header-right"><div _ngcontent-uwm-c106="" class="handle-button ai-button"></div><div _ngcontent-uwm-c106="" class="handle-button line-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uwm-c106="" class="handle-button theme-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uwm-c106="" class="handle-button copy-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uwm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>param <span class="hljs-built_in">set</span> musl.log.ld.all <span class="hljs-literal">false</span></li><li>param <span class="hljs-built_in">set</span> musl.log.ld.app.{app_name} <span class="hljs-literal">true</span></li></ol></pre></div></div> <ul><li>打印全部应用除指定名字应用外的加载器日志。</li></ul> <div _ngcontent-uwm-c106="" class="highlight-div"><div _ngcontent-uwm-c106="" class="highlight-div-header"><div _ngcontent-uwm-c106="" class="highlight-div-header-left"><div _ngcontent-uwm-c106="" class="handle-button expand-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uwm-c106="" class="highlight-div-header-right"><div _ngcontent-uwm-c106="" class="handle-button ai-button"></div><div _ngcontent-uwm-c106="" class="handle-button line-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uwm-c106="" class="handle-button theme-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uwm-c106="" class="handle-button copy-button"><div _ngcontent-uwm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uwm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>param <span class="hljs-built_in">set</span> musl.log.ld.all <span class="hljs-literal">true</span></li><li>param <span class="hljs-built_in">set</span> musl.log.ld.app.{app_name} <span class="hljs-literal">false</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="musl-差异规格接口说明">musl 差异规格接口说明<i class="anchor-icon anchor-icon-link" anchorid="musl-差异规格接口说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.1" width="50%">接口名称</th> <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">epoll_create</td> <td class="cellrowborder" width="50%">在HarmonyOS5.0 上 该接口逻辑与1.2.3版本保持一致，不会对入参进行判断，不区分入参小于等于0的情况，预计下版本更新此接口逻辑与社区1.2.5保持一致，增加入参逻辑判断，入参小于等于0时创建失败，并返回错误码EINVAL。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="iconv支持的字符集编码格式">ICONV支持的字符集编码格式<i class="anchor-icon anchor-icon-link" anchorid="iconv支持的字符集编码格式" tips="复制节点链接"></i></h2><p>musl支持的字符集编码格式，以及受支持的别名。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"> <p>在进行字符集编码格式转换时，请使用正确的源字符集编码格式，且目标字符集编码格式必须支持这些受转换的字符，否则转换失败。</p> <p>在musl里不支持将源字符集编码格式转换成这五种目标字符集编码格式：gb18030，gbk，gb2312，big5和euckr。</p>  </div></div></div>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.4.1.4.1.1" width="33.33333333333333%">编码格式</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.4.1.2" width="33.33333333333333%">别名</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.4.1.3" width="33.33333333333333%">musl支持情况</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%">utf8</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">wchart</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs2be</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs2le</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">utf16be</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">utf16le</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs4be</td> <td class="cellrowborder" width="33.33333333333333%">utf32be</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs4le</td> <td class="cellrowborder" width="33.33333333333333%">utf32le</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ascii</td> <td class="cellrowborder" width="33.33333333333333%">usascii, iso646, iso646us</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">utf16</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs4</td> <td class="cellrowborder" width="33.33333333333333%">utf32</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">ucs2</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">eucjp</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">shiftjis</td> <td class="cellrowborder" width="33.33333333333333%">sjis, cp932</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso2022jp</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">gb18030</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">gbk</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">gb2312</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">big5</td> <td class="cellrowborder" width="33.33333333333333%">bigfive, cp950, big5hkscs</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">euckr</td> <td class="cellrowborder" width="33.33333333333333%">ksc5601, ksx1001, cp949</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88591</td> <td class="cellrowborder" width="33.33333333333333%">latin1</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88592</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88593</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88594</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88595</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88596</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88597</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88598</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso88599</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885910</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885911</td> <td class="cellrowborder" width="33.33333333333333%">tis620</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885913</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885914</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885915</td> <td class="cellrowborder" width="33.33333333333333%">latin9</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">iso885916</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1250</td> <td class="cellrowborder" width="33.33333333333333%">windows1250</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1251</td> <td class="cellrowborder" width="33.33333333333333%">windows1251</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1252</td> <td class="cellrowborder" width="33.33333333333333%">windows1252</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1253</td> <td class="cellrowborder" width="33.33333333333333%">windows1253</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1254</td> <td class="cellrowborder" width="33.33333333333333%">windows1254</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1255</td> <td class="cellrowborder" width="33.33333333333333%">windows1255</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1256</td> <td class="cellrowborder" width="33.33333333333333%">windows1256</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1257</td> <td class="cellrowborder" width="33.33333333333333%">windows1257</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1258</td> <td class="cellrowborder" width="33.33333333333333%">windows1258</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">koi8r</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">koi8u</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp437</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp850</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp866</td> <td class="cellrowborder" width="33.33333333333333%"> </td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%">cp1047</td> <td class="cellrowborder" width="33.33333333333333%">ibm1047</td> <td class="cellrowborder" width="33.33333333333333%">支持</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="musl不支持接口列表">musl不支持接口列表。<i class="anchor-icon anchor-icon-link" anchorid="musl不支持接口列表" tips="复制节点链接"></i></h2><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/musl-peculiar-symbol">native api中没有导出的符号列表</a></p> <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/nce-on-ndk-libc-interfaces-affected-by-permissions">NDK musl-libc接口受权限影响的说明</a></p> <p><a href="https://gitcode.com/openharmony/third_party_musl/tree/master/docs" target="_blank">NDK musl-libc补充api文档</a></p> </div> </div></div>