<h1 _ngcontent-ehd-c119="" class="doc-title ng-star-inserted" title="moduleInstallManager (产品特性按需分发)"> moduleInstallManager (产品特性按需分发) </h1>

<div _ngcontent-ehd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>借助该模块，您可以从应用的基本模块中分离特定功能和资源，并将其包含在子模块的包中。用户在使用应用过程中，可以动态下载子模块包。该模块包含判断模块是否安装、请求按需加载任务、监听模块下载进度、流量提醒弹窗、取消按需加载任务等功能。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>调用接口需捕获异常。</p> </div></div></div> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="tiledSection"><h2 id="section16609101116259" device-type="phone,2in1,tablet,tv">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section16609101116259" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1518175355911" device-type="phone,2in1,tablet,tv">InstalledModule<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1518175355911" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>当前模块的安装信息。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.1" width="19.96%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.2" width="28.999999999999996%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.3" width="7.5200000000000005%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.4" width="16.3%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.6.1.5" width="27.22%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="19.96%"><p>moduleName</p> </td> <td class="cellrowborder" width="28.999999999999996%"><p>string</p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>是</p> </td> <td class="cellrowborder" width="16.3%"><p>否</p> </td> <td class="cellrowborder" width="27.22%"><p>模块名称。</p> </td> </tr> <tr><td class="cellrowborder" width="19.96%"><p>moduleType</p> </td> <td class="cellrowborder" width="28.999999999999996%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-bundlemanager#moduletype" target="_blank">bundleManager.ModuleType</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>是</p> </td> <td class="cellrowborder" width="16.3%"><p>是</p> </td> <td class="cellrowborder" width="27.22%"><p>模块类型。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>当installStatus=1时，moduleType默认返回0（UNKNOWN）。</p> </div></div></div> </td> </tr> <tr><td class="cellrowborder" width="19.96%"><p>installStatus</p> </td> <td class="cellrowborder" width="28.999999999999996%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section45163241117">InstallStatus</a></p> </td> <td class="cellrowborder" width="7.5200000000000005%"><p>是</p> </td> <td class="cellrowborder" width="16.3%"><p>否</p> </td> <td class="cellrowborder" width="27.22%"><p>模块安装结果。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1535385414136" device-type="phone,2in1,tablet,tv">ModuleInstallSessionState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1535385414136" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>请求、监听/注销监听接口，接口调用结果。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.1" width="26.99269926992699%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.2" width="23.08230823082308%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.3" width="7.520752075207521%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.4" width="15.41154115411541%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.5" width="26.99269926992699%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="26.99269926992699%"><p>code</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section320243191414">RequestErrorCode</a></p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>否</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>接口调用结果码。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>taskStatus</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1138541061512">TaskStatus</a></p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>否</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>按需下载任务状态码。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>taskId</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p>string</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>是</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>按需下载任务taskId，默认值为0。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>desc</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p>string</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>否</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>接口调用结果描述，默认值为“”。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>modules</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p>string[]</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>是</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>下载任务中的模块名列表，默认值为[]。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>totalSize</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p>number</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>是</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>下载的总模块大小（字节），默认值为0。</p> </td> </tr> <tr><td class="cellrowborder" width="26.99269926992699%"><p>downloadedSize</p> </td> <td class="cellrowborder" width="23.08230823082308%"><p>number</p> </td> <td class="cellrowborder" width="7.520752075207521%"><p>是</p> </td> <td class="cellrowborder" width="15.41154115411541%"><p>是</p> </td> <td class="cellrowborder" width="26.99269926992699%"><p>已下载大小（字节），默认值为0。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section45163241117" device-type="phone,2in1,tablet,tv">InstallStatus<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section45163241117" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>安装结果状态码类型的枚举。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>INSTALLED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>模块已安装。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>NOT_INSTALLED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>模块未安装。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section44479181311" device-type="phone,2in1,tablet,tv">ReturnCode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section44479181311" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>添加模块、取消下载、流量提醒弹窗接口，接口调用结果码类型的枚举。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.1" width="33.33%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.2" width="33.33%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.4.1.3" width="33.339999999999996%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33%"><p>SUCCESS</p> </td> <td class="cellrowborder" width="33.33%"><p>0</p> </td> <td class="cellrowborder" width="33.339999999999996%"><p>成功。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33%"><p>FAILURE</p> </td> <td class="cellrowborder" width="33.33%"><p>1</p> </td> <td class="cellrowborder" width="33.339999999999996%"><p>失败。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section320243191414" device-type="phone,2in1,tablet,tv">RequestErrorCode<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section320243191414" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>请求、监听/注销监听接口，接口调用结果码类型的枚举。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.1" width="37.013701370137014%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.2" width="29.652965296529647%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.6.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="37.013701370137014%"><p>MODULE_DEBUG_FILES_SIZE_OVER_LIMIT</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-10</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>单次请求所有模块调试文件大小总和超过8G。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p><strong>起始版本：</strong>5.0.2(14)</p> </div></div></div> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>MODULE_DEBUG_FILES_NOT_EXIST</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-9</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>模块调试文件不存在。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p><strong>起始版本：</strong>5.0.2(14)</p> </div></div></div> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>MODULE_ALREADY_EXISTS</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-8</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>模块已存在。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>MODULE_UNAVAILABLE</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-7</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>要下载的模块不存在或者模块不适配该设备。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>INVALID_REQUEST</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-6</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>该请求无效，请求中包含的信息不准确。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>NETWORK_ERROR</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-5</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>网络异常，请求失败。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>INVOKER_VERIFICATION_FAILED</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>调用者信息异常。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>FOREGROUND_REQUIRED</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>仅允许前台时请求按需加载。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>ACTIVE_SESSION_LIMIT_EXCEEDED</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>请求遭到拒绝，因为当前至少有一个请求正在下载。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>FAILURE</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>-1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>失败。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>SUCCESS</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>成功。</p> </td> </tr> <tr><td class="cellrowborder" width="37.013701370137014%"><p>DOWNLOAD_WAIT_WIFI</p> </td> <td class="cellrowborder" width="29.652965296529647%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>当前使用的是流量，开发者需要调用<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section104451223191616">showCellularDataConfirmation</a>接口，提醒用户确认是否使用流量下载。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1138541061512" device-type="phone,2in1,tablet,tv">TaskStatus<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1138541061512" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>请求、监听/注销监听接口，接口返回下载任务状态码类型的枚举。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.1" width="36.96369636963696%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.2" width="29.7029702970297%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="36.96369636963696%"><p>CREATE_TASK_FAILED</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>-4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>创建下载任务失败。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>HIGHER_VERSION_INSTALLED</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>-3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>本地存在相同或者更高版本。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>TASK_ALREADY_EXISTS</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>-2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>下载任务已存在。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>TASK_UNFOUND</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>-1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>下载任务不存在。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>TASK_CREATED</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>创建下载任务成功。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOADING</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>下载中。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOAD_PAUSING</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>暂停中。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOAD_WAITING</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>等待下载中。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOAD_SUCCESSFUL</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>下载成功完成。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOAD_FAILED</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>5</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>下载失败。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>DOWNLOAD_WAIT_WIFI</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>6</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>Wi-Fi预约。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>INSTALL_WAITING</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>20</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>等待安装。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>INSTALLING</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>21</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>安装中。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>INSTALL_SUCCESSFUL</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>22</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>安装完成。</p> </td> </tr> <tr><td class="cellrowborder" width="36.96369636963696%"><p>INSTALL_FAILED</p> </td> <td class="cellrowborder" width="29.7029702970297%"><p>23</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>安装失败。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section9621184365412" device-type="phone,2in1,tablet,tv">moduleInstallManager.getInstalledModule<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9621184365412" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>getInstalledModule(moduleName: string): InstalledModule</p> <p>查询模块安装信息接口。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>moduleName</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>需要获取的模块名。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.10.1.3.1.1" width="48.13%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.10.1.3.1.2" width="51.870000000000005%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="48.13%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1518175355911">InstalledModule</a></p> </td> <td class="cellrowborder" width="51.870000000000005%"><p>当前模块的安装信息。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500001</p> </td> <td class="cellrowborder" width="50%"><p>Failed to invoke the BMS.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">moduleInfo</span>: moduleInstallManager.<span class="hljs-property">InstalledModule</span> = moduleInstallManager.<span class="hljs-title function_">getInstalledModule</span>(<span class="hljs-string">'AModule'</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'Succeeded in getting installedModule moduleInfo'</span> );</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`getting installedModule onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section65611296515" device-type="phone,2in1,tablet,tv">InstallProvider<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section65611296515" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>按需加载controller父类对象。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> </div> <div class="tiledSection"><h2 id="section7993755494" device-type="phone,2in1,tablet,tv">InstallRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7993755494" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>按需加载请求父类对象。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> </div> <div class="tiledSection"><h2 id="section426882013184" device-type="phone,2in1,tablet,tv">ModuleInstallProvider<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section426882013184" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>实现按需加载的方法，提供创建按需加载请求对象能力，继承<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section65611296515">InstallProvider</a>。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> </div> <div class="tiledSection"><h3 id="section0529646101115" device-type="phone,2in1,tablet,tv" class="firsth2">ModuleInstallProvider.createModuleInstallRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section0529646101115" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>createModuleInstallRequest(context: common.UIAbilityContext | common.ExtensionContext): ModuleInstallRequest</p> <p>创建按需加载请求对象，可通过返回值设置请求参数。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.1" width="21.23%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.2" width="28.73%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.3" width="25.040000000000003%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="21.23%"><p>context</p> </td> <td class="cellrowborder" width="28.73%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">common.UIAbilityContext</a> | <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">common.ExtensionContext</a></p> </td> <td class="cellrowborder" width="25.040000000000003%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>调用方应用的上下文。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section5451648162618">ModuleInstallRequest</a></p> </td> <td class="cellrowborder" width="50%"><p>按需下载请求对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'createModuleInstallRequest'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CreateModuleInstallRequest</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"createModuleInstallRequest"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> =</li><li>              <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> | common.<span class="hljs-property">ExtensionContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()  <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span> =</li><li>              myModuleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`createModuleInstallRequest onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section5451648162618" device-type="phone,2in1,tablet,tv">ModuleInstallRequest<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section5451648162618" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>按需下载请求对象，继承<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section7993755494">InstallRequest</a>。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> </div> <div class="tiledSection"><h3 id="section84452138473" device-type="phone,2in1,tablet,tv" class="firsth2">ModuleInstallRequest.addModule<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section84452138473" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>addModule(moduleName: string): ReturnCode</p> <p>添加要按需加载的模块名。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>moduleName</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>模块名。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311">ReturnCode</a></p> </td> <td class="cellrowborder" width="50%"><p>接口调用结果码。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'addModule'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">AddModule</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"addModule"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> =</li><li>              <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> | common.<span class="hljs-property">ExtensionContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span> =</li><li>              myModuleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">aResult</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> = myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(<span class="hljs-string">'AModule'</span>);</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">bResult</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> = myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(<span class="hljs-string">'BModule'</span>);</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in getting aResult:'</span> + aResult + <span class="hljs-string">' bResult:'</span> + bResult);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`addModule onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1375123411137" device-type="phone,2in1,tablet,tv">moduleInstallManager.fetchModules<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1375123411137" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>fetchModules(moduleInstallRequest: ModuleInstallRequest): Promise&lt;ModuleInstallSessionState&gt;</p> <p>按需加载请求接口，支持调试模式，使用Promise方式异步返回结果。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>moduleInstallRequest</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section5451648162618">ModuleInstallRequest</a></p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>按需加载请求对象实例。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136">ModuleInstallSessionState</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回请求、监听/注销监听调用结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.18.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500004</p> </td> <td class="cellrowborder" width="50%"><p>SA connection failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500008</p> </td> <td class="cellrowborder" width="50%"><p>Write param into container failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500009</p> </td> <td class="cellrowborder" width="50%"><p>Request to service error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500010</p> </td> <td class="cellrowborder" width="50%"><p>Response from service cannot be recognized.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'fetchModules'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">FetchModules</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"fetchModules"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> =</li><li>              <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> | common.<span class="hljs-property">ExtensionContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span> =</li><li>              myModuleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li><li>            myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(<span class="hljs-string">'AModule'</span>);</li><li>            myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(<span class="hljs-string">'BModule'</span>);</li><li>            moduleInstallManager.<span class="hljs-title function_">fetchModules</span>(myModuleInstallRequest)</li><li>              .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Succeeded in fetching modules success data.'</span> );</li><li>              })</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`fetching modules onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section48442523152" device-type="phone,2in1,tablet,tv">moduleInstallManager.cancelTask<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section48442523152" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>cancelTask(taskId: string): ReturnCode</p> <p>取消下载任务接口。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.19.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>taskId</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>下载任务的taskId。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.19.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311">ReturnCode</a></p> </td> <td class="cellrowborder" width="50%"><p>接口调用结果码。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.19.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500007</p> </td> <td class="cellrowborder" width="50%"><p>The specified service extension connect failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500008</p> </td> <td class="cellrowborder" width="50%"><p>Write param into container failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500009</p> </td> <td class="cellrowborder" width="50%"><p>Request to service error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500010</p> </td> <td class="cellrowborder" width="50%"><p>Response from service cannot be recognized.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// taskId 是fetchModules返回结果ModuleInstallSessionState中的taskId字段</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">taskId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'********'</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">rtnCode</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> = moduleInstallManager.<span class="hljs-title function_">cancelTask</span>(taskId);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">"Succeeded in getting result:"</span> + rtnCode);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`cancelTask onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section104451223191616" device-type="phone,2in1,tablet,tv">moduleInstallManager.showCellularDataConfirmation<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section104451223191616" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>showCellularDataConfirmation(context: common.UIAbilityContext | common.ExtensionContext,taskId: string): ReturnCode</p> <p>流量提醒弹窗接口。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.1" width="10.47%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.2" width="29.049999999999997%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.3" width="12.559999999999999%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.4" width="47.92%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="10.47%"><p>context</p> </td> <td class="cellrowborder" width="29.049999999999997%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">common.UIAbilityContext</a> | <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">common.ExtensionContext</a></p> </td> <td class="cellrowborder" width="12.559999999999999%"><p>是</p> </td> <td class="cellrowborder" width="47.92%"><p>Context上下文，目前只支持UIAbilityContext和ExtensionContext，其中UIAbilityContext用于校验当前应用是否在前台。</p> </td> </tr> <tr><td class="cellrowborder" width="10.47%"><p>taskId</p> </td> <td class="cellrowborder" width="29.049999999999997%"><p>string</p> </td> <td class="cellrowborder" width="12.559999999999999%"><p>是</p> </td> <td class="cellrowborder" width="47.92%"><p>下载任务的taskId。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p><a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311">ReturnCode</a></p> </td> <td class="cellrowborder" width="50%"><p>接口调用结果码。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500007</p> </td> <td class="cellrowborder" width="50%"><p>The specified service extension connect failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500008</p> </td> <td class="cellrowborder" width="50%"><p>Write param into container failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500009</p> </td> <td class="cellrowborder" width="50%"><p>Request to service error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500010</p> </td> <td class="cellrowborder" width="50%"><p>Response from service cannot be recognized.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'showCellularDataConfirmation'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ShowCellularDataConfirmation</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"showCellularDataConfirmation"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-comment">// taskId 是fetchModules返回结果ModuleInstallSessionState中的taskId字段</span></li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">taskId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'********'</span>;</li><li>            <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()  <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-attr">rtnCode</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> =</li><li>              moduleInstallManager.<span class="hljs-title function_">showCellularDataConfirmation</span>(context, taskId);</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">"Succeeded in getting result:"</span> + rtnCode);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`showCellularDataConfirmation onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-number">16</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section18484105013164" device-type="phone,2in1,tablet,tv">moduleInstallManager.on('moduleInstallStatus')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18484105013164" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>on(type: 'moduleInstallStatus', callback: Callback&lt;ModuleInstallSessionState&gt;, timeout: number): void</p> <p>监听当前应用下载任务的进度，不支持多线程调用。加载模块时，通过回调函数通知调用者。安装成功且是调试模式时，会删除安装成功模块路径下的调试文件。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.1" width="10.47%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.2" width="23.47%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.3" width="10.41%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.4" width="55.65%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="10.47%"><p>type</p> </td> <td class="cellrowborder" width="23.47%"><p>string</p> </td> <td class="cellrowborder" width="10.41%"><p>是</p> </td> <td class="cellrowborder" width="55.65%"><p>固定值"moduleInstallStatus"。</p> </td> </tr> <tr><td class="cellrowborder" width="10.47%"><p>callback</p> </td> <td class="cellrowborder" width="23.47%"><p>Callback&lt;<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136">ModuleInstallSessionState</a>&gt;</p> </td> <td class="cellrowborder" width="10.41%"><p>是</p> </td> <td class="cellrowborder" width="55.65%"><p>回调函数，使用Callback的方式获取结果。</p> </td> </tr> <tr><td class="cellrowborder" width="10.47%"><p>timeout</p> </td> <td class="cellrowborder" width="23.47%"><p>number</p> </td> <td class="cellrowborder" width="10.41%"><p>是</p> </td> <td class="cellrowborder" width="55.65%"><p>注册监听允许的最大监听时间，默认30分钟（即30*60s），且最大超过30分钟也是按30分钟算。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.11.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.11.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500002</p> </td> <td class="cellrowborder" width="50%"><p>The interface is called repeatedly with the same input.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500004</p> </td> <td class="cellrowborder" width="50%"><p>SA connection failed.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> timeout = <span class="hljs-number">30</span> * <span class="hljs-number">60</span>;</li><li>  moduleInstallManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'moduleInstallStatus'</span>, <span class="hljs-function">(<span class="hljs-params">data: moduleInstallManager.ModuleInstallSessionState</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 注册监听</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'Succeeded in getting moduleInstallManager.on.'</span> );</li><li>  }, timeout)</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`moduleInstallManager.on onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section721141416172" device-type="phone,2in1,tablet,tv">moduleInstallManager.off('moduleInstallStatus')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section721141416172" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span></div><p>off(type: 'moduleInstallStatus', callback?: Callback&lt;ModuleInstallSessionState&gt;): void</p> <p>取消监听当前应用下载任务的进度，不支持多线程调用。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.AppGalleryService.Distribution.OnDemandInstall</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.1" width="10.47%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.2" width="23.47%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.3" width="10.41%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.4" width="55.65%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="10.47%"><p>type</p> </td> <td class="cellrowborder" width="23.47%"><p>string</p> </td> <td class="cellrowborder" width="10.41%"><p>是</p> </td> <td class="cellrowborder" width="55.65%"><p>固定值"moduleInstallStatus"。</p> </td> </tr> <tr><td class="cellrowborder" width="10.47%"><p>callback</p> </td> <td class="cellrowborder" width="23.47%"><p>Callback&lt;<a href="/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136">ModuleInstallSessionState</a>&gt;</p> </td> <td class="cellrowborder" width="10.41%"><p>否</p> </td> <td class="cellrowborder" width="55.65%"><p>回调函数，使用Callback的方式获取结果。不传该参数则会取消当前应用的所有监听。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.22.11.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.11.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500004</p> </td> <td class="cellrowborder" width="50%"><p>SA connection failed.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1006500006</p> </td> <td class="cellrowborder" width="50%"><p>The interface is not used together with "on".</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-ehd-c106="" class="highlight-div"><div _ngcontent-ehd-c106="" class="highlight-div-header"><div _ngcontent-ehd-c106="" class="highlight-div-header-left"><div _ngcontent-ehd-c106="" class="handle-button expand-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ehd-c106="" class="highlight-div-header-right"><div _ngcontent-ehd-c106="" class="handle-button ai-button"></div><div _ngcontent-ehd-c106="" class="handle-button line-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ehd-c106="" class="handle-button theme-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ehd-c106="" class="handle-button copy-button"><div _ngcontent-ehd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ehd-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  moduleInstallManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'moduleInstallStatus'</span>, <span class="hljs-function">(<span class="hljs-params">data: moduleInstallManager.ModuleInstallSessionState</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 取消监听</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'Succeeded in getting moduleInstallManager.off.'</span> );</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`moduleInstallManager.off onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>