<h1 _ngcontent-qqn-c119="" class="doc-title ng-star-inserted" title="native_avsource.h"> native_avsource.h </h1>

<div _ngcontent-qqn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="概述" device-type="phone,2in1,tablet,wearable,tv">概述<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>声明用于音视频媒体数据解析的接口。</p> <p><strong>引用文件：</strong> &lt;multimedia/player_framework/native_avsource.h&gt;</p> <p><strong>库：</strong> libnative_media_avsource.so</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>相关模块：</strong> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource">AVSource</a></p> <p><strong>相关示例：</strong> <a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/BasicFeature/Media/AVCodec" target="_blank">AVCodec</a></p> </div>  <div class="tiledSection"><h2 id="汇总" device-type="phone,2in1,tablet,wearable,tv">汇总<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="汇总" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>  <div class="tiledSection"><h3 id="结构体" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">结构体<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="结构体" tips="复制节点链接"></i></h3> <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" width="33.33333333333333%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" width="33.33333333333333%">typedef关键字</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" width="33.33333333333333%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a></td> <td class="cellrowborder" width="33.33333333333333%">OH_AVSource</td> <td class="cellrowborder" width="33.33333333333333%">为媒体资源接口定义native层对象。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="函数" device-type="phone,2in1,tablet,wearable,tv">函数<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="函数" tips="复制节点链接"></i></h3> <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" width="50%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithdatasource">OH_AVSource *OH_AVSource_CreateWithDataSource(OH_AVDataSource *dataSource)</a></td> <td class="cellrowborder" width="50%">为用户自定义数据源的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithdatasourceext">OH_AVSource *OH_AVSource_CreateWithDataSourceExt(OH_AVDataSourceExt *dataSource, void *userData)</a></td> <td class="cellrowborder" width="50%"><p>为用户自定义数据源的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</p> <p> 回调支持通过userData传递用户自定义数据。</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithuri">OH_AVSource *OH_AVSource_CreateWithURI(char *uri)</a></td> <td class="cellrowborder" width="50%">为统一资源标识符对应的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。该接口仅支持HTTP渐进式流媒体，不支持HLS/DASH的流媒体；对于HLS/DASH的流媒体播放，推荐使用AVPlayer组件进行开发。</td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithfd">OH_AVSource *OH_AVSource_CreateWithFD(int32_t fd, int64_t offset, int64_t size)</a></td> <td class="cellrowborder" width="50%"><p>为文件描述符对应的资源对象创建OH_AVSource实例。可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</p> <p> 接口如果传入offset不为文件起始位置，或size不为文件大小时，可能会因数据获取不完整导致OH_AVSource创建失败、后续解封装失败等未定义错误。</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVErrCode OH_AVSource_Destroy(OH_AVSource *source)</a></td> <td class="cellrowborder" width="50%"><p>销毁OH_AVSource实例并清理内部资源。</p> <p> 同一实例只能被销毁一次。销毁的实例在被重新创建之前不能再被使用。建议实例销毁成功后将指针置为NULL。</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_getsourceformat">OH_AVFormat *OH_AVSource_GetSourceFormat(OH_AVSource *source)</a></td> <td class="cellrowborder" width="50%"><p>获取媒体资源文件的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需调用者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_gettrackformat">OH_AVFormat *OH_AVSource_GetTrackFormat(OH_AVSource *source, uint32_t trackIndex)</a></td> <td class="cellrowborder" width="50%"><p>获取轨道的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需调用者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_getcustommetadataformat">OH_AVFormat *OH_AVSource_GetCustomMetadataFormat(OH_AVSource *source)</a></td> <td class="cellrowborder" width="50%"><p>获取自定义元数据的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需开发者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="函数说明" device-type="phone,2in1,tablet,wearable,tv">函数说明<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="函数说明" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>  <div class="tiledSection"><h3 id="oh_avsource_createwithdatasource" device-type="phone,2in1,tablet,wearable,tv" class="firsth2">OH_AVSource_CreateWithDataSource()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_createwithdatasource" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVSource *<span class="hljs-built_in">OH_AVSource_CreateWithDataSource</span>(OH_AVDataSource *dataSource)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>为用户自定义数据源的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 12</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.8.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.6.8.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-codecbase-oh-avdatasource">OH_AVDataSource</a> *dataSource</td> <td class="cellrowborder" width="50%">用户自定义数据源。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.6.10.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.6.10.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *</td> <td class="cellrowborder" width="50%"><p>如果执行成功，则返回一个指向OH_AVSource实例的指针，否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. dataSource为nullptr。</p> <p> 2. dataSource-&gt;size == 0。</p> <p> 3. 设置数据源失败。</p> <p> 4. 内存不足。</p> <p> 5. 解码器引擎为nullptr。</p> <p> 6. dataSource-&gt;readAt == nullptr。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_createwithdatasourceext" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_CreateWithDataSourceExt()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_createwithdatasourceext" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVSource *<span class="hljs-built_in">OH_AVSource_CreateWithDataSourceExt</span>(OH_AVDataSourceExt *dataSource, void *userData)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>为用户自定义数据源的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</p> <p> 回调支持通过userData传递用户自定义数据。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 20</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.7.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-codecbase-oh-avdatasourceext">OH_AVDataSourceExt</a> *dataSource</td> <td class="cellrowborder" width="50%">指向数据源结构体的指针，该结构体可用于获取输入数据。</td> </tr> <tr><td class="cellrowborder" width="50%">void *userData</td> <td class="cellrowborder" width="50%">指向用户自定义数据的指针。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.7.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.7.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *</td> <td class="cellrowborder" width="50%"><p>如果执行成功，则返回一个指向OH_AVSource实例的指针，否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. dataSource为nullptr。</p> <p> 2. dataSource-&gt;size == 0。</p> <p> 3. 设置数据源失败。</p> <p> 4. 内存不足。</p> <p> 5. 解码器引擎为nullptr。</p> <p> 6. dataSource-&gt;readAt == nullptr。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_createwithuri" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_CreateWithURI()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_createwithuri" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVSource *<span class="hljs-built_in">OH_AVSource_CreateWithURI</span>(char *uri)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>为统一资源标识符对应的资源对象创建OH_AVSource实例，可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。该接口仅支持HTTP渐进式流媒体，不支持HLS/DASH的流媒体；对于HLS/DASH的流媒体播放，推荐使用AVPlayer组件进行开发。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.8.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%">char *uri</td> <td class="cellrowborder" width="50%">远程媒体资源的统一资源标识符。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *</td> <td class="cellrowborder" width="50%"><p>执行成功返回一个指向OH_AVSource实例的指针, 否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. 网络异常。</p> <p> 2. 资源无效。</p> <p> 3. 文件格式不支持。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_createwithfd" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_CreateWithFD()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_createwithfd" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">OH_AVSource *<span class="hljs-title">OH_AVSource_CreateWithFD</span><span class="hljs-params">(<span class="hljs-type">int32_t</span> fd, <span class="hljs-type">int64_t</span> offset, <span class="hljs-type">int64_t</span> size)</span></span></li></ol></pre></div></div> <p><strong>描述</strong></p> <p>为文件描述符对应的资源对象创建OH_AVSource实例。可以通过调用<a href="/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_destroy">OH_AVSource_Destroy</a>接口释放实例。</p> <p> 接口如果传入offset不为文件起始位置，或size不为文件大小时，可能会因数据获取不完整导致OH_AVSource创建失败、后续解封装失败等未定义错误。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%">int32_t fd</td> <td class="cellrowborder" width="50%">数据资源的文件描述符。</td> </tr> <tr><td class="cellrowborder" width="50%">int64_t offset</td> <td class="cellrowborder" width="50%">开始读取数据的位置。</td> </tr> <tr><td class="cellrowborder" width="50%">int64_t size</td> <td class="cellrowborder" width="50%">文件的字节数大小。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.9.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *</td> <td class="cellrowborder" width="50%"><p>执行成功返回一个指向OH_AVSource实例的指针, 否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. fd无效。</p> <p> 2. 传入offset不是文件起始位置。</p> <p> 3. size错误。</p> <p> 4. 资源无效。</p> <p> 5. 文件格式不支持。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_destroy" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_Destroy()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_destroy" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVErrCode <span class="hljs-built_in">OH_AVSource_Destroy</span>(OH_AVSource *source)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>销毁OH_AVSource实例并清理内部资源。</p> <p> 同一实例只能被销毁一次。销毁的实例在被重新创建之前不能再被使用。建议实例销毁成功后将指针置为NULL。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.10.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *source</td> <td class="cellrowborder" width="50%">指向OH_AVSource实例的指针。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.10.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.10.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-averrors-h#oh_averrcode">OH_AVErrCode</a></td> <td class="cellrowborder" width="50%"><p>AV_ERR_OK：操作成功。</p> <p> AV_ERR_INVALID_VAL：</p> <p> 1. source指针无效，空指针。</p> <p> 2. 非OH_AVSource实例。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_getsourceformat" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_GetSourceFormat()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_getsourceformat" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *<span class="hljs-built_in">OH_AVSource_GetSourceFormat</span>(OH_AVSource *source)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>获取媒体资源文件的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需调用者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.11.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *source</td> <td class="cellrowborder" width="50%">指向OH_AVSource实例的指针。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.11.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-core-oh-avformat">OH_AVFormat</a> *</td> <td class="cellrowborder" width="50%"><p>执行成功返回文件的基础信息，否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. source指针无效。</p> <p> 2. 空指针或非OH_AVSource实例。</p> <p> 3. source没有初始化。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_gettrackformat" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_GetTrackFormat()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_gettrackformat" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *<span class="hljs-built_in">OH_AVSource_GetTrackFormat</span>(OH_AVSource *source, uint32_t trackIndex)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>获取轨道的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需调用者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 10</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.12.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *source</td> <td class="cellrowborder" width="50%">指向OH_AVSource实例的指针。</td> </tr> <tr><td class="cellrowborder" width="50%">uint32_t trackIndex</td> <td class="cellrowborder" width="50%">需要获取信息的轨道的索引。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.12.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-core-oh-avformat">OH_AVFormat</a> *</td> <td class="cellrowborder" width="50%"><p>执行成功返回轨道的基础信息，否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. source指针无效，空指针或非OH_AVSource实例。</p> <p> 2. 轨道的索引超出范围。</p> <p> 3. source没有初始化。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="oh_avsource_getcustommetadataformat" device-type="phone,2in1,tablet,wearable,tv">OH_AVSource_GetCustomMetadataFormat()<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="oh_avsource_getcustommetadataformat" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-qqn-c106="" class="highlight-div"><div _ngcontent-qqn-c106="" class="highlight-div-header"><div _ngcontent-qqn-c106="" class="highlight-div-header-left"><div _ngcontent-qqn-c106="" class="handle-button expand-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qqn-c106="" class="highlight-div-header-right"><div _ngcontent-qqn-c106="" class="handle-button ai-button"></div><div _ngcontent-qqn-c106="" class="handle-button line-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qqn-c106="" class="handle-button theme-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qqn-c106="" class="handle-button copy-button"><div _ngcontent-qqn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qqn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *<span class="hljs-built_in">OH_AVSource_GetCustomMetadataFormat</span>(OH_AVSource *source)</li></ol></pre></div></div> <p><strong>描述</strong></p> <p>获取自定义元数据的基础信息。</p> <p> 需要注意的是，指向的OH_AVFormat实例在生命周期结束时需开发者通过调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avformat-h#oh_avformat_destroy">OH_AVFormat_Destroy</a>释放。</p> <p><strong>系统能力：</strong> SystemCapability.Multimedia.Media.Spliter</p> <p><strong>起始版本：</strong> 18</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.1" width="50%">参数项</th> <th align="left" class="cellrowborder" id="mcps1.3.13.9.1.3.1.2" width="50%">描述</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource">OH_AVSource</a> *source</td> <td class="cellrowborder" width="50%">指向OH_AVSource实例的指针。</td> </tr>  </tbody></table></div> </div> <p><strong>返回：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.11.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.13.11.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-core-oh-avformat">OH_AVFormat</a> *</td> <td class="cellrowborder" width="50%"><p>执行成功返回元数据的基础信息，否则返回NULL。</p> <p> 可能的故障原因：</p> <p> 1. source指针无效。</p> <p> 2. 空指针或非OH_AVSource实例。</p> <p> 3. source没有初始化。</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>