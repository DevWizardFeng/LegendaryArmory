<h1 _ngcontent-oox-c119="" class="doc-title ng-star-inserted" title="objectDetection（多目标识别）"> objectDetection（多目标识别） </h1>

<div _ngcontent-oox-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>多目标识别服务提供了从图像中识别多个目标的能力。通过拍照、录像等光学输入方式，把各种场景下的图像转化为数字图像信息，再利用AI底层能力对图像进行分析，从中定位并识别出多个感兴趣的目标对象，如人脸、动物、植物等，便于用户提取目标的类别、边框位置、置信度等信息。</p>    <p>目前本服务支持识别的目标类型包括：风景，动物，植物，建筑，人脸，表格，文本，人头，猫头，狗头，食物，汽车，人体，文档，卡证。</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <div class="tiledSection">     <h2 id="section16609101116259" device-type="phone,2in1,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section16609101116259" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-oox-c106="" class="highlight-div"><div _ngcontent-oox-c106="" class="highlight-div-header"><div _ngcontent-oox-c106="" class="highlight-div-header-left"><div _ngcontent-oox-c106="" class="handle-button expand-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oox-c106="" class="highlight-div-header-right"><div _ngcontent-oox-c106="" class="handle-button ai-button"></div><div _ngcontent-oox-c106="" class="handle-button line-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oox-c106="" class="handle-button theme-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oox-c106="" class="handle-button copy-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oox-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { visionBase, objectDetection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section674171818172" device-type="phone,2in1,tablet">VisionObject<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section674171818172" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>视觉信息对象。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.1" width="12.479999999999999%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.2" width="24.45%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.3" width="10.85%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.4" width="10.93%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.6.1.5" width="41.29%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="12.479999999999999%">          <p>boundingBox</p></td>         <td class="cellrowborder" width="24.45%">          <p>visionBase.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-vision-base-api#section789716171126">BoundingBox</a></p></td>         <td class="cellrowborder" width="10.85%">          <p>否</p></td>         <td class="cellrowborder" width="10.93%">          <p>否</p></td>         <td class="cellrowborder" width="41.29%">          <p>visionObject的边界框。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.479999999999999%">          <p>score</p></td>         <td class="cellrowborder" width="24.45%">          <p>number</p></td>         <td class="cellrowborder" width="10.85%">          <p>否</p></td>         <td class="cellrowborder" width="10.93%">          <p>否</p></td>         <td class="cellrowborder" width="41.29%">          <p>visionObject的置信度。范围为(0,1)。0表示置信度最低，1表示置信度最高。置信度越高，说明这个点的位置越可靠。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.479999999999999%">          <p>labels</p></td>         <td class="cellrowborder" width="24.45%">          <p>Array&lt;number&gt;</p></td>         <td class="cellrowborder" width="10.85%">          <p>否</p></td>         <td class="cellrowborder" width="10.93%">          <p>否</p></td>         <td class="cellrowborder" width="41.29%">          <p>识别物体的类型标签。</p>          <ul>           <li>0：风景。</li>           <li>1：动物。</li>           <li>2：植物。</li>           <li>3：建筑。</li>           <li>5：人脸。</li>           <li>6：表格。</li>           <li>7：文本。</li>           <li>8：人头。</li>           <li>9：猫头。</li>           <li>10：狗头。</li>           <li>11：食物。</li>           <li>12：汽车。</li>           <li>13：人体。</li>           <li>21：文档。</li>           <li>22：卡证。</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" width="12.479999999999999%">          <p>id</p></td>         <td class="cellrowborder" width="24.45%">          <p>number</p></td>         <td class="cellrowborder" width="10.85%">          <p>否</p></td>         <td class="cellrowborder" width="10.93%">          <p>否</p></td>         <td class="cellrowborder" width="41.29%">          <p>visionObject的唯一标识符。ID为从0开始递增的整数编号。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section6430105121211" device-type="phone,2in1,tablet">ObjectDetectionResponse<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section6430105121211" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>多目标检测的结果类。继承自visionBase基类的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-vision-base-api#section13793135121418">Response</a>。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.1" width="12.479999999999999%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.2" width="22.02%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.4" width="13.07%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.6.1.5" width="40.98%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="12.479999999999999%">          <p>objects</p></td>         <td class="cellrowborder" width="22.02%">          <p>Array&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-object-detection-api#section674171818172">VisionObject</a>&gt;</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="13.07%">          <p>否</p></td>         <td class="cellrowborder" width="40.98%">          <p>多目标检测结果。可以为一个对象也可以为对象数组。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1372216360530" device-type="phone,2in1,tablet">ObjectDetector<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1372216360530" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>定义多目标识别的接口和基本结构。继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-vision-base-api#section6867321337">visionBase.Analyzer</a>类。它有以下功能函数：</p>     <ul>      <li>private constructor()：这是一个私有构造函数，意味着不能直接通过new关键字实例化ObjectDetector，必须通过 create() 静态方法来创建实例。</li>      <li>static create(): Promise&lt;ObjectDetector&gt;：这是一个静态方法，用于创建 ObjectDetector 的实例。使用Promise异步回调。它返回一个 Promise，解析为创建的 ObjectDetector 实例。</li>      <li>process(request: visionBase.Request): Promise&lt;ObjectDetectionResponse&gt;：这是一个实例方法，用于处理多目标识别请求。使用Promise异步回调。</li>      <li>destroy(): Promise&lt;void&gt;：这是一个实例方法，用于销毁多目标识别的进程。使用Promise异步回调。</li>     </ul>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.1" width="24.560000000000002%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.3.1.2" width="75.44%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="24.560000000000002%">          <p>constructor</p></td>         <td class="cellrowborder" width="75.44%">          <p>强制开发者必须使用static create()方法来创建ObjectDetector的实例。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="24.560000000000002%">          <p>create</p></td>         <td class="cellrowborder" width="75.44%">          <p>初始化多目标识别接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="24.560000000000002%">          <p>process</p></td>         <td class="cellrowborder" width="75.44%">          <p>多目标识别的实际执行接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="24.560000000000002%">          <p>destroy</p></td>         <td class="cellrowborder" width="75.44%">          <p>多目标识别进程的销毁接口。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section169424457311" device-type="phone,2in1,tablet" class="firsth2">create<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section169424457311" tips="复制节点链接"></i></h3>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div></div>    <p>static create(): Promise&lt;ObjectDetector&gt;</p>    <p>多目标识别的初始化接口。使用Promise异步回调。</p>    <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.14.1.3.1.1" width="45.36%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.14.1.3.1.2" width="54.64%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="45.36%">         <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-object-detection-api#section1372216360530">ObjectDetector</a>&gt;</p></td>        <td class="cellrowborder" width="54.64%">         <p>Promise对象，返回ObjectDetector实例。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-error-code">Core Vision Kit错误码</a>。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.17.1.3.1.1" width="50%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.17.1.3.1.2" width="50%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="50%">         <p>1011000001</p></td>        <td class="cellrowborder" width="50%">         <p>Failed to run, please try again.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000002</p></td>        <td class="cellrowborder" width="50%">         <p>The service is abnormal.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-oox-c106="" class="highlight-div"><div _ngcontent-oox-c106="" class="highlight-div-header"><div _ngcontent-oox-c106="" class="highlight-div-header-left"><div _ngcontent-oox-c106="" class="handle-button expand-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oox-c106="" class="highlight-div-header-right"><div _ngcontent-oox-c106="" class="handle-button ai-button"></div><div _ngcontent-oox-c106="" class="handle-button line-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oox-c106="" class="handle-button theme-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oox-c106="" class="handle-button copy-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oox-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { objectDetection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAndDestroyDetector</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> detector = <span class="hljs-keyword">await</span> objectDetection.<span class="hljs-property">ObjectDetector</span>.<span class="hljs-title function_">create</span>();</li><li>  <span class="hljs-keyword">if</span> (detector) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector created successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>,<span class="hljs-string">'objectDetectionSample'</span>,<span class="hljs-string">'Failed to create object detector'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 使用 detector 进行一些操作</span></li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-comment">// 完成后销毁 detector</span></li><li>  <span class="hljs-keyword">if</span> (detector) {</li><li>    <span class="hljs-keyword">await</span> detector.<span class="hljs-title function_">destroy</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector destroyed successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>,<span class="hljs-string">'objectDetectionSample'</span>,<span class="hljs-string">'Failed to destroy object detector'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'createAndDestroyDetector'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">createAndDestroyDetector</span>()</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section1623412106322" device-type="phone,2in1,tablet">destroy<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1623412106322" tips="复制节点链接"></i></h3>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div></div>    <p>destroy(): Promise&lt;void&gt;</p>    <p>销毁多目标识别的进程。使用Promise异步回调。</p>    <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.26.1.3.1.1" width="45.36%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.26.1.3.1.2" width="54.64%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="45.36%">         <p>Promise&lt;void&gt;</p></td>        <td class="cellrowborder" width="54.64%">         <p>无返回结果的Promise对象。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-oox-c106="" class="highlight-div"><div _ngcontent-oox-c106="" class="highlight-div-header"><div _ngcontent-oox-c106="" class="highlight-div-header-left"><div _ngcontent-oox-c106="" class="handle-button expand-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oox-c106="" class="highlight-div-header-right"><div _ngcontent-oox-c106="" class="handle-button ai-button"></div><div _ngcontent-oox-c106="" class="handle-button line-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oox-c106="" class="handle-button theme-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oox-c106="" class="handle-button copy-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oox-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { objectDetection } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAndDestroyDetector</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> detector = <span class="hljs-keyword">await</span> objectDetection.<span class="hljs-property">ObjectDetector</span>.<span class="hljs-title function_">create</span>();</li><li>  <span class="hljs-keyword">if</span> (detector) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector created successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>,<span class="hljs-string">'objectDetectionSample'</span>,<span class="hljs-string">'Failed to create object detector'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 使用 detector 进行一些操作</span></li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-comment">// 完成后销毁 detector</span></li><li>  <span class="hljs-keyword">if</span> (detector) {</li><li>    <span class="hljs-keyword">await</span> detector.<span class="hljs-title function_">destroy</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector destroyed successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>,<span class="hljs-string">'objectDetectionSample'</span>,<span class="hljs-string">'Failed to destroy object detector'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'createAndDestroyDetector'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">createAndDestroyDetector</span>()</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h3 id="section18815132123217" device-type="phone,2in1,tablet">process<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18815132123217" tips="复制节点链接"></i></h3>         <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div></div>    <p>process(request: visionBase.Request): Promise&lt;ObjectDetectionResponse&gt;</p>    <p>创建多目标识别实例并执行多目标识别。使用Promise异步回调。</p>    <p><strong>系统能力：</strong>SystemCapability.AI.Vision.ObjectDetection</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <p><strong>参数：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.35.1.5.1.1" width="19.2%">         <p>参数名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.35.1.5.1.2" width="22.07%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.35.1.5.1.3" width="11.27%">         <p>必填</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.35.1.5.1.4" width="47.46%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="19.2%">         <p>request</p></td>        <td class="cellrowborder" width="22.07%">         <p>visionBase.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-vision-base-api#section6430105121211">Request</a></p></td>        <td class="cellrowborder" width="11.27%">         <p>是</p></td>        <td class="cellrowborder" width="47.46%">         <p>图片实例。多目标识别接口仅支持传入一张图片，不支持传入多张图片。</p>         <p>具体规格请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/core-vision-introduction#section625292610522" target="_blank">约束与限制</a>。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.37.1.3.1.1" width="45.32%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.37.1.3.1.2" width="54.67999999999999%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="45.32%">         <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-object-detection-api#section6430105121211">ObjectDetectionResponse</a>&gt;</p></td>        <td class="cellrowborder" width="54.67999999999999%">         <p>返回多目标识别的结果。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-error-code">Core Vision Kit错误码</a>。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.40.1.3.1.1" width="50%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.40.1.3.1.2" width="50%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="50%">         <p>401</p></td>        <td class="cellrowborder" width="50%">         <p>The parameter check failed.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000001</p></td>        <td class="cellrowborder" width="50%">         <p>Failed to run, please try again.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000003</p></td>        <td class="cellrowborder" width="50%">         <p>Failed to run the model, please try again.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000004</p></td>        <td class="cellrowborder" width="50%">         <p>Running the model timed out. Try again later.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-oox-c106="" class="highlight-div"><div _ngcontent-oox-c106="" class="highlight-div-header"><div _ngcontent-oox-c106="" class="highlight-div-header-left"><div _ngcontent-oox-c106="" class="handle-button expand-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oox-c106="" class="highlight-div-header-right"><div _ngcontent-oox-c106="" class="handle-button ai-button"></div><div _ngcontent-oox-c106="" class="handle-button line-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oox-c106="" class="handle-button theme-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oox-c106="" class="handle-button copy-button"><div _ngcontent-oox-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oox-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { objectDetection, visionBase } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">chooseImage</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-comment">// 创建对象检测器</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">detector</span>: objectDetection.<span class="hljs-property">ObjectDetector</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createDetector</span>(<span class="hljs-params"></span>) {</li><li>  detector = <span class="hljs-keyword">await</span> objectDetection.<span class="hljs-property">ObjectDetector</span>.<span class="hljs-title function_">create</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector created successfully'</span>);</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Start'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 将图片转换为PixelMap，可以通过图库获取</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>        photoPicker.<span class="hljs-title function_">select</span>({</li><li>          <span class="hljs-title class_">MIMEType</span>: photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>,</li><li>          <span class="hljs-attr">maxSelectNumber</span>: <span class="hljs-number">1</span></li><li>        }).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res: photoAccessHelper.PhotoSelectResult</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> uri = res.<span class="hljs-property">photoUris</span>[<span class="hljs-number">0</span>];</li><li>          <span class="hljs-keyword">if</span> (uri === <span class="hljs-literal">undefined</span>) {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'uri is undefined'</span>);</li><li>            <span class="hljs-keyword">return</span></li><li>          }</li><li>          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">let</span> file = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(uri, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>            imageSource = image.<span class="hljs-title function_">createImageSource</span>(file.<span class="hljs-property">fd</span>);</li><li>            chooseImage = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'chooseImage:'</span>, chooseImage);</li><li>            <span class="hljs-keyword">if</span> (!chooseImage) {</li><li>              <span class="hljs-keyword">return</span></li><li>            }</li><li>
</li><li>            <span class="hljs-comment">// 创建检测器</span></li><li>            <span class="hljs-keyword">await</span> <span class="hljs-title function_">createDetector</span>();</li><li>
</li><li>            <span class="hljs-keyword">if</span> (!detector) {</li><li>              hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Detector is not initialized'</span>);</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>
</li><li>            <span class="hljs-comment">// 调用对象检测接口</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: visionBase.<span class="hljs-property">Request</span> = {</li><li>              <span class="hljs-attr">inputData</span>: { <span class="hljs-attr">pixelMap</span>: chooseImage },</li><li>              <span class="hljs-attr">scene</span>: visionBase.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">FOREGROUND</span></li><li>            };</li><li>
</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">response</span>: objectDetection.<span class="hljs-property">ObjectDetectionResponse</span> = <span class="hljs-keyword">await</span> detector.<span class="hljs-title function_">process</span>(request);</li><li>
</li><li>            <span class="hljs-keyword">if</span> (response.<span class="hljs-property">objects</span>.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'No objects detected in the image.'</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-keyword">let</span> objectString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(response.<span class="hljs-property">objects</span>);</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Detected objects: '</span> + objectString);</li><li>            }</li><li>
</li><li>            <span class="hljs-comment">// 清理资源</span></li><li>            <span class="hljs-keyword">if</span> (chooseImage &amp;&amp; imageSource) {</li><li>              chooseImage.<span class="hljs-title function_">release</span>();</li><li>              imageSource.<span class="hljs-title function_">release</span>();</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (file) {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">close</span>(file);</li><li>              } <span class="hljs-keyword">catch</span> (err) {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">`Failed to close fileSource. Code: <span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>              }</li><li>            }</li><li>            <span class="hljs-keyword">if</span> (detector) {</li><li>              <span class="hljs-keyword">await</span> detector.<span class="hljs-title function_">destroy</span>();</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">'Object detector destroyed successfully'</span>);</li><li>            }</li><li>          }, <span class="hljs-number">100</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'objectDetectionSample'</span>, <span class="hljs-string">`Failed to get photo image uri. code: <span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        });</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>