<h1 _ngcontent-dgx-c119="" class="doc-title ng-star-inserted" title="rag（检索增强生成）"> rag（检索增强生成） </h1>

<div _ngcontent-dgx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供创建和关闭会话（<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1312212528516">RagSession</a>）、流式请求大语言模型（<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1400115191116">ChatLLM</a>）以及流式问答（<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section178721756950">streamRun</a>）的能力。</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <div class="tiledSection"><h2 id="section10727191484112" device-type="2in1">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section10727191484112" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section178144421252" device-type="2in1">LLMStreamAnswer<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section178144421252" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>大模型流式问答的单次结果。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.6.1.6.1.1" width="11.35%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.6.1.2" width="22.95%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.6.1.3" width="6.959999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.6.1.4" width="7.109999999999999%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.6.1.6.1.5" width="51.629999999999995%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="11.35%"><p>isFinished</p> </td> <td class="cellrowborder" width="22.95%"><p>boolean</p> </td> <td class="cellrowborder" width="6.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="7.109999999999999%"><p>否</p> </td> <td class="cellrowborder" width="51.629999999999995%"><p>表示LLM（Large Language Model，大语言模型）流式输出是否已经结束。true表示已结束，false表示后续还有答案输出。</p> </td> </tr> <tr><td class="cellrowborder" width="11.35%"><p>chunk</p> </td> <td class="cellrowborder" width="22.95%"><p>string</p> </td> <td class="cellrowborder" width="6.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="7.109999999999999%"><p>否</p> </td> <td class="cellrowborder" width="51.629999999999995%"><p>表示LLM流式输出过程中单轮返回的chunk（被拆分后的文本单元）内容。单轮流式返回结果无固定上限，单次问答所有流式返回结果长度上限为8192字节。</p> </td> </tr> <tr><td class="cellrowborder" width="11.35%"><p>err</p> </td> <td class="cellrowborder" width="22.95%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#businesserror" target="_blank">BusinessError</a>&lt;string&gt;</p> </td> <td class="cellrowborder" width="6.959999999999999%"><p>否</p> </td> <td class="cellrowborder" width="7.109999999999999%"><p>是</p> </td> <td class="cellrowborder" width="51.629999999999995%"><p>表示LLM流式输出过程中出现的错误。<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#businesserror" target="_blank">code</a>取值范围为[1021011000, 1021012000)，超过范围则会报错<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a>。基类必选参数name和message的长度上限为1000字符，超出部分将被截断。不带本参数则认为无错误发生。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section19522153218174" device-type="2in1">LLMRequestStatus<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section19522153218174" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式请求大语言模型请求状态的枚举值。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.6.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>LLM_SUCCESS</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>请求LLM成功。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>LLM_REQUEST_ERROR</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>请求错误。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>LLM_LOAD_FAILED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>LLM加载失败。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>LLM_TIMEOUT</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>LLM请求超时。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>LLM_BUSY</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>LLM繁忙。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1816505018227" device-type="2in1">LLMRequestInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1816505018227" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式请求大语言模型请求结果的信息。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.1" width="12.5%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.2" width="16.12%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.3" width="9.98%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.4" width="9.5%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.6.1.6.1.5" width="51.9%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="12.5%"><p>chatId</p> </td> <td class="cellrowborder" width="16.12%"><p>number</p> </td> <td class="cellrowborder" width="9.98%"><p>否</p> </td> <td class="cellrowborder" width="9.5%"><p>否</p> </td> <td class="cellrowborder" width="51.9%"><p>表示大模型的请求ID。</p> </td> </tr> <tr><td class="cellrowborder" width="12.5%"><p>status</p> </td> <td class="cellrowborder" width="16.12%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section19522153218174">LLMRequestStatus</a></p> </td> <td class="cellrowborder" width="9.98%"><p>否</p> </td> <td class="cellrowborder" width="9.5%"><p>否</p> </td> <td class="cellrowborder" width="51.9%"><p>表示<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section157381918121212">streamChat</a>请求的状态。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1400115191116" device-type="2in1">ChatLLM<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1400115191116" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>用于请求大模型的抽象类。开发者需继承此类并根据业务逻辑实现各接口逻辑。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> </div> <div class="tiledSection"><h3 id="section157381918121212" device-type="2in1" class="firsth2">streamChat<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section157381918121212" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>abstract streamChat(query: string, callback: Callback&lt;LLMStreamAnswer&gt;): Promise&lt;LLMRequestInfo&gt;</p> <p>流式请求大语言模型，用于与大语言模型交互。使用Promise异步回调。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.1" width="14.08%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.2" width="23.25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.3" width="10.11%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.8.1.5.1.4" width="52.559999999999995%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.08%"><p>query</p> </td> <td class="cellrowborder" width="23.25%"><p>string</p> </td> <td class="cellrowborder" width="10.11%"><p>是</p> </td> <td class="cellrowborder" width="52.559999999999995%"><p>与大模型交互时的请求内容，根据输入问题、问题预处理、检索等结果动态拼接，最大长度为20000字节。</p> <p><strong>注意：</strong>其中已带有需要带给大模型的提示prompt，无需额外附加内容，且提示prompt中的示例数据均只是提示大模型按照预期输出的模拟数据，无其他额外用途。</p> </td> </tr> <tr><td class="cellrowborder" width="14.08%"><p>callback</p> </td> <td class="cellrowborder" width="23.25%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#callback" target="_blank">Callback</a>&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section178144421252">LLMStreamAnswer</a>&gt;</p> </td> <td class="cellrowborder" width="10.11%"><p>是</p> </td> <td class="cellrowborder" width="52.559999999999995%"><p>将与大语言模型交互后得到的结果返回给RAG基础框架的回调。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1816505018227">LLMRequestInfo</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回LLM请求信息对象。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyChatLLM</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">rag.ChatLLM</span> {</li><li>  <span class="hljs-attr">httpRequest</span>: http.<span class="hljs-property">HttpRequest</span> | <span class="hljs-literal">null</span> = http.<span class="hljs-title function_">createHttp</span>();</li><li>  <span class="hljs-title function_">cancel</span>(<span class="hljs-params">chatId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-comment">// 请开发者按需实现chatId与请求之前的映射关系，取消时请取消chatId相应的请求</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>?.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>);</li><li>  }</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">streamChat</span>(<span class="hljs-attr">query</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">Callback</span>&lt;rag.<span class="hljs-property">LLMStreamAnswer</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;rag.<span class="hljs-property">LLMRequestInfo</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">info</span>: rag.<span class="hljs-property">LLMRequestInfo</span> = {</li><li>      <span class="hljs-attr">chatId</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">status</span>: rag.<span class="hljs-property">LLMRequestStatus</span>.<span class="hljs-property">LLM_SUCCESS</span>,</li><li>    };</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-comment">// 此处开发者可自行选择想要使用的大语言模型以及对应实现</span></li><li>      <span class="hljs-comment">// 假设通过httpRequest.on('dataReceive', callback)从大语言模型得到了答案：</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>&lt;<span class="hljs-built_in">string</span>&gt; = {</li><li>        <span class="hljs-attr">code</span>: <span class="hljs-number">1021011000</span>,  <span class="hljs-comment">// 自定义错误码，取值范围[1021011000, 1021012000)</span></li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">'Fill custom error name here'</span>,  <span class="hljs-comment">// 超出1000字符部分将被截断</span></li><li>        <span class="hljs-attr">message</span>: <span class="hljs-string">'Fill custom error message here'</span>  <span class="hljs-comment">// 超出1000字符部分将被截断</span></li><li>      }</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">answer</span>: rag.<span class="hljs-property">LLMStreamAnswer</span> = {</li><li>        <span class="hljs-attr">isFinished</span>: <span class="hljs-literal">true</span>,  <span class="hljs-comment">// 可根据大语言模型回复进行判断，如果是最后一条回复则为true，反之则为false</span></li><li>        <span class="hljs-attr">chunk</span>: <span class="hljs-string">'This is the last chunk'</span>,</li><li>        <span class="hljs-attr">err</span>: err</li><li>      }</li><li>      <span class="hljs-title function_">callback</span>(answer);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-comment">// 此处示例统一返回LLM_REQUEST_ERROR，开发者可根据需要判断err.code并返回相应LLMRequestStatus</span></li><li>      info.<span class="hljs-property">status</span> = rag.<span class="hljs-property">LLMRequestStatus</span>.<span class="hljs-property">LLM_REQUEST_ERROR</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> info;</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section1328252418366" device-type="2in1">cancel<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1328252418366" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>abstract cancel(chatId: number): void</p> <p>取消流式请求大语言模型，用于暂停与大语言模型交互。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.1" width="14.08%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.2" width="23.25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.3" width="10.11%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.8.1.5.1.4" width="52.559999999999995%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="14.08%"><p>chatId</p> </td> <td class="cellrowborder" width="23.25%"><p>number</p> </td> <td class="cellrowborder" width="10.11%"><p>是</p> </td> <td class="cellrowborder" width="52.559999999999995%"><p>需要被取消的请求LLM的ID。与<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section157381918121212">streamChat</a>返回值<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1816505018227">LLMRequestInfo</a>中填入的chatId保持一致。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyChatLLM</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">rag.ChatLLM</span> {</li><li>  <span class="hljs-attr">httpRequest</span>: http.<span class="hljs-property">HttpRequest</span> | <span class="hljs-literal">null</span> = http.<span class="hljs-title function_">createHttp</span>();</li><li>  <span class="hljs-title function_">cancel</span>(<span class="hljs-params">chatId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-comment">// 请开发者按需实现chatId与请求之前的映射关系，取消时请取消chatId相应的请求</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequest</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section1033315317182" device-type="2in1">Config<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1033315317182" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>会话的配置项。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.6.1.6.1.1" width="18.509999999999998%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.6.1.2" width="27.200000000000003%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.6.1.3" width="10.530000000000001%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.6.1.4" width="10.23%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.6.1.6.1.5" width="33.53%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="18.509999999999998%"><p>llm</p> </td> <td class="cellrowborder" width="27.200000000000003%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1400115191116">ChatLLM</a></p> </td> <td class="cellrowborder" width="10.530000000000001%"><p>否</p> </td> <td class="cellrowborder" width="10.23%"><p>否</p> </td> <td class="cellrowborder" width="33.53%"><p>表示<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1400115191116">ChatLLM</a>的提供者。</p> </td> </tr> <tr><td class="cellrowborder" width="18.509999999999998%"><p>retrievalConfig</p> </td> <td class="cellrowborder" width="27.200000000000003%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-retrieval-api#section95236010016">retrieval.RetrievalConfig</a></p> </td> <td class="cellrowborder" width="10.530000000000001%"><p>否</p> </td> <td class="cellrowborder" width="10.23%"><p>否</p> </td> <td class="cellrowborder" width="33.53%"><p>表示检索使用的配置。</p> </td> </tr> <tr><td class="cellrowborder" width="18.509999999999998%"><p>retrievalCondition</p> </td> <td class="cellrowborder" width="27.200000000000003%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-retrieval-api#section4881955192413">retrieval.RetrievalCondition</a></p> </td> <td class="cellrowborder" width="10.530000000000001%"><p>否</p> </td> <td class="cellrowborder" width="10.23%"><p>否</p> </td> <td class="cellrowborder" width="33.53%"><p>表示检索的条件。</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rag, retrieval } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">retrievalConfig</span>: retrieval.<span class="hljs-property">RetrievalConfig</span> = {</li><li>  <span class="hljs-attr">channelConfigs</span>: [<span class="hljs-comment">/*假设已经按需配置*/</span>]</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">retrievalCondition</span>: retrieval.<span class="hljs-property">RetrievalCondition</span> = {</li><li>  <span class="hljs-attr">recallConditions</span>: [<span class="hljs-comment">/*假设已经按需配置*/</span>]</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: rag.<span class="hljs-property">Config</span> = {</li><li>  <span class="hljs-attr">llm</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyChatLLM</span>(),</li><li>  <span class="hljs-attr">retrievalConfig</span>: retrievalConfig,</li><li>  <span class="hljs-attr">retrievalCondition</span>: retrievalCondition</li><li>};</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section1473315119532" device-type="2in1">Answer<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1473315119532" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式问答的数据。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.6.1.6.1.1" width="17.49%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.6.1.2" width="25.650000000000002%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.6.1.3" width="12.36%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.6.1.4" width="11.110000000000001%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.6.1.6.1.5" width="33.39%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.49%"><p>chunk</p> </td> <td class="cellrowborder" width="25.650000000000002%"><p>string</p> </td> <td class="cellrowborder" width="12.36%"><p>否</p> </td> <td class="cellrowborder" width="11.110000000000001%"><p>否</p> </td> <td class="cellrowborder" width="33.39%"><p>表示答案的片段。长度上限为8192字节。</p> </td> </tr> <tr><td class="cellrowborder" width="17.49%"><p>data</p> </td> <td class="cellrowborder" width="25.650000000000002%"><p>Array&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-retrieval-api#section17768581101">retrieval.ItemInfo</a>&gt;</p> </td> <td class="cellrowborder" width="12.36%"><p>否</p> </td> <td class="cellrowborder" width="11.110000000000001%"><p>是</p> </td> <td class="cellrowborder" width="33.39%"><p>表示检索的匹配结果。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section172106569558" device-type="2in1">StreamType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section172106569558" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式问答回答的类型。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.6.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.6.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>THOUGHT</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>思考过程数据。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>REFERENCE</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>检索到的文档或知识的来源。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>ANSWER</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>生成的内容的最终结果。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section158611717585" device-type="2in1">Stream<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section158611717585" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式问答中一次回答的结果信息。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.6.1.6.1.1" width="17.41%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.6.1.2" width="25.729999999999997%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.6.1.3" width="12.36%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.6.1.4" width="11.110000000000001%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.6.1.5" width="33.39%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="17.41%"><p>type</p> </td> <td class="cellrowborder" width="25.729999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section172106569558">StreamType</a></p> </td> <td class="cellrowborder" width="12.36%"><p>否</p> </td> <td class="cellrowborder" width="11.110000000000001%"><p>否</p> </td> <td class="cellrowborder" width="33.39%"><p>表示答案的数据类型。</p> </td> </tr> <tr><td class="cellrowborder" width="17.41%"><p>answer</p> </td> <td class="cellrowborder" width="25.729999999999997%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1473315119532">Answer</a></p> </td> <td class="cellrowborder" width="12.36%"><p>否</p> </td> <td class="cellrowborder" width="11.110000000000001%"><p>否</p> </td> <td class="cellrowborder" width="33.39%"><p>表示答案的数据。</p> </td> </tr> <tr><td class="cellrowborder" width="17.41%"><p>isFinished</p> </td> <td class="cellrowborder" width="25.729999999999997%"><p>boolean</p> </td> <td class="cellrowborder" width="12.36%"><p>否</p> </td> <td class="cellrowborder" width="11.110000000000001%"><p>否</p> </td> <td class="cellrowborder" width="33.39%"><p>表示流输出是否结束。true表示本轮问答已结束，false表示本轮本轮问答还有后续回答。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section126313912116" device-type="2in1">RunConfig<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section126313912116" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>流式问答的配置项。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.6.1.6.1.1" width="16.2%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.6.1.2" width="20.64%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.6.1.3" width="13.389999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.6.1.4" width="11.88%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.6.1.5" width="37.89%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.2%"><p>answerTypes</p> </td> <td class="cellrowborder" width="20.64%"><p>Array&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section172106569558">StreamType</a>&gt;</p> </td> <td class="cellrowborder" width="13.389999999999999%"><p>否</p> </td> <td class="cellrowborder" width="11.88%"><p>否</p> </td> <td class="cellrowborder" width="37.89%"><p>用于指定流式输出的数据类型。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section18123940144515" device-type="2in1">FeedbackInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section18123940144515" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>用户评价信息。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.6.1.6.1.1" width="16.2%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.6.1.2" width="20.64%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.6.1.3" width="13.389999999999999%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.6.1.4" width="11.88%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.6.1.6.1.5" width="37.89%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.2%"><p>runId</p> </td> <td class="cellrowborder" width="20.64%"><p>number</p> </td> <td class="cellrowborder" width="13.389999999999999%"><p>否</p> </td> <td class="cellrowborder" width="11.88%"><p>否</p> </td> <td class="cellrowborder" width="37.89%"><p>会话内特定流式问答的唯一标识符。</p> </td> </tr> <tr><td class="cellrowborder" width="16.2%"><p>score</p> </td> <td class="cellrowborder" width="20.64%"><p>number</p> </td> <td class="cellrowborder" width="13.389999999999999%"><p>否</p> </td> <td class="cellrowborder" width="11.88%"><p>否</p> </td> <td class="cellrowborder" width="37.89%"><p>用户对返回答案的评分。取值范围：[1, 5]。</p> </td> </tr> <tr><td class="cellrowborder" width="16.2%"><p>source</p> </td> <td class="cellrowborder" width="20.64%"><p>Record&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section172106569558">StreamType</a>, <a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1473315119532">Answer</a>&gt;</p> </td> <td class="cellrowborder" width="13.389999999999999%"><p>否</p> </td> <td class="cellrowborder" width="11.88%"><p>是</p> </td> <td class="cellrowborder" width="37.89%"><p>用户采用的答案信息。</p> </td> </tr> <tr><td class="cellrowborder" width="16.2%"><p>comment</p> </td> <td class="cellrowborder" width="20.64%"><p>string</p> </td> <td class="cellrowborder" width="13.389999999999999%"><p>否</p> </td> <td class="cellrowborder" width="11.88%"><p>是</p> </td> <td class="cellrowborder" width="37.89%"><p>用户反馈的文本信息。长度上限为1000字节。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1312212528516" device-type="2in1">RagSession<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1312212528516" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>RAG会话，用以提供基于知识库的智能问答能力。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> </div> <div class="tiledSection"><h3 id="section178721756950" device-type="2in1" class="firsth2">streamRun<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section178721756950" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>streamRun(question: string, config: RunConfig, callback: AsyncCallback&lt;Stream&gt;): Promise&lt;number&gt;</p> <p>流式问答，答案是流式传输的，使用Promise异步回调。不支持多线程调用。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.1" width="19.68%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.2" width="24.72%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.3" width="16.59%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.8.1.5.1.4" width="39.01%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="19.68%"><p>question</p> </td> <td class="cellrowborder" width="24.72%"><p>string</p> </td> <td class="cellrowborder" width="16.59%"><p>是</p> </td> <td class="cellrowborder" width="39.01%"><p>表示本次提出的问题。长度上限为1000字节。</p> </td> </tr> <tr><td class="cellrowborder" width="19.68%"><p>config</p> </td> <td class="cellrowborder" width="24.72%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section126313912116">RunConfig</a></p> </td> <td class="cellrowborder" width="16.59%"><p>是</p> </td> <td class="cellrowborder" width="39.01%"><p>表示本次提问的配置。</p> </td> </tr> <tr><td class="cellrowborder" width="19.68%"><p>callback</p> </td> <td class="cellrowborder" width="24.72%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-base#asynccallback" target="_blank">AsyncCallback</a>&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section158611717585">Stream</a>&gt;</p> </td> <td class="cellrowborder" width="16.59%"><p>是</p> </td> <td class="cellrowborder" width="39.01%"><p>表示用于接受回答的回调。<strong>注意：</strong>streamRun的完整生命周期包含完整的callback执行。结束的callback回调执行过程中，streamRun的生命周期仍然在持续，在此时进行新的streamRun或者cancel/close操作，都可能产生针对streamRun仍然在进行中的对应错误。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;number&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回本次调用的ID。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <div class="p">以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code">数据增强错误码</a>。 <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.12.3.1.3.1.1" width="19.34%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.12.3.1.3.1.2" width="80.66%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Insufficient system resources or memory access exception.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section067520119311">1021000001</a></p> </td> <td class="cellrowborder" width="80.66%"><p>A timeout occurred when calling the LLM.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section398619111131">1021000002</a></p> </td> <td class="cellrowborder" width="80.66%"><p>A loading failure occurred when calling the LLM.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section821961514310">1021000003</a></p> </td> <td class="cellrowborder" width="80.66%"><p>A request failure occurred when calling the LLM.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section57321151039">1021000004</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The LLM chat is busy.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section151441316239">1021000005</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The output of LLM chat does not comply with the constraints.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section1787571610312">1021000007</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The RAG session is busy.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16220417239">1021000008</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The RAG session is Already closed.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section12582191715318">1021000009</a></p> </td> <td class="cellrowborder" width="80.66%"><p>User has canceled the stream run.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section13942117932">1021000010</a></p> </td> <td class="cellrowborder" width="80.66%"><p>A timeout occurred in the session.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section3292318836">1021000011</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Some parameter does not meet the constraints. Possible causes:</p> <p>1. The length of the string parameter or the length of the numeric parameter does not comply with the constraints.</p> <p>2. The string parameter contains invalid characters.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section666413181639">1021000012</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The knowledge base is not available.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section138151918312">1021000013</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: An error occurred during the Retrieval.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section193969191335">1021000014</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: There are invalid primary keys.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section1273420195316">1021000015</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: A re-ranking algorithm that does not support composite primary keys was used.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section576320538">1021000016</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: The filter input is invalid.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section145418202032">1021000017</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: There are invalid recall names in RecallCondition.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section78131820938">1021000018</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: The vector similarity threshold in VectorQuery is higher than the tiered threshold in VectorRerankParameter.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section161717215314">1021000019</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Retrieval: RerankMethod parameters do not match the channel type.</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>示例：</strong></p> <div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: rag.<span class="hljs-property">RagSession</span> | <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">runConfig</span>: rag.<span class="hljs-property">RunConfig</span> = {</li><li>  <span class="hljs-attr">answerTypes</span>: [ rag.<span class="hljs-property">StreamType</span>.<span class="hljs-property">THOUGHT</span>, rag.<span class="hljs-property">StreamType</span>.<span class="hljs-property">REFERENCE</span>, rag.<span class="hljs-property">StreamType</span>.<span class="hljs-property">ANSWER</span> ]</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">output</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {</li><li>  session.<span class="hljs-title function_">streamRun</span>(<span class="hljs-string">'提出的问题'</span>, runConfig, (<span class="hljs-function">(<span class="hljs-params">err: BusinessError, stream: rag.Stream</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">`streamRun inner failed. code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">'StreamType: %{public}d'</span>, stream.<span class="hljs-property">type</span>);</li><li>      output += stream.<span class="hljs-property">answer</span>.<span class="hljs-property">chunk</span>;</li><li>      <span class="hljs-keyword">if</span> (stream.<span class="hljs-property">isFinished</span>) {</li><li>        output += <span class="hljs-string">'回答结束。'</span>;</li><li>      }</li><li>    }</li><li>  })).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'Index'</span>, <span class="hljs-string">'runId: %{public}d'</span>, data);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">`streamRun failed. code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section13651055104315" device-type="2in1">cancel<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section13651055104315" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>cancel(runId: number): Promise&lt;void&gt;</p> <p>取消本次问答，使用Promise异步回调。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.1" width="19.68%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.2" width="24.72%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.3" width="16.59%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.8.1.5.1.4" width="39.01%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="19.68%"><p>runId</p> </td> <td class="cellrowborder" width="24.72%"><p>number</p> </td> <td class="cellrowborder" width="16.59%"><p>是</p> </td> <td class="cellrowborder" width="39.01%"><p>表示需要取消的问答ID。与<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section178721756950">streamRun</a>返回值保持一致。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code">数据增强错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.18.13.1.3.1.1" width="19.34%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.18.13.1.3.1.2" width="80.66%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Insufficient system resources or memory access exception.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16220417239">1021000008</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The RAG session is Already closed.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: rag.<span class="hljs-property">RagSession</span> | <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">runId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 请开发者填入streamRun实际返回值</span></li><li>  session.<span class="hljs-title function_">cancel</span>(runId).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">'cancel successfully'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'test'</span>, <span class="hljs-string">`cancel failed. code is <span class="hljs-subst">${e.code}</span>, message is <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h3 id="section15625720155116" device-type="2in1">close<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section15625720155116" tips="复制节点链接"></i></h3><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>close(): Promise&lt;void&gt;</p> <p>关闭会话，使用Promise异步回调。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.19.8.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.8.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code">数据增强错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.19.11.1.3.1.1" width="19.34%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.19.11.1.3.1.2" width="80.66%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Insufficient system resources or memory access exception.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rag } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: rag.<span class="hljs-property">RagSession</span> | <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-title function_">onWindowStageDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// Main window is destroyed, release UI related resources</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageDestroy'</span>);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (session != <span class="hljs-literal">null</span>) {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section14201103320529" device-type="2in1">createRagSession<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section14201103320529" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>createRagSession(context: common.Context, config: Config): Promise&lt;RagSession&gt;</p> <p>获得一个会话，使用Promise异步回调。不支持多线程调用。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.1" width="16.59%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.2" width="26.3%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.3" width="15.45%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.8.1.5.1.4" width="41.660000000000004%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="16.59%"><p>context</p> </td> <td class="cellrowborder" width="26.3%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">common.Context</a></p> </td> <td class="cellrowborder" width="15.45%"><p>是</p> </td> <td class="cellrowborder" width="41.660000000000004%"><p>表示当前应用上下文。</p> </td> </tr> <tr><td class="cellrowborder" width="16.59%"><p>config</p> </td> <td class="cellrowborder" width="26.3%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1033315317182">Config</a></p> </td> <td class="cellrowborder" width="15.45%"><p>是</p> </td> <td class="cellrowborder" width="41.660000000000004%"><p>表示与此<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1312212528516">RagSession</a>相关的配置。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1312212528516">RagSession</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回<a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section1312212528516">RagSession</a>对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code">数据增强错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.13.1.3.1.1" width="19.34%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.13.1.3.1.2" width="80.66%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Insufficient system resources or memory access exception.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section34911416737">1021000006</a></p> </td> <td class="cellrowborder" width="80.66%"><p>The RAG session already exists.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">ConfigurationConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { rag, retrieval } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li><span class="hljs-keyword">import</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyChatLLM</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./MyChatLLM'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">session</span>: rag.<span class="hljs-property">RagSession</span> | <span class="hljs-literal">null</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;</li><li>
</li><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// Main window is created, set main page for this ability</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onWindowStageCreate'</span>);</li><li>
</li><li>  windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err.<span class="hljs-property">code</span>) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Failed to load the content. Cause: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Succeeded in loading the content.'</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">retrievalConfig</span>: retrieval.<span class="hljs-property">RetrievalConfig</span> = {</li><li>    <span class="hljs-attr">channelConfigs</span>: [<span class="hljs-comment">/*假设已经按需配置*/</span>]</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">retrievalCondition</span>: retrieval.<span class="hljs-property">RetrievalCondition</span> = {</li><li>    <span class="hljs-attr">recallConditions</span>: [<span class="hljs-comment">/*假设已经按需配置*/</span>]</li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: rag.<span class="hljs-property">Config</span> = {</li><li>    <span class="hljs-attr">llm</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyChatLLM</span>(),</li><li>    <span class="hljs-attr">retrievalConfig</span>: retrievalConfig,</li><li>    <span class="hljs-attr">retrievalCondition</span>: retrievalCondition</li><li>  };</li><li>
</li><li>  rag.<span class="hljs-title function_">createRagSession</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    session = data;</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`createRagSession failed, code is <span class="hljs-subst">${err.code}</span>,message is <span class="hljs-subst">${err.message}</span>.`</span>);</li><li>  })</li><li>}</li></ol></pre></div></div> </div> </div> <div class="tiledSection"><h2 id="section1757165285113" device-type="2in1">feedback<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1757165285113" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">PC/2in1</span></div><p>feedback(context: common.Context, feedbackInfo: FeedbackInfo): Promise&lt;void&gt;</p> <p>用户评价接口。用户问答结束之后，可以使用该接口对此次问答进行评价。使用Promise异步回调。</p> <p><strong>模型约束：</strong>此接口仅可在Stage模型下使用。</p> <p><strong>系统能力：</strong>SystemCapability.DataAugmentation.RAG</p> <p><strong>起始版本：</strong>6.0.0(20)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.3" width="15.55%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.4" width="34.449999999999996%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>context</p> </td> <td class="cellrowborder" width="25%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">common.Context</a></p> </td> <td class="cellrowborder" width="15.55%"><p>是</p> </td> <td class="cellrowborder" width="34.449999999999996%"><p>表示当前应用上下文。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>feedbackInfo</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/dataaugmentation-rag-api#section18123940144515">FeedbackInfo</a></p> </td> <td class="cellrowborder" width="15.55%"><p>是</p> </td> <td class="cellrowborder" width="34.449999999999996%"><p>表示用户反馈的信息。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，无返回结果。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/errorcode-universal" target="_blank">通用错误码</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code">数据增强错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.13.1.3.1.1" width="19.34%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.13.1.3.1.2" width="80.66%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section16205152494111">1021000000</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Insufficient system resources or memory access exception.</p> </td> </tr> <tr><td class="cellrowborder" width="19.34%"><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/dataaugmentation-error-code#section3292318836">1021000011</a></p> </td> <td class="cellrowborder" width="80.66%"><p>Some parameter does not meet the constraints. Possible causes:</p> <p>1. The length of the string parameter or the length of the numeric parameter does not comply with the constraints.</p> <p>2. The string parameter contains invalid characters.</p> </td> </tr>  </tbody></table></div> </div> <div class="p"><strong>示例：</strong><div _ngcontent-dgx-c106="" class="highlight-div"><div _ngcontent-dgx-c106="" class="highlight-div-header"><div _ngcontent-dgx-c106="" class="highlight-div-header-left"><div _ngcontent-dgx-c106="" class="handle-button expand-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgx-c106="" class="highlight-div-header-right"><div _ngcontent-dgx-c106="" class="handle-button ai-button"></div><div _ngcontent-dgx-c106="" class="handle-button line-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgx-c106="" class="handle-button theme-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgx-c106="" class="handle-button copy-button"><div _ngcontent-dgx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">rag</span>, <span class="hljs-variable">retrieval</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DataAugmentationKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">relationalStore</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">common</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">context</span> = <span class="hljs-variable">AppStorage</span>.<span class="hljs-variable">get</span>&lt;<span class="hljs-title class_">common</span>.<span class="hljs-title class_">UIAbilityContext</span>&gt;(<span class="hljs-string">"Context"</span>) <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>
</li><li><span class="hljs-variable">async</span> <span class="hljs-variable">function</span> <span class="hljs-title function_">feedback</span>() {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">valueTypeA</span>: <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">ValueType</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">valueTypeRecord</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">relationalStore</span>.<span class="hljs-title class_">ValueType</span>&gt; = {</li><li>    <span class="hljs-string">'a'</span>: <span class="hljs-title class_">valueTypeA</span>,</li><li>    <span class="hljs-string">'b'</span>: <span class="hljs-title class_">valueTypeA</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">recallScoreA</span>: <span class="hljs-title class_">retrieval</span>.<span class="hljs-title class_">RecallScore</span> = {</li><li>    <span class="hljs-variable">score</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">isReverseQuery</span>: <span class="hljs-keyword">false</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">recallScoreRecord</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">retrieval</span>.<span class="hljs-title class_">RecallScore</span>&gt; = {</li><li>    <span class="hljs-string">'a'</span>: <span class="hljs-title class_">recallScoreA</span>,</li><li>    <span class="hljs-string">'b'</span>: <span class="hljs-title class_">recallScoreA</span>,</li><li>    <span class="hljs-string">'c'</span>: <span class="hljs-title class_">recallScoreA</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">channelTypeRecord</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">number</span>, <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">retrieval</span>.<span class="hljs-title class_">RecallScore</span>&gt;&gt; = {</li><li>    <span class="hljs-number">0</span>: <span class="hljs-title class_">recallScoreRecord</span>,</li><li>    <span class="hljs-number">1</span>: <span class="hljs-title class_">recallScoreRecord</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">itemInfo</span>: <span class="hljs-title class_">retrieval</span>.<span class="hljs-title class_">ItemInfo</span> = {</li><li>    <span class="hljs-variable">primaryKey</span>: <span class="hljs-string">''</span>,</li><li>    <span class="hljs-variable">columns</span>: <span class="hljs-title class_">valueTypeRecord</span>,</li><li>    <span class="hljs-variable">score</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable">recallScores</span>: <span class="hljs-title class_">channelTypeRecord</span>,</li><li>    <span class="hljs-variable">features</span>: {</li><li>      <span class="hljs-string">'111'</span>: <span class="hljs-number">1</span>,</li><li>      <span class="hljs-string">'222'</span>: <span class="hljs-number">2</span></li><li>    },</li><li>    <span class="hljs-variable">similarityLevel</span>: <span class="hljs-title class_">retrieval</span>.<span class="hljs-title class_">SimilarityLevel</span>.<span class="hljs-title class_">LOW</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">answerB</span>: <span class="hljs-title class_">rag</span>.<span class="hljs-title class_">Answer</span> = {</li><li>    <span class="hljs-variable">chunk</span>: <span class="hljs-string">'111'</span>,</li><li>    <span class="hljs-variable">data</span>: [<span class="hljs-variable">itemInfo</span>]</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">sources</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">number</span>, <span class="hljs-title class_">rag</span>.<span class="hljs-title class_">Answer</span>&gt; = {</li><li>    <span class="hljs-number">0</span>: <span class="hljs-title class_">answerB</span>,</li><li>    <span class="hljs-number">1</span>: <span class="hljs-title class_">answerB</span>,</li><li>    <span class="hljs-number">2</span>: <span class="hljs-title class_">answerB</span>,</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">feedbackInfo</span>: <span class="hljs-title class_">rag</span>.<span class="hljs-title class_">FeedbackInfo</span> = {</li><li>    <span class="hljs-variable">runId</span>: <span class="hljs-number">444</span>,</li><li>    <span class="hljs-variable">score</span>: <span class="hljs-number">5</span>,</li><li>    <span class="hljs-variable">comment</span>: <span class="hljs-string">'111222333'</span>,</li><li>    <span class="hljs-variable">source</span>: <span class="hljs-title class_">sources</span></li><li>  };</li><li>  <span class="hljs-variable">await</span> <span class="hljs-variable">rag</span>.<span class="hljs-title function_">feedback</span>(<span class="hljs-variable">context</span>, <span class="hljs-variable">feedbackInfo</span>);</li><li>}</li></ol></pre></div></div> </div> </div> </div> <div></div></div>