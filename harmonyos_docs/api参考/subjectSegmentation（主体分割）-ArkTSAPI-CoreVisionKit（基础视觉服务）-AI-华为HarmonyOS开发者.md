<h1 _ngcontent-sso-c119="" class="doc-title ng-star-inserted" title="subjectSegmentation（主体分割）"> subjectSegmentation（主体分割） </h1>

<div _ngcontent-sso-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Core Vision Kit根据配置参数（如最多检测多少个物体、是否输出每个物体的详细信息等）可将一张普通的图片进行分割，分割后的信息包括图片整体的分割结果和每个显著物体的详细信息。</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <div class="tiledSection">     <h2 id="section858242013419" device-type="phone,2in1,tablet">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section858242013419" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><div _ngcontent-sso-c106="" class="highlight-div"><div _ngcontent-sso-c106="" class="highlight-div-header"><div _ngcontent-sso-c106="" class="highlight-div-header-left"><div _ngcontent-sso-c106="" class="handle-button expand-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sso-c106="" class="highlight-div-header-right"><div _ngcontent-sso-c106="" class="handle-button ai-button"></div><div _ngcontent-sso-c106="" class="handle-button line-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sso-c106="" class="handle-button theme-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sso-c106="" class="handle-button copy-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { subjectSegmentation } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section674171818172" device-type="phone,2in1,tablet">VisionInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section674171818172" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>待识别的视觉信息，目前仅支持颜色数据格式为RGBA_8888的PixelMap类型的视觉信息。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.1" width="17.07%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.2" width="17.43%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.4" width="15.920000000000002%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.6.1.5" width="38.129999999999995%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.07%">          <p>pixelMap</p></td>         <td class="cellrowborder" width="17.43%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">image.PixelMap</a></p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>待识别的图片。</p>          <p>具体规格请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/core-vision-introduction#section625292610522" target="_blank">约束与限制</a>。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1268211401742" device-type="phone,2in1,tablet">SegmentationConfig<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1268211401742" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>显著性分割的可选配置项，包括最多输出的主体个数、是否输出每个主体的详细分割信息，以及是否输出前景图的配置项。</p>    </div>    <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>    <p><strong>起始版本：</strong>5.0.0(12)</p>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.8.1.6.1.1" width="22.38%">         <p>名称</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.8.1.6.1.2" width="12.120000000000001%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.8.1.6.1.3" width="11.450000000000001%">         <p>只读</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.8.1.6.1.4" width="9.62%">         <p>可选</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.8.1.6.1.5" width="44.43%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="22.38%">         <p>maxCount</p></td>        <td class="cellrowborder" width="12.120000000000001%">         <p>number</p></td>        <td class="cellrowborder" width="11.450000000000001%">         <p>否</p></td>        <td class="cellrowborder" width="9.62%">         <p>是</p></td>        <td class="cellrowborder" width="44.43%">         <p>最多输出主体个数。取值范围为[1,20]，以主体在原图中的面积占比降序排序，默认为6。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="22.38%">         <p>enableSubjectDetails</p></td>        <td class="cellrowborder" width="12.120000000000001%">         <p>boolean</p></td>        <td class="cellrowborder" width="11.450000000000001%">         <p>否</p></td>        <td class="cellrowborder" width="9.62%">         <p>是</p></td>        <td class="cellrowborder" width="44.43%">         <p>是否输出每个主体的前景信息（subjectDetails），默认为false，true代表输出每个主体的前景信息。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="22.38%">         <p>enableSubjectForegroundImage</p></td>        <td class="cellrowborder" width="12.120000000000001%">         <p>boolean</p></td>        <td class="cellrowborder" width="11.450000000000001%">         <p>否</p></td>        <td class="cellrowborder" width="9.62%">         <p>是</p></td>        <td class="cellrowborder" width="44.43%">         <p>是否输出前景图，默认为false，true代表输出前景图。</p></td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="section789716171126" device-type="phone,2in1,tablet">Rectangle<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section789716171126" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>显著性主体分割后的边界框。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.1" width="17.07%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.2" width="17.43%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.4" width="15.920000000000002%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.5" width="38.129999999999995%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.07%">          <p>left</p></td>         <td class="cellrowborder" width="17.43%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>边界框左上角的x坐标。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>top</p></td>         <td class="cellrowborder" width="17.43%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>边界框左上角的y坐标。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>height</p></td>         <td class="cellrowborder" width="17.43%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>边界框高度，单位为像素。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>width</p></td>         <td class="cellrowborder" width="17.43%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="15.920000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="38.129999999999995%">          <p>边界框宽度，单位为像素。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section19644831362" device-type="phone,2in1,tablet">SubjectResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section19644831362" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>分割后的详细结果。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.1" width="17.07%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.2" width="17.43%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.4" width="9.62%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.5" width="44.43%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.07%">          <p>foregroundImage</p></td>         <td class="cellrowborder" width="17.43%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">image.PixelMap</a></p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>否</p></td>         <td class="cellrowborder" width="44.43%">          <p>显著性主体前景图。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>mattingList</p></td>         <td class="cellrowborder" width="17.43%">          <p>Int32Array</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>否</p></td>         <td class="cellrowborder" width="44.43%">          <p>基于原图大小的一维数组，表示主体掩码。0-255取值范围。0代表背景，255代表主体，中间值代表是否是显著性主体的概率。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.07%">          <p>subjectRectangle</p></td>         <td class="cellrowborder" width="17.43%">          <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section789716171126">Rectangle</a></p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>否</p></td>         <td class="cellrowborder" width="44.43%">          <p>主体的内切框。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section747541297" device-type="phone,2in1,tablet">SegmentationResult<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section747541297" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>分割后的总输出结果，包括主体个数、整张图中所有主体的分割信息和每个主体的详细信息。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.1" width="13.089999999999998%">          <p>名称</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.2" width="21.41%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.3" width="11.450000000000001%">          <p>只读</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.4" width="9.62%">          <p>可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.5" width="44.43%">          <p>说明</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="13.089999999999998%">          <p>subjectCount</p></td>         <td class="cellrowborder" width="21.41%">          <p>number</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>否</p></td>         <td class="cellrowborder" width="44.43%">          <p>表示主体个数，取决于<a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section1268211401742">SegmentationConfig</a>中maxCount参数的限制。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.089999999999998%">          <p>fullSubject</p></td>         <td class="cellrowborder" width="21.41%">          <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section19644831362">SubjectResult</a></p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>否</p></td>         <td class="cellrowborder" width="44.43%">          <p>默认输出的整张图的所有显著性主体信息。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.089999999999998%">          <p>subjectDetails</p></td>         <td class="cellrowborder" width="21.41%">          <p>Array&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section19644831362">SubjectResult</a>&gt;</p></td>         <td class="cellrowborder" width="11.450000000000001%">          <p>否</p></td>         <td class="cellrowborder" width="9.62%">          <p>是</p></td>         <td class="cellrowborder" width="44.43%">          <p>每个主体的显著性主体信息。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section129681142578" device-type="phone,2in1,tablet">subjectSegmentation.init<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section129681142578" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>init(): Promise&lt;boolean&gt;</p>     <p>初始化主体分割服务。使用Promise异步回调。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.1" width="38.440000000000005%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.3.1.2" width="61.56%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="38.440000000000005%">          <p>Promise&lt;boolean&gt;</p></td>         <td class="cellrowborder" width="61.56%">          <p>Promise对象，返回初始化是否成功。</p>          <p>true：初始化成功；false：初始化失败。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-sso-c106="" class="highlight-div"><div _ngcontent-sso-c106="" class="highlight-div-header"><div _ngcontent-sso-c106="" class="highlight-div-header-left"><div _ngcontent-sso-c106="" class="handle-button expand-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sso-c106="" class="highlight-div-header-right"><div _ngcontent-sso-c106="" class="handle-button ai-button"></div><div _ngcontent-sso-c106="" class="handle-button line-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sso-c106="" class="handle-button theme-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sso-c106="" class="handle-button copy-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { subjectSegmentation } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initAndReleaseSubjectSegmentation</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 初始化主体分割服务</span></li><li>  <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> subjectSegmentation.<span class="hljs-title function_">init</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">`Subject segmentation initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (initResult) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Subject segmentation initialized successfully'</span>);</li><li>
</li><li>    <span class="hljs-comment">// 这里可以添加使用主体分割服务的代码</span></li><li>
</li><li>    <span class="hljs-comment">// 使用完毕后，释放主体分割服务</span></li><li>    <span class="hljs-keyword">await</span> subjectSegmentation.<span class="hljs-title function_">release</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Subject segmentation released successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Failed to initialize subject segmentation'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'initAndReleaseSubjectSegmentation'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 调用函数</span></li><li>        <span class="hljs-title function_">initAndReleaseSubjectSegmentation</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1079524313716" device-type="phone,2in1,tablet">subjectSegmentation.release<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1079524313716" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>release(): Promise&lt;void&gt;</p>     <p>释放主体分割服务。使用Promise异步回调。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>返回值：</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.3.1.1" width="38.440000000000005%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.3.1.2" width="61.56%">          <p>说明</p></th>        </tr><tr>         <td class="cellrowborder" width="38.440000000000005%">          <p>Promise&lt;void&gt;</p></td>         <td class="cellrowborder" width="61.56%">          <p>Promise对象，释放接口无返回值。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>示例：</strong></p>     <div _ngcontent-sso-c106="" class="highlight-div"><div _ngcontent-sso-c106="" class="highlight-div-header"><div _ngcontent-sso-c106="" class="highlight-div-header-left"><div _ngcontent-sso-c106="" class="handle-button expand-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sso-c106="" class="highlight-div-header-right"><div _ngcontent-sso-c106="" class="handle-button ai-button"></div><div _ngcontent-sso-c106="" class="handle-button line-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sso-c106="" class="handle-button theme-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sso-c106="" class="handle-button copy-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { subjectSegmentation } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initAndReleaseSubjectSegmentation</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 初始化主体分割服务</span></li><li>  <span class="hljs-keyword">const</span> initResult = <span class="hljs-keyword">await</span> subjectSegmentation.<span class="hljs-title function_">init</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">`Subject segmentation initialization result:<span class="hljs-subst">${initResult}</span>`</span>);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (initResult) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Subject segmentation initialized successfully'</span>);</li><li>
</li><li>    <span class="hljs-comment">// 这里可以添加使用主体分割服务的代码</span></li><li>
</li><li>    <span class="hljs-comment">// 使用完毕后，释放主体分割服务</span></li><li>    <span class="hljs-keyword">await</span> subjectSegmentation.<span class="hljs-title function_">release</span>();</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Subject segmentation released successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'subjectSegmentationSample'</span>, <span class="hljs-string">'Failed to initialize subject segmentation'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'initAndReleaseSubjectSegmentation'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 调用函数</span></li><li>        <span class="hljs-title function_">initAndReleaseSubjectSegmentation</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section3410243584" device-type="phone,2in1,tablet">subjectSegmentation.doSegmentation<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section3410243584" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span></div><p>doSegmentation(visionInfo: VisionInfo, config?: SegmentationConfig): Promise&lt;SegmentationResult&gt;</p>     <p>创建显著性分割实例，并初始化引擎。使用Promise异步回调。</p>     <p><strong>系统能力：</strong>SystemCapability.AI.Vision.SubjectSegmentation</p>     <p><strong>起始版本：</strong>5.0.0(12)</p>     <p><strong>参数：</strong></p>    </div>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.15.1.5.1.1" width="19.2%">         <p>参数名</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.15.1.5.1.2" width="22.07%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.15.1.5.1.3" width="7.42%">         <p>必填</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.15.1.5.1.4" width="51.31%">         <p>说明</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" width="19.2%">         <p>visionInfo</p></td>        <td class="cellrowborder" width="22.07%">         <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section674171818172">VisionInfo</a></p></td>        <td class="cellrowborder" width="7.42%">         <p>是</p></td>        <td class="cellrowborder" width="51.31%">         <p>图片实例。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="19.2%">         <p>config</p></td>        <td class="cellrowborder" width="22.07%">         <p><a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section1268211401742">SegmentationConfig</a></p></td>        <td class="cellrowborder" width="7.42%">         <p>否</p></td>        <td class="cellrowborder" width="51.31%">         <p>显著性分割的可选配置项，包括最大主体个数和是否输出每个主体的详细信息。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>返回值：</strong></p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.17.1.3.1.1" width="45.32%">         <p>类型</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.17.1.3.1.2" width="54.67999999999999%">         <p>说明</p></th>       </tr><tr>        <td class="cellrowborder" width="45.32%">         <p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/core-vision-subjectsegmentation-api#section747541297">SegmentationResult</a>&gt;</p></td>        <td class="cellrowborder" width="54.67999999999999%">         <p>返回显著性主体的结果。</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>错误码：</strong></p>    <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/core-vision-error-code">Core Vision Kit错误码</a>。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="tableClass2_t">                   <tbody><tr class="firstRow">        <th align="left" class="cellrowborder" id="mcps1.3.20.1.3.1.1" width="50%">         <p>错误码ID</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.20.1.3.1.2" width="50%">         <p>错误信息</p></th>       </tr><tr>        <td class="cellrowborder" width="50%">         <p>200</p></td>        <td class="cellrowborder" width="50%">         <p>Run timed out, please try again later.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>401</p></td>        <td class="cellrowborder" width="50%">         <p>The parameter check failed.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000001</p></td>        <td class="cellrowborder" width="50%">         <p>Failed to run, please try again.</p></td>       </tr>       <tr>        <td class="cellrowborder" width="50%">         <p>1011000002</p></td>        <td class="cellrowborder" width="50%">         <p>The service is abnormal.</p></td>       </tr>           </tbody></table></div>    </div>    <p><strong>示例：</strong></p>    <div _ngcontent-sso-c106="" class="highlight-div"><div _ngcontent-sso-c106="" class="highlight-div-header"><div _ngcontent-sso-c106="" class="highlight-div-header-left"><div _ngcontent-sso-c106="" class="handle-button expand-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sso-c106="" class="highlight-div-header-right"><div _ngcontent-sso-c106="" class="handle-button ai-button"></div><div _ngcontent-sso-c106="" class="handle-button line-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sso-c106="" class="handle-button theme-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sso-c106="" class="handle-button copy-button"><div _ngcontent-sso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { subjectSegmentation } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreVisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ImageSegmentationSample'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">subjectSegmentationTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">chooseImage</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">maxNum</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'20'</span>;</li><li>
</li><li>  <span class="hljs-comment">// Select an image from the gallery</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">PhotoSelectOptions</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>  <span class="hljs-title class_">PhotoSelectOptions</span>.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>;</li><li>  <span class="hljs-title class_">PhotoSelectOptions</span>.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoPicker</span>: photoAccessHelper.<span class="hljs-property">PhotoViewPicker</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">PhotoSelectResult</span> = <span class="hljs-keyword">await</span> photoPicker.<span class="hljs-title function_">select</span>(<span class="hljs-title class_">PhotoSelectOptions</span>);</li><li>  <span class="hljs-keyword">let</span> uris = <span class="hljs-title class_">PhotoSelectResult</span>.<span class="hljs-property">photoUris</span>;</li><li>
</li><li>  <span class="hljs-keyword">if</span> (uris.<span class="hljs-property">length</span> !== <span class="hljs-number">1</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Selected uris length is not 1'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Convert the selected image to PixelMap</span></li><li>  <span class="hljs-keyword">let</span> fileSource = <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">open</span>(uris[<span class="hljs-number">0</span>], fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>  <span class="hljs-keyword">let</span> imageSource = image.<span class="hljs-title function_">createImageSource</span>(fileSource.<span class="hljs-property">fd</span>);</li><li>  chooseImage = <span class="hljs-keyword">await</span> imageSource.<span class="hljs-title function_">createPixelMap</span>();</li><li>
</li><li>  <span class="hljs-keyword">if</span> (!chooseImage) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'chooseImage is undefined'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (fileSource) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> fileIo.<span class="hljs-title function_">close</span>(fileSource);</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to close fileSource. Code: <span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// Call the image segmentation interface</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">visionInfo</span>: subjectSegmentation.<span class="hljs-property">VisionInfo</span> = {</li><li>    <span class="hljs-attr">pixelMap</span>: chooseImage</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: subjectSegmentation.<span class="hljs-property">SegmentationConfig</span> = {</li><li>    <span class="hljs-attr">maxCount</span>: <span class="hljs-built_in">parseInt</span>(maxNum),</li><li>    <span class="hljs-attr">enableSubjectDetails</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">enableSubjectForegroundImage</span>: <span class="hljs-literal">true</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: subjectSegmentation.<span class="hljs-property">SegmentationResult</span> = <span class="hljs-keyword">await</span> subjectSegmentation.<span class="hljs-title function_">doSegmentation</span>(visionInfo, config);</li><li>  <span class="hljs-keyword">let</span> outputString = <span class="hljs-string">`Subject count: <span class="hljs-subst">${data.subjectCount}</span>\n`</span>;</li><li>  outputString += <span class="hljs-string">`Max subject count: <span class="hljs-subst">${config.maxCount}</span>\n`</span>;</li><li>  outputString += <span class="hljs-string">`Enable subject details: <span class="hljs-subst">${config.enableSubjectDetails ? <span class="hljs-string">'Yes'</span> : <span class="hljs-string">'No'</span>}</span>\n\n`</span>;</li><li>  <span class="hljs-keyword">let</span> segBox : subjectSegmentation.<span class="hljs-property">Rectangle</span> = data.<span class="hljs-property">fullSubject</span>.<span class="hljs-property">subjectRectangle</span>;</li><li>  <span class="hljs-keyword">let</span> segBoxString = <span class="hljs-string">`Full subject box:\nLeft: <span class="hljs-subst">${segBox.left}</span>, Top: <span class="hljs-subst">${segBox.top}</span>, Width: <span class="hljs-subst">${segBox.width}</span>, Height: <span class="hljs-subst">${segBox.height}</span>\n\n`</span>;</li><li>  outputString += segBoxString;</li><li>
</li><li>  <span class="hljs-keyword">if</span> (config.<span class="hljs-property">enableSubjectDetails</span>) {</li><li>    outputString += <span class="hljs-string">'Individual subject boxes:\n'</span>;</li><li>    <span class="hljs-keyword">if</span> (data.<span class="hljs-property">subjectDetails</span>) {</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">subjectDetails</span>.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">detailSegBox</span>: subjectSegmentation.<span class="hljs-property">Rectangle</span> = data.<span class="hljs-property">subjectDetails</span>[i].<span class="hljs-property">subjectRectangle</span>;</li><li>        outputString += <span class="hljs-string">`Subject <span class="hljs-subst">${i + <span class="hljs-number">1</span>}</span>:\nLeft: <span class="hljs-subst">${detailSegBox.left}</span>, Top: <span class="hljs-subst">${detailSegBox.top}</span>, Width: <span class="hljs-subst">${detailSegBox.width}</span>, Height: <span class="hljs-subst">${detailSegBox.height}</span>\n\n`</span>;</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'Segmentation result: '</span> + outputString);</li><li>}</li><li>
</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'subjectSegmentationTest'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title function_">subjectSegmentationTest</span>().<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Failed to segment a photo. code：<span class="hljs-subst">${err.code}</span>，message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>        });</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>