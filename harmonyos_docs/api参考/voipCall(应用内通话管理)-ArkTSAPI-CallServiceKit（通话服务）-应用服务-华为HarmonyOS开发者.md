<h1 _ngcontent-elr-c119="" class="doc-title ng-star-inserted" title="voipCall (应用内通话管理)"> voipCall (应用内通话管理) </h1>

<div _ngcontent-elr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供应用内通话管理功能，包括向系统上报来电、上报去电、上报通话状态以及获取用户点击事件等。</p> <p>获取用户点击事件需使用<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section7587131203319">voipCall.on</a>在业务流程开始时提前订阅voipCallUiEvent事件，可于业务流程结束后使用<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section84793361325">voipCall.off</a>结束订阅。</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <div class="tiledSection"><h2 id="section1520431611421" device-type="phone,tablet,wearable">导入模块<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1520431611421" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { voipCall } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CallServiceKit'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section0933646875" device-type="phone,tablet,wearable">VoipCallType<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section0933646875" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示通话类型的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.5.1.4.1.1" width="25.942594259425945%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.4.1.2" width="28.5028502850285%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.4.1.3" width="45.554555455545554%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25.942594259425945%"><p>VOIP_CALL_VOICE</p> </td> <td class="cellrowborder" width="28.5028502850285%"><p>0</p> </td> <td class="cellrowborder" width="45.554555455545554%"><p>语音通话。</p> </td> </tr> <tr><td class="cellrowborder" width="25.942594259425945%"><p>VOIP_CALL_VIDEO</p> </td> <td class="cellrowborder" width="28.5028502850285%"><p>1</p> </td> <td class="cellrowborder" width="45.554555455545554%"><p>视频通话。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section24523814719" device-type="phone,tablet,wearable">VoipCallState<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section24523814719" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示通话状态的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.5.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_IDLE</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>呼叫状态空闲。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_RINGING</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>呼叫传入状态。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_ACTIVE</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>激活呼叫状态。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_HOLDING</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>保持呼叫状态。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_DISCONNECTED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>呼叫状态已断开。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_DIALING</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>5</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>拨号中。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_ANSWERED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>6</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>正在接听。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_STATE_DISCONNECTING</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>7</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>正在断开。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section26961727970" device-type="phone,tablet,wearable">VoipCallUiEvent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section26961727970" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示通话事件的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.1" width="36.09360936093609%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.2" width="27.94279427942794%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.3" width="35.963596359635964%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_NONE</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>0</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>无任何事件。</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_VOICE_ANSWER</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>1</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>通话语音接听事件。</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_VIDEO_ANSWER</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>2</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>通话视频接听事件。</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_REJECT</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>3</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>通话拒接事件。</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_HANGUP</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>4</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>通话挂断事件。</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_MUTED</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>5</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>静音事件</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_UNMUTED</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>6</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>取消静音事件</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_SPEAKER_ON</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>7</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>开启扬声器事件</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> <p>（预留事件，暂未支持）</p> </td> </tr> <tr><td class="cellrowborder" width="36.09360936093609%"><p>VOIP_CALL_EVENT_SPEAKER_OFF</p> </td> <td class="cellrowborder" width="27.94279427942794%"><p>8</p> </td> <td class="cellrowborder" width="35.963596359635964%"><p>关闭扬声器事件</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> <p>（预留事件，暂未支持）</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section15252018876" device-type="phone,tablet,wearable">ErrorReason<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section15252018876" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示错误码类型的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>ERROR_NONE</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>无错误出现。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>CELLULAR_CALL_EXISTS</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>当前已存在蜂窝通话。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>VOIP_CALL_EXISTS</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>当前已存在其他应用内通话。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>INVALID_CALL</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>通话无效，比如传入的callId未通过校验等。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>USER_ANSWER_CELLULAR_FIRST</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>4</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>用户选择接听蜂窝。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1178710819715" device-type="phone,tablet,wearable">VoipCallUiEventInfo<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section1178710819715" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>通话事件详细信息。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.1" width="23.119999999999997%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.2" width="19.830000000000002%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.3" width="12.94%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.4" width="14.32%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.9.5.1.6.1.5" width="29.79%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.119999999999997%"><p>callId</p> </td> <td class="cellrowborder" width="19.830000000000002%"><p>string</p> </td> <td class="cellrowborder" width="12.94%"><p>否</p> </td> <td class="cellrowborder" width="14.32%"><p>否</p> </td> <td class="cellrowborder" width="29.79%"><p>应用内通话唯一ID。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>voipCallUiEvent</p> </td> <td class="cellrowborder" width="19.830000000000002%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section26961727970">VoipCallUiEvent</a></p> </td> <td class="cellrowborder" width="12.94%"><p>否</p> </td> <td class="cellrowborder" width="14.32%"><p>否</p> </td> <td class="cellrowborder" width="29.79%"><p>应用内通话事件。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>errorReason</p> </td> <td class="cellrowborder" width="19.830000000000002%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section15252018876">ErrorReason</a></p> </td> <td class="cellrowborder" width="12.94%"><p>否</p> </td> <td class="cellrowborder" width="14.32%"><p>否</p> </td> <td class="cellrowborder" width="29.79%"><p>应用内通话错误码。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section157617591167" device-type="phone,tablet,wearable">VoipCallFailureCause<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section157617591167" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示来电消息建立失败原因的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>OTHER</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>其他失败原因。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>ROUTE_BUSY</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>应用线路忙。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>CONNECTION_FAILED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>通话连接建立失败。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section4221135015444" device-type="phone,tablet,wearable">VoipCallAttribute<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section4221135015444" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>通话属性选项。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.1" width="23.119999999999997%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.2" width="23.11%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.3" width="12.75%"><p>只读</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.4" width="12.15%"><p>可选</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.6.1.5" width="28.87%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="23.119999999999997%"><p>callId</p> </td> <td class="cellrowborder" width="23.11%"><p>string</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>应用内通话唯一ID。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>voipCallType</p> </td> <td class="cellrowborder" width="23.11%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section0933646875">VoipCallType</a></p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>应用内通话类型。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>userName</p> </td> <td class="cellrowborder" width="23.11%"><p>string</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>应用内通话用户昵称。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>userProfile</p> </td> <td class="cellrowborder" width="23.11%"><p>image.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a></p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>用户头像图片，需导入图像处理模块，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>。</p> <p>支持传入的最大图片大小为 221 x 221 像素，推荐传入的图片大小为 112 x 112 像素。通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap#getpixelbytesnumber7" target="_blank">getPixelBytesNumber</a>接口获取到的图片大小要小于196608。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>abilityName</p> </td> <td class="cellrowborder" width="23.11%"><p>string</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>接听后需加载的应用界面ability名称。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>voipCallState</p> </td> <td class="cellrowborder" width="23.11%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section24523814719">VoipCallState</a></p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>否</p> </td> <td class="cellrowborder" width="28.87%"><p>应用内通话状态。</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>showBannerForIncomingCall</p> </td> <td class="cellrowborder" width="23.11%"><p>boolean</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>是</p> </td> <td class="cellrowborder" width="28.87%"><p>支持应用上报来电/去电是否显示横幅通知。</p> <p>true：应用设置来电显示横幅通知，</p> <p>false：应用设置来电不显示横幅通知。</p> <p>默认值为true。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>isConferenceCall</p> </td> <td class="cellrowborder" width="23.11%"><p>boolean</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>是</p> </td> <td class="cellrowborder" width="28.87%"><p>通话是否为会议。</p> <p>true：来电是会议，</p> <p>false：来电不是会议。</p> <p>默认值为false。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr> <tr><td class="cellrowborder" width="23.119999999999997%"><p>isVoiceAnswerSupported</p> </td> <td class="cellrowborder" width="23.11%"><p>boolean</p> </td> <td class="cellrowborder" width="12.75%"><p>否</p> </td> <td class="cellrowborder" width="12.15%"><p>是</p> </td> <td class="cellrowborder" width="28.87%"><p>视频来电/去电是否支持语音接听。</p> <p>true：支持，</p> <p>false：不支持。</p> <p>默认值为true。</p> <p><strong>起始版本</strong>: 5.0.0(12)</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section312217120409" device-type="phone,tablet,wearable">CallAudioEvent<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section312217120409" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>表示静音、扬声器事件的枚举。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>5.0.0(12)</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.1" width="33.33333333333333%"><p>名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.2" width="33.33333333333333%"><p>值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.3" width="33.33333333333333%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="33.33333333333333%"><p>AUDIO_EVENT_MUTED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>0</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>静音。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>AUDIO_EVENT_UNMUTED</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>1</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>取消静音。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>AUDIO_EVENT_SPEAKER_ON</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>2</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>开启扬声器。</p> </td> </tr> <tr><td class="cellrowborder" width="33.33333333333333%"><p>AUDIO_EVENT_SPEAKER_OFF</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>3</p> </td> <td class="cellrowborder" width="33.33333333333333%"><p>关闭扬声器。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section7587131203319" device-type="phone,tablet,wearable">voipCall.on('voipCallUiEvent')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7587131203319" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>on(type: 'voipCallUiEvent', callback: Callback&lt;VoipCallUiEventInfo&gt;):  void</p> <p>订阅voipCallUiEvent事件。使用Callback的方式获取订阅voipCallUiEvent事件的结果。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.3" width="13.91%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.7.1.5.1.4" width="36.09%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>type</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="13.91%"><p>是</p> </td> <td class="cellrowborder" width="36.09%"><p>通话事件类型，参数固定为“voipCallUiEvent”。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callback</p> </td> <td class="cellrowborder" width="25%"><p>Callback&lt;<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section1178710819715">VoipCallUiEventInfo</a>&gt;</p> </td> <td class="cellrowborder" width="13.91%"><p>是</p> </td> <td class="cellrowborder" width="36.09%"><p>回调函数，返回通话事件详细信息对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { voipCall } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CallServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'voipCallUiEvent'</span></span><span class="">, </span><span class=""><span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">voipCall</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">VoipCallUiEventInfo</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>  <span class="">hilog.<span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reading callback. CallId: </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">data</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">callId</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">, voipCallUiEvent: </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">data</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">voipCallUiEvent</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">`</span></span><span class="">)</span><span class="">;</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section84793361325" device-type="phone,tablet,wearable">voipCall.off('voipCallUiEvent')<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section84793361325" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>off(type: 'voipCallUiEvent', callback?: Callback&lt;VoipCallUiEventInfo&gt;):  void</p> <p>取消订阅voipCallUiEvent事件。使用Callback的方式获取取消订阅voipCallUiEvent事件的结果。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.3" width="12.13%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.7.1.5.1.4" width="37.87%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>type</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="12.13%"><p>是</p> </td> <td class="cellrowborder" width="37.87%"><p>通话事件类型，参数固定为“voipCallUiEvent”。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callback</p> </td> <td class="cellrowborder" width="25%"><p>Callback&lt;<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section1178710819715">VoipCallUiEventInfo</a>&gt;</p> </td> <td class="cellrowborder" width="12.13%"><p>否</p> </td> <td class="cellrowborder" width="37.87%"><p>需要取消监听的回调函数，返回通话事件详细信息对象。若不填，则取消当前应用监听该事件的所有回调函数。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.14.10.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { voipCall } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CallServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">off</span></span><span class="">(</span><span class=""><span class="hljs-string">'voipCallUiEvent'</span></span><span class="">, </span><span class=""><span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">data</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">voipCall</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">.</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">VoipCallUiEventInfo</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>  <span class="">hilog</span><span class="">.<span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reading callback. CallId: </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">data</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">callId</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">, voipCallUiEvent: </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">data</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">voipCallUiEvent</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">`</span></span><span class="">)</span><span class="">;</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section13177019143216" device-type="phone,tablet,wearable">voipCall.reportIncomingCall<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section13177019143216" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportIncomingCall(voipCallAttribute: VoipCallAttribute): Promise&lt;ErrorReason&gt;</p> <p>通知来电消息，如果应用来电消息建立失败，需调用<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section155796451716">reportIncomingCallError</a>通知来电建立失败。需设置通话详细信息，见<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a>。使用Promise异步回调。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.3" width="14.78%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.7.1.5.1.4" width="35.22%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>voipCallAttribute</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a></p> </td> <td class="cellrowborder" width="14.78%"><p>是</p> </td> <td class="cellrowborder" width="35.22%"><p>应用内通话详细信息如用户头像、用户昵称、通话唯一标识等，详情请参见<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a>。（应用上报去电时，VoipCallAttribute中的voipCallState属性必须为VOIP_CALL_STATE_DIALING。）</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.9.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.9.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section15252018876">ErrorReason</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回错误码类型。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.15.12.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.15.12.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> </div> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">image</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.ImageKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">voipCall</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">resourceManager</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.LocalizationKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">hilog</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">UIAbility</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-variable">pushService</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PushKit'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">interface</span> <span class=""><span class="hljs-title class_">Content</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-variable">data</span></span><span class="">: </span><span class=""><span class="hljs-title class_">string</span></span><span class="">;</span></li><li>  <span class=""><span class="hljs-variable">callId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">string</span></span><span class="">;</span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">VoipAbility</span> </span><span class="hljs-variable">extends</span> <span class=""><span class="hljs-variable">UIAbility</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-title function_">onCreate</span></span><span class="">()</span><span class="">: </span><span class=""><span class="hljs-title class_">void</span> </span><span class="">{</span></li><li>    <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'VoipExtAbility onCreate.'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class=""><span class="hljs-variable">pushService</span></span><span class="">.</span><span class=""><span class="hljs-title function_">receiveMessage</span></span><span class="">(</span><span class=""><span class="hljs-string">'VoIP'</span></span><span class="">, </span><span class="hljs-keyword">this</span><span class="">, </span><span class="hljs-variable">async</span> <span class="">(</span><span class=""><span class="hljs-variable">data</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">content</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Content</span> </span><span class="">= </span><span class=""><span class="hljs-variable">JSON</span></span><span class="">.</span><span class=""><span class="hljs-title function_">parse</span></span><span class="">(</span><span class=""><span class="hljs-variable">data</span></span><span class="">.</span><span class=""><span class="hljs-variable">data</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">callId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">string</span> </span><span class="">= </span><span class=""><span class="hljs-variable">content</span></span><span class="">.</span><span class=""><span class="hljs-variable">callId</span></span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Get voip message successfully: %{public}s'</span></span><span class="">, </span><span class=""><span class="hljs-variable">callId</span></span><span class="">)</span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">此处为用户头像，需要创建</span></span><span class=""><span class="hljs-comment">PixelMap</span></span><span class=""><span class="hljs-comment">类型</span></span></li><li>      <span class="hljs-keyword">const</span> <span class=""><span class="hljs-variable">resourceMgr</span> </span><span class="">: </span><span class=""><span class="hljs-title class_">resourceManager</span></span><span class="">.</span><span class=""><span class="hljs-title class_">ResourceManager</span> </span><span class="">= </span><span class="hljs-keyword">this</span><span class="">.</span><span class=""><span class="hljs-variable">context</span></span><span class="">.</span><span class=""><span class="hljs-variable">resourceManager</span></span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class=""><span class="hljs-variable">fileData</span> </span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="hljs-variable">await</span> <span class=""><span class="hljs-variable">resourceMgr</span></span><span class="">.</span><span class=""><span class="hljs-title function_">getRawFileContent</span></span><span class="">(</span><span class=""><span class="hljs-string">'example.png'</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class=""><span class="hljs-variable">buffer</span> </span><span class="">= </span><span class=""><span class="hljs-variable">fileData</span></span><span class="">.</span><span class=""><span class="hljs-variable">buffer</span></span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class=""><span class="hljs-variable">imageSource</span> </span><span class="">: </span><span class=""><span class="hljs-title class_">image</span></span><span class="">.</span><span class=""><span class="hljs-title class_">ImageSource</span> </span><span class="">= </span><span class=""><span class="hljs-variable">image</span></span><span class="">.</span><span class=""><span class="hljs-title function_">createImageSource</span></span><span class="">(</span><span class=""><span class="hljs-variable">buffer</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class=""><span class="hljs-variable">pixelMap</span> </span><span class="">: </span><span class=""><span class="hljs-title class_">image</span></span><span class="">.</span><span class=""><span class="hljs-title class_">PixelMap</span> </span><span class="">= </span><span class="hljs-variable">await</span> <span class=""><span class="hljs-variable">imageSource</span></span><span class="">.</span><span class=""><span class="hljs-title function_">createPixelMap</span></span><span class="">()</span><span class="">;</span></li><li>      <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">pixelMap</span></span><span class="">) </span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">pixelMap</span></span><span class="">.</span><span class=""><span class="hljs-title function_">getImageInfo</span></span><span class="">((</span><span class=""><span class="hljs-variable">err</span></span><span class="">, </span><span class=""><span class="hljs-variable">imageInfo</span></span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>          <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">imageInfo</span></span><span class="">) </span><span class="">{</span></li><li>            <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class="">`<span class="hljs-variable">DemoPushMessageAbility</span> <span class="hljs-variable">imageInfo</span>: </span><span class="">${</span><span class=""><span class="hljs-variable">imageInfo</span></span><span class="">.</span><span class=""><span class="hljs-variable">size</span></span><span class="">.</span><span class=""><span class="hljs-variable">width</span></span><span class="">}</span><span class=""> * </span><span class="">${</span><span class=""><span class="hljs-variable">imageInfo</span></span><span class="">.</span><span class=""><span class="hljs-variable">size</span></span><span class="">.</span><span class=""><span class="hljs-variable">height</span></span><span class="">}</span><span class="">.`</span><span class="">)</span><span class="">;</span></li><li>          <span class="">}</span></li><li><span class="">        }</span><span class="">)</span><span class="">;</span></li><li>      <span class="">}</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">构建通话详细信息的对象</span></span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">callInfo</span></span><span class="">: </span><span class=""><span class="hljs-title class_">voipCall</span></span><span class="">.</span><span class=""><span class="hljs-title class_">VoipCallAttribute</span> </span><span class="">= </span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">callId</span></span><span class="">: </span><span class=""><span class="hljs-title class_">callId</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">voipCallType</span></span><span class="">: </span><span class=""><span class="hljs-title class_">voipCall</span></span><span class="">.</span><span class=""><span class="hljs-title class_">VoipCallType</span></span><span class="">.</span><span class=""><span class="hljs-title class_">VOIP_CALL_VOICE</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">userName</span></span><span class="">: </span><span class=""><span class="hljs-string">"name"</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">userProfile</span></span><span class="">: </span><span class=""><span class="hljs-title class_">pixelMap</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'ability'</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-variable">voipCallState</span></span><span class="">: </span><span class=""><span class="hljs-title class_">voipCall</span></span><span class="">.</span><span class=""><span class="hljs-title class_">VoipCallState</span></span><span class="">.</span><span class=""><span class="hljs-title class_">VOIP_CALL_STATE_RINGING</span></span></li><li>      <span class="">}</span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">通知来电消息</span></span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-variable">error</span> </span><span class="">= </span><span class="hljs-variable">await</span> <span class=""><span class="hljs-variable">voipCall</span></span><span class="">.</span><span class=""><span class="hljs-title function_">reportIncomingCall</span></span><span class="">(</span><span class=""><span class="hljs-variable">callInfo</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">if</span> <span class="">(</span><span class=""><span class="hljs-variable">error</span> </span><span class="">!= </span><span class=""><span class="hljs-variable">voipCall</span></span><span class="">.</span><span class=""><span class="hljs-variable">ErrorReason</span></span><span class="">.</span><span class=""><span class="hljs-variable">ERROR_NONE</span></span><span class="">) </span><span class="">{</span></li><li>        <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Failed to report incoming call: %{public}d'</span></span><span class="">, </span><span class=""><span class="hljs-variable">error</span></span><span class="">)</span><span class="">;</span></li><li>        <span class="hljs-keyword">return</span><span class="">;</span></li><li>      <span class="">}</span></li><li>
</li><li>      <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Get voip message end.'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class=""><span class="hljs-variable">hilog</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in registering VoIP.'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div> <div class="tiledSection"><h2 id="section148731244182011" device-type="phone,tablet,wearable">voipCall.reportOutgoingCall<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section148731244182011" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportOutgoingCall(voipCallAttribute: VoipCallAttribute): Promise&lt;ErrorReason&gt;</p> <p>应用上报去电。需设置通话详细信息，见<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a>。使用Promise异步回调。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.3" width="14.78%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.7.1.5.1.4" width="35.22%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>voipCallAttribute</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a></p> </td> <td class="cellrowborder" width="14.78%"><p>是</p> </td> <td class="cellrowborder" width="35.22%"><p>应用内通话详细信息如用户头像、用户昵称、通话唯一标识等，详情请参见<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section4221135015444">VoipCallAttribute</a>。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.9.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.9.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section15252018876">ErrorReason</a>&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象，返回错误码类型。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.17.12.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.12.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">image </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.ImageKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">voipCall </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">resourceManager </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.LocalizationKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-title class_">UIAbility</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">pushService </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PushKit'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">interface</span> <span class=""><span class="hljs-title class_">Content</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-attr">data</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li>  <span class=""><span class="hljs-attr">callId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">VoipExtAbility</span> </span><span class="hljs-keyword">extends</span> <span class=""><span class="hljs-title class_ inherited__">UIAbility</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-title function_">onCreate</span></span><span class="">()</span><span class="">: </span><span class=""><span class="hljs-built_in">void</span> </span><span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'VoipExtAbility onCreate.'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">pushService</span><span class="">.</span><span class=""><span class="hljs-title function_">receiveMessage</span></span><span class="">(</span><span class=""><span class="hljs-string">'VoIP'</span></span><span class="">, </span><span class="hljs-variable language_">this</span><span class="">, </span><span class="hljs-keyword">async</span> <span class="">(</span><span class="">data</span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">content</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Content</span> </span><span class="">= </span><span class=""><span class="hljs-title class_">JSON</span></span><span class="">.</span><span class=""><span class="hljs-title function_">parse</span></span><span class="">(</span><span class="">data</span><span class="">.</span><span class=""><span class="hljs-property">data</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">callId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span> </span><span class="">= </span><span class="">content</span><span class="">.</span><span class=""><span class="hljs-property">callId</span></span><span class="">;</span></li><li>
</li><li>      <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Get voip message successfully: %{public}s'</span></span><span class="">, </span><span class="">callId</span><span class="">)</span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">此处为用户头像，需要创建</span></span><span class=""><span class="hljs-comment">PixelMap</span></span><span class=""><span class="hljs-comment">类型</span></span></li><li>      <span class="hljs-keyword">const</span> <span class="">resourceMgr </span><span class="">: </span><span class="">resourceManager</span><span class="">.</span><span class=""><span class="hljs-property">ResourceManager</span> </span><span class="">= </span><span class="hljs-variable language_">this</span><span class="">.</span><span class=""><span class="hljs-property">context</span></span><span class="">.</span><span class=""><span class="hljs-property">resourceManager</span></span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class="">fileData </span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="hljs-keyword">await</span> <span class="">resourceMgr</span><span class="">.</span><span class=""><span class="hljs-title function_">getRawFileContent</span></span><span class="">(</span><span class=""><span class="hljs-string">'example.png'</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class="">buffer </span><span class="">= </span><span class="">fileData</span><span class="">.</span><span class=""><span class="hljs-property">buffer</span></span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class="">imageSource </span><span class="">: </span><span class="">image</span><span class="">.</span><span class=""><span class="hljs-property">ImageSource</span> </span><span class="">= </span><span class="">image</span><span class="">.</span><span class=""><span class="hljs-title function_">createImageSource</span></span><span class="">(</span><span class="">buffer</span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">const</span> <span class="">pixelMap </span><span class="">: </span><span class="">image</span><span class="">.</span><span class=""><span class="hljs-property">PixelMap</span> </span><span class="">= </span><span class="hljs-keyword">await</span> <span class="">imageSource</span><span class="">.</span><span class=""><span class="hljs-title function_">createPixelMap</span></span><span class="">()</span><span class="">;</span></li><li>      <span class="hljs-keyword">if</span> <span class="">(</span><span class="">pixelMap</span><span class="">) </span><span class="">{</span></li><li>        <span class="">pixelMap</span><span class="">.</span><span class=""><span class="hljs-title function_">getImageInfo</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">, </span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">imageInfo</span></span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>          <span class="hljs-keyword">if</span> <span class="">(</span><span class="">imageInfo</span><span class="">) </span><span class="">{</span></li><li>            <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`DemoPushMessageAbility imageInfo: </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">imageInfo</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">size</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">width</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string"> * </span></span><span class=""><span class="hljs-string"><span class="hljs-subst">${</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">imageInfo</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">size</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">.</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">height</span></span></span><span class=""><span class="hljs-string"><span class="hljs-subst">}</span></span></span><span class=""><span class="hljs-string">.`</span></span><span class="">)</span><span class="">;</span></li><li>          <span class="">}</span></li><li><span class="">        }</span><span class="">)</span><span class="">;</span></li><li>      <span class="">}</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">构建通话详细信息的对象</span></span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">callInfo</span></span><span class="">: </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallAttribute</span> </span><span class="">= </span><span class="">{</span></li><li>        <span class=""><span class="hljs-attr">callId</span></span><span class="">: </span><span class="">callId</span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">voipCallType</span></span><span class="">: </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallType</span></span><span class="">.</span><span class=""><span class="hljs-property">VOIP_CALL_VOICE</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">userName</span></span><span class="">: </span><span class=""><span class="hljs-string">"name"</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">userProfile</span></span><span class="">: </span><span class="">pixelMap</span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">abilityName</span></span><span class="">: </span><span class=""><span class="hljs-string">'ability'</span></span><span class="">,</span></li><li>        <span class=""><span class="hljs-attr">voipCallState</span></span><span class="">: </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallState</span></span><span class="">.</span><span class=""><span class="hljs-property">VOIP_CALL_STATE_DIALING</span></span></li><li>      <span class="">}</span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">通知去电消息</span></span></li><li>      <span class="hljs-keyword">let</span> <span class="">error </span><span class="">= </span><span class="hljs-keyword">await</span> <span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">reportOutgoingCall</span></span><span class="">(</span><span class="">callInfo</span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">if</span> <span class="">(</span><span class="">error </span><span class="">!= </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">ErrorReason</span></span><span class="">.</span><span class=""><span class="hljs-property">ERROR_NONE</span></span><span class="">) </span><span class="">{</span></li><li>        <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">error</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Failed to report outgoing call: %{public}d'</span></span><span class="">, </span><span class="">error</span><span class="">)</span><span class="">;</span></li><li>        <span class="hljs-keyword">return</span><span class="">;</span></li><li>      <span class="">}</span></li><li>      <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Get voip message end.'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in registering VoIP.'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div> <div class="tiledSection"><h2 id="section13377133175113" device-type="phone,tablet,wearable">voipCall.reportCallAudioEventChange<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section13377133175113" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportCallAudioEventChange(callId: string, callAudioEvent: CallAudioEvent): Promise&lt;void&gt;</p> <p>应用上报通话中的静音、扬声器事件。使用Promise异步回调。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.3" width="14.78%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.7.1.5.1.4" width="35.22%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>callId</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="14.78%"><p>是</p> </td> <td class="cellrowborder" width="35.22%"><p>应用内通话唯一ID。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callAudioEvent</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section312217120409">CallAudioEvent</a></p> </td> <td class="cellrowborder" width="14.78%"><p>是</p> </td> <td class="cellrowborder" width="35.22%"><p>VoIP开/关静音、扬声器事件，详情请参见<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section312217120409">CallAudioEvent</a>。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.9.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.9.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.20.12.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.20.12.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">voipCall </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class=""><span class="hljs-title class_">UIAbility</span> </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.AbilityKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">pushService </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PushKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">interface</span> <span class=""><span class="hljs-title class_">Content</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-attr">data</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li>  <span class=""><span class="hljs-attr">callId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span></span><span class="">;</span></li><li><span class="">}</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class=""><span class="hljs-title class_">VoipExtAbility</span> </span><span class="hljs-keyword">extends</span> <span class=""><span class="hljs-title class_ inherited__">UIAbility</span> </span><span class="">{</span></li><li>  <span class=""><span class="hljs-title function_">onCreate</span></span><span class="">()</span><span class="">: </span><span class=""><span class="hljs-built_in">void</span> </span><span class="">{</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'VoipExtAbility onCreate.'</span></span><span class="">)</span><span class="">;</span></li><li>    <span class="">pushService</span><span class="">.</span><span class=""><span class="hljs-title function_">receiveMessage</span></span><span class="">(</span><span class=""><span class="hljs-string">'VoIP'</span></span><span class="">, </span><span class="hljs-variable language_">this</span><span class="">, </span><span class="hljs-keyword">async</span> <span class="">(</span><span class="">data</span><span class="">) </span><span class="">=</span><span class="">&gt;</span> <span class="">{</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">content</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Content</span> </span><span class="">= </span><span class=""><span class="hljs-title class_">JSON</span></span><span class="">.</span><span class=""><span class="hljs-title function_">parse</span></span><span class="">(</span><span class="">data</span><span class="">.</span><span class=""><span class="hljs-property">data</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">callId</span></span><span class="">: </span><span class=""><span class="hljs-built_in">string</span> </span><span class="">= </span><span class="">content</span><span class="">.</span><span class=""><span class="hljs-property">callId</span></span><span class="">;</span></li><li>
</li><li>      <span class="hljs-keyword">let</span> <span class="">callAudioEvent </span><span class="">: </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">CallAudioEvent</span> </span><span class="">= </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">CallAudioEvent</span></span><span class="">.</span><span class=""><span class="hljs-property">AUDIO_EVENT_MUTED</span></span><span class="">;</span></li><li>
</li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">上报通话中静音、扬声器事件</span></span></li><li>      <span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">reportCallAudioEventChange</span></span><span class="">(</span><span class="">callId</span><span class="">, </span><span class="">callAudioEvent</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>        <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reporting call audio event change.`</span></span><span class="">)</span><span class="">;</span></li><li>      <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class="">}</span><span class="">)</span><span class="">;</span></li><li>    <span class="">hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">'Succeeded in registering VoIP.'</span></span><span class="">)</span><span class="">;</span></li><li>  <span class="">}</span></li><li><span class="">}</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section491515915329" device-type="phone,tablet,wearable">voipCall.reportCallStateChange<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section491515915329" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportCallStateChange(callId: string, callState: VoipCallState): Promise&lt;void&gt;</p> <p>通知应用内通话状态变化，使用Promise异步回调。</p> <p>该接口不能改变通话类型，例如，语音通话不能升级为视频通话，视频通话也不能降级为语音通话，如需上述升降级操作，请调用<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section5360122718341">voipCall.reportCallStateChange</a>。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>callId</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>呼叫ID。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callState</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section24523814719">VoipCallState</a></p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>通话状态，参考<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section24523814719">VoipCallState</a>。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.21.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">voipCall </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">reportCallStateChange</span></span><span class="">(</span><span class=""><span class="hljs-string">"callId123"</span></span><span class="">, </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallState</span></span><span class="">.</span><span class=""><span class="hljs-property">VOIP_CALL_STATE_ACTIVE</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li><span class="">  hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reporting call state change.`</span></span><span class="">)</span><span class="">;</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section5360122718341" device-type="phone,tablet,wearable">voipCall.reportCallStateChange<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section5360122718341" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportCallStateChange(callId: string, callState: VoipCallState, callType: VoipCallType): Promise&lt;void&gt;</p> <p>通知应用内通话状态变化，并指定通话类型，使用Promise异步回调。</p> <p>对于视频来电语音接听、通话中视频降语音或者语音升视频，需要调用该接口，并传入正确的callType。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>5.0.0(12)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.8.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>callId</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>呼叫ID。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callState</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section24523814719">VoipCallState</a></p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>通话状态，参考<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section24523814719">VoipCallState</a>。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>callType</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section0933646875">VoipCallType</a></p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>通话类型，参考<a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section0933646875">VoipCallType</a>。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.10.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.22.13.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.22.13.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">voipCall </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">reportCallStateChange</span></span><span class="">(</span><span class=""><span class="hljs-string">"callId123"</span></span><span class="">, </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallState</span></span><span class="">.</span><span class=""><span class="hljs-property">VOIP_CALL_STATE_ACTIVE</span></span><span class="">, </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallType</span></span><span class="">.</span><span class=""><span class="hljs-property">VOIP_CALL_VOICE</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li><span class="">  hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reporting call state change.`</span></span><span class="">)</span><span class="">;</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section155796451716" device-type="phone,tablet,wearable">voipCall.reportIncomingCallError<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section155796451716" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>reportIncomingCallError(callId: string, voipCallFailureCause: VoipCallFailureCause): Promise&lt;void&gt;</p> <p>通知来电消息建立失败的原因，使用Promise异步回调。</p> <p><strong>系统能力</strong>：SystemCapability.Telephony.VoipCallManager</p> <p><strong>起始版本：</strong>4.1.0(11)</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.1" width="25%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.2" width="25%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.3" width="25%"><p>必填</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.7.1.5.1.4" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%"><p>callId</p> </td> <td class="cellrowborder" width="25%"><p>string</p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>应用内通话唯一ID。</p> </td> </tr> <tr><td class="cellrowborder" width="25%"><p>voipCallFailureCause</p> </td> <td class="cellrowborder" width="25%"><p><a href="/consumer/cn/doc/harmonyos-references/call-voipcall#section157617591167">VoipCallFailureCause</a></p> </td> <td class="cellrowborder" width="25%"><p>是</p> </td> <td class="cellrowborder" width="25%"><p>来电消息建立失败原因。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.23.9.1.3.1.1" width="50%"><p>类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.9.1.3.1.2" width="50%"><p>说明</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>Promise&lt;void&gt;</p> </td> <td class="cellrowborder" width="50%"><p>Promise对象。无返回结果的Promise对象。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>错误码：</strong></p> <p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/call-error-code">ArkTS API错误码</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.23.12.1.3.1.1" width="50%"><p>错误码ID</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.23.12.1.3.1.2" width="50%"><p>错误信息</p> </th> </tr><tr><td class="cellrowborder" width="50%"><p>401</p> </td> <td class="cellrowborder" width="50%"><p>Parameter error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200001</p> </td> <td class="cellrowborder" width="50%"><p>Invalid parameter value.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200002</p> </td> <td class="cellrowborder" width="50%"><p>Operation failed. Cannot connect to service.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200003</p> </td> <td class="cellrowborder" width="50%"><p>System internal error.</p> </td> </tr> <tr><td class="cellrowborder" width="50%"><p>1007200999</p> </td> <td class="cellrowborder" width="50%"><p>Unknown error code.</p> </td> </tr>  </tbody></table></div> </div> <p><strong>示例：</strong></p> <div _ngcontent-elr-c106="" class="highlight-div"><div _ngcontent-elr-c106="" class="highlight-div-header"><div _ngcontent-elr-c106="" class="highlight-div-header-left"><div _ngcontent-elr-c106="" class="handle-button expand-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-elr-c106="" class="highlight-div-header-right"><div _ngcontent-elr-c106="" class="handle-button ai-button"></div><div _ngcontent-elr-c106="" class="handle-button line-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-elr-c106="" class="handle-button theme-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-elr-c106="" class="handle-button copy-button"><div _ngcontent-elr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-elr-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">voipCall </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.CallServiceKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">hilog </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.PerformanceAnalysisKit'</span></span><span class="">;</span></li><li>
</li><li><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-title function_">reportIncomingCallError</span></span><span class="">(</span><span class=""><span class="hljs-string">"callId123"</span></span><span class="">, </span><span class="">voipCall</span><span class="">.</span><span class=""><span class="hljs-property">VoipCallFailureCause</span></span><span class="">.</span><span class=""><span class="hljs-property">OTHER</span></span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(<span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li><span class="">  hilog</span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(<span class="hljs-number">0x0000</span></span><span class="">, </span><span class=""><span class="hljs-string">'testTag'</span></span><span class="">, </span><span class=""><span class="hljs-string">`Succeeded in reporting incoming call error.`</span></span><span class="">)</span><span class="">;</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div> </div> </div> <div></div></div>