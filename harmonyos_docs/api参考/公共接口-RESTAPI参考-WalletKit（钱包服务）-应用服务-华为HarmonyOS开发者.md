<h1 _ngcontent-wss-c119="" class="doc-title ng-star-inserted" title="公共接口"> 公共接口 </h1>

<div _ngcontent-wss-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section37263211548">获取AccessToken<i class="anchor-icon anchor-icon-link" anchorid="section37263211548" tips="复制节点链接"></i></h2>          <p>此接口用于获取访问token，向钱包云服务的每次https请求都需要传入访问的token，该token相当于一个访问许可，钱包云服务器收到其请求时会对其进行校验。</p>    </div>    <div class="tiledSection">     <h3 id="section1168717368813" class="firsth2">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section1168717368813" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.2.2.1.3.1.1" width="20%">          <p>承载协议</p></th>         <td class="cellrowborder" width="80%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.2.2.1.3.2.1" width="20%">          <p>接口方向</p></th>         <td class="cellrowborder" width="80%">          <p>三方业务管理服务-&gt;钱包云服务</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.2.2.1.3.3.1" width="20%">          <p>接口URL</p></th>         <td class="cellrowborder" width="80%">          <p>https://oauth-login.cloud.huawei.com/oauth2/v3/token</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.2.2.1.3.4.1" width="20%">          <p>数据格式</p></th>         <td class="cellrowborder" width="80%">          <p>请求消息：Content-Type: application/x-www-form-urlencoded</p>          <p>响应消息：Content-Type: application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section19527740171019">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section19527740171019" tips="复制节点链接"></i></h3>          <p><strong>Request Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/x-www-form-urlencoded</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Request Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>grant_type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>填写为“client_credentials”，表示为客户端模式。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">          <p>client_id</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-dev-overview" target="_blank">应用开发准备</a>中得到的OAuth 2.0客户端ID，对于AppGallery Connect类应用，该值为应用的Client ID</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">          <p>client_secret</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-dev-overview" target="_blank">应用开发准备</a>中给客户端ID分配的密钥，对于AppGallery Connect类应用，该值为应用的Client Secret。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section3569104718459">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section3569104718459" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">grant_type</span>=client_credentials&amp;client_id=&lt;客户端ID&gt;&amp;client_secret=&lt;客户端密钥&gt;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section125933462283">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section125933462283" tips="复制节点链接"></i></h3>          <p><strong>Response Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Response Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.5.1.1" width="17%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.5.1.2" width="13%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.5.1.3" width="13%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.5.1.4" width="56.99999999999999%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>token_type</p></td>         <td class="cellrowborder" width="13%">          <p>是</p></td>         <td class="cellrowborder" width="13%">          <p>String</p></td>         <td class="cellrowborder" width="56.99999999999999%">          <p>固定字符串“Bearer”。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>access_token</p></td>         <td class="cellrowborder" width="13%">          <p>是</p></td>         <td class="cellrowborder" width="13%">          <p>String</p></td>         <td class="cellrowborder" width="56.99999999999999%">          <p>Access Token。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>expires_in</p></td>         <td class="cellrowborder" width="13%">          <p>否</p></td>         <td class="cellrowborder" width="13%">          <p>Long</p></td>         <td class="cellrowborder" width="56.99999999999999%">          <p>Access Token的过期时间，以秒为单位。默认60分钟过期。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section18194191414523">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section18194191414523" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"access_token"</span>: <span class="hljs-string">"&lt;返回的Access Token&gt;"</span>,</li><li>  <span class="hljs-string">"expires_in"</span>: <span class="hljs-number">3600</span>,</li><li>  <span class="hljs-string">"token_type"</span>: <span class="hljs-string">"Bearer"</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1127273862419">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section1127273862419" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title class_">String</span> <span class="hljs-title function_">getToken</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> clientId, <span class="hljs-built_in">String</span> clientSecret</span>) {</li><li>        <span class="hljs-title class_">HttpHeaders</span> header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpHeaders</span>();</li><li>        header.<span class="hljs-title function_">setContentType</span>(<span class="hljs-title class_">MediaType</span>.<span class="hljs-property">APPLICATION_FORM_URLENCODED</span>);</li><li>
</li><li>        <span class="hljs-title class_">MultiValueMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; map = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedMultiValueMap</span>&lt;&gt;();</li><li>        map.<span class="hljs-title function_">add</span>(<span class="hljs-string">"grant_type"</span>, <span class="hljs-string">"client_credentials"</span>);</li><li>        map.<span class="hljs-title function_">add</span>(<span class="hljs-string">"client_id"</span>, clientId);</li><li>        map.<span class="hljs-title function_">add</span>(<span class="hljs-string">"client_secret"</span>, clientSecret);</li><li>
</li><li>        <span class="hljs-title class_">String</span> tokenUrl = <span class="hljs-title class_">ConfigUtil</span>.<span class="hljs-title function_">instants</span>().<span class="hljs-title function_">getValue</span>(<span class="hljs-string">"gw.tokenUrl"</span>);</li><li>
</li><li>        <span class="hljs-title class_">HttpEntity</span>&lt;<span class="hljs-title class_">MultiValueMap</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt;&gt; entity = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpEntity</span>&lt;&gt;(map, header);</li><li>        <span class="hljs-title class_">ResponseEntity</span>&lt;<span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>&gt; exchange =</li><li>            <span class="hljs-variable constant_">REST_TEMPLATE</span>.<span class="hljs-title function_">exchange</span>(tokenUrl, <span class="hljs-title class_">HttpMethod</span>.<span class="hljs-property">POST</span>, entity, <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span>.<span class="hljs-property">class</span>);</li><li>
</li><li>        <span class="hljs-title class_">JSON</span><span class="hljs-built_in">Object</span> response = exchange.<span class="hljs-title function_">getBody</span>();</li><li>        <span class="hljs-keyword">if</span> (response == <span class="hljs-literal">null</span>) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"Get null token response."</span>);</li><li>        }</li><li>        <span class="hljs-title class_">String</span> accessToken = response.<span class="hljs-title function_">getString</span>(<span class="hljs-string">"access_token"</span>);</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Strings</span>.<span class="hljs-title function_">isEmpty</span>(accessToken)) {</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">NullPointerException</span>(<span class="hljs-string">"Get null access token."</span>);</li><li>        }</li><li>        <span class="hljs-keyword">return</span> accessToken;</li><li>    }</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section113578586311">设备认证<i class="anchor-icon anchor-icon-link" anchorid="section113578586311" tips="复制节点链接"></i></h2>          <p>预个人化执行完成后，华为钱包App经由钱包云服务中转后请求认证设备，将applet身份公钥以及身份公钥的钱包服务器签名携带在请求体中，向三方业务管理服务请求三方业务管理服务认证授权证书。</p>    </div>    <div class="tiledSection">     <h3 id="section735720588313" class="firsth2">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section735720588313" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.9.2.1.3.1.1" width="20%">          <p>承载协议</p></th>         <td class="cellrowborder" width="80%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.9.2.1.3.2.1" width="20%">          <p>接口方向</p></th>         <td class="cellrowborder" width="80%">          <p>钱包云服务-&gt;三方业务管理服务</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.9.2.1.3.3.1" width="20%">          <p>接口URL</p></th>         <td class="cellrowborder" width="80%">          <p>https://{webServiceURL}/v1/passes/registrations</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.9.2.1.3.4.1" width="20%">          <p>数据格式</p></th>         <td class="cellrowborder" width="80%">          <p>请求消息：Content-Type: application/json;charset=UTF-8</p>          <p>响应消息：Content-Type: application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>webServiceURL为DK业务管理服务域名。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section183587583317">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section183587583317" tips="复制节点链接"></i></h3>          <p><strong>Request Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">          <p>Authorization</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195">申请钥匙卡片</a>时linkDevicePass参数中的token值，用于校验该请求是否合法。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Request Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.2" width="12.41%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.3" width="13.87%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" rowspan="5" width="13.61%">          <p>requestBody</p>          <p></p>          <p></p></td>         <td class="cellrowborder" width="12.41%">          <p>passTypeIdentifier</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>时注册的服务号，需要开发者到华为AGC网站申请。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>serialNumber</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>车钥匙卡片在华为钱包云服务器中的卡号，回调时以便发卡方根据此值识别具体的卡券记录。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>passVersion</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>可选</p></td>         <td class="cellrowborder">          <p>版本号，固定10.0。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>userDeviceId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>用户在当前设备上的唯一标识。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>transId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>随机数。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>signature</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>Applet的身份私钥对requestBody的Hash值的签名。</p></td>        </tr>        <tr>         <td class="cellrowborder" rowspan="2" width="13.61%">          <p>certificate</p></td>         <td class="cellrowborder" width="12.41%">          <p>signature</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>钱包云服务使用钱包服务器私钥对publicKey的签名值。DK业务管理服务收到该请求后，需要使用钱包云服务公钥对其进行验签。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>publicKey</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>Applet的身份公钥。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section11396337262">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section11396337262" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"requestBody"</span>: {</li><li>    <span class="hljs-string">"passTypeIdentifier"</span>: <span class="hljs-string">"Replace with the Service ID you applied on AGC"</span>,</li><li>    <span class="hljs-string">"passVersion"</span>: <span class="hljs-string">"10.0"</span>,</li><li>    <span class="hljs-string">"serialNumber"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>,</li><li>    <span class="hljs-string">"transId"</span>: <span class="hljs-string">"16198381994485116358"</span>,</li><li>    <span class="hljs-string">"userDeviceId"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"certificate"</span>: {</li><li>    <span class="hljs-string">"publicKey"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section10139133322619">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section10139133322619" tips="复制节点链接"></i></h3>          <p><strong>Response Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Response Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.6.1.2" width="12.41%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.6.1.3" width="13.87%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="13.61%">          <p>Httpstatus</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>接口网络状态码。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>response</p></td>         <td class="cellrowborder" width="12.41%">          <p>certificate</p></td>         <td class="cellrowborder" width="13.87%">          <p>Certificate</p></td>         <td class="cellrowborder" width="13.87%">          <p>可选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>DK业务管理服务使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>步骤5生成的私钥对publicKey进行签名后返回。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Certificate参数类型说明</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.1" width="16.259999999999998%">          <p>certificate子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.2" width="9.629999999999999%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.3" width="14.08%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.7.1.5.1.4" width="60.029999999999994%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="16.259999999999998%">          <p>signature</p></td>         <td class="cellrowborder" width="9.629999999999999%">          <p>String</p></td>         <td class="cellrowborder" width="14.08%">          <p>必选</p></td>         <td class="cellrowborder" width="60.029999999999994%">          <p>钱包云服务使用钱包服务器私钥对publicKey的签名值。DK业务管理服务收到该请求后，需要使用钱包云服务公钥对其进行验签。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16.259999999999998%">          <p>publicKey</p></td>         <td class="cellrowborder" width="9.629999999999999%">          <p>String</p></td>         <td class="cellrowborder" width="14.08%">          <p>必选</p></td>         <td class="cellrowborder" width="60.029999999999994%">          <p>Applet的身份公钥。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section0141153311263">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section0141153311263" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"httpStatus"</span>: <span class="hljs-string">"0"</span>,</li><li>  <span class="hljs-string">"response"</span>: {</li><li>    <span class="hljs-string">"certificate"</span>: {</li><li>      <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span>,</li><li>      <span class="hljs-string">"publicKey"</span>: <span class="hljs-string">"xxx"</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section143598581439">三方业务管理服务处理调用示例<i class="anchor-icon anchor-icon-link" anchorid="section143598581439" tips="复制节点链接"></i></h3>          <p>完整的调用示例，请参见<a href="https://gitcode.com/harmonyos_samples/wallet-kit-sample-code-severdemo-nfc-java" target="_blank">钱包服务-服务端卡片激活</a>示例代码。</p>     <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RegistrationsResponse</span> <span class="hljs-title function_">dealWithRegisterRequest</span>(<span class="hljs-params"><span class="hljs-built_in">String</span> token, RegistrationsRequest request</span>) {</li><li>        <span class="hljs-title class_">RegistrationsResponse</span> response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegistrationsResponse</span>();</li><li>        <span class="hljs-keyword">if</span> (token == <span class="hljs-literal">null</span>) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_PARAM_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">ParamChecker</span>.<span class="hljs-title function_">isValidRegistrationsRequest</span>(request)) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_PARAM_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-title class_">Certificate</span> walletCertificate = request.<span class="hljs-title function_">getCertificate</span>();</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-title function_">verifyWalletCert</span>(walletCertificate)) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_SIGN_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>
</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">ParamChecker</span>.<span class="hljs-title function_">hashSignatureCheck</span>(request.<span class="hljs-title function_">toJsonString</span>(), request.<span class="hljs-title function_">getSignature</span>(),</li><li>                appletAuthPublicKey, <span class="hljs-title class_">DataConvertUtil</span>.<span class="hljs-property">SIGN_MODE_SHA256_RSA_MGF1</span>)) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_SIGN_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">String</span> userDeviceId = request.<span class="hljs-title function_">getRequestBody</span>().<span class="hljs-title function_">getUserDeviceId</span>();</li><li>        response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_OK</span>));</li><li>        <span class="hljs-title class_">Response</span> responseBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>();</li><li>        <span class="hljs-title class_">Certificate</span> serverCert = <span class="hljs-title class_">PassData</span>.<span class="hljs-title function_">getServerCert</span>(appletAuthPublicKey);</li><li>        responseBody.<span class="hljs-title function_">setCertificate</span>(serverCert);</li><li>        response.<span class="hljs-title function_">setResponse</span>(responseBody);</li><li>        deviceIdCertMap.<span class="hljs-title function_">put</span>(userDeviceId, serverCert);</li><li>        <span class="hljs-keyword">return</span> response;</li><li>    }</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section257714144308">获取个人化数据Token<i class="anchor-icon anchor-icon-link" anchorid="section257714144308" tips="复制节点链接"></i></h2>          <p>华为钱包APP经由钱包云服务中转后向三方业务管理服务平台获取token（个人化数据请求报文里参与计算hash）。</p>    </div>    <div class="tiledSection">     <h3 id="section157719149305" class="firsth2">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section157719149305" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.16.2.1.3.1.1" width="20%">          <p>承载协议</p></th>         <td class="cellrowborder" width="80%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.16.2.1.3.2.1" width="20%">          <p>接口方向</p></th>         <td class="cellrowborder" width="80%">          <p>钱包云服务-&gt;三方业务管理服务</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.16.2.1.3.3.1" width="20%">          <p>接口URL</p></th>         <td class="cellrowborder" width="80%">          <p>https://{webServiceURL}/v1/passes/requestPersonalizeToken</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.16.2.1.3.4.1" width="20%">          <p>数据格式</p></th>         <td class="cellrowborder" width="80%">          <p>请求消息：Content-Type: application/json;charset=UTF-8</p>          <p>响应消息：Content-Type: application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section95789145306">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section95789145306" tips="复制节点链接"></i></h3>          <p><strong>Request Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">          <p>Authorization</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/wallet-rest-api-carkey#section129511211195">申请钥匙卡片</a>时linkDevicePass参数中的token值，用于校验该请求是否合法。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Request Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.6.1.2" width="12.41%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.6.1.3" width="13.87%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" rowspan="5" width="13.61%">          <p>requestBody</p>          <p></p>          <p></p></td>         <td class="cellrowborder" width="12.41%">          <p>passTypeIdentifier</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>时注册的服务号，需要开发者到华为AGC网站申请。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>serialNumber</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>车钥匙卡片在华为钱包云服务器中的卡号，回调时以便发卡方根据此值识别具体的卡券记录。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>passVersion</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>可选</p></td>         <td class="cellrowborder">          <p>版本号，固定10.0。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>userDeviceId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>用户在当前设备上的唯一标识。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>transId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>随机数。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>signature</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>Applet的身份私钥对requestBody的Hash值的签名。</p></td>        </tr>        <tr>         <td class="cellrowborder" rowspan="2" width="13.61%">          <p>certificate</p></td>         <td class="cellrowborder" width="12.41%">          <p>signature</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>在<a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section113578586311">设备认证</a>接口返回的certificate的签名。</p>          <p>DK业务管理服务使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>步骤5生成的私钥对Applet的身份公钥签名信息。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>publicKey</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>在<a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section113578586311">设备认证</a>接口返回的certificate里的Applet的身份公钥。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section1559111612399">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section1559111612399" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"requestBody"</span>: {</li><li>    <span class="hljs-string">"passTypeIdentifier"</span>: <span class="hljs-string">"Replace with the Service ID you applied on AGC"</span>,</li><li>    <span class="hljs-string">"passVersion"</span>: <span class="hljs-string">"10.0"</span>,</li><li>    <span class="hljs-string">"serialNumber"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>,</li><li>    <span class="hljs-string">"transId"</span>: <span class="hljs-string">"16198381994485116358"</span>,</li><li>    <span class="hljs-string">"userDeviceId"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"certificate"</span>: {</li><li>    <span class="hljs-string">"publicKey"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section175601716113913">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section175601716113913" tips="复制节点链接"></i></h3>          <p><strong>Response Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Response Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.5.1.6.1.2" width="12.41%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.5.1.6.1.3" width="13.87%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="13.61%">          <p>Httpstatus</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>接口网络状态码。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>response</p></td>         <td class="cellrowborder" width="12.41%">          <p>token</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>个人化token。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section856371603911">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section856371603911" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"httpStatus"</span>: <span class="hljs-string">"0"</span>,</li><li>  <span class="hljs-string">"response"</span>: {</li><li>    <span class="hljs-string">"token"</span>: <span class="hljs-string">"sp.token.1619838979341"</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section11581161483011">三方业务管理服务处理调用示例<i class="anchor-icon anchor-icon-link" anchorid="section11581161483011" tips="复制节点链接"></i></h3>          <p>完整的调用示例，请参见<a href="https://gitcode.com/harmonyos_samples/wallet-kit-sample-code-severdemo-nfc-java" target="_blank">钱包服务-服务端卡片激活</a>示例代码。</p>     <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li>    <span class="hljs-keyword">public</span> <span class="hljs-title class_">RequestTokenResponse</span> <span class="hljs-title function_">dealWithTokenRequest</span>(<span class="hljs-params">RequestTokenRequest request</span>) {</li><li>        <span class="hljs-title class_">RequestTokenResponse</span> response = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RequestTokenResponse</span>();</li><li>        <span class="hljs-title class_">String</span> userDeviceId = request.<span class="hljs-title function_">getRequestBody</span>().<span class="hljs-title function_">getUserDeviceId</span>();</li><li>        <span class="hljs-title class_">Certificate</span> spCertFromRequest = request.<span class="hljs-title function_">getCertificate</span>();</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">CommonUtils</span>.<span class="hljs-title function_">isStringEmpty</span>(userDeviceId) || !<span class="hljs-title class_">ParamChecker</span>.<span class="hljs-title function_">checkSpServerCertificate</span>(spCertFromRequest)) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_PARAM_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-title class_">Certificate</span> cachedCert = deviceIdCertMap.<span class="hljs-title function_">get</span>(userDeviceId);</li><li>        <span class="hljs-keyword">if</span> (cachedCert == <span class="hljs-literal">null</span>) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_SIGN_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-title class_">ParamChecker</span>.<span class="hljs-title function_">hashSignatureCheck</span>(request.<span class="hljs-title function_">toJsonString</span>(), request.<span class="hljs-title function_">getSignature</span>(),</li><li>                appletAuthPublicKey, <span class="hljs-title class_">DataConvertUtil</span>.<span class="hljs-property">SIGN_MODE_SHA256_RSA_MGF1</span>)) {</li><li>            response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_SIGN_ERROR</span>));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        response.<span class="hljs-title function_">setHttpStatus</span>(<span class="hljs-title class_">String</span>.<span class="hljs-title function_">valueOf</span>(<span class="hljs-title class_">Constants</span>.<span class="hljs-property">RESULT_CODE_OK</span>));</li><li>        <span class="hljs-title class_">Response</span> responseBody = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Response</span>();</li><li>        <span class="hljs-title class_">String</span> personalizeToken = <span class="hljs-title class_">PassData</span>.<span class="hljs-title function_">getPersonalizeToken</span>();</li><li>        responseBody.<span class="hljs-title function_">setToken</span>(personalizeToken);</li><li>        deviceIdTokenMap.<span class="hljs-title function_">put</span>(userDeviceId, personalizeToken);</li><li>        response.<span class="hljs-title function_">setResponse</span>(responseBody);</li><li>        <span class="hljs-keyword">return</span> response;</li><li>    }</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section178319716389">获取个人化数据<i class="anchor-icon anchor-icon-link" anchorid="section178319716389" tips="复制节点链接"></i></h2>          <p>华为钱包APP经由钱包云服务中转后向三方业务管理服务获取个人化数据。</p>    </div>    <div class="tiledSection">     <h3 id="section883167113818" class="firsth2">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section883167113818" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.23.2.1.3.1.1" width="20%">          <p>承载协议</p></th>         <td class="cellrowborder" width="80%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.23.2.1.3.2.1" width="20%">          <p>接口方向</p></th>         <td class="cellrowborder" width="80%">          <p>钱包云服务-&gt;三方业务管理服务</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.23.2.1.3.3.1" width="20%">          <p>接口URL</p></th>         <td class="cellrowborder" width="80%">          <p>https://{webServiceURL}/v1/passes/requestPersonalize</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.23.2.1.3.4.1" width="20%">          <p>数据格式</p></th>         <td class="cellrowborder" width="80%">          <p>请求消息：Content-Type: application/json;charset=UTF-8</p>          <p>响应消息：Content-Type: application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section10831673387">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section10831673387" tips="复制节点链接"></i></h3>          <p><strong>Request Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.24.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20%">          <p>Authorization</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p><a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section257714144308">获取个人化数据Token</a>返回的token值，用于校验该请求是否合法。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Request Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.6.1.2" width="14.2%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.6.1.3" width="12.08%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.24.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" rowspan="10" width="13.61%">          <p>requestBody</p>          <p></p>          <p></p></td>         <td class="cellrowborder" width="14.2%">          <p>cardSEId</p></td>         <td class="cellrowborder" width="12.08%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>Applet唯一标识，可以用于车端秘钥分散</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>passTypeIdentifier</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>时注册的服务号，需要开发者到华为AGC网站申请。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>serialNumber</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>车钥匙卡片在华为钱包云服务器中的卡号，回调时以便发卡方根据此值识别具体的卡券记录。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>passVersion</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>可选</p></td>         <td class="cellrowborder">          <p>版本号，固定10.0。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>userDeviceId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>用户在当前设备上的唯一标识。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>personalizePublicKey</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>Applet的个人化公钥，用于加密个人化字段值。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>personalizeCert</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>Applet身份私钥对个人化公钥personalizePublicKey的签名。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>personalizeCertType</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>固定值，默认为私钥签名。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>transPublicKey</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>用于加密返回的对称秘钥，用于对返回的数据做数字信封。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>transId</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>事务流水，用于拼接返回的对称秘钥。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>signature</p></td>         <td class="cellrowborder" width="14.2%">          <p>-</p></td>         <td class="cellrowborder" width="12.08%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>Applet的身份私钥对requestBody的Hash值的签名。<a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section257714144308">获取个人化数据Token</a>作为其中requestbody一个key参与Hash值计算。</p></td>        </tr>        <tr>         <td class="cellrowborder" rowspan="2" width="13.61%">          <p>certificate</p></td>         <td class="cellrowborder" width="14.2%">          <p>signature</p></td>         <td class="cellrowborder" width="12.08%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>在<a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section113578586311">设备认证</a>接口返回的certificate的签名。</p>          <p>DK业务管理服务使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>步骤5生成的私钥对Applet的身份公钥签名信息。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>publicKey</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>在<a href="/consumer/cn/doc/harmonyos-references/wallet-rest-api-public#section113578586311">设备认证</a>接口返回的certificate里的Applet的身份公钥。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section08424334617">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section08424334617" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"requestBody"</span>: {</li><li>    <span class="hljs-string">"cardSEId"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxx"</span>,</li><li>    <span class="hljs-string">"personalizeCert"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"personalizeCertType"</span>: <span class="hljs-string">""</span>,</li><li>    <span class="hljs-string">"personalizePublicKey"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"transPublicKey"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"passTypeIdentifier"</span>: <span class="hljs-string">"Replace with the Service ID you applied on AGC"</span>,</li><li>    <span class="hljs-string">"passVersion"</span>: <span class="hljs-string">"10.0"</span>,</li><li>    <span class="hljs-string">"serialNumber"</span>: <span class="hljs-string">"xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span>,</li><li>    <span class="hljs-string">"transId"</span>: <span class="hljs-string">"858947076d58a5e66ee22b9ed1c43c4d"</span>,</li><li>    <span class="hljs-string">"userDeviceId"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"certificate"</span>: {</li><li>    <span class="hljs-string">"publicKey"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>  },</li><li>  <span class="hljs-string">"signature"</span>: <span class="hljs-string">"xxx"</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section1984283184614">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section1984283184614" tips="复制节点链接"></i></h3>          <p><strong>Response Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.26.3.1.5.1.1" width="20%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.3.1.5.1.2" width="15%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.3.1.5.1.3" width="15%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.3.1.5.1.4" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15%">          <p>是</p></td>         <td class="cellrowborder" width="15%">          <p>String</p></td>         <td class="cellrowborder" width="50%">          <p>取值为：application/json;charset=UTF-8</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>Response Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.26.5.1.6.1.1" width="13.61%">          <p>父节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.5.1.6.1.2" width="12.41%">          <p>子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.5.1.6.1.3" width="13.87%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.5.1.6.1.4" width="13.87%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.5.1.6.1.5" width="46.239999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="13.61%">          <p>Httpstatus</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>接口网络状态码。</p></td>        </tr>        <tr>         <td class="cellrowborder" rowspan="3" width="13.61%">          <p>response</p>          <p></p>          <p></p></td>         <td class="cellrowborder" width="12.41%">          <p>encryptSessionKey</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>DK业务管理服务使用请求中的transPublicKey加密生成的sessionKey。采用Base64编码，加密前的字段说明：三方生成AES128的aesKey和aesIv，用于加密生成encryptAppletPersonalizeFields和encryptDevicePass。使用请求中transPublicKey字段加密transId+aesKey+aesIv，对结果进行base64编码即得到encryptSessionKey。加密算法: RSA/ECB/OAEPWithSHA-256AndMGF1Padding。</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>encryptDevicePass</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>可选</p></td>         <td class="cellrowborder">          <p>空字符串""</p></td>        </tr>        <tr>         <td class="cellrowborder">          <p>encryptAppletPersonalizeFields</p></td>         <td class="cellrowborder">          <p>String</p></td>         <td class="cellrowborder">          <p>必选</p></td>         <td class="cellrowborder">          <p>用于蓝牙/NFC刷卡时的认证以及数据加解密操作。DK业务管理服务通过生成的sessionKey加密Applet的个人化参数密文。采用Base64编码</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.61%">          <p>signature</p></td>         <td class="cellrowborder" width="12.41%">          <p>-</p></td>         <td class="cellrowborder" width="13.87%">          <p>String</p></td>         <td class="cellrowborder" width="13.87%">          <p>必选</p></td>         <td class="cellrowborder" width="46.239999999999995%">          <p>DK业务管理服务使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/wallet-preparations#li69221528123212" target="_blank">创建Wallet Kit服务</a>步骤5生成的私钥对response的Hash值进行签名。</p></td>        </tr>             </tbody></table></div>     </div>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.26.6.1.6.1.1" width="13.569999999999999%">          <p>encryptAppletPersonalizeFields子节点参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.6.1.6.1.2" width="12.36%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.6.1.6.1.3" width="13.950000000000001%">          <p>是否可选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.6.1.6.1.4" width="13.639999999999999%">          <p>存储格式</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.26.6.1.6.1.5" width="46.48%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>temp_key</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>-</p></td>         <td class="cellrowborder" width="46.48%">          <p>aesKey(AES128的key)，长度16字节，用于加密CardId，cardPrivateInfo信息。temp_key：aesKey明文之前拼接一个固定的十六进制字符前缀"34810233"后，使用Applet个人化公钥appletPublicKey对其进行加密。加密算法RSA/NONE/OAEPWithSHA1AndMGF1Padding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>temp_iv</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>-</p></td>         <td class="cellrowborder" width="46.48%">          <p>aesIv(AES128的iv)，长度16字节，用于applet解密写卡数据。temp_iv：aesIv使用Applet个人化公钥appletPublicKey加密。加密算法RSA/NONE/OAEPWithSHA1AndMGF1Padding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>card_id</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>9F3B + Lc + CardId</p></td>         <td class="cellrowborder" width="46.48%">          <p>CardId即发卡方发放的卡片唯一标志（和"生成钥匙卡片"中的serialNumber保持一致），长度16字节。使用TLV格式存储：T=9F3B，Lc=10，V=CardId；加密方式：使用aesKey，aesIv对整个TLV加密，并转换成十六进制字符串。CBC模式加密，加密算法：AES/CBC/NoPadding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>card_key</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>-</p></td>         <td class="cellrowborder" width="46.48%">          <p>发卡方发放的卡片密钥，16字节，一张卡支持1个秘钥，计算SessionKey时使用。使用"34010133"作为前缀拼接后加密；使用Applet个人化公钥appletPublicKey对拼接后的十六进制字符进行加密。加密算法RSA/NONE/OAEPWithSHA1AndMGF1Padding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>card_info</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>9F05 + Lc + CardInfo1 + 9F31 + Lc + CardAuthParameter</p></td>         <td class="cellrowborder" width="46.48%">          <p>发卡方发放的卡片私有信息，允许在AUTH认证之前读取（GetProcessData步骤），TLV格式存储（多个TLV数据拼接）。加密方式：TLV明文数据补800...00到16字节整数倍，使用aesKey，aesIv加密后的结果，并转换成十六进制字符串。CBC模式加密，加密算法：AES/CBC/NoPadding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>card_privateInfo</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>-</p></td>         <td class="cellrowborder" width="46.48%">          <p>发卡方发放的卡片私有信息，如卡片有效期、权限等信息，在AUTH认证之后读取（ReadBinary步骤），三方自行解析。加密方式：数据明文后补800...00到16字节整数倍，使用aesKey，aesIv加密后的结果，并转换成十六进制字符串。CBC模式加密，加密算法：AES/CBC/NoPadding。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="13.569999999999999%">          <p>card_key_iv</p></td>         <td class="cellrowborder" width="12.36%">          <p>String</p></td>         <td class="cellrowborder" width="13.950000000000001%">          <p>必选</p></td>         <td class="cellrowborder" width="13.639999999999999%">          <p>Lc + CardKeyIV</p></td>         <td class="cellrowborder" width="46.48%">          <p>交易流程协商的SessionKey使用（需要同步下发到车端），16字节，如您无需使用此值，请传入全0。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section2084512394612">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section2084512394612" tips="复制节点链接"></i></h3>          <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li><span class="">  <span class="hljs-string">"httpStatus"</span></span>: <span class=""><span class="hljs-string">"0"</span></span>,</li><li><span class="">  <span class="hljs-string">"response"</span></span>: {</li><li><span class="">    <span class="hljs-string">"encryptDevicePass"</span></span>: <span class=""><span class="hljs-string">"xxx"</span></span>,</li><li><span class="">    <span class="hljs-string">"encryptAppletPersonalizeFields"</span></span>: <span class=""><span class="hljs-string">"xxx"</span></span>,</li><li><span class="">    <span class="hljs-string">"encryptSessionKey"</span></span>: <span class=""><span class="hljs-string">"xxx"</span></span></li><li>  },</li><li><span class="">  <span class="hljs-string">"signature"</span></span>: <span class=""><span class="hljs-string">"xxx"</span></span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section583617712383">三方业务管理服务处理调用示例<i class="anchor-icon anchor-icon-link" anchorid="section583617712383" tips="复制节点链接"></i></h3>          <p>完整的调用示例，请参见<a href="https://gitcode.com/harmonyos_samples/wallet-kit-sample-code-severdemo-nfc-java" target="_blank">钱包服务-服务端卡片激活</a>示例代码。</p>     <div _ngcontent-wss-c106="" class="highlight-div"><div _ngcontent-wss-c106="" class="highlight-div-header"><div _ngcontent-wss-c106="" class="highlight-div-header-left"><div _ngcontent-wss-c106="" class="handle-button expand-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wss-c106="" class="highlight-div-header-right"><div _ngcontent-wss-c106="" class="handle-button ai-button"></div><div _ngcontent-wss-c106="" class="handle-button line-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wss-c106="" class="handle-button theme-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wss-c106="" class="handle-button copy-button"><div _ngcontent-wss-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wss-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li>    <span class="hljs-keyword">public</span> PersonalizeResponse <span class="hljs-title function_">dealWithPersonalizeDataRequest</span><span class="hljs-params">(String token, PersonalizeRequest request)</span> {</li><li>        <span class="hljs-type">PersonalizeResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PersonalizeResponse</span>();</li><li>        <span class="hljs-type">RequestBody</span> <span class="hljs-variable">requestBody</span> <span class="hljs-operator">=</span> request.getRequestBody();</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">userDeviceId</span> <span class="hljs-operator">=</span> requestBody.getUserDeviceId();</li><li>        <span class="hljs-type">Certificate</span> <span class="hljs-variable">spCertFromRequest</span> <span class="hljs-operator">=</span> request.getCertificate();</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">cachedToken</span> <span class="hljs-operator">=</span> deviceIdTokenMap.remove(userDeviceId);</li><li>        <span class="hljs-keyword">if</span> (cachedToken == <span class="hljs-literal">null</span> || !cachedToken.equals(token)) {</li><li>            response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_PARAM_ERROR));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (CommonUtils.isStringEmpty(userDeviceId) || !ParamChecker.checkSpServerCertificate(spCertFromRequest)) {</li><li>            response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_PARAM_ERROR));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>
</li><li>        <span class="hljs-type">Certificate</span> <span class="hljs-variable">cachedCert</span> <span class="hljs-operator">=</span> deviceIdCertMap.get(userDeviceId);</li><li>        <span class="hljs-keyword">if</span> (cachedCert == <span class="hljs-literal">null</span>) {</li><li>            response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_PARAM_ERROR));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (!ParamChecker.hashSignatureCheck(request.toJsonString(token), request.getSignature(),</li><li>                appletAuthPublicKey, DataConvertUtil.SIGN_MODE_SHA256_RSA_MGF1)) {</li><li>            response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_SIGN_ERROR));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">personalizePKSign</span> <span class="hljs-operator">=</span> requestBody.getPersonalizeCert();</li><li>        <span class="hljs-type">byte</span>[] srcBytes = DataConvertUtil.base64Decode(requestBody.getPersonalizePublicKey());</li><li>        <span class="hljs-keyword">if</span> (!DataConvertUtil.checkSign(srcBytes, personalizePKSign,</li><li>                appletAuthPublicKey, DataConvertUtil.SIGN_MODE_SHA256_RSA_MGF1)) {</li><li>            response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_SIGN_ERROR));</li><li>            <span class="hljs-keyword">return</span> response;</li><li>        }</li><li>        response.setHttpStatus(String.valueOf(Constants.RESULT_CODE_OK));</li><li>        <span class="hljs-type">PassDataResponse</span> <span class="hljs-variable">passData</span> <span class="hljs-operator">=</span> getDevicePassData(requestBody);</li><li>        response.setResponse(passData);</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">passDataStr</span> <span class="hljs-operator">=</span> passData.toJsonString();</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">passHashValue</span> <span class="hljs-operator">=</span> DataConvertUtil.encodeSHA256(passDataStr);</li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> DataConvertUtil.signData(passHashValue, Constants.SERVER_SECRET_KEY);</li><li>        response.setSignature(signature);</li><li>        <span class="hljs-keyword">return</span> response;</li><li>    }</li></ol></pre></div></div>    </div>   </div>   <div></div></div>