<h1 _ngcontent-yih-c119="" class="doc-title ng-star-inserted" title="公共说明"> 公共说明 </h1>

<div _ngcontent-yih-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section19113125981817">HTTPS安全要求<i class="anchor-icon anchor-icon-link" anchorid="section19113125981817" tips="复制节点链接"></i></h2>          <ul>      <li>所有的API请求必须使用HTTPS。</li>      <li>支持的TLS协议版本：1.2 / 1.3。</li>      <li>支持的加密套件列表：       <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>TLS_CHACHA20_POLY1305_SHA256</li><li>TLS_AES_128_GCM_SHA256</li><li>TLS_AES_256_GCM_SHA384</li><li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li><li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section16264321203717">HTTP方法说明<i class="anchor-icon anchor-icon-link" anchorid="section16264321203717" tips="复制节点链接"></i></h2>          <p>当前Payment Kit对外接口涉及GET及POST两种HTTP METHOD。</p>     <ul>      <li><strong>GET</strong>：对应于查询场景。适用于从服务器查询资源数据，如查询订单信息、查询签约信息等。</li>      <li><strong>POST</strong>：对应于新建/更新资源场景，如预下单、退款请求等。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section93531048113714">数据格式<i class="anchor-icon anchor-icon-link" anchorid="section93531048113714" tips="复制节点链接"></i></h2>          <p>请求和响应报文统一使用JSON格式。</p>    </div>    <div class="tiledSection">     <h2 id="section2366517153817">字符编码<i class="anchor-icon anchor-icon-link" anchorid="section2366517153817" tips="复制节点链接"></i></h2>          <p>Payment Kit所有请求默认支持UTF-8编码，如采用其他编码格式的报文可能导致验签失败、字段解析失败等问题。</p>     <p>HTTP METHOD方式为GET的接口请求，请求URL如涉及参数拼接，拼接后完整的请求URL不建议带特殊字符。如有需要，建议对URL中的特殊字符进行编码处理。URL特殊字符参考但不限于：</p>     <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <td class="cellrowborder" width="100%">          <p>+, 空格, ?, %, #, &amp;, =</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section159899521877">认证授权<i class="anchor-icon anchor-icon-link" anchorid="section159899521877" tips="复制节点链接"></i></h2>          <ul>      <li><strong>认证(Authentication)</strong>：认证操作确认调用者身份，防抵赖和数据篡改。所有对商户开放接口均需要商户在请求头中传递<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/payment-model#section11744172016145">PayMercAuth</a>字段，在开放网关认证通过后方可进行后续流程。</li>      <li><strong>授权(Authorization)</strong>：授权确保给定接口仅特定调用者才有权限调用。部分接口仅特定商户申请开通后方可使用。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section174821258151218">签名规则<i class="anchor-icon anchor-icon-link" anchorid="section174821258151218" tips="复制节点链接"></i></h2>          <p><strong>签名场景：</strong>商户云侧请求的请求头中参数签名。</p>     <p><strong>签名算法：</strong>SHA256WithRSA/PSS 或者 SM2。</p>     <p><strong>开发步骤：</strong></p>     <ol>      <li>筛选：排除请求JSON串中sign字段，只保留sign以外的其他字段。</li>      <li>排序拼接：按key值的ASCII码顺序排序，并使用&amp;拼接，列表场景使用符号“=”连接。       <div class="p">        具体可参考<a href="https://gitcode.com/HarmonyOS_Samples/paymentkit-sample-code-serverdemo-java" target="_blank">示例代码</a>引入华为支付提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect#section379431652315" target="_blank">Maven依赖（pay-java）</a>中SignStringUtil.java类的signString方法，排序拼接结果示例如下：        <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"allocationType=DELAY_ORDER_ALLOCATION&amp;callbackUrl=https://www.xxxxxx.com/hw/pay/callback&amp;currency=CNY&amp;mercNo=xxxxxx&amp;mercOrderNo=xxxxxx&amp;totalAmount=2&amp;tradeSummary=杂志报刊"</span></li></ol></pre></div></div>       </div></li>      <li>签名：调用给定算法对排序后的串完成签名。       <p><strong>SHA256WithRSA/PSS：</strong>具体可参考<a href="https://gitcode.com/HarmonyOS_Samples/paymentkit-sample-code-serverdemo-java" target="_blank">示例代码</a>引入华为支付提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect#section379431652315" target="_blank">Maven依赖（pay-java）</a>中RSAUtils.java类的signByRSAWithPSS方法。</p>       <p><strong>SM2：</strong>具体可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect#section379431652315" target="_blank">Maven依赖（pay-java）</a>中Sm2Utils.java类中的sign方法。</p>       <p>加签内容参考：</p>       <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">POST请求</span>：<span class="hljs-variable">POST</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//petalpay-developer.cloud.huawei.com.cn/api/v2/aggr/preorder/create/app</span></li><li>{</li><li>    <span class="hljs-string">"appId"</span>: <span class="hljs-string">"5765880207854262xxx"</span>,</li><li>    <span class="hljs-string">"callbackUrl"</span>: <span class="hljs-string">"https://www.xxx.com/hw_notify"</span>,</li><li>    <span class="hljs-string">"currency"</span>: <span class="hljs-string">"CNY"</span>,</li><li>    <span class="hljs-string">"mercNo"</span>: <span class="hljs-string">"101723200xxx"</span>,</li><li>    <span class="hljs-string">"mercOrderNo"</span>: <span class="hljs-string">"2405171027547xxx"</span>,</li><li>    <span class="hljs-string">"payload"</span>: <span class="hljs-string">"shop|h8ahnJA8xxRXVw"</span>,</li><li>    <span class="hljs-string">"totalAmount"</span>: <span class="hljs-number">5</span>,</li><li>    <span class="hljs-string">"tradeSummary"</span>: <span class="hljs-string">"test"</span>,</li><li>    <span class="hljs-string">"subOrders"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"mercNo"</span>: <span class="hljs-string">"101723200xxx"</span>,</li><li>        <span class="hljs-string">"mercOrderNo"</span>: <span class="hljs-string">"abcxxx1"</span></li><li>      },</li><li>      {</li><li>        <span class="hljs-string">"mercNo"</span>: <span class="hljs-string">"101723201xxx"</span>,</li><li>        <span class="hljs-string">"mercOrderNo"</span>: <span class="hljs-string">"abcxxx2"</span></li><li>      }</li><li>    ]</li><li>}</li><li><span class="hljs-variable">加签内容</span>：<span class="hljs-variable">appId</span>=<span class="hljs-number">5765880207854262</span><span class="hljs-variable">xxx</span>&amp;<span class="hljs-variable">callbackUrl</span>=<span class="hljs-variable">https</span>:<span class="hljs-comment">//www.xxx.com/hw_notify&amp;currency=CNY&amp;mercNo=101723200xxx&amp;mercOrderNo=2405171027547xxx&amp;payload=shop|h8ahnJA8xxRXVw&amp;subOrders=mercNo=101723200xxx&amp;mercOrderNo=abcxxx1,mercNo=101723201xxx&amp;mercOrderNo=abcxxx2&amp;totalAmount=5&amp;tradeSummary=test</span></li><li>
</li><li><span class="hljs-variable">GET请求</span>：<span class="hljs-variable">GET</span> <span class="hljs-variable">https</span>:<span class="hljs-comment">//petalpay-developer.cloud.huawei.com.cn/api/v2/aggr/transactions/merc-orders/20240507000000041809599950090xxx?mercNo=101540000089&amp;sdkVersion=1.0.0</span></li><li><span class="hljs-variable">加签内容</span>：/<span class="hljs-variable">api</span>/<span class="hljs-variable">v2</span>/<span class="hljs-variable">aggr</span>/<span class="hljs-variable">transactions</span>/<span class="hljs-variable">merc</span>-<span class="hljs-variable">orders</span>/<span class="hljs-number">20240507000000041809599950090</span><span class="hljs-variable">xxx</span>?<span class="hljs-variable">mercNo</span>=<span class="hljs-number">101540000089</span>&amp;<span class="hljs-variable">sdkVersion</span>=<span class="hljs-number">1.0</span><span class="hljs-number">.0</span></li></ol></pre></div></div></li>     </ol>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>字段值设置为null时，字段可不参与签名，设置为空字符时，则必须参与签名。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section9898112914264" class="firsth2">常用语言SHA256WithRSA/PSS加签示例代码参考<i class="anchor-icon anchor-icon-link" anchorid="section9898112914264" tips="复制节点链接"></i></h3>          <p><strong>go语言</strong></p>     <p>加签实现示例代码：</p>     <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-go" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">package</span> main</li><li><span class="hljs-keyword">import</span> (</li><li>    <span class="hljs-string">"crypto"</span></li><li>    <span class="hljs-string">"crypto/rand"</span></li><li>    <span class="hljs-string">"crypto/rsa"</span></li><li>    <span class="hljs-string">"crypto/sha256"</span></li><li>    <span class="hljs-string">"crypto/x509"</span></li><li>    <span class="hljs-string">"encoding/base64"</span></li><li>    <span class="hljs-string">"fmt"</span></li><li>    <span class="hljs-string">"testing"</span></li><li>)</li><li><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">signSha256WithRsaPSS</span><span class="hljs-params">(message, privateKeyStr <span class="hljs-type">string</span>)</span></span> (<span class="hljs-type">string</span>, <span class="hljs-type">error</span>) {</li><li>    privateKey, err := getPrivateKey(privateKeyStr)</li><li>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err</li><li>    }</li><li>    hasher := sha256.New()</li><li>    hasher.Write([]<span class="hljs-type">byte</span>(message))</li><li>    hashedMessage := hasher.Sum(<span class="hljs-literal">nil</span>)</li><li>    opts := rsa.PSSOptions{</li><li>        SaltLength: rsa.PSSSaltLengthEqualsHash,</li><li>        Hash:       crypto.SHA256,</li><li>    }</li><li>    signature, err := rsa.SignPSS(rand.Reader, privateKey, crypto.SHA256, hashedMessage, &amp;opts)</li><li>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>, err</li><li>    }</li><li>    <span class="hljs-keyword">return</span> base64.StdEncoding.EncodeToString(signature), <span class="hljs-literal">nil</span></li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">getPrivateKey</span><span class="hljs-params">(privateKeyStr <span class="hljs-type">string</span>)</span></span> (*rsa.PrivateKey, <span class="hljs-type">error</span>) {</li><li>    decoded, err := base64.StdEncoding.DecodeString(privateKeyStr)</li><li>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err</li><li>    }</li><li>    privateKey, err := x509.ParsePKCS8PrivateKey(decoded)</li><li>    <span class="hljs-keyword">if</span> err != <span class="hljs-literal">nil</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err</li><li>    }</li><li>    rsaPrivateKey, ok := privateKey.(*rsa.PrivateKey)</li><li>    <span class="hljs-keyword">if</span> !ok {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nil</span>, err</li><li>    }</li><li>    <span class="hljs-keyword">return</span> rsaPrivateKey, <span class="hljs-literal">nil</span></li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">func</span> <span class="hljs-title">TestRsaSign</span><span class="hljs-params">(t *testing.T)</span></span> {</li><li>    signature, err := signSha256WithRsaPSS(<span class="hljs-string">"加签排序拼接内容"</span>,<span class="hljs-string">"私钥"</span>)</li><li>    fmt.Println(signature, err)</li><li>}</li></ol></pre></div></div>     <p><strong>JavaScript语言</strong></p>     <p>javascript可通过jsrsasign模块实现，如已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-certificates-config#li971411417543" target="_blank">安装node环境</a>，可执行如下命令安装jsrsasign模块。</p>     <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>npm install jsrsasign</li></ol></pre></div></div>     <p>加签实现示例代码：</p>     <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> jsrsasign = <span class="hljs-built_in">require</span>(<span class="hljs-string">'jsrsasign'</span>);</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">signSha256WithRsaPSS</span>(<span class="hljs-params">plainData, privateStr</span>) {</li><li>  <span class="hljs-keyword">let</span> rsa = <span class="hljs-keyword">new</span> jsrsasign.<span class="hljs-title class_">RSAKey</span>();</li><li>  <span class="hljs-comment">// PEM 格式的私钥</span></li><li>  <span class="hljs-keyword">const</span> priKey = <span class="hljs-string">`-----BEGIN PRIVATE KEY-----\n<span class="hljs-subst">${privateStr}</span>\n-----END PRIVATE KEY-----\n`</span>;</li><li>  rsa = jsrsasign.<span class="hljs-property">KEYUTIL</span>.<span class="hljs-title function_">getKey</span>(priKey);</li><li>  <span class="hljs-keyword">const</span> sig = <span class="hljs-keyword">new</span> jsrsasign.<span class="hljs-property">KJUR</span>.<span class="hljs-property">crypto</span>.<span class="hljs-title class_">Signature</span>({</li><li>    <span class="hljs-attr">alg</span>: <span class="hljs-string">'SHA256withRSAandMGF1'</span>,</li><li>  });</li><li>  sig.<span class="hljs-title function_">init</span>(rsa);</li><li>  sig.<span class="hljs-title function_">updateString</span>(plainData);</li><li>  <span class="hljs-keyword">return</span> jsrsasign.<span class="hljs-title function_">hextob64</span>(sig.<span class="hljs-title function_">sign</span>());</li><li>}</li><li><span class="hljs-keyword">let</span> signature = <span class="hljs-title function_">signSha256WithRsaPSS</span>(<span class="hljs-string">"加签排序拼接内容"</span>,<span class="hljs-string">"私钥"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(signature)</li></ol></pre></div></div>    </div>    <p><strong>python语言</strong></p>    <p>python可通过cryptography模块实现，可先执行如下命令安装cryptography模块：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>pip install cryptography</li></ol></pre></div></div>    <p>加签实现示例代码：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> base64</li><li>
</li><li><span class="hljs-keyword">from</span> cryptography.hazmat.primitives <span class="hljs-keyword">import</span> hashes</li><li><span class="hljs-keyword">from</span> cryptography.hazmat.primitives.asymmetric <span class="hljs-keyword">import</span> padding</li><li><span class="hljs-keyword">from</span> cryptography.hazmat.backends <span class="hljs-keyword">import</span> default_backend</li><li><span class="hljs-keyword">from</span> cryptography.hazmat.primitives.serialization <span class="hljs-keyword">import</span> load_pem_private_key, load_pem_public_key</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">signSha256WithRsaPSS</span>(<span class="hljs-params">private_key_str, message</span>):</li><li>    <span class="hljs-comment"># PEM 格式的私钥</span></li><li>    prikey_content = <span class="hljs-string">"-----BEGIN PRIVATE KEY-----\n"</span> + private_key_str +<span class="hljs-string">"\n-----END PRIVATE KEY-----\n"</span>;</li><li>    private_key = load_pem_private_key(data=prikey_content.encode(<span class="hljs-string">"utf-8"</span>), password=<span class="hljs-literal">None</span>, backend=default_backend())</li><li>
</li><li>    <span class="hljs-comment"># 使用 RSA-PSS 算法生成签名</span></li><li>    signature = private_key.sign(</li><li>        message.encode(<span class="hljs-string">"utf-8"</span>),</li><li>        padding.PSS(</li><li>            mgf=padding.MGF1(hashes.SHA256()),</li><li>            salt_length=padding.PSS.DIGEST_LENGTH</li><li>        ),</li><li>        hashes.SHA256()</li><li>    )</li><li>    <span class="hljs-keyword">return</span> base64.b64encode(signature).decode(<span class="hljs-string">'utf-8'</span>)</li><li>
</li><li>message = <span class="hljs-string">"加签排序拼接内容"</span></li><li>private_key_str = <span class="hljs-string">"私钥"</span></li><li>signature = signSha256WithRsaPSS(private_key_str, message)</li><li><span class="hljs-built_in">print</span>(signature)</li></ol></pre></div></div>    <p><strong>php语言</strong></p>    <p>php可通过phpseclib加密库实现，如已安装composer环境，可先通过以下命令导入phpseclib：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>composer require phpseclib/phpseclib</li></ol></pre></div></div>    <p>phpseclib2加签实现示例代码：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">&lt;?php</span></li><li><span class="hljs-keyword">require_once</span> <span class="hljs-string">'vendor/autoload.php'</span>;</li><li><span class="hljs-keyword">use</span> <span class="hljs-title">phpseclib</span>\<span class="hljs-title">Crypt</span>\<span class="hljs-title">RSA</span>;</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signSha256WithRsaPSS</span>(<span class="hljs-params"><span class="hljs-variable">$content</span>, <span class="hljs-variable">$privateKeyStr</span></span>) </span>{</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-variable">$privateKey</span> = <span class="hljs-string">"-----BEGIN PRIVATE KEY-----\n"</span> . <span class="hljs-variable">$privateKeyStr</span> .<span class="hljs-string">"\n-----END PRIVATE KEY-----"</span>;</li><li>        <span class="hljs-variable">$signer</span> = <span class="hljs-keyword">new</span> \phpseclib\Crypt\<span class="hljs-title function_ invoke__">RSA</span>();</li><li>        <span class="hljs-variable">$signer</span>-&gt;<span class="hljs-title function_ invoke__">loadKey</span>(<span class="hljs-variable">$privateKey</span>, <span class="hljs-variable">$password</span> = <span class="hljs-literal">false</span>);</li><li>        <span class="hljs-variable">$signer</span>-&gt;<span class="hljs-title function_ invoke__">setHash</span>(<span class="hljs-string">'sha256'</span>);</li><li>        <span class="hljs-variable">$signer</span>-&gt;<span class="hljs-title function_ invoke__">setSignatureMode</span>(RSA::<span class="hljs-variable constant_">SIGNATURE_PSS</span>);</li><li>        <span class="hljs-variable">$signer</span>-&gt;<span class="hljs-title function_ invoke__">setMGFHash</span>(<span class="hljs-string">'sha256'</span>);</li><li>        <span class="hljs-variable">$signature</span> = <span class="hljs-variable">$signer</span>-&gt;<span class="hljs-title function_ invoke__">sign</span>(<span class="hljs-variable">$content</span>);</li><li>
</li><li>        <span class="hljs-variable">$sign</span> = <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$signature</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">$sign</span>;</li><li>    } <span class="hljs-keyword">catch</span> (<span class="hljs-built_in">Exception</span> <span class="hljs-variable">$e</span>) {</li><li>        <span class="hljs-keyword">echo</span> <span class="hljs-variable">$e</span>-&gt;<span class="hljs-title function_ invoke__">getMessage</span>();</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;</li><li>}</li><li><span class="hljs-variable">$data</span> = <span class="hljs-string">"加签排序拼接内容"</span>;</li><li><span class="hljs-variable">$privateKeyStr</span> = <span class="hljs-string">"私钥"</span>;</li><li><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">signSha256WithRsaPSS</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$privateKeyStr</span>)</li><li><span class="hljs-meta">?&gt;</span></li></ol></pre></div></div>    <p>phpseclib3加签实现示例代码：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-php" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">&lt;?php</span></li><li><span class="hljs-keyword">require_once</span> <span class="hljs-string">'vendor/autoload.php'</span>;</li><li>
</li><li><span class="hljs-keyword">use</span> <span class="hljs-title">phpseclib3</span>\<span class="hljs-title">Crypt</span>\<span class="hljs-title">PublicKeyLoader</span>;</li><li><span class="hljs-keyword">use</span> <span class="hljs-title">phpseclib3</span>\<span class="hljs-title">Crypt</span>\<span class="hljs-title">RSA</span>;</li><li>
</li><li><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">signSha256WithRsaPSS</span>(<span class="hljs-params"><span class="hljs-variable">$data</span>,<span class="hljs-variable">$rsa_key</span></span>)</span>{</li><li>    <span class="hljs-variable">$key</span> = <span class="hljs-string">"-----BEGIN PRIVATE KEY-----\n"</span> . <span class="hljs-variable">$rsa_key</span> . <span class="hljs-string">"-----END PRIVATE KEY-----"</span>;</li><li>    <span class="hljs-variable">$private</span> = <span class="hljs-title class_">PublicKeyLoader</span>::<span class="hljs-title function_ invoke__">load</span>(<span class="hljs-variable">$key</span>, <span class="hljs-variable">$password</span> = <span class="hljs-literal">false</span>);</li><li>    <span class="hljs-variable">$private</span> = <span class="hljs-variable">$private</span>-&gt;<span class="hljs-title function_ invoke__">withPadding</span>(RSA::<span class="hljs-variable constant_">SIGNATURE_PSS</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title function_ invoke__">base64_encode</span>(<span class="hljs-variable">$private</span>-&gt;<span class="hljs-title function_ invoke__">sign</span>(<span class="hljs-variable">$data</span>));</li><li>}</li><li>
</li><li><span class="hljs-variable">$data</span> = <span class="hljs-string">"加签排序拼接内容"</span>;</li><li><span class="hljs-variable">$privateKeyStr</span> = <span class="hljs-string">"私钥"</span>;</li><li><span class="hljs-keyword">echo</span> <span class="hljs-title function_ invoke__">signSha256WithRsaPSS</span>(<span class="hljs-variable">$data</span>, <span class="hljs-variable">$privateKeyStr</span>);</li><li><span class="hljs-meta">?&gt;</span></li></ol></pre></div></div>    <p><strong>C#语言</strong></p>    <p>C#可通过BouncyCastle库来实现，如已安装 <a href="https://dotnet.microsoft.com/download" target="_blank">.NET SDK</a>，可先执行如下命令添加BouncyCastle：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>dotnet <span class="hljs-keyword">add</span> package BouncyCastle</li></ol></pre></div></div>    <p>加签实现示例代码：</p>    <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">using</span> System.Text;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.OpenSsl;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Crypto;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Crypto.Parameters;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Security;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Crypto.Signers;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Crypto.Engines;</li><li><span class="hljs-keyword">using</span> Org.BouncyCastle.Crypto.Digests;</li><li><span class="hljs-keyword">class</span> <span class="hljs-title">SignProgram</span></li><li>{</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title">Main</span>(<span class="hljs-params"><span class="hljs-built_in">string</span>[] args</span>)</span></li><li>    {</li><li>        <span class="hljs-built_in">string</span> res = RSASign(<span class="hljs-string">"加签排序拼接内容"</span>,<span class="hljs-string">"私钥"</span>);</li><li>        Console.WriteLine(<span class="hljs-string">"result："</span> + res);</li><li>    }</li><li>    <span class="hljs-function"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">string</span> <span class="hljs-title">RSASign</span>(<span class="hljs-params"><span class="hljs-built_in">string</span> datastr,<span class="hljs-built_in">string</span> privateStr</span>)</span></li><li>    {</li><li>        <span class="hljs-keyword">var</span> priKey = <span class="hljs-string">"-----BEGIN PRIVATE KEY-----\n"</span>+ privateStr +<span class="hljs-string">"\n-----END PRIVATE KEY-----\n"</span>;</li><li>        <span class="hljs-built_in">byte</span>[] data = Encoding.UTF8.GetBytes(datastr);</li><li>        <span class="hljs-comment">// 创建PSS签名器</span></li><li>        <span class="hljs-keyword">var</span> signer = <span class="hljs-keyword">new</span> PssSigner(<span class="hljs-keyword">new</span> RsaEngine(), <span class="hljs-keyword">new</span> Sha256Digest());</li><li>        AsymmetricKeyParameter rsaPrivateKey = <span class="hljs-literal">null</span>;</li><li>        <span class="hljs-keyword">using</span> (<span class="hljs-keyword">var</span> stringReader = <span class="hljs-keyword">new</span> StringReader(priKey))</li><li>        {</li><li>            <span class="hljs-keyword">var</span> pemReader = <span class="hljs-keyword">new</span> PemReader(stringReader);</li><li>            rsaPrivateKey = pemReader.ReadObject() <span class="hljs-keyword">as</span> AsymmetricKeyParameter;</li><li>        }</li><li>        signer.Init(<span class="hljs-literal">true</span>, <span class="hljs-keyword">new</span> ParametersWithRandom(rsaPrivateKey, <span class="hljs-keyword">new</span> SecureRandom()));</li><li>        signer.BlockUpdate(data, <span class="hljs-number">0</span>, data.Length);</li><li>        <span class="hljs-built_in">byte</span>[] signature = signer.GenerateSignature();</li><li>        <span class="hljs-keyword">return</span> Convert.ToBase64String(signature);</li><li>    }</li><li>}</li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section17670192215175">验签规则<i class="anchor-icon anchor-icon-link" anchorid="section17670192215175" tips="复制节点链接"></i></h2>          <p><strong>验签场景</strong><strong>：</strong>商户需要对来自Payment Kit服务器的信息做验签，验证签名信息身份来自Payment Kit服务器。商户服务器对华为支付服务器返回的回调通知请求参数和退款通知请求参数验签。</p>     <p><strong>验签算法</strong><strong>：</strong>SM2。</p>     <p><strong>开发步骤：</strong>确认验证签名的公钥证书、确认参与签名字段将待签名字段转换为“key=value”并以符号“&amp;”拼接、使用验签方法验证签名。</p>     <ol>      <li>获取华为支付公钥，此处公钥证书为<a href="https://petalpay-merchant.cloud.huawei.com/" target="_blank">华为支付商户平台</a>获取的证书，可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-certificates-config#section377312802116" target="_blank">下载华为支付证书</a>。</li>      <li>获取参与签名的字段，转换为map并将map的“key-value”排序后以符号“&amp;”拼接。</li>      <li>使用SM2算法进行验签，具体参考<a href="https://gitcode.com/HarmonyOS_Samples/paymentkit-sample-code-serverdemo-java" target="_blank">示例代码</a>引入华为支付提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-server-connect" target="_blank">Maven依赖（pay-java）</a>中VerifyTools.java类的verifySign方法。</li>     </ol>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p style="color: rgb(255,0,0);">因业务发展需要，接口字段可能发生变动，建议验签功能实现可扩展——即“先对回调通知的请求体进行验签处理，再转换成业务对象处理”，以确保在字段有变化时也可以正常验签。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="section18276164454715" class="firsth2">常用语言SM2验签示例代码参考<i class="anchor-icon anchor-icon-link" anchorid="section18276164454715" tips="复制节点链接"></i></h3>          <p><strong>JavaScript语言</strong></p>     <p>javascript可通过sm-crypto模块实现，如已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/payment-certificates-config#li971411417543" target="_blank">安装node环境</a>，可执行如下命令安装：</p>     <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>npm install sm-crypto</li></ol></pre></div></div>     <p>验签实现示例代码：</p>     <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-title class_">SmCrypto</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">'sm-crypto'</span>);</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">signSM2Verify</span>(<span class="hljs-params">plainData, sign, publicStr</span>) {</li><li>  <span class="hljs-keyword">let</span> signHex1 = <span class="hljs-title function_">base64ToHex</span>(sign)</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"plainData: "</span> + plainData)</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"sign: "</span> + sign)</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"sign hex: "</span> + signHex1)</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">SmCrypto</span>.<span class="hljs-property">sm2</span>.<span class="hljs-title function_">doVerifySignature</span>(plainData, signHex1, publicStr, {</li><li>    <span class="hljs-attr">hash</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-attr">der</span>: <span class="hljs-literal">true</span></li><li>  })</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">base64ToHex</span>(<span class="hljs-params">base64String</span>) {</li><li>  <span class="hljs-keyword">const</span> buffer = <span class="hljs-title class_">Buffer</span>.<span class="hljs-title function_">from</span>(base64String, <span class="hljs-string">'base64'</span>);</li><li>  <span class="hljs-keyword">return</span> buffer.<span class="hljs-title function_">toString</span>(<span class="hljs-string">'hex'</span>);</li><li>}</li><li><span class="hljs-keyword">let</span> signSM2VerifyRes = <span class="hljs-title function_">signSM2Verify</span>(</li><li>    <span class="hljs-string">"验签排序拼接内容"</span>,</li><li>    <span class="hljs-string">"验签sign"</span>,</li><li>    <span class="hljs-string">"验签公钥"</span></li><li>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(signSM2VerifyRes)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section2091445712409">通知回调接口说明<i class="anchor-icon anchor-icon-link" anchorid="section2091445712409" tips="复制节点链接"></i></h2>          <ul>      <li>对于回调通知，如果Payment Kit未收到application/json类型响应的数据，或收到应答数据不是{"resultCode":"000000","resultDesc":"Success."} ，Payment Kit会通过一定的周期定期重新发起通知，但不保证通知最终能成功。</li>      <li>相同通知可能多次重复发送给商户服务器，商户服务器需要正确实现以应对重复请求，处理建议：       <ul>        <li>在商户服务器收到通知进行业务处理前先检查对应业务状态，对于未处理过的场景才进行业务处理。已处理的场景则直接返回成功。</li>        <li>在业务处理时，合理设计同步机制防止并发问题。</li>       </ul></li>      <li>如果在预期时间内未收到Payment Kit的回调请求，请排查提供的callbackUrl网络是否连通。如排除网络连通性问题，请调用同步查询接口确认订单状态。排查建议：       <ul>        <li>确认callbackUrl为商户系统真实地址，保证url中的域名或IP是外网可以正常访问的。不能填写localhost、127.0.0.1、192.168.x.x、10.xx.xx.xx等。</li>        <li>callbackUrl必须为https://开头的完整地址。</li>       </ul></li>      <li>对于收到的异步回调请求，请务必进行验签处理并在验签通过后进行后续业务流程。否则可能因为信息泄露导致对商户潜在的攻击，造成资金损失。</li>      <li>因商户自身系统实现问题导致的业务异常，资金损失，由商户自行承担。</li>      <li>如商户对支付回调地址有IP防火墙策略限制，需要对以下网段开通允许名单，后续有变动时会在此处更新。       <ul>        <li>124.70.118.0/24</li>        <li>139.159.166.0/24</li>       </ul></li>      <li>商户系统收到回调通知时，需要在<strong>3秒内</strong>返回应答响应，否则华为支付会认为通知失败，会触发重试机制。</li>      <li>商户系统收到异步通知并返回{"resultCode":"000000","resultDesc":"Success."}时，服务器异步通知参数callbackId才会失效。同一个异步通知请求的多次重试callbackId是不变的。</li>     </ul>     <p><strong>接口约束</strong></p>     <ul>      <li>请勿将开发者的服务器的IP允许清单设置成用于限制华为的出口IP地址。IP允许清单本身并不能提高安全性且会给业务发展带来约束，在消息层面已有更安全的RSA签名机制条件下，没有存在价值。若开发者不遵守此约定带来的后果将由开发者自行承担。</li>      <li>地址必须支持HTTPS协议且具有合法商用证书，否则无法正常接收通知消息。</li>      <li>支持的TLS协议版本：1.2 / 1.3。</li>      <li>支持的加密套件列表：       <div _ngcontent-yih-c106="" class="highlight-div"><div _ngcontent-yih-c106="" class="highlight-div-header"><div _ngcontent-yih-c106="" class="highlight-div-header-left"><div _ngcontent-yih-c106="" class="handle-button expand-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yih-c106="" class="highlight-div-header-right"><div _ngcontent-yih-c106="" class="handle-button ai-button"></div><div _ngcontent-yih-c106="" class="handle-button line-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yih-c106="" class="handle-button theme-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yih-c106="" class="handle-button copy-button"><div _ngcontent-yih-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yih-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>TLS_DHE_RSA_WITH_AES_128_GCM_SHA256</li><li>TLS_DHE_RSA_WITH_AES_256_GCM_SHA384</li><li>TLS_DHE_DSS_WITH_AES_128_GCM_SHA256</li><li>TLS_DHE_DSS_WITH_AES_256_GCM_SHA384</li><li>TLS_ECDHE_ECDSA_WITH_AES_128_GCM_SHA256</li><li>TLS_ECDHE_ECDSA_WITH_AES_256_GCM_SHA384</li><li>TLS_ECDHE_RSA_WITH_AES_128_GCM_SHA256</li><li>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</li><li>TLS_AES_128_GCM_SHA256</li></ol></pre></div></div>       <p></p></li>     </ul>    </div>   </div>   <div></div></div>