<h1 _ngcontent-xma-c119="" class="doc-title ng-star-inserted" title="标准C++库"> 标准C++库 </h1>

<div _ngcontent-xma-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>HarmonyOS使用llvm开源项目的C++标准库<a href="https://libcxx.llvm.org/" target="_blank">libc++</a>作为C++运行时库。</p>  <div class="tiledSection"><h2 id="libc版本">libc++版本<i class="anchor-icon anchor-icon-link" anchorid="libc版本" tips="复制节点链接"></i></h2><p>从HarmonyOS 4.0开始到HarmonyOS 6.0，libc++升级到clang/llvm 15.0.4版本</p> <p>从HarmonyOS 3.2开始，libc++升级到clang/llvm 12.0.1版本</p> <p>从HarmonyOS 3.0开始，libc++使用clang/llvm 10.0.1版本</p> </div>  <div class="tiledSection"><h2 id="c语言支持能力">C++语言支持能力<i class="anchor-icon anchor-icon-link" anchorid="c语言支持能力" tips="复制节点链接"></i></h2><p>C++11、C++14标准已完全支持，C++17和C++20标准的部分特性已支持。开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-faqs/faqs-ndk-9" target="_blank">如何修改代码工程所支持的C++语言版本</a>来设置自己开发所需C++标准版本。如果将C++版本设置为C++17或者C++20，但使用了不支持的特性，会导致编译失败。具体语言特性支持标准可以参考<a href="https://libcxx.llvm.org/" target="_blank">https://libcxx.llvm.org/</a>网站对应的Release Notes。</p> </div>  <div class="tiledSection"><h2 id="如何在cmake中选择c">如何在CMake中选择C++<i class="anchor-icon anchor-icon-link" anchorid="如何在cmake中选择c" tips="复制节点链接"></i></h2><p>在NDK的{ndk_root}/build/cmake/ohos.toolchain.cmake文件中，定义了OHOS_STL变量，可以通过设置"c++_shared"或者"c++_static"来控制应用工程中原生库链接C++运行库的方式。</p> <ul><li>c++_shared，原生库动态链接libc++_shared.so</li><li>c++_static，原生库静态链接libc++_static.a</li></ul> </div>  <div class="tiledSection"><h2 id="c运行时兼容性">C++运行时兼容性<i class="anchor-icon anchor-icon-link" anchorid="c运行时兼容性" tips="复制节点链接"></i></h2><p>在HarmonyOS系统中，系统库与应用原生库都在使用C++标准库，两部分升级节奏不一样，依赖C++运行时版本也可能不一样。系统库依赖的C++标准库随镜像版本升级，而应用原生库依赖的C++标准库随编译使用的SDK版本升级，两部分依赖的C++基础库会跨多个大版本，产生ABI兼容性问题。为了解决此问题，HarmonyOS上把两部分依赖的C++标准库进行了区分。</p> <div _ngcontent-xma-c106="" class="highlight-div"><div _ngcontent-xma-c106="" class="highlight-div-header"><div _ngcontent-xma-c106="" class="highlight-div-header-left"><div _ngcontent-xma-c106="" class="handle-button expand-button"><div _ngcontent-xma-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xma-c106="" class="highlight-div-header-right"><div _ngcontent-xma-c106="" class="handle-button ai-button"></div><div _ngcontent-xma-c106="" class="handle-button line-button"><div _ngcontent-xma-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xma-c106="" class="handle-button theme-button"><div _ngcontent-xma-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xma-c106="" class="handle-button copy-button"><div _ngcontent-xma-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xma-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-markdown" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-bullet">*</span> 系统库：使用libc++.so， 随系统镜像发布。</li><li><span class="hljs-bullet">*</span> 应用Native库：使用libc++<span class="hljs-emphasis">_shared.so，随应用发布。</span></li></ol></pre></div></div> <p> 两个库使用的C++命名空间不一样，libc++_shared.so使用__n1作为C++符号的命名空间，libc++.so使用__h作为C++符号的命名空间。</p> <p> 注意：两边使用的C++标准库不能进行混用，Native API接口当前只能是C接口，可以通过这个接口隔离两边的C++运行环境。</p> </div>  <div class="tiledSection"><h2 id="注意事项">注意事项<i class="anchor-icon anchor-icon-link" anchorid="注意事项" tips="复制节点链接"></i></h2><ol><li><p>C++运行时库工具链进行大版本升级的时候，不保证一定二进制兼容；一个应用包如果有多个动态库，这些动态库<strong>必须用同一个大版本的clang工具链进行编译</strong>，依赖相同版本的libc++_shared库，否则有可能产生不可预知的错误。</p>  </li><li><p>在一个应用工程里面，如果只有一个共享库，建议使用静态链接c++_static，这样能够让链接器精简使用的C++运行时代码，降低包大小。如果有多个库，或者依赖带动态库的har包，或者ohpm上带库的二进制中间件，建议采用动态链接C++库；采用静态链接会导致程序中定义多个函数或对象的副本，会破坏C++的单一定义规则（One Definition Rule），出现不可预知问题。</p>  </li></ol> </div> </div> <div></div></div>