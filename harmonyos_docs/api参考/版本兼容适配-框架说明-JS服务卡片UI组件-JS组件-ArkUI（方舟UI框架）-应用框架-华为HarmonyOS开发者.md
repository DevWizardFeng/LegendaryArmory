<h1 _ngcontent-aei-c119="" class="doc-title ng-star-inserted" title="版本兼容适配"> 版本兼容适配 </h1>

<div _ngcontent-aei-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>卡片特性不断增加，使用了新特性的卡片，在不支持这些新特性的老系统上可能显示异常。可以在卡片工程中指定最小SDK版本，防止使用新特性的卡片推送安装在老的系统上。也可以参考本章节的内容，在卡片开发阶段做前向兼容适配。</p> <p>开发者可以通过JSON配置文件配置前向兼容能力。该文件提供了apiVersion属性用于兼容版本，该字段和卡片配置文件的数据字段data、事件字段actions同级。在apiVersion标签下定义的内容会基于当前运行版本信息，覆盖原始的data标签内容。</p> <p>示例如下：</p> <p>假设JS服务卡片框架从API version 9开始，支持设置webp格式的图源（仅用于举例，不代表实际情况），则可以按照如下的方式，做前向兼容。</p> <div _ngcontent-aei-c106="" class="highlight-div"><div _ngcontent-aei-c106="" class="highlight-div-header"><div _ngcontent-aei-c106="" class="highlight-div-header-left"><div _ngcontent-aei-c106="" class="handle-button expand-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aei-c106="" class="highlight-div-header-right"><div _ngcontent-aei-c106="" class="handle-button ai-button"></div><div _ngcontent-aei-c106="" class="handle-button line-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aei-c106="" class="handle-button theme-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aei-c106="" class="handle-button copy-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aei-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- xxx.hml --&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"{{imageSrc}}"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"width: 100px;height: 100px;"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li></ol></pre></div></div> <p>JSON配置文件：</p> <div _ngcontent-aei-c106="" class="highlight-div"><div _ngcontent-aei-c106="" class="highlight-div-header"><div _ngcontent-aei-c106="" class="highlight-div-header-left"><div _ngcontent-aei-c106="" class="handle-button expand-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aei-c106="" class="highlight-div-header-right"><div _ngcontent-aei-c106="" class="handle-button ai-button"></div><div _ngcontent-aei-c106="" class="handle-button line-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aei-c106="" class="handle-button theme-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aei-c106="" class="handle-button copy-button"><div _ngcontent-aei-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aei-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"imageSrc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"defaultSrc.png"</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"apiVersion"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"9"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"imageSrc"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"newSrc.webp"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p>JS服务卡片开发框架会根据应用中的配置及当前系统运行版本，选取最合适的数据。</p> <p>假设系统运行版本在8及以下，则实际解析的imageSrc值为defaultSrc.png；</p> <p>假设系统运行版本为9，则实际解析的imageSrc值为newSrc.webp。</p> </div> <div></div></div>