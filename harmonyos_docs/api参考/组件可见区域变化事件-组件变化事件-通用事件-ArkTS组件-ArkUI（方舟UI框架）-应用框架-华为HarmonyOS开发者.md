<h1 _ngcontent-yyu-c119="" class="doc-title ng-star-inserted" title="组件可见区域变化事件"> 组件可见区域变化事件 </h1>

<div _ngcontent-yyu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>组件可见区域变化事件是组件在屏幕中的显示区域面积变化时触发的事件，提供了判断组件是否完全或部分显示在屏幕中的能力，适用于广告曝光埋点之类的场景。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p> 从API version 9开始支持。后续版本如有新增内容，则采用上角标单独标记该内容的起始版本。</p>  </div></div></div>  <div class="tiledSection"><h2 id="onvisibleareachange" device-type="phone,2in1,tablet,wearable,tv">onVisibleAreaChange<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onvisibleareachange" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>onVisibleAreaChange(ratios: Array&lt;number&gt;, event: VisibleAreaChangeCallback): T</p> <p>组件可见区域变化时触发该回调。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ul><li><p>从API version 20开始，该接口支持在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier#attributemodifier">attributeModifier</a>中调用。</p>  </li><li><p>仅提供自身节点相对于所有祖先节点（直到window边界）的相对裁切面积与自身面积的比值及其变化趋势。</p>  </li><li><p>不支持兄弟组件对自身节点的遮挡计算，不支持所有祖先的兄弟节点对自身节点的遮挡计算，不支持窗口遮挡计算，不支持组件旋转计算，如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-stack">Stack</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-z-order">Z序控制</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-transformation#rotate">rotate</a>等。</p>  </li><li><p>不支持非挂树节点的可见面积变化计算。例如，预加载的节点、通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-overlay#overlay">overlay</a>能力挂载的自定义节点。</p>  </li></ul>  </div></div></div> <p><strong>元服务API：</strong> 从API version 11开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.3.8.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">ratios</td> <td class="cellrowborder" width="25%">Array&lt;number&gt;</td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%"><p>阈值数组。其中，每个阈值代表组件可见面积（即组件在屏幕显示区的面积，只计算父组件内的面积，超出父组件部分不会计算）与组件自身面积的比值。当组件可见面积与自身面积的比值接近阈值时，均会触发该回调。每个阈值的取值范围为[0.0, 1.0]，如果开发者设置的阈值超出该范围，则会实际取值0.0或1.0。</p> <p><strong>说明：</strong> </p> <p>当数值接近边界0和1时，将会按照误差不超过0.001的规则进行舍入。例如，0.9997会被近似为1。</p> </td> </tr> <tr><td class="cellrowborder" width="25%">event</td> <td class="cellrowborder" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#visibleareachangecallback12">VisibleAreaChangeCallback</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">组件可见区域变化事件的回调。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.3.10.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.3.10.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">T</td> <td class="cellrowborder" width="50%">返回当前组件。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="onvisibleareaapproximatechange17" device-type="phone,2in1,tablet,wearable,tv">onVisibleAreaApproximateChange<sup>17+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="onvisibleareaapproximatechange17" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>onVisibleAreaApproximateChange(options: VisibleAreaEventOptions, event: VisibleAreaChangeCallback | undefined): T</p> <p>设置onVisibleAreaApproximateChange事件的回调参数，限制它的执行间隔。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ul><li><p>该接口不支持在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-attribute-modifier#attributemodifier">attributeModifier</a>中调用。</p>  </li><li><p>此接口与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#onvisibleareachange">onVisibleAreaChange</a>接口存在如下差异：onVisibleAreaChange在每一帧都会进行可见区域比例的计算，如果注册节点太多，系统功耗存在劣化。而此接口降低了可见区域比例计算的频度，计算间隔由<a href="/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#visibleareaeventoptions12">VisibleAreaEventOptions</a>的expectedUpdateInterval参数决定。</p>  </li><li><p>当前接口的可见区域回调阈值默认包含0。例如，开发者设置回调阈值为[0.5]，实际生效的阈值为[0.0, 0.5]。</p>  </li><li><p>从API version 18开始，支持在自定义组件中调用该接口。</p>  </li><li><p>从API version 21开始，返回值类型由void改为T。</p>  </li></ul>  </div></div></div> <p><strong>元服务API：</strong> 从API version 17开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.4.8.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">options</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#visibleareaeventoptions12">VisibleAreaEventOptions</a></td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">可见区域变化相关的参数。</td> </tr> <tr><td class="cellrowborder" width="25%">event</td> <td class="cellrowborder" width="25%"><a href="/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#visibleareachangecallback12">VisibleAreaChangeCallback</a> | undefined</td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">onVisibleAreaChange事件的回调函数。当组件可见面积与自身面积的比值接近options中设置的阈值时触发该回调。</td> </tr>  </tbody></table></div> </div> <p><strong>返回值：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="tableClass2_t"> <tbody><tr class="firstRow"><th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.1" width="50%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.2" width="50%">说明</th> </tr><tr><td class="cellrowborder" width="50%">T</td> <td class="cellrowborder" width="50%">返回当前组件。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="visibleareaeventoptions12" device-type="phone,2in1,tablet,wearable,tv">VisibleAreaEventOptions<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="visibleareaeventoptions12" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>关于区域变化相关的参数。</p> <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.4.1.6.1.1" width="20%">名称</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.6.1.2" width="20%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.6.1.3" width="20%">只读</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.6.1.4" width="20%">可选</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.6.1.5" width="20%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="20%">ratios</td> <td class="cellrowborder" width="20%">Array&lt;number&gt;</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%"><p>阈值数组。其中，每个阈值代表组件可见面积（即组件在屏幕显示区的面积，只计算父组件内的面积，超出父组件部分不会计算）与组件自身面积的比值。每个阈值的取值范围为[0.0, 1.0]，如果开发者设置的阈值超出该范围，则会实际取值0.0或1.0。</p> <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p> </td> </tr> <tr><td class="cellrowborder" width="20%">expectedUpdateInterval</td> <td class="cellrowborder" width="20%">number</td> <td class="cellrowborder" width="20%">否</td> <td class="cellrowborder" width="20%">是</td> <td class="cellrowborder" width="20%"><p>定义了开发者期望的计算间隔，单位为ms。</p> <p>默认值：1000 </p> <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="visibleareachangecallback12" device-type="phone,2in1,tablet,wearable,tv">VisibleAreaChangeCallback<sup>12+</sup><i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="visibleareachangecallback12" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>type VisibleAreaChangeCallback = (isExpanding: boolean, currentRatio: number) =&gt; void</p> <p>组件可见区域变化事件的回调类型。</p> <p><strong>元服务API：</strong> 从API version 12开始，该接口支持在元服务中使用。</p> <p><strong>系统能力：</strong> SystemCapability.ArkUI.ArkUI.Full</p> <p><strong>参数：</strong></p>  <div class="tablenoborder"><div class="tbBox"><table><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.1" width="25%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.2" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.3" width="25%">必填</th> <th align="left" class="cellrowborder" id="mcps1.3.6.7.1.5.1.4" width="25%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" width="25%">isExpanding</td> <td class="cellrowborder" width="25%">boolean</td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">视组件的可见面积与自身面积的比值与上一次回调相比的情况而定，比值变大为true，比值变小为false。</td> </tr> <tr><td class="cellrowborder" width="25%">currentRatio</td> <td class="cellrowborder" width="25%">number</td> <td class="cellrowborder" width="25%">是</td> <td class="cellrowborder" width="25%">触发回调时，组件可见面积与自身面积的比值。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="示例" device-type="phone,2in1,tablet,wearable,tv">示例<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="示例" tips="复制节点链接"></i></h2><div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div></div>  <div class="tiledSection"><h3 id="示例1-使用onvisibleareachange来监听区域变化" class="firsth2">示例1 (使用onVisibleAreaChange来监听区域变化)<i class="anchor-icon anchor-icon-link" anchorid="示例1-使用onvisibleareachange来监听区域变化" tips="复制节点链接"></i></h3><p>该示例对组件设置<a href="/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#onvisibleareachange">onVisibleAreaChange</a>事件，当组件完全显示或者完全消失时触发回调。</p> <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ScrollExample</span> {</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testTextStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'test'</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testRowStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'test'</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.3</span>)</li><li>
</li><li>      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Test Text Visible Change"</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>            <span class="hljs-comment">// 通过设置ratios为[0.0, 1.0]，实现当组件完全显示或完全消失在屏幕中时触发回调。</span></li><li>            .<span class="hljs-title function_">onVisibleAreaChange</span>([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], <span class="hljs-function">(<span class="hljs-params">isExpanding: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text isExpanding: <span class="hljs-subst">${isExpanding}</span>, currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>              <span class="hljs-keyword">if</span> (isExpanding &amp;&amp; currentRatio &gt;= <span class="hljs-number">1.0</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text is fully visible. currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span> = <span class="hljs-string">'Test Text is fully visible'</span></li><li>              }</li><li>
</li><li>              <span class="hljs-keyword">if</span> (!isExpanding &amp;&amp; currentRatio &lt;= <span class="hljs-number">0.0</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Text is completely invisible.'</span>)</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span> = <span class="hljs-string">'Test Text is completely invisible'</span></li><li>              }</li><li>            })</li><li>
</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Test Row Visible  Change'</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })</li><li>
</li><li>          }</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>          .<span class="hljs-title function_">onVisibleAreaChange</span>([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], <span class="hljs-function">(<span class="hljs-params">isExpanding: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text isExpanding: <span class="hljs-subst">${isExpanding}</span>, currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>            <span class="hljs-keyword">if</span> (isExpanding &amp;&amp; currentRatio &gt;= <span class="hljs-number">1.0</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Row is fully visible.'</span>)</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span> = <span class="hljs-string">'Test Row is fully visible'</span></li><li>            }</li><li>
</li><li>            <span class="hljs-keyword">if</span> (!isExpanding &amp;&amp; currentRatio &lt;= <span class="hljs-number">0.0</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Row is completely invisible.'</span>)</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span> = <span class="hljs-string">'Test Row is completely invisible'</span></li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> (item.<span class="hljs-title function_">toString</span>()))</li><li>
</li><li>        }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x317aff</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>)</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>)</li><li>      .<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      .<span class="hljs-title function_">scrollBarWidth</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">onWillScroll</span>(<span class="hljs-function">(<span class="hljs-params">xOffset: <span class="hljs-built_in">number</span>, yOffset: <span class="hljs-built_in">number</span>, scrollState: ScrollState</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${xOffset}</span> <span class="hljs-subst">${yOffset}</span>`</span>)</li><li>      })</li><li>      .<span class="hljs-title function_">onScrollEdge</span>(<span class="hljs-function">(<span class="hljs-params">side: Edge</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'To the edge'</span>)</li><li>      })</li><li>      .<span class="hljs-title function_">onScrollStop</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Scroll Stop'</span>)</li><li>      })</li><li>
</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="示例2-使用onvisibleareaapproximatechange来监听区域变化">示例2 (使用onVisibleAreaApproximateChange来监听区域变化)<i class="anchor-icon anchor-icon-link" anchorid="示例2-使用onvisibleareaapproximatechange来监听区域变化" tips="复制节点链接"></i></h3><p>从API version 17开始，该示例对组件设置<a href="/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#onvisibleareaapproximatechange17">onVisibleAreaApproximateChange</a>事件，当组件完全显示或者完全消失时触发回调。</p> <div _ngcontent-yyu-c106="" class="highlight-div"><div _ngcontent-yyu-c106="" class="highlight-div-header"><div _ngcontent-yyu-c106="" class="highlight-div-header-left"><div _ngcontent-yyu-c106="" class="handle-button expand-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yyu-c106="" class="highlight-div-header-right"><div _ngcontent-yyu-c106="" class="handle-button ai-button"></div><div _ngcontent-yyu-c106="" class="handle-button line-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yyu-c106="" class="handle-button theme-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yyu-c106="" class="handle-button copy-button"><div _ngcontent-yyu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yyu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ScrollExample</span> {</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>]</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testTextStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'test'</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">testRowStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'test'</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.3</span>)</li><li>
</li><li>      <span class="hljs-title class_">Scroll</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Test Text Visible Change"</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>            <span class="hljs-comment">// 通过设置ratios为[0.0, 1.0]，实现当组件完全显示或完全消失在屏幕中时触发回调。</span></li><li>            .<span class="hljs-title function_">onVisibleAreaApproximateChange</span>({ <span class="hljs-attr">ratios</span>: [<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], <span class="hljs-attr">expectedUpdateInterval</span>: <span class="hljs-number">1000</span> },</li><li>              <span class="hljs-function">(<span class="hljs-params">isExpanding: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text isExpanding: <span class="hljs-subst">${isExpanding}</span>, currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>                <span class="hljs-keyword">if</span> (isExpanding &amp;&amp; currentRatio &gt;= <span class="hljs-number">1.0</span>) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text is fully visible. currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span> = <span class="hljs-string">'Test Text is fully visible'</span></li><li>                }</li><li>
</li><li>                <span class="hljs-keyword">if</span> (!isExpanding &amp;&amp; currentRatio &lt;= <span class="hljs-number">0.0</span>) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Text is completely invisible.'</span>)</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">testTextStr</span> = <span class="hljs-string">'Test Text is completely invisible'</span></li><li>                }</li><li>              })</li><li>
</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Test Row Visible  Change'</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })</li><li>
</li><li>          }</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>          .<span class="hljs-title function_">onVisibleAreaChange</span>([<span class="hljs-number">0.0</span>, <span class="hljs-number">1.0</span>], <span class="hljs-function">(<span class="hljs-params">isExpanding: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Test Text isExpanding: <span class="hljs-subst">${isExpanding}</span>, currentRatio: <span class="hljs-subst">${currentRatio}</span>`</span>)</li><li>            <span class="hljs-keyword">if</span> (isExpanding &amp;&amp; currentRatio &gt;= <span class="hljs-number">1.0</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Row is fully visible.'</span>)</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span> = <span class="hljs-string">'Test Row is fully visible'</span></li><li>            }</li><li>
</li><li>            <span class="hljs-keyword">if</span> (!isExpanding &amp;&amp; currentRatio &lt;= <span class="hljs-number">0.0</span>) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test Row is completely invisible.'</span>)</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">testRowStr</span> = <span class="hljs-string">'Test Row is completely invisible'</span></li><li>            }</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">150</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFFFFF</span>)</li><li>              .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">15</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>          }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> (item.<span class="hljs-title function_">toString</span>()))</li><li>
</li><li>        }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x317aff</span>)</li><li>      .<span class="hljs-title function_">scrollable</span>(<span class="hljs-title class_">ScrollDirection</span>.<span class="hljs-property">Vertical</span>)</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">On</span>)</li><li>      .<span class="hljs-title function_">scrollBarColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      .<span class="hljs-title function_">scrollBarWidth</span>(<span class="hljs-number">10</span>)</li><li>      .<span class="hljs-title function_">onWillScroll</span>(<span class="hljs-function">(<span class="hljs-params">xOffset: <span class="hljs-built_in">number</span>, yOffset: <span class="hljs-built_in">number</span>, scrollState: ScrollState</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${xOffset}</span> <span class="hljs-subst">${yOffset}</span>`</span>)</li><li>      })</li><li>      .<span class="hljs-title function_">onScrollEdge</span>(<span class="hljs-function">(<span class="hljs-params">side: Edge</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'To the edge'</span>)</li><li>      })</li><li>      .<span class="hljs-title function_">onScrollStop</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Scroll Stop'</span>)</li><li>      })</li><li>
</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xDCDCDC</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <p><span><img originheight="537" originwidth="248" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115822.11427266342576888998583202731732:50001231000000:2800:C2870B65DBC0640CC31C334FE0ECDCE0C496A1D548964CD7A3C79EEEA79B0FFA.gif" class="notEnlarge" width="248" height="537"></span></p> </div> </div> <div></div></div>