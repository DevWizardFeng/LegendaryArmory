<h1 _ngcontent-trp-c119="" class="doc-title ng-star-inserted" title="获取用户级凭证"> 获取用户级凭证 </h1>

<div _ngcontent-trp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p>为了更安全的网络访问，推荐使用TLS1.2版本，关于TLS协议及加密套件的信息，可以点击这里进行详细了解：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-common#section1329115361128">TLS协议及加密套件</a>。</p>      <p>若应用服务端访问华为账号服务使用协议是TLS1.0、TLS1.1或规定外的加密套件，可能无法正常访问华为账号服务，请务必升级到TLS1.2版本。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section872443017553">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section872443017553" tips="复制节点链接"></i></h2>          <p>应用服务端调用此接口时，获取用户级Access Token、Refresh Token。</p>    </div>    <div class="tiledSection">     <h2 id="section1127512365617">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section1127512365617" tips="复制节点链接"></i></h2>          <p>您已经通过授权获取到授权码（Authorization Code），通过授权码获取Access Token、Refresh Token、ID Token。</p>    </div>    <div class="tiledSection">     <h2 id="section597833116595">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section597833116595" tips="复制节点链接"></i></h2>          <ul>      <li>需确保调用端网络正常。</li>      <li>Authorization Code只有5分钟有效期，并且用完一次就会失效，需要用户重新授权，生成Authorization Code。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1085901313579">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section1085901313579" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.1.1" width="19.82%">          <p>承载协议</p></th>         <td class="cellrowborder" width="80.17999999999999%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.2.1" width="19.82%">          <p>接口方向</p></th>         <td class="cellrowborder" width="80.17999999999999%">          <p>开发者服务器-&gt;华为账号服务器</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.3.1" width="19.82%">          <p>接口URL</p></th>         <td class="cellrowborder" width="80.17999999999999%">          <p>https://oauth-login.cloud.huawei.com/oauth2/v3/token</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.4.1" width="19.82%">          <p>数据格式</p></th>         <td class="cellrowborder" width="80.17999999999999%">          <p>请求消息：Content-Type: application/x-www-form-urlencoded</p>          <p>响应消息：Content-Type: application/json;charset=utf-8</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section88192615912">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section88192615912" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section453861191319" class="firsth2">Request Header<i class="anchor-icon anchor-icon-link" anchorid="section453861191319" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.1" width="20.562056205620564%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.2" width="12.711271127112711%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.3" width="13.34133413341334%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.4" width="53.385338533853385%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="12.711271127112711%">          <p>是</p></td>         <td class="cellrowborder" width="13.34133413341334%">          <p>String</p></td>         <td class="cellrowborder" width="53.385338533853385%">          <p>取值为：application/x-www-form-urlencoded。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>Request Body传参，请务必遵循此请求头格式，否则可能导致请求失败，具体传参方式可参考<a href="/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section14184218174113">示例代码</a>。</p>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section191861726101318">Request Body<i class="anchor-icon anchor-icon-link" anchorid="section191861726101318" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.1" width="20.562056205620564%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.2" width="12.48124812481248%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.3" width="13.681368136813681%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.4" width="53.275327532753266%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>grant_type</p></td>         <td class="cellrowborder" width="12.48124812481248%">          <p>是</p></td>         <td class="cellrowborder" width="13.681368136813681%">          <p>String</p></td>         <td class="cellrowborder" width="53.275327532753266%">          <p>授权模式，固定传“authorization_code”。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>client_id</p></td>         <td class="cellrowborder" width="12.48124812481248%">          <p>是</p></td>         <td class="cellrowborder" width="13.681368136813681%">          <p>String</p></td>         <td class="cellrowborder" width="53.275327532753266%">          <p>在创建应用后，由AppGallery Connect（简称AGC）为应用分配的唯一标识。参数取值详见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-appinfo-0000001100014694" target="_blank">查看应用基本信息</a>中的<strong>OAuth 2.0客户端ID(凭据)-Client ID</strong>参数。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>该参数与获取code参数时的Client ID必须一致，否则会报错（sub_error=20154），如出现此报错，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-client-id" target="_blank">配置Client ID</a>排查处理。</p>           </div></div></div></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>client_secret</p></td>         <td class="cellrowborder" width="12.48124812481248%">          <p>是</p></td>         <td class="cellrowborder" width="13.681368136813681%">          <p>String</p></td>         <td class="cellrowborder" width="53.275327532753266%">          <p>在创建应用后，由AppGallery Connect（简称AGC）为应用分配的密钥（Client Secret）。参数取值详见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-appinfo-0000001100014694" target="_blank">查看应用基本信息</a>中的<strong>OAuth 2.0客户端ID(凭据)-Client Secret</strong>参数。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>code</p></td>         <td class="cellrowborder" width="12.48124812481248%">          <p>是</p></td>         <td class="cellrowborder" width="13.681368136813681%">          <p>String</p></td>         <td class="cellrowborder" width="53.275327532753266%">          <p>当“grant_type”为“authorization_code”时，此参数必选。获取方式详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section15454203811311">LoginWithHuaweiIDResponse</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section10418450161620">AuthorizationWithHuaweiIDResponse</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>supportAlg</p></td>         <td class="cellrowborder" width="12.48124812481248%">          <p>否</p></td>         <td class="cellrowborder" width="13.681368136813681%">          <p>String</p></td>         <td class="cellrowborder" width="53.275327532753266%">          <p>生成ID Token的算法，当前支持的算法如下：</p>          <ul>           <li>PS256（推荐使用）</li>           <li>RS256</li>          </ul>          <p>如果未指定该参数或指定的算法不在支持的范围内，则默认使用RS256。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section171082694320">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section171082694320" tips="复制节点链接"></i></h2>          <div _ngcontent-trp-c106="" class="highlight-div"><div _ngcontent-trp-c106="" class="highlight-div-header"><div _ngcontent-trp-c106="" class="highlight-div-header-left"><div _ngcontent-trp-c106="" class="handle-button expand-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trp-c106="" class="highlight-div-header-right"><div _ngcontent-trp-c106="" class="handle-button ai-button"></div><div _ngcontent-trp-c106="" class="handle-button line-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trp-c106="" class="handle-button theme-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trp-c106="" class="handle-button copy-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-variable">POST</span> /<span class="hljs-variable">oauth2</span>/<span class="hljs-variable">v3</span>/<span class="hljs-variable">token</span> <span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span></span></li><li><span class=""><span class="hljs-variable">Host</span>: <span class="hljs-title class_">oauth</span>-<span class="hljs-title class_">login</span>.<span class="hljs-title class_">cloud</span>.<span class="hljs-title class_">huawei</span>.<span class="hljs-title class_">com</span></span></li><li><span class=""><span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: <span class="hljs-title class_">application</span>/<span class="hljs-variable">x</span>-<span class="hljs-variable">www</span>-<span class="hljs-variable">form</span>-<span class="hljs-variable">urlencoded</span></span></li><li>
</li><li><span class=""><span class="hljs-variable">grant_type</span>=<span class="hljs-variable">authorization_code</span></span><span class="">&amp;</span><span class=""><span class="hljs-variable">code</span>=</span><i><div class="varname_wrapper"><span class="varname"><span>&lt;</span><span><span class="hljs-title class_">code</span></span><span>&gt;</span></span></div></i><span class="">&amp;</span><span class=""><span class="hljs-variable">client_id</span>=</span><i><div class="varname_wrapper"><span class="varname"><span>&lt;</span><span><span class="hljs-title class_">client_id</span></span><span>&gt;</span></span></div></i><span class="">&amp;</span><span class=""><span class="hljs-variable">client_secret</span>=</span><i><div class="varname_wrapper"><span class="varname"><span>&lt;</span><span><span class="hljs-title class_">client_secret</span></span><span>&gt;</span></span></div></i></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section15556142754018">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section15556142754018" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section13897449191316" class="firsth2">Response Header<i class="anchor-icon anchor-icon-link" anchorid="section13897449191316" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.1" width="20.562056205620564%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.2" width="19.781978197819782%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.3" width="22.492249224922492%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.4" width="37.163716371637165%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>取值为：application/json;charset=utf-8。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section14291524142">Response Body<i class="anchor-icon anchor-icon-link" anchorid="section14291524142" tips="复制节点链接"></i></h3>          <p>调用成功时，响应消息体返回如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.1" width="20.562056205620564%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.2" width="19.781978197819782%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.3" width="22.492249224922492%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.4" width="37.163716371637165%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>token_type</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>固定字符串“Bearer”。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>access_token</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>Access Token，访问被权限管控资源的凭证。Access Token长度详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-11" target="_blank">Access Token和Refresh Token长度限制要求</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>scope</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>Access Token中的scope，以空格分隔，最大不会超过150个。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>expires_in</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>Integer</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>Access Token的过期时间，以秒为单位。有效期为3600秒。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>refresh_token</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>Refresh Token，用于刷新Access Token。Refresh Token有效期为180天。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="20.562056205620564%">          <p>id_token</p></td>         <td class="cellrowborder" width="19.781978197819782%">          <p>是</p></td>         <td class="cellrowborder" width="22.492249224922492%">          <p>String</p></td>         <td class="cellrowborder" width="37.163716371637165%">          <p>ID Token（JWT格式），详细信息请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-verify-id-token">验证ID Token有效性</a>中ID Token描述。</p></td>        </tr>             </tbody></table></div>     </div>     <p>调用失败时，响应消息体返回如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.1" width="21.27%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.2" width="19.23%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.3" width="59.5%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="21.27%">          <p>error</p></td>         <td class="cellrowborder" width="19.23%">          <p>int</p></td>         <td class="cellrowborder" width="59.5%">          <p>业务响应主错误码，详见<a href="/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section1394417423453">错误码</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>sub_error</p></td>         <td class="cellrowborder" width="19.23%">          <p>int</p></td>         <td class="cellrowborder" width="59.5%">          <p>业务响应子错误码，详见<a href="/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section1394417423453">错误码</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>error_description</p></td>         <td class="cellrowborder" width="19.23%">          <p>String</p></td>         <td class="cellrowborder" width="59.5%">          <p>错误描述信息。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section15868038142212">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section15868038142212" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section3401102919143" class="firsth2">请求成功时<i class="anchor-icon anchor-icon-link" anchorid="section3401102919143" tips="复制节点链接"></i></h3>          <div _ngcontent-trp-c106="" class="highlight-div"><div _ngcontent-trp-c106="" class="highlight-div-header"><div _ngcontent-trp-c106="" class="highlight-div-header-left"><div _ngcontent-trp-c106="" class="handle-button expand-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trp-c106="" class="highlight-div-header-right"><div _ngcontent-trp-c106="" class="handle-button ai-button"></div><div _ngcontent-trp-c106="" class="handle-button line-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trp-c106="" class="handle-button theme-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trp-c106="" class="handle-button copy-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trp-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK</li><li>Content-Type<span class="hljs-punctuation">:</span> application/json;charset=utf<span class="hljs-number">-8</span></li><li>
</li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"access_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;Access Token&gt;</span></span></div></i><span class="hljs-string">"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"refresh_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;Refresh Token&gt;</span></span></div></i><span class="hljs-string">"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"expires_in"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">3600</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"id_token"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;ID Token&gt;</span></span></div></i><span class="hljs-string">"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"scope"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"openid profile email"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"token_type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Bearer"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section133292482144">请求失败时<i class="anchor-icon anchor-icon-link" anchorid="section133292482144" tips="复制节点链接"></i></h3>          <div _ngcontent-trp-c106="" class="highlight-div"><div _ngcontent-trp-c106="" class="highlight-div-header"><div _ngcontent-trp-c106="" class="highlight-div-header-left"><div _ngcontent-trp-c106="" class="handle-button expand-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trp-c106="" class="highlight-div-header-right"><div _ngcontent-trp-c106="" class="handle-button ai-button"></div><div _ngcontent-trp-c106="" class="handle-button line-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trp-c106="" class="handle-button theme-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trp-c106="" class="handle-button copy-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trp-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">400</span> Bad Request</li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>
</li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"sub_error"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">12304</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"error_description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"invalid client_secret"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1203</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section14184218174113">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section14184218174113" tips="复制节点链接"></i></h2>          <p>Java示例代码如下，运行前需要进行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-common#section444143185314">示例代码环境配置</a>：</p>     <div _ngcontent-trp-c106="" class="highlight-div"><div _ngcontent-trp-c106="" class="highlight-div-header"><div _ngcontent-trp-c106="" class="highlight-div-header-left"><div _ngcontent-trp-c106="" class="handle-button expand-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-trp-c106="" class="highlight-div-header-right"><div _ngcontent-trp-c106="" class="handle-button ai-button"></div><div _ngcontent-trp-c106="" class="handle-button line-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-trp-c106="" class="handle-button theme-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-trp-c106="" class="handle-button copy-button"><div _ngcontent-trp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-trp-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONObject;</li><li><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;</li><li><span class="hljs-keyword">import</span> org.apache.http.NameValuePair;</li><li><span class="hljs-keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</li><li><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpPost;</li><li><span class="hljs-keyword">import</span> org.apache.http.message.BasicNameValuePair;</li><li><span class="hljs-keyword">import</span> org.huawei.uniaccount.util.CallUtils;</li><li><span class="hljs-keyword">import</span> java.io.IOException;</li><li><span class="hljs-keyword">import</span> java.util.ArrayList;</li><li><span class="hljs-keyword">import</span> java.util.List;</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 获取用户级凭证</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-meta">@Slf4j</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserTokenAPIDemo</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {</li><li>        <span class="hljs-comment">// 获取用户级凭证的接口URL</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://oauth-login.cloud.huawei.com/oauth2/v3/token"</span>;</li><li>        <span class="hljs-comment">// 授权模式，这里使用授权码模式（authorization_code）获取Access Token</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">grantType</span> <span class="hljs-operator">=</span> <span class="hljs-string">"authorization_code"</span>;</li><li>        <span class="hljs-comment">// 替换为您的Client ID</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">clientId</span> <span class="hljs-operator">=</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;Client ID&gt;</span></span></div></i><span class="hljs-string">"</span>;</li><li>        <span class="hljs-comment">// 替换为您Client ID对应的Client Secret</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">clientSecret</span> <span class="hljs-operator">=</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;Client Secret&gt;</span></span></div></i><span class="hljs-string">"</span>;</li><li>        <span class="hljs-comment">// 替换为您获取到的授权码（code）</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;Authorization Code&gt;</span></span></div></i><span class="hljs-string">"</span>;</li><li>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> getTokenByCode(url, code, clientSecret, clientId, grantType);</li><li>        <span class="hljs-comment">// 解析获取access_token</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">accessToken</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"access_token"</span>);</li><li>        <span class="hljs-comment">// 解析获取scope</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">scope</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"scope"</span>);</li><li>        <span class="hljs-comment">// 解析获取token_type</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">tokenType</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"token_type"</span>);</li><li>        <span class="hljs-comment">// 解析获取refresh_token</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">refreshToken</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"refresh_token"</span>);</li><li>        <span class="hljs-comment">// 解析获取expires_in</span></li><li>        <span class="hljs-type">Integer</span> <span class="hljs-variable">expiresIn</span> <span class="hljs-operator">=</span> result.getInteger(<span class="hljs-string">"expires_in"</span>);</li><li>        <span class="hljs-comment">// 解析获取id_token</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">idToken</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"id_token"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">getTokenByCode</span><span class="hljs-params">(String url, String code, String clientSecret,</span></li><li><span class="hljs-params">                                             String clientId, String grantType)</span> <span class="hljs-keyword">throws</span> IOException {</li><li>        <span class="hljs-type">HttpPost</span> <span class="hljs-variable">httpPost</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(url);</li><li>        List&lt;NameValuePair&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"code"</span>, code));</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"client_secret"</span>, clientSecret));</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"client_id"</span>, clientId));</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"grant_type"</span>, grantType));</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"supportAlg"</span>, <span class="hljs-string">"PS256"</span>));</li><li>        httpPost.setEntity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlEncodedFormEntity</span>(request));</li><li>        <span class="hljs-comment">// 如需要自定义异常处理请使用api CallUtils#remoteCall(HttpUriRequest, BiFunction&lt;CloseableHttpResponse,String,E&gt;)</span></li><li>        <span class="hljs-keyword">return</span> CallUtils.toJsonObject(CallUtils.remoteCallOAuth(httpPost));</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1394417423453">错误码<i class="anchor-icon anchor-icon-link" anchorid="section1394417423453" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.17.2.1.4.1.1" width="21.27%">          <p>HTTP响应码</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.2.1.4.1.2" width="26.5%">          <p>描述</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.17.2.1.4.1.3" width="52.23%">          <p>解决方法</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="21.27%">          <p>200</p></td>         <td class="cellrowborder" width="26.5%">          <p>成功。</p></td>         <td class="cellrowborder" width="52.23%">          <p>-</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>400</p></td>         <td class="cellrowborder" width="26.5%">          <p>参数错误。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请根据<strong>业务响应主错误码</strong>以及<strong>业务响应子错误码</strong>进一步排查问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>403</p></td>         <td class="cellrowborder" width="26.5%">          <p>无权限访问。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请检查调用环境及配置。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>404</p></td>         <td class="cellrowborder" width="26.5%">          <p>找不到服务。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请检查请求URI是否正确。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>405</p></td>         <td class="cellrowborder" width="26.5%">          <p>不支持的http请求method。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请检查http请求method是否与接口说明一致。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>500</p></td>         <td class="cellrowborder" width="26.5%">          <p>服务内部错误。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>502</p></td>         <td class="cellrowborder" width="26.5%">          <p>请求连接异常，常见于网络状况不稳定。</p></td>         <td class="cellrowborder" width="52.23%">          <p>建议稍后重试，若仍无法解决，请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>503</p></td>         <td class="cellrowborder" width="26.5%">          <p>系统流控。</p></td>         <td class="cellrowborder" width="52.23%">          <p>触发系统流控，请稍后重试。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>504</p></td>         <td class="cellrowborder" width="26.5%">          <p>请求连接超时，常见于网络状况不稳定。</p></td>         <td class="cellrowborder" width="52.23%">          <p>建议稍后重试，若仍无法解决，请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="21.27%">          <p>590</p></td>         <td class="cellrowborder" width="26.5%">          <p>服务内部错误。</p></td>         <td class="cellrowborder" width="52.23%">          <p>请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.18.1.5.1.1" width="20.562056205620564%">         <p>业务响应主错误码</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.18.1.5.1.2" width="19.781978197819782%">         <p>业务响应子错误码</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.18.1.5.1.3" width="22.492249224922492%">         <p>描述</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.18.1.5.1.4" width="37.163716371637165%">         <p>解决方法</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" rowspan="12" width="20.562056205620564%">         <p>1101</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>12304</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>client_secret不正确。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>请前往AppGallery Connect（简称AGC）确认client_secret是否正确。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20002</p></td>        <td class="cellrowborder">         <p>client_id格式不正确。</p></td>        <td class="cellrowborder">         <p>检查client_id是否满足正则：^[0-9]{1,64}$。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20003</p></td>        <td class="cellrowborder">         <p>client_id格式不正确或系统不存在。</p></td>        <td class="cellrowborder">         <ul>          <li>检查client_id是否满足正则：^[0-9]{1,64}$。</li>          <li>请前往AppGallery Connect（简称AGC）确认client_id是否存在。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20085</p></td>        <td class="cellrowborder">         <p>client_secret为空。</p></td>        <td class="cellrowborder">         <p>请按照接口参数的要求，传入正确的client_secret参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20152</p></td>        <td class="cellrowborder">         <p>code格式不正确。</p></td>        <td class="cellrowborder">         <p>检查code格式是否满足正则：^[0-9a-zA-Z=/\\+]+$。</p>         <p>该错误码出现可能场景：</p>         <ul>          <li>code参数被篡改，导致格式不符。</li>         </ul>         <ul>          <li>请求头的Content-Type为application/x-www-form-urlencoded，但实际代码调用时，未对请求body体进行URLEncode处理，可参考<a href="/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token#section14184218174113">示例代码</a>组装参数。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20154</p></td>        <td class="cellrowborder">         <p>code中的client_id和入参不一致。</p></td>        <td class="cellrowborder">         <p>检查入参client_id是否与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-client-id" target="_blank">配置Client ID</a>中的值一致。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20155</p></td>        <td class="cellrowborder">         <p>code过期，code只有5分钟有效期。</p></td>        <td class="cellrowborder">         <p>需要重新获取code。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20156</p></td>        <td class="cellrowborder">         <p>code已经被使用过。</p></td>        <td class="cellrowborder">         <p>code只能用一次，请重新获取code再重试。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20158</p></td>        <td class="cellrowborder">         <p>code授权被取消。</p></td>        <td class="cellrowborder">         <p>用户取消授权，导致code失效，请重新获取code再重试。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20171</p></td>        <td class="cellrowborder">         <p>client_secret为空。</p></td>        <td class="cellrowborder">         <p>请按照接口参数的要求，传入正确的client_secret参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20172</p></td>        <td class="cellrowborder">         <p>client_secret格式不正确。</p></td>        <td class="cellrowborder">         <p>检查client_secret格式是否满足正则：^[0-9a-zA-Z=/\\+]+$。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20182</p></td>        <td class="cellrowborder">         <p>grant_type值不正确。</p></td>        <td class="cellrowborder">         <p>grant_type可选值如下：</p>         <ul>          <li>“authorization_code”：该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token">获取用户级凭证</a>。</li>          <li>“refresh_token”： 该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token">刷新用户级凭证</a>。</li>          <li>“client_credentials”：该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-app-token">获取应用级凭证</a>。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder" rowspan="3" width="20.562056205620564%">         <p>1102</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>20001</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>client_id为空。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>请按照接口参数的要求，传入正确的client_id参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20151</p></td>        <td class="cellrowborder">         <p>code为空。</p></td>        <td class="cellrowborder">         <p>请按照接口参数的要求，传入正确的code参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>20181</p></td>        <td class="cellrowborder">         <p>grant_type为空。</p></td>        <td class="cellrowborder">         <p>grant_type可选值如下：</p>         <ul>          <li>“authorization_code”：该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token">获取用户级凭证</a>。</li>          <li>“refresh_token”： 该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-refresh-token">刷新用户级凭证</a>。</li>          <li>“client_credentials”：该场景用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-app-token">获取应用级凭证</a>。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder" width="20.562056205620564%">         <p>1103</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>20153</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>无效的code。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>请检查code是否正确。</p></td>       </tr>       <tr>        <td class="cellrowborder" rowspan="3" width="20.562056205620564%">         <p>1203</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>12303</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>client_id在系统不存在。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>请前往AppGallery Connect（简称AGC）确认client_id是否存在。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>12304</p></td>        <td class="cellrowborder">         <p>无效的client_secret。</p></td>        <td class="cellrowborder">         <p>入参client_id和client_secret不匹配导致，请检查参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>500</p></td>        <td class="cellrowborder">         <p>系统内部错误。</p></td>        <td class="cellrowborder">         <p>系统内部处理错误，建议业务打印错误码信息，并请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>       </tr>           </tbody></table></div>    </div>   </div>   <div></div></div>