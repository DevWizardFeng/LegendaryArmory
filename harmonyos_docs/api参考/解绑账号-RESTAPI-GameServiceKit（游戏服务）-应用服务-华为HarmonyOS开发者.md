<h1 _ngcontent-sep-c119="" class="doc-title ng-star-inserted" title="解绑账号"> 解绑账号 </h1>

<div _ngcontent-sep-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section2985105118353">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section2985105118353" tips="复制节点链接"></i></h2>          <p>调用此接口可以将游戏官方账号与华为teamPlayerId的解绑结果上报给华为游戏服务器。</p>    </div>    <div class="tiledSection">     <h2 id="section59851051113519">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section59851051113519" tips="复制节点链接"></i></h2>          <p>玩家选择华为账号登录游戏时，游戏需要将游戏官方账号与华为teamPlayerId绑定，并将绑定结果上报给华为游戏服务器。若需将游戏官方账号与华为teamPlayerId解绑，需将解绑结果上报给华为，此时客户端侧可通过Game Service Kit的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section57861515615">unbindPlayer</a>接口实现，服务器侧则可通过本接口实现。</p>    </div>    <div class="tiledSection">     <h2 id="section1798515114357">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section1798515114357" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.3.2.1.3.1.1" width="16.74%">          <p>承载协议</p></th>         <td class="cellrowborder" width="83.26%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.3.2.1.3.2.1" width="16.74%">          <p>接口方向</p></th>         <td class="cellrowborder" width="83.26%">          <p>开发者服务器-&gt;华为游戏服务器</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.3.2.1.3.3.1" width="16.74%">          <p>接口URL</p></th>         <td class="cellrowborder" width="83.26%">          <p>https://jos-open-api.cloud.huawei.com/gameservice/api/gbClientApi</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.3.2.1.3.4.1" width="16.74%">          <p>数据格式</p></th>         <td class="cellrowborder" width="83.26%">          <p>请求：Content-Type: application/x-www-form-urlencoded（表单方式）</p>          <p>响应：Content-Type: application/json</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section13986115113350">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section13986115113350" tips="复制节点链接"></i></h2>          <p><strong>body参数</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.5.1.1" width="17.1%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.5.1.2" width="16.830000000000002%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.5.1.3" width="16.53%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.5.1.4" width="49.54%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.1%">          <p>method</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>固定传入“external.hms.gs.player.unbindPlayer”。最大长度64个字符。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.1%">          <p>appId</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>游戏在AppGallery Connect中的APP ID，获取方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-view-app-info-0000002282674569" target="_blank">查看应用信息</a>。最大长度32个字符。若解绑“游戏级别”类型，该参数必填。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.1%">          <p>cpId</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>游戏开发者在AppGallery Connect中的Developer ID，获取方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-view-app-info-0000002282674569" target="_blank">查看应用信息</a>。最大长度32个字符。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.1%">          <p>teamPlayerId</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>HarmonyOS NEXT游戏的玩家标识，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136">unionLogin</a>接口返回，最大长度256个字符。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.1%">          <p>ts</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>Long</p></td>         <td class="cellrowborder" width="49.54%">          <p>当前时间的时间戳，即当前时间距离GMT时间1970年1月1号0时0分0秒所差的毫秒数。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.1%">          <p>sign</p></td>         <td class="cellrowborder" width="16.830000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>用于华为游戏服务器对请求参数验签的签名字符串。最大长度1024个字符。</p>          <p>为防止请求被篡改，游戏需要根据<a href="/consumer/cn/doc/harmonyos-references/gameservice-unbindplayer#section455238132914">签名机制</a>中的方法生成签名字符串，华为服务器在收到请求后会对签名字符串进行验签，验签成功后才会进行后续处理，否则将返回失败错误码。请求中除sign和method以外的所有Body参数均参与签名。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section19989155153512">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section19989155153512" tips="复制节点链接"></i></h2>          <div _ngcontent-sep-c106="" class="highlight-div"><div _ngcontent-sep-c106="" class="highlight-div-header"><div _ngcontent-sep-c106="" class="highlight-div-header-left"><div _ngcontent-sep-c106="" class="handle-button expand-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sep-c106="" class="highlight-div-header-right"><div _ngcontent-sep-c106="" class="handle-button ai-button"></div><div _ngcontent-sep-c106="" class="handle-button line-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sep-c106="" class="handle-button theme-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sep-c106="" class="handle-button copy-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sep-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li>POST /gameservice/api/gbClientApi</li><li>Host: jos-open-api.cloud.huawei.com</li><li>Content-Type: application/x-www-form-urlencoded</li><li><span class="hljs-comment">// </span><strong><span class="hljs-comment">所有请求参数</span></strong><strong><span class="hljs-comment">值</span></strong><span class="hljs-comment">均需要urlencode编码后再进行拼接</span></li><li>method=external.hms.gs.player.unbindPlayer&amp;appId=<span class="hljs-number">135</span>***<span class="hljs-number">568</span>&amp;<span class="">cpId</span>=<span class="hljs-number">123</span>***<span class="hljs-number">21f</span>&amp;teamPlayerId=******&amp;ts=<span class="hljs-number">1670841860308</span>&amp;sign=**************</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section12989451113515">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section12989451113515" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.1" width="17.72%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.2" width="14.760000000000002%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.3" width="17.06%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.4" width="50.46000000000001%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.72%">          <p>rtnCode</p></td>         <td class="cellrowborder" width="14.760000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="17.06%">          <p>int</p></td>         <td class="cellrowborder" width="50.46000000000001%">          <p>服务端返回码。</p>          <ul>           <li>-1：响应失败</li>          </ul>          <ul>           <li>0：解绑成功</li>           <li>1：验签失败</li>           <li>3001：参数错误</li>           <li>2031002：玩家账号信息错误</li>           <li>2031006：游戏信息错误</li>           <li>2031007：华为玩家账号已绑定其他游戏玩家账号</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" width="17.72%">          <p>errMsg</p></td>         <td class="cellrowborder" width="14.760000000000002%">          <p>否</p></td>         <td class="cellrowborder" width="17.06%">          <p>String</p></td>         <td class="cellrowborder" width="50.46000000000001%">          <p>异常场景下返回错误码的描述。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section737071314291">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section737071314291" tips="复制节点链接"></i></h2>          <div _ngcontent-sep-c106="" class="highlight-div"><div _ngcontent-sep-c106="" class="highlight-div-header"><div _ngcontent-sep-c106="" class="highlight-div-header-left"><div _ngcontent-sep-c106="" class="handle-button expand-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sep-c106="" class="highlight-div-header-right"><div _ngcontent-sep-c106="" class="handle-button ai-button"></div><div _ngcontent-sep-c106="" class="handle-button line-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sep-c106="" class="handle-button theme-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sep-c106="" class="handle-button copy-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sep-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK</li><li>Content-Type: application/json;charset=UTF-<span class="hljs-number">8</span></li><li>{</li><li>    <span class="hljs-string">"rtnCode"</span>:<span class="hljs-number">0</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section455238132914">签名机制<i class="anchor-icon anchor-icon-link" anchorid="section455238132914" tips="复制节点链接"></i></h2>          <p>为了确保HTTPS传输的安全性，防止请求参数被篡改，应用需要在调用接口时携带请求参数的签名字符串，用于华为服务器对请求参数进行校验。签名字符串的生成规则如下所示：</p>     <ol>      <li>将请求参数Body中除<strong>sign</strong>和<strong>method</strong>以外的参数，按参数名首字母的ASCII码将参数升序排序。若遇到相同首字母，则比较第二个字母，以此类推。       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p><strong>sign</strong>和<strong>method</strong>参数不参与签名。</p>        </div></div></div></li>      <li>添加依赖项。       <div _ngcontent-sep-c106="" class="highlight-div"><div _ngcontent-sep-c106="" class="highlight-div-header"><div _ngcontent-sep-c106="" class="highlight-div-header-left"><div _ngcontent-sep-c106="" class="handle-button expand-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sep-c106="" class="highlight-div-header-right"><div _ngcontent-sep-c106="" class="handle-button ai-button"></div><div _ngcontent-sep-c106="" class="handle-button line-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sep-c106="" class="handle-button theme-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sep-c106="" class="handle-button copy-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sep-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li>&lt;dependencies&gt;</li><li>       &lt;dependency&gt;</li><li>            &lt;groupId&gt;commons-codec&lt;/groupId&gt;</li><li>            &lt;artifactId&gt;commons-codec&lt;/artifactId&gt;</li><li>            &lt;version&gt;<span class="hljs-number">1.15</span>&lt;/version&gt; &lt;!-- 请使用最新的稳定版本 --&gt;</li><li>        &lt;/dependency&gt;</li><li>        &lt;dependency&gt;</li><li>            &lt;groupId&gt;org.bouncycastle&lt;/groupId&gt;</li><li>            &lt;artifactId&gt;bcprov-jdk18on&lt;/artifactId&gt;</li><li>            &lt;version&gt;<span class="hljs-number">1.74</span>&lt;/version&gt; &lt;!-- 请使用最新的稳定版本 --&gt;</li><li>        &lt;/dependency&gt;</li><li>&lt;/dependencies&gt;</li></ol></pre></div></div></li>      <li>将所有参与签名的参数名和参数值的键值对以“&amp;”字符连接成待签名字符串，例如“a=xxxxxx&amp;b=xxxxxxx&amp;c=xxxxxxxxxxx...”。其中，参数值需要进行urlencode。       <div class="p">        Java示例代码如下：        <div _ngcontent-sep-c106="" class="highlight-div"><div _ngcontent-sep-c106="" class="highlight-div-header"><div _ngcontent-sep-c106="" class="highlight-div-header-left"><div _ngcontent-sep-c106="" class="handle-button expand-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sep-c106="" class="highlight-div-header-right"><div _ngcontent-sep-c106="" class="handle-button ai-button"></div><div _ngcontent-sep-c106="" class="handle-button line-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sep-c106="" class="handle-button theme-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sep-c106="" class="handle-button copy-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sep-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 组装body内除sign和method以外的参数，此处参数值仅为示例</span></li><li>Map&lt;String, String&gt; paramsMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li>paramsMap.put(<span class="hljs-string">"appId"</span>, <span class="hljs-string">"appId"</span>);</li><li>paramsMap.put(<span class="hljs-string">"cpId"</span>, <span class="hljs-string">"cpId"</span>);</li><li>paramsMap.put(<span class="hljs-string">"teamPlayerId"</span>, <span class="hljs-string">"teamPlayerId"</span>);</li><li>paramsMap.put(<span class="hljs-string">"ts"</span>, <span class="hljs-string">"111111111"</span>);</li><li>
</li><li><span class="hljs-comment">// 对参数进行字典序排序</span></li><li>Map&lt;String, String&gt; tempMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;(paramsMap);</li><li><span class="hljs-type">StringBuffer</span> <span class="hljs-variable">base</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringBuffer</span>();</li><li>
</li><li><span class="hljs-comment">// 拼接参数</span></li><li><span class="hljs-keyword">for</span> (Map.Entry&lt;String, String&gt; entry : tempMap.entrySet()) {</li><li>    <span class="hljs-type">String</span> <span class="hljs-variable">key</span> <span class="hljs-operator">=</span> entry.getKey();</li><li>    <span class="hljs-type">String</span> <span class="hljs-variable">value</span> <span class="hljs-operator">=</span> entry.getValue();</li><li>    base.append(key).append(<span class="hljs-string">'='</span>).append(<span class="hljs-literal">null</span> == value ? <span class="hljs-string">''</span> : URLEncoder.encode(value, <span class="hljs-string">"UTF-8"</span>)).append(<span class="hljs-string">'&amp;'</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">if</span> (base.length() &gt; <span class="hljs-number">0</span>) {</li><li>    base.deleteCharAt(base.length() - <span class="hljs-number">1</span>);</li><li>}</li></ol></pre></div></div>       </div></li>      <li>将待签名字符串使用游戏私钥按照RSA算法（SHA256WithRSA/PSS）进行签名，将签名后的字符串经过Base64编码，得到的字符串即为签名字符串。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>游戏私钥获取请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/gameservice-key" target="_blank">获取游戏密钥</a>。</li>          <li>签名字符串需要进行urlencode后再拼接到请求中。</li>         </ul>        </div></div></div>       <p>Java示例代码如下：</p>       <div _ngcontent-sep-c106="" class="highlight-div"><div _ngcontent-sep-c106="" class="highlight-div-header"><div _ngcontent-sep-c106="" class="highlight-div-header-left"><div _ngcontent-sep-c106="" class="handle-button expand-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sep-c106="" class="highlight-div-header-right"><div _ngcontent-sep-c106="" class="handle-button ai-button"></div><div _ngcontent-sep-c106="" class="handle-button line-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sep-c106="" class="handle-button theme-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sep-c106="" class="handle-button copy-button"><div _ngcontent-sep-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sep-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取签名私钥，具体实现方法由开发者自行决定，此处仅为接口示例</span></li><li><span class="hljs-type">String</span> <span class="hljs-variable">privateKey</span> <span class="hljs-operator">=</span> <span class="hljs-string">"xxxxxx"</span>;</li><li>
</li><li><span class="hljs-comment">// 加签</span></li><li><span class="hljs-type">byte</span>[] keyBytes = Base64.decodeBase64(privateKey);</li><li><span class="hljs-type">PKCS8EncodedKeySpec</span> <span class="hljs-variable">pkcs8KeySpec</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PKCS8EncodedKeySpec</span>(keyBytes);</li><li><span class="hljs-type">KeyFactory</span> <span class="hljs-variable">keyFactory</span> <span class="hljs-operator">=</span> KeyFactory.getInstance(<span class="hljs-string">"RSA"</span>);</li><li><span class="hljs-type">PrivateKey</span> <span class="hljs-variable">privateK</span> <span class="hljs-operator">=</span>  keyFactory.generatePrivate(pkcs8KeySpec);</li><li><span class="hljs-type">Signature</span> <span class="hljs-variable">signature</span> <span class="hljs-operator">=</span> Signature.getInstance(<span class="hljs-string">"SHA256withRSA/PSS"</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">BouncyCastleProvider</span>());</li><li>signature.initSign(privateK);</li><li>signature.update(base.getBytes(StandardCharsets.UTF_8));</li><li><span class="hljs-type">String</span> <span class="hljs-variable">sign</span> <span class="hljs-operator">=</span>  Base64.encodeBase64String(signature.sign());</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>