<h1 _ngcontent-cdv-c119="" class="doc-title ng-star-inserted" title="解绑账号通知"> 解绑账号通知 </h1>

<div _ngcontent-cdv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section151184591379">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section151184591379" tips="复制节点链接"></i></h2>          <p>华为游戏服务器调用此接口向开发者服务器发送关键事件通知，并提醒开发者解绑账号。</p>    </div>    <div class="tiledSection">     <h2 id="section20134240184817">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section20134240184817" tips="复制节点链接"></i></h2>          <p>在AppGallery Connect<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/gameservice-address" target="_blank">配置回调地址</a>后，华为游戏服务器将在玩家注销华为账号后提醒开发者解绑账号。若开发者服务器返回结果为非成功响应，华为游戏服务器将周期性发送本次关键事件的通知，建议开发者服务端在收到通知后立即返回成功响应，避免堆积通知消息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>为保证可靠性，系统具备补偿机制，所以可能出现重发的通知比预期的多。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section159871438191511">接口约束<i class="anchor-icon anchor-icon-link" anchorid="section159871438191511" tips="复制节点链接"></i></h2>          <ul>      <li>不建议开发者服务器限制IP，否则华为游戏服务器的出口IP发生变化后，可以会引起服务中断。</li>      <li>需提前在AppGallery Connect中配置回调地址，地址要求支持HTTPS协议，且具有合法商用证书。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section0184310113814">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section0184310113814" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.1.1" width="16.74%">          <p>承载协议</p></th>         <td class="cellrowborder" width="83.26%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.2.1" width="16.74%">          <p>接口方向</p></th>         <td class="cellrowborder" width="83.26%">          <p>华为游戏服务器 -&gt; 开发者服务器</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.3.1" width="16.74%">          <p>性能指标</p></th>         <td class="cellrowborder" width="83.26%">          <p>TPS&gt;50</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.4.1" width="16.74%">          <p>最大响应时间</p></th>         <td class="cellrowborder" width="83.26%">          <p>&lt;1s</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.5.1" width="16.74%">          <p>接口URL</p></th>         <td class="cellrowborder" width="83.26%">          <p>在AppGallery Connect配置的回调地址。</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.6.1" width="16.74%">          <p>数据格式</p></th>         <td class="cellrowborder" width="83.26%">          <ul>           <li>请求消息：Content-Type: application/json</li>           <li>响应消息：Content-Type: application/json</li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section13132164812383">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section13132164812383" tips="复制节点链接"></i></h2>          <p><strong>body参数</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.1" width="17.080000000000002%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.2" width="16.85%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.3" width="16.53%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.4" width="49.54%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.080000000000002%">          <p>appIds</p></td>         <td class="cellrowborder" width="16.85%">          <p>否</p></td>         <td class="cellrowborder" width="16.53%">          <p>List&lt;String&gt;</p></td>         <td class="cellrowborder" width="49.54%">          <p>待解绑游戏的APP ID列表：</p>          <ul>           <li>若是开发者级别绑定，则为绑定发起的APP。</li>           <li>若是游戏级别绑定，则为绑定涉及的APP。</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" width="17.080000000000002%">          <p>teamPlayerId</p></td>         <td class="cellrowborder" width="16.85%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>华为teamPlayerId。最大长度256个字符。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.080000000000002%">          <p>sign</p></td>         <td class="cellrowborder" width="16.85%">          <p>是</p></td>         <td class="cellrowborder" width="16.53%">          <p>String</p></td>         <td class="cellrowborder" width="49.54%">          <p>华为服务器在发送请求时对除sign以外的所有Body参数使用SHA256WithRSA/PSS算法进行了签名，并在sign参数中返回签名后的字符串。</p>          <p>开发者需获取验签公钥，并根据加密算法使用公钥对签名字符串进行验签，验签方法参见<a href="/consumer/cn/doc/harmonyos-references/gameservice-unbindplayer-notification#section1815419216397">验签机制</a>。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>本参数在"utf-8" urlencode后发送。如果使用的是Java中request的getParameter()方法，则无需进行urlencode。</p>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section19801185203810">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section19801185203810" tips="复制节点链接"></i></h2>          <div _ngcontent-cdv-c106="" class="highlight-div"><div _ngcontent-cdv-c106="" class="highlight-div-header"><div _ngcontent-cdv-c106="" class="highlight-div-header-left"><div _ngcontent-cdv-c106="" class="handle-button expand-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdv-c106="" class="highlight-div-header-right"><div _ngcontent-cdv-c106="" class="handle-button ai-button"></div><div _ngcontent-cdv-c106="" class="handle-button line-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdv-c106="" class="handle-button theme-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdv-c106="" class="handle-button copy-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">POST</span> {<span class="hljs-variable">接口url</span>} </li><li><span class="hljs-variable">Host</span>: <span class="hljs-title class_">xxx</span> </li><li><span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: <span class="hljs-title class_">application</span>/<span class="hljs-variable">json</span> </li><li>{    </li><li>    <span class="hljs-string">"appIds"</span>: [<span class="hljs-string">"109***688"</span>, <span class="hljs-string">"691***237"</span>],    </li><li>    <span class="hljs-string">"teamPlayerId"</span>: <span class="hljs-string">"E5B*****************E9B"</span>,   </li><li>    <span class="hljs-string">"sign"</span>: <span class="hljs-string">"J0Eslg0p***tKR37AB"</span> </li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section460985653818">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section460985653818" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.1" width="17.72%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.2" width="14.760000000000002%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.3" width="17.06%">          <p>类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.4" width="50.46000000000001%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.72%">          <p>result</p></td>         <td class="cellrowborder" width="14.760000000000002%">          <p>是</p></td>         <td class="cellrowborder" width="17.06%">          <p>int</p></td>         <td class="cellrowborder" width="50.46000000000001%">          <p>服务端返回码。</p>          <ul>           <li>0：成功</li>           <li>1：验签失败</li>           <li>2：超时</li>           <li>3：业务信息错误</li>           <li>94：系统错误</li>           <li>95：IO 错误</li>           <li>96：错误的url</li>           <li>97：错误的响应</li>           <li>98：参数错误</li>           <li>99：其他错误</li>          </ul></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1621713596385">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section1621713596385" tips="复制节点链接"></i></h2>          <div _ngcontent-cdv-c106="" class="highlight-div"><div _ngcontent-cdv-c106="" class="highlight-div-header"><div _ngcontent-cdv-c106="" class="highlight-div-header-left"><div _ngcontent-cdv-c106="" class="handle-button expand-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdv-c106="" class="highlight-div-header-right"><div _ngcontent-cdv-c106="" class="handle-button ai-button"></div><div _ngcontent-cdv-c106="" class="handle-button line-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdv-c106="" class="handle-button theme-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdv-c106="" class="handle-button copy-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> <span class="hljs-variable">OK</span> </li><li><span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: <span class="hljs-title class_">application</span>/<span class="hljs-variable">json</span>;<span class="hljs-variable">charset</span>=<span class="hljs-variable">UTF</span>-<span class="hljs-number">8</span></li><li>{</li><li>    <span class="hljs-string">"result"</span>: <span class="hljs-number">0</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1815419216397">验签机制<i class="anchor-icon anchor-icon-link" anchorid="section1815419216397" tips="复制节点链接"></i></h2>          <ol>      <li>获取请求中的签名字符串，即sign参数。</li>      <li>将请求参数Body中除sign以外的参数，按参数名首字母的ASCII码将参数升序排序。若遇到相同首字母，则比较第二个字母，以此类推。</li>      <li>排序完成之后，将所有参与签名的参数值进行urlencode之后以“&amp;”字符连接成字符串，例如“a=xxxxxx&amp;b=xxxxxxx&amp;c=xxxxxx”，此字符串便是待验签字符串。</li>      <li>将待验签字符串使用游戏公钥按照RSA算法（SHA256WithRSA/PSS）进行签名，并与sign参数中的签名字符串进行一致性验证。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>游戏公钥获取请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/gameservice-key" target="_blank">获取游戏密钥</a>。</p>        </div></div></div>       <div class="p">        Java示例代码如下：        <div _ngcontent-cdv-c106="" class="highlight-div"><div _ngcontent-cdv-c106="" class="highlight-div-header"><div _ngcontent-cdv-c106="" class="highlight-div-header-left"><div _ngcontent-cdv-c106="" class="handle-button expand-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdv-c106="" class="highlight-div-header-right"><div _ngcontent-cdv-c106="" class="handle-button ai-button"></div><div _ngcontent-cdv-c106="" class="handle-button line-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdv-c106="" class="handle-button theme-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdv-c106="" class="handle-button copy-button"><div _ngcontent-cdv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// List、Map等基本类型的导包均由JDK自带，其它导包由业务侧自定义导入</span></li><li><span class="hljs-comment">// 组装body内的参数，此处参数值仅为示例</span></li><li><span class="hljs-title class_">List</span>&lt;<span class="hljs-title class_">String</span>&gt; <span class="hljs-variable">appIds</span> =  <span class="hljs-variable">Arrays</span>.<span class="hljs-title function_">asList</span>(<span class="hljs-string">"appId1"</span>,<span class="hljs-string">"appId2"</span>);</li><li><span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; <span class="hljs-variable">paramsMap</span> = <span class="hljs-variable">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;();</li><li><span class="hljs-variable">paramsMap</span>.<span class="hljs-title function_">put</span>(<span class="hljs-string">"appIds"</span>, <span class="hljs-variable">StringUtils</span>.<span class="hljs-title function_">join</span>(<span class="hljs-variable">appIds</span>, <span class="hljs-string">","</span>));</li><li><span class="hljs-variable">paramsMap</span>.<span class="hljs-title function_">put</span>(<span class="hljs-string">"teamPlayerId"</span>, <span class="hljs-string">"teamPlayerId"</span>);</li><li>
</li><li><span class="hljs-comment">// 对参数进行字典序排序</span></li><li><span class="hljs-title class_">Map</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; <span class="hljs-variable">tempMap</span> = <span class="hljs-variable">new</span> <span class="hljs-title class_">TreeMap</span>&lt;&gt;(<span class="hljs-variable">paramsMap</span>);</li><li><span class="hljs-comment">// 拼接参数</span></li><li><span class="hljs-variable">StringBuffer</span> <span class="hljs-variable">base</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">StringBuffer</span>();</li><li><span class="hljs-keyword">for</span> (<span class="hljs-variable">Map</span>.<span class="hljs-title class_">Entry</span>&lt;<span class="hljs-title class_">String</span>, <span class="hljs-title class_">String</span>&gt; <span class="hljs-variable">entry</span> : <span class="hljs-title class_">tempMap</span>.<span class="hljs-title class_">entrySet</span>()) {</li><li>    <span class="hljs-variable">String</span> <span class="hljs-variable">key</span> = <span class="hljs-variable">entry</span>.<span class="hljs-title function_">getKey</span>();</li><li>    <span class="hljs-variable">String</span> <span class="hljs-variable">value</span> = <span class="hljs-variable">entry</span>.<span class="hljs-title function_">getValue</span>();</li><li>    <span class="hljs-variable">base</span>.<span class="hljs-title function_">append</span>(<span class="hljs-variable">key</span>).<span class="hljs-title function_">append</span>(<span class="hljs-string">'='</span>).<span class="hljs-title function_">append</span>(<span class="hljs-variable">null</span> == <span class="hljs-variable">value</span> ? <span class="hljs-string">""</span> : <span class="hljs-title class_">URLEncoder</span>.<span class="hljs-title class_">encode</span>(<span class="hljs-title class_">value</span>, "<span class="hljs-variable">UTF</span>-<span class="hljs-number">8</span>")).<span class="hljs-title function_">append</span>(<span class="hljs-string">'&amp;'</span>);</li><li>}</li><li><span class="hljs-variable">String</span> <span class="hljs-variable">signStr</span> = <span class="hljs-string">""</span>;</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">base</span>.<span class="hljs-title function_">length</span>() &gt; <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable">signStr</span> = <span class="hljs-variable">base</span>.<span class="hljs-title function_">deleteCharAt</span>(<span class="hljs-variable">base</span>.<span class="hljs-title function_">length</span>() - <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>();</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取验签公钥，具体实现方法由开发者自行决定，此处仅为接口示例</span></li><li><span class="hljs-variable">String</span> <span class="hljs-variable">publicKey</span> = <span class="hljs-string">"xxx"</span>;</li><li><span class="hljs-variable">String</span> <span class="hljs-variable">sign</span> = <span class="hljs-string">"sign"</span>;</li><li>
</li><li><span class="hljs-comment">// 验签</span></li><li><span class="hljs-variable">byte</span>[] <span class="hljs-variable">keyBytes</span> = <span class="hljs-variable">Base64</span>.<span class="hljs-title function_">decodeBase64</span>(<span class="hljs-variable">publicKey</span>);</li><li><span class="hljs-variable">X509EncodedKeySpec</span> <span class="hljs-variable">pkcs8KeySpec</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">X509EncodedKeySpec</span>(<span class="hljs-variable">keyBytes</span>);</li><li><span class="hljs-variable">KeyFactory</span> <span class="hljs-variable">keyFactory</span> = <span class="hljs-variable">KeyFactory</span>.<span class="hljs-title function_">getInstance</span>(<span class="hljs-string">"RSA"</span>);</li><li><span class="hljs-variable">PublicKey</span> <span class="hljs-variable">publicK</span> = <span class="hljs-variable">keyFactory</span>.<span class="hljs-title function_">generatePublic</span>(<span class="hljs-variable">pkcs8KeySpec</span>);</li><li><span class="hljs-variable">Signature</span> <span class="hljs-variable">signature</span> = <span class="hljs-variable">Signature</span>.<span class="hljs-title function_">getInstance</span>(<span class="hljs-string">"SHA256WithRSA/PSS"</span>, <span class="hljs-variable">new</span> <span class="hljs-title function_">BouncyCastleProvider</span>());</li><li><span class="hljs-variable">signature</span>.<span class="hljs-title function_">initVerify</span>(<span class="hljs-variable">publicK</span>);</li><li><span class="hljs-variable">signature</span>.<span class="hljs-title function_">update</span>(<span class="hljs-variable">signStr</span>.<span class="hljs-title function_">getBytes</span>(<span class="hljs-string">"UTF-8"</span>));</li><li><span class="hljs-variable">signature</span>.<span class="hljs-title function_">verify</span>(<span class="hljs-variable">Base64</span>.<span class="hljs-title function_">decodeBase64</span>(<span class="hljs-variable">sign</span>));</li></ol></pre></div></div>       </div></li>     </ol>    </div>   </div>   <div></div></div>