<h1 _ngcontent-mfu-c119="" class="doc-title ng-star-inserted" title="验证ID Token有效性"> 验证ID Token有效性 </h1>

<div _ngcontent-mfu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">      <p>为了更安全的网络访问，请务必升级到TLS1.2版本。若使用协议是TLS1.0、TLS1.1或规定外的加密套件，可能无法正常访问华为账号服务。</p>      <p>关于TLS1.2协议及加密套件的信息，可以点击这里进行详细了解：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-common#section1329115361128">TLS协议及加密套件</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="section198514324411">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section198514324411" tips="复制节点链接"></i></h2>          <p>应用服务端向华为账号服务器，调用该接口验证ID Token的有效性，并解析ID Token中的信息，只用于调试目的。</p>    </div>    <div class="tiledSection">     <h2 id="section8161141710445">场景描述<i class="anchor-icon anchor-icon-link" anchorid="section8161141710445" tips="复制节点链接"></i></h2>          <ul>      <li>第三方应用通过ID Token方式进行华为账号登录授权，要解析出用户的ID Token，需要先对ID Token的有效性进行验证，如果本地验证失败，可调用此接口向华为服务器发送验证请求进行调试，验证ID Token的有效性。</li>      <li>如果ID Token是直接调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token">获取用户级凭证</a>的接口获取的，则不需要验证ID Token的有效性。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1322971511417">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section1322971511417" tips="复制节点链接"></i></h2>          <ul>      <li>需确保调用端网络正常。</li>      <li><span style="color: rgb(36,39,40);">由于调用此接口耗时，并且易受网络状况的影响，所以该接口只能用于调试目的。在商用环境需采用本地验证的方式</span>，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-12#section6924154019588" target="_blank">解析与验证</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1671715834517">接口原型<i class="anchor-icon anchor-icon-link" anchorid="section1671715834517" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.1.1" width="20.49%">          <p><strong>承载协议</strong></p></th>         <td class="cellrowborder" width="79.51%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.2.1" width="20.49%">          <p><strong>接口方向</strong></p></th>         <td class="cellrowborder" width="79.51%">          <p>开发者服务器-&gt;华为账号服务器</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.3.1" width="20.49%">          <p><strong>接口URL</strong></p></th>         <td class="cellrowborder" width="79.51%">          <p>https://oauth-login.cloud.huawei.com/oauth2/v3/tokeninfo</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.5.2.1.3.4.1" width="20.49%">          <p>数据格式</p></th>         <td class="cellrowborder" width="79.51%">          <p>请求消息：Content-Type: application/x-www-form-urlencoded</p>          <p>响应消息：Content-Type: application/json</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section3936249134510">请求参数<i class="anchor-icon anchor-icon-link" anchorid="section3936249134510" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section55571411205812" class="firsth2">Request Header<i class="anchor-icon anchor-icon-link" anchorid="section55571411205812" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.1" width="19.32%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.2" width="19.439999999999998%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.3" width="19.439999999999998%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.5.1.4" width="41.8%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="19.32%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="19.439999999999998%">          <p>是</p></td>         <td class="cellrowborder" width="19.439999999999998%">          <p>String</p></td>         <td class="cellrowborder" width="41.8%">          <p>取值为：application/x-www-form-urlencoded。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>Request Body传参，请务必遵循此请求头格式，否则可能导致请求失败，具体传参方式可参考<a href="/consumer/cn/doc/harmonyos-references/account-api-verify-id-token#section1635104211466">示例代码</a>。</p>           </div></div></div></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section17811985813">Request Body<i class="anchor-icon anchor-icon-link" anchorid="section17811985813" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.1" width="19.09%">          <p><strong>参数</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.2" width="19.67%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.3" width="19.68%">          <p><strong>参数类型</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.4" width="41.56%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="19.09%">          <p>id_token</p></td>         <td class="cellrowborder" width="19.67%">          <p>是</p></td>         <td class="cellrowborder" width="19.68%">          <p>String</p></td>         <td class="cellrowborder" width="41.56%">          <p>应用获取到的ID Token。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section10702194534719">请求示例<i class="anchor-icon anchor-icon-link" anchorid="section10702194534719" tips="复制节点链接"></i></h2>          <p>请通过POST方式调用，示例如下：</p>     <div _ngcontent-mfu-c106="" class="highlight-div"><div _ngcontent-mfu-c106="" class="highlight-div-header"><div _ngcontent-mfu-c106="" class="highlight-div-header-left"><div _ngcontent-mfu-c106="" class="handle-button expand-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mfu-c106="" class="highlight-div-header-right"><div _ngcontent-mfu-c106="" class="handle-button ai-button"></div><div _ngcontent-mfu-c106="" class="handle-button line-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mfu-c106="" class="handle-button theme-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mfu-c106="" class="handle-button copy-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mfu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">POST</span> /<span class="hljs-variable">oauth2</span>/<span class="hljs-variable">v3</span>/<span class="hljs-variable">tokeninfo</span> <span class="hljs-variable">HTTP</span>/<span class="hljs-number">1.1</span></li><li><span class="hljs-variable">Host</span>:<span class="hljs-title class_">oauth</span>-<span class="hljs-title class_">login</span>.<span class="hljs-title class_">cloud</span>.<span class="hljs-title class_">huawei</span>.<span class="hljs-title class_">com</span></li><li><span class="hljs-variable">Content</span>-<span class="hljs-variable">Type</span>: <span class="hljs-title class_">application</span>/<span class="hljs-variable">x</span>-<span class="hljs-variable">www</span>-<span class="hljs-variable">form</span>-<span class="hljs-variable">urlencoded</span></li><li>
</li><li><span class="hljs-variable">id_token</span>=<i><div class="varname_wrapper"><span class="varname">&lt;<span class="hljs-title class_">id_token</span>&gt;</span></div></i></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section937614106466">响应参数<i class="anchor-icon anchor-icon-link" anchorid="section937614106466" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1332811105920" class="firsth2">Response Header<i class="anchor-icon anchor-icon-link" anchorid="section1332811105920" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.1" width="17%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.2" width="15.83%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.3" width="15.939999999999998%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.11.2.1.5.1.4" width="51.23%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="15.83%">          <p>是</p></td>         <td class="cellrowborder" width="15.939999999999998%">          <p>String</p></td>         <td class="cellrowborder" width="51.23%">          <p>取值为：application/json。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section1850211414593">Response Body<i class="anchor-icon anchor-icon-link" anchorid="section1850211414593" tips="复制节点链接"></i></h3>          <p>调用成功时，响应消息体返回如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.1" width="17%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.2" width="16.18%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.3" width="16.06%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.3.1.5.1.4" width="50.760000000000005%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>typ</p></td>         <td class="cellrowborder" width="16.18%">          <p>是</p></td>         <td class="cellrowborder" width="16.06%">          <p>String</p></td>         <td class="cellrowborder" width="50.760000000000005%">          <p>ID Token的格式，固定“JWT”。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>alg</p></td>         <td class="cellrowborder" width="16.18%">          <p>是</p></td>         <td class="cellrowborder" width="16.06%">          <p>String</p></td>         <td class="cellrowborder" width="50.760000000000005%">          <p>ID Token的签名算法。</p>          <ul>           <li>PS256</li>           <li>RS256</li>          </ul></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>kid</p></td>         <td class="cellrowborder" width="16.18%">          <p>是</p></td>         <td class="cellrowborder" width="16.06%">          <p>String</p></td>         <td class="cellrowborder" width="50.760000000000005%">          <p>验证签名所用公私密钥对的id，长度最大256。</p></td>        </tr>             </tbody></table></div>     </div>     <p>调用失败时，响应消息体返回如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.1" width="18.08%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.2" width="15.24%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.12.5.1.4.1.3" width="66.67999999999999%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="18.08%">          <p>error</p></td>         <td class="cellrowborder" width="15.24%">          <p>int</p></td>         <td class="cellrowborder" width="66.67999999999999%">          <p>业务响应主错误码，详见<a href="/consumer/cn/doc/harmonyos-references/account-api-verify-id-token#section1186915200438">错误码</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="18.08%">          <p>sub_error</p></td>         <td class="cellrowborder" width="15.24%">          <p>int</p></td>         <td class="cellrowborder" width="66.67999999999999%">          <p>业务响应子错误码，详见<a href="/consumer/cn/doc/harmonyos-references/account-api-verify-id-token#section1186915200438">错误码</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="18.08%">          <p>error_description</p></td>         <td class="cellrowborder" width="15.24%">          <p>String</p></td>         <td class="cellrowborder" width="66.67999999999999%">          <p>错误描述信息。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section3142132691914">ID Token字段解析<i class="anchor-icon anchor-icon-link" anchorid="section3142132691914" tips="复制节点链接"></i></h2>          <p>其中部分字段与生成id_token的scope有关，如下为各scope对应字段说明：</p>     <p>scope包含权限项openid时，解析的字段映射表如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.1" width="12.22%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.2" width="13.19%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.3" width="13.850000000000001%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.4" width="60.74%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="12.22%">          <p>iss</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>固定值：https://accounts.huawei.com。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>sub</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>用户的UnionID。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>aud</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>接收ID Token的Client ID。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>exp</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>Long</p></td>         <td class="cellrowborder" width="60.74%">          <p>ID Token的过期时间戳(10位)。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>iat</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>Long</p></td>         <td class="cellrowborder" width="60.74%">          <p>ID Token的生成时间戳(10位)。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>at_hash</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>Access Token的哈希值。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>azp</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>生成ID Token的Client ID。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>openid</p></td>         <td class="cellrowborder" width="13.19%">          <p>是</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>用户OpenID。具体格式要求请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-faq-9" target="_blank">OpenID和UnionID的格式说明</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="12.22%">          <p>nonce</p></td>         <td class="cellrowborder" width="13.19%">          <p>否</p></td>         <td class="cellrowborder" width="13.850000000000001%">          <p>String</p></td>         <td class="cellrowborder" width="60.74%">          <p>防重放攻击随机值。详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section42261825935">LoginWithHuaweiIDRequest</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section12940173017165">AuthorizationWithHuaweiIDRequest</a>的nonce字段说明。</p></td>        </tr>             </tbody></table></div>     </div>     <p>scope包含权限项profile时，解析的字段映射表如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.5.1.1" width="17%">          <p><strong>参数</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.5.1.2" width="12.559999999999999%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.5.1.3" width="16.31%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.6.1.5.1.4" width="54.13%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>picture</p></td>         <td class="cellrowborder" width="12.559999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="16.31%">          <p>String</p></td>         <td class="cellrowborder" width="54.13%">          <p>用户头像图片链接。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>display_name</p></td>         <td class="cellrowborder" width="12.559999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="16.31%">          <p>String</p></td>         <td class="cellrowborder" width="54.13%">          <p>华为账号对应的昵称，没有昵称则取匿名化的邮箱或手机号。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>nickname</p></td>         <td class="cellrowborder" width="12.559999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="16.31%">          <p>String</p></td>         <td class="cellrowborder" width="54.13%">          <p>华为账号对应的昵称。</p></td>        </tr>             </tbody></table></div>     </div>     <p>scope包含权限项quickLoginAnonymousPhone时，解析的字段映射表如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.1" width="16.98%">          <p><strong>参数</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.2" width="12.58%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.3" width="16.31%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.8.1.5.1.4" width="54.13%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="16.98%">          <p>anonymized_login_mobile_number</p></td>         <td class="cellrowborder" width="12.58%">          <p>否</p></td>         <td class="cellrowborder" width="16.31%">          <p>String</p></td>         <td class="cellrowborder" width="54.13%">          <p>匿名化的华为账号绑定手机号码，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/account-phone-unionid-login" target="_blank">华为账号一键登录（获取手机号和UnionID/OpenID）</a>。</p></td>        </tr>             </tbody></table></div>     </div>     <p>scope包含权限项email时，解析的字段映射表如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.5.1.1" width="17%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.5.1.2" width="12.809999999999999%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.5.1.3" width="15.72%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.10.1.5.1.4" width="54.47%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>email_verified</p></td>         <td class="cellrowborder" width="12.809999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="15.72%">          <p>Boolean</p></td>         <td class="cellrowborder" width="54.47%">          <p>用户邮箱是否已验证。</p>          <ul>           <li>true：是</li>           <li>false：否</li>          </ul>          <p>由于Email不是华为账号的必填项，响应中可能没有这个属性。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>email</p></td>         <td class="cellrowborder" width="12.809999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="15.72%">          <p>String</p></td>         <td class="cellrowborder" width="54.47%">          <p>用户邮箱地址，由于Email不是华为账号的必填项，响应中可能没有这个属性。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section15371051162818">响应示例<i class="anchor-icon anchor-icon-link" anchorid="section15371051162818" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section736013351325" class="firsth2">请求成功时<i class="anchor-icon anchor-icon-link" anchorid="section736013351325" tips="复制节点链接"></i></h3>          <div _ngcontent-mfu-c106="" class="highlight-div"><div _ngcontent-mfu-c106="" class="highlight-div-header"><div _ngcontent-mfu-c106="" class="highlight-div-header-left"><div _ngcontent-mfu-c106="" class="handle-button expand-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mfu-c106="" class="highlight-div-header-right"><div _ngcontent-mfu-c106="" class="handle-button ai-button"></div><div _ngcontent-mfu-c106="" class="handle-button line-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mfu-c106="" class="handle-button theme-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mfu-c106="" class="handle-button copy-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mfu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK</li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>
</li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"at_hash"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Dx5WUwU*****L-SKuAvWUg"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"sub"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MDF9pBd6xxxxA8iaG4ZNPTw*****3fyXzG9WgUcmY8XibBvQ"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"kid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"6a2880c5d6a88c*****88eb680e05197d5bebd*****7b71757fc1b9530809ca"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"iss"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"https://accounts.huawei.com"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"typ"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JWT"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"display_name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Jack"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"nickname"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Jack"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"aud"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30*****33"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"azp"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"30*****33"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"exp"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1563823909</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"iat"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1563820309</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"alg"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PS256"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"nonce"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"default"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"openid"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"MDFAMTAxMDA1MTg1QGFlMzM0OWIyOGY0*****MDRiaNTI5ODAxYTA3MDh*****A4ZTZmNTA2ZTE4ZT*****lmNGVmN2E1ZjY1OTg4NWRiaN2QxMzQy*****TU0YWQ3"</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section111354411021">请求失败时<i class="anchor-icon anchor-icon-link" anchorid="section111354411021" tips="复制节点链接"></i></h3>         </div>    <div _ngcontent-mfu-c106="" class="highlight-div"><div _ngcontent-mfu-c106="" class="highlight-div-header"><div _ngcontent-mfu-c106="" class="highlight-div-header-left"><div _ngcontent-mfu-c106="" class="handle-button expand-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mfu-c106="" class="highlight-div-header-right"><div _ngcontent-mfu-c106="" class="handle-button ai-button"></div><div _ngcontent-mfu-c106="" class="handle-button line-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mfu-c106="" class="handle-button theme-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mfu-c106="" class="handle-button copy-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mfu-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">400</span> Bad Request</li><li>Content-Type<span class="hljs-punctuation">:</span> application/json</li><li>
</li><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"sub_error"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">14004</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"error_description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"jwk not found error"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"error"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1400</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    <div class="tiledSection">     <h2 id="section1635104211466">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section1635104211466" tips="复制节点链接"></i></h2>          <p>Java示例代码如下，运行前需要进行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-common#section444143185314">示例代码环境配置</a>：</p>     <div _ngcontent-mfu-c106="" class="highlight-div"><div _ngcontent-mfu-c106="" class="highlight-div-header"><div _ngcontent-mfu-c106="" class="highlight-div-header-left"><div _ngcontent-mfu-c106="" class="handle-button expand-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mfu-c106="" class="highlight-div-header-right"><div _ngcontent-mfu-c106="" class="handle-button ai-button"></div><div _ngcontent-mfu-c106="" class="handle-button line-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mfu-c106="" class="handle-button theme-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mfu-c106="" class="handle-button copy-button"><div _ngcontent-mfu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mfu-c106="" class="highlight-scroll-div"><pre class="java prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> com.alibaba.fastjson2.JSONObject;</li><li><span class="hljs-keyword">import</span> lombok.extern.slf4j.Slf4j;</li><li><span class="hljs-keyword">import</span> org.apache.http.NameValuePair;</li><li><span class="hljs-keyword">import</span> org.apache.http.client.entity.UrlEncodedFormEntity;</li><li><span class="hljs-keyword">import</span> org.apache.http.client.methods.HttpPost;</li><li><span class="hljs-keyword">import</span> org.apache.http.message.BasicNameValuePair;</li><li><span class="hljs-keyword">import</span> org.huawei.uniaccount.util.CallUtils;</li><li><span class="hljs-keyword">import</span> java.io.IOException;</li><li><span class="hljs-keyword">import</span> java.util.ArrayList;</li><li><span class="hljs-keyword">import</span> java.util.List;</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 验证ID Token有效性</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-meta">@Slf4j</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IDTokenAPIDemo</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> <span class="hljs-keyword">throws</span> IOException {</li><li>        <span class="hljs-comment">// 验证ID Token有效性的接口URL</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">"https://oauth-login.cloud.huawei.com/oauth2/v3/tokeninfo"</span>;</li><li>        <span class="hljs-comment">// 替换为您获取到的ID Token</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">idToken</span> <span class="hljs-operator">=</span> <span class="hljs-string">"</span><i><div class="varname_wrapper"><span class="varname"><span class="hljs-string">&lt;ID Token&gt;</span></span></div></i><span class="hljs-string">"</span>;</li><li>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">result</span> <span class="hljs-operator">=</span> getDetailByIDToken(url, idToken);</li><li>        <span class="hljs-comment">// 解析获取kid</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">kid</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"kid"</span>);</li><li>        <span class="hljs-comment">// 解析获取typ</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">typ</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"typ"</span>);</li><li>        <span class="hljs-comment">// 解析获取alg</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">alg</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"alg"</span>);</li><li>        <span class="hljs-comment">// 解析获取iss</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">iss</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"iss"</span>);</li><li>        <span class="hljs-comment">// 解析获取sub</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">sub</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"sub"</span>);</li><li>        <span class="hljs-comment">// 解析获取aud</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">aud</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"aud"</span>);</li><li>        <span class="hljs-comment">// 解析获取exp</span></li><li>        <span class="hljs-type">Long</span> <span class="hljs-variable">exp</span> <span class="hljs-operator">=</span> result.getLong(<span class="hljs-string">"exp"</span>);</li><li>        <span class="hljs-comment">// 解析获取iat</span></li><li>        <span class="hljs-type">Long</span> <span class="hljs-variable">iat</span> <span class="hljs-operator">=</span> result.getLong(<span class="hljs-string">"iat"</span>);</li><li>        <span class="hljs-comment">// 解析获取at_hash</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">atHash</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"at_hash"</span>);</li><li>        <span class="hljs-comment">// 解析获取azp</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">azp</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"azp"</span>);</li><li>        <span class="hljs-comment">// 解析获取openid</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">openid</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"openid"</span>);</li><li>        <span class="hljs-comment">// 解析获取nonce</span></li><li>        <span class="hljs-type">String</span> <span class="hljs-variable">nonce</span> <span class="hljs-operator">=</span> result.getString(<span class="hljs-string">"nonce"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> JSONObject <span class="hljs-title function_">getDetailByIDToken</span><span class="hljs-params">(String url, String idToken)</span> <span class="hljs-keyword">throws</span> IOException {</li><li>        <span class="hljs-type">HttpPost</span> <span class="hljs-variable">httpPost</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">HttpPost</span>(url);</li><li>        List&lt;NameValuePair&gt; request = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();</li><li>        request.add(<span class="hljs-keyword">new</span> <span class="hljs-title class_">BasicNameValuePair</span>(<span class="hljs-string">"id_token"</span>, idToken));</li><li>        httpPost.setEntity(<span class="hljs-keyword">new</span> <span class="hljs-title class_">UrlEncodedFormEntity</span>(request));</li><li>        <span class="hljs-keyword">return</span> CallUtils.toJsonObject(CallUtils.remoteCallOAuth(httpPost));</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section1186915200438">错误码<i class="anchor-icon anchor-icon-link" anchorid="section1186915200438" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.4.1.1" width="17.11%">          <p>HTTP响应码</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.4.1.2" width="33.33%">          <p>描述</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.19.2.1.4.1.3" width="49.559999999999995%">          <p>解决方法</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.11%">          <p>200</p></td>         <td class="cellrowborder" width="33.33%">          <p>成功。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>-</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>400</p></td>         <td class="cellrowborder" width="33.33%">          <p>参数错误。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请根据<strong>业务响应主错误码</strong>以及<strong>业务响应子错误码</strong>进一步排查问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>403</p></td>         <td class="cellrowborder" width="33.33%">          <p>无权限访问。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请检查调用环境及配置。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>404</p></td>         <td class="cellrowborder" width="33.33%">          <p>找不到服务。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请检查请求URI是否正确。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>405</p></td>         <td class="cellrowborder" width="33.33%">          <p>不支持的http请求method。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请检查http请求method是否与接口说明一致。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>500</p></td>         <td class="cellrowborder" width="33.33%">          <p>服务内部错误。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>502</p></td>         <td class="cellrowborder" width="33.33%">          <p>请求连接异常，常见于网络状况不稳定。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>建议稍后重试，若仍无法解决，请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>503</p></td>         <td class="cellrowborder" width="33.33%">          <p>系统流控。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>触发系统流控，请稍后重试。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>504</p></td>         <td class="cellrowborder" width="33.33%">          <p>请求连接超时，常见于网络状况不稳定。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>建议稍后重试，若仍无法解决，请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.11%">          <p>590</p></td>         <td class="cellrowborder" width="33.33%">          <p>服务内部错误。</p></td>         <td class="cellrowborder" width="49.559999999999995%">          <p>请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tablenoborder">     <div class="tbBox"><table>      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.20.1.5.1.1" width="20.562056205620564%">         <p>业务响应主错误码</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.20.1.5.1.2" width="19.781978197819782%">         <p>业务响应子错误码</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.20.1.5.1.3" width="22.492249224922492%">         <p>描述</p></th>        <th align="left" class="cellrowborder" id="mcps1.3.20.1.5.1.4" width="37.163716371637165%">         <p>解决方法</p></th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" rowspan="5" width="20.562056205620564%">         <p>1203</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>100305</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>id_token的header解析失败。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>id_token格式错误或者伪造的id_token。</p>         <ul>          <li>检查id_token值是否JWT格式。</li>          <li>检查是否为华为账号返回的原始值。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>100306</p></td>        <td class="cellrowborder">         <p>id_token的payload解析失败。</p></td>        <td class="cellrowborder">         <p>id_token格式错误或者伪造的id_token。</p>         <ul>          <li>检查id_token值是否JWT格式。</li>          <li>检查是否为华为账号返回的原始值。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>150021</p></td>        <td class="cellrowborder">         <p>id_token解析失败。</p></td>        <td class="cellrowborder">         <p>id_token格式错误或者伪造的id_token。</p>         <ul>          <li>检查id_token值是否JWT格式。</li>          <li>检查是否为华为账号返回的原始值。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>150023</p></td>        <td class="cellrowborder">         <p>id_token的signature解析失败。</p></td>        <td class="cellrowborder">         <p>id_token格式错误或者伪造的id_token。</p>         <ul>          <li>检查id_token值是否JWT格式。</li>          <li>检查是否为华为账号返回的原始值。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>500</p></td>        <td class="cellrowborder">         <p>系统内部错误。</p></td>        <td class="cellrowborder">         <p>系统内部处理错误，建议业务打印错误码信息，并请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>       </tr>       <tr>        <td class="cellrowborder" width="20.562056205620564%">         <p>1400</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>14004</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>无法通过其kid找到对应的JWT公钥相关信息。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>请通过<a href="https://developer.huawei.com/consumer/cn/support/feedback/#/" target="_blank">在线提单</a>提交问题。</p></td>       </tr>       <tr>        <td class="cellrowborder" rowspan="6" width="20.562056205620564%">         <p>1500</p></td>        <td class="cellrowborder" width="19.781978197819782%">         <p>15003</p></td>        <td class="cellrowborder" width="22.492249224922492%">         <p>无效的id_token。</p></td>        <td class="cellrowborder" width="37.163716371637165%">         <p>id_token格式错误或者伪造的id_token。</p>         <ul>          <li>检查id_token值是否JWT格式。</li>          <li>检查是否为华为账号返回的原始值。</li>         </ul></td>       </tr>       <tr>        <td class="cellrowborder">         <p>15004</p></td>        <td class="cellrowborder">         <p>id_token验证失败。</p></td>        <td class="cellrowborder">         <p>检查验证时使用的公钥、算法是否正确。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>15005</p></td>        <td class="cellrowborder">         <p>id_token的issuer验证失败。</p></td>        <td class="cellrowborder">         <p>请排查id_token是否被篡改。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>15006</p></td>        <td class="cellrowborder">         <p>id_token已过期。</p></td>        <td class="cellrowborder">         <p>请重新获取新的id_token。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>15007</p></td>        <td class="cellrowborder">         <p>id_token为空。</p></td>        <td class="cellrowborder">         <p>请按照接口参数的要求，传入正确的id_token参数。</p></td>       </tr>       <tr>        <td class="cellrowborder">         <p>15008</p></td>        <td class="cellrowborder">         <p>id_token格式不正确。</p></td>        <td class="cellrowborder">         <p>检查id_token的格式是否满足正则：^[0-9a-zA-Z_\-\.]+$。</p></td>       </tr>           </tbody></table></div>    </div>   </div>   <div></div></div>