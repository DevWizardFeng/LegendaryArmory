<h1 _ngcontent-lrn-c119="" class="doc-title ng-star-inserted" title="验证deviceToken"> 验证deviceToken </h1>

<div _ngcontent-lrn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section9378192212219" device-type="phone,tablet,2in1,wearable,tv">功能介绍<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section9378192212219" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>开发者应用的服务端可调用本接口验证deviceToken合法性，确认设备为真实的华为设备。</p>    </div>    <div class="tiledSection">     <h2 id="section178846261849" device-type="phone,tablet,2in1,wearable,tv">场景描述<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section178846261849" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>开发者获取到device token后可调用本接口验证deviceToken合法性，确认设备为真实的华为设备。</p>     <p>与设备真实性证明能力的区别：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.1" width="28.660000000000004%">          <p>开放能力</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.2" width="71.34%">          <p>能力说明</p></th>        </tr><tr>         <td class="cellrowborder" width="28.660000000000004%">          <p>验证deviceToken</p></td>         <td class="cellrowborder" width="71.34%">          <p>验证设备真实性的一个轻量化实现，对开发者集成的要求相对简单。</p>          <p>不支持防重放，且每次校验都需要与Device Security服务器交互，对业务的处理时延有一定的影响。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="28.660000000000004%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/device-attestation-intro" target="_blank">设备真实性证明</a></p></td>         <td class="cellrowborder" width="71.34%">          <p>是通过在设备侧的TEE中创建一对公私钥，并对该密钥进行证明后把公钥保存在应用服务器，需要开发者在应用服务器中保存证明后的公钥，并维护公钥的生命周期，对开发者的集成要求相对较高。</p>          <p>支持防重放，后续的业务请求无需与设备真实性证明服务器交互，对业务的处理时延无明显的影响。</p></td>        </tr>             </tbody></table></div>     </div>     <p>建议开发者根据实际的安全诉求和业务场景，选择合适的能力。</p>    </div>    <div class="tiledSection">     <h2 id="section195216336420" device-type="phone,tablet,2in1,wearable,tv">使用约束<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section195216336420" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p>无</p>    </div>    <div class="tiledSection">     <h2 id="section386819368420" device-type="phone,tablet,2in1,wearable,tv">接口原型<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section386819368420" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div class="tablenoborder">      <div class="tbBox"><table>               <tbody><tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.1.1" width="18.34%">          <p><strong>承载协议</strong></p></th>         <td class="cellrowborder" width="81.66%">          <p>HTTPS POST</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.2.1" width="18.34%">          <p><strong>接口方向</strong></p></th>         <td class="cellrowborder" width="81.66%">          <p><span style="color: rgb(36,39,40);">开发者服务器-</span><span style="color: rgb(36,39,40);">&gt;</span>Device Security<span style="color: rgb(36,39,40);">服务器</span></p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.3.1" width="18.34%">          <p><strong>接口URL</strong></p></th>         <td class="cellrowborder" width="81.66%">          <p>https://connect-api.cloud.huawei.com/api/rms/v1/deviceVerify/checkDeviceToken</p></td>        </tr>        <tr>         <th class="firstcol" id="mcps1.3.4.2.1.3.4.1" width="18.34%">          <p><strong>数据格式</strong></p></th>         <td class="cellrowborder" width="81.66%">          <p>请求消息头：<span style="color: rgb(36,39,40);">Content-Type: application/json;charset=utf-8</span></p>          <p>响应消息：Content-Type: application/json;charset=utf-8</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section81311842163611" device-type="phone,tablet,2in1,wearable,tv">请求参数<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section81311842163611" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>Request Header</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.1" width="17%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.2" width="10%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.3" width="10%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.5.1.4" width="63%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17%">          <p>Content-Type</p></td>         <td class="cellrowborder" width="10%">          <p>否</p></td>         <td class="cellrowborder" width="10%">          <p>String</p></td>         <td class="cellrowborder" width="63%">          <p>取值为：<span style="color: rgb(36,39,40);">application/json;charset=utf-8</span>。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>Authorization</p></td>         <td class="cellrowborder" width="10%">          <p>是</p></td>         <td class="cellrowborder" width="10%">          <p>String</p></td>         <td class="cellrowborder" width="63%">          <p>服务账号令牌</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17%">          <p>bundleName</p></td>         <td class="cellrowborder" width="10%">          <p>是</p></td>         <td class="cellrowborder" width="10%">          <p>String</p></td>         <td class="cellrowborder" width="63%">          <p>开发者APP包名</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Authorization格式：Bearer后面拼接空格，再拼接获取的鉴权信息。令牌生成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/devicesecurity-deviceverify-token#section1910053451218" target="_blank">示例代码</a>。</p>      </div></div></div>     <p><strong>Request Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.1" width="16.18%">          <p>参数</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.2" width="14.899999999999999%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.3" width="17.349999999999998%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.6.1.5.1.4" width="51.57000000000001%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="16.18%">          <p>deviceToken</p></td>         <td class="cellrowborder" width="14.899999999999999%">          <p>是</p></td>         <td class="cellrowborder" width="17.349999999999998%">          <p>String</p></td>         <td class="cellrowborder" width="51.57000000000001%">          <p>客户端调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-deviceverify-api#section102884586336">getDeviceToken</a>获取的设备临时标识。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16.18%">          <p>transactionId</p></td>         <td class="cellrowborder" width="14.899999999999999%">          <p>否</p></td>         <td class="cellrowborder" width="17.349999999999998%">          <p>String</p></td>         <td class="cellrowborder" width="51.57000000000001%">          <p>应用服务的唯一事务标识，关联业务上下文消息。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="16.18%">          <p>timestamp</p></td>         <td class="cellrowborder" width="14.899999999999999%">          <p>是</p></td>         <td class="cellrowborder" width="17.349999999999998%">          <p>Long</p></td>         <td class="cellrowborder" width="51.57000000000001%">          <p>应用服务器上的UTC时间。单位，毫秒。</p></td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>开发者在构造消息体时，消息体需要在外层包一层data结构，详情参考如下调用示例。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="section6804114718362" device-type="phone,tablet,2in1,wearable,tv">请求示例<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section6804114718362" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-lrn-c106="" class="highlight-div"><div _ngcontent-lrn-c106="" class="highlight-div-header"><div _ngcontent-lrn-c106="" class="highlight-div-header-left"><div _ngcontent-lrn-c106="" class="handle-button expand-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lrn-c106="" class="highlight-div-header-right"><div _ngcontent-lrn-c106="" class="handle-button ai-button"></div><div _ngcontent-lrn-c106="" class="handle-button line-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lrn-c106="" class="handle-button theme-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lrn-c106="" class="handle-button copy-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lrn-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>post /api/rms/v1/deviceVerify/checkDeviceToken HTTP/<span class="hljs-number">1.1</span></li><li><span class="">Host<span class="hljs-punctuation">:</span> xxx</span></li><li><span class="">Authorization<span class="hljs-punctuation">:</span> Bearer eyJr*****OiIx---****.eyJh*****iJodHR--***.QRod*****<span class="hljs-number">4</span>Gp---****</span></li><li><span class="">bundleName<span class="hljs-punctuation">:</span> com.huawei.xxx</span></li><li><span class="">Content-Type<span class="hljs-punctuation">:</span> application/json;charset=utf<span class="hljs-number">-8</span></span></li><li>
</li><li><span class="hljs-punctuation">{</span><span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span><span class="hljs-punctuation">{</span> <span class="hljs-attr">"deviceToken"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"xxx"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"transactionId"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"xxx"</span><span class="hljs-punctuation">,</span> <span class="hljs-attr">"timestamp"</span><span class="hljs-punctuation">:</span><span class="hljs-number">1704038400</span><span class="hljs-punctuation">}</span><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section15843753133611" device-type="phone,tablet,2in1,wearable,tv">响应参数<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section15843753133611" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><p><strong>Response Body</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.5.1.1" width="17.23%">          <p><strong>参数</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.5.1.2" width="17%">          <p>是否必选</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.5.1.3" width="18%">          <p>参数类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.5.1.4" width="47.77%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" width="17.23%">          <p>bundleName</p></td>         <td class="cellrowborder" width="17%">          <p>否</p></td>         <td class="cellrowborder" width="18%">          <p>String</p></td>         <td class="cellrowborder" width="47.77%">          <p>从token中获取的bundleName，供开发者校验。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="17.23%">          <p>errorCodes</p></td>         <td class="cellrowborder" width="17%">          <p>是</p></td>         <td class="cellrowborder" width="18%">          <p>String</p></td>         <td class="cellrowborder" width="47.77%">          <p>错误码。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section73791058113618" device-type="phone,tablet,2in1,wearable,tv">响应示例<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section73791058113618" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">TV</span><span class="support-device-item">Wearable</span></div><div _ngcontent-lrn-c106="" class="highlight-div"><div _ngcontent-lrn-c106="" class="highlight-div-header"><div _ngcontent-lrn-c106="" class="highlight-div-header-left"><div _ngcontent-lrn-c106="" class="handle-button expand-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lrn-c106="" class="highlight-div-header-right"><div _ngcontent-lrn-c106="" class="handle-button ai-button"></div><div _ngcontent-lrn-c106="" class="handle-button line-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lrn-c106="" class="handle-button theme-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lrn-c106="" class="handle-button copy-button"><div _ngcontent-lrn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lrn-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" data-highlighted="yes"><ol class="linenums"><li>HTTP/<span class="hljs-number">1.1</span> <span class="hljs-number">200</span> OK</li><li><span class="">Content-Type<span class="hljs-punctuation">:</span> application/json;charset=utf<span class="hljs-number">-8</span></span></li><li>
</li><li><span class="hljs-punctuation">{</span><span class="hljs-attr">"bundleName"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"xxx"</span><span class="hljs-punctuation">,</span><span class="hljs-attr">"errorCodes"</span><span class="hljs-punctuation">:</span><span class="hljs-string">"OK"</span><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section7446201912595" device-type="phone,tablet,2in1,wearable">错误码<i class="anchor-icon anchor-icon-device active" active-tips="隐藏支持设备" tips="显示支持设备"></i><i class="anchor-icon anchor-icon-link" anchorid="section7446201912595" tips="复制节点链接"></i></h2>          <div class="device-list active"><span class="support-device-pre">支持设备</span><span class="support-device-item">Phone</span><span class="support-device-item">PC/2in1</span><span class="support-device-item">Tablet</span><span class="support-device-item">Wearable</span></div><p>以下错误码的详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/devicesecurity-restapi-errcode">REST API错误码</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="tableClass2_t">                      <tbody><tr class="firstRow">         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.3.1.1" width="50.28%">          <p><strong>错误码</strong></p></th>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.3.1.2" width="49.72%">          <p><strong>描述</strong></p></th>        </tr><tr>         <td class="cellrowborder" width="50.28%">          <p>OK</p></td>         <td class="cellrowborder" width="49.72%">          <p>请求处理成功。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="50.28%">          <p>InvalidDeviceToken</p></td>         <td class="cellrowborder" width="49.72%">          <p>deviceToken缺失或不合法。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="50.28%">          <p>DeviceTokenExpired</p></td>         <td class="cellrowborder" width="49.72%">          <p>deviceToken过期。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="50.28%">          <p>InvalidTimeStamp</p></td>         <td class="cellrowborder" width="49.72%">          <p>timeStamp缺失或不合法。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="50.28%">          <p>InternalServerError</p></td>         <td class="cellrowborder" width="49.72%">          <p>服务器内部错误。</p></td>        </tr>        <tr>         <td class="cellrowborder" width="50.28%">          <p>InvalidBundleName</p></td>         <td class="cellrowborder" width="49.72%">          <p>bundleName缺失或不合法。</p></td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>