<h1 _ngcontent-gys-c119="" class="doc-title ng-star-inserted" title="2.X.X与5.X.X版本升级"> 2.X.X与5.X.X版本升级 </h1>

<div _ngcontent-gys-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001832111786"><p id="ZH-CN_TOPIC_0000002510173719__p14528037165814">如需将ohpm-repo版本2.X.X/5.X.X版本升级到更高版本，可参考此文档。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173719__p57648616591">1. 在升级之前，请务必备份好ohpm-repo私仓工具中的历史数据，避免因升级操作失误，导致数据丢失。备份的内容包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-upgrade-110_to_2xx#li10435216234">&lt;deploy_root&gt;</a>ohpm-repo部署根目录内数据，db元数据以及store三方包数据，详细可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-data-backup">数据备份</a> 。</p> <p id="ZH-CN_TOPIC_0000002510173719__p16969134134819">2. 如果您想要改变db元数据和store三方包的存储方式，可在正确升级后参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-data-migration">数据迁移文档指导</a>修改。</p> </div></div></div> <ol id="ZH-CN_TOPIC_0000002510173719__ol10289181911504"><li id="li828817196508"><span>旧版本服务停止：如果旧版本的服务还在运行，升级版本前请停止，执行stop。</span><p></p><div _ngcontent-gys-c106="" class="highlight-div"><div _ngcontent-gys-c106="" class="highlight-div-header"><div _ngcontent-gys-c106="" class="highlight-div-header-left"><div _ngcontent-gys-c106="" class="handle-button expand-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gys-c106="" class="highlight-div-header-right"><div _ngcontent-gys-c106="" class="handle-button ai-button"></div><div _ngcontent-gys-c106="" class="handle-button line-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gys-c106="" class="handle-button theme-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gys-c106="" class="handle-button copy-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gys-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-vbnet" id="ZH-CN_TOPIC_0000002510173719__screen628815199509" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo <span class="hljs-keyword">stop</span></li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><ul id="ZH-CN_TOPIC_0000002510173719__ul1828831975012"><li id="li1928818193502">如果部署的是多实例，升级前需要停下所有机器中的ohpm-repo服务，再进行升级操作。</li><li id="li10288111985017">若想在其他目录使用ohpm-repo，请将对应版本ohpm-repo工具包解压目录中bin目录的路径配置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ohpm-repo-faq#section24117279211">系统环境变量</a>path中。</li></ul> </div></div></div> <p></p></li><li id="li5289131919505"><span>下载并解压工具包：下载新版本的ohpm-repo私仓工具包，并解压（请解压到一个空文件夹中）。</span><p></p><p id="ZH-CN_TOPIC_0000002510173719__p1628810194502"><span><img originheight="280" originwidth="258" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104744.09578197933604036548254891958831:50001231000000:2800:717091546118A5E512230E0BC63D3B8BEBDFB81CB4FCD19814CA978734078BEA.png" class="notEnlarge" width="258" height="280"></span></p> <p></p></li><li id="li19289181975020"><span>安装完成之后，进入ohpm-repo私仓工具包解压目录下的bin目录，执行如下命令：</span><p></p><div _ngcontent-gys-c106="" class="highlight-div"><div _ngcontent-gys-c106="" class="highlight-div-header"><div _ngcontent-gys-c106="" class="highlight-div-header-left"><div _ngcontent-gys-c106="" class="handle-button expand-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gys-c106="" class="highlight-div-header-right"><div _ngcontent-gys-c106="" class="handle-button ai-button"></div><div _ngcontent-gys-c106="" class="handle-button line-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gys-c106="" class="handle-button theme-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gys-c106="" class="handle-button copy-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gys-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002510173719__screen102891419165018" data-highlighted="yes"><ol class="linenums"><li>ohpm-repo -v</li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510173719__p1828971985013">终端输出为新版本的版本号，则表示解压成功。</p> <p></p></li><li id="li192897192500"><span>移植配置文件信息：ohpm-repo的版本更新前后都保持在2.X.X/5.X.X范围内，新版本配置文件可以直接复用旧版本配置文件。</span><p></p><ul id="ZH-CN_TOPIC_0000002510173719__ul928910194509"><li id="li19289519105018">找到ohpm-repo旧版本的配置文件：如果旧版本未指定配置文件，使用默认配置文件：旧版本ohpm-repo解压根目录/conf/config.yaml。</li><li id="li3289151918501">拷贝旧版本配置文件至新版本：复制旧版本的配置文件到新版ohpm-repo解压目录下的conf文件夹，覆盖新版本中的默认配置文件。</li></ul> <p></p></li><li id="li15289619165019"><span>（可选项）新版本如果需要使用新的部署目录&lt;new_deploy_root&gt;，需要手动迁移数据。</span><p></p><ul id="ZH-CN_TOPIC_0000002510173719__ul92894195502"><li id="li128961915013">升级ohpm-repo：按照步骤1-4，解压ohpm-repo并拷贝替换配置文件信息。</li><li id="li7289161995011">建立新部署目录：判断指定的新部署目录&lt;new_deploy_root&gt;是否存在，不存在则新建，新部署目录需存在且为空。</li><li id="li82891719145017">拷贝数据文件：拷贝旧版本部署目录&lt;deploy_root&gt;下的全部文件至新部署目录中。</li><li id="li22891319155016">修改新版本ohpm-repo配置文件：打开新版本ohpm-repo的解压根目录，进入conf目录下，修改配置文件config.yaml中配置项deploy_root为新的部署目录&lt;new_deploy_root&gt;。</li></ul> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173719__p17289219155011">在使用新部署目录时，旧版本的部署目录中meta文件必须要迁移到新版本部署目录中，否则将导致使用meta加密组件加密的数据无法被正确解密。</p> </div></div></div> <p></p></li></ol><ol id="ZH-CN_TOPIC_0000002510173719__ol628881965020" start="6"><li id="li19288419195016"><span>新版本服务启动：正确拷贝替换配置文件信息后，进入ohpm-repo私仓工具包解压目录下的bin目录，执行以下命令启动新版本ohpm-repo服务。</span><p></p><ul id="ZH-CN_TOPIC_0000002510173719__ul528891919500"><li id="li172871719145012">执行安装命令：<div _ngcontent-gys-c106="" class="highlight-div"><div _ngcontent-gys-c106="" class="highlight-div-header"><div _ngcontent-gys-c106="" class="highlight-div-header-left"><div _ngcontent-gys-c106="" class="handle-button expand-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gys-c106="" class="highlight-div-header-right"><div _ngcontent-gys-c106="" class="handle-button ai-button"></div><div _ngcontent-gys-c106="" class="handle-button line-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gys-c106="" class="handle-button theme-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gys-c106="" class="handle-button copy-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gys-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" id="ZH-CN_TOPIC_0000002510173719__screen132871119195014" data-highlighted="yes"><ol class="linenums"><li><em>ohpm-repo install</em></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510173719__p6287619175011">结果示例：</p> <p id="ZH-CN_TOPIC_0000002510173719__p152875191500"><span><img height="71.82000000000001" originheight="152" originwidth="1096" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104744.78594910930514252885197237961201:50001231000000:2800:85DB1CB38171CB808C0021FBC8D3320C44771AA54A054C2457A5561A8130C034.png" title="点击放大" width="523.6875"></span></p> </li><li id="li22883195508">刷新环境变量：安装成功后，必须根据给出的提示信息刷新环境变量，Windows系统和Linux/Mac 系统，有不同处理方式：<ul id="ZH-CN_TOPIC_0000002510173719__ul4288131925015"><li id="li42884194508"><p id="ZH-CN_TOPIC_0000002510173719__p2028719194504"><a name="ZH-CN_TOPIC_0000002510173719__li42884194508"></a><a name="li42884194508"></a>Windows系统： 关闭当前窗口，重新开启一个窗口。</p> </li><li id="li159610147240"><p id="ZH-CN_TOPIC_0000002510173719__p89604144242"><a name="ZH-CN_TOPIC_0000002510173719__li159610147240"></a><a name="li159610147240"></a>Linux/Mac系统：</p> <ul id="ZH-CN_TOPIC_0000002510173719__ul62091732172413"><li id="li8459182615249"><p id="ZH-CN_TOPIC_0000002510173719__p7458162613245"><a name="ZH-CN_TOPIC_0000002510173719__li8459182615249"></a><a name="li8459182615249"></a>5.0.1之前版本：在命令行中执行刷新命令：source ~/.bashrc或者.~/.bashrc ；</p> </li><li id="li2288131912506"><p id="ZH-CN_TOPIC_0000002510173719__p228891910507"><a name="ZH-CN_TOPIC_0000002510173719__li2288131912506"></a><a name="li2288131912506"></a>5.0.1及以后版本：</p> <p id="ZH-CN_TOPIC_0000002510173719__zh-cn_topic_0000001792256157_li279817595216p0">在命令行中执行刷新命令：当shell为bash时，执行<em>source ~/.bashrc</em>或者.<em> ~/.bashrc</em> ；当shell为zsh时，执行<em>source ~/.zshrc</em>或者.<em>~/.zshrc</em> 。</p> </li></ul> </li></ul> </li><li id="li1428851915505">执行start命令：<div _ngcontent-gys-c106="" class="highlight-div"><div _ngcontent-gys-c106="" class="highlight-div-header"><div _ngcontent-gys-c106="" class="highlight-div-header-left"><div _ngcontent-gys-c106="" class="handle-button expand-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gys-c106="" class="highlight-div-header-right"><div _ngcontent-gys-c106="" class="handle-button ai-button"></div><div _ngcontent-gys-c106="" class="handle-button line-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gys-c106="" class="handle-button theme-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gys-c106="" class="handle-button copy-button"><div _ngcontent-gys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gys-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" id="ZH-CN_TOPIC_0000002510173719__screen22882019195019" data-highlighted="yes"><ol class="linenums"><li><em>ohpm<span class="hljs-operator">-</span>repo <span class="hljs-keyword">start</span></em></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510173719__p15288219105016">结果示例：</p> <p id="ZH-CN_TOPIC_0000002510173719__p3288141915018"><span><img height="67.24214" originheight="97" originwidth="1079" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104744.17062284901032211023254186227898:50001231000000:2800:959E2653911CF75D6C14FEB92E61BE40EB9BAF67525AB8251855D2008E78F3CE.png" title="点击放大" width="748.125"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002510173719__p8217240112115">版本升级之前，如果浏览器中已访问ohpm-repo页面，版本升级之后请刷新ohpm-repo页面。</p> </div></div></div> </li></ul> <p></p></li><li id="li1928810198503"><span>多实例部署机器快速升级：在多实例部署中，其他机器同步骤1-6进行快速升级操作。</span></li></ol> </div> <div></div></div>