<h1 _ngcontent-afv-c119="" class="doc-title ng-star-inserted" title="@Event装饰器：规范组件输出"> @Event装饰器：规范组件输出 </h1>

<div _ngcontent-afv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>为了实现子组件向父组件要求更新@Param装饰变量的能力，开发者可以使用@Event装饰器。使用@Event装饰回调方法是一种规范，表明子组件需要传入更新数据源的回调。</p> <p>@Event主要配合@Param实现数据的双向同步。在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>从API version 12开始，在@ComponentV2装饰的自定义组件中支持使用@Event装饰器。</p>  <p>从API version 12开始，该装饰器支持在元服务中使用。</p>  </div></div></div>  <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>由于@Param装饰的变量在本地无法更改，使用@Event装饰器装饰回调方法并调用，可以实现更新数据源的变量，再通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>的同步机制，将修改同步回@Param装饰的变量，以此达到主动更新@Param装饰变量的效果。</p> <p>@Event用于装饰组件对外输出的方法：</p> <ul><li><p>@Event装饰的回调方法中参数以及返回值由开发者决定。</p>  </li><li><p>@Event装饰非回调类型的变量不会生效。当@Event没有初始化时，会自动生成一个空的函数作为默认回调。</p>  </li><li><p>当@Event未被外部初始化，但本地有默认值时，会使用本地默认的函数进行处理。</p>  </li></ul> <p>@Param标志着组件的输入，表明该变量受父组件影响，而@Event标志着组件的输出，可以通过该方法影响父组件。使用@Event装饰回调方法是一种规范，表明该回调作为自定义组件的输出。父组件需要判断是否提供对应方法用于子组件更改@Param变量的数据源。</p> </div>  <div class="tiledSection"><h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">@Event属性装饰器</th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">装饰器参数</td> <td class="cellrowborder" valign="top" width="50%">无。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td> <td class="cellrowborder" valign="top" width="50%">回调方法，例如()=&gt;void、(x:number)=&gt;boolean等。回调方法是否含有参数以及返回值由开发者决定。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">允许传入的函数类型</td> <td class="cellrowborder" valign="top" width="50%">箭头函数。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2><ul><li><p>@Event只能用在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>装饰的自定义组件中。当装饰非方法类型的变量时，不会有任何作用。</p>  <div _ngcontent-afv-c106="" class="highlight-div"><div _ngcontent-afv-c106="" class="highlight-div-header"><div _ngcontent-afv-c106="" class="highlight-div-header-left"><div _ngcontent-afv-c106="" class="handle-button expand-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-afv-c106="" class="highlight-div-header-right"><div _ngcontent-afv-c106="" class="handle-button ai-button"></div><div _ngcontent-afv-c106="" class="handle-button line-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-afv-c106="" class="handle-button theme-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-afv-c106="" class="handle-button copy-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-afv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeFactory</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {}; <span class="hljs-comment">//正确用法</span></li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'abcd'</span>; <span class="hljs-comment">// 错误用法，装饰非函数类型变量，@Event无作用</span></li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeFactory</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {}; <span class="hljs-comment">// 错误用法，编译时报错</span></li><li>}</li></ol></pre></div></div>  </li></ul> </div>  <div class="tiledSection"><h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="更改父组件中变量" class="firsth2">更改父组件中变量<i class="anchor-icon anchor-icon-link" anchorid="更改父组件中变量" tips="复制节点链接"></i></h3><p>使用@Event可以更改父组件中变量，当该变量作为子组件@Param变量的数据源时，该变化会同步回子组件的@Param变量。</p> <div _ngcontent-afv-c106="" class="highlight-div"><div _ngcontent-afv-c106="" class="highlight-div-header"><div _ngcontent-afv-c106="" class="highlight-div-header-left"><div _ngcontent-afv-c106="" class="handle-button expand-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-afv-c106="" class="highlight-div-header-right"><div _ngcontent-afv-c106="" class="handle-button ai-button"></div><div _ngcontent-afv-c106="" class="handle-button line-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-afv-c106="" class="handle-button theme-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-afv-c106="" class="handle-button copy-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-afv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Title One'</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">title</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>,</li><li>        <span class="hljs-attr">fontColor</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontColor</span>,</li><li>        <span class="hljs-attr">changeFactory</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> == <span class="hljs-number">1</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'Title One'</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> == <span class="hljs-number">2</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'Title Two'</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>;</li><li>          }</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>;</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeFactory</span>: <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span></span>) =&gt;</span> {};</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.title}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fontColor</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to Title Two'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeFactory</span>(<span class="hljs-number">2</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to Title One'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeFactory</span>(<span class="hljs-number">1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>值得注意的是，使用@Event修改父组件的值是立刻生效的，但从父组件将变化同步回子组件的过程是异步的，即在调用完@Event的方法后，子组件内的值不会立刻变化。这是因为@Event将子组件值实际的变化能力交由父组件处理，在父组件实际决定如何处理后，将最终值在渲染之前同步回子组件。</p> <div _ngcontent-afv-c106="" class="highlight-div"><div _ngcontent-afv-c106="" class="highlight-div-header"><div _ngcontent-afv-c106="" class="highlight-div-header-left"><div _ngcontent-afv-c106="" class="handle-button expand-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-afv-c106="" class="highlight-div-header-right"><div _ngcontent-afv-c106="" class="handle-button ai-button"></div><div _ngcontent-afv-c106="" class="handle-button line-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-afv-c106="" class="handle-button theme-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-afv-c106="" class="handle-button copy-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-afv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeIndex</span>: <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeIndex</span>(<span class="hljs-number">20</span>);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`after changeIndex <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Child</span>({</li><li>          <span class="hljs-attr">index</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span>,</li><li>          <span class="hljs-attr">changeIndex</span>: <span class="hljs-function">(<span class="hljs-params">val: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">index</span> = val;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`in changeIndex <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>          }</li><li>        })</li><li>      }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>在上面的示例中，点击文字触发@Event函数事件改变子组件的值，打印出的日志为：</p> <div _ngcontent-afv-c106="" class="highlight-div"><div _ngcontent-afv-c106="" class="highlight-div-header"><div _ngcontent-afv-c106="" class="highlight-div-header-left"><div _ngcontent-afv-c106="" class="handle-button expand-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-afv-c106="" class="highlight-div-header-right"><div _ngcontent-afv-c106="" class="handle-button ai-button"></div><div _ngcontent-afv-c106="" class="handle-button line-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-afv-c106="" class="handle-button theme-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-afv-c106="" class="handle-button copy-button"><div _ngcontent-afv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-afv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>in changeIndex 20</li><li>after changeIndex 0</li></ol></pre></div></div> <p>这表明在调用changeIndex之后，父组件中index的值已经变化，但子组件中的index值还没有同步变化。</p> </div> </div> <div></div></div>