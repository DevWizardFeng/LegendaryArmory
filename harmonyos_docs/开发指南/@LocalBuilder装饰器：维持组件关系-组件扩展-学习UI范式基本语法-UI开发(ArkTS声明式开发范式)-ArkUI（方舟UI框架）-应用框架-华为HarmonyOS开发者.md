<h1 _ngcontent-rpn-c119="" class="doc-title ng-star-inserted" title="@LocalBuilder装饰器： 维持组件关系"> @LocalBuilder装饰器： 维持组件关系 </h1>

<div _ngcontent-rpn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>当开发者使用局部@Builder进行引用数据传递时，需要考虑组件的父子关系。然而在使用.bind(this)的方式更改函数调用上下文后，会出现组件的父子关系与状态管理的父子关系不一致的问题。为了解决这一问题，引入@LocalBuilder装饰器。@LocalBuilder拥有和局部@Builder相同的功能，且比局部@Builder能够更好的确定组件的父子关系和状态管理的父子关系。</p> <p>在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder">@Builder</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>从API version 12开始支持。</p>  <p>从API version 12开始，该装饰器支持在ArkTS卡片中使用。</p>  <p>从API version 12开始，该装饰器支持在元服务中使用。</p>  </div></div></div>  <div class="tiledSection"><h2 id="装饰器使用说明">装饰器使用说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器使用说明" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="自定义组件内自定义构建函数" class="firsth2">自定义组件内自定义构建函数<i class="anchor-icon anchor-icon-link" anchorid="自定义组件内自定义构建函数" tips="复制节点链接"></i></h3><p>定义的语法：</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@LocalBuilder</span> <span class="hljs-title function_">myBuilderFunction</span>(<span class="hljs-params"></span>) { ... }</li></ol></pre></div></div> <p>使用方法：</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">myBuilderFunction</span>()</li></ol></pre></div></div> <ul><li><p>允许在自定义组件内定义一个或多个@LocalBuilder函数，该函数被认为是该组件的私有、特殊类型的成员函数。</p>  </li><li><p>自定义构建函数可以在所属组件的build函数和其他自定义构建函数中调用，但不允许在组件外调用。</p>  </li><li><p>在自定义函数体中，this指代当前所属组件，组件的状态变量可以在自定义构建函数内访问。建议通过this访问自定义组件的状态变量而不是参数传递。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2><ul><li><p>@LocalBuilder只能在所属组件内声明，不允许全局声明。</p>  </li><li><p>@LocalBuilder不能与内置装饰器或自定义装饰器一起使用。</p>  </li><li><p>在自定义组件中，@LocalBuilder不能用来装饰静态函数。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="localbuilder和局部builder使用区别">@LocalBuilder和局部@Builder使用区别<i class="anchor-icon anchor-icon-link" anchorid="localbuilder和局部builder使用区别" tips="复制节点链接"></i></h2><p>跨组件传递局部@Builder函数时，会使用.bind(this)更改函数上下文，但这可能会导致组件的父子关系与状态管理的父子关系不一致。而@LocalBuilder无论是否使用.bind(this)，都不会改变组件的父子关系，即@LocalBuilder中定义组件所属的父组件是确定的，无法被改变。详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localbuilder#localbuilder和builder区别说明">@LocalBuilder和@Builder区别说明</a>。</p> <p><span><img originheight="282" originwidth="586" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114922.01478643047122609027605536684444:50001231000000:2800:610360F660B968992BD90A862F6CB8320D62E0DBFB003B56D0C2DE4BC4BD5ECB.png" width="586" height="282"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>bind()方法创建一个新的函数，称为绑定函数，当调用者绑定bind()时，该绑定函数会以创建时传入的第一个this作为原函数的this。</p>  </div></div></div> </div>  <div class="tiledSection"><h2 id="参数传递规则">参数传递规则<i class="anchor-icon anchor-icon-link" anchorid="参数传递规则" tips="复制节点链接"></i></h2><p>@LocalBuilder函数的参数传递有<a href="/consumer/cn/doc/harmonyos-guides/arkts-localbuilder#按值传递参数">按值传递</a>和<a href="/consumer/cn/doc/harmonyos-guides/arkts-localbuilder#按引用传递参数">按引用传递</a>两种，均需遵守以下规则：</p> <ul><li><p>参数的类型必须与参数声明的类型一致，且不允许为undefined、null。</p>  </li><li><p>在@LocalBuilder修饰的函数内部，不允许改变参数值。</p>  </li><li><p>@LocalBuilder内的UI语法遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#build函数">UI语法规则</a>。</p>  </li><li><p>传入一个对象字面量参数时按引用传递，其他方式按值传递。</p>  </li></ul> </div>  <div class="tiledSection"><h3 id="按引用传递参数" class="firsth2">按引用传递参数<i class="anchor-icon anchor-icon-link" anchorid="按引用传递参数" tips="复制节点链接"></i></h3><p>按引用传递参数时，传递的参数可为状态变量，且状态变量的改变会引起@LocalBuilder函数内的UI刷新。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>若@LocalBuilder函数和$$参数一起使用，子组件调用父组件的@LocalBuilder函数，子组件传入的参数发生变化，不会引起@LocalBuilder函数内的UI刷新。</p>  </div></div></div> <p>组件Parent内的@LocalBuilder函数在build函数内调用，按键值对写法进行传值，当点击Click me时，@LocalBuilder内的Text文本内容会随着状态变量内容的改变而改变。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReferenceType</span> {</li><li>  <span class="hljs-attr">paramString</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">variableValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">citeLocalBuilder</span>(<span class="hljs-params">params: ReferenceType</span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UseStateVarByReference: <span class="hljs-subst">${params.paramString}</span>`</span>)</li><li>    }</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">citeLocalBuilder</span>({ <span class="hljs-attr">paramString</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">variableValue</span> })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click me'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">variableValue</span> = <span class="hljs-string">'Hi World'</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>按引用传递参数时，如果在@LocalBuilder函数内调用自定义组件，ArkUI提供$$作为按引用传递参数的范式。</p> <p>组件Parent内的@LocalBuilder函数内调用自定义组件，且按照引用传递参数将值传递到自定义组件，当Parent组件内状态变量值发生变化时，@LocalBuilder函数内的自定义组件HelloComponent的message值也会随之更新。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ReferenceType</span> {</li><li>  <span class="hljs-attr">paramString</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">HelloComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`HelloComponent===<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">variableValue</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">citeLocalBuilder</span>(<span class="hljs-params">$$: ReferenceType</span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`citeLocalBuilder===<span class="hljs-subst">${$$.paramString}</span>`</span>)</li><li>        <span class="hljs-title class_">HelloComponent</span>({ <span class="hljs-attr">message</span>: $$.<span class="hljs-property">paramString</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">citeLocalBuilder</span>({ <span class="hljs-attr">paramString</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">variableValue</span> })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click me'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">variableValue</span> = <span class="hljs-string">'Hi World'</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>当子组件引用父组件的@LocalBuilder函数并传入状态变量时，状态变量的改变不会触发@LocalBuilder函数内的UI刷新。这是因为调用@LocalBuilder装饰的函数创建出来的组件绑定于父组件，而状态变量的刷新机制仅作用于当前组件及其子组件，对父组件无效。而使用@Builder修饰函数可触发UI刷新，原因在于@Builder改变了函数的this指向，使创建出来的组件绑定到子组件上，从而在子组件修改变量能够实现@Builder中的UI刷新。</p> <p>组件Child将状态变量传递到Parent的@Builder和@LocalBuilder函数内。在@Builder函数内，this指向Child，参数变化能触发UI刷新。在@LocalBuilder函数内，this指向Parent，参数变化不会触发UI刷新。若@LocalBuilder函数内引用Parent的状态变量发生变化，UI能正常刷新。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {</li><li>  <span class="hljs-attr">size</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'parent'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">componentBuilder</span>(<span class="hljs-params">$$: Data</span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`builder + $$`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'this -&gt; '</span> + <span class="hljs-variable language_">this</span>.label}</span>`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'size : '</span> + $$.size}</span>`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">componentLocalBuilder</span>(<span class="hljs-params">$$: Data</span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`LocalBuilder + $$ data`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'this -&gt; '</span> + <span class="hljs-variable language_">this</span>.label}</span>`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'size : '</span> + $$.size}</span>`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">contentLocalBuilderNoArgument</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`LocalBuilder + local data`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'this -&gt; '</span> + <span class="hljs-variable language_">this</span>.label}</span>`</span>)</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-string">'size : '</span> + <span class="hljs-variable language_">this</span>.data.size}</span>`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">contentBuilder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentBuilder</span>,</li><li>        <span class="hljs-attr">contentLocalBuilder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentLocalBuilder</span>,</li><li>        <span class="hljs-attr">contentLocalBuilderNoArgument</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">contentLocalBuilderNoArgument</span>,</li><li>        <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'child'</span>;</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title function_">customBuilder</span>(<span class="hljs-params"></span>) {};</li><li>  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">contentBuilder</span>: (<span class="hljs-function">(<span class="hljs-params">data: Data</span>) =&gt;</span> <span class="hljs-built_in">void</span>) = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customBuilder</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">contentLocalBuilder</span>: (<span class="hljs-function">(<span class="hljs-params">data: Data</span>) =&gt;</span> <span class="hljs-built_in">void</span>) = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customBuilder</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">contentLocalBuilderNoArgument</span>: (<span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>) = <span class="hljs-variable language_">this</span>.<span class="hljs-property">customBuilder</span>;</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Data</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">contentBuilder</span>({ <span class="hljs-attr">size</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">size</span> })</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">contentLocalBuilder</span>({ <span class="hljs-attr">size</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">size</span> })</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">contentLocalBuilderNoArgument</span>()</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'add child size'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">size</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="按值传递参数">按值传递参数<i class="anchor-icon anchor-icon-link" anchorid="按值传递参数" tips="复制节点链接"></i></h3><p>调用@LocalBuilder装饰的函数默认按值传递。当传递的参数为状态变量时，状态变量的改变不会引起@LocalBuilder函数内的UI刷新。所以当使用状态变量的时候，推荐使用<a href="/consumer/cn/doc/harmonyos-guides/arkts-localbuilder#按引用传递参数">按引用传递</a>。</p> <p>组件Parent将@State修饰的label值按照函数传参方式传递到@LocalBuilder函数内，此时@LocalBuilder函数获取到的值为普通变量值，所以改变@State修饰的label值时，@LocalBuilder函数内的值不会发生改变。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">citeLocalBuilder</span>(<span class="hljs-params">paramA1: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UseStateVarByValue: <span class="hljs-subst">${paramA1}</span>`</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">citeLocalBuilder</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">label</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="localbuilder和builder区别说明">@LocalBuilder和@Builder区别说明<i class="anchor-icon anchor-icon-link" anchorid="localbuilder和builder区别说明" tips="复制节点链接"></i></h2><p>当函数componentBuilder被@Builder修饰时，显示效果为“Child”；当函数componentBuilder被@LocalBuilder修饰时，显示效果是“Parent”。</p> <p>说明：</p> <p>@Builder componentBuilder()通过this.componentBuilder的形式传给子组件@BuilderParam customBuilderParam，this指向子组件Child的实例。</p> <p>@LocalBuilder componentBuilder()通过this.componentBuilder的形式传给子组件@BuilderParam customBuilderParam，this指向父组件Parent的实例。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Child'</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-attr">customBuilderParam</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">customBuilderParam</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Parent'</span>;</li><li>
</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title function_">componentBuilder</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.label}</span>`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// @LocalBuilder componentBuilder() {</span></li><li>  <span class="hljs-comment">//   Text(`${this.label}`)</span></li><li>  <span class="hljs-comment">// }</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">customBuilderParam</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">componentBuilder</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="localbuilder在componentv2修饰的自定义组件中使用" class="firsth2">@LocalBuilder在@ComponentV2修饰的自定义组件中使用<i class="anchor-icon anchor-icon-link" anchorid="localbuilder在componentv2修饰的自定义组件中使用" tips="复制节点链接"></i></h3><p>在@ComponentV2装饰的自定义组件中使用局部的@LocalBuilder，修改变量时会触发UI刷新。</p> <div _ngcontent-rpn-c106="" class="highlight-div"><div _ngcontent-rpn-c106="" class="highlight-div-header"><div _ngcontent-rpn-c106="" class="highlight-div-header-left"><div _ngcontent-rpn-c106="" class="handle-button expand-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpn-c106="" class="highlight-div-header-right"><div _ngcontent-rpn-c106="" class="handle-button ai-button"></div><div _ngcontent-rpn-c106="" class="handle-button line-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpn-c106="" class="handle-button theme-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpn-c106="" class="handle-button copy-button"><div _ngcontent-rpn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildPage</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">childInfo</span>: <span class="hljs-title class_">Info</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`自定义组件 name :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childInfo.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`自定义组件 age :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childInfo.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ParentPage</span> {</li><li>  <span class="hljs-attr">info1</span>: <span class="hljs-title class_">Info</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Tom'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info2</span>: <span class="hljs-title class_">Info</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Tom'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">25</span> };</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">privateBuilder</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`局部LocalBuilder@Builder name :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`局部LocalBuilder@Builder age :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@LocalBuilder</span></li><li>  <span class="hljs-title function_">privateBuilderSecond</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`局部LocalBuilder@Builder name :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`局部LocalBuilder@Builder age :<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.name}</span>  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.age}</span>`</span>) <span class="hljs-comment">// Text1</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">privateBuilder</span>() <span class="hljs-comment">// 调用局部@Builder</span></li><li>      <span class="hljs-title class_">Line</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#000000'</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info2: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.name}</span>  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.age}</span>`</span>) <span class="hljs-comment">// Text2</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">privateBuilderSecond</span>() <span class="hljs-comment">// 调用局部@Builder</span></li><li>      <span class="hljs-title class_">Line</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#000000'</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info1: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.name}</span>  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info1.age}</span>`</span>) <span class="hljs-comment">// Text1</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">ChildPage</span>({ <span class="hljs-attr">childInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span> }) <span class="hljs-comment">// 调用自定义组件</span></li><li>      <span class="hljs-title class_">Line</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#000000'</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info2: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.name}</span>  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info2.age}</span>`</span>) <span class="hljs-comment">// Text2</span></li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>      <span class="hljs-title class_">ChildPage</span>({ <span class="hljs-attr">childInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info2</span> }) <span class="hljs-comment">// 调用自定义组件</span></li><li>      <span class="hljs-title class_">Line</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#000000'</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info1&amp;info2'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info1</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Cat'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> }; <span class="hljs-comment">// Text1不会刷新，原因是info1没被装饰器装饰，无法监听到值的改变。</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info2</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'Cat'</span>, <span class="hljs-attr">age</span>: <span class="hljs-number">18</span> }; <span class="hljs-comment">// Text2会刷新，原因是info2有装饰器装饰，可以监听到值的改变。</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>