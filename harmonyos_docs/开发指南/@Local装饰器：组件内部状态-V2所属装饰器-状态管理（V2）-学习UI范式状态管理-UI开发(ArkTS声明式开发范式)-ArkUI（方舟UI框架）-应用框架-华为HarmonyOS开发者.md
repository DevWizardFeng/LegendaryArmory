<h1 _ngcontent-rnr-c119="" class="doc-title ng-star-inserted" title="@Local装饰器：组件内部状态"> @Local装饰器：组件内部状态 </h1>

<div _ngcontent-rnr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了实现对@ComponentV2装饰的自定义组件中变量变化的观测，开发者可以使用@Local装饰器装饰变量。</p>    <p>在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 12开始，在@ComponentV2装饰的自定义组件中支持使用@Local装饰器。</p>      <p>从API version 12开始，该装饰器支持在元服务中使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@Local表示组件内部的状态，使得自定义组件内部的变量具有观测变化的能力：</p>     <ul>      <li>       <p>被@Local装饰的变量无法从外部初始化，因此必须在组件内部进行初始化。</p></li>      <li>       <p>当被@Local装饰的变量变化时，会刷新使用该变量的组件。</p></li>      <li>       <p>@Local支持观测number、boolean、string、Object、class等基本类型以及<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#装饰array类型变量">Array</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#装饰set类型变量">Set</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#装饰map类型变量">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#装饰date类型变量">Date</a>等内嵌类型。</p></li>      <li>       <p>@Local的观测能力仅限于被装饰的变量本身。当装饰简单类型时，能够观测到对变量的赋值；当装饰对象类型时，仅能观测到对对象整体的赋值；当装饰数组类型时，能观测到数组整体以及数组元素项的变化；当装饰Array、Set、Map、Date等内嵌类型时，可以观测到通过API调用带来的变化。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#观察变化">观察变化</a>。</p></li>      <li>       <p>@Local支持null、undefined以及<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-local#联合类型">联合类型</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="状态管理v1版本state装饰器的局限性">状态管理V1版本@State装饰器的局限性<i class="anchor-icon anchor-icon-link" anchorid="状态管理v1版本state装饰器的局限性" tips="复制节点链接"></i></h2>          <p>状态管理V1使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State装饰器</a>定义组件中的基础状态变量，该状态变量常用来作为组件内部状态，在组件内使用。但由于@State装饰器又能够从外部初始化，因此无法确保@State装饰变量的初始值一定为组件内部定义的值。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ComponentInfo</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, count: <span class="hljs-built_in">number</span>, message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">componentInfo</span>: <span class="hljs-title class_">ComponentInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentInfo</span>(<span class="hljs-string">'Child'</span>, <span class="hljs-number">1</span>, <span class="hljs-string">'Hello World'</span>); <span class="hljs-comment">// 父组件传递的componentInfo会覆盖初始值</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`componentInfo.message is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.componentInfo.message}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">componentInfo</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentInfo</span>(<span class="hljs-string">'Unknown'</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'Error'</span>)})</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上述代码中，可以通过在初始化Child自定义组件时传入新的值来覆盖作为内部状态变量使用的componentInfo。但Child自定义组件并不能感知到componentInfo从外部进行了初始化，这不利于自定义组件内部状态的管理。因此推出@Local装饰器表示组件的内部状态。</p>    </div>    <div class="tiledSection">     <h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">@Local变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">无。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">可装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">Object、class、string、number、boolean、enum等基本类型以及Array、Date、Map、Set等内嵌类型。支持null、undefined以及联合类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">装饰变量的初始值</td>         <td class="cellrowborder" valign="top" width="50%">必须本地初始化，不允许外部传入初始化。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="变量传递">变量传递<i class="anchor-icon anchor-icon-link" anchorid="变量传递" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.1" valign="top" width="50%">传递规则</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">从父组件初始化</td>         <td class="cellrowborder" valign="top" width="50%">@Local装饰的变量仅允许本地初始化，无法从外部传入初始化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">初始化子组件</td>         <td class="cellrowborder" valign="top" width="50%">@Local装饰的变量可以初始化子组件中<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>装饰的变量。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="观察变化">观察变化<i class="anchor-icon anchor-icon-link" anchorid="观察变化" tips="复制节点链接"></i></h2>          <p>使用@Local装饰的变量具有观测变化的能力。当装饰的变量发生变化时，会触发该变量绑定的UI组件刷新。</p>     <ul>      <li>       <p>当装饰的变量类型为boolean、string、number时，可以观察到对变量赋值的变化。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.flag}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Local'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 当@Local装饰简单类型时，能够观测到对变量的赋值</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">' World'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当装饰的变量类型为类对象时，仅可以观察到对类对象整体赋值的变化，无法直接观察到对类成员属性赋值的变化，对类成员属性的观察依赖<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>装饰器。注意，API version 19之前，@Local无法和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed</a>装饰的类实例对象混用。API version 19及以后，支持部分状态管理V1V2混用能力，允许@Local和@Observed同时使用，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage">状态管理V1V2混用文档</a>。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">RawObject</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedObject</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">rawObject</span>: <span class="hljs-title class_">RawObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RawObject</span>(<span class="hljs-string">'rawObject'</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedObject</span>: <span class="hljs-title class_">ObservedObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedObject</span>(<span class="hljs-string">'observedObject'</span>);</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.rawObject.name}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedObject.name}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change object'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 对类对象整体的修改均能观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RawObject</span>(<span class="hljs-string">'new rawObject'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedObject</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedObject</span>(<span class="hljs-string">'new observedObject'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// @Local不具备观察类对象属性的能力，因此对rawObject.name的修改无法观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawObject</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new rawObject name'</span>;</li><li>          <span class="hljs-comment">// 由于ObservedObject的name属性被@Trace装饰，因此对observedObject.name的修改能被观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">observedObject</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'new observedObject name'</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当装饰简单类型数组时，可以观察到数组整体或数组项的变化。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">numArr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>];  <span class="hljs-comment">// 使用@Local装饰一维数组变量</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">dimensionTwo</span>: <span class="hljs-built_in">number</span>[][] = [[<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>],[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]]; <span class="hljs-comment">// 使用@Local装饰二维数组变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numArr[<span class="hljs-number">0</span>]}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numArr[<span class="hljs-number">1</span>]}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numArr[<span class="hljs-number">2</span>]}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dimensionTwo[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dimensionTwo[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change array item'</span>) <span class="hljs-comment">// 按钮1：修改数组中的特定元素</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">numArr</span>[<span class="hljs-number">0</span>]++;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">numArr</span>[<span class="hljs-number">1</span>] += <span class="hljs-number">2</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensionTwo</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-number">0</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensionTwo</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>] = <span class="hljs-number">0</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change whole array'</span>) <span class="hljs-comment">// 按钮2：替换整个数组</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">numArr</span> = [<span class="hljs-number">5</span>,<span class="hljs-number">4</span>,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>,<span class="hljs-number">1</span>];</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dimensionTwo</span> = [[<span class="hljs-number">7</span>,<span class="hljs-number">8</span>,<span class="hljs-number">9</span>],[<span class="hljs-number">0</span>,<span class="hljs-number">1</span>,<span class="hljs-number">2</span>]];</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当装饰的变量是嵌套类或对象数组时，@Local无法观察深层对象属性的变化。对深层对象属性的观测依赖@ObservedV2与@Trace装饰器。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Region</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">x</span> = x;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">y</span> = y;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">region</span>: <span class="hljs-title class_">Region</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">region</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Region</span>(x, y);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">infoArr</span>: <span class="hljs-title class_">Info</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Ocean'</span>, <span class="hljs-number">28</span>, <span class="hljs-number">120</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Mountain'</span>, <span class="hljs-number">26</span>, <span class="hljs-number">20</span>)];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">originInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Origin'</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">infoArr</span>, <span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${info.name}</span>`</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`region: <span class="hljs-subst">${info.region.x}</span>-<span class="hljs-subst">${info.region.y}</span>`</span>)</li><li>        }</li><li>      })</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Origin name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.originInfo.name}</span>`</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Origin region: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.originInfo.region.x}</span>-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.originInfo.region.y}</span>`</span>)</li><li>      }</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change infoArr item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 由于属性name被@Trace装饰，所以能够观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoArr</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'Win'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change originInfo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 由于变量originInfo被@Local装饰，所以能够观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">originInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Origin'</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change originInfo region'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 由于属性x、y被@Trace装饰，所以能够观察到</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">originInfo</span>.<span class="hljs-property">region</span>.<span class="hljs-property">x</span> = <span class="hljs-number">25</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">originInfo</span>.<span class="hljs-property">region</span>.<span class="hljs-property">y</span> = <span class="hljs-number">25</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当装饰内置类型时，可以观察到变量整体赋值及API调用带来的变化。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.8.3.5.2.1.3.1.1" valign="top" width="50%">类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.8.3.5.2.1.3.1.2" valign="top" width="50%">可观测变化的API</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">Array</td>           <td class="cellrowborder" valign="top" width="50%">push, pop, shift, unshift, splice, copyWithin, fill, reverse, sort</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">Date</td>           <td class="cellrowborder" valign="top" width="50%">setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">Map</td>           <td class="cellrowborder" valign="top" width="50%">set, clear, delete</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">Set</td>           <td class="cellrowborder" valign="top" width="50%">add, clear, delete</td>          </tr>                 </tbody></table></div>       </div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <p>@Local装饰器存在以下使用限制：</p>     <ul>      <li>       <p>@Local装饰器只能在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>装饰的自定义组件中使用。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>; <span class="hljs-comment">// 正确用法</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TestComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>; <span class="hljs-comment">// 错误用法，编译时报错</span></li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Local装饰的变量表示组件内部状态，不允许从外部传入初始化。</p>       <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello'</span> }) <span class="hljs-comment">// 错误用法，编译时报错</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="local与state对比">@Local与@State对比<i class="anchor-icon anchor-icon-link" anchorid="local与state对比" tips="复制节点链接"></i></h2>          <p>@Local与@State的用法、功能对比如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.1" valign="top" width="33.33333333333333%"></th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.2" valign="top" width="33.33333333333333%">@State</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.4.1.3" valign="top" width="33.33333333333333%">@Local</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">参数</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">无。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">无。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">从父组件初始化</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">可选。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不允许外部初始化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">观察能力</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能观测变量本身以及一层的成员属性，无法深度观测。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能观测变量本身，深度观测依赖@Trace装饰器。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">数据传递</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">可以作为数据源和子组件中状态变量同步。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">可以作为数据源和子组件中状态变量同步。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="观测对象整体变化" class="firsth2">观测对象整体变化<i class="anchor-icon anchor-icon-link" anchorid="观测对象整体变化" tips="复制节点链接"></i></h3>          <p>被@ObservedV2与@Trace装饰的类对象实例，具有深度观测对象属性的能力。但当对对象整体赋值时，UI却无法刷新。使用@Local装饰对象，可以达到观测对象本身变化的效果。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Tom'</span>, <span class="hljs-number">25</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">localInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Tom'</span>, <span class="hljs-number">25</span>);</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.name}</span>-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.age}</span>`</span>) <span class="hljs-comment">// Text1</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`localInfo: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.localInfo.name}</span>-<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.localInfo.age}</span>`</span>) <span class="hljs-comment">// Text2</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info&amp;localInfo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Lucy'</span>, <span class="hljs-number">18</span>); <span class="hljs-comment">// Text1不会刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">localInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Lucy'</span>, <span class="hljs-number">18</span>); <span class="hljs-comment">// Text2会刷新</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰array类型变量">装饰Array类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰array类型变量" tips="复制节点链接"></i></h3>          <p>当装饰的对象是Array时，可以观察到Array整体的赋值，同时可以通过调用Array的接口push, pop, shift, unshift, splice, copyWithin, fill, reverse, sort更新Array中的数据。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init array'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = [<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>];</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">push</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'reverse'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">reverse</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'fill'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">fill</span>(<span class="hljs-number">6</span>);</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰date类型变量">装饰Date类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰date类型变量" tips="复制节点链接"></i></h3>          <p>当装饰的对象是Date时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds更新Date的属性。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">DatePickerExample</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">selectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2021-08-08'</span>); <span class="hljs-comment">// 使用@Local装饰Date类型变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set selectedDate to 2023-07-08'</span>) <span class="hljs-comment">// 按钮1：通过创建对象更新日期</span></li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-07-08'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the year by 1'</span>) <span class="hljs-comment">// 按钮2：直接修改Date年份加1</span></li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getFullYear</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the month by 1'</span>) <span class="hljs-comment">// 按钮3：直接修改Date月份加1</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setMonth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the day by 1'</span>) <span class="hljs-comment">// 按钮4：直接修改Date天数加1</span></li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span></li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰map类型变量">装饰Map类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰map类型变量" tips="复制节点链接"></i></h3>          <p>当装饰的对象是Map时，可以观察到对Map整体的赋值，同时可以通过调用Map的接口set, clear, delete更新Map中的数据。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MapSample</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]); <span class="hljs-comment">// 使用@Local装饰Map类型变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> { <span class="hljs-comment">// 遍历Map的键值对并渲染UI</span></li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init map'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮1：重置Map为初始状态</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮2：添加新键值对(4, 'd')</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮3：清空Map</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace key 0'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮4：更新/添加键值为0的键值对</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete key 0'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮5：删除键值为0的键值对</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰set类型变量">装饰Set类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰set类型变量" tips="复制节点链接"></i></h3>          <p>当装饰的对象是Set时，可以观察到对Set整体的赋值，同时可以通过调用Set的接口add, clear, delete更新Set中的数据。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">SetSample</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> { <span class="hljs-comment">// 遍历Set的元素并渲染UI</span></li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init set'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮1：更新Set为初始状态</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮2：添加新元素5</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮3：清空Set</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-comment">// 按钮4：删除元素0</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="联合类型">联合类型<i class="anchor-icon anchor-icon-link" anchorid="联合类型" tips="复制节点链接"></i></h3>          <p>@Local支持null、undefined以及联合类型。在下面的示例中，count类型为number | undefined，点击改变count的类型，UI会随之刷新。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-number">10</span>; <span class="hljs-comment">// 使用@Local装饰联合类型变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>)`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to undefined'</span>) <span class="hljs-comment">// 按钮1：将count设置为undefined</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-literal">undefined</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to number'</span>) <span class="hljs-comment">// 按钮2：将count更新为数字10</span></li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">10</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="复杂类型常量重复赋值给状态变量触发刷新" class="firsth2">复杂类型常量重复赋值给状态变量触发刷新<i class="anchor-icon anchor-icon-link" anchorid="复杂类型常量重复赋值给状态变量触发刷新" tips="复制节点链接"></i></h3>          <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">list</span>: <span class="hljs-built_in">string</span>[][] = [[<span class="hljs-string">'a'</span>], [<span class="hljs-string">'b'</span>], [<span class="hljs-string">'c'</span>]];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">dataObjFromList</span>: <span class="hljs-built_in">string</span>[] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>];</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'dataObjFromList'</span>)</li><li>  <span class="hljs-title function_">onStrChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'dataObjFromList has changed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to self'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 新值和本地初始化的值相同</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataObjFromList</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>];</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以上示例每次点击Button('change to self')，把相同的Array类型常量赋值给一个Array类型的状态变量，都会触发刷新。原因是在状态管理V2中，会给使用状态变量装饰器如@Trace、@Local装饰的Date、Map、Set、Array添加一层代理用于观测API调用产生的变化。</p>     <p>当再次赋值list[0]时，dataObjFromList已经是Proxy类型，而list[0]是Array类型。由于类型不相等，会触发赋值和刷新。</p>     <p>为了避免这种不必要的赋值和刷新，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-gettarget">UIUtils.getTarget()</a>获取原始对象提前进行新旧值的判断，当两者相同时不执行赋值。</p>     <p>使用UIUtils.getTarget()方法示例。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">list</span>: <span class="hljs-built_in">string</span>[][] = [[<span class="hljs-string">'a'</span>], [<span class="hljs-string">'b'</span>], [<span class="hljs-string">'c'</span>]];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">dataObjFromList</span>: <span class="hljs-built_in">string</span>[] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>];</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'dataObjFromList'</span>)</li><li>  <span class="hljs-title function_">onStrChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'dataObjFromList has changed'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change to self'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 获取原始对象来和新值做对比</span></li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">getTarget</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataObjFromList</span>) !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>]) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataObjFromList</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">list</span>[<span class="hljs-number">0</span>];</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在状态管理v2中使用animateto动画效果异常">在状态管理V2中使用animateTo动画效果异常<i class="anchor-icon anchor-icon-link" anchorid="在状态管理v2中使用animateto动画效果异常" tips="复制节点链接"></i></h3>          <p>在下面的场景中，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#animateto" target="_blank">animateTo</a>暂不支持直接在状态管理V2中使用。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">w</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 宽度</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">h</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 高度</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change size'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 在执行动画前，存在额外的修改</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">100</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">100</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello World'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>            <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span></li><li>          }, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">200</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">200</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello ArkUI'</span>;</li><li>          })</li><li>        })</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff17a98d'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上述代码中，开发者预期的动画效果是：绿色矩形从长宽100变为200，字符串从Hello World变为Hello ArkUI。但由于当前animateTo与V2的刷新机制不兼容，执行动画前的额外修改未生效，实际显示的动画效果是：绿色矩形从长宽50变为200，字符串从Hello变为Hello ArkUI。</p>     <p><span><img originheight="314" originwidth="275" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114958.69698846392316256600069530595169:50001231000000:2800:E45A986E4DF96D29D0FE6A283C521F1F23BB05125C8C751525220EDE0E2BDEA7.gif" class="notEnlarge" width="275" height="314"></span></p>     <p>可以通过下面的方法暂时获得预期的显示效果。</p>     <div _ngcontent-rnr-c106="" class="highlight-div"><div _ngcontent-rnr-c106="" class="highlight-div-header"><div _ngcontent-rnr-c106="" class="highlight-div-header-left"><div _ngcontent-rnr-c106="" class="handle-button expand-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rnr-c106="" class="highlight-div-header-right"><div _ngcontent-rnr-c106="" class="handle-button ai-button"></div><div _ngcontent-rnr-c106="" class="handle-button line-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rnr-c106="" class="handle-button theme-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rnr-c106="" class="handle-button copy-button"><div _ngcontent-rnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">w</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 宽度</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">h</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 高度</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change size'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 在执行动画前，存在额外的修改</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">100</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">100</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello World'</span>;</li><li>          <span class="hljs-title function_">animateToImmediately</span>({</li><li>            <span class="hljs-attr">duration</span>: <span class="hljs-number">0</span></li><li>          }, <span class="hljs-function">() =&gt;</span> {</li><li>          })</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">animateTo</span>({</li><li>            <span class="hljs-attr">duration</span>: <span class="hljs-number">1000</span></li><li>          }, <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span> = <span class="hljs-number">200</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span> = <span class="hljs-number">200</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello ArkUI'</span>;</li><li>          })</li><li>        })</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ff17a98d'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">w</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">h</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>原理为使用一个duration为0的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-explicit-animatetoimmediately" target="_blank">animateToImmediately</a>将额外的修改先刷新，再执行原来的动画达成预期的效果。</p>     <p><span><img originheight="314" originwidth="275" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114958.82027261400765327905882517561143:50001231000000:2800:28BC2D89028FA44A46F6F6099F2EC0F23E3B7F7BBDC8F60E0109F9617E7C98C8.gif" class="notEnlarge" width="275" height="314"></span></p>    </div>   </div>   <div></div></div>