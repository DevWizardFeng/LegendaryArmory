<h1 _ngcontent-ecu-c119="" class="doc-title ng-star-inserted" title="@Monitor装饰器：状态变量修改监听"> @Monitor装饰器：状态变量修改监听 </h1>

<div _ngcontent-ecu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了增强状态管理框架对状态变量变化的监听能力，开发者可以使用@Monitor装饰器对状态变量进行监听。</p>    <p>@Monitor提供了对V2状态变量的监听。在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2和@Trace</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>@Monitor装饰器从API version 12开始支持。</p>      <p>从API version 12开始，该装饰器支持在元服务中使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@Monitor装饰器用于监听状态变量修改，使得状态变量具有深度监听的能力：</p>     <ul>      <li>       <p>@Monitor装饰器支持在@ComponentV2装饰的自定义组件中使用，未被状态变量装饰器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Provider</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Consumer</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-computed">@Computed</a>装饰的变量无法被@Monitor监听到变化。</p></li>      <li>       <p>@Monitor装饰器支持在类中与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2、@Trace</a>配合使用，不允许在未被@ObservedV2装饰的类中使用@Monitor装饰器。未被@Trace装饰的属性无法被@Monitor监听到变化。</p></li>      <li>       <p>当观测的属性变化时，@Monitor装饰器定义的回调方法将被调用。判断属性是否变化使用的是严格相等（===），当严格相等判断的结果是false（即不相等）的情况下，就会触发@Monitor的回调。当在一次事件中多次改变同一个属性时，将会使用初始值和最终值进行比较以判断是否变化。</p></li>      <li>       <p>单个@Monitor装饰器能够同时监听多个属性的变化，当这些属性在一次事件中共同变化时，只会触发一次@Monitor的回调方法。</p></li>      <li>       <p>@Monitor装饰器具有深度监听的能力，能够监听嵌套类、多维数组、对象数组中指定项的变化。对于嵌套类、对象数组中成员属性变化的监听要求该类被@ObservedV2装饰且该属性被@Trace装饰。</p></li>      <li>       <p>当@Monitor监听整个数组时，更改数组的某一项不会被监听到。无法监听内置类型（Array、Map、Date、Set）的API调用引起的变化。</p></li>      <li>       <p>在继承类场景中，可以在父子组件中对同一个属性分别定义@Monitor进行监听，当属性变化时，父子组件中定义的@Monitor回调均会被调用。</p></li>      <li>       <p>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch">@Watch装饰器</a>类似，开发者需要自己定义回调函数，区别在于@Watch装饰器将函数名作为参数，而@Monitor直接装饰回调函数。@Monitor与@Watch的对比可以查看<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-monitor#monitor与watch对比">@Monitor与@Watch的对比</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="状态管理v1版本watch装饰器的局限性">状态管理V1版本@Watch装饰器的局限性<i class="anchor-icon anchor-icon-link" anchorid="状态管理v1版本watch装饰器的局限性" tips="复制节点链接"></i></h2>          <p>现有状态管理V1版本无法实现对对象、数组中某一单个属性或数组项变化的监听，且无法获取变化之前的值。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onInfoChange'</span>) <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onNumArrChange'</span>) <span class="hljs-attr">numArr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>];</li><li>
</li><li>  <span class="hljs-title function_">onInfoChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`info after change name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.name}</span>, age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.age}</span> `</span>);</li><li>  }</li><li>  <span class="hljs-title function_">onNumArrChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`numArr after change <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numArr}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info name'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info age'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">30</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change numArr[2]'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">numArr</span>[<span class="hljs-number">2</span>] = <span class="hljs-number">5</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change numArr[3]'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">numArr</span>[<span class="hljs-number">3</span>] = <span class="hljs-number">6</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上述代码中，点击"change info name"更改info中的name属性或点击"change info age"更改age时，均会触发info注册的@Watch回调。点击"change numArr[2]"更改numArr中的第3个元素或点击"change numArr[3]"更改第4个元素时，均会触发numArr注册的@Watch回调。在这两个回调中，由于无法获取数据更改前的值，在业务逻辑更加复杂的场景下，无法准确知道是哪一个属性或元素发生了改变从而触发了@Watch事件，这不便于开发者对变量的更改进行准确监听。因此推出@Monitor装饰器实现对对象、数组中某一单个属性或数组项变化的监听，并且能够获取到变化之前的值。</p>    </div>    <div class="tiledSection">     <h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">@Monitor属性装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">字符串类型的对象属性名。可同时监听多个对象属性，每个属性以逗号隔开，例如@Monitor('prop1', 'prop2')。可监听深层的属性变化，如多维数组中的某一个元素，嵌套对象或对象数组中的某一个属性。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-monitor#监听变化">监听变化</a>。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">装饰对象</td>         <td class="cellrowborder" valign="top" width="50%">@Monitor装饰成员方法。当监听的属性发生变化时，会触发该回调方法。该回调方法以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-state-management-watch-monitor#imonitor12" target="_blank">IMonitor类型</a>的变量作为参数，开发者可以从该参数中获取变化前后的相关信息。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>IMonitor类型和IMonitorValue&lt;T&gt;类型的接口说明参考API文档：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-state-management-watch-monitor" target="_blank">状态变量变化监听</a>。</p>    </div>    <div class="tiledSection">     <h2 id="监听变化">监听变化<i class="anchor-icon anchor-icon-link" anchorid="监听变化" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="在componentv2装饰的自定义组件中使用monitor" class="firsth2">在@ComponentV2装饰的自定义组件中使用@Monitor<i class="anchor-icon anchor-icon-link" anchorid="在componentv2装饰的自定义组件中使用monitor" tips="复制节点链接"></i></h3>          <p>使用@Monitor监听的状态变量发生变化时，会触发@Monitor的回调方法。</p>     <ul>      <li>       <p>@Monitor监听的变量需要被@Local、@Param、@Provider、@Consumer、@Computed装饰，未被状态变量装饰器装饰的变量在变化时无法被监听。@Monitor可以同时监听多个状态变量，这些变量名之间用","隔开。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'message'</span>, <span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onStrChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${path}</span> changed from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change string'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Monitor监听的状态变量为类对象时，仅能监听对象整体的变化。监听类属性的变化需要类属性被@Trace装饰。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Tom'</span>, <span class="hljs-number">25</span>);</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info'</span>)</li><li>  <span class="hljs-title function_">infoChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`info change`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.name'</span>)</li><li>  <span class="hljs-title function_">infoPropertyChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`info name change`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.name}</span>, age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.age}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Lucy'</span>, <span class="hljs-number">18</span>); <span class="hljs-comment">// 能够监听到</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change info.name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>; <span class="hljs-comment">// 监听不到</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="在observedv2装饰的类中使用monitor">在@ObservedV2装饰的类中使用@Monitor<i class="anchor-icon anchor-icon-link" anchorid="在observedv2装饰的类中使用monitor" tips="复制节点链接"></i></h3>          <p>使用@Monitor监听的属性发生变化时，会触发@Monitor的回调方法。</p>     <ul>      <li>       <p>@Monitor监听的对象属性需要被@Trace装饰，未被@Trace装饰的属性的变化无法被监听。@Monitor可以同时监听多个属性，这些属性之间用","隔开。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">region</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'North'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">job</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Teacher'</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-comment">// name被@Trace装饰，能够监听变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onNameChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`name change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// age未被@Trace装饰，不能监听变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'age'</span>)</li><li>  <span class="hljs-title function_">onAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// region与job均被@Trace装饰，能够监听变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'region'</span>, <span class="hljs-string">'job'</span>)</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>; <span class="hljs-comment">// 能够触发onNameChange方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">26</span>; <span class="hljs-comment">// 不能够触发onAgeChange方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change region'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">region</span> = <span class="hljs-string">'South'</span>; <span class="hljs-comment">// 能够触发onChange方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change job'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">job</span> = <span class="hljs-string">'Driver'</span>; <span class="hljs-comment">// 能够触发onChange方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Monitor可以监听深层属性的变化，该深层属性需要被@Trace装饰。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Inner</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Outer</span> {</li><li>  <span class="hljs-attr">inner</span>: <span class="hljs-title class_">Inner</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Inner</span>();</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'inner.num'</span>)</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`inner.num change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">outer</span>: <span class="hljs-title class_">Outer</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Outer</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change num'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">outer</span>.<span class="hljs-property">inner</span>.<span class="hljs-property">num</span> = <span class="hljs-number">100</span>; <span class="hljs-comment">// 能够触发onChange方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在继承类场景下，可以在继承链中对同一个属性进行多次监听。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Base</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-comment">// 基类监听name属性</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onBaseNameChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Base Class name change`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Derived</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Base</span> {</li><li>  <span class="hljs-comment">// 继承类监听name属性</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onDerivedNameChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Derived Class name change`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>(name);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">derived</span>: <span class="hljs-title class_">Derived</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Derived</span>(<span class="hljs-string">'AAA'</span>);</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">derived</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'BBB'</span>; <span class="hljs-comment">// 能够先后触发onBaseNameChange、onDerivedNameChange方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="通用监听能力">通用监听能力<i class="anchor-icon anchor-icon-link" anchorid="通用监听能力" tips="复制节点链接"></i></h3>          <p>@Monitor还有一些通用的监听能力。</p>     <ul>      <li>       <p>@Monitor支持对数组中的项进行监听，包括多维数组，对象数组。@Monitor无法监听内置类型（Array、Map、Date、Set）的API调用引起的变化。当@Monitor监听数组整体时，只能观测到数组整体的赋值。可以通过监听数组的长度变化来判断数组是否有插入、删除等变化。当前仅支持使用"."的方式表达深层属性、数组项的监听。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  </li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrMonitor</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">dimensionTwo</span>: <span class="hljs-built_in">number</span>[][] = [[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>,<span class="hljs-number">3</span>,<span class="hljs-number">3</span>]];</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">dimensionThree</span>: <span class="hljs-built_in">number</span>[][][] = [[[<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>]],[[<span class="hljs-number">4</span>],[<span class="hljs-number">5</span>],[<span class="hljs-number">6</span>]],[[<span class="hljs-number">7</span>],[<span class="hljs-number">8</span>],[<span class="hljs-number">9</span>]]];</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">infoArr</span>: <span class="hljs-title class_">Info</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Jack'</span>, <span class="hljs-number">24</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Lucy'</span>, <span class="hljs-number">18</span>)];</li><li>  <span class="hljs-comment">// dimensionTwo为二维简单类型数组，且被@Trace装饰，能够观测里面的元素变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'dimensionTwo.0.0'</span>, <span class="hljs-string">'dimensionTwo.1.1'</span>)</li><li>  <span class="hljs-title function_">onDimensionTwoChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`dimensionTwo path: <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>  <span class="hljs-comment">// dimensionThree为三维简单类型数组，且被@Trace装饰，能够观测里面的元素变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'dimensionThree.0.0.0'</span>, <span class="hljs-string">'dimensionThree.1.1.0'</span>)</li><li>  <span class="hljs-title function_">onDimensionThreeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`dimensionThree path: <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>  <span class="hljs-comment">// Info类中属性name、age均被@Trace装饰，能够监听到变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'infoArr.0.name'</span>, <span class="hljs-string">'infoArr.1.age'</span>)</li><li>  <span class="hljs-title function_">onInfoArrPropertyChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`infoArr path:<span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>  <span class="hljs-comment">// infoArr被@Trace装饰，能够监听到infoArr整体赋值的变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'infoArr'</span>)</li><li>  <span class="hljs-title function_">onInfoArrChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`infoArr whole change`</span>);</li><li>  }</li><li>  <span class="hljs-comment">// 能够监听到infoArr的长度变化</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'infoArr.length'</span>)</li><li>  <span class="hljs-title function_">onInfoArrLengthChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`infoArr length change`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">arrMonitor</span>: <span class="hljs-title class_">ArrMonitor</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrMonitor</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change dimensionTwo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 能够触发onDimensionTwoChange方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">dimensionTwo</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]++;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">dimensionTwo</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>]++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change dimensionThree'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 能够触发onDimensionThreeChange方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">dimensionThree</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>][<span class="hljs-number">0</span>]++;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">dimensionThree</span>[<span class="hljs-number">1</span>][<span class="hljs-number">1</span>][<span class="hljs-number">0</span>]++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change info property'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 能够触发onInfoArrPropertyChange方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">infoArr</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'Tom'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">infoArr</span>[<span class="hljs-number">1</span>].<span class="hljs-property">age</span> = <span class="hljs-number">19</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change whole infoArr'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 能够触发onInfoArrChange、onInfoArrPropertyChange、onInfoArrLengthChange方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">infoArr</span> = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Cindy'</span>, <span class="hljs-number">8</span>)];</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Push new info to infoArr'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 能够触发onInfoArrPropertyChange、onInfoArrLengthChange方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrMonitor</span>.<span class="hljs-property">infoArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'David'</span>, <span class="hljs-number">50</span>));</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>对象整体改变，但监听的属性不变时，不触发@Monitor回调。</p>       <p>下面的示例按照Step1-Step2-Step3的顺序点击，表现为代码注释中的行为。</p>       <p>如果只点击Step2或Step3，改变name、age的值，此时会触发onNameChange和onAgeChange方法。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">Person</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'person.name'</span>)</li><li>  <span class="hljs-title function_">onNameChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`name change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'person.age'</span>)</li><li>  <span class="hljs-title function_">onAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(name, age);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Tom'</span>, <span class="hljs-number">25</span>);</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Step1: Only change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Jack'</span>, <span class="hljs-number">25</span>);  <span class="hljs-comment">// 能够触发onNameChange方法，不触发onAgeChange方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Step2: Only change age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Jack'</span>, <span class="hljs-number">18</span>);  <span class="hljs-comment">// 能够触发onAgeChange方法，不触发onNameChange方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Step3: Change name and age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Lucy'</span>, <span class="hljs-number">19</span>);  <span class="hljs-comment">// 能够触发onNameChange、onAgeChange方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在一次事件中多次改变被@Monitor监听的属性，以最后一次修改为准。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Frequency</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`count change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">frequency</span>: <span class="hljs-title class_">Frequency</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Frequency</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count to 1000'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">1000</span>; i++) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">frequency</span>.<span class="hljs-property">count</span> = i;</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count to 0 then to 1000'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">999</span>; i &gt;= <span class="hljs-number">0</span>; i--) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">frequency</span>.<span class="hljs-property">count</span> = i;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">frequency</span>.<span class="hljs-property">count</span> = <span class="hljs-number">1000</span>; <span class="hljs-comment">// 最终不触发onCountChange方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>     <p>在点击按钮"change count to 1000"后，会触发一次onCountChange方法，并输出日志"count change from 0 to 1000"。在点击按钮"change count to 0 then to 1000"后，由于事件前后属性count的值并没有改变，都为1000，所以不触发onCountChange方法。</p>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <p>使用@Monitor需要注意如下限制条件：</p>     <ul>      <li>       <p>不建议在一个类中对同一个属性进行多次@Monitor的监听。当一个类中存在对一个属性的多次监听时，只有最后一个定义的监听方法会生效。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onNameChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onNameChange`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>)</li><li>  <span class="hljs-title function_">onNameChangeDuplicate</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onNameChangeDuplicate`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>; <span class="hljs-comment">// 仅会触发onNameChangeDuplicate方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当@Monitor传入多个路径参数时，以参数的全拼接结果判断是否重复监听。全拼接时会在参数间加空格，以区分不同参数。例如，'ab', 'c'的全拼接结果为'ab c'，'a', 'bc'的全拼接结果为'a bc'，二者全拼接不相等。以下示例中，Monitor 1、Monitor 2与Monitor 3都监听了name属性的变化。由于Monitor 2与Monitor 3的入参全拼接相等（都为'name position'），因此Monitor 2不生效，仅Monitor 3生效。当name属性变化时，将同时触发onNameAgeChange与onNamePositionChangeDuplicate方法。但请注意，Monitor 2与Monitor 3的写法仍然被视作在一个类中对同一个属性进行多次@Monitor的监听，这是不建议的。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Tom'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">position</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'North'</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'age'</span>) <span class="hljs-comment">// Monitor 1</span></li><li>  <span class="hljs-title function_">onNameAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onNameAgeChange path: <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'position'</span>) <span class="hljs-comment">// Monitor 2</span></li><li>  <span class="hljs-title function_">onNamePositionChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onNamePositionChange path: <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>  <span class="hljs-comment">// 重复监听name、position，仅最后定义的生效</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'name'</span>, <span class="hljs-string">'position'</span>) <span class="hljs-comment">// Monitor3</span></li><li>  <span class="hljs-title function_">onNamePositionChangeDuplicate</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onNamePositionChangeDuplicate path: <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>; <span class="hljs-comment">// 同时触发onNameAgeChange与onNamePositionChangeDuplicate方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Monitor的参数需要为监听属性名的字符串，仅可以使用字符串字面量、const常量、enum枚举值作为参数。如果使用变量作为参数，仅会监听@Monitor初始化时，变量值所对应的属性。当更改变量时，@Monitor无法实时改变监听的属性，即@Monitor监听的目标属性从初始化时便已经确定，无法动态更改。不建议开发者使用变量作为@Monitor的参数进行初始化。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">t2</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'t2'</span>; <span class="hljs-comment">// const常量</span></li><li><span class="hljs-keyword">enum</span> <span class="hljs-variable constant_">ENUM</span> {</li><li>  <span class="hljs-variable constant_">T3</span> = <span class="hljs-string">'t3'</span> <span class="hljs-comment">// enum枚举值</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">t4</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'t4'</span>; <span class="hljs-comment">// 变量</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">t1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">t2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">t3</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">t4</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">t5</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'t1'</span>) <span class="hljs-comment">// 字符串字面量</span></li><li>  <span class="hljs-title function_">onT1Change</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`t1 change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(t2)</li><li>  <span class="hljs-title function_">onT2Change</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`t2 change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-variable constant_">ENUM</span>.<span class="hljs-property">T3</span>)</li><li>  <span class="hljs-title function_">onT3Change</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`t3 change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(t4)</li><li>  <span class="hljs-title function_">onT4Change</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`t4 change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t1</span>++; <span class="hljs-comment">// 能够触发onT1Change方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t2'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t2</span>++; <span class="hljs-comment">// 能够触发onT2Change方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t3'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t3</span>++; <span class="hljs-comment">// 能够触发onT3Change方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t4'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t4</span>++; <span class="hljs-comment">// 能够触发onT4Change方法</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change var t4 to t5'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          t4 = <span class="hljs-string">'t5'</span>; <span class="hljs-comment">// 更改变量值为't5'</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t5'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t5</span>++; <span class="hljs-comment">// onT4Change仍监听t4，不会触发</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change t4 again'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">t4</span>++; <span class="hljs-comment">// 能够触发onT4Change方法</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>建议开发者避免在@Monitor中再次更改被监听的属性，这会导致无限循环。</p>       <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'count'</span>)</li><li>  <span class="hljs-title function_">onCountChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++; <span class="hljs-comment">// 应避免这种写法，会导致无限循环</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="monitor与watch对比">@Monitor与@Watch对比<i class="anchor-icon anchor-icon-link" anchorid="monitor与watch对比" tips="复制节点链接"></i></h2>          <p>@Monitor与@Watch的用法、功能对比如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.3.1.4.1.1" valign="top" width="33.33333333333333%"></th>         <th align="left" class="cellrowborder" id="mcps1.3.13.3.1.4.1.2" valign="top" width="33.33333333333333%">@Watch</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.3.1.4.1.3" valign="top" width="33.33333333333333%">@Monitor</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">参数</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">回调方法名。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听状态变量名、属性名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听目标数</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">只能监听单个状态变量。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能同时监听多个状态变量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听能力</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">跟随状态变量观察能力（一层）。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">跟随状态变量观察能力（深层）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能否获取变化前的值</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不能获取变化前的值。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能获取变化前的值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听条件</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听对象为状态变量。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听对象为状态变量或为@Trace装饰的类成员属性。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用限制</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">仅能在@Component装饰的自定义组件中使用。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">能在@ComponentV2装饰的自定义组件中使用，也能在@ObservedV2装饰的类中使用。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="监听深层属性变化" class="firsth2">监听深层属性变化<i class="anchor-icon anchor-icon-link" anchorid="监听深层属性变化" tips="复制节点链接"></i></h3>          <p>@Monitor可以监听深层属性的变化，并能够根据更改前后的值做分类处理。</p>     <p>下面的示例中监听了属性value的变化，并根据变化的幅度改变Text组件显示的样式。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>;</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">UIStyle</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">fontSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">45</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.value'</span>)</li><li>  <span class="hljs-title function_">onValueChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">lastValue</span>: <span class="hljs-built_in">number</span> = monitor.<span class="hljs-title function_">value</span>()?.<span class="hljs-property">before</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">curValue</span>: <span class="hljs-built_in">number</span> = monitor.<span class="hljs-title function_">value</span>()?.<span class="hljs-property">now</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">number</span>;</li><li>    <span class="hljs-keyword">if</span> (lastValue != <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">diffPercent</span>: <span class="hljs-built_in">number</span> = (curValue - lastValue) / lastValue;</li><li>      <span class="hljs-keyword">if</span> (diffPercent &gt; <span class="hljs-number">0.1</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-number">50</span>;</li><li>      } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (diffPercent &lt; -<span class="hljs-number">0.1</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-number">40</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> = <span class="hljs-number">45</span>;</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">textStyle</span>: <span class="hljs-title class_">UIStyle</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">UIStyle</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Important Value: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textStyle.info.value}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textStyle</span>.<span class="hljs-property">color</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textStyle</span>.<span class="hljs-property">fontSize</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change!'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">textStyle</span>.<span class="hljs-property">info</span>.<span class="hljs-property">value</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>) + <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="自定义组件中monitor对变量监听的生效及失效时间" class="firsth2">自定义组件中@Monitor对变量监听的生效及失效时间<i class="anchor-icon anchor-icon-link" anchorid="自定义组件中monitor对变量监听的生效及失效时间" tips="复制节点链接"></i></h3>          <p>当@Monitor定义在@ComponentV2装饰的自定义组件中时，@Monitor会在状态变量初始化完成之后生效，并在组件销毁时失效。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'not initialized'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'in constructor message change to initialized'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'initialized'</span>;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.message'</span>)</li><li>  <span class="hljs-title function_">onMessageChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Child message change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Child aboutToAppear'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Child aboutToDisappear'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Child aboutToDisappear'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child'</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message in Child'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Child click to change Message'</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>
</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">flag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.message'</span>)</li><li>  <span class="hljs-title function_">onMessageChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Index message change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'show/hide Child'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message in Index'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Index click to change Message'</span>;</li><li>        })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">flag</span>) {</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的例子中，可以通过创建和销毁Child组件来观察定义在自定义组件中的@Monitor的生效和失效时机。推荐按如下顺序进行操作：</p>     <ul>      <li>当Index组件创建Info类实例时，日志输出in constructor message change to initialized。此时Index组件的@Monitor还未初始化成功，因此不会监听到message的变化。</li>      <li>当Index组件创建完成，页面加载完成后，点击按钮“change message in Index”，此时Index组件中的@Monitor能够监听到变化，日志输出Index message change from initialized to Index click to change Message。</li>      <li>点击按钮“show/hide Child”，创建Child组件，在Child组件初始化@Param装饰的变量以及@Monitor之后，调用Child组件的aboutToAppear回调，改变message。此时Index组件与Child组件的@Monitor均能监听到变化，日志输出Index message change from Index click to change Message to Child aboutToAppear以及Child message change from Index click to change Message to Child aboutToAppear。</li>      <li>点击按钮“change message in Child”，改变message。此时Index组件与Child组件的@Monitor均能监听到变化，日志输出Index message change from Child aboutToAppear to Child click to change Message以及Child message change from Child aboutToAppear to Child click to change Message。</li>      <li>点击按钮”show/hide Child“，销毁Child组件，调用Child组件的aboutToDisappear回调，改变message。此时Index组件与Child组件的@Monitor均能监听到变化，日志输出Child aboutToDisappear，Index message change from Child click to change Message to Child aboutToDisappear以及Child message change from Child click to change Message to Child aboutToDisappear。</li>      <li>点击按钮“change message in Index”，改变message。此时Child组件已销毁，其注册的@Monitor监听也被解注册，仅有Index组件的@Monitor能够监听到变化，日志输出Index message change from Child aboutToDisappear to Index click to change Message。</li>     </ul>     <p>这表明Child组件中定义的@Monitor监听随着Child组件的创建初始化生效，随着Child组件的销毁失效。</p>    </div>    <div class="tiledSection">     <h3 id="类中monitor对变量监听的生效及失效时间">类中@Monitor对变量监听的生效及失效时间<i class="anchor-icon anchor-icon-link" anchorid="类中monitor对变量监听的生效及失效时间" tips="复制节点链接"></i></h3>          <p>当@Monitor定义在@ObservedV2装饰的类中时，@Monitor会在类的实例创建完成后生效，在类的实例销毁时失效。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'not initialized'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'initialized'</span>;</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'message'</span>)</li><li>  <span class="hljs-title function_">onMessageChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`message change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Index aboutToAppear'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Index click to change message'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上面的例子中，@Monitor会在info创建完成后生效，这个时机晚于类的constructor，早于自定义组件的aboutToAppear。当界面加载完成后，点击“change message”，修改message变量。此时日志输出信息如下：</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>message change <span class="hljs-keyword">from</span> initialized to <span class="hljs-title class_">Index</span> aboutToAppear</li><li>message change <span class="hljs-keyword">from</span> <span class="hljs-title class_">Index</span> aboutToAppear to <span class="hljs-title class_">Index</span> click to change message</li></ol></pre></div></div>     <p>类中定义的@Monitor随着类的销毁失效。而由于类的实际销毁释放依赖于垃圾回收机制，因此会出现即使所在自定义组件已经销毁，类却还未及时销毁，导致类中定义的@Monitor仍在监听变化的情况。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoWrapper</span> {</li><li>  info?: <span class="hljs-title class_">Info</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: Info</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.age'</span>)</li><li>  <span class="hljs-title function_">onInfoAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">infoWrapper</span>: <span class="hljs-title class_">InfoWrapper</span>;</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Child aboutToDisappear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWrapper</span>.<span class="hljs-property">info</span>?.<span class="hljs-property">age</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.infoWrapper.info?.age}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">Info</span>[] = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">showFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(i));</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change showFlag'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change number'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'click to change age'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            info.<span class="hljs-property">age</span> += <span class="hljs-number">100</span>;</li><li>          });</li><li>        })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Childs'</span>)</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>, <span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">infoWrapper</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoWrapper</span>(info) })</li><li>          })</li><li>        }</li><li>        .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的例子中，当点击“change showFlag”切换if组件的条件时，Child组件会被销毁。此时，点击“change number”修改age的值时，可以通过日志观察到InfoWrapper中定义的@Monitor回调仍然被触发了。这是因为此时自定义组件Child虽然执行了aboutToDisappear，但是其成员变量infoWrapper还没有被立刻回收，当变量发生变化时，依然能够调用到infoWrapper中定义的onInfoAgeChange方法，所以从现象上看@Monitor回调仍会被触发。</p>     <p>借助垃圾回收机制去取消@Monitor的监听是不稳定的，开发者可以采用以下两种方式去管理@Monitor的失效时间：</p>     <p>1、将@Monitor定义在自定义组件中。由于自定义组件在销毁时，状态管理框架会手动取消@Monitor的监听，因此在自定义组件调用完aboutToDisappear，尽管自定义组件的数据不一定已经被释放，但@Monitor回调已不会再被触发。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoWrapper</span> {</li><li>  info?: <span class="hljs-title class_">Info</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: Info</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">infoWrapper</span>: <span class="hljs-title class_">InfoWrapper</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'infoWrapper.info.age'</span>)</li><li>  <span class="hljs-title function_">onInfoAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Child aboutToDisappear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWrapper</span>.<span class="hljs-property">info</span>?.<span class="hljs-property">age</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.infoWrapper.info?.age}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">Info</span>[] = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">showFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(i));</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change showFlag'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change number'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'click to change age'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            info.<span class="hljs-property">age</span> += <span class="hljs-number">100</span>;</li><li>          })</li><li>        })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Childs'</span>)</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>, <span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">infoWrapper</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoWrapper</span>(info) })</li><li>          })</li><li>        }</li><li>        .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>2、主动置空监听的对象。当自定义组件即将销毁时，主动置空@Monitor的监听目标，这样@Monitor无法再监听原监听目标的变化，达到取消@Monitor监听的效果。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">InfoWrapper</span> {</li><li>  info?: <span class="hljs-title class_">Info</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: Info</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.age'</span>)</li><li>  <span class="hljs-title function_">onInfoAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">infoWrapper</span>: <span class="hljs-title class_">InfoWrapper</span>;</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Child aboutToDisappear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWrapper</span>.<span class="hljs-property">info</span>?.<span class="hljs-property">age</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">infoWrapper</span>.<span class="hljs-property">info</span> = <span class="hljs-literal">undefined</span>; <span class="hljs-comment">// 使InfoWrapper对info.age的监听失效</span></li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.infoWrapper.info?.age}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">Info</span>[] = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">showFlag</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">5</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(i));</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change showFlag'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span> = !<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change number'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'click to change age'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            info.<span class="hljs-property">age</span> += <span class="hljs-number">100</span>;</li><li>          })</li><li>        })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">showFlag</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Childs'</span>)</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>, <span class="hljs-function">(<span class="hljs-params">info: Info</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">infoWrapper</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">InfoWrapper</span>(info) })</li><li>          })</li><li>        }</li><li>        .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="正确设置monitor入参">正确设置@Monitor入参<i class="anchor-icon anchor-icon-link" anchorid="正确设置monitor入参" tips="复制节点链接"></i></h3>          <p>由于@Monitor无法对入参做编译时校验，当前存在以下写法不符合@Monitor监听条件但@Monitor仍会触发的情况。开发者应当正确传入@Monitor入参，不传入非状态变量，避免造成功能异常或行为表现不符合预期。</p>     <p>【反例1】</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'age'</span>, <span class="hljs-string">'name'</span>) <span class="hljs-comment">// 同时监听状态变量age和非状态变量name</span></li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`property path:<span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age&amp;name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 同时改变状态变量age和非状态变量name</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Johny'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上面的代码中，当点击按钮同时更改状态变量age和非状态变量name时，会输出以下日志：</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">property</span> <span class="hljs-variable">path</span>:<span class="hljs-title class_">age</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-number">24</span> <span class="hljs-title class_">to</span> <span class="hljs-number">25</span></li><li><span class="hljs-variable">property</span> <span class="hljs-variable">path</span>:<span class="hljs-title class_">name</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-title class_">John</span> <span class="hljs-title class_">to</span> <span class="hljs-title class_">Johny</span></li></ol></pre></div></div>     <p>实际上name属性本身并不是可被观测的变量，不应被加入到@Monitor的入参当中。建议开发者去除对name属性的监听或者给name加上@Trace装饰成为状态变量。</p>     <p>【正例1】</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'age'</span>) <span class="hljs-comment">// 仅监听状态变量age</span></li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`property path:<span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    })</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age&amp;name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 状态变量age改变</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Johny'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>【反例2】</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-keyword">get</span> <span class="hljs-title function_">myAge</span>() {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>; <span class="hljs-comment">// age为状态变量</span></li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'myAge'</span>) <span class="hljs-comment">// 监听非@Computed装饰的getter访问器</span></li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'age changed'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 状态变量age改变</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上面的代码中，@Monitor的入参为一个getter访问器的名字，但该getter访问器本身并未被@Computed装饰，不是一个可被监听的变量。但由于使用了状态变量参与了计算，在状态变量变化后，myAge也被认为发生了变化，因此触发了@Monitor回调。建议开发者给myAge添加@Computed装饰器或当getter访问器直接返回状态变量时，不监听getter访问器而是直接监听状态变量本身。</p>     <p>【正例2】</p>     <p>将myAge变为状态变量：</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-meta">@Computed</span> <span class="hljs-comment">// 给myAge添加@Computed成为状态变量</span></li><li>  <span class="hljs-keyword">get</span> <span class="hljs-title function_">myAge</span>() {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span>;</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'myAge'</span>) <span class="hljs-comment">// 监听@Computed装饰的getter访问器</span></li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'age changed'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 状态变量age改变</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>或直接监听状态变量本身：</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'age'</span>) <span class="hljs-comment">// 监听状态变量age</span></li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'age changed'</span>);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 状态变量age改变</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="无法监听变量从可访问变为不可访问和从不可访问变为可访问">无法监听变量从可访问变为不可访问和从不可访问变为可访问<i class="anchor-icon anchor-icon-link" anchorid="无法监听变量从可访问变为不可访问和从不可访问变为可访问" tips="复制节点链接"></i></h3>          <p>@Monitor仅会保存变量可访问时的值，当状态变量变为不可访问的状态时，并不会记录其值的变化。在下面的例子中，点击三个Button，均不会触发onChange的回调。</p>     <p>从API version 20开始，如果需要监听可访问到不可访问和不可访问到可访问的状态变化，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听变量从可访问到不访问和从不可访问到可访问">addMonitor</a>。</p>     <div _ngcontent-ecu-c106="" class="highlight-div"><div _ngcontent-ecu-c106="" class="highlight-div-header"><div _ngcontent-ecu-c106="" class="highlight-div-header-left"><div _ngcontent-ecu-c106="" class="handle-button expand-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ecu-c106="" class="highlight-div-header-right"><div _ngcontent-ecu-c106="" class="handle-button ai-button"></div><div _ngcontent-ecu-c106="" class="handle-button line-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ecu-c106="" class="handle-button theme-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ecu-c106="" class="handle-button copy-button"><div _ngcontent-ecu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ecu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'user.age'</span>)</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user?.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to undefined'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// age：可访问 -&gt; 不可访问</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">undefined</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to User'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// age：不可访问 -&gt;可访问</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to null'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// age：可访问-&gt;不可访问</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">null</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>