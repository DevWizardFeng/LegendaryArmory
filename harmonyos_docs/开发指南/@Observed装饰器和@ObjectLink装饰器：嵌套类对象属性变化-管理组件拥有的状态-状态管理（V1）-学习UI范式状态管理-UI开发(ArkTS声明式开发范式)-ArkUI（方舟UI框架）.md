<h1 _ngcontent-daq-c119="" class="doc-title ng-star-inserted" title="@Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化"> @Observed装饰器和@ObjectLink装饰器：嵌套类对象属性变化 </h1>

<div _ngcontent-daq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>上文所述的装饰器（包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide和@Consume</a>装饰器）仅能观察到第一层的变化，但是在实际应用开发中，应用会根据开发需要，封装自己的数据模型。对于多层嵌套的情况，比如二维数组、对象数组、嵌套类场景，无法观察到第二层的属性变化。因此，为了实现对嵌套数据结构中深层属性变化的观察，引入了@Observed和@ObjectLink装饰器。</p>    <p>@Observed/@ObjectLink适用于观察嵌套对象（对象的属性是对象）属性的变化，需要开发者对装饰器的基本观察能力有一定的了解，再来对比阅读该文档。建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>的基本用法。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-status-management" target="_blank">状态管理最佳实践</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 9开始，这两个装饰器支持在ArkTS卡片中使用。</p>      <p>从API version 11开始，这两个装饰器支持在元服务中使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@ObjectLink和@Observed类装饰器配合使用，可实现嵌套对象或数组的双向数据同步，使用方式如下：</p>     <ul>      <li>       <p>将数组项或类属性声明为@Observed装饰的类型，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#嵌套对象">嵌套对象</a>。</p></li>      <li>       <p>在子组件中使用@ObjectLink装饰的状态变量，用于接收父组件@Observed装饰的类实例，从而建立双向数据绑定。</p></li>      <li>       <p>API version 19之前，@ObjectLink只能接收@Observed装饰的类实例；API version 19及以后，@ObjectLink也可以接收复杂类型，无@Observed装饰的限制。但需注意，如需观察嵌套类型场景，需要其接收@Observed装饰的类实例或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>的返回值。示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#二维数组">二维数组</a>。</p></li>     </ul>     <p>开发者如需实现单向数据同步，需要搭配@Prop使用，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#prop与objectlink的差异">@Prop与@ObjectLink的差异</a>。</p>    </div>    <div class="tiledSection">     <h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">@Observed类装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">无。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">类装饰器</td>         <td class="cellrowborder" valign="top" width="50%">装饰class。需要放在class的定义前，使用new创建类对象。</td>        </tr>             </tbody></table></div>     </div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="50%">@ObjectLink变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">无。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>支持继承Date、<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#二维数组">Array</a>的class实例。</p>          <p>API version 11及以上支持继承<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#继承map类">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#继承set类">Set</a>的class实例以及@Observed装饰类和undefined或null组成的联合类型，比如ClassA | ClassB、 ClassA | undefined 或者 ClassA | null, 示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#objectlink支持联合类型">@ObjectLink支持联合类型</a>。</p>          <p>API version 19之前，必须为被@Observed装饰的class实例。</p>          <p>API version 19及以上，@ObjectLink可以被复杂类型初始化，即class、object或built-in类型。如果需要观察变化，请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#观察变化">观察变化</a>。</p>          <p><strong>说明：</strong></p>          <p>@ObjectLink不支持简单类型，如果开发者需要使用简单类型，可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">被装饰变量的初始值</td>         <td class="cellrowborder" valign="top" width="50%">禁止本地初始化。</td>        </tr>             </tbody></table></div>     </div>     <p>@ObjectLink的属性可以被改变，但不允许整体赋值，即@ObjectLink装饰的变量是只读的。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 允许@ObjectLink装饰的数据属性赋值</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">objLink</span>.<span class="hljs-property">a</span>= ...</li><li><span class="hljs-comment">// 不允许@ObjectLink装饰的数据自身赋值</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">objLink</span>= ...</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>@ObjectLink装饰的变量不能被赋值，如果要使用赋值操作，请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>。</p>       <ul>        <li>         <p>@Prop装饰的变量和数据源的关系是单向同步，@Prop装饰的变量在本地拷贝了数据源，所以它允许本地更改，如果父组件中的数据源有更新，@Prop装饰的变量在本地的修改将被覆盖。</p></li>        <li>         <p>@ObjectLink装饰的变量和数据源的关系是双向同步，@ObjectLink装饰的变量相当于指向数据源的指针。禁止对@ObjectLink装饰的变量赋值，如果发生@ObjectLink装饰的变量的赋值，则同步链将被打断。</p></li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="变量的传递访问规则说明">变量的传递/访问规则说明<i class="anchor-icon anchor-icon-link" anchorid="变量的传递访问规则说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">@ObjectLink传递/访问</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">从父组件初始化</td>         <td class="cellrowborder" valign="top" width="50%">          <p>必须指定。</p>          <p>必须使用复杂类型初始化@ObjectLink装饰的变量，如果需要观察变化需要满足以下场景：</p>          <p>- 类型必须是@Observed装饰的class或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>返回值。</p>          <p>- 初始化的数值需要是数组项，或者class的属性。</p>          <p>- 同步源的class或者数组必须是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Consume</a>或者@ObjectLink装饰的数据。</p>          <p>同步源是数组项的示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#对象数组">对象数组</a>。初始化的class的示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#嵌套对象">嵌套对象</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">与源对象同步</td>         <td class="cellrowborder" valign="top" width="50%">双向。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">可以初始化子组件</td>         <td class="cellrowborder" valign="top" width="50%">允许，可用于初始化常规变量、@State、@Link、@Prop、@Provide</td>        </tr>             </tbody></table></div>     </div>     <p><strong>图1</strong> 初始化规则图示</p>     <p><span><img originheight="566" originwidth="1249" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115000.12574171794338592155519710659487:50001231000000:2800:8E509D17BFD30870F4FEBD16B95B58F81BAF066E1AB0164AFA75AF6444A5D654.png" width="920" height="416.9095276220977"></span></p>    </div>    <div class="tiledSection">     <h2 id="观察变化和行为表现">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="观察变化" class="firsth2">观察变化<i class="anchor-icon anchor-icon-link" anchorid="观察变化" tips="复制节点链接"></i></h3>          <p>API version 19之前，@Observed装饰的类，如果其属性为非简单类型，如class、Object、Array、Map、Set和Date，那么这些属性也需要被@Observed装饰，否则将观察不到这些属性的变化或内置类型的API调用。API version 19及以后，也可以通过使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>来观察嵌套类属性的变化。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = num;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">Child</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">child: Child, count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span> = child;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以上示例中，Parent被@Observed装饰，其成员变量的赋值的变化是可以被观察到的，但对于Child，没有被@Observed装饰，其属性的修改不能被观察到。若想观察Child的属性修改变化，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#嵌套对象">嵌套对象</a>。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">Parent</span>;</li><li>
</li><li><span class="hljs-comment">// 赋值变化可以被观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">child</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(<span class="hljs-number">5</span>);</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">count</span> = <span class="hljs-number">5</span>;</li><li>
</li><li><span class="hljs-comment">// Child没有被@Observed装饰，其属性的变化观察不到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">parent</span>.<span class="hljs-property">child</span>.<span class="hljs-property">num</span> = <span class="hljs-number">5</span>;</li></ol></pre></div></div>     <p>@ObjectLink接收对象时，如果对象被@State或其他状态变量装饰器装饰，则可以观察第一层变化。示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#对象类型">对象类型</a>。</p>     <p>@ObjectLink接收嵌套对象时，内层对象需要为被@Observed装饰的class类型。从API version 19开始，内层对象也支持被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>处理的返回值。示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#嵌套对象">嵌套对象</a>。</p>     <p>@ObjectLink推荐设计单独的自定义组件来渲染每一个数组或对象。此时，对象数组或嵌套对象需要两个自定义组件，一个自定义组件呈现外部数组/对象，另一个自定义组件呈现嵌套在数组/对象内的类对象。可以观察到：</p>     <ul>      <li>       <p>其属性的数值的变化，其中属性是指Object.keys(observedObject)返回的所有属性，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#嵌套对象">嵌套对象</a>。</p></li>      <li>       <p>如果数据源是数组，则可以观察到数组项的替换，如果数据源是class，可观察到class的属性的变化，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#对象数组">对象数组</a>。</p></li>     </ul>     <p>@ObjectLink装饰继承于Date的class时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds 更新Date的属性。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DateClass</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Date</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">args: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>(args);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NewDate</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">DateClass</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data: DateClass</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'date'</span>;</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">DateClass</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">newData</span>: <span class="hljs-title class_">NewDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NewDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateClass</span>(<span class="hljs-string">'2023-1-1'</span>));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">'date'</span>, <span class="hljs-attr">data</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">newData</span>.<span class="hljs-property">data</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'parent update the new date'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">newData</span>.<span class="hljs-property">data</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateClass</span>(<span class="hljs-string">'2023-07-07'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`ViewB: this.newData = new NewDate(new DateClass('2023-08-20'))`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">newData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NewDate</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DateClass</span>(<span class="hljs-string">'2023-08-20'</span>));</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@ObjectLink装饰继承于Map的class时，可以观察到Map整体的赋值，同时可通过调用Map的接口set, clear, delete 更新Map的值。示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#继承map类">继承Map类</a>。</p>     <p>@ObjectLink装饰继承于Set的class时，可以观察到Set整体的赋值，同时可通过调用Set的接口add, clear, delete 更新Set的值。示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#继承set类">继承Set类</a>。</p>    </div>    <div class="tiledSection">     <h3 id="框架行为">框架行为<i class="anchor-icon anchor-icon-link" anchorid="框架行为" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>初始渲染：</p>       <p>a. @Observed装饰的class的实例会被不透明的代理对象包装，代理了class上的属性的setter和getter方法。</p>       <p>b. 子组件中@ObjectLink装饰的变量从父组件初始化，接收被@Observed装饰的class的实例，@ObjectLink的包装类会将自己注册给@Observed class。这里的注册行为指的是，@ObjectLink包装类会向@Observed实例提供自身的引用，让@Observed实例将其添加到依赖列表中，以便属性变化时能通知到它。</p></li>      <li>       <p>属性更新：当@Observed装饰的class属性改变时，会执行代理的setter和getter，然后遍历依赖它的@ObjectLink包装类，通知数据更新。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>使用@Observed装饰class会改变class原始的原型链，@Observed和其他类装饰器装饰同一个class可能会带来问题。</p></li>      <li>       <p>@ObjectLink装饰器不建议在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#entry">@Entry</a>装饰的自定义组件中使用，编译时会产生告警。</p></li>      <li>       <p>@ObjectLink装饰的类型必须是复杂类型，否则会有编译时报错。</p></li>      <li>       <p>API version 19前，@ObjectLink装饰的变量类型必须是显式地由@Observed装饰的类。如果未指定类型，或不是@Observed装饰的class，编译时报错。</p>       <p>API version 19及以后，@ObjectLink也可以被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>的返回值初始化，若@ObjectLink接收未使用@Observed装饰的class或makeV1Observed返回值进行初始化，则会有运行时告警日志。</p>       <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Test</span> {</li><li>  <span class="hljs-attr">msg</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">msg: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">msg</span> = msg;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误写法，count未指定类型，编译报错</span></li><li><span class="hljs-meta">@ObjectLink</span> count;</li><li><span class="hljs-comment">// 错误写法，Test未被@Observed装饰，编译报错</span></li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">test</span>: <span class="hljs-title class_">Test</span>;</li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Info</span>;</li></ol></pre></div></div></li>      <li>       <p>@ObjectLink装饰的变量不能本地初始化，仅能通过构造参数从父组件传入初始值，否则编译时会报错。</p>       <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 错误写法，编译报错</span></li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">10</span>);</li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Info</span>;</li></ol></pre></div></div></li>      <li>       <p>@ObjectLink装饰的变量是只读的，不能被赋值，否则会有运行时报错提示Cannot set property when setter is undefined。如果需要对@ObjectLink装饰的变量进行整体替换，可以在父组件对其进行整体替换。</p>       <p>【反例】</p>       <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">num</span>: <span class="hljs-title class_">Info</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 错误写法，@ObjectLink装饰的变量不能被赋值，运行时报错</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">10</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">num</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">10</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num.count}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">num</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>})</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p>【正例】</p>       <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = count;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">num</span>: <span class="hljs-title class_">Info</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num.count}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 正确写法，可以更改@ObjectLink装饰变量的成员属性</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>.<span class="hljs-property">count</span> = <span class="hljs-number">20</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">num</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">10</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num.count}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'click'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 可以在父组件做整体替换</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">30</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">num</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>})</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="对象类型" class="firsth2">对象类型<i class="anchor-icon anchor-icon-link" anchorid="对象类型" tips="复制节点链接"></i></h3>          <p>该场景包含built-in类型（Array、Map、Set和Date）和普通class。从API version 19开始，@ObjectLink接收@State传递built-in类型和普通class对象，可以观察其API调用和第一层变化，无需额外添加@Observed装饰。因为@State等状态变量装饰器，会给对象（外层对象）添加一层“代理”包装，其功能等同于添加@Observed装饰。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">BookCard</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`BookCard: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book.name}</span>`</span>) <span class="hljs-comment">// 可以观察到name的变化</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change book.name'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'C++'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'JS'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">BookCard</span>({ <span class="hljs-attr">book</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="嵌套对象">嵌套对象<i class="anchor-icon anchor-icon-link" anchorid="嵌套对象" tips="复制节点链接"></i></h3>          <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Bag</span> {</li><li>  <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">book: Book</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span> = book;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">BookCard</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`BookCard: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book.name}</span>`</span>) <span class="hljs-comment">// 可以观察到name的变化</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change book.name'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'C++'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">bag</span>: <span class="hljs-title class_">Bag</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Bag</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'JS'</span>));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Index: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.bag.book.name}</span>`</span>) <span class="hljs-comment">// 无法观察到name的变化</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change bag.book.name'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">bag</span>.<span class="hljs-property">book</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'TS'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">BookCard</span>({ <span class="hljs-attr">book</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">bag</span>.<span class="hljs-property">book</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="193" originwidth="325" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115000.82588307173893654560039020098490:50001231000000:2800:746D05C63A6E42637D55B192D56572E3AF5CAF8BED8E88793FBF06160855B407.gif" width="325" height="193"></span></p>     <p>上述示例中：</p>     <ul>      <li>点击change bag.book.name，Index组件中的Text组件不刷新，因为该变化属于第二层的变化，@State无法观察到第二层的变化。然而，Book被@Observed装饰，Book的属性name可以被@ObjectLink观察到，所以BookCard组件中Text组件可以刷新。</li>      <li>点击change book.name，Bookcard组件中的Text组件刷新，因为该变化在BooKCard中属于第一层的变化，亦可被@ObjectLink观察到。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="对象数组">对象数组<i class="anchor-icon anchor-icon-link" anchorid="对象数组" tips="复制节点链接"></i></h3>          <p>对象数组是一种常用的数据结构。以下示例展示了对象数组的用法。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>NextID是用来在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach">ForEach循环渲染</a>过程中，为每个数组元素生成一个唯一且持久的键值，标识对应的组件。</p>      </div></div></div>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-title class_">NextID</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">info</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-title class_">NextID</span>++;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 子组件Child的@ObjectLink的类型是Info</span></li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span>;</li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'ViewChild'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`ViewChild [<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.label}</span>] this.info.info = <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info ? <span class="hljs-variable language_">this</span>.info.info : <span class="hljs-string">'undefined'</span>}</span>`</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">info</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// Parent中有@State装饰的Info[]</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arrA</span>: <span class="hljs-title class_">Info</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">0</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">0</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>,</li><li>        <span class="hljs-function">(<span class="hljs-params">item: Info</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">`#<span class="hljs-subst">${item.id}</span>`</span>, <span class="hljs-attr">info</span>: item })</li><li>        },</li><li>        (<span class="hljs-attr">item</span>: <span class="hljs-title class_">Info</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>()</li><li>      )</li><li>      <span class="hljs-comment">// 使用@State装饰的数组的数组项初始化@ObjectLink，其中数组项是被@Observed装饰的Info的实例</span></li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">'ViewChild this.arrA[first]'</span>, <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>[<span class="hljs-number">0</span>] })</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">'ViewChild this.arrA[last]'</span>, <span class="hljs-attr">info</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>[<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>] })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ViewParent: reset array'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span> = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">0</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">0</span>)];</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ViewParent: push'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">0</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ViewParent: shift'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-title function_">shift</span>();</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'length &lt;= 0'</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ViewParent: item property in middle'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)]) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)].<span class="hljs-property">info</span> = <span class="hljs-number">10</span>;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'middle element does not exist'</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ViewParent: item property in middle'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">320</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>[<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrA</span>.<span class="hljs-property">length</span> / <span class="hljs-number">2</span>)] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">11</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="600" originwidth="325" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115000.12531960420608959657791049600698:50001231000000:2800:C93E8AAAB0BC16A71F774EF24A33F37BD479A40F6261BD3C3CDAD7E84133E7B7.gif" width="325" height="600"></span></p>     <ul>      <li>       <p>this.arrA[Math.floor(this.arrA.length/2)] = new Info(..) ：该状态变量的改变触发2次更新：</p>       <ol>        <li>ForEach：数组项的赋值导致ForEach的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-foreach" target="_blank">itemGenerator</a>被修改，因此数组项被识别为有更改，ForEach的item builder将执行，创建新的Child组件实例。</li>        <li>Child({ label: 'ViewChild this.arrA[last]', info: this.arrA[this.arrA.length-1] })：上述更改改变了数组中第二个元素，所以绑定this.arrA[1]的Child将被更新。</li>       </ol></li>      <li>       <p>this.arrA.push(new Info(0)) ： 将触发2次不同效果的更新：</p>       <ol>        <li>ForEach：新添加的Info对象对于ForEach是未知的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-foreach" target="_blank">itemGenerator</a>，ForEach的item builder将执行，创建新的Child组件实例。</li>        <li>Child({ label: 'ViewChild this.arrA[last]', info: this.arrA[this.arrA.length-1] })：数组的最后一项有更改，因此引起第二个Child的实例的更改。对于Child({ label: 'ViewChild this.arrA[first]', info: this.arrA[0] })，数组的更改并没有触发一个数组项更改的改变，所以第一个Child不会刷新。</li>       </ol></li>      <li>       <p>this.arrA[Math.floor(this.arrA.length/2)].info：@State无法观察到第二层的变化，但是Info被@Observed装饰，Info的属性的变化将被@ObjectLink观察到。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="二维数组">二维数组<i class="anchor-icon anchor-icon-link" anchorid="二维数组" tips="复制节点链接"></i></h3>          <p>使用@Observed观察二维数组的变化。可以声明一个被@Observed装饰的继承Array的子类。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedArray</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Array</span>&lt;T&gt; {</li><li>}</li></ol></pre></div></div>     <p>声明一个继承自Array的类ObservedArray&lt;T&gt;，并使用new操作符创建ObservedArray&lt;string&gt;的实例，该实例可以观察到属性变化。</p>     <p>在下面的示例中，展示了如何利用@Observed观察二维数组的变化。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedArray</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Array</span>&lt;T&gt; {</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Item</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">itemArr</span>: <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">IndexPage</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'apple'</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'banana'</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'orange'</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">itemArr: ObservedArray&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Item</span>({ <span class="hljs-attr">itemArr</span>: itemArr })</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push two-dimensional array item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">push</span>(<span class="hljs-string">'strawberry'</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push array item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'pear'</span>));</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change two-dimensional array first item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">'APPLE'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change array first item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'watermelon'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>API version 19及以后，@ObjectLink也可以被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makev1observed19" target="_blank">makeV1Observed</a>的返回值初始化。所以开发者如果不想额外声明继承Array的类，也可以使用makeV1Observed来达到同样的效果。</p>     <p>完整例子如下。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Item</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">itemArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemArr</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${index}</span>: <span class="hljs-subst">${item}</span>`</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">IndexPage</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; =</li><li>    [<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'apple'</span>]), <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'banana'</span>]), <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'orange'</span>])];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>, <span class="hljs-function">(<span class="hljs-params">itemArr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Item</span>({ <span class="hljs-attr">itemArr</span>: itemArr })</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push two-dimensional array item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">push</span>(<span class="hljs-string">'strawberry'</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push array item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'pear'</span>]));</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change two-dimensional array first item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] = <span class="hljs-string">'APPLE'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change array first item'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">makeV1Observed</span>([<span class="hljs-string">'watermelon'</span>]);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="612" originwidth="342" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115000.63302455512911906932536492871513:50001231000000:2800:DE86BD3B40A298BEF8A17BAFFA33ECE2F922E1B6B189C5A013830B02A835A710.gif" width="342" height="612"></span></p>    </div>    <div class="tiledSection">     <h3 id="继承map类">继承Map类<i class="anchor-icon anchor-icon-link" anchorid="继承map类" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@ObjectLink支持@Observed装饰Map类型和继承Map类的类型。</p>      </div></div></div>     <p>在下面的示例中，myMap类型为MyMap&lt;number, string&gt;，点击Button改变myMap的属性，视图会随之刷新。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">MyMap</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: MyMap&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt;</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyMap</span>&lt;K, V&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Map</span>&lt;K, V&gt; {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name?: <span class="hljs-built_in">string</span>, args?: [K, V][]</span>) {</li><li>    <span class="hljs-variable language_">super</span>(args);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name ? name : <span class="hljs-string">'My Map'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MapSampleNested</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MyMap</span>(<span class="hljs-string">'myMap'</span>, [[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">MapSampleNestedChild</span>({ <span class="hljs-attr">myMap</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">info</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MapSampleNestedChild</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">myMap</span>: <span class="hljs-title class_">MyMap</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">5</span>)</li><li>        })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">clear</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace the first one'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myMap</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="573" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.16868687460481966415333529075675:50001231000000:2800:0B9650BAC05843C0831694FCC33F8877650123F010E5F65304B825465A4419EA.gif" class="notEnlarge" width="232" height="573"></span></p>    </div>    <div class="tiledSection">     <h3 id="继承set类">继承Set类<i class="anchor-icon anchor-icon-link" anchorid="继承set类" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@ObjectLink支持@Observed装饰Set类型和继承Set类的类型。</p>      </div></div></div>     <p>在下面的示例中，mySet类型为MySet&lt;number&gt;，点击Button改变mySet的属性，视图会随之刷新。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">MySet</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">info: MySet&lt;<span class="hljs-built_in">number</span>&gt;</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MySet</span>&lt;T&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Set</span>&lt;T&gt; {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name?: <span class="hljs-built_in">string</span>, args?: T[]</span>) {</li><li>    <span class="hljs-variable language_">super</span>(args);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name ? name : <span class="hljs-string">'My Set'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getName</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SetSampleNested</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">MySet</span>(<span class="hljs-string">'Set'</span>, [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">SetSampleNestedChild</span>({ <span class="hljs-attr">mySet</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">info</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SetSampleNestedChild</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">mySet</span>: <span class="hljs-title class_">MySet</span>&lt;<span class="hljs-built_in">number</span>&gt;;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">mySet</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">mySet</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">mySet</span>.<span class="hljs-title function_">clear</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">mySet</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="365" originwidth="232" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.89085183261599464567041430827471:50001231000000:2800:BA65E7E92A834236B35B76326460BB2BF6FA2BFE2589B2DD5A7BCFBF09A915A2.gif" class="notEnlarge" width="232" height="365"></span></p>    </div>    <div class="tiledSection">     <h3 id="objectlink支持联合类型">ObjectLink支持联合类型<i class="anchor-icon anchor-icon-link" anchorid="objectlink支持联合类型" tips="复制节点链接"></i></h3>          <p>@ObjectLink支持@Observed装饰类和undefined或null组成的联合类型，在下面的示例中，count类型为Source | Data | undefined，点击父组件Parent中的Button改变count的属性或者类型，Child组件中对应的Text组件刷新。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Source</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">source</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">source: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">source</span> = source;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = data;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Source</span> | <span class="hljs-title class_">Data</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Source</span>(<span class="hljs-number">10</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count property'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 判断count的类型，做属性的更新</span></li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Source</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-property">source</span> += <span class="hljs-number">1</span>;</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Data</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-property">data</span> += <span class="hljs-number">1</span>;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'count is undefined, cannot change property'</span>);</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count to Source'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为Source的实例</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Source</span>(<span class="hljs-number">100</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count to Data'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为Data的实例</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>(<span class="hljs-number">100</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change count to undefined'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为undefined</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-literal">undefined</span>;</li><li>        })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Source</span> | <span class="hljs-title class_">Data</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count is instanceof <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count <span class="hljs-keyword">instanceof</span> Source ? <span class="hljs-string">'Source'</span> :</span></span></li><li><span class="hljs-string">        <span class="hljs-variable language_">this</span>.count <span class="hljs-keyword">instanceof</span> Data ? <span class="hljs-string">'Data'</span> : <span class="hljs-string">'undefined'</span>}</span>`)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count's property is  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count <span class="hljs-keyword">instanceof</span> Source ? <span class="hljs-variable language_">this</span>.count.source : <span class="hljs-variable language_">this</span>.count?.data}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>
</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="343" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.54771217553979738938482622581250:50001231000000:2800:8A8E4F013F267E10B521EA2BDAEE2DC6ACDC7393A411B09889F012FACA7C6DDB.gif" width="337" height="343"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="基础嵌套对象属性更改失效" class="firsth2">基础嵌套对象属性更改失效<i class="anchor-icon anchor-icon-link" anchorid="基础嵌套对象属性更改失效" tips="复制节点链接"></i></h3>          <p>在应用开发中，有很多嵌套对象场景，例如，开发者更新了某个属性，但UI没有进行对应的更新。</p>     <p>每个装饰器都有观察能力，但并非所有的改变都可以被观察到，只有可以被观察到的变化才会触发UI更新。@Observed装饰器可以观察到嵌套对象的属性变化，其他装饰器仅能观察到第一层的变化。</p>     <p>【反例】</p>     <p>下面的例子中，一些UI组件并不会更新。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-attr">parentId</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">parentId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span> = parentId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getParentId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setParentId</span>(<span class="hljs-attr">parentId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span> = parentId;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">childId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span> = childId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChildId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setChildId</span>(<span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span> = childId;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cousin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {</li><li>  <span class="hljs-attr">cousinId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">47</span>;</li><li>  <span class="hljs-attr">child</span>: <span class="hljs-title class_">Child</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">parentId: <span class="hljs-built_in">number</span>, cousinId: <span class="hljs-built_in">number</span>, childId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>(parentId);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span> = cousinId;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(childId);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getCousinId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setCousinId</span>(<span class="hljs-attr">cousinId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span> = cousinId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChild</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">getChildId</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setChild</span>(<span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">setChildId</span>(childId);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyView</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cousin</span>: <span class="hljs-title class_">Cousin</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cousin</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`parentId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cousin.parentId}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Parent.parent'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">parentId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`cousinId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cousin.cousinId}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Cousin.cousinId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">cousinId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`childId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cousin.child.childId}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Cousin.Child.childId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 点击时上面的Text组件不会刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">child</span>.<span class="hljs-property">childId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>       <p>最后一个Text组件Text('child: ${this.cousin.child.childId}')，当点击该组件时UI不会刷新。 因为，@State cousin : Cousin 只能观察到this.cousin属性的变化，比如this.cousin.parentId, this.cousin.cousinId 和this.cousin.child的变化，但是无法观察嵌套在属性中的属性，即this.cousin.child.childId（属性childId是内嵌在cousin中的对象Child的属性）。</p></li>      <li>       <p>为了观察到嵌套于内部的Child的属性，需要做如下改变：</p>       <ul>        <li>构造一个子组件，用于单独渲染Child的实例。 该子组件可以使用@ObjectLink child : Child或@Prop child : Child。通常会使用@ObjectLink，除非子组件需要对其Child对象进行本地修改。</li>        <li>嵌套的Child必须用@Observed装饰。当在Cousin中创建Child对象时（本示例中的Cousin(10, 20, 30）)，它将被包装在ES6代理中，当Child属性更改时（this.cousin.child.childId += 1），该代码将修改通知到@ObjectLink变量。</li>       </ul></li>     </ul>     <p>【正例】</p>     <p>以下示例使用@Observed/@ObjectLink来观察嵌套对象的属性更改。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-attr">parentId</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">parentId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span> = parentId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getParentId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setParentId</span>(<span class="hljs-attr">parentId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentId</span> = parentId;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">childId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span> = childId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChildId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setChildId</span>(<span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childId</span> = childId;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Cousin</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">Parent</span> {</li><li>  <span class="hljs-attr">cousinId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">47</span>;</li><li>  <span class="hljs-attr">child</span>: <span class="hljs-title class_">Child</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">parentId: <span class="hljs-built_in">number</span>, cousinId: <span class="hljs-built_in">number</span>, childId: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>(parentId);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span> = cousinId;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Child</span>(childId);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getCousinId</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setCousinId</span>(<span class="hljs-attr">cousinId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousinId</span> = cousinId;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getChild</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">getChildId</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setChild</span>(<span class="hljs-attr">childId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">setChildId</span>(childId);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ViewChild</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">Child</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`childId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.child.getChildId()}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change childId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">setChildId</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-title function_">getChildId</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyView</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cousin</span>: <span class="hljs-title class_">Cousin</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Cousin</span>(<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`parentId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cousin.parentId}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Parent.parentId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">parentId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`cousinId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cousin.cousinId}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Cousin.cousinId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">cousinId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">ViewChild</span>({ <span class="hljs-attr">child</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">child</span> }) <span class="hljs-comment">// Text(`childId: ${this.cousin.child.childId}`)的替代写法</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change Cousin.Child.childId'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cousin</span>.<span class="hljs-property">child</span>.<span class="hljs-property">childId</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="复杂嵌套对象属性更改失效">复杂嵌套对象属性更改失效<i class="anchor-icon anchor-icon-link" anchorid="复杂嵌套对象属性更改失效" tips="复制节点链接"></i></h3>          <p>【反例】</p>     <p>以下示例创建了一个带有@ObjectLink装饰变量的子组件，用于渲染一个含有嵌套属性的ParentCounter，用@Observed装饰嵌套在ParentCounter中的SubCounter。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">1</span>;</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubCounter</span> {</li><li>  <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = c;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentCounter</span> {</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">subCounter</span>: <span class="hljs-title class_">SubCounter</span>;</li><li>  <span class="hljs-title function_">incrCounter</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>++;</li><li>  }</li><li>  <span class="hljs-title function_">incrSubCounter</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span>.<span class="hljs-property">counter</span> += c;</li><li>  }</li><li>  <span class="hljs-title function_">setSubCounter</span>(<span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span>.<span class="hljs-property">counter</span> = c;</li><li>  }</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = nextId++;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = c;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubCounter</span>(c);</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CounterComp</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">ParentCounter</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value.counter}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">incrCounter</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value.subCounter.counter}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">incrSubCounter</span>(<span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">2</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComp</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">counter</span>: <span class="hljs-title class_">ParentCounter</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">3</span>)];</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>] })</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">1</span>] })</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">2</span>] })</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>,</li><li>          <span class="hljs-function">(<span class="hljs-params">item: ParentCounter</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: item })</li><li>          },</li><li>          <span class="hljs-function">(<span class="hljs-params">item: ParentCounter</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>()</li><li>        )</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-comment">// 第一个点击事件</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: incr counter[0].counter'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">incrCounter</span>();</li><li>            <span class="hljs-comment">// 每次触发时自增10</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">incrSubCounter</span>(<span class="hljs-number">10</span>);</li><li>          })</li><li>        <span class="hljs-comment">// 第二个点击事件</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: set.counter to 10'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 无法将value设置为10，UI不会刷新</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">setSubCounter</span>(<span class="hljs-number">10</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: reset entire counter'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">3</span>)];</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>对于Text('Parent: incr counter[0].counter')的onClick事件，this.counter[0].incrSubCounter(10)调用incrSubCounter方法使SubCounter的counter值增加10，UI同步刷新。</p>     <p>然而，在Text('Parent: set.counter to 10')的onClick中调用this.counter[0].setSubCounter(10)时，SubCounter的counter值无法重置为10。</p>     <p>incrSubCounter和setSubCounter都是同一个SubCounter的函数。在第一个点击处理时调用incrSubCounter可以正确更新UI，而第二个点击处理调用setSubCounter时却没有更新UI。实际上incrSubCounter和setSubCounter两个函数都不能触发Text('${this.value.subCounter.counter}')的更新，因为@ObjectLink value : ParentCounter仅能观察其代理ParentCounter的属性，对于this.value.subCounter.counter是SubCounter的属性，无法观察到嵌套类的属性。</p>     <p>另外，第一个click事件调用this.counter[0].incrCounter()将CounterComp自定义组件中的@ObjectLink value: ParentCounter标记为已更改，会触发Text('${this.value.subCounter.counter}')的更新。如果在第一个点击事件中删除this.counter[0].incrCounter()，则无法更新UI。</p>     <p>【正例】</p>     <p>对于上述问题，为了直接观察SubCounter中的属性，以便this.counter[0].setSubCounter(10)操作有效，可以利用下面的方法：</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>] }); <span class="hljs-comment">// ParentComp组件传递 ParentCounter 给 CounterComp 组件</span></li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">ParentCounter</span>; <span class="hljs-comment">// @ObjectLink 接收 ParentCounter</span></li><li>
</li><li><span class="hljs-comment">// CounterChild 是 CounterComp 的子组件，CounterComp 传递 this.value.subCounter 给 CounterChild 组件</span></li><li><span class="hljs-title class_">CounterChild</span>({ <span class="hljs-attr">subValue</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-property">subCounter</span> });</li><li><span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">subValue</span>: <span class="hljs-title class_">SubCounter</span>; <span class="hljs-comment">// @ObjectLink 接收 SubCounter</span></li></ol></pre></div></div>     <p>该方法使得@ObjectLink分别代理了ParentCounter和SubCounter的属性，这样对于这两个类的属性的变化都可以观察到，即都会对UI视图进行刷新。即使删除了上面所说的this.counter[0].incrCounter()，UI也会进行正确的刷新。</p>     <p>该方法可用于实现“两个层级”的观察，即外部对象和内部嵌套对象的观察。但是该方法只能用于@ObjectLink装饰器，无法作用于@Prop（@Prop通过深拷贝传入对象）。详情参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink#prop与objectlink的差异">@Prop与@ObjectLink的差异</a>。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">1</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">SubCounter</span> {</li><li>  <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = c;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ParentCounter</span> {</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">subCounter</span>: <span class="hljs-title class_">SubCounter</span>;</li><li>
</li><li>  <span class="hljs-title function_">incrCounter</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>++;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">incrSubCounter</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span>.<span class="hljs-property">counter</span> += c;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setSubCounter</span>(<span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span>.<span class="hljs-property">counter</span> = c;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">c: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = nextId++;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = c;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">subCounter</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SubCounter</span>(c);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CounterComp</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">ParentCounter</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value.counter}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">incrCounter</span>();</li><li>        })</li><li>      <span class="hljs-title class_">CounterChild</span>({ <span class="hljs-attr">subValue</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-property">subCounter</span> })</li><li>      <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">2</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CounterChild</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">subValue</span>: <span class="hljs-title class_">SubCounter</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.subValue.counter}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">subValue</span>.<span class="hljs-property">counter</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComp</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">counter</span>: <span class="hljs-title class_">ParentCounter</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">3</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>] })</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">1</span>] })</li><li>        <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">2</span>] })</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>,</li><li>          <span class="hljs-function">(<span class="hljs-params">item: ParentCounter</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">CounterComp</span>({ <span class="hljs-attr">value</span>: item })</li><li>          },</li><li>          <span class="hljs-function">(<span class="hljs-params">item: ParentCounter</span>) =&gt;</span> item.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>()</li><li>        )</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">5</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: reset entire counter'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span> = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">1</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">2</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParentCounter</span>(<span class="hljs-number">3</span>)];</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: incr counter[0].counter'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">incrCounter</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">incrSubCounter</span>(<span class="hljs-number">10</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent: set.counter to 10'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">counter</span>[<span class="hljs-number">0</span>].<span class="hljs-title function_">setSubCounter</span>(<span class="hljs-number">10</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="prop与objectlink的差异">@Prop与@ObjectLink的差异<i class="anchor-icon anchor-icon-link" anchorid="prop与objectlink的差异" tips="复制节点链接"></i></h3>          <p>@Prop和@ObjectLink都可以接收@Observed装饰的类对象实例。@Prop对对象进行深拷贝，修改深拷贝后的对象不会影响原对象及其关联的组件。@ObjectLink获取对象的引用，修改引用对象会影响原对象及其关联的组件。</p>     <p>下面的例子中，UserChild组件同时使用@Prop与@ObjectLink接收了来自父组件的@Observed装饰的类对象实例作为数据源。对该数据源对象的修改将同时影响@Prop与@ObjectLink装饰的变量。依次点击change @ObjectLink value按钮和change @Prop value按钮可以观察到：</p>     <ol>      <li>修改@ObjectLink装饰的对象内容将影响数据源对象，并重新同步给@Prop，因此两个Text组件都将刷新。</li>      <li>修改@Prop装饰的对象内容仅影响使用该对象的Text2组件，不会影响数据源对象。</li>     </ol>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> nextId = <span class="hljs-number">0</span>;</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = nextId++;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(), <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>()];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">UserChild</span>({ <span class="hljs-attr">firstUserByObjectLink</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>[<span class="hljs-number">0</span>], <span class="hljs-attr">firstUserByProp</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>[<span class="hljs-number">0</span>] })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">UserChild</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">firstUserByObjectLink</span>: <span class="hljs-title class_">User</span>;</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">firstUserByProp</span>: <span class="hljs-title class_">User</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 比较结果为false说明@Prop经过深拷贝后得到的对象与原对象已不是同一个对象</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`firstUserByObjectLink equals firstUserByProp? : <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.firstUserByObjectLink === <span class="hljs-variable language_">this</span>.firstUserByProp}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UserChild firstUserByObjectLink.id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.firstUserByObjectLink.id}</span>`</span>) <span class="hljs-comment">// Text1</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UserChild firstUserByProp.id: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.firstUserByProp.id}</span>`</span>) <span class="hljs-comment">// Text2</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change @ObjectLink value'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstUserByObjectLink</span>.<span class="hljs-property">id</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change @Prop value'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstUserByProp</span>.<span class="hljs-property">id</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上面的示例关系如图所示：</p>     <p><span><img originheight="424" originwidth="770" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115001.47622574066465429300117347657718:50001231000000:2800:C4F8F2FD5175B95470922996AF84521379CF00685EC92C3BCB23EBF835D0991E.jpg" width="770" height="424"></span></p>    </div>    <div class="tiledSection">     <h3 id="在observed装饰类的构造函数中延时更改成员变量">在@Observed装饰类的构造函数中延时更改成员变量<i class="anchor-icon anchor-icon-link" anchorid="在observed装饰类的构造函数中延时更改成员变量" tips="复制节点链接"></i></h3>          <p>在状态管理中，使用@Observed装饰类后，会给该类使用一层“代理”进行包装。当在组件中改变该类的成员变量时，会被该代理进行拦截，在更改数据源中值的同时，也会将变化通知给绑定的组件，从而实现观测变化与触发刷新。</p>     <p>当开发者在类的构造函数中对成员变量进行赋值或者修改时，此修改不会经过代理（因为是直接对数据源中的值进行修改），也就无法被观测到。所以，如果开发者在类的构造函数中使用定时器修改类中的成员变量，即使该修改成功执行了，也不会触发UI的刷新。</p>     <p>【反例】</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">RenderClass</span> {</li><li>  <span class="hljs-attr">waitToRender</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">waitToRender</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'更改waitToRender的值为：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">waitToRender</span>);</li><li>    }, <span class="hljs-number">1000</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'renderClassChange'</span>) <span class="hljs-attr">renderClass</span>: <span class="hljs-title class_">RenderClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderClass</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>;</li><li>
</li><li>  <span class="hljs-title function_">renderClassChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'renderClass的值被更改为：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderClass</span>.<span class="hljs-property">waitToRender</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'renderClass的值为：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderClass</span>.<span class="hljs-property">waitToRender</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Show'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 使用其他状态变量强行刷新UI的做法并不推荐，此处仅用来检测waitToRender的值是否更新</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上文的示例代码中在RenderClass的构造函数中使用定时器在1秒后修改了waitToRender的值，但是不会触发UI的刷新。此时，点击按钮强行刷新Text组件，可以看到waitToRender的值已经被修改成了true。</p>     <p>【正例】</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">RenderClass</span> {</li><li>  <span class="hljs-attr">waitToRender</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'renderClassChange'</span>) <span class="hljs-attr">renderClass</span>: <span class="hljs-title class_">RenderClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderClass</span>();</li><li>
</li><li>  <span class="hljs-title function_">renderClassChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'renderClass的值被更改为：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderClass</span>.<span class="hljs-property">waitToRender</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onPageShow</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderClass</span>.<span class="hljs-property">waitToRender</span> = <span class="hljs-literal">true</span>;</li><li>    }, <span class="hljs-number">1000</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'renderClass的值为：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderClass</span>.<span class="hljs-property">waitToRender</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上文的示例代码将定时器修改移入到组件内，此时界面显示时会先显示“renderClass的值为：false”。待定时器触发时，renderClass的值改变，触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch">@Watch</a>回调，此时界面刷新显示“renderClass的值为：true”，日志输出“renderClass的值被更改为：true”。</p>     <p>因此，更推荐开发者在组件中对@Observed装饰的类成员变量进行修改，以实现刷新。</p>    </div>    <div class="tiledSection">     <h3 id="objectlink数据源更新时机">@ObjectLink数据源更新时机<i class="anchor-icon anchor-icon-link" anchorid="objectlink数据源更新时机" tips="复制节点链接"></i></h3>          <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">person</span>: <span class="hljs-title class_">Person</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">person: Person</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span> = person;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange01'</span>) <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Bob'</span>, <span class="hljs-number">10</span>));</li><li>
</li><li>  <span class="hljs-title function_">onChange01</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::onChange01:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 2</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>).<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">per</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>, <span class="hljs-attr">clickEvent</span>: <span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::clickEvent before'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 1</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Jack'</span>, <span class="hljs-number">12</span>);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::clickEvent after'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 3</span></li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange02'</span>) <span class="hljs-attr">per</span>: <span class="hljs-title class_">Person</span>;</li><li>  clickEvent?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange02</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::onChange02:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">per</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 5</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">per</span>.<span class="hljs-property">name</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onClickType</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onClickType</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">clickEvent</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clickEvent</span>();</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::--------此时Child中的this.per.name值仍然是：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">per</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 4</span></li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@ObjectLink的数据源更新依赖其父组件，当父组件中数据源改变引起父组件刷新时，会重新设置子组件@ObjectLink的数据源。这个过程不是在父组件数据源变化后立刻发生的，而是在父组件实际刷新时才会进行。上述示例中，Parent包含Child，Parent传递箭头函数给Child，在点击时，日志打印顺序是1-2-3-4-5，打印到日志4时，点击事件流程结束，此时仅仅是将子组件Child标记为需要父组件更新的节点，因此日志4打印的this.per.name的值仍为Bob，等到父组件真正更新时，才会更新Child的数据源。</p>     <p>当@ObjectLink @Watch('onChange02') per: Person的@Watch函数执行时，说明@ObjectLink的数据源已被父组件更新，此时日志5打印的值为更新后的Jack。</p>     <p>日志的含义为：</p>     <ul>      <li>       <p>日志1：对Parent @State @Watch('onChange01') info: Info = new Info(new Person('Bob', 10)) 赋值前。</p></li>      <li>       <p>日志2：对Parent @State @Watch('onChange01') info: Info = new Info(new Person('Bob', 10)) 赋值，执行其@Watch函数，同步执行。</p></li>      <li>       <p>日志3：对Parent @State @Watch('onChange01') info: Info = new Info(new Person('Bob', 10)) 赋值完成。</p></li>      <li>       <p>日志4：onClickType方法内clickEvent执行完，此时只是将子组件Child标记为需要父组件更新的节点，未将最新的值更新给Child @ObjectLink @Watch('onChange02') per: Person，所以日志4打印的this.per.name的值仍然是Bob。</p></li>      <li>       <p>日志5：下一次vsync信号触发Child更新，@ObjectLink @Watch('onChange02') per: Person被更新，触发其@Watch方法，此时@ObjectLink @Watch('onChange02') per: Person为新值Jack。</p></li>     </ul>     <p>@Prop父子同步原理与@ObjectLink一致。</p>     <p>当clickEvent中更改this.info.person.name时，修改会立刻生效，此时日志4打印的值是Jack。</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Child</span>({</li><li>  <span class="hljs-attr">per</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>, <span class="hljs-attr">clickEvent</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::clickEvent before'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 1</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">':::clickEvent after'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>); <span class="hljs-comment">// 3</span></li><li>  }</li><li>})</li></ol></pre></div></div>     <p>此时Parent中Text组件不会刷新，因为this.info.person.name属于两层嵌套。</p>    </div>    <div class="tiledSection">     <h3 id="使用abthisobject形式调用不会触发ui刷新">使用a.b(this.object)形式调用，不会触发UI刷新<i class="anchor-icon anchor-icon-link" anchorid="使用abthisobject形式调用不会触发ui刷新" tips="复制节点链接"></i></h3>          <p>在build方法内，当@Observed与@ObjectLink联合装饰的变量是Object类型、且通过a.b(this.object)形式调用时，b方法内传入的是this.object的原始对象，修改其属性，无法触发UI刷新。如下例中，通过静态方法或者使用this调用组件内部方法，修改组件中的this.weather.temperature时，UI不会刷新。</p>     <p>【反例】</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Weather</span> {</li><li>  <span class="hljs-attr">temperature</span>:<span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">temperature:<span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">temperature</span> = temperature;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">increaseTemperature</span>(<span class="hljs-params">weather:Weather</span>) {</li><li>    weather.<span class="hljs-property">temperature</span>++;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day</span> {</li><li>  <span class="hljs-attr">weather</span>:<span class="hljs-title class_">Weather</span>;</li><li>  <span class="hljs-attr">week</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">weather:Weather, week:<span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span> = weather;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">week</span> = week;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">day1</span>: <span class="hljs-title class_">Day</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Day</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Weather</span>(<span class="hljs-number">15</span>), <span class="hljs-string">'Monday'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">weather</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">day1</span>.<span class="hljs-property">weather</span>})</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">weather</span>: <span class="hljs-title class_">Weather</span>;</li><li>
</li><li>  reduceTemperature (<span class="hljs-attr">weather</span>:<span class="hljs-title class_">Weather</span>) {</li><li>    weather.<span class="hljs-property">temperature</span>--;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The temperature of day1 is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.weather.temperature}</span> degrees.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increaseTemperature'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过静态方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-title class_">Weather</span>.<span class="hljs-title function_">increaseTemperature</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'reduceTemperature'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 使用this通过自定义组件内部方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reduceTemperature</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>可以通过如下先赋值、再调用新赋值的变量的方式为this.weather加上Proxy代理，实现UI刷新。</p>     <p>【正例】</p>     <div _ngcontent-daq-c106="" class="highlight-div"><div _ngcontent-daq-c106="" class="highlight-div-header"><div _ngcontent-daq-c106="" class="highlight-div-header-left"><div _ngcontent-daq-c106="" class="handle-button expand-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daq-c106="" class="highlight-div-header-right"><div _ngcontent-daq-c106="" class="handle-button ai-button"></div><div _ngcontent-daq-c106="" class="handle-button line-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daq-c106="" class="handle-button theme-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daq-c106="" class="handle-button copy-button"><div _ngcontent-daq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Weather</span> {</li><li>  <span class="hljs-attr">temperature</span>:<span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">temperature:<span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">temperature</span> = temperature;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">increaseTemperature</span>(<span class="hljs-params">weather:Weather</span>) {</li><li>    weather.<span class="hljs-property">temperature</span>++;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Day</span> {</li><li>  <span class="hljs-attr">weather</span>:<span class="hljs-title class_">Weather</span>;</li><li>  <span class="hljs-attr">week</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">weather:Weather, week:<span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span> = weather;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">week</span> = week;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">day1</span>: <span class="hljs-title class_">Day</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Day</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Weather</span>(<span class="hljs-number">15</span>), <span class="hljs-string">'Monday'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">weather</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">day1</span>.<span class="hljs-property">weather</span>})</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">weather</span>: <span class="hljs-title class_">Weather</span>;</li><li>
</li><li>  reduceTemperature (<span class="hljs-attr">weather</span>:<span class="hljs-title class_">Weather</span>) {</li><li>    weather.<span class="hljs-property">temperature</span>--;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The temperature of day1 is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.weather.temperature}</span> degrees.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increaseTemperature'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值添加 Proxy 代理</span></li><li>          <span class="hljs-keyword">let</span> weather1 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span>;</li><li>          <span class="hljs-title class_">Weather</span>.<span class="hljs-title function_">increaseTemperature</span>(weather1);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'reduceTemperature'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值添加 Proxy 代理</span></li><li>          <span class="hljs-keyword">let</span> weather2 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">weather</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reduceTemperature</span>(weather2);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>