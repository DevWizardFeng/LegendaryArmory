<h1 _ngcontent-udg-c119="" class="doc-title ng-star-inserted" title="@Once：初始化同步一次"> @Once：初始化同步一次 </h1>

<div _ngcontent-udg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>想要实现仅从外部初始化一次且不接受后续同步变化的能力，可以使用@Once装饰器搭配@Param装饰器。</p> <p>阅读本文档前，请先阅读<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>从API version 12开始，在@ComponentV2装饰的自定义组件中支持使用@Once装饰器。</p>  <p>从API version 12开始，该装饰器支持在元服务中使用。</p>  </div></div></div>  <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>@Once装饰器在变量初始化时接受外部传入值进行初始化，后续数据源更改不会同步给子组件：</p> <ul><li>@Once必须搭配@Param使用，单独使用或搭配其他装饰器使用都是不允许的。</li><li>@Once不影响@Param的观测能力，仅针对数据源的变化做拦截。</li><li>@Once与@Param装饰变量的先后顺序不影响使用功能。</li><li>@Once与@Param搭配使用时，可以在本地修改@Param变量的值。</li></ul> </div>  <div class="tiledSection"><h2 id="装饰器使用规则说明">装饰器使用规则说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器使用规则说明" tips="复制节点链接"></i></h2><p>@Once装饰器作为辅助装饰器，本身没有装饰类型要求和变量观察能力。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="50%">@Once变量装饰器</th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">装饰器参数</td> <td class="cellrowborder" valign="top" width="50%">无。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">使用条件</td> <td class="cellrowborder" valign="top" width="50%">无法单独使用，必须配合@Param装饰器使用。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2><ul><li><p>@Once仅在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>装饰的自定义组件中与@Param搭配使用。</p>  <div _ngcontent-udg-c106="" class="highlight-div"><div _ngcontent-udg-c106="" class="highlight-div-header"><div _ngcontent-udg-c106="" class="highlight-div-header-left"><div _ngcontent-udg-c106="" class="handle-button expand-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-udg-c106="" class="highlight-div-header-right"><div _ngcontent-udg-c106="" class="handle-button ai-button"></div><div _ngcontent-udg-c106="" class="handle-button line-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-udg-c106="" class="handle-button theme-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-udg-c106="" class="handle-button copy-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-udg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">onceParam</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'onceParam'</span>; <span class="hljs-comment">// 正确用法</span></li><li>  <span class="hljs-meta">@Once</span> <span class="hljs-attr">onceStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Once'</span>; <span class="hljs-comment">// 错误用法，@Once无法单独使用</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">onceLocal</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'onceLocal'</span>; <span class="hljs-comment">// 错误用法，@Once不能与@Local一起使用</span></li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Once</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">onceParam</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'onceParam'</span>; <span class="hljs-comment">// 错误用法</span></li><li>}</li></ol></pre></div></div>  </li><li><p>@Once与@Param的先后顺序无关，可以写成@Param @Once也可以写成@Once @Param。</p>  <div _ngcontent-udg-c106="" class="highlight-div"><div _ngcontent-udg-c106="" class="highlight-div-header"><div _ngcontent-udg-c106="" class="highlight-div-header-left"><div _ngcontent-udg-c106="" class="handle-button expand-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-udg-c106="" class="highlight-div-header-right"><div _ngcontent-udg-c106="" class="handle-button ai-button"></div><div _ngcontent-udg-c106="" class="handle-button line-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-udg-c106="" class="handle-button theme-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-udg-c106="" class="handle-button copy-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-udg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">param1</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Once</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">param2</span>: <span class="hljs-built_in">number</span>;</li><li>}</li></ol></pre></div></div>  </li></ul> </div>  <div class="tiledSection"><h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="变量仅初始化同步一次" class="firsth2">变量仅初始化同步一次<i class="anchor-icon anchor-icon-link" anchorid="变量仅初始化同步一次" tips="复制节点链接"></i></h3><p>@Once用于期望变量仅初始化同步数据源一次，之后不再继续同步变化的场景。</p> <div _ngcontent-udg-c106="" class="highlight-div"><div _ngcontent-udg-c106="" class="highlight-div-header"><div _ngcontent-udg-c106="" class="highlight-div-header-left"><div _ngcontent-udg-c106="" class="handle-button expand-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-udg-c106="" class="highlight-div-header-right"><div _ngcontent-udg-c106="" class="handle-button ai-button"></div><div _ngcontent-udg-c106="" class="handle-button line-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-udg-c106="" class="handle-button theme-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-udg-c106="" class="handle-button copy-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-udg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">onceParam</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`onceParam: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.onceParam}</span>`</span>)</li><li>      }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent message: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello Tomorrow'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">onceParam</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> })</li><li>      }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="本地修改param变量">本地修改@Param变量<i class="anchor-icon anchor-icon-link" anchorid="本地修改param变量" tips="复制节点链接"></i></h3><p>当@Once与@Param结合使用时，可以解除@Param无法在本地修改的限制，并能够触发UI刷新。此时，使用@Param和@Once的效果类似于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>，但@Param和@Once还能接收外部传入的初始值。</p> <div _ngcontent-udg-c106="" class="highlight-div"><div _ngcontent-udg-c106="" class="highlight-div-header"><div _ngcontent-udg-c106="" class="highlight-div-header-left"><div _ngcontent-udg-c106="" class="handle-button expand-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-udg-c106="" class="highlight-div-header-right"><div _ngcontent-udg-c106="" class="handle-button ai-button"></div><div _ngcontent-udg-c106="" class="handle-button line-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-udg-c106="" class="handle-button theme-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-udg-c106="" class="handle-button copy-button"><div _ngcontent-udg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-udg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">onceParamNum</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">onceParamInfo</span>: <span class="hljs-title class_">Info</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child onceParamNum: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.onceParamNum}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child onceParamInfo: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.onceParamInfo.name}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeOnceParamNum'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">onceParamNum</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeParamInfo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">onceParamInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Cindy'</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">localNum</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">localInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Tom'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent localNum: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.localNum}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent localInfo: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.localInfo.name}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeLocalNum'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">localNum</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeLocalInfo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">localInfo</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-string">'Cindy'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>({</li><li>        <span class="hljs-attr">onceParamNum</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">localNum</span>,</li><li>        <span class="hljs-attr">onceParamInfo</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">localInfo</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>