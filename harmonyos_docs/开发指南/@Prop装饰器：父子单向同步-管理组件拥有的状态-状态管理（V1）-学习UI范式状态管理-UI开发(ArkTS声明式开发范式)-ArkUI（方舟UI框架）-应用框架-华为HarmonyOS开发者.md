<h1 _ngcontent-ayu-c119="" class="doc-title ng-star-inserted" title="@Prop装饰器：父子单向同步"> @Prop装饰器：父子单向同步 </h1>

<div _ngcontent-ayu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>@Prop装饰的变量可以和父组件建立单向同步关系。</p>    <p>在阅读@Prop文档前，建议开发者首先了解<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>的基本用法。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-status-management" target="_blank">状态管理最佳实践</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 9开始，该装饰器支持在ArkTS卡片中使用。</p>      <p>从API version 11开始，该装饰器支持在元服务中使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@Prop装饰的变量具有以下特性：</p>     <ul>      <li>       <p>@Prop装饰的变量允许本地修改，但修改不会同步回父组件。</p></li>      <li>       <p>当数据源更改时，@Prop装饰的变量都会更新，并且会覆盖本地所有更改。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="装饰器使用规则说明">装饰器使用规则说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器使用规则说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">@Prop变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">无。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">同步类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>单向同步。对父组件状态变量值的修改，将同步给子组件@Prop装饰的变量，子组件@Prop装饰的变量的修改不会同步到父组件的状态变量上。</p>          <p>嵌套类型的场景请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#观察变化">观察变化</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>Object、class、string、number、boolean、enum类型，以及这些类型的数组。</p>          <p>API version 10开始支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰date类型变量">Date类型</a>。</p>          <p>API version 11及以上支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰map类型变量">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰set类型变量">Set</a>类型、undefined和null类型、ArkUI框架定义的联合类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#length" target="_blank">Length</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcecolor" target="_blank">ResourceColor</a>类型以及这些类型的联合类型，示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#prop支持联合类型实例">Prop支持联合类型实例</a>。</p>          <p>支持类型的场景请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#观察变化">观察变化</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">不允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">不支持装饰Function类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">嵌套传递层数</td>         <td class="cellrowborder" valign="top" width="50%">在组件复用场景，建议@Prop深度嵌套数据不要超过5层，嵌套太多会导致深拷贝占用的空间过大以及GarbageCollection(垃圾回收)，引起性能问题，此时更建议使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink</a>。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">被装饰变量的初始值</td>         <td class="cellrowborder" valign="top" width="50%">允许本地初始化。API version 11及以上，如果和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-require">@Require</a>结合使用，则必须父组件构造传参。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="变量的传递访问规则说明">变量的传递/访问规则说明<i class="anchor-icon anchor-icon-link" anchorid="变量的传递访问规则说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">装饰器使用规则</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">从父组件初始化</td>         <td class="cellrowborder" valign="top" width="50%">如果本地有初始化，则是可选的，初始化行为和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state#变量的传递访问规则说明">@State</a>保持一致。没有的话，则必选，支持父组件中的常规变量（常规变量对@Prop赋值，只是数值的初始化，常规变量的变化不会触发UI刷新。只有状态变量才能触发UI刷新）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>、@Prop、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Consume</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage#storagelink">@StorageLink</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage#storageprop">@StorageProp</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstoragelink">@LocalStorageLink</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorageprop">@LocalStorageProp</a>去初始化子组件中的@Prop变量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">用于初始化子组件</td>         <td class="cellrowborder" valign="top" width="50%">@Prop支持初始化子组件中的常规变量、@State、@Link、@Prop、@Provide。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">是否支持组件外访问</td>         <td class="cellrowborder" valign="top" width="50%">@Prop装饰的变量是私有的，只能在组件内访问。</td>        </tr>             </tbody></table></div>     </div>     <p>初始化规则图示：</p>     <p><span><img originheight="273" originwidth="1888" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114955.28873567757797507030935898719320:50001231000000:2800:1EA34A7BFD5D9DFAFD15FBBEC93DCAE369FEFC4F82F7E5E107E716273C51E550.png" width="920" height="133.02966101694915"></span></p>    </div>    <div class="tiledSection">     <h2 id="观察变化和行为表现">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="观察变化" class="firsth2">观察变化<i class="anchor-icon anchor-icon-link" anchorid="观察变化" tips="复制节点链接"></i></h3>          <p>@Prop装饰的数据可以观察到以下变化。</p>     <ul>      <li>       <p>当装饰支持类型，可以观察到赋值的变化。简单类型完整示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#父组件state到子组件prop简单数据类型同步">父组件@State到子组件@Prop简单数据类型同步</a>。</p>       <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 简单类型</span></li><li><span class="hljs-meta">@Prop</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li><span class="hljs-comment">// 赋值的变化可以被观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-comment">// 复杂类型</span></li><li><span class="hljs-meta">@Prop</span> <span class="hljs-attr">title</span>: <span class="hljs-title class_">Model</span>;</li><li><span class="hljs-comment">// 可以观察到赋值的变化</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>(<span class="hljs-string">'Hi'</span>);</li></ol></pre></div></div></li>      <li>       <p>当装饰的类型是Object或者class复杂类型时，可以观察到自身的赋值和第一层的属性的变化，属性即object.keys(observedObject)返回的所有属性。复杂类型完整示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#从父组件中的state类对象属性到prop简单类型的同步">从父组件中的@State类对象属性到@Prop简单类型的同步</a>。</p></li>     </ul>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">string</span>, info: Info</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span> = info;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Prop</span> <span class="hljs-attr">title</span>: <span class="hljs-title class_">Model</span>;</li><li><span class="hljs-comment">// 可以观察到第一层的变化</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'Hi'</span>;</li><li><span class="hljs-comment">// 观察不到第二层的变化</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>.<span class="hljs-property">info</span>.<span class="hljs-property">value</span> = <span class="hljs-string">'ArkUI'</span>;</li></ol></pre></div></div>     <p>对于嵌套场景，如果class是被@Observed装饰的，可以观察到class属性的变化，示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#prop嵌套场景">@Prop嵌套场景</a>。</p>     <ul>      <li>当装饰的类型是数组的时候，可以观察到数组本身的赋值和数组项的添加、删除和更新。数组类型完整示例请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#父组件state数组项到子组件prop简单数据类型同步">父组件@State数组项到子组件@Prop简单数据类型同步</a>。</li>     </ul>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// @Prop装饰的对象为数组时</span></li><li><span class="hljs-meta">@Prop</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>[];</li><li><span class="hljs-comment">// 数组自身的赋值可以观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = [<span class="hljs-string">'1'</span>];</li><li><span class="hljs-comment">// 数组项的赋值可以观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>[<span class="hljs-number">0</span>] = <span class="hljs-string">'2'</span>;</li><li><span class="hljs-comment">// 删除数组项可以观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>.<span class="hljs-title function_">pop</span>();</li><li><span class="hljs-comment">// 新增数组项可以观察到</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'3'</span>);</li></ol></pre></div></div>     <p>对于@State和@Prop的同步场景：</p>     <ul>      <li>       <p>使用父组件中@State变量的值初始化子组件中的@Prop变量。当@State变量变化时，该变量值也会同步更新至@Prop变量。</p></li>      <li>       <p>@Prop装饰的变量的修改不会影响其数据源@State装饰变量的值。</p></li>      <li>       <p>除了@State，数据源也可以用@Link或@Prop装饰，对@Prop的同步机制是相同的。</p></li>      <li>       <p>数据源和@Prop变量的类型需要相同，@Prop允许简单类型和class类型。</p></li>      <li>       <p>当装饰的对象是Date时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds 更新Date的属性，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰date类型变量">装饰Date类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Map时，可以观察到Map整体的赋值，同时可通过调用Map的接口set, clear, delete 更新Map的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰map类型变量">装饰Map类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Set时，可以观察到Set整体的赋值，同时可通过调用Set的接口add, clear, delete 更新Set的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#装饰set类型变量">装饰Set类型变量</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="框架行为">框架行为<i class="anchor-icon anchor-icon-link" anchorid="框架行为" tips="复制节点链接"></i></h3>          <p>理解@Prop变量值初始化和更新机制，需要了解父组件和子组件的渲染和更新流程。</p>     <ol>      <li>       <p>初始渲染：</p>       <ol>        <li>执行父组件的build()函数，创建子组件的新实例并传递数据源。</li>        <li>初始化子组件@Prop装饰的变量。</li>       </ol></li>      <li>       <p>更新：</p>       <ol>        <li>子组件@Prop更新时，更新仅停留在当前子组件，不会同步回父组件。</li>        <li>当父组件的数据源更新时，子组件的@Prop装饰的变量将被来自父组件的数据源重置，所有@Prop装饰变量的本地修改将被父组件的更新覆盖。</li>       </ol></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>@Prop同步数据源依赖于数据源所在组件的刷新，而应用进入后台后无法触发刷新，因此应用进入后台后，@Prop无法从数据源更新。在此场景下，若需即时数据同步，推荐使用@Link代替。</p>      </div></div></div>     <p>以下示例中，当@State装饰的变量message改变时，Father组件会刷新。由于Son组件使用@Prop接收了该变量，因此Father组件刷新的过程中会使用message的最新值去更新@Prop的值。@Prop更新后，会触发Son组件的刷新。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Son</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hi'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Father</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`father click`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'*'</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Son</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ul>      <li>@Prop装饰变量时会进行深拷贝，在拷贝的过程中除了基本类型、Map、Set、Date、Array外，都会丢失类型。例如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>等通过NAPI提供的复杂类型，由于有部分实现在Native侧，因此无法在ArkTS侧通过深拷贝获得完整的数据。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="父组件state到子组件prop简单数据类型同步" class="firsth2">父组件@State到子组件@Prop简单数据类型同步<i class="anchor-icon anchor-icon-link" anchorid="父组件state到子组件prop简单数据类型同步" tips="复制节点链接"></i></h3>          <p>以下示例是@State到子组件@Prop简单数据同步，父组件ParentComponent的状态变量countDownStartValue初始化子组件CountDownComponent中@Prop装饰的count，点击“Try again”，count的修改仅保留在CountDownComponent，不会同步给父组件ParentComponent。</p>     <p>ParentComponent的状态变量countDownStartValue的变化将重置CountDownComponent的count。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CountDownComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">costOfOneAttempt</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> &gt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`You have <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span> Nuggets left`</span>)</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Game over!'</span>)</li><li>      }</li><li>      <span class="hljs-comment">// @Prop装饰的变量不会同步给父组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Try again`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> -= <span class="hljs-variable language_">this</span>.<span class="hljs-property">costOfOneAttempt</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">countDownStartValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Grant <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.countDownStartValue}</span> nuggets to play.`</span>)</li><li>      <span class="hljs-comment">// 父组件的数据源的修改会同步给子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`+1 - Nuggets in New Game`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownStartValue</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>      <span class="hljs-comment">// 父组件的修改会同步给子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`-1  - Nuggets in New Game`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownStartValue</span> -= <span class="hljs-number">1</span>;</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">CountDownComponent</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">countDownStartValue</span>, <span class="hljs-attr">costOfOneAttempt</span>: <span class="hljs-number">2</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ol>      <li>       <p>CountDownComponent子组件首次创建时其@Prop装饰的count变量将从父组件@State装饰的countDownStartValue变量初始化。</p></li>      <li>       <p>按“+1”或“-1”按钮时，父组件的@State装饰的countDownStartValue值会变化，这将触发父组件重新渲染，在父组件重新渲染过程中会刷新使用countDownStartValue状态变量的UI组件，并单向同步更新CountDownComponent子组件中的count值。</p></li>      <li>       <p>更新count状态变量值也会触发CountDownComponent的重新渲染，在重新渲染过程中，评估使用count状态变量的if语句条件（this.count &gt; 0），并执行true分支中的使用count状态变量的UI组件相关描述来更新Text组件的UI显示。</p></li>      <li>       <p>当按下子组件CountDownComponent的“Try again”按钮时，其@Prop变量count将被更改，但是count值的更改不会影响父组件的countDownStartValue值。</p></li>      <li>       <p>父组件的countDownStartValue值变化时，父组件的修改将覆盖掉子组件CountDownComponent中count本地的修改。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="父组件state数组项到子组件prop简单数据类型同步">父组件@State数组项到子组件@Prop简单数据类型同步<i class="anchor-icon anchor-icon-link" anchorid="父组件state数组项到子组件prop简单数据类型同步" tips="复制节点链接"></i></h3>          <p>父组件中@State如果装饰数组类型的变量，其数组项也可以初始化@Prop。以下示例中，父组件Index中@State装饰数组arr，将其数组项初始化子组件Child中@Prop装饰的value。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.value}</span>`</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>++;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] })</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">1</span>] })</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">2</span>] })</li><li>
</li><li>        <span class="hljs-title class_">Divider</span>().<span class="hljs-title function_">height</span>(<span class="hljs-number">5</span>)</li><li>
</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>,</li><li>          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">value</span>: item })</li><li>          },</li><li>          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-title function_">toString</span>()</li><li>        )</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'replace entire arr'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 两个数组都包含项“3”。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] == <span class="hljs-number">1</span> ? [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>] : [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>初始渲染创建6个子组件实例，每个@Prop装饰的变量初始化都在本地拷贝了一份数组项。子组件onClick事件处理程序会更改局部变量值。</p>     <p>如果点击界面上的“1”六次，“2”五次、“3”四次，将所有变量的本地取值都变为“7”。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>7</li><li>7</li><li>7</li><li>——————</li><li>7</li><li>7</li><li>7</li></ol></pre></div></div>     <p>点击replace entire arr后，屏幕将显示以下信息。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>3</li><li>4</li><li>5</li><li>——————</li><li>7</li><li>4</li><li>5</li></ol></pre></div></div>     <ul>      <li>       <p>在子组件Child中做的所有的修改都不会同步回父组件Index组件，所以即使6个组件显示都为7，但在父组件Index中，this.arr保存的值依旧是[1,2,3]。</p></li>      <li>       <p>点击replace entire arr，this.arr[0] == 1成立，将this.arr赋值为[3, 4, 5]。</p></li>      <li>       <p>因为this.arr[0]已更改，Child({value: this.arr[0]})组件将this.arr[0]更新同步到实例@Prop装饰的变量。Child({value: this.arr[1]})和Child({value: this.arr[2]})的情况也类似。</p></li>      <li>       <p>this.arr的更改触发ForEach更新，this.arr更新的前后都有数值为3的数组项：[3, 4, 5] 和[1, 2, 3]。根据diff算法，数组项“3”将被保留，删除“1”和“2”的数组项，添加为“4”和“5”的数组项。这就意味着，数组项“3”的组件不会重新生成，而是将其移动到第一位。所以“3”对应的组件不会更新，此时“3”对应的组件数值为“7”，ForEach最终的渲染结果是“7”，“4”，“5”。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="从父组件中的state类对象属性到prop简单类型的同步">从父组件中的@State类对象属性到@Prop简单类型的同步<i class="anchor-icon anchor-icon-link" anchorid="从父组件中的state类对象属性到prop简单类型的同步" tips="复制节点链接"></i></h3>          <p>如果图书馆有一本图书和两位用户，每位用户都可以将图书标记为已读，此标记行为不会影响其他用户。从代码角度讲，对@Prop图书对象的本地更改不会同步给图书馆组件中的@State图书对象。</p>     <p>在此示例中，图书类可以使用@Observed装饰器，但不是必须的，只有在嵌套结构时需要此装饰器。这一点会在<a href="/consumer/cn/doc/harmonyos-guides/arkts-prop#从父组件中的state数组项到prop-class类型的同步">从父组件中的@State数组项到@Prop class类型的同步</a>说明。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">pages</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">readIt</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span>, pages: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pages</span> = pages;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ReaderComp</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">''</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span>.<span class="hljs-property">title</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`...has<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book.pages}</span> pages!`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`...<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book.readIt ? <span class="hljs-string">'I have read'</span> : <span class="hljs-string">'I have not read it'</span>}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span>.<span class="hljs-property">readIt</span> = <span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Library</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'100 secrets of C++'</span>, <span class="hljs-number">765</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ReaderComp</span>({ <span class="hljs-attr">book</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span> })</li><li>      <span class="hljs-title class_">ReaderComp</span>({ <span class="hljs-attr">book</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="从父组件中的state数组项到prop-class类型的同步">从父组件中的@State数组项到@Prop class类型的同步<i class="anchor-icon anchor-icon-link" anchorid="从父组件中的state数组项到prop-class类型的同步" tips="复制节点链接"></i></h3>          <p>以下示例中，更改了@State装饰的allBooks数组中Book对象的属性，但点击“Mark read for everyone”时，没有触发UI更新。这是因为该属性是第二层的嵌套属性，@State装饰器只能观察到第一层属性，不会观察到此属性更改，所以框架不会更新ReaderComp。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">nextId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li><span class="hljs-comment">// @Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">pages</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">readIt</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span>, pages: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = nextId++;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pages</span> = pages;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ReaderComp</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">book</span>: <span class="hljs-title class_">Book</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">''</span>, <span class="hljs-number">1</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">` <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book ? <span class="hljs-variable language_">this</span>.book.title : <span class="hljs-string">'Book is undefined'</span>}</span>`</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">` has <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book ? <span class="hljs-variable language_">this</span>.book.pages : <span class="hljs-string">'Book is undefined'</span>}</span> pages!`</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">` <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.book ? <span class="hljs-variable language_">this</span>.book.readIt ? <span class="hljs-string">'I have read'</span> : <span class="hljs-string">'I have not read it'</span> : <span class="hljs-string">'Book is undefined'</span>}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">book</span>.<span class="hljs-property">readIt</span> = <span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Library</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">allBooks</span>: <span class="hljs-title class_">Book</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'C#'</span>, <span class="hljs-number">765</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'JS'</span>, <span class="hljs-number">652</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'TS'</span>, <span class="hljs-number">765</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'library`s all time favorite'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0d000000'</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>      <span class="hljs-title class_">ReaderComp</span>({ <span class="hljs-attr">book</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>[<span class="hljs-number">2</span>] })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0d000000'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">colorBlend</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Books on loan to a reader'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0d000000'</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span> })</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>, <span class="hljs-function">(<span class="hljs-params">book: Book</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ReaderComp</span>({ <span class="hljs-attr">book</span>: book })</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">10</span> })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#0d000000'</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>      },</li><li>        <span class="hljs-function">(<span class="hljs-params">book: Book</span>) =&gt;</span> book.<span class="hljs-property">id</span>.<span class="hljs-title function_">toString</span>())</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Add new'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Book</span>(<span class="hljs-string">'JA'</span>, <span class="hljs-number">512</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Remove first book'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>.<span class="hljs-title function_">shift</span>();</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'length &lt;= 0'</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Mark read for everyone'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">allBooks</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">book</span>) =&gt;</span> book.<span class="hljs-property">readIt</span> = <span class="hljs-literal">true</span>)</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用@Observed装饰class Book，Book的属性变化将被观察。需要注意的是，@Prop在子组件装饰的状态变量和父组件的数据源是单向同步关系，即ReaderComp中的@Prop book的修改不会同步给父组件Library。而父组件只会在状态变量发生变化的时候，才会触发UI的重新渲染。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Book</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">pages</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">readIt</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span>, pages: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = nextId++;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pages</span> = pages;</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@Observed装饰的类的实例会被不透明的代理对象包装，此代理可以检测到包装对象内的所有属性更改。如果发生这种情况，此时，代理通知@Prop，@Prop对象值被更新。</p>     <p><span><img originheight="606" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114955.95243584153535057550500294522221:50001231000000:2800:53995A10F8EA04AA1FC6155888990059A0F5AE0514309E3D20C49B48503CB7B0.gif" width="348" height="606"></span></p>    </div>    <div class="tiledSection">     <h3 id="prop本地初始化不和父组件同步">@Prop本地初始化不和父组件同步<i class="anchor-icon anchor-icon-link" anchorid="prop本地初始化不和父组件同步" tips="复制节点链接"></i></h3>          <p>为了支持@Component装饰的组件复用场景，@Prop支持本地初始化，这样可以让@Prop是否与父组件建立同步关系变得可选。当且仅当@Prop有本地初始化时，从父组件向子组件传递@Prop的数据源才是可选的。</p>     <p>下面的示例中，子组件包含两个@Prop变量：</p>     <ul>      <li>       <p>@Prop customCounter没有本地初始化，所以需要父组件提供数据源去初始化@Prop，并当父组件的数据源变化时，@Prop也将被更新。</p></li>      <li>       <p>@Prop customCounter2有本地初始化，在这种情况下，@Prop依旧允许但非强制父组件同步数据源给@Prop。</p></li>     </ul>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">customCounter</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">customCounter2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`From Main: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.customCounter}</span>`</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#ff6b6565'</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: -<span class="hljs-number">110</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click to change locally!'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">288</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">customCounter2</span>++;</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Custom Local: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.customCounter2}</span>`</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#ff6b6565'</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: -<span class="hljs-number">110</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MainProgram</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">mainCounter</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-comment">// customCounter必须从父组件初始化，因为MyComponent的customCounter成员变量缺少本地初始化；此处，customCounter2可以不做初始化。</span></li><li>          <span class="hljs-title class_">MyComponent</span>({ <span class="hljs-attr">customCounter</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainCounter</span> })</li><li>          <span class="hljs-comment">// customCounter2也可以从父组件初始化，父组件初始化的值会覆盖子组件customCounter2的本地初始化的值</span></li><li>          <span class="hljs-title class_">MyComponent</span>({ <span class="hljs-attr">customCounter</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainCounter</span>, <span class="hljs-attr">customCounter2</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainCounter</span> })</li><li>        }</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Click to change number'</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">288</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> })</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">mainCounter</span>++;</li><li>            })</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="252" originwidth="288" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114955.49611043973087247464128635243964:50001231000000:2800:E4B51C0424225AFFE2944618C08F5B2AF693E066F0A283F436F7A76BF9FD7CFD.gif" class="notEnlarge" width="288" height="252"></span></p>    </div>    <div class="tiledSection">     <h3 id="prop嵌套场景">@Prop嵌套场景<i class="anchor-icon anchor-icon-link" anchorid="prop嵌套场景" tips="复制节点链接"></i></h3>          <p>在嵌套场景下，每一层都要用@Observed装饰，且每一层都要被@Prop接收，这样才能观察到嵌套场景。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 以下是嵌套类对象的数据结构。</span></li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Son</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">title: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span> = title;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Father</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">son</span>: <span class="hljs-title class_">Son</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, son: Son</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">son</span> = son;</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以下组件层次结构展示了@Prop嵌套场景的数据结构。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">Father</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Father</span>(<span class="hljs-string">'Hello'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>(<span class="hljs-string">'world'</span>));</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Father name'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Hi'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change Son title'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// person被@State装饰，@State无法观测到嵌套类型的变化，直接点击该按钮，此时title已经发生变化，但是无法被观测到。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">son</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'ArkUI'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ededed'</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#e6000000'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 点击该按钮，此次变化会被观测到，同时能够观察到Button('change Son title')点击后的效果。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Bye'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">son</span>.<span class="hljs-property">title</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ededed'</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">son</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'openHarmony'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">child</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">person</span>.<span class="hljs-property">son</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">child</span>: <span class="hljs-title class_">Son</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Son</span>(<span class="hljs-string">''</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-property">title</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">12</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">312</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#ededed'</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">child</span>.<span class="hljs-property">title</span> = <span class="hljs-string">'Bye Bye'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="233" originwidth="254" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114955.71661207406423277098568562396722:50001231000000:2800:F8E33595D76E49EB874850CD9B9E77B78BA351558862D34D9FAD3B5EE481677E.gif" class="notEnlarge" width="254" height="233"></span></p>    </div>    <div class="tiledSection">     <h3 id="装饰map类型变量">装饰Map类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰map类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@Prop支持Map类型。</p>      </div></div></div>     <p>在下面的示例中，value类型为Map&lt;number, string&gt;，点击Button改变message的值，视图会随之刷新。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">value</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child init map'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child replace the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MapSample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰set类型变量">装饰Set类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰set类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@Prop支持Set类型。</p>      </div></div></div>     <p>在下面的示例中，message类型为Set&lt;number&gt;，点击Button改变message的值，视图会随之刷新。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init set'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SetSample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">message</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰date类型变量">装饰Date类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰date类型变量" tips="复制节点链接"></i></h3>          <p>在下面的示例中，selectedDate类型为Date，点击Button改变Date的值，视图会随之刷新。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DateComponent</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">selectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">''</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child update the new date'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-09-09'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`child increase the year by 1`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getFullYear</span>() + <span class="hljs-number">1</span>);</li><li>      })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">parentSelectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2021-08-08'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'parent update the new date'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentSelectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-07-07'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'parent increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentSelectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">parentSelectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentSelectedDate</span></li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">DateComponent</span>({ <span class="hljs-attr">selectedDate</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentSelectedDate</span> })</li><li>    }</li><li>
</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="prop支持联合类型实例">Prop支持联合类型实例<i class="anchor-icon anchor-icon-link" anchorid="prop支持联合类型实例" tips="复制节点链接"></i></h3>          <p>@Prop支持联合类型和undefined和null，在下面的示例中，animal类型为Animals | undefined，点击父组件Zoo中的Button改变animal的属性或者类型，Child中也会对应刷新。</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animals</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">animal</span>: <span class="hljs-title class_">Animals</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child's animal is  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.animal <span class="hljs-keyword">instanceof</span> Animals ? <span class="hljs-variable language_">this</span>.animal.name : <span class="hljs-string">'undefined'</span>}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Child change animals into tigers'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为Animals的实例</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animals</span>(<span class="hljs-string">'Tiger'</span>);</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Child change animal to undefined'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为undefined</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span> = <span class="hljs-literal">undefined</span>;</li><li>        })</li><li>
</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Zoo</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">animal</span>: <span class="hljs-title class_">Animals</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animals</span>(<span class="hljs-string">'lion'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parents' animals are  <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.animal <span class="hljs-keyword">instanceof</span> Animals ? <span class="hljs-variable language_">this</span>.animal.name : <span class="hljs-string">'undefined'</span>}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>
</li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">animal</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span>})</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Parents change animals into dogs'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 判断animal的类型，做属性的更新</span></li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span> <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Animals</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Dog'</span>;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'num is undefined, cannot change property'</span>);</li><li>          }</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Parents change animal to undefined'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 赋值为undefined</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">animal</span> = <span class="hljs-literal">undefined</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="prop装饰状态变量未初始化错误" class="firsth2">@Prop装饰状态变量未初始化错误<i class="anchor-icon anchor-icon-link" anchorid="prop装饰状态变量未初始化错误" tips="复制节点链接"></i></h3>          <p>@Prop需要被初始化，如果没有进行本地初始化的，则必须通过父组件进行初始化。如果进行了本地初始化，那么是可以不通过父组件进行初始化的。</p>     <p>【反例】</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Commodity</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">price: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">price</span> = price;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PropChild</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">fruit</span>: <span class="hljs-title class_">Commodity</span>; <span class="hljs-comment">// 未进行本地初始化</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`PropChild fruit <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fruit.price}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>.<span class="hljs-property">price</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">fruit</span>: <span class="hljs-title class_">Commodity</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Commodity</span>(<span class="hljs-number">1</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent fruit <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fruit[<span class="hljs-number">0</span>].price}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>[<span class="hljs-number">0</span>].<span class="hljs-property">price</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// @Prop本地没有初始化，也没有从父组件初始化</span></li><li>      <span class="hljs-title class_">PropChild</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>【正例】</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Commodity</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">price: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">price</span> = price;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PropChild1</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">fruit</span>: <span class="hljs-title class_">Commodity</span>; <span class="hljs-comment">// 未进行本地初始化</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`PropChild1 fruit <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fruit.price}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>.<span class="hljs-property">price</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PropChild2</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">fruit</span>: <span class="hljs-title class_">Commodity</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Commodity</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 进行本地初始化</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`PropChild2 fruit <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fruit.price}</span>`</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>.<span class="hljs-property">price</span> += <span class="hljs-number">1</span>;</li><li>      })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">fruit</span>: <span class="hljs-title class_">Commodity</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">Commodity</span>(<span class="hljs-number">1</span>)];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent fruit <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.fruit[<span class="hljs-number">0</span>].price}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>[<span class="hljs-number">0</span>].<span class="hljs-property">price</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// @PropChild1本地没有初始化，必须从父组件初始化</span></li><li>      <span class="hljs-title class_">PropChild1</span>({ <span class="hljs-attr">fruit</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>[<span class="hljs-number">0</span>] })</li><li>      <span class="hljs-comment">// @PropChild2本地进行了初始化，可以不从父组件初始化，也可以从父组件初始化</span></li><li>      <span class="hljs-title class_">PropChild2</span>()</li><li>      <span class="hljs-title class_">PropChild2</span>({ <span class="hljs-attr">fruit</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">fruit</span>[<span class="hljs-number">0</span>] })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用abthisobject形式调用不会触发ui刷新">使用a.b(this.object)形式调用，不会触发UI刷新<i class="anchor-icon anchor-icon-link" anchorid="使用abthisobject形式调用不会触发ui刷新" tips="复制节点链接"></i></h3>          <p>在build方法内，当@Prop装饰的变量是Object类型、且通过a.b(this.object)形式调用时，b方法内传入的是this.object的原始对象，修改其属性，无法触发UI刷新。如下例中，通过静态方法Score.changeScore1或者this.changeScore2修改自定义组件Child中的this.score.value时，UI不会刷新。</p>     <p>【反例】</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Score</span> {</li><li>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeScore1</span>(<span class="hljs-params">param1:Score</span>) {</li><li>    param1.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">score</span>: <span class="hljs-title class_">Score</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Score</span>(<span class="hljs-number">1</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">8</span>}) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The value in Parent is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.score.value}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">score</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">score</span>: <span class="hljs-title class_">Score</span>;</li><li>
</li><li>  <span class="hljs-title function_">changeScore2</span>(<span class="hljs-params">param2:Score</span>) {</li><li>    param2.<span class="hljs-property">value</span> += <span class="hljs-number">2</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">8</span>}) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The value in Child is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.score.value}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`changeScore1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过静态方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-title class_">Score</span>.<span class="hljs-title function_">changeScore1</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`changeScore2`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 使用this通过自定义组件内部方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeScore2</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>可以通过如下先赋值、再调用新赋值的变量的方式为this.score加上Proxy代理，实现UI刷新。</p>     <p>【正例】</p>     <div _ngcontent-ayu-c106="" class="highlight-div"><div _ngcontent-ayu-c106="" class="highlight-div-header"><div _ngcontent-ayu-c106="" class="highlight-div-header-left"><div _ngcontent-ayu-c106="" class="handle-button expand-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ayu-c106="" class="highlight-div-header-right"><div _ngcontent-ayu-c106="" class="handle-button ai-button"></div><div _ngcontent-ayu-c106="" class="handle-button line-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ayu-c106="" class="handle-button theme-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ayu-c106="" class="handle-button copy-button"><div _ngcontent-ayu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ayu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Score</span> {</li><li>  <span class="hljs-attr">value</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">value: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">value</span> = value;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeScore1</span>(<span class="hljs-params">score:Score</span>) {</li><li>    score.<span class="hljs-property">value</span> += <span class="hljs-number">1</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">score</span>: <span class="hljs-title class_">Score</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Score</span>(<span class="hljs-number">1</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">8</span>}) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The value in Parent is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.score.value}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">score</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Prop</span> <span class="hljs-attr">score</span>: <span class="hljs-title class_">Score</span>;</li><li>
</li><li>  <span class="hljs-title function_">changeScore2</span>(<span class="hljs-params">score:Score</span>) {</li><li>    score.<span class="hljs-property">value</span> += <span class="hljs-number">2</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({<span class="hljs-attr">space</span>:<span class="hljs-number">8</span>}) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`The value in Child is <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.score.value}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`changeScore1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值添加 Proxy 代理</span></li><li>          <span class="hljs-keyword">let</span> score1 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span>;</li><li>          <span class="hljs-title class_">Score</span>.<span class="hljs-title function_">changeScore1</span>(score1);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`changeScore2`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值添加 Proxy 代理</span></li><li>          <span class="hljs-keyword">let</span> score2 = <span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeScore2</span>(score2);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>