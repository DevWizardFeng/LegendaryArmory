<h1 _ngcontent-nnr-c119="" class="doc-title ng-star-inserted" title="@Provider装饰器和@Consumer装饰器：跨组件层级双向同步"> @Provider装饰器和@Consumer装饰器：跨组件层级双向同步 </h1>

<div _ngcontent-nnr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>@Provider和@Consumer用于跨组件层级数据双向同步，可以使得开发者不用拘泥于组件层级。</p> <p>@Provider和@Consumer属于状态管理V2装饰器，所以只能在@ComponentV2中才能使用，在@Component中使用会编译报错。</p> <p>@Provider和@Consumer提供了跨组件层级数据双向同步的能力。在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>@Provider和@Consumer装饰器从API version 12开始支持。</p>  <p>从API version 12开始，@Provider和@Consumer装饰器支持在元服务中使用。</p>  </div></div></div>  <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>@Provider，即数据提供方，其所有的子组件都可以通过@Consumer绑定相同的key来获取@Provider提供的数据。</p> <p>@Consumer，即数据消费方，可以通过绑定同样的key获取其最近父节点的@Provider的数据，当查找不到@Provider的数据时，使用本地默认值。图示如下。</p> <p><span><img originheight="436" originwidth="1142" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115003.86324075126521663932979040293322:50001231000000:2800:50BAE35BF391EB36094AC37B0305E93461DD4C3C81CE65FFBEB4E2896B9A0E08.png" width="920" height="351.2434325744308"></span></p> <p>@Provider和@Consumer装饰的数据类型需要一致。</p> <p>开发者在使用@Provider和@Consumer时要注意：</p> <ul><li>@Provider和@Consumer强依赖自定义组件层级，@Consumer会因为所在组件的父组件不同，而被初始化为不同的值。</li><li>@Provider和@Consumer相当于把组件粘合在一起了，从组件独立角度考虑，应减少使用@Provider和@Consumer。</li></ul> </div>  <div class="tiledSection"><h2 id="provider和consumer-vs-provide和consume能力对比">@Provider和@Consumer vs @Provide和@Consume能力对比<i class="anchor-icon anchor-icon-link" anchorid="provider和consumer-vs-provide和consume能力对比" tips="复制节点链接"></i></h2><p>在状态管理V1版本中，提供跨组件层级双向的装饰器为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide和@Consume</a>，当前文档介绍的是状态管理V2装饰器@Provider和@Consumer。虽然两者名字和功能类似，但在特性上还存在一些差异。</p> <p>如果开发者不了解状态管理V1中的@Provide和@Consume，可以直接跳过本节。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.1" valign="top" width="33.33333333333333%">能力</th> <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.2" valign="top" width="33.33333333333333%">V2装饰器@Provider和@Consumer</th> <th align="left" class="cellrowborder" id="mcps1.3.6.4.1.4.1.3" valign="top" width="33.33333333333333%">V1装饰器@Provide和@Consume</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">@Consume(r)</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">必须本地初始化，当找不到@Provider时使用本地默认值。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">API version 20以前，@Consume禁止本地初始化，当找不到对应@Provide的时候，会抛出异常；从API version 20开始，@Consume支持设置默认值，如果没有设置默认值，且找不到对应@Provide时，会抛出异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">支持类型</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">支持function。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持function。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">观察能力</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">仅能观察自身赋值变化，如果要观察嵌套场景，配合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>一起使用。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">观察第一层变化，如果要观察嵌套场景，配合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed和@ObjectLink</a>一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">alias和属性名</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">alias是唯一匹配的key，缺省时默认属性名为alias。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">alias和属性名都为key，优先匹配alias，匹配不到可以匹配属性名。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">@Provide(r) 从父组件初始化</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">不允许。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">允许。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">@Provide(r)支持重载</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">默认开启，即@Provider可以重名，@Consumer向上查找最近的@Provider。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">默认关闭，即在组件树上不允许有同名@Provide。如果需要重载，则需要配置allowOverride。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="基本规则" class="firsth2">基本规则<i class="anchor-icon anchor-icon-link" anchorid="基本规则" tips="复制节点链接"></i></h3><p>@Provider语法：</p> <p>@Provider(aliasName?: string) varName : varType = initValue</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.1" valign="top" width="50%">@Provider属性装饰器</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">装饰器参数</td> <td class="cellrowborder" valign="top" width="50%">aliasName?: string，别名，缺省时默认为属性名。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">支持类型</td> <td class="cellrowborder" valign="top" width="50%">自定义组件中成员变量。属性的类型可以为number、string、boolean、class、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer#装饰array类型变量">Array</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer#装饰date类型变量">Date</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer#装饰map类型变量">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer#装饰set类型变量">Set</a>等类型。支持装饰<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer#provider和consumer装饰回调事件用于组件之间完成行为抽象">箭头函数</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">从父组件初始化</td> <td class="cellrowborder" valign="top" width="50%">禁止。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">本地初始化</td> <td class="cellrowborder" valign="top" width="50%">必须本地初始化。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">观察能力</td> <td class="cellrowborder" valign="top" width="50%">能力等同于@Trace。变化会同步给对应的@Consumer。</td> </tr>  </tbody></table></div> </div> <p>@Consumer语法：</p> <p>@Consumer(aliasName?: string) varName : varType = initValue</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.7.1.3.1.1" valign="top" width="50%">@Consumer属性装饰器</th> <th align="left" class="cellrowborder" id="mcps1.3.8.7.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">装饰器参数</td> <td class="cellrowborder" valign="top" width="50%">aliasName?: string，别名，缺省时默认为属性名，向上查找最近的@Provider。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">可装饰的变量</td> <td class="cellrowborder" valign="top" width="50%">自定义组件中成员变量。属性的类型可以为number、string、boolean、class、Array、Date、Map、Set等类型。支持装饰箭头函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">从父组件初始化</td> <td class="cellrowborder" valign="top" width="50%">禁止。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">本地初始化</td> <td class="cellrowborder" valign="top" width="50%">必须本地初始化。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">观察能力</td> <td class="cellrowborder" valign="top" width="50%">能力等同于@Trace。变化会同步给对应的@Provider。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="aliasname和属性名">aliasName和属性名<i class="anchor-icon anchor-icon-link" anchorid="aliasname和属性名" tips="复制节点链接"></i></h3><p>@Provider和@Consumer接受可选参数aliasName，没有配置参数时，使用属性名作为默认的aliasName。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>aliasName是用于@Provider和@Consumer进行匹配的唯一指定key。</p>  </div></div></div> <p>以下三个例子可清楚介绍@Provider和@Consumer如何使用aliasName进行查找匹配。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// 未定义aliasName, 使用属性名'str'作为aliasName</span></li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 定义aliasName为'str'，使用aliasName去寻找</span></li><li>  <span class="hljs-comment">// 能够在Parent组件上找到, 使用@Provider的值'hello'</span></li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'str'</span>) <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'world'</span>;</li><li>}</li></ol></pre></div></div> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// 定义aliasName为'alias'</span></li><li>  <span class="hljs-meta">@Provider</span>(<span class="hljs-string">'alias'</span>) <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 定义aliasName为 'alias'，找到@Provider并获得值'hello'</span></li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'alias'</span>) <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'world'</span>;</li><li>}</li></ol></pre></div></div> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// 定义aliasName为'alias'</span></li><li>  <span class="hljs-meta">@Provider</span>(<span class="hljs-string">'alias'</span>) <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 未定义aliasName，使用属性名'str'作为aliasName</span></li><li>  <span class="hljs-comment">// 没有找到对应的@Provider，使用本地值'world'</span></li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'world'</span>;</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="变量传递">变量传递<i class="anchor-icon anchor-icon-link" anchorid="变量传递" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.1" valign="top" width="50%">传递规则</th> <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">从父组件初始化</td> <td class="cellrowborder" valign="top" width="50%">@Provider和@Consumer装饰的变量仅允许本地初始化，不允许从外部传入初始化。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">初始化子组件</td> <td class="cellrowborder" valign="top" width="50%">@Provider和@Consumer装饰的变量可以初始化子组件中@Param装饰的变量。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2><ol><li>@Provider和@Consumer为自定义组件的属性装饰器，只能装饰自定义组件内的属性，不能装饰class的属性。</li><li>@Provider和@Consumer为状态管理V2装饰器，只能在@ComponentV2中使用，不能在@Component中使用。</li><li>@Provider和@Consumer只支持本地初始化，不支持外部传入初始化。</li></ol> </div>  <div class="tiledSection"><h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="provider和consumer双向同步" class="firsth2">@Provider和@Consumer双向同步<i class="anchor-icon anchor-icon-link" anchorid="provider和consumer双向同步" tips="复制节点链接"></i></h3><p><strong>建立双向绑定</strong></p> <ol><li>自定义组件Parent和Child初始化：<ul><li>Child中@Consumer() str: string = 'world'向上查找，查找到Parent中声明的@Provider() str: string = 'hello'。</li><li>@Consumer() str: string = 'world'初始化为其查找到的@Provider的值，即'hello'。</li><li>两者建立双向同步关系。</li></ul>  </li><li>点击Parent中的按钮，改变@Provider装饰的str，通知其对应的@Consumer，对应UI刷新。</li><li>点击Child中的按钮，改变@Consumer装饰的str，通知其对应的@Provider，对应UI刷新。</li></ol> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @Consumer装饰的属性str和Parent组件中@Provider装饰的属性str名称相同，因此建立了双向绑定关系</span></li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p><strong>未建立双向绑定</strong></p> <p>下面的例子中，@Provider和@Consumer由于aliasName值不同，无法建立双向同步关系。</p> <ol><li>自定义组件Parent和Child初始化：<ul><li>Child中@Consumer() str: string = 'world'向上查找，未查找到其数据提供方@Provider。</li><li>@Consumer() str: string = 'world'使用其本地默认值为'world'。</li><li>两者未建立双向同步关系。</li></ul>  </li><li>点击Parent中的按钮，改变@Provider装饰的str1，仅刷新@Provider关联的Button组件。</li><li>点击Child中的按钮，改变@Consumer装饰的str，仅刷新@Consumer关联的Button组件。</li></ol> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">str1</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str1</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">str1</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @Consumer装饰的属性str和Parent组件中@Provider装饰的属性str1名称不同，无法建立双向绑定关系</span></li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'world'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="装饰array类型变量">装饰Array类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰array类型变量" tips="复制节点链接"></i></h3><p>当装饰的对象是Array时，可以观察到Array整体的赋值，同时可以通过调用Array的接口push, pop, shift, unshift, splice, copyWithin, fill, reverse, sort更新Array中的数据。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`parent: <span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">push</span>(<span class="hljs-number">111</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'reverse'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">reverse</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'fill'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">fill</span>(<span class="hljs-number">6</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Child</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">9</span>,<span class="hljs-number">8</span>,<span class="hljs-number">7</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child: <span class="hljs-subst">${item}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'push'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">push</span>(<span class="hljs-number">222</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'reverse'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">reverse</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'fill'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>.<span class="hljs-title function_">fill</span>(<span class="hljs-number">8</span>);</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="装饰date类型变量">装饰Date类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰date类型变量" tips="复制节点链接"></i></h3><p>当装饰Date类型变量时，可以观察到数据源对Date整体的赋值，以及调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds带来的变化。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-title class_">SelectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2021-08-08'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`parent: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.SelectedDate}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update the new date'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-07-07'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the year by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getFullYear</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the month by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setMonth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-title class_">SelectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2022-07-07'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.SelectedDate}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'update the new date'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2025-01-01'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the year by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getFullYear</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the month by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setMonth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">SelectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="装饰map类型变量">装饰Map类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰map类型变量" tips="复制节点链接"></i></h3><p>当装饰Map类型变量时，可以观察到数据源对Map整体的赋值，以及调用Map的接口set, clear, delete带来的变化。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init map'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'bb'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'cc'</span>]]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'a~'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'d'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'e'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'f'</span>]]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init map'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'dd'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'ee'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'ff'</span>]]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'g'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'a*'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="装饰set类型变量">装饰Set类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰set类型变量" tips="复制节点链接"></i></h3><p>当装饰Set类型变量时，可以观察到数据源对Set整体的赋值，以及调用Set的接口 add, clear, delete带来的变化。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init set'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">1</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Child'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init set'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">7</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">1</span>);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="provider和consumer装饰回调事件用于组件之间完成行为抽象">@Provider和@Consumer装饰回调事件用于组件之间完成行为抽象<i class="anchor-icon anchor-icon-link" anchorid="provider和consumer装饰回调事件用于组件之间完成行为抽象" tips="复制节点链接"></i></h3><p>当需要在父组件中向子组件注册回调函数时，可以使用@Provider和@Consumer装饰回调方法来实现。</p> <p>在拖拽场景中，若需将子组件的拖拽起始位置信息同步给父组件，可参考以下示例。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">childX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">childY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">onDrag</span>: <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onDrag event at x=<span class="hljs-subst">${x}</span> y:<span class="hljs-subst">${y}</span>`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childX</span> = x;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">childY</span> = y;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child position x: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childX}</span>, y: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childY}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">onDrag</span>: <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">(<span class="hljs-params">x: <span class="hljs-built_in">number</span>, y: <span class="hljs-built_in">number</span></span>) =&gt;</span> {};</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changed'</span>)</li><li>      .<span class="hljs-title function_">draggable</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">onDragStart</span>(<span class="hljs-function">(<span class="hljs-params">event: DragEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">// 当前预览器上不支持通用拖拽事件</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onDrag</span>(event.<span class="hljs-title function_">getDisplayX</span>(), event.<span class="hljs-title function_">getDisplayY</span>());</li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="provider和consumer装饰复杂类型配合trace一起使用">@Provider和@Consumer装饰复杂类型，配合@Trace一起使用<i class="anchor-icon anchor-icon-link" anchorid="provider和consumer装饰复杂类型配合trace一起使用" tips="复制节点链接"></i></h3><ol><li>@Provider和@Consumer只能观察到数据本身的变化。如果需要观察其装饰的复杂数据类型的属性变化，必须配合@Trace一起使用。</li><li>装饰内置类型：Array、Map、Set、Date时，可以观察到某些API的变化，观察能力同<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace#观察变化">@Trace</a>。</li></ol> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">User</span>[] = [<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Json'</span>, <span class="hljs-number">10</span>), <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Eric'</span>, <span class="hljs-number">15</span>)];</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>(<span class="hljs-string">'data'</span>) <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[] = data;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Child</span>()</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'add new user'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-string">'Molly'</span>, <span class="hljs-number">18</span>));</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'age++'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>[<span class="hljs-number">0</span>].<span class="hljs-property">age</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>[<span class="hljs-number">0</span>].<span class="hljs-property">name</span> = <span class="hljs-string">'Shelly'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'data'</span>) <span class="hljs-attr">users</span>: <span class="hljs-title class_">User</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">users</span>, <span class="hljs-function">(<span class="hljs-params">item: User</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${item.name}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`age: <span class="hljs-subst">${item.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="provider重名时consumer向上查找其最近的provider">@Provider重名时，@Consumer向上查找其最近的@Provider<i class="anchor-icon anchor-icon-link" anchorid="provider重名时consumer向上查找其最近的provider" tips="复制节点链接"></i></h3><p>@Provider可以在组件树上重名，@Consumer会向上查找其最近父节点的@Provider的数据。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Parent</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;</li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'val'</span>) <span class="hljs-attr">val2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 10</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val2}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 20</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>上面的例子中：</p> <ul><li>Parent中的@Consumer向上查找，查找到Index中定义的@Provider() val: number = 10，初始化为10。</li><li>Child中的@Consumer向上查找，查找到Parent中定义的@Provider() val: number = 20后停止，初始化为20。</li></ul> </div>  <div class="tiledSection"><h3 id="provider和consumer初始化param">@Provider和@Consumer初始化@Param<i class="anchor-icon anchor-icon-link" anchorid="provider和consumer初始化param" tips="复制节点链接"></i></h3><p>@Provider和@Consumer装饰的变量可以初始化子组件中@Param装饰的变量。</p> <div _ngcontent-nnr-c106="" class="highlight-div"><div _ngcontent-nnr-c106="" class="highlight-div-header"><div _ngcontent-nnr-c106="" class="highlight-div-header-left"><div _ngcontent-nnr-c106="" class="handle-button expand-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nnr-c106="" class="highlight-div-header-right"><div _ngcontent-nnr-c106="" class="handle-button ai-button"></div><div _ngcontent-nnr-c106="" class="handle-button line-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nnr-c106="" class="handle-button theme-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nnr-c106="" class="handle-button copy-button"><div _ngcontent-nnr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nnr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provider</span>() <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Index @Provider val: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Parent</span>({ <span class="hljs-attr">val2</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Consumer</span>() <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">val2</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent @Consumer val: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change val'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span>++;</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent @Param val2: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val2}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">val</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> })</li><li>    }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span> })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Child @Param val <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>    }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">2</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span> })</li><li>  }</li><li>}</li></ol></pre></div></div> <p>上面的例子中：</p> <ul><li>Index中@Provider装饰的变量val与Parent中@Consumer装饰的变量val建立双向数据绑定。Parent中@Param装饰的变量val2接收Index中数据源val的数据，并同步其变化。Child中@Param装饰的变量val接收Parent中数据源val的数据，并同步其变化。</li><li>点击Parent中的按钮，触发@Consumer() val的变化，变化同步给Index中的@Provider() val和Child中的@Param val，对应UI刷新。</li><li>Index中@Provider() val的变化同步给Parent中的@Param val2，对应UI刷新。</li></ul> </div> </div> <div></div></div>