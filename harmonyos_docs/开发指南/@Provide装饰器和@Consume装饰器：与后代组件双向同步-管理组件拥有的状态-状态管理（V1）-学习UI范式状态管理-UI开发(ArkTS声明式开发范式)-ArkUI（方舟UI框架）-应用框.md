<h1 _ngcontent-cqf-c119="" class="doc-title ng-star-inserted" title="@Provide装饰器和@Consume装饰器：与后代组件双向同步"> @Provide装饰器和@Consume装饰器：与后代组件双向同步 </h1>

<div _ngcontent-cqf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>@Provide和@Consume，应用于与后代组件的双向数据同步、状态数据在多个层级之间传递的场景。不同于上文提到的父子组件之间通过命名参数机制传递，@Provide和@Consume摆脱参数传递机制的束缚，实现跨层级传递。</p>    <p>其中@Provide装饰的变量是在祖先组件中，可以理解为被“提供”给后代的状态变量。@Consume装饰的变量是在后代组件中，去“消费（绑定）”祖先组件提供的变量。</p>    <p>@Provide/@Consume是跨组件层级的双向同步。在阅读@Provide和@Consume文档前，建议开发者对UI范式基本语法和自定义组件有基本的了解。建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-basic-syntax-overview">基本语法概述</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-declarative-ui-description">声明式UI描述</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components">创建自定义组件</a>。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-status-management" target="_blank">状态管理最佳实践</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 9开始，这两个装饰器支持在ArkTS卡片中使用。</p>      <p>从API version 11开始，这两个装饰器支持在元服务中使用。</p>      <p>API version 19及以前，@Provide和@Consume双向同步仅支持声明式节点场景。</p>      <p>从API version 20开始，@Consume装饰的变量支持设置默认值。当查找不到@Provide的匹配结果时，@Consume装饰的变量会使用默认值进行初始化；当查找到@Provide的匹配结果时，@Consume装饰的变量会优先使用@Provide匹配结果的值，默认值不生效。</p>      <p>从API version 20开始，通过配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode#buildoptions12" target="_blank">BuildOptions</a>参数enableProvideConsumeCrossing为true，使得@Provide和@Consume支持跨<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-buildernode" target="_blank">BuilderNode</a>双向同步。但需要注意，BuilderNode会在上树前构造节点，所以BuilderNode内部定义的@Consume需要设置默认值，并在BuilderNode上树后，重新获取最近的@Provide数据，与之建立双向同步关系。具体可见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#consume在跨buildernode场景下和provide建立双向同步">@Consume在跨BuilderNode场景下和@Provide建立双向同步</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@Provide/@Consume装饰的状态变量有以下特性：</p>     <ul>      <li>       <p>@Provide装饰的状态变量自动对其所有后代组件可用，开发者不需要多次在组件之间传递变量。</p></li>      <li>       <p>后代通过使用@Consume获取@Provide提供的变量，建立在@Provide和@Consume之间的双向数据同步，与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a>不同的是，前者可以更便捷的在多层级父子组件之间传递。</p></li>      <li>       <p>@Provide和@Consume通过变量名或者变量别名绑定，需要类型相同，否则会发生类型隐式转换，从而导致应用行为异常。</p></li>     </ul>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过相同的变量名绑定</span></li><li><span class="hljs-meta">@Provide</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-meta">@Consume</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li><span class="hljs-comment">// 通过相同的变量别名绑定</span></li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-meta">@Consume</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li><span class="hljs-comment">// 通过Provide的变量别名和Consume的变量名相同绑定</span></li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-meta">@Consume</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li><span class="hljs-comment">// 通过Provide的变量名和Consume的变量别名绑定</span></li><li><span class="hljs-meta">@Provide</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-meta">@Consume</span>(<span class="hljs-string">'id'</span>) <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>     <p>当@Provide指定变量别名时，会同时保存变量名与变量别名，@Consume在查找时，会优先以变量别名作为查找值去匹配，如果没有别名则用变量名作为查找值，只要@Consume提供的查找值与@Provide保存的变量名或别名中任意一项一致，即可成功建立绑定关系。</p>    </div>    <div class="tiledSection">     <h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">@Provide变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">          <p>别名：常量字符串，可选。</p>          <p>如果指定了别名，则通过别名来绑定变量；如果未指定别名，则通过变量名绑定变量。</p>          <p>allowOverride：允许重写，string类型，可选。</p>          <p>如果使用allowOverride指定别名，则别名可以被重写，即可以存在同名的@Provide变量。</p>          <p>未使用allowOverride时则不允许重名。示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#provide支持allowoverride参数">@Provide支持allowOverride参数</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>Object、class、string、number、boolean、enum类型，以及这些类型的数组。</p>          <p>API version 10开始支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰date类型变量">Date类型</a>。</p>          <p>API version 11及以上支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰map类型变量">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰set类型变量">Set</a>类型、undefined和null类型、ArkUI框架定义的联合类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#length" target="_blank">Length</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcecolor" target="_blank">ResourceColor</a>类型以及这些类型的联合类型，示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#provide和consume支持联合类型实例">@Provide和Consume支持联合类型实例</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">不允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">不支持装饰Function类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">初始化规则</td>         <td class="cellrowborder" valign="top" width="50%">          <p>必须定义本地默认值。</p>          <p>可以从父组件传入非undefined类型变量，此时使用该传入变量进行初始化。</p>          <p>父组件未传入或传入undefined类型变量时，使用本地默认值进行初始化。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">同步规则</td>         <td class="cellrowborder" valign="top" width="50%">          <p><strong>在子组件使用时：</strong></p>          <p>不与父组件中的任何类型变量同步。</p>          <p>父组件传入的外部变量对@Provide初始化时，仅作为初始值，后续变量的变化不会同步至@Provide。</p>          <p><strong>在父组件使用时：</strong></p>          <p>可以初始化子组件的常规变量、@State、@Link、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>、@Provide。</p>          <p>@Provide变量的变化会同步给子组件的@Link、@Prop变量。</p>          <p>与后代子组件中别名匹配的@Consume变量双同步。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>图1</strong> @Provide初始化规则图示</p>     <p><span><img originheight="273" originwidth="1883" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114958.23909868026635831600595220709922:50001231000000:2800:8593F6BEB743CD4E1C7B7725CBC84A0905E14187407592C41F6CCEC83E9D4409.png" width="920" height="133.38289962825277"></span></p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.3.1.1" valign="top" width="50%">@Consume变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">          <p>别名：常量字符串，可选。</p>          <p>如果指定了别名，则通过别名来绑定变量；如果未指定别名，则通过变量名绑定变量。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>Object、class、string、number、boolean、enum类型，以及这些类型的数组。</p>          <p>API version 10开始支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰date类型变量">Date类型</a>。</p>          <p>API version 11及以上支持<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰map类型变量">Map</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰set类型变量">Set</a>类型、undefined和null类型、ArkUI框架定义的联合类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#length" target="_blank">Length</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcestr" target="_blank">ResourceStr</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-types#resourcecolor" target="_blank">ResourceColor</a>类型以及这些类型的联合类型，示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#provide和consume支持联合类型实例">@Provide和Consume支持联合类型实例</a>。</p>          <p><strong>说明：</strong></p>          <p>API version 20之前，@Consume装饰的变量，在其父组件或者祖先组件上，必须有对应的属性和别名的@Provide装饰的变量。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">不允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">不支持装饰Function类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">初始化规则</td>         <td class="cellrowborder" valign="top" width="50%">          <p>API version 20之前，@Consume装饰的变量不支持本地设置默认值，必须要有与其匹配的@Provide装饰的变量。</p>          <p>从API version 20开始，@Consume支持设置默认值。若存在匹配成功的@Provide，则会使用@Provide的变量值作为初始值。若未匹配到@Provide变量，则使用本地默认值。示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#consume装饰的变量支持设置默认值">@Consume装饰的变量支持设置默认值</a>。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">同步规则</td>         <td class="cellrowborder" valign="top" width="50%">          <p><strong>在子组件使用时：</strong></p>          <p>与祖先组件匹配的@Provide变量双向同步。</p>          <p><strong>在父组件使用时：</strong></p>          <p>可以初始化子组件的常规变量、@State、@Link、@Prop、@Provide。</p>          <p>@Consume变量的变化会同步给子组件的@Link、@Prop变量。</p></td>        </tr>             </tbody></table></div>     </div>     <p><strong>图2</strong> @Consume初始化规则图示</p>     <p><span><img originheight="232" originwidth="799" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114959.55183225038099603858551979772637:50001231000000:2800:EB371385D3F522B00E0461479B014740AEB259C70DADE769183A6671810627F3.png" width="799" height="232"></span></p>    </div>    <div class="tiledSection">     <h2 id="观察变化和行为表现">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="观察变化" class="firsth2">观察变化<i class="anchor-icon anchor-icon-link" anchorid="观察变化" tips="复制节点链接"></i></h3>          <ul>      <li>       <p>当装饰的数据类型为boolean、string、number类型时，可以观察到数值的变化。</p></li>      <li>       <p>当装饰的数据类型为class或者Object的时候，可以观察到赋值和属性赋值的变化（属性为Object.keys(observedObject)返回的所有属性）。</p></li>      <li>       <p>当装饰Array时，可以观察到数组本身、数组项的赋值及其API操作带来的变化。</p></li>      <li>       <p>当装饰的对象是Date时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds 更新Date的属性，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰date类型变量">装饰Date类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Map时，可以观察到Map整体的赋值，同时可通过调用Map的接口set, clear, delete 更新Map的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰map类型变量">装饰Map类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Set时，可以观察到Set整体的赋值，同时可通过调用Set的接口add, clear, delete 更新Set的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#装饰set类型变量">装饰Set类型变量</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="框架行为">框架行为<i class="anchor-icon anchor-icon-link" anchorid="框架行为" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>初始渲染：</p>       <ol>        <li>@Provide装饰的变量会以Map的形式，传递给当前@Provide所属组件的所有子组件。</li>        <li>子组件中如果使用@Consume变量，则会在Map中查找是否有该变量名/alias（别名）对应的@Provide的变量。在API version 20之前，如果查找不到，框架会抛出JS ERROR。从API version 20开始，如果查找不到，会判断@Consume装饰的变量是否设置了默认值，如果没有设置默认值，框架会抛出JS ERROR。</li>        <li>在初始化@Consume变量时，如果在Map中有该变量名/alias（别名）对应的@Provide的变量，则和@State/@Link的流程类似，@Consume变量会在Map中查找到对应的@Provide变量进行保存，并把自己注册给@Provide。</li>        <li>从API version 20开始，在初始化@Consume变量时，如果在Map中没有该变量名/alias（别名）对应的@Provide的变量，而@Consume的变量设置了默认值时，@Consume变量会利用默认值创建一个临时的数据源，保证通知链路的连续性。</li>       </ol></li>      <li>       <p>当@Provide装饰的数据变化时：</p>       <ol>        <li>通过初始渲染的步骤可知，子组件@Consume已把自己注册给父组件。父组件@Provide变量变更后，会遍历更新所有依赖它的系统组件（elementid）和状态变量（@Consume）。</li>        <li>通知@Consume更新后，子组件所有依赖@Consume的系统组件（elementId）都会被通知更新。以此实现@Provide对@Consume状态数据同步。</li>       </ol></li>      <li>       <p>当@Consume装饰的数据变化时：</p>       <p>通过初始渲染的步骤可知，子组件@Consume持有@Provide的实例。在@Consume更新后调用@Provide的更新方法，将更新的数值同步回@Provide，以此实现@Consume向@Provide的同步更新。</p></li>     </ol>     <p><span><img originheight="717" originwidth="1269" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114959.87913539654393971505004761986009:50001231000000:2800:361EE65FCFCE4ECB5E66EAB122200D316E1FF7800E1ACE251C000220EA511A5F.png" width="920" height="519.8108747044918"></span></p>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>@Provide/@Consume的参数key必须为string类型，否则编译时会报错。</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 错误写法，编译报错</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">change</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li><span class="hljs-meta">@Provide</span>(change) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">change</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'change'</span>;</li><li><span class="hljs-meta">@Provide</span>(change) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li></ol></pre></div></div></li>      <li>       <p>@Consume装饰的变量不能在构造参数中传入初始化，否则编译时会报错。@Consume仅能通过key来匹配对应的@Provide变量或者从API version 20开始设置默认值进行初始化。</p>       <p>【反例】</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">msg</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">msg</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 错误写法，不允许外部传入初始化</span></li><li>      <span class="hljs-title class_">Child</span>({<span class="hljs-attr">msg</span>: <span class="hljs-string">'Hello'</span>})</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p>【正例】</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-comment">// 从API version 20开始，@Consume装饰的变量支持设置默认值</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">num1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">17</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num1的值：<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num1}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Provide的key重复定义时，框架会抛出运行时错误，提醒开发者重复定义key，如果开发者需要重复key，可以使用<a href="/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume#provide支持allowoverride参数">allowoverride</a>。</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 错误写法，a重复定义</span></li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li><span class="hljs-meta">@Provide</span>(<span class="hljs-string">'b'</span>) <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li></ol></pre></div></div></li>      <li>       <p>在API version 20之前，初始化@Consume变量时，如果开发者没有定义对应key的@Provide变量，框架会抛出运行时错误，提示开发者初始化@Consume变量失败，原因是无法找到其对应key的@Provide变量。从API version 20开始，初始化@Consume变量时，如果开发者没有定义对应key的@Provide变量，同时没有设置默认值，框架会抛出运行时错误，提示开发者初始化@Consume变量失败，原因是无法找到其对应key的@Provide变量同时也没有设置默认值。</p>       <p>【反例】</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// 错误写法，缺少@Provide</span></li><li>  <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p>【正例】</p>       <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-comment">// 正确写法 从API version 20开始，@Consume装饰的变量支持设置默认值</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">num_with_defaultValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">6</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num_with_defaultValue的值：<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num_with_defaultValue}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// 正确写法</span></li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`num的值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>@Provide与@Consume不支持装饰Function类型的变量，框架会抛出运行时错误。</p></li>      <li>       <p>从API version 20开始，支持跨BuilderNode配对@Provide/@Consume。在BuilderNode上树时，@Consume通过key匹配找到最近的@Provide，两者类型需要一致，如果不一致，则会抛出运行时错误。</p>       <p>需要注意类型不相等判断，包括类实例的判断，比如：</p></li>     </ol>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {}</li><li><span class="hljs-comment">// 两个message都为object类型，但其构造函数不同，属于不同类型</span></li><li><span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: A = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();</li><li><span class="hljs-meta">@Consume</span> <span class="hljs-attr">message</span>: B = <span class="hljs-keyword">new</span> <span class="hljs-title function_">B</span>();</li></ol></pre></div></div>     <p>在非BuilderNode场景中，仍建议配对的@Provide/@Consume类型一致。虽然在运行时不会有强校验，但在@Consume装饰的变量初始化时，会隐式转换成@Provide装饰变量的类型。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Child</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(context);</li><li>    <span class="hljs-comment">// 配置跨BuilderNode支持@Provide/@Consume</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(buildText), <span class="hljs-literal">undefined</span>,</li><li>      { <span class="hljs-attr">enableProvideConsumeCrossing</span>: <span class="hljs-literal">true</span> });</li><li>    <span class="hljs-comment">// 将BuilderNode的根节点挂载到NodeContainer</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// Child通过BuilderNode上树后，@Consume和Index中的@Provide建立连接时发现类型不一致，抛出运行时错误</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Consume <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>          <p>以下示例是@Provide变量与后代组件中@Consume变量进行双向同步的场景。当分别点击ToDo和ToDoItem组件内的Button时，count的更改会双向同步在ToDo和ToDoItem中。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ToDoItem</span> {</li><li>  <span class="hljs-comment">// @Consume装饰的变量通过相同的属性名绑定其祖先组件ToDo内的@Provide装饰的变量</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>)`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>), count + 1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ToDoList</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">ToDoItem</span>()</li><li>      <span class="hljs-title class_">ToDoItem</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ToDoDemo</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">ToDoList</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ToDo</span> {</li><li>  <span class="hljs-comment">// @Provide装饰的变量count由入口组件ToDo提供其后代组件</span></li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>), count + 1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> += <span class="hljs-number">1</span>)</li><li>      <span class="hljs-title class_">ToDoDemo</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰map类型变量" class="firsth2">装饰Map类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰map类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@Provide，@Consume支持Map类型。</p>      </div></div></div>     <p>以下示例中，message类型为Map&lt;number, string&gt;，点击Button改变message的值，视图会随之刷新。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume init Map'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume set new one'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume clear'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume replace the first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume delete the first item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MapSample</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]])</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Provide init Map'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>], [<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>]]);</li><li>          })</li><li>        <span class="hljs-title class_">Child</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰set类型变量">装饰Set类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰set类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，@Provide，@Consume支持Set类型。</p>      </div></div></div>     <p>以下示例中，message类型为Set&lt;number&gt;，点击Button改变message的值，视图会随之刷新。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        <span class="hljs-title class_">Divider</span>()</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume init set'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume set new one'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume clear'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Consume delete the first one'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SetSample</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>])</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Provide init set'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>]);</li><li>          })</li><li>        <span class="hljs-title class_">Child</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰date类型变量">装饰Date类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰date类型变量" tips="复制节点链接"></i></h3>          <p>以下示例中，selectedDate类型为Date，点击Button改变selectedDate的值，视图会随之刷新。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">selectedDate</span>: <span class="hljs-title class_">Date</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`child increase the day by 1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'child update the new date'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-09-09'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span></li><li>      })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">selectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2021-08-08'</span>)</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'parent increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'parent update the new date'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-07-07'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span></li><li>      })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="provide和consume支持联合类型实例">Provide和Consume支持联合类型实例<i class="anchor-icon anchor-icon-link" anchorid="provide和consume支持联合类型实例" tips="复制节点链接"></i></h3>          <p>@Provide和@Consume支持联合类型和undefined和null。以下示例中，count类型为string | undefined，当点击父组件Parent中的Button改变count的属性或者类型时，Child中也会对应刷新。</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @Consume装饰的变量通过相同的属性名绑定其祖先组件Ancestors内的@Provide装饰的变量</span></li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>)`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>), Child`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-string">'Ancestors'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Ancestors</span> {</li><li>  <span class="hljs-comment">// @Provide装饰的联合类型count由入口组件Ancestors提供其后代组件</span></li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-string">'Child'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`count(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>), Child`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> = <span class="hljs-literal">undefined</span>)</li><li>      <span class="hljs-title class_">Parent</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="provide支持allowoverride参数">@Provide支持allowOverride参数<i class="anchor-icon anchor-icon-link" anchorid="provide支持allowoverride参数" tips="复制节点链接"></i></h3>          <p>allowOverride：@Provide重写选项。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始使用。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.1" valign="top" width="25%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">allowOverride</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">是否允许@Provide重写。允许在同一组件树下通过allowOverride重写同名的@Provide。如果开发者未写allowOverride，定义同名的@Provide，运行时会报错。</td>        </tr>             </tbody></table></div>     </div>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Provide</span>({allowOverride : <span class="hljs-string">'reviewVotes'</span>}) <span class="hljs-attr">reviewVotes</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li></ol></pre></div></div>     <p>完整示例如下：</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GrandSon</span> {</li><li>  <span class="hljs-comment">// @Consume装饰的变量通过相同的属性名绑定其祖先内的@Provide装饰的变量</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'reviewVotes'</span>) <span class="hljs-attr">reviewVotes</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`reviewVotes(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reviewVotes}</span>)`</span>) <span class="hljs-comment">// Text显示10</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`reviewVotes(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reviewVotes}</span>), give +1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">reviewVotes</span> += <span class="hljs-number">1</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Provide</span>({ <span class="hljs-attr">allowOverride</span>: <span class="hljs-string">'reviewVotes'</span> }) <span class="hljs-attr">reviewVotes</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">GrandSon</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provide</span>({ <span class="hljs-attr">allowOverride</span>: <span class="hljs-string">'reviewVotes'</span> }) <span class="hljs-attr">reviewVotes</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Child</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GrandParent</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'reviewVotes'</span>) <span class="hljs-attr">reviewVotes</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">40</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`reviewVotes(<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.reviewVotes}</span>), give +1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">reviewVotes</span> += <span class="hljs-number">1</span>)</li><li>      <span class="hljs-title class_">Parent</span>()</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ul>      <li>GrandParent声明了@Provide('reviewVotes') reviewVotes: number = 40。</li>      <li>Parent是GrandParent的子组件，声明@Provide为allowOverride，重写父组件GrandParent的@Provide('reviewVotes') reviewVotes: number = 40。如果不设置allowOverride，则会抛出运行时报错，提示@Provide重复定义。Child同理。</li>      <li>GrandSon在初始化@Consume的时候，@Consume装饰的变量通过相同的属性名绑定其最近的祖先的@Provide装饰的变量。</li>      <li>GrandSon查找到相同属性名的@Provide在祖先Child中，所以@Consume('reviewVotes') reviewVotes: number初始化数值为10。如果Child中没有定义与@Consume同名的@Provide，则继续向上寻找Parent中的同名@Provide值为20，以此类推。</li>      <li>如果查找到根节点还没有找到key对应的@Provide，则会报初始化@Consume找不到@Provide的报错。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="consume装饰的变量支持设置默认值">@Consume装饰的变量支持设置默认值<i class="anchor-icon anchor-icon-link" anchorid="consume装饰的变量支持设置默认值" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 20开始，@Consume装饰的变量支持设置默认值。</p>      </div></div></div>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'withDefault'</span>) <span class="hljs-attr">defaultValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li></ol></pre></div></div>     <p>完整示例如下：</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'firstKey'</span>) <span class="hljs-attr">provideOne</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'secondKey'</span>) <span class="hljs-attr">provideTwo</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'the second provider'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-title class_">Column</span>(){</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.provideOne}</span>`</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.provideTwo}</span>`</span>)</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Column</span>(){</li><li>          <span class="hljs-comment">// 点击change provideOne按钮，provideOne和子组件中的textOne属性会同时变化</span></li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change provideOne'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">provideOne</span> = <span class="hljs-literal">undefined</span>;</li><li>            })</li><li>          <span class="hljs-comment">// 点击change provideTwo按钮，provideTwo和子组件中的textTwo属性会同时变化</span></li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change provideTwo'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">provideTwo</span> = <span class="hljs-string">'the next provider'</span>;</li><li>            })</li><li>        }</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Child</span>()</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @Consume装饰的变量通过相同的别名绑定其祖先内的@Provide装饰的变量，同时设置默认值</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'firstKey'</span>) <span class="hljs-attr">textOne</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-string">'child'</span>;</li><li>  <span class="hljs-comment">// @Consume装饰的变量通过相同的别名绑定其祖先内的@Provide装饰的变量，没有设置默认值</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'secondKey'</span>) <span class="hljs-attr">textTwo</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-comment">// @Consume装饰的变量在祖先内没有匹配成功的@Provide装饰的变量，但设置了默认值</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'thirdKey'</span>) <span class="hljs-attr">textThree</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'defaultValue'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textOne}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textTwo}</span>`</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.textThree}</span>`</span>)</li><li>      <span class="hljs-comment">// 点击change textOne按钮，textOne和父组件的provideOne会同时变化</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change textOne'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">textOne</span> = <span class="hljs-string">'not undefined'</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 点击change textTwo按钮，textTwo和父组件的provideTwo会同时变化</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change textTwo'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">textTwo</span> = <span class="hljs-string">'change textTwo'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上面的示例中：</p>     <ul>      <li>Parent声明了@Provide('firstKey') provideOne: string | undefined = undefined 与 @Provide('secondKey') provideTwo: string = 'the second provider'。</li>      <li>Child声明了@Consume('firstKey') textOne: string | undefined = 'child'，@Consume('secondKey') textTwo: string 与 @Consume('thirdKey') textThree: string = 'defaultValue'。</li>      <li>Child是Parent的子组件，Child在初始化@Consume装饰的三个属性时，textOne根据'firstKey'别名绑定Parent中的provideOne属性，provideOne的值会覆盖textOne的默认值，所以textOne初始化的值为undefined；textTwo根据'secondKey'别名绑定Parent中的providedTwo属性，textTwo初始化的值为'the second provider'；textThree在祖先组件中不存在匹配结果，如果@Consume没有设置默认值，则会抛出运行时错误，示例中textThree有默认值'defaultValue'，所以textThree初始化的值为'defaultValue'。</li>      <li>@Consume装饰的属性设置的默认值仅在祖先组件没有匹配结果时才生效，有匹配结果时无影响。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="consume在跨buildernode场景下和provide建立双向同步">@Consume在跨BuilderNode场景下和@Provide建立双向同步<i class="anchor-icon anchor-icon-link" anchorid="consume在跨buildernode场景下和provide建立双向同步" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 20开始，支持跨BuilderNode配对@Provide/@Consume。</p>      </div></div></div>     <p>BuilderNode支持@Provide/@Consume，需注意：</p>     <ol>      <li>在BuilderNode子树中定义的@Consume需要设置默认值，或者在子树中已存在配对的@Provide，否则会发生运行时报错。</li>      <li>BuilderNode上树后，设置默认值的@Consume会向上查找@Provide，根据key的匹配规则找到最近的@Provide后，会和@Provide建立双向同步关系。如果找不到配对的@Provide，则@Consume仍使用默认值。</li>      <li>建立双向同步的关系后，如果@Provide装饰变量的值和@Consume的默认值不同，则会回调@Consume的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch">@Watch</a>方法，以及与@Consume有同步关系的变量的@Watch方法，例如@Consume通知与其双向同步的@Link触发@Watch方法。</li>      <li>BuilderNode下树后，@Consume会再次试图查找对应的@Provide，如果发现下树后无法再找到之前配对的@Provide，则断开和@Provide的双向同步关系，@Consume装饰的变量恢复成默认值。</li>      <li>@Consume断开和@Provide的连接，恢复成默认值时，会判断@Consume装饰变量的值从和@Provide变为@Consume的默认值是否有变化，如果有变化，则会回调@Consume以及与其有同步关系变量的@Watch方法。</li>     </ol>     <p>在下面的例子中：</p>     <ol>      <li>点击add Child:       <ul>        <li>构建BuilderNode下的子节点Child，Child中@Consume未找到@Provide，使用本地默认值default value初始化。</li>        <li>BuilderNode上树时，Child中@Consume向上找到最近的Index中的@Provide，将@Consume从默认值更新为@Provide的值，并回调@Consume的@Watch方法。</li>       </ul></li>      <li>@Provide和@Consume配对后，建立双向同步关系。点击Text(`@Provide: ${this.message}`)和Text(`@Consume ${this.message}`)，@Provide和@Consume绑定的Text组件刷新，并回调@Provide和@Consume的@Watch方法。</li>      <li>点击remove Child, BuilderNode子节点下树，Child中的@Consume和Index中的@Provide断开连接，Child中的@Consume恢复成默认值，并回调@Consume的@Watch方法。</li>      <li>点击dispose Child，释放BuilderNode下子节点，BuilderNode子节点Child销毁，执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttodisappear" target="_blank">aboutToDisappear</a>。</li>     </ol>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">BuilderNode</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Child</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">builderNode</span>: <span class="hljs-title class_">BuilderNode</span>&lt;[]&gt; | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">super</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">context</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(context);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> = context;</li><li>    <span class="hljs-comment">// 将rootNode节点挂载在NodeContainer下</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">addBuilderNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> === <span class="hljs-literal">null</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">BuilderNode</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>);</li><li>      <span class="hljs-comment">// 配置跨BuilderNode支持@Provide/@Consume</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">build</span>(<span class="hljs-title function_">wrapBuilder</span>(buildText), <span class="hljs-literal">undefined</span>,</li><li>        { <span class="hljs-attr">enableProvideConsumeCrossing</span>: <span class="hljs-literal">true</span> });</li><li>      <span class="hljs-comment">// 将BuilderNode的根节点挂载到rootNode节点下</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">appendChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">removeBuilderNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>) {</li><li>      <span class="hljs-comment">// 从rootNode节点下的BuildNode节点移除</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">removeChild</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">getFrameNode</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">disposeNode</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>) {</li><li>      <span class="hljs-comment">// 立即释放当前BuilderNode</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">builderNode</span>.<span class="hljs-title function_">dispose</span>();</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'hello'</span>;</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextNodeController</span>();</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Index Provide change <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Provide: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">' Provide'</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// 执行BuilderNode的build方法，构造Child自定义组件</span></li><li>      <span class="hljs-comment">// 并将BuilderNode挂载在NodeContainer下</span></li><li>      <span class="hljs-comment">// Child中@Consume可以和当前Index中的@Provide配对</span></li><li>      <span class="hljs-comment">// @Consume装饰的变量message从default value变为hello，并回调@Consume的@Watch方法</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'add Child'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">addBuilderNode</span>();</li><li>        })</li><li>      <span class="hljs-comment">// 将BuilderNode下的节点从NodeContainer上移除</span></li><li>      <span class="hljs-comment">// @Consume修饰的变量message从和@Provide配对的值变为default value，并回调@Consume的@Watch方法</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'remove Child'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">removeBuilderNode</span>();</li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// 立即释放当前BuilderNode，BuilderNode下节点销毁，Child组件执行aboutToDisappear</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'dispose Child'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">disposeNode</span>();</li><li>        })</li><li>      <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'onChange'</span>) <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'default value'</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Child Consume change <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Child aboutToDisappear`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@Consume <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">' Consume'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="builderparam尾随闭包情况下provide未定义错误" class="firsth2">@BuilderParam尾随闭包情况下@Provide未定义错误<i class="anchor-icon anchor-icon-link" anchorid="builderparam尾随闭包情况下provide未定义错误" tips="复制节点链接"></i></h3>          <p>在此<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builderparam#尾随闭包初始化组件">尾随闭包</a>场景下，CustomWidget执行this.builder()创建子组件CustomWidgetChild时，this指向的是HomePage。因此找不到CustomWidget的@Provide变量，所以下面示例会报找不到@Provide错误，和@BuilderParam连用的时候要谨慎this的指向。</p>     <p>错误示例：</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tmp</span> {</li><li>  <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">HomePage</span> {</li><li>  <span class="hljs-comment">// 错误点1：HomePage未声明@Provide</span></li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">builder2</span>(<span class="hljs-params">$$: Tmp</span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${$$.a}</span>测试`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 错误点2：使用尾随闭包的形式将创建CustomWidgetChild的函数传递给CustomWidget，此时尾随闭包中this指向HomePage</span></li><li>      <span class="hljs-title class_">CustomWidget</span>() {</li><li>        <span class="hljs-title class_">CustomWidgetChild</span>({ <span class="hljs-attr">builder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">builder2</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomWidget</span> {</li><li>  <span class="hljs-comment">// 错误点3：@Provide变量声明在CustomWidget中，仅有CustomWidget自身及其子组件能够消费</span></li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'abc'</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span></li><li>  <span class="hljs-attr">builder</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'你好'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> == <span class="hljs-string">'ddd'</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> = <span class="hljs-string">'abc'</span>;</li><li>        }</li><li>        <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> = <span class="hljs-string">'ddd'</span>;</li><li>        }</li><li>
</li><li>      })</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">builder</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomWidgetChild</span> {</li><li>  <span class="hljs-comment">// 错误点4：尝试消费CustomWidget的@Provide('a')，但实际上CustomWidgetChild的父组件为HomePage，无法找到对应的@Provide</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'a'</span>) <span class="hljs-attr">a</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span></li><li>  <span class="hljs-attr">builder</span>: <span class="hljs-function">(<span class="hljs-params">$$: Tmp</span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">builder</span>({ <span class="hljs-attr">a</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">a</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>正确示例：</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Tmp</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">HomePage</span> {</li><li>  <span class="hljs-comment">// 修正点1：将@Provide声明在Entry组件（根作用域），确保子组件能正确消费</span></li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'name'</span>) <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'abc'</span>;</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">builder2</span>(<span class="hljs-params">$$: Tmp</span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${$$.name}</span>测试`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'你好'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> == <span class="hljs-string">'ddd'</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'abc'</span>;</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'ddd'</span>;</li><li>        }</li><li>      })</li><li>      <span class="hljs-comment">// 修正点2：CustomWidget不再声明@Provide，仅作为容器传递builder</span></li><li>      <span class="hljs-title class_">CustomWidget</span>() {</li><li>        <span class="hljs-title class_">CustomWidgetChild</span>({ <span class="hljs-attr">builder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">builder2</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomWidget</span> {</li><li>  <span class="hljs-meta">@BuilderParam</span></li><li>  <span class="hljs-attr">builder</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">builder</span>()</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomWidgetChild</span> {</li><li>  <span class="hljs-comment">// 修正点3：@Consume从根作用域（HomePage）获取@Provide('name')，作用域正确</span></li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'name'</span>) <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@BuilderParam</span></li><li>  <span class="hljs-attr">builder</span>: <span class="hljs-function">(<span class="hljs-params">$$: Tmp</span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">builder</span>({ <span class="hljs-attr">name</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="使用abthisobject形式调用不会触发ui刷新">使用a.b(this.object)形式调用，不会触发UI刷新<i class="anchor-icon anchor-icon-link" anchorid="使用abthisobject形式调用不会触发ui刷新" tips="复制节点链接"></i></h3>          <p>在build方法内，当@Provide与@Consume装饰的变量是Object类型、且通过a.b(this.object)形式调用时，b方法内传入的是this.object的原始对象，修改其属性，无法触发UI刷新。如下例中，通过静态方法或者使用this调用组件内部方法，修改组件中的this.dog.age与this.dog.name时，UI不会刷新。</p>     <p>【反例】</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {</li><li>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">type</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name:<span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>:<span class="hljs-built_in">string</span>, age:<span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeName</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;</li><li>  }</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeAge</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">age</span> += <span class="hljs-number">1</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Zoo</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">dog</span>:<span class="hljs-title class_">Animal</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">'WangCai'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-number">2</span>);</li><li>
</li><li>  <span class="hljs-title function_">changeZooDogAge</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">age</span> += <span class="hljs-number">2</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Zoo: This is a <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.age}</span>-year-old <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.<span class="hljs-keyword">type</span>}</span> named <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.name}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeAge'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过静态方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">changeAge</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeZooDogAge'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 使用this通过自定义组件内部方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeZooDogAge</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>);</li><li>        })</li><li>      <span class="hljs-title class_">ZooChild</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ZooChild</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ZooChild`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ZooGrandChild</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ZooGrandChild</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">dog</span>:<span class="hljs-title class_">Animal</span>;</li><li>
</li><li>  <span class="hljs-title function_">changeZooGrandChildName</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">name</span> = <span class="hljs-string">'Marry'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ZooGrandChild: This is a <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.age}</span>-year-old <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.<span class="hljs-keyword">type</span>}</span> named <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.name}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeName'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过静态方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">changeName</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeZooGrandChildName'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 使用this通过自定义组件内部方法调用，无法触发UI刷新</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeZooGrandChildName</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>可以通过如下先赋值、再调用新赋值的变量的方式为this.dog保留Proxy代理，实现UI刷新。</p>     <p>【正例】</p>     <div _ngcontent-cqf-c106="" class="highlight-div"><div _ngcontent-cqf-c106="" class="highlight-div-header"><div _ngcontent-cqf-c106="" class="highlight-div-header-left"><div _ngcontent-cqf-c106="" class="handle-button expand-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqf-c106="" class="highlight-div-header-right"><div _ngcontent-cqf-c106="" class="handle-button ai-button"></div><div _ngcontent-cqf-c106="" class="handle-button line-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqf-c106="" class="handle-button theme-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqf-c106="" class="handle-button copy-button"><div _ngcontent-cqf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Animal</span> {</li><li>  <span class="hljs-attr">name</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">type</span>:<span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name:<span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>:<span class="hljs-built_in">string</span>, age:<span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeName</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">name</span> = <span class="hljs-string">'Jack'</span>;</li><li>  }</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">changeAge</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">age</span> += <span class="hljs-number">1</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Zoo</span> {</li><li>  <span class="hljs-meta">@Provide</span> <span class="hljs-attr">dog</span>:<span class="hljs-title class_">Animal</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Animal</span>(<span class="hljs-string">'WangCai'</span>, <span class="hljs-string">'dog'</span>, <span class="hljs-number">2</span>);</li><li>
</li><li>  <span class="hljs-title function_">changeZooDogAge</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">age</span> += <span class="hljs-number">2</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Zoo: This is a <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.age}</span>-year-old <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.<span class="hljs-keyword">type</span>}</span> named <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.name}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeAge'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值给临时变量保留Proxy代理</span></li><li>          <span class="hljs-keyword">let</span> newDog = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>;</li><li>          <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">changeAge</span>(newDog);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeZooDogAge'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值给临时变量保留Proxy代理</span></li><li>          <span class="hljs-keyword">let</span> newDog = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeZooDogAge</span>(newDog);</li><li>        })</li><li>      <span class="hljs-title class_">ZooChild</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ZooChild</span> {</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ZooChild.`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">ZooGrandChild</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ZooGrandChild</span> {</li><li>  <span class="hljs-meta">@Consume</span> <span class="hljs-attr">dog</span>:<span class="hljs-title class_">Animal</span>;</li><li>
</li><li>  <span class="hljs-title function_">changeZooGrandChildName</span>(<span class="hljs-params">animal:Animal</span>) {</li><li>    animal.<span class="hljs-property">name</span> = <span class="hljs-string">'Marry'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>:<span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`ZooGrandChild: This is a <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.age}</span>-year-old <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.<span class="hljs-keyword">type</span>}</span> named <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dog.name}</span>.`</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeName'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值给临时变量保留Proxy代理</span></li><li>          <span class="hljs-keyword">let</span> newDog = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>;</li><li>          <span class="hljs-title class_">Animal</span>.<span class="hljs-title function_">changeName</span>(newDog);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'changeZooGrandChildName'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-comment">// 通过赋值给临时变量保留Proxy代理</span></li><li>          <span class="hljs-keyword">let</span> newDog = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dog</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeZooGrandChildName</span>(newDog);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>