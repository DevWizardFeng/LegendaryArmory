<h1 _ngcontent-wrb-c119="" class="doc-title ng-star-inserted" title="@ReusableV2装饰器：组件复用"> @ReusableV2装饰器：组件复用 </h1>

<div _ngcontent-wrb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了降低反复创建销毁自定义组件带来的性能开销，开发者可以使用@ReusableV2装饰<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>装饰的自定义组件，达成组件复用的效果。</p>    <p>在阅读本文前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable">@Reusable装饰器：组件复用</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 18开始，可以使用@ReusableV2装饰@ComponentV2装饰的自定义组件。</p>      <p>从API version 18开始，该装饰器支持在元服务中使用。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>@ReusableV2用于装饰V2的自定义组件，表明该自定义组件具有被复用的能力：</p>     <ul>      <li>@ReusableV2仅能装饰V2的自定义组件，即@ComponentV2装饰的自定义组件。并且仅能将@ReusableV2装饰的自定义组件作为V2自定义组件的子组件使用。</li>      <li>@ReusableV2同样提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttorecycle10" target="_blank">aboutToRecycle</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttoreuse18" target="_blank">aboutToReuse</a>的生命周期，在组件被回收时调用aboutToRecycle，在组件被复用时调用aboutToReuse，但与@Reusable不同的是，aboutToReuse没有入参。</li>      <li>在回收阶段，会递归地调用所有子组件的aboutToRecycle回调（即使子组件未被标记可复用）；在复用阶段，会递归地调用所有子组件的aboutToReuse回调（即使子组件未被标记可复用）。</li>      <li>@ReusableV2装饰的自定义组件会在被回收期间保持冻结状态，即无法触发UI刷新、无法触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a>回调，与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-components-freezev2">freezeWhenInactive</a>标记位不同的是，在解除冻结状态后，不会触发延后的刷新。</li>      <li>@ReusableV2装饰的自定义组件会在复用时自动重置组件内状态变量的值、重新计算组件内<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-computed">@Computed</a>以及与之相关的@Monitor。不建议开发者在aboutToRecycle中更改组件内状态变量，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-reusablev2#复用前的组件内状态变量重置">复用前的组件内状态变量重置</a>。</li>      <li>V1和V2的复用组件可在一定规则下混用，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-reusablev2#使用限制">使用限制</a>第二点。</li>      <li>不建议开发者嵌套滥用@ReusableV2装饰器，这可能会导致复用效率降低以及内存开销变大。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">@ReusableV2装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">无</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">可装饰的组件</td>         <td class="cellrowborder" valign="top" width="50%">@ComponentV2装饰的自定义组件</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">装饰器作用</td>         <td class="cellrowborder" valign="top" width="50%">表明该组件可被复用</td>        </tr>             </tbody></table></div>     </div>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ReusableV2</span> <span class="hljs-comment">// 装饰ComponentV2的自定义组件</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  build () {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>      }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>reuse、ReuseOptions、ReuseIdCallback的接口说明参考API文档：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-reuse" target="_blank">复用选项</a>。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ReusableV2Component</span>()</li><li>        .<span class="hljs-title function_">reuse</span>({<span class="hljs-attr">reuseId</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">'reuseComponent'</span>}) <span class="hljs-comment">// 使用'reuseComponent'作为reuseId</span></li><li>      <span class="hljs-title class_">ReusableV2Component</span>()</li><li>        .<span class="hljs-title function_">reuse</span>({<span class="hljs-attr">reuseId</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-string">''</span>}) <span class="hljs-comment">// 使用空字符串将默认使用组件名'ReusableV2Component'作为reuseId</span></li><li>      <span class="hljs-title class_">ReusableV2Component</span>() <span class="hljs-comment">// 未指定reuseId将默认使用组件名'ReusableV2Component'作为reuseId</span></li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>仅能将@ReusableV2装饰的自定义组件作为V2自定义组件的子组件使用。如果在V1的自定义组件中使用V2的复用组件将导致编译期报错，编译期无法校验到的复杂场景下将会有运行时报错。</p>       <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ReusableV2Component</span>() <span class="hljs-comment">// 正确用法</span></li><li>      <span class="hljs-title function_">V1Component</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">V2ReusableBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">ReusableV2Component</span>()</li><li>}</li><li><span class="hljs-meta">@Component</span></li><li>struct V1Component {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ReusableV2Component</span>() <span class="hljs-comment">// 错误用法，编译报错</span></li><li>      <span class="hljs-title function_">V2ReusableBuilder</span>() <span class="hljs-comment">// 错误用法，较复杂场景，运行时报错</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>V1和V2支持部分混用场景。</p>       <p>下文提到的描述对应关系如下表：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.3.1.3.1.1" valign="top" width="50%">描述</th>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.3.1.3.1.2" valign="top" width="50%">对应组件类型</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">V1普通组件</td>           <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component">@Component</a>装饰的struct。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">V2普通组件</td>           <td class="cellrowborder" valign="top" width="50%">@ComponentV2装饰的struct。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">V1复用组件</td>           <td class="cellrowborder" valign="top" width="50%">@Reusable@Component装饰的struct。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">V2复用组件</td>           <td class="cellrowborder" valign="top" width="50%">@ReusableV2@ComponentV2装饰的struct。</td>          </tr>                 </tbody></table></div>       </div>       <p>下面的表展示了V1和V2的混用支持关系，每行的含义为第一列作为父组件，能否将后面列的组件作为子组件。</p>       <p>以第一行V1普通组件为例，可以将V1普通组件、V2普通组件以及V1复用组件作为子组件，但无法将V2复用组件作为子组件。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.6.1.6.1.1" valign="top" width="20%"></th>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.6.1.6.1.2" valign="top" width="20%">V1普通组件</th>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.6.1.6.1.3" valign="top" width="20%">V2普通组件</th>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.6.1.6.1.4" valign="top" width="20%">V1复用组件</th>           <th align="left" class="cellrowborder" id="mcps1.3.7.2.2.6.1.6.1.5" valign="top" width="20%">V2复用组件</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="20%">V1普通组件</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">不支持，编译报错</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">V2普通组件</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">不支持，编译告警，实际使用子组件不创建</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">V1复用组件</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">不支持，编译报错</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="20%">V2复用组件</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>           <td class="cellrowborder" valign="top" width="20%">不支持，编译报错</td>           <td class="cellrowborder" valign="top" width="20%">支持</td>          </tr>                 </tbody></table></div>       </div>       <p>根据上表，仅支持12种可能的父子关系，不推荐开发者高度嵌套可复用组件，这会造成复用效率降低。</p></li>      <li>       <p>V2的复用组件当前不支持直接用于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat" target="_blank">Repeat</a>的template中，但是可以用在template中的V2自定义组件中。</p>       <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">() =&gt;</span> {})</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>          .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">'a'</span>)</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'a'</span>, <span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">val</span>: ri.<span class="hljs-property">item</span>}) <span class="hljs-comment">// 暂不支持，编译期报错</span></li><li>                <span class="hljs-title class_">ReusableV2Builder</span>(ri.<span class="hljs-property">item</span>) <span class="hljs-comment">// 暂不支持，运行时报错</span></li><li>                <span class="hljs-title class_">NormalV2Component</span>({ <span class="hljs-attr">val</span>: ri.<span class="hljs-property">item</span>}) <span class="hljs-comment">// 支持普通V2自定义组件下面包含V2复用组件</span></li><li>              }</li><li>            }</li><li>          })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NormalV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">val</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span> })</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">ReusableV2Builder</span>(<span class="hljs-params">param: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">val</span>: param })</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`val: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="回收与复用的生命周期">回收与复用的生命周期<i class="anchor-icon anchor-icon-link" anchorid="回收与复用的生命周期" tips="复制节点链接"></i></h2>          <p>@ReusableV2提供了aboutToRecycle以及aboutToReuse的生命周期，当组件被回收时触发aboutToRecycle，当组件被复用时触发aboutToReuse。</p>     <p>以if的使用场景为例：</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition1</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition2</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'step1. appear'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">condition1</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'step2. recycle'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">condition2</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'step3. reuse'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">condition2</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'step4. disappear'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">condition1</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition1</span>) {</li><li>        <span class="hljs-title class_">NormalV2Component</span>({ <span class="hljs-attr">condition</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">condition2</span> })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">NormalV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>      <span class="hljs-title class_">ReusableV2Component</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToAppear called'</span>); <span class="hljs-comment">// 组件创建时调用</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToDisappear called'</span>); <span class="hljs-comment">// 组件销毁时调用</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToRecycle called'</span>); <span class="hljs-comment">// 组件回收时调用</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToReuse called'</span>); <span class="hljs-comment">// 组件复用时调用</span></li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'ReusableV2Component'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>建议按下面顺序进行操作：</p>     <ol>      <li>点击step1. appear，此时condition1变为true，Index中的if组件切换分支，创建出NormalV2Component，由于condition2初始值为true，所以NormalV2Component中的if条件满足，尝试创建ReusableV2Component。此时复用池中无元素，因此会创建ReusableV2Component，并回调aboutToAppear的方法，输出ReusableV2Component aboutToAppear called的日志。</li>      <li>点击step2. recycle，此时condition2变为false，通过@Param同步给NormalV2Component，if条件切换，由于ReusableV2Component使用了@ReusableV2，因此会将该组件回收至复用池而不是销毁，回调aboutToRecycle的方法并输出ReusableV2Component aboutToRecycle called的日志。</li>      <li>点击step3. reuse，此时condition2变为true，通过@Param传递给NormalV2Component，if条件切换，由于ReusableV2Component使用了@ReusableV2，因此在创建该组件时尝试去复用池中寻找。此时复用池中有第二步放入的组件实例，因此从复用池中取出复用，回调aboutToReuse方法并输出ReusableV2Component aboutToReuse called的日志。</li>      <li>点击step4. disappear，此时condition1变为false，Index组件中的if组件切换分支，销毁NormalV2Component，此时ReusableV2Component因为父组件销毁，所以会被一起销毁，回调aboutToDisappear的方法并输出ReusableV2Component aboutToDisappear called的日志。</li>     </ol>     <p>倘若该复用组件下有子组件时，会在回收和复用时递归调用子组件的aboutToRecycle和aboutToReuse（与子组件是否被标记复用无关），直到遍历完所有的孩子组件。</p>    </div>    <div class="tiledSection">     <h2 id="复用阶段的冻结">复用阶段的冻结<i class="anchor-icon anchor-icon-link" anchorid="复用阶段的冻结" tips="复制节点链接"></i></h2>          <p>在之前的复用中，V1组件在复用池中仍能响应更新，这会对性能带来一定的负面影响，需要开发者使用组件冻结能力，才能够使V1组件在复用池中时不响应更新。针对这一点，V2组件在复用时将会被自动冻结，不会响应在回收期间发生的变化。这一个期间包括aboutToRecycle，即aboutToRecycle中的修改不会刷新到UI上，也不会触发@Computed以及@Monitor。冻结状态将持续到aboutToReuse前，即aboutToReuse及之后的变量更改，才会正常触发UI刷新、@Computed重新计算以及@Monitor的调用。</p>     <p>以if的使用场景为例：</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>}</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'复用/回收'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;})</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'改值'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{info.<span class="hljs-property">age</span>++;})</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-title class_">ReusableV2Component</span>()</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = info; <span class="hljs-comment">// 仅做演示使用，并不建议@Local赋值全局变量</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'info.age'</span>)</li><li>  <span class="hljs-title function_">onValChange</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'info.age change'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToRecycle'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span>++;</li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'aboutToReuse'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span>++;</li><li>  }</li><li>  <span class="hljs-title function_">onRender</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'info.age onRender'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span>.<span class="hljs-title function_">toString</span>();</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onRender</span>())</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>建议按如下步骤进行操作：</p>     <ol>      <li>点击改值按钮，可以观察到UI变化，@Monitor触发并输出日志info.age change以及info.age onRender，说明此时能够正常监听到变化以及触发UI刷新。</li>      <li>点击复用/回收按钮，此时调用aboutToRecycle回调并输出aboutToRecycle的日志，但@Monitor不被触发，且onRender方法不被回调。</li>      <li>点击改值按钮，UI无变化，@Monitor不触发且onRender方法不被回调。</li>      <li>点击复用/回收按钮，此时调用aboutToReuse回调并输出aboutToReuse的日志，@Monitor触发并输出日志info.age change且onRender方法回调输出info.age onRender，UI发生变化。</li>     </ol>     <p>如果去掉aboutToReuse方法中的自增操作，则上述第四步不会触发@Monitor回调。</p>     <p>在复杂的混用场景中，是否冻结的规则可以总结为以下两点：</p>     <ol>      <li>V1的组件根据是否开启组件冻结freezeWhenInactive决定。</li>      <li>V2的组件自动被冻结。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="复用前的组件内状态变量重置">复用前的组件内状态变量重置<i class="anchor-icon anchor-icon-link" anchorid="复用前的组件内状态变量重置" tips="复制节点链接"></i></h2>          <p>与@Reusable不同的是，@ReusableV2在复用前会重置组件中的状态变量以及相关的@Computed、@Monitor的内容。在复用的过程当中，所有的V2自定义组件，无论是否被标记了@ReusableV2，都会经历这一个重置过程。</p>     <p>重置会按照变量在组件中定义的顺序按照下面的规则依次进行：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.1" valign="top" width="50%">装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.2" valign="top" width="50%">重置方法</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a></td>         <td class="cellrowborder" valign="top" width="50%">直接使用定义时的初始值重新赋值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a></td>         <td class="cellrowborder" valign="top" width="50%">如果有外部传入则使用外部传入值重新赋值，否则用本地初始值重新赋值。注意：@Once装饰的变量同样会被重置初始化一次。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-event">@Event</a></td>         <td class="cellrowborder" valign="top" width="50%">如果有外部传入则使用外部传入值重新赋值，否则用本地初始值重新赋值。如果本地没有初始值，则生成默认的空实现。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Provider</a></td>         <td class="cellrowborder" valign="top" width="50%">直接使用定义时的初始值重新赋值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Consumer</a></td>         <td class="cellrowborder" valign="top" width="50%">如果有对应的@Provider则直接使用@Provider对应的值，否则使用本地初始值重新赋值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">@Computed</td>         <td class="cellrowborder" valign="top" width="50%">使用当前最新的值重新计算一次，如果使用到的变量还未被重置，将会使用重置前的值，因此推荐开发者将@Computed定义在所使用的变量之后。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">@Monitor</td>         <td class="cellrowborder" valign="top" width="50%">在上述所有变量重置完成之后触发。重置过程中产生的变量变化不会触发@Monitor回调，仅更新IMonitorValue中的before值。重置过程中不产生变化的赋值不会触发@Monitor的重置。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">常量</td>         <td class="cellrowborder" valign="top" width="50%">包括readonly的常量，不重置。</td>        </tr>             </tbody></table></div>     </div>     <p>下面的例子展示了重置的一些效果：</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">local</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Provider</span>(<span class="hljs-string">'inherit'</span>) <span class="hljs-attr">inheritProvider</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">100</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'回收/复用'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;})</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'父组件变量'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`local: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.local}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">local</span>++;})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`inheritProvider: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.inheritProvider}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">inheritProvider</span>++;})</li><li>      }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-title class_">ReusableV2Component</span>({</li><li>          <span class="hljs-attr">paramOut</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">local</span>,</li><li>          <span class="hljs-attr">paramOnce</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">local</span>,</li><li>          <span class="hljs-attr">changeParam</span>: <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">local</span>++;</li><li>          }</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">val</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">25</span>);</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">paramLocal</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">paramOut</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Once</span> <span class="hljs-attr">paramOnce</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-meta">@Event</span> <span class="hljs-attr">changeParam</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li>  <span class="hljs-meta">@Provider</span>(<span class="hljs-string">'selfProvider'</span>) <span class="hljs-attr">selfProvider</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'inherit'</span>) <span class="hljs-attr">inheritConsumer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Consumer</span>(<span class="hljs-string">'selfConsumer'</span>) <span class="hljs-attr">selfConsumer</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">noDecoVariable</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// 未加装饰器，被视作常量</span></li><li>  <span class="hljs-attr">noDecoInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 未加装饰器，被视作常量</span></li><li>  <span class="hljs-keyword">readonly</span> <span class="hljs-attr">readOnlyVariable</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>; <span class="hljs-comment">// readonly常量</span></li><li>  <span class="hljs-meta">@Computed</span></li><li>  <span class="hljs-keyword">get</span> <span class="hljs-title function_">plusParam</span>() {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">paramLocal</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">paramOut</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">paramOnce</span>;</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'val'</span>)</li><li>  <span class="hljs-title function_">onValChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`val change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'plusParam'</span>)</li><li>  <span class="hljs-title function_">onPlusParamChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`plusParam change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'重置为本地初始值的变量'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`val: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.val}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">val</span>++;})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info.age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.age}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span>++;})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`paramLocal: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.paramLocal}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-comment">/* 无外部传入的Local无法本地修改 */</span>})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`selfProvider: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.selfProvider}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">selfProvider</span>++;})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`selfConsumer: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.selfConsumer}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">selfConsumer</span>++;})</li><li>      }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'重置为外部传入的变量'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`paramOut: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.paramOut}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">changeParam</span>();})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`paramOnce: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.paramOnce}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">paramOnce</span>++;})</li><li>      }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'根据父组件情况决定'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`inheritConsumer: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.inheritConsumer}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">inheritConsumer</span>++;})</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`plusParam: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.plusParam}</span>`</span>)</li><li>      }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'不被重置'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`noDecoVariable: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.noDecoVariable}</span>`</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`noDecoInfo.age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.noDecoInfo.age}</span>`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">noDecoInfo</span>.<span class="hljs-property">age</span>++;}) <span class="hljs-comment">// 能够触发刷新但是复用时不会被重置</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`readOnlyVariable: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.readOnlyVariable}</span>`</span>)</li><li>      }.<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">2</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>开发者可以尝试点击各个变量，并点击回收/复用按钮查看复用后的重置情况。</p>     <p>需要注意的是，上面的例子中noDecoInfo未被重置，如果存在监听noDecoInfo.age的@Monitor，因为noDecoInfo本身未产生变化，所以该@Monitor也不会被重置，因此在后续第一次更改noDecoInfo.age时，IMonitorValue的before值将不会被重置，仍是复用前的值。</p>     <p>将上面的例子简化可得下面的例子：</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'回收/复用'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;})</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-title class_">ReusableV2Component</span>()</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-attr">noDecoInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(<span class="hljs-number">30</span>); <span class="hljs-comment">// 未加装饰器，被视作常量</span></li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'noDecoInfo.age'</span>)</li><li>  <span class="hljs-title function_">onAgeChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`age change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">noDecoInfo</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>;</li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">noDecoInfo</span>.<span class="hljs-property">age</span> = <span class="hljs-number">35</span>;</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`noDecoInfo.age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.noDecoInfo.age}</span>`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">noDecoInfo</span>.<span class="hljs-property">age</span>++;}) <span class="hljs-comment">// 能够触发刷新但是不会被重置</span></li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>建议按照下列步骤进行操作：</p>     <ol>      <li>点击noDecoInfo.age: 30，UI刷新为noDecoInfo.age: 31，@Monitor触发并输出日志age change from 30 to 31。</li>      <li>点击回收/复用两次，UI刷新为noDecoInfo.age: 35，@Monitor触发并输出日志age change from 31 to 35。</li>      <li>点击noDecoInfo.age: 35，UI刷新为noDecoInfo.age: 36，@Monitor触发并输出日志age change from 35 to 36。</li>     </ol>     <p>由于冻结机制的存在，在aboutToRecycle中赋值不会被@Monitor观察到。而在经历完变量重置后，变量又会被赋予新的值，因此对于组件内状态变量来说，在aboutToRecycle中赋值不会有明显的效果；而常量（例如上面的noDecoInfo）由于冻结机制的存在，在aboutToRecycle中更改age也不会被观察到，并且因为不会被重置，所以相关的@Monitor也不会被重置，即这里的age值本身未被重置，也就不会重置与之绑定的@Monitor。最终表现出来的现象即：第二步回调的@Monitor中，monitor.value()?.before得到的值为31，而非age的初始值30。</p>     <p>针对这一现象，推荐开发者在复用的场景减少使用类似的常量对象包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>属性的写法，以确保复用场景的功能符合预期。</p>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="在if组件中使用" class="firsth2">在if组件中使用<i class="anchor-icon anchor-icon-link" anchorid="在if组件中使用" tips="复制节点链接"></i></h3>          <p>通过改变if组件的条件可以控制组件回收/复用。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'回收/复用'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;}) <span class="hljs-comment">// 点击切换回收/复用状态</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-title class_">ReusableV2Component</span>()</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToRecycle'</span>); <span class="hljs-comment">// 回收时被调用</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToReuse'</span>); <span class="hljs-comment">// 复用时被调用</span></li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在repeat组件中使用">在Repeat组件中使用<i class="anchor-icon anchor-icon-link" anchorid="在repeat组件中使用" tips="复制节点链接"></i></h3>          <p>Repeat组件懒加载场景中，将会优先使用Repeat组件的缓存池，正常滑动场景、更新场景不涉及组件的回收与复用。当Repeat的缓存池需要扩充时将会向自定义组件要求新的子组件，此时如果复用池中有可复用的节点，将会进行复用。</p>     <p>下面的例子中，先点击改变condition会让3个节点进入复用池，而后向下滑动List组件时，可以观察到日志输出ReusableV2Component aboutToReuse，表明Repeat可以使用自定义组件的复用池填充自己的缓存池。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(i)</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'改变condition'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;})</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-comment">// 此处仅做演示使用，让复用池中填充3个组件</span></li><li>        <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: <span class="hljs-number">0</span>})</li><li>        <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: <span class="hljs-number">0</span>})</li><li>        <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: <span class="hljs-number">0</span>})</li><li>      }</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">number</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: obj.<span class="hljs-property">item</span> })</li><li>              }</li><li>            }</li><li>          })</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToAppear'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToRecycle'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToReuse'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在repeat组件非懒加载场景的each属性中使用">在Repeat组件非懒加载场景的each属性中使用<i class="anchor-icon anchor-icon-link" anchorid="在repeat组件非懒加载场景的each属性中使用" tips="复制节点链接"></i></h3>          <p>Repeat组件非懒加载场景中，会在删除/创建子树时触发回收/复用。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">condition</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除/创建Repeat'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>=!<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>;})</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'增加元素'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span>+<span class="hljs-number">1</span>);})</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除元素'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">pop</span>();})</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'更改元素'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[<span class="hljs-number">0</span>]++;})</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">condition</span>) {</li><li>        <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>          <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>            .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">number</span>&gt;</span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">ListItem</span>() {</li><li>                <span class="hljs-title class_">Column</span>() {</li><li>                  <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: obj.<span class="hljs-property">item</span> })</li><li>                }</li><li>              }</li><li>            })</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToAppear'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToRecycle'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToReuse'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在foreach组件中使用">在ForEach组件中使用<i class="anchor-icon anchor-icon-link" anchorid="在foreach组件中使用" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>推荐开发者使用Repeat组件的非懒加载场景代替<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-foreach" target="_blank">ForEach</a>组件</p>      </div></div></div>     <p>下面的例子中使用了ForEach组件渲染了数个可复用组件，由于每次点击点击修改按钮时key值都会发生变化，因此从第二次点击开始都会触发回收与复用（由于ForEach先判断有无可复用节点时复用池仍未初始化，因此第一次点击会创建新的节点，而后初始化复用池同时回收节点）。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>, <span class="hljs-function">(<span class="hljs-params">num: <span class="hljs-built_in">number</span>, index</span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'点击修改'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[index]++;})</li><li>          <span class="hljs-title class_">ReusableV2Component</span>({ <span class="hljs-attr">num</span>: num })</li><li>        }</li><li>      }) <span class="hljs-comment">// 每次修改完key发生变化</span></li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ReusableV2Component</span> {</li><li>  <span class="hljs-meta">@Require</span> <span class="hljs-meta">@Param</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToAppear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>); <span class="hljs-comment">// 创建时触发</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToRecycle'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>); <span class="hljs-comment">// 回收时触发</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ReusableV2Component aboutToReuse'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>); <span class="hljs-comment">// 复用时触发</span></li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`child: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.num}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在lazyforeach组件中使用">在LazyForEach组件中使用<i class="anchor-icon anchor-icon-link" anchorid="在lazyforeach组件中使用" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>推荐开发者使用Repeat组件的懒加载场景代替<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>组件</p>      </div></div></div>     <p>下面的例子中使用了LazyForEach渲染了数个可复用组件，在滑动时可以先观察到组件创建，直到预加载节点全部创建完成之后，再滑动则触发复用和回收。</p>     <div _ngcontent-wrb-c106="" class="highlight-div"><div _ngcontent-wrb-c106="" class="highlight-div-header"><div _ngcontent-wrb-c106="" class="highlight-div-header-left"><div _ngcontent-wrb-c106="" class="handle-button expand-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wrb-c106="" class="highlight-div-header-right"><div _ngcontent-wrb-c106="" class="handle-button ai-button"></div><div _ngcontent-wrb-c106="" class="handle-button line-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wrb-c106="" class="handle-button theme-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wrb-c106="" class="handle-button copy-button"><div _ngcontent-wrb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wrb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">addData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">0</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>(); <span class="hljs-comment">// 数据源</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">200</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">'Hello'</span> + i));</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">message</span>)</li><li>            <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item.<span class="hljs-property">message</span> })</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                item.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>; <span class="hljs-comment">// message为@Trace装饰的变量，可观察变化</span></li><li>              })</li><li>          }</li><li>        }</li><li>      })</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ChildComponent aboutToAppear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ChildComponent aboutToDisappear'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>);</li><li>  }</li><li>  <span class="hljs-title function_">aboutToReuse</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ChildComponent aboutToReuse'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>); <span class="hljs-comment">// 复用时触发</span></li><li>  }</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ChildComponent aboutToRecycle'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>); <span class="hljs-comment">// 回收时触发</span></li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>