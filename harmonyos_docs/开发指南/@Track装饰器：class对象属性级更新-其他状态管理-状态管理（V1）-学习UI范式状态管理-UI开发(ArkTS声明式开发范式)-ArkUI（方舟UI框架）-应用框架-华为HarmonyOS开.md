<h1 _ngcontent-mae-c119="" class="doc-title ng-star-inserted" title="@Track装饰器：class对象属性级更新"> @Track装饰器：class对象属性级更新 </h1>

<div _ngcontent-mae-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>@Track应用于class对象的属性级更新。@Track装饰的属性变化时，只会触发该属性关联的UI更新。</p> <p>在阅读本文档之前，建议开发者对状态管理基本观察能力有基本的了解。建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>从API version 11开始，该装饰器支持在ArkTS卡片中使用。</p>  <p>从API version 12开始，该装饰器支持在元服务中使用。</p>  </div></div></div>  <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>@Track是class对象的属性装饰器。当一个class对象是状态变量时，@Track装饰的属性发生变化，只会触发该属性关联的UI更新；如果class类中使用了@Track装饰器，则未被@Track装饰器装饰的属性不能在UI中使用，如果使用，会发生运行时报错。</p> </div>  <div class="tiledSection"><h2 id="class属性级更新说明">class属性级更新说明<i class="anchor-icon anchor-icon-link" anchorid="class属性级更新说明" tips="复制节点链接"></i></h2><p>状态管理V1中@State等装饰器默认支持观察第一层属性的变化，第一层属性的变化虽然可以触发更新，但无法做到类属性级的观察，下面的例子就展示了这一限制：</p> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Jack'</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">12</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>
</li><li>  <span class="hljs-comment">// 借助getFontSize的日志打印，可以分辨哪个组件触发了渲染</span></li><li>  <span class="hljs-title function_">getFontSize</span>(<span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Component <span class="hljs-subst">${id}</span> render`</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">30</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFontSize</span>(<span class="hljs-number">1</span>))</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`age: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getFontSize</span>(<span class="hljs-number">2</span>))</li><li>
</li><li>      <span class="hljs-comment">// 点击当前Button，可以发现当前虽然仅改变了name属性</span></li><li>      <span class="hljs-comment">// 但是依旧会触发两个Text的刷新</span></li><li>      <span class="hljs-comment">// Text(`age: ${this.info.age}`)是冗余刷新</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change name'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Jane'</span>;</li><li>      })</li><li>
</li><li>      <span class="hljs-comment">// 点击当前Button，可以发现当前虽然仅改变了age属性</span></li><li>      <span class="hljs-comment">// 但是依旧会触发两个Text的刷新</span></li><li>      <span class="hljs-comment">// Text(`name: ${this.info.name}`)是冗余刷新</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span>++;</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>当UI刷新时，会执行组件的属性设置方法，利用这一机制可以通过观察getFontSize方法是否被调用来判断当前组件是否刷新。</p>  </div></div></div> <ul><li>UI首次渲染完成，观察到输出如下日志：</li></ul> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>Component 1 render</li><li>Component 2 render</li></ol></pre></div></div> <ul><li>当点击Button('change name')时，即使只修改了info.name，观察日志发现两个Text组件仍会重新渲染。组件Text(`age: ${this.info.age}`)并未使用name属性，但仍因为info.name的改变而刷新，因此这次刷新是冗余的。日志输出如下：</li></ul> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>Component 1 render</li><li>Component 2 render</li></ol></pre></div></div> <ul><li>同理，点击Button('change age')，也会触发Text(`name: ${this.info.name}`)的刷新。日志输出如下：</li></ul> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>Component 1 render</li><li>Component 2 render</li></ol></pre></div></div> <p>造成上述冗余刷新的根本原因是：状态管理V1中@State等装饰器无法精准观察类属性的访问与变更。为了实现类对象属性的精准观察，引入@Track装饰器。</p> </div>  <div class="tiledSection"><h2 id="装饰器说明">装饰器说明<i class="anchor-icon anchor-icon-link" anchorid="装饰器说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">@Track变量装饰器</th> <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">装饰器参数</td> <td class="cellrowborder" valign="top" width="50%">无</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">可装饰的变量</td> <td class="cellrowborder" valign="top" width="50%">class对象的非静态成员属性。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="观察变化和行为表现">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现" tips="复制节点链接"></i></h2><p>当一个class对象是状态变量时，@Track装饰的属性发生变化，该属性关联的UI触发更新。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>当class对象中没有一个属性被标记@Track，行为与原先保持不变。@Track没有深度观测的功能。</p>  </div></div></div> <p>使用@Track装饰器可以避免冗余刷新。</p> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">LogTrack</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">str1</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">str2</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">str1: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">str1</span> = str1;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">str2</span> = <span class="hljs-string">'World'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">LogNotTrack</span> {</li><li>  <span class="hljs-attr">str1</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">str2</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">str1: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">str1</span> = str1;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">str2</span> = <span class="hljs-string">'世界'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">AddLog</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">logTrack</span>: <span class="hljs-title class_">LogTrack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogTrack</span>(<span class="hljs-string">'Hello'</span>);</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">logNotTrack</span>: <span class="hljs-title class_">LogNotTrack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LogNotTrack</span>(<span class="hljs-string">'你好'</span>);</li><li>
</li><li>  <span class="hljs-title function_">isRender</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Text <span class="hljs-subst">${index}</span> is rendered`</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">50</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">logTrack</span>.<span class="hljs-property">str1</span>) <span class="hljs-comment">// Text1</span></li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isRender</span>(<span class="hljs-number">1</span>))</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">logTrack</span>.<span class="hljs-property">str2</span>) <span class="hljs-comment">// Text2</span></li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isRender</span>(<span class="hljs-number">2</span>))</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change logTrack.str1'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">logTrack</span>.<span class="hljs-property">str1</span> = <span class="hljs-string">'Bye'</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">logNotTrack</span>.<span class="hljs-property">str1</span>) <span class="hljs-comment">// Text3</span></li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isRender</span>(<span class="hljs-number">3</span>))</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">logNotTrack</span>.<span class="hljs-property">str2</span>) <span class="hljs-comment">// Text4</span></li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isRender</span>(<span class="hljs-number">4</span>))</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change logNotTrack.str1'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">logNotTrack</span>.<span class="hljs-property">str1</span> = <span class="hljs-string">'再见'</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <p>在上面的示例中：</p> <ol><li><p>类LogTrack中的属性均被@Track装饰器装饰，点击按钮"change logTrack.str1"，此时Text1刷新，Text2不刷新，只有一条日志输出，避免了冗余刷新。</p>  <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Text</span> <span class="hljs-number">1</span> is rendered</li></ol></pre></div></div>  </li><li><p>类logNotTrack中的属性均未被@Track装饰器装饰，点击按钮"change logNotTrack.str1"，此时Text3、Text4均会刷新，有两条日志输出，存在冗余刷新。</p>  <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Text</span> <span class="hljs-number">3</span> is rendered</li><li><span class="hljs-title class_">Text</span> <span class="hljs-number">4</span> is rendered</li></ol></pre></div></div>  </li></ol> </div>  <div class="tiledSection"><h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2><ul><li><p>如果class类中使用了@Track装饰器，那么该class类中非@Track装饰的属性不能在@Component UI中使用，包括不能绑定在组件上、不能用于初始化子组件，错误的使用将导致运行时报错，详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-track#在ui中使用非track装饰的属性发生运行时报错">在UI中使用非@Track装饰的属性发生运行时报错</a>；可以在非UI中使用非@Track装饰的属性，如事件回调函数中、生命周期函数中等。</p>  </li><li><p>API version 19及以后，@Track使用在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>的UI中，不会引起运行时报错，但依旧不会刷新，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-mixusage#observed装饰的class">常见场景</a>。</p>  </li><li><p>建议开发者不要混用包含@Track的class对象和不包含@Track的class对象，如联合类型中、类继承中等。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="track和自定义组件更新" class="firsth2">@Track和自定义组件更新<i class="anchor-icon anchor-icon-link" anchorid="track和自定义组件更新" tips="复制节点链接"></i></h3><p>以下示例展示组件更新和@Track的处理步骤。对象log是@State装饰的状态变量，logInfo是@Track装饰的成员属性，其余成员属性都是非@Track装饰的，而且也不准备在UI中更新它们的值。</p> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Log</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">logInfo</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">owner</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">time</span>: <span class="hljs-title class_">Date</span>;</li><li>  <span class="hljs-attr">location</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">reason</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">logInfo: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">logInfo</span> = logInfo;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">owner</span> = <span class="hljs-string">'OH'</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">time</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">location</span> = <span class="hljs-string">'CN'</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">reason</span> = <span class="hljs-string">'NULL'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">AddLog</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">log</span>: <span class="hljs-title class_">Log</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Log</span>(<span class="hljs-string">'origin info.'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">logInfo</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 没有被@Track装饰的属性可以在点击事件中使用。</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'owner: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">owner</span> +</li><li>              <span class="hljs-string">' id: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">id</span> +</li><li>              <span class="hljs-string">' time: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">time</span> +</li><li>              <span class="hljs-string">' location: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">location</span> +</li><li>              <span class="hljs-string">' reason: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">reason</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">time</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">id</span>++;</li><li>
</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">log</span>.<span class="hljs-property">logInfo</span> += <span class="hljs-string">' info.'</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <p>处理步骤：</p> <ol><li><p>AddLog自定义组件的Text.onClick点击事件自增字符串' info.'。</p>  </li><li><p>由于@State log变量的@Track属性logInfo更改，Text重新渲染。</p>  </li></ol> </div>  <div class="tiledSection"><h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="在ui中使用非track装饰的属性发生运行时报错" class="firsth2">在UI中使用非@Track装饰的属性发生运行时报错<i class="anchor-icon anchor-icon-link" anchorid="在ui中使用非track装饰的属性发生运行时报错" tips="复制节点链接"></i></h3><p>在UI中使用非@Track装饰的属性，运行时会报错。</p> <div _ngcontent-mae-c106="" class="highlight-div"><div _ngcontent-mae-c106="" class="highlight-div-header"><div _ngcontent-mae-c106="" class="highlight-div-header-left"><div _ngcontent-mae-c106="" class="handle-button expand-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mae-c106="" class="highlight-div-header-right"><div _ngcontent-mae-c106="" class="handle-button ai-button"></div><div _ngcontent-mae-c106="" class="handle-button line-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mae-c106="" class="handle-button theme-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mae-c106="" class="handle-button copy-button"><div _ngcontent-mae-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mae-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-comment">// id被@Track装饰</span></li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-comment">// age未被@Track装饰</span></li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">number</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">parent</span>: <span class="hljs-title class_">Person</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-number">2</span>, <span class="hljs-number">30</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 没有被@Track装饰的属性不可以在UI中使用，运行时会报错</span></li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent id is: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.parent.id}</span> and Parent age is: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.parent.age}</span>`</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>