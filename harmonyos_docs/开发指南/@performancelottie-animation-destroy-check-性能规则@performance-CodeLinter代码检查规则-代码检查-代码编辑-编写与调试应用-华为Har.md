<h1 _ngcontent-pfe-c119="" class="doc-title ng-star-inserted" title="@performance/lottie-animation-destroy-check"> @performance/lottie-animation-destroy-check </h1>

<div _ngcontent-pfe-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001960598254"><p id="ZH-CN_TOPIC_0000002510294451__p7917177165415">该规则检测使用lottie加载的动画是否都正确销毁。</p> <p id="ZH-CN_TOPIC_0000002510294451__p18393125073019">当使用lottie加载动画时，一般需要先通过lottie.loadAnimation将动画加载到内存，动画执行完毕后需要在合适的时机（例如：onDisAppear，onPageHide，aboutToDisappear）通过调用animationItem的destroy方法将单个动画销毁或者调用lottie.destroy()方法将当前页面所有动画销毁，如果动画未被销毁就会造成资源浪费，影响应用性能体验。</p> <p id="ZH-CN_TOPIC_0000002510294451__p148475014320">内存优化场景下，建议优先修改。</p> <div class="tiledSection"><h2 id="section118281715182614">规则配置<i class="anchor-icon anchor-icon-link" anchorid="section118281715182614" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen2316105518263" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// code-linter.json5</span></li><li>{</li><li>  <span class=""><span class="hljs-string">"rules"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"@performance/lottie-animation-destroy-check"</span></span>: <span class=""><span class="hljs-string">"suggestion"</span></span>,</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section182418564158">选项<i class="anchor-icon anchor-icon-link" anchorid="section182418564158" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002510294451__p157697119168">该规则无需配置额外选项。</p> </div> <div class="tiledSection"><h2 id="section470091981618">正例1<i class="anchor-icon anchor-icon-link" anchorid="section470091981618" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen2045102817174" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">lottie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;   <span class="hljs-comment">//需安装@ohos/lottie依赖后import</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;    <span class="hljs-comment">//需安装@ohos/lottie依赖后import</span></li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_START</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_END</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">120</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LottieAnimation1</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyController</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CanvasRenderingContext2D</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChicky</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'politeChicky'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyPath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'media/politeChicky.json'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">animateItem</span>?: <span class="hljs-title class_">AnimationItem</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Canvas</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">politeChickyController</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">3</span>)</li><li>      .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChicky</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>      .<span class="hljs-title function_">onDisAppear</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span>?.<span class="hljs-title function_">destroy</span>();<span class="hljs-comment">//只加载了一个Animation，可以使用animateItem的destroy接口</span></li><li>      })</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1099454213416">正例2<i class="anchor-icon anchor-icon-link" anchorid="section1099454213416" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen5531816171918" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">lottie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li>
</li><li><span class="hljs-comment">// 动画播放的起始帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_START</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>; </li><li><span class="hljs-comment">// 动画播放的终止帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_END</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">120</span>; </li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LottieAnimation2</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyController</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CanvasRenderingContext2D</span>();</li><li>  <span class="hljs-comment">// 动画名称</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChicky</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'politeChicky'</span>; </li><li>  <span class="hljs-comment">// hap包内动画资源文件路径，仅支持json格式</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyPath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'media/politeChicky.json'</span>; </li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">animateItem</span>: <span class="hljs-title class_">AnimationItem</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Canvas</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">politeChickyController</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">3</span>)</li><li>      .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-string">'anim_name1'</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>      .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-string">'anim_name2'</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onPageHide</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">destroy</span>();</li><li>  }</li><li>}</li><li>
</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section283178123814">反例1<i class="anchor-icon anchor-icon-link" anchorid="section283178123814" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen6396202871918" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">lottie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_START</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_END</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">120</span>;</li><li>
</li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LottieAnimation1</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyController</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CanvasRenderingContext2D</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChicky</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'politeChicky'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyPath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'media/politeChicky.json'</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">animateItem</span>?: <span class="hljs-title class_">AnimationItem</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Canvas</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">politeChickyController</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Gray</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">3</span>)</li><li>      .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>        <span class="hljs-comment">//告警</span></li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChicky</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>  }</li><li>}</li><li>
</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section44951828193810">反例2<i class="anchor-icon anchor-icon-link" anchorid="section44951828193810" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen049582893817" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">lottie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li>
</li><li><span class="hljs-comment">// 动画播放的起始帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_START</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>; </li><li><span class="hljs-comment">// 动画播放的终止帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_END</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">120</span>; </li><li>
</li><li><span class="hljs-comment">//调用多次loadAnimation，但是只在onDisAppear销毁一次</span></li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LottieAnimation4</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyController</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CanvasRenderingContext2D</span>();</li><li>  <span class="hljs-comment">// 动画名称  </span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChicky</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'politeChicky'</span>; </li><li>  <span class="hljs-comment">// hap包内动画资源文件路径，仅支持json格式</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyPath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'media/politeChicky.json'</span>; </li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">animateItem</span>: <span class="hljs-title class_">AnimationItem</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">null</span>;</li><li>  <span class="hljs-comment">// 初始化点击次数 </span></li><li>  @<span class="hljs-title function_">State</span> <span class="hljs-variable">times</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0</span>; </li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Stack</span>({ <span class="hljs-variable">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-title class_">TopStart</span> }) {</li><li>      <span class="hljs-comment">// 动画</span></li><li>      <span class="hljs-title function_">Canvas</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">politeChickyController</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">160</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Gray</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">3</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>            <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>            <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>            <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-variable">name</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChicky</span>,</li><li>            <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>            <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>          })</li><li>        })</li><li>        .<span class="hljs-title function_">onClick</span>(() =&gt; {</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>            <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>            <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>            <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-variable">name</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChicky</span>,</li><li>            <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>            <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>          })</li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">times</span>++;</li><li>        })</li><li>        .<span class="hljs-title function_">onDisAppear</span>(()=&gt; {</li><li>          <span class="hljs-comment">//上报此处animateItem，描述description不一样，如果无法找到动画名称，则直接建议用lottie.destroy</span></li><li>          <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span>?.<span class="hljs-title function_">destroy</span>();</li><li>        })</li><li>      <span class="hljs-comment">// 响应动画的文本</span></li><li>      <span class="hljs-title function_">Text</span>(<span class="hljs-string">'text'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">White</span>)</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-variable">top</span>: <span class="hljs-number">20</span> })</li><li>  }</li><li>}</li><li>
</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section9591434143810">反例3<i class="anchor-icon anchor-icon-link" anchorid="section9591434143810" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510294451__screen11591434203819" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-package">lottie</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">AnimationItem</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li><li>
</li><li><span class="hljs-comment">// 动画播放的起始帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_START</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">60</span>; </li><li><span class="hljs-comment">// 动画播放的终止帧</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">FRAME_END</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">120</span>; </li><li>
</li><li><span class="hljs-comment">//调用了销毁，但是不是全部销毁，上报</span></li><li>@<span class="hljs-title function_">Entry</span></li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">LottieAnimation5</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyController</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">CanvasRenderingContext2D</span>();</li><li>  <span class="hljs-comment">// 动画名称 </span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChicky</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'politeChicky'</span>; </li><li>  <span class="hljs-comment">// hap包内动画资源文件路径，仅支持json格式</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">politeChickyPath</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'media/politeChicky.json'</span>; </li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">animateItem</span>: <span class="hljs-title class_">AnimationItem</span> | <span class="hljs-title class_">null</span> = <span class="hljs-variable">null</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>    <span class="hljs-title function_">Canvas</span>(<span class="hljs-keyword">this</span>.<span class="hljs-variable">politeChickyController</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">160</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable">Color</span>.<span class="hljs-variable">Gray</span>)</li><li>      .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">3</span>)</li><li>      .<span class="hljs-title function_">onReady</span>(() =&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-string">'anim_name1'</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>      .<span class="hljs-title function_">onClick</span>(()=&gt; {</li><li>        <span class="hljs-keyword">this</span>.<span class="hljs-variable">animateItem</span> = <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">loadAnimation</span>({</li><li>          <span class="hljs-variable">container</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyController</span>,</li><li>          <span class="hljs-variable">renderer</span>: <span class="hljs-string">'canvas'</span>,</li><li>          <span class="hljs-variable">loop</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">autoplay</span>: <span class="hljs-keyword">true</span>,</li><li>          <span class="hljs-variable">name</span>: <span class="hljs-string">'anim_name2'</span>,</li><li>          <span class="hljs-variable">path</span>: <span class="hljs-keyword">this</span>.<span class="hljs-title class_">politeChickyPath</span>,</li><li>          <span class="hljs-variable">initialSegment</span>: [<span class="hljs-variable">FRAME_START</span>, <span class="hljs-variable">FRAME_END</span>]</li><li>        })</li><li>      })</li><li>      .<span class="hljs-title function_">onDisAppear</span>(()=&gt;{</li><li>        <span class="hljs-comment">//上报lottie,只销毁一个</span></li><li>        <span class="hljs-variable">lottie</span>.<span class="hljs-title function_">destroy</span>(<span class="hljs-string">'anim_name2'</span>);</li><li>      })</li><li>  }</li><li>}</li><li>
</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1613660124014">规则集<i class="anchor-icon anchor-icon-link" anchorid="section1613660124014" tips="复制节点链接"></i></h2><div _ngcontent-pfe-c106="" class="highlight-div"><div _ngcontent-pfe-c106="" class="highlight-div-header"><div _ngcontent-pfe-c106="" class="highlight-div-header-left"><div _ngcontent-pfe-c106="" class="handle-button expand-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pfe-c106="" class="highlight-div-header-right"><div _ngcontent-pfe-c106="" class="handle-button ai-button"></div><div _ngcontent-pfe-c106="" class="handle-button line-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pfe-c106="" class="handle-button theme-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pfe-c106="" class="handle-button copy-button"><div _ngcontent-pfe-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pfe-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" id="ZH-CN_TOPIC_0000002510294451__screen4618649194513" data-highlighted="yes"><ol class="linenums"><li><span class="">plugin:<span class="hljs-variable">@performance</span><span class="hljs-operator">/</span><span class="hljs-keyword">all</span></span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002510294451__p72027303176">Code Linter代码检查规则的配置指导请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-code-linter">Code Linter代码检查</a>。</p> </div> </div> <div></div></div>