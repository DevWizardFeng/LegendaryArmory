<h1 _ngcontent-lsr-c119="" class="doc-title ng-star-inserted" title="ABR功能开发"> ABR功能开发 </h1>

<div _ngcontent-lsr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section82517259385">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section82517259385" tips="复制节点链接"></i></h2>          <p>基于相机运动感知策略的ABR主要业务流程如下：</p>     <p><span><img originheight="955" originwidth="965" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114354.20175594201777871809260824212367:50001231000000:2800:8819E50CF3424ACA199C7ABEADF69A685A61B00B20B1EEDB8E4CACD0FBF53FD2.png" width="920" height="910.4663212435232"></span></p>     <ol>      <li>用户进入ABR适用的游戏场景。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga8f785903a5382ff31baef78a3968f66a" target="_blank">HMS_ABR_CreateContext</a>接口并指定图形API类型，创建ABR上下文实例。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6c613e02088d559b9dc1450fde15bc2a" target="_blank">HMS_ABR_SetTargetFps</a>接口初始化ABR实例，配置目标帧率属性，ABR结合目标帧率属性实时感知GPU负载状态。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga1001c6a7739d8ce57bf851986f121bf5" target="_blank">HMS_ABR_SetScaleRange</a>接口初始化ABR实例，配置Buffer分辨率因子范围属性。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga463d8d5396bfd5f6ed800ddab616479a" target="_blank">HMS_ABR_Activate</a>接口激活ABR上下文实例。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga5b895e36d31e46f71d04aba78c8f3716" target="_blank">HMS_ABR_UpdateCameraData</a>接口并传入相机运动信息，包含相机旋转、位移信息。</li>      <li>游戏应用在使能ABR的Buffer渲染前调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga821fb33620312d3adba51d30254c1ef0" target="_blank">HMS_ABR_MarkFrameBuffer_GLES</a>接口，对Buffer进行标记。</li>      <li>Buffer渲染处理。</li>      <li>绘制UI。</li>      <li>一帧送显。</li>      <li>用户退出ABR适用的游戏场景。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#gaf3c03179b9bcf1b8475230cbbb0d877c" target="_blank">HMS_ABR_DestroyContext</a>接口销毁ABR上下文实例并释放内存资源。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1588405684317">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1588405684317" tips="复制节点链接"></i></h2>          <p>本节阐述基于相机运动感知策略的ABR使用，从流程上分别阐述每个步骤的实现和调用。详细代码请参考<a href="https://gitcode.com/harmonyos_samples/adaptive-buffer-resolution-samplecode-clientdemo-cpp" target="_blank">图形开发Sample（ABR）</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section1452251416266" class="firsth2">设置项目配置项<i class="anchor-icon anchor-icon-link" anchorid="section1452251416266" tips="复制节点链接"></i></h3>          <p>在<span class="filepath">“src/main/module.json5”</span>module层级中添加以下配置。</p>     <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>  <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GraphicsAccelerateKit_ABR"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"true"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">]</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section5146871278">头文件引用<i class="anchor-icon anchor-icon-link" anchorid="section5146871278" tips="复制节点链接"></i></h3>          <div class="p">      引用Graphics Accelerate Kit ABR头文件：abr_gles.h。      <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 引用ABR头文件 abr_gles.h</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;graphics_game_sdk/abr_gles.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;GLES3/gl32.h&gt;</span></span></li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section156111314818">编写CMakeLists.txt<i class="anchor-icon anchor-icon-link" anchorid="section156111314818" tips="复制节点链接"></i></h3>          <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    abr-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    libabr.so</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    GLES-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    GLESv3</li><li>)</li><li><span class="hljs-built_in">find_library</span>(</li><li>    # Sets the name of the path variable.</li><li>    hilog-lib</li><li>    # Specifies the name of the NDK library that you want CMake to locate.</li><li>    hilog_ndk.z</li><li>)</li><li>
</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC</li><li>    ${abr-lib} ${GLES-lib} ${hilog-lib}</li><li>)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section5408154815361">ABR初始化<i class="anchor-icon anchor-icon-link" anchorid="section5408154815361" tips="复制节点链接"></i></h3>          <p>在应用创建Surface后会触发其事件回调函数<span class="parmname">Core::OnSurfaceCreated()</span>，在该函数中完成ABR上下文实例创建、ABR属性配置和功能激活。其中ABR上下文实例负责管理ABR整个生命周期。</p>     <ol>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga8f785903a5382ff31baef78a3968f66a" target="_blank">HMS_ABR_CreateContext</a>接口创建ABR上下文实例，指定图形API类型。如果返回nullptr，则说明ABR上下文实例创建失败，或当前硬件设备不支持开启ABR。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建ABR上下文实例，指定图形API类型</span></li><li>ABR_Context *context_ = <span class="hljs-built_in">HMS_ABR_CreateContext</span>(RENDER_API_GLES);</li><li><span class="hljs-keyword">if</span> (context_ == <span class="hljs-literal">nullptr</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6c613e02088d559b9dc1450fde15bc2a" target="_blank">HMS_ABR_SetTargetFps</a>接口初始化ABR实例，根据游戏的目标帧率配置ABR的目标帧率属性。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化ABR接口调用错误码</span></li><li>ABR_ErrorCode errorCode = ABR_SUCCESS;</li><li>
</li><li><span class="hljs-comment">// 初始化ABR实例，配置ABR的目标帧率属性。例如游戏目标帧率为120fps，则配置ABR的目标帧率属性为120fps</span></li><li>errorCode = <span class="hljs-built_in">HMS_ABR_SetTargetFps</span>(context_, <span class="hljs-number">120</span>);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga1001c6a7739d8ce57bf851986f121bf5" target="_blank">HMS_ABR_SetScaleRange</a>接口初始化ABR实例，配置Buffer分辨率因子范围属性。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化ABR实例，配置Buffer分辨率因子范围属性，结合具体游戏分辨率、画质设置合适的范围</span></li><li><span class="hljs-comment">// 例如设置ABR对Buffer分辨率进行0.5~1.0倍的自适应调整</span></li><li>errorCode = <span class="hljs-built_in">HMS_ABR_SetScaleRange</span>(context_, <span class="hljs-number">0.5f</span>, <span class="hljs-number">1.0f</span>);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga463d8d5396bfd5f6ed800ddab616479a" target="_blank">HMS_ABR_Activate</a>接口激活ABR上下文实例。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 激活ABR上下文实例</span></li><li>errorCode = <span class="hljs-built_in">HMS_ABR_Activate</span>(context_);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1664235112813">相机运动数据更新<i class="anchor-icon anchor-icon-link" anchorid="section1664235112813" tips="复制节点链接"></i></h3>          <p>在帧循环中，ABR根据获取的实时相机运动数据进行Buffer分辨率因子决策。</p>     <div class="p">      调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga5b895e36d31e46f71d04aba78c8f3716" target="_blank">HMS_ABR_UpdateCameraData</a>接口并传入相机运动信息，包含相机旋转、位移信息。      <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 相机运动数据结构体，设置每帧实时相机运动数据</span></li><li>ABR_CameraData cameraData;</li><li><span class="hljs-comment">// 每帧位置</span></li><li>ABR_Vector3 position_<span class="">;</span></li><li><span class="hljs-comment">// 每帧的相机旋转角，范围是[0, 360]</span></li><li>ABR_Vector3 rotation_;</li><li>cameraData.position = position_;</li><li>cameraData.rotation = rotation_;</li><li>
</li><li><span class="hljs-comment">// 每帧相机运动数据更新</span></li><li>errorCode = <span class="hljs-built_in">HMS_ABR_UpdateCameraData</span>(context_, &amp;cameraData);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section1669017552917">自适应渲染<i class="anchor-icon anchor-icon-link" anchorid="section1669017552917" tips="复制节点链接"></i></h3>          <p>在帧循环中，ABR将对所标记的Buffer进行自适应渲染处理。</p>     <ol>      <li>选择着色器处理耗时较高的Buffer，并在Buffer渲染前绑定帧缓冲。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建帧缓冲对象</span></li><li>GLuint fbo;</li><li><span class="hljs-built_in">glGenFramebuffers</span>(<span class=""><span class="hljs-number">1</span></span>, &amp;fbo);</li><li><span class="hljs-comment">// 绑定帧缓冲</span></li><li><span class="hljs-built_in">glBindFramebuffer</span>(GL_FRAMEBUFFER, fbo);</li></ol></pre></div></div></li>      <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga821fb33620312d3adba51d30254c1ef0" target="_blank">HMS_ABR_MarkFrameBuffer_GLES</a>接口对Buffer进行标记。       <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在Buffer渲染前调用，执行失败不影响Buffer正常渲染</span></li><li>errorCode = <span class="hljs-built_in">HMS_ABR_MarkFrameBuffer_GLES</span>(context_);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>      <li>执行Buffer原有渲染流程。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1187271882919">销毁ABR实例<i class="anchor-icon anchor-icon-link" anchorid="section1187271882919" tips="复制节点链接"></i></h3>          <p>在Surface销毁时，会触发其事件回调函数<span class="parmname">Core::OnSurfaceDestroyed()</span>，在该函数中完成ABR实例的销毁。</p>     <div class="p">      调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#gaf3c03179b9bcf1b8475230cbbb0d877c" target="_blank">HMS_ABR_DestroyContext</a>接口销毁ABR实例，释放内存资源。      <div _ngcontent-lsr-c106="" class="highlight-div"><div _ngcontent-lsr-c106="" class="highlight-div-header"><div _ngcontent-lsr-c106="" class="highlight-div-header-left"><div _ngcontent-lsr-c106="" class="handle-button expand-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lsr-c106="" class="highlight-div-header-right"><div _ngcontent-lsr-c106="" class="handle-button ai-button"></div><div _ngcontent-lsr-c106="" class="handle-button line-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lsr-c106="" class="handle-button theme-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lsr-c106="" class="handle-button copy-button"><div _ngcontent-lsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 销毁ABR上下文实例并释放内存资源</span></li><li>ABR_ErrorCode errorCode = <span class="hljs-built_in">HMS_ABR_DestroyContext</span>(&amp;context_);</li><li><span class="hljs-keyword">if</span> (errorCode != ABR_SUCCESS) {</li><li>     <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div>     </div>    </div>   </div>   <div></div></div>