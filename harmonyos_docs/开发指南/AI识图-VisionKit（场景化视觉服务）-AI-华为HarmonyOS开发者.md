<h1 _ngcontent-guv-c119="" class="doc-title ng-star-inserted" title="AI识图"> AI识图 </h1>

<div _ngcontent-guv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section482817427145">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section482817427145" tips="复制节点链接"></i></h2>          <p>AI识图是通过聚合OCR（Optical Character Recognition）、主体分割、实体识别、多目标识别等AI能力，提供场景化的文本识别、主体分割、识图搜索功能。AI识图功能主开关入口在基础控件API列表中，如果您接受AI识图默认的交互和功能，仅需使用基础控件提供的相关使能接口打开功能开关即可。该文档配套的API配合基础控件使用，主要满足您的定制诉求，帮助您完成AI识图功能交互上的细粒度控制，获取文本识别、图像分割等分析结果以便您进行扩展业务的开发，目前支持的基础控件范围包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image#enableanalyzer11" target="_blank">Image</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-media-components-video#enableanalyzer12" target="_blank">Video</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent#enableanalyzer12" target="_blank">XComponent</a>。其中，配合Image控件可完成静态图片上的识图功能，配合Video控件可完成视频播放暂停帧的识图功能，配合XComponent可完成自定义渲染等场景下的图像的识图功能。</p>     <p>识图功能提供如下能力：</p>     <ul>      <li>识别文字。       <p>用户长按文本选取文字或持续长按文本中的电话号码、邮箱、网址、地址、时间等实体，可触发对应实体的快捷操作，如持续长按文本中的时间，可触发"新建日程"快捷操作入口。</p></li>      <li>识图搜索。       <p>用户抠图后可基于抠出的主体进行识图搜索，开发者也可以主动触发目标标识，触发后会识别图中的动物、植物、建筑物等目标并用相应的ICON标识，用户点击ICON也可以进行识图搜索，搜索结果会以模态窗的方式为用户呈现。</p></li>      <li>主体分割。       <p>用户长按主体分割，分割后用户可以完成复制，分享，全选，识图搜索等功能。</p></li>      <li>AIButton。       <p>AIButton承载了电话号码、邮箱、网址、地址、时间等实体的显性下划线标识（点击后出现快捷操作菜单），原图翻译（系统设置语种与图片上文本语种不一致且能将图中文本翻译为系统当前设置的语种时出现），表格提取（图片中存在表格时出现）等功能特性。配置AIButton属性可见后，会对图片进行预分析，当图片中存在文本且文本区域大于图片区域的5%时AIButton才会显示。</p></li>     </ul>     <div class="p">      识图功能提供如下建议：      <ul>       <li>AI识图特性可帮助消费者从图片上获取更多的信息（长按抠图，长按选取文本，长按实体识别等）。建议在大图预览场景都打开此能力，大图预览场景下用户对图片中的内容会更感兴趣，此时适时的提供识图服务契合用户体验场景，同时为用户提供最佳的识图交互体验。</li>       <li>AI识图特性中的AIButton与图片中是否有文本存在关联，显性的提醒用户操作文本。开启AIButton会触发图片的预分析从而导致一定的功耗开销，建议开发者充分理解自身业务场景，预估目标用户图片内容分布，兼顾用户图片浏览体验和提供更高阶AI识图功能体验的情况下按需提供AIButton露出。例如，业务本身是辅助用户高效提取图片中的文本内容，开启AIButton将会提升用户文本提取的体验。业务本身更偏向于图片编辑，也可隐藏AIButton。</li>      </ul>     </div>     <div class="fignone">      <span class="figcap"><b>图1 </b>AI识图示意图</span>      <br><span><img height="565.01592" originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114227.96495312983836668760824360573996:50001231000000:2800:728C9CFE31A4B1E683A616B231C4D661DA2683003321ED3D0C6EB7B798EBBBE7.png" title="点击放大" width="272.3175"></span>     </div>    </div>    <div class="tiledSection">     <h2 id="section2020122517405">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2020122517405" tips="复制节点链接"></i></h2>          <ul>      <li>支持的文本语种类型：简体中文、繁体中文、英文、维吾尔文、藏文。</li>      <li>支持图片最小规格100*100分辨率。</li>      <li>分析图像要求是静态非矢量图，即svg、gif等图像类型不支持分析，支持传入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>进行分析，目前仅支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-e#pixelmapformat7" target="_blank">RGBA_8888</a>类型。</li>      <li>支持翻译的图片宽高最小比例为1:3（高度小于宽度的3倍），支持文本识别的图片宽高最小比例为1:7（高度小于宽度的7倍）。</li>      <li>当前设备支持本能力可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-image-common#getimageanalyzersupporttypes12" target="_blank">getImageAnalyzerSupportTypes</a>进行判断。       <p>日志返回格式为“SupportTypes: [<em>主体识别功能枚举值</em>,<em>文字识别功能枚举值</em>,<em>对象查找功能枚举值</em>]”，具体枚举值可参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-image-common#imageanalyzertype12" target="_blank">ImageAnalyzerType</a>。</p>       <div class="p">        若返回“SupportTypes: []”，则说明当前设备不支持AI识图能力；若返回其他值，则说明当前设备支持AI识图能力。        <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { visionImageAnalyzer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">aiController</span>: visionImageAnalyzer.<span class="hljs-property">VisionImageAnalyzerController</span> = <span class="hljs-keyword">new</span> visionImageAnalyzer.<span class="hljs-title class_">VisionImageAnalyzerController</span>()</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getTypes'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-title class_">SupportTypes</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">aiController</span>.<span class="hljs-title function_">getImageAnalyzerSupportTypes</span>()</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`SupportTypes: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(SupportTypes)}</span>`</span>)</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       </div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section620822710914">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section620822710914" tips="复制节点链接"></i></h2>         </div>    <ol>     <li><span>将AI识图控件相关的类添加。</span>      <p></p>      <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { visionImageAnalyzer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div>      <p></p></li>     <li><span>初始化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-image-analyzer#section37192953318" target="_blank">VisionImageAnalyzerController</a>对象。</span>      <p></p>      <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">visionImageAnalyzerController</span>: visionImageAnalyzer.<span class="hljs-property">VisionImageAnalyzerController</span> = <span class="hljs-keyword">new</span> visionImageAnalyzer.<span class="hljs-title class_">VisionImageAnalyzerController</span>();</li></ol></pre></div></div>      <p></p></li>     <li><span>添加订阅事件。</span>      <p></p>      <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'imageAnalyzerVisibilityChange'</span>, <span class="hljs-function">(<span class="hljs-params">visibility: visionImageAnalyzer.ImageAnalyzerVisibility</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`imageAnalyzerVisibilityChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(visibility)}</span>`</span>)</li><li>  })</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'textAnalysis'</span>, <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`textAnalysis result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(text)}</span>`</span>)</li><li>  })</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'selectedTextChange'</span>, <span class="hljs-function">(<span class="hljs-params">selectedText: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`selectedTextChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(selectedText)}</span>`</span>)</li><li>  })</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'subjectAnalysis'</span>, <span class="hljs-function">(<span class="hljs-params">subjects: visionImageAnalyzer.Subject[]</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`subjectAnalysis result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(subjects)}</span>`</span>)</li><li>  })</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'selectedSubjectsChange'</span>, <span class="hljs-function">(<span class="hljs-params">subjects: visionImageAnalyzer.Subject[]</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`selectedSubjectsChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(subjects)}</span>`</span>)</li><li>  })</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'analyzerFailed'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`analyzerFailed result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>)</li><li>  })</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>绑定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-image-analyzer#section37192953318" target="_blank">VisionImageAnalyzerController</a>对象，可以控制识图相关的交互。</span>      <p></p>      <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Stack</span>() {</li><li>    <span class="hljs-comment">// 需要替换您自己的资源图片，存放在resources/base/media目录下</span></li><li>    <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.img'</span>), {</li><li>      <span class="hljs-attr">types</span>: [<span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">TEXT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">SUBJECT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">OBJECT_LOOKUP</span>],</li><li>      <span class="hljs-attr">aiController</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span></li><li>    })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">enableAnalyzer</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>  }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li></ol></pre></div></div>      <p></p></li>     <li><span>取消订阅事件。</span>      <p></p>      <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'imageAnalyzerVisibilityChange'</span>)</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'textAnalysis'</span>)</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'selectedTextChange'</span>)</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'subjectAnalysis'</span>)</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'selectedSubjectsChange'</span>)</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'analyzerFailed'</span>)</li><li>}</li></ol></pre></div></div>      <p></p></li>    </ol>    <div class="tiledSection">     <h2 id="section1685312520306">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section1685312520306" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1897134811412" class="firsth2">Index.ets<i class="anchor-icon anchor-icon-link" anchorid="section1897134811412" tips="复制节点链接"></i></h3>          <div _ngcontent-guv-c106="" class="highlight-div"><div _ngcontent-guv-c106="" class="highlight-div-header"><div _ngcontent-guv-c106="" class="highlight-div-header-left"><div _ngcontent-guv-c106="" class="handle-button expand-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-guv-c106="" class="highlight-div-header-right"><div _ngcontent-guv-c106="" class="handle-button ai-button"></div><div _ngcontent-guv-c106="" class="handle-button line-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-guv-c106="" class="handle-button theme-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-guv-c106="" class="handle-button copy-button"><div _ngcontent-guv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-guv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { visionImageAnalyzer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ImageDemo</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">visionImageAnalyzerController</span>: visionImageAnalyzer.<span class="hljs-property">VisionImageAnalyzerController</span> = <span class="hljs-keyword">new</span> visionImageAnalyzer.<span class="hljs-title class_">VisionImageAnalyzerController</span>()</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'imageAnalyzerVisibilityChange'</span>, <span class="hljs-function">(<span class="hljs-params">visibility: visionImageAnalyzer.ImageAnalyzerVisibility</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`imageAnalyzerVisibilityChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(visibility)}</span>`</span>)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'textAnalysis'</span>, <span class="hljs-function">(<span class="hljs-params">text: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`textAnalysis result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(text)}</span>`</span>)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'selectedTextChange'</span>, <span class="hljs-function">(<span class="hljs-params">selectedText: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`selectedTextChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(selectedText)}</span>`</span>)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'subjectAnalysis'</span>, <span class="hljs-function">(<span class="hljs-params">subjects: visionImageAnalyzer.Subject[]</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`subjectAnalysis result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(subjects)}</span>`</span>)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'selectedSubjectsChange'</span>, <span class="hljs-function">(<span class="hljs-params">subjects: visionImageAnalyzer.Subject[]</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`selectedSubjectsChange result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(subjects)}</span>`</span>)</li><li>    })</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'analyzerFailed'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"DEMO_TAG"</span>, <span class="hljs-string">`analyzerFailed result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>)</li><li>    })</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>() {</li><li>      <span class="hljs-title class_">Image</span>($r(<span class="hljs-string">'app.media.img'</span>), {</li><li>        <span class="hljs-attr">types</span>: [<span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">TEXT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">SUBJECT</span>, <span class="hljs-title class_">ImageAnalyzerType</span>.<span class="hljs-property">OBJECT_LOOKUP</span>],</li><li>        <span class="hljs-attr">aiController</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span></li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">enableAnalyzer</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Contain</span>)</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>    <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-built_in">void</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'imageAnalyzerVisibilityChange'</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'textAnalysis'</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'selectedTextChange'</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'subjectAnalysis'</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'selectedSubjectsChange'</span>)</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">visionImageAnalyzerController</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'analyzerFailed'</span>)</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>