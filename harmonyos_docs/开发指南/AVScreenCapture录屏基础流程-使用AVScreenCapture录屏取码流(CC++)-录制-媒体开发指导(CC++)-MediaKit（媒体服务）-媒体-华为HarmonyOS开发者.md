<h1 _ngcontent-whb-c119="" class="doc-title ng-star-inserted" title="AVScreenCapture录屏基础流程"> AVScreenCapture录屏基础流程 </h1>

<div _ngcontent-whb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>屏幕录制功能支持开发者获取屏幕数据，适用于屏幕录制、会议共享、直播等场景。开发者可通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#avscreencapture">AVScreenCapture</a>模块的C API，采集设备内外的音视频数据源。该模块需与窗口管理（Window）、图形处理（Graphic）等模块协同工作，以完成完整的视频采集流程。</p>    <div class="tiledSection">     <h2 id="流程介绍">流程介绍<i class="anchor-icon anchor-icon-link" anchorid="流程介绍" tips="复制节点链接"></i></h2>          <p>基础屏幕录制功能涉及到AVScreenCapture实例创建、音视频参数配置、回调设置、开始与停止、结果处理、资源释放等步骤。</p>     <p>在此基础上，开发者可以根据视频录制、直播等特定场景进行更高级的设置，详情参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avscreencapture-c-custom-scenarios">AVScreenCapture录屏自定义场景</a>。</p>     <p>基础流程如下图所示：</p>     <p><span><img originheight="852" originwidth="1585" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114451.08913740887740050877148836356868:50001231000000:2800:A263922C58EC6DB18E96537DF0F11FC4D6401994289F03CAED35DD3F3AF3D586.png" width="920" height="494.5362776025237"></span></p>     <p>录屏采集的内容输出方式如下。</p>     <ul>      <li>       <p>文件形式：保存为文件，该文件可以播放、分享等。</p></li>      <li>       <p>码流形式：该码流可根据场景进行不同的处理，例如将码流流转到其他模块，实现桌面共享、视频直播等。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>使用AVScreenCapture时需明确其状态变化。创建实例后，调用方法可进入指定状态。在错误状态下执行方法会导致AVScreenCapture出错。开发者应在状态转换前进行检查以避免异常。</p></li>      <li>       <p>在录屏取码流场景中，屏幕录制启动时会弹出隐私保护弹框，包含“屏幕隐私保护”选项。勾选后，隐私信息（如横幅通知、控制中心、通话界面等）将被屏蔽。不同产品上的隐私信息可能有差异，以实际录制结果为准。</p>       <p>隐私保护弹框：</p>       <p><span><img originheight="562" originwidth="270" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114451.35138657691265245757605510113192:50001231000000:2800:464918C7E34B5AC6E3D7EFDF8090A62F9A4510140FE8468145B43AB9EF0D893A.png" class="notEnlarge" width="270" height="562"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="通用开发步骤">通用开发步骤<i class="anchor-icon anchor-icon-link" anchorid="通用开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="依赖导入" class="firsth2">依赖导入<i class="anchor-icon anchor-icon-link" anchorid="依赖导入" tips="复制节点链接"></i></h3>          <p>在CMake脚本中链接动态库：</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_avscreen_capture.so libnative_buffer.so libnative_media_core.so)</li></ol></pre></div></div>     <p>添加头文件：</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avscreen_capture.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avscreen_capture_base.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avscreen_capture_errors.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;multimedia/player_framework/native_avbuffer.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_buffer/native_buffer.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="创建avscreencapture实例">创建AVScreenCapture实例<i class="anchor-icon anchor-icon-link" anchorid="创建avscreencapture实例" tips="复制节点链接"></i></h3>          <p>实例化对象，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_create" target="_blank">OH_AVScreenCapture_Create</a>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-avscreencapture" target="_blank">OH_AVScreenCapture</a>。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_AVScreenCapture* capture = OH_AVScreenCapture_Create();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="配置音频采集参数">配置音频采集参数<i class="anchor-icon anchor-icon-link" anchorid="配置音频采集参数" tips="复制节点链接"></i></h3>          <p>创建AVScreenCapture实例后，可设置屏幕录制所需要的音频参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-audioinfo" target="_blank">OH_AudioInfo</a>，包括内录、麦克风音频<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-audiocaptureinfo" target="_blank">OH_AudioCaptureInfo</a>和输出规格<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-audioencinfo" target="_blank">OH_AudioEncInfo</a>。</p>     <p>如果配置了采集麦克风音频数据，需：</p>     <ul>      <li>配置麦克风权限ohos.permission.MICROPHONE，配置方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/request-user-authorization">向用户申请权限</a>。</li>      <li>申请长时任务，申请方式请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/continuous-task">申请长时任务</a>。</li>     </ul>     <p>录屏存文件时默认只开启内录。录制过程中，麦克风可以动态开启/关闭，开启后，可同时启动内外录制。</p>     <p>内录音频信息必须设置，麦克风音频信息可按实际场景按需设置。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 录屏时获取麦克风，如果同时设置了内录和麦克风音频信息，两者参数设置需保持一致。</span></li><li><span class="hljs-type">OH_AudioCaptureInfo</span> <span class="hljs-variable">micCapInfo</span> <span class="hljs-operator">=</span> {</li><li>    .audioSampleRate = <span class="hljs-number">48000</span>,</li><li>    .audioChannels = <span class="hljs-number">2</span>,</li><li>    .audioSource = OH_MIC</li><li>};</li><li><span class="hljs-comment">// 录屏时获取内录数据，内录参数必填。如果同时设置了内录和麦克风音频信息，两者参数设置需保持一致。</span></li><li><span class="hljs-type">OH_AudioCaptureInfo</span> <span class="hljs-variable">innerCapInfo</span> <span class="hljs-operator">=</span> {</li><li>    .audioSampleRate = <span class="hljs-number">48000</span>,</li><li>    .audioChannels = <span class="hljs-number">2</span>,</li><li>    .audioSource = OH_ALL_PLAYBACK</li><li>};</li><li><span class="hljs-comment">// 录屏音频输出规格配置。</span></li><li><span class="hljs-type">OH_AudioEncInfo</span> <span class="hljs-variable">audioEncInfo</span> <span class="hljs-operator">=</span> {</li><li>    .audioBitrate = <span class="hljs-number">48000</span>,</li><li>    .audioCodecformat = OH_AAC_LC</li><li>};</li><li><span class="hljs-type">OH_AudioInfo</span> <span class="hljs-variable">audioInfo</span> <span class="hljs-operator">=</span> {</li><li>    .micCapInfo = micCapInfo,</li><li>    .innerCapInfo = innerCapInfo,</li><li>    .audioEncInfo = audioEncInfo</li><li>};</li><li><span class="hljs-comment">// 可以单独设置麦克风开关。</span></li><li><span class="hljs-type">bool</span> <span class="hljs-variable">isMic</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;</li><li>OH_AVScreenCapture_SetMicrophoneEnabled(capture, isMic);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="配置视频采集参数">配置视频采集参数<i class="anchor-icon anchor-icon-link" anchorid="配置视频采集参数" tips="复制节点链接"></i></h3>          <p>录屏的视频采集信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-videoinfo" target="_blank">OH_VideoInfo</a>包含录屏输入规格配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-videocaptureinfo" target="_blank">OH_VideoCaptureInfo</a>和录屏输出规格配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-videoencinfo" target="_blank">OH_VideoEncInfo</a>。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 录屏输入规格配置。</span></li><li><span class="hljs-type">OH_VideoCaptureInfo</span> <span class="hljs-variable">videoCapInfo</span> <span class="hljs-operator">=</span> {</li><li>    .videoFrameWidth = <span class="hljs-number">768</span>,</li><li>    .videoFrameHeight = <span class="hljs-number">1280</span>,</li><li>    .videoSource = OH_VIDEO_SOURCE_SURFACE_RGBA</li><li> };</li><li><span class="hljs-comment">// 录屏输出规格配置。</span></li><li><span class="hljs-type">OH_VideoEncInfo</span> <span class="hljs-variable">videoEncInfo</span> <span class="hljs-operator">=</span> {</li><li>    .videoCodec = OH_H264,</li><li>    .videoBitrate = <span class="hljs-number">2000000</span>,</li><li>    .videoFrameRate = <span class="hljs-number">30</span></li><li> };</li><li><span class="hljs-type">OH_VideoInfo</span> <span class="hljs-variable">videoInfo</span> <span class="hljs-operator">=</span> {</li><li>    .videoCapInfo = videoCapInfo,</li><li>    .videoEncInfo = videoEncInfo</li><li>};</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="初始化avscreencapture实例配置">初始化AVScreenCapture实例配置<i class="anchor-icon anchor-icon-link" anchorid="初始化avscreencapture实例配置" tips="复制节点链接"></i></h3>          <p>AVScreenCapture实例的配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-avscreencaptureconfig" target="_blank">OH_AVScreenRecorderConfig</a>，包括录制数据格式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-videoinfo" target="_blank">OH_VideoInfo</a>、音视频采集参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-audioinfo" target="_blank">OH_AudioInfo</a>、录屏模式<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_capturemode" target="_blank">OH_CaptureMode</a>等，录屏模式包含OH_CAPTURE_HOME_SCREEN、OH_CAPTURE_SPECIFIED_SCREEN、OH_CAPTURE_SPECIFIED_WINDOW。</p>     <p>配置完成后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_init" target="_blank">OH_AVScreenCapture_Init</a>将配置项设置到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avscreencapture-oh-avscreencapture" target="_blank">OH_AVScreenCapture</a>中。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在PC/2in1设备上，根据不同的录屏模式会有不同弹窗表现，详情见<a href="/consumer/cn/doc/harmonyos-guides/avscreencapture-c-basic-process#pc2in1弹窗模式配置说明">PC/2in1弹窗模式配置说明</a>。</p>      </div></div></div>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化录屏，传入配置信息OH_AVScreenRecorderConfig。</span></li><li><span class="hljs-type">OH_AVScreenCaptureConfig</span> <span class="hljs-variable">config</span> <span class="hljs-operator">=</span> {</li><li>    .dataType = OH_ORIGINAL_STREAM,</li><li>    .audioInfo = audioInfo,</li><li>    .captureMode = OH_CAPTURE_HOME_SCREEN, <span class="hljs-comment">//录屏模式设置。</span></li><li>    .videoInfo = videoInfo</li><li>};</li><li>OH_AVScreenCapture_Init(capture, config);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置数据更新状态切换错误上报的回调">设置数据更新、状态切换、错误上报的回调<i class="anchor-icon anchor-icon-link" anchorid="设置数据更新状态切换错误上报的回调" tips="复制节点链接"></i></h3>          <p>回调函数主要用来监听录屏过程中的错误发生、音视频流生成和录屏状态变更等事件，详细内容请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_avscreencaptureonerror" target="_blank">错误回调</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_setstatecallback" target="_blank">状态回调</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_setdatacallback" target="_blank">获取数据回调</a>。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置回调。</span></li><li><span class="hljs-comment">// 错误事件发生回调函数OnError()。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnError</span><span class="hljs-params">(OH_AVScreenCapture *capture, <span class="hljs-type">int32_t</span> errorCode, <span class="hljs-type">void</span> *userData)</span> </span>{</li><li>    (<span class="hljs-type">void</span>)capture;</li><li>    <span class="hljs-comment">// 应用根据错误码进行事件处理。</span></li><li>    (<span class="hljs-type">void</span>)errorCode;</li><li>    (<span class="hljs-type">void</span>)userData;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 状态变更事件处理函数OnStateChange()。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnStateChange</span><span class="hljs-params">(<span class="hljs-keyword">struct</span> OH_AVScreenCapture *capture, OH_AVScreenCaptureStateCode stateCode, <span class="hljs-type">void</span> *userData)</span> </span>{</li><li>    (<span class="hljs-type">void</span>)capture;</li><li>    <span class="hljs-keyword">if</span> (stateCode == OH_AVScreenCaptureStateCode::OH_SCREEN_CAPTURE_STATE_CANCELED) { <span class="hljs-comment">// 按照所需状态自行修改填写。</span></li><li>        <span class="hljs-comment">// 处理录屏状态变更。</span></li><li>    }</li><li>    (<span class="hljs-type">void</span>)userData;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 获取并处理音视频原始码流数据回调函数OnBufferAvailable()。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnBufferAvailable</span><span class="hljs-params">(OH_AVScreenCapture *capture, OH_AVBuffer *buffer, OH_AVScreenCaptureBufferType bufferType, <span class="hljs-type">int64_t</span> timestamp, <span class="hljs-type">void</span> *userData)</span> </span>{</li><li>    <span class="hljs-comment">// 处于录屏取码流状态。</span></li><li>}</li><li><span class="hljs-type">int</span> *userData = <span class="hljs-literal">nullptr</span>;<span class="hljs-comment">// 用户自定义数据。</span></li><li><span class="hljs-built_in">OH_AVScreenCapture_SetErrorCallback</span>(capture, OnError, userData);</li><li><span class="hljs-built_in">OH_AVScreenCapture_SetStateCallback</span>(capture, OnStateChange, userData);</li><li><span class="hljs-built_in">OH_AVScreenCapture_SetDataCallback</span>(capture, OnBufferAvailable, userData);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="启动录屏">启动录屏<i class="anchor-icon anchor-icon-link" anchorid="启动录屏" tips="复制节点链接"></i></h3>          <p>启动录屏<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_startscreencapture" target="_blank">OH_AVScreenCapture_StartScreenCapture</a>后，开始采集原始码流，通过回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_avscreencapture_onbufferavailable" target="_blank">OH_AVScreenCapture_OnBufferAvailable</a>来监听当前是否有码流的产生，通过回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_avscreencapture_onstatechange" target="_blank">OH_AVScreenCapture_OnStateChange</a>来监听启动状态的变更。</p>     <p>在回调接口中，可以调用获取音频码流<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_acquireaudiobuffer" target="_blank">OH_AVScreenCapture_AcquireAudioBuffer</a>和获取视频码流<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_acquirevideobuffer" target="_blank">OH_AVScreenCapture_AcquireVideoBuffer</a>的接口来获取录屏的原始码流。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVScreenCapture_StartScreenCapture</span>(capture);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="处理录屏数据">处理录屏数据<i class="anchor-icon anchor-icon-link" anchorid="处理录屏数据" tips="复制节点链接"></i></h3>          <p>根据音视频采集的参数不同，会生成不同数据流，包含视频流、内录的音频流、麦克风录制的音频流，开发者可根据场景进行不同的处理，如将码流流转到其他模块，实现共享桌面、视频直播等。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">bool</span> IsCaptureStreamRunning = <span class="hljs-literal">true</span>;</li><li><span class="hljs-comment">// 获取并处理音视频原始码流数据回调函数OnBufferAvailable()。</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnBufferAvailable</span><span class="hljs-params">(OH_AVScreenCapture *capture, OH_AVBuffer *buffer, OH_AVScreenCaptureBufferType bufferType, <span class="hljs-type">int64_t</span> timestamp, <span class="hljs-type">void</span> *userData)</span> </span>{</li><li>    <span class="hljs-comment">// 处于录屏取码流状态。</span></li><li>    <span class="hljs-keyword">if</span> (IsCaptureStreamRunning) {</li><li>        <span class="hljs-keyword">if</span> (bufferType == OH_SCREEN_CAPTURE_BUFFERTYPE_VIDEO) {</li><li>            <span class="hljs-comment">// 视频buffer。</span></li><li>            OH_NativeBuffer *nativeBuffer = <span class="hljs-built_in">OH_AVBuffer_GetNativeBuffer</span>(buffer);</li><li>            <span class="hljs-keyword">if</span> (nativeBuffer != <span class="hljs-literal">nullptr</span> &amp;&amp; capture != <span class="hljs-literal">nullptr</span>) {</li><li>                <span class="hljs-comment">// 获取buffer容量。</span></li><li>                <span class="hljs-type">int</span> bufferLen = <span class="hljs-built_in">OH_AVBuffer_GetCapacity</span>(buffer);</li><li>
</li><li>                <span class="hljs-comment">// 获取buffer属性。</span></li><li>                OH_AVCodecBufferAttr info;</li><li>                <span class="hljs-built_in">OH_AVBuffer_GetBufferAttr</span>(buffer, &amp;info);</li><li>
</li><li>                <span class="hljs-comment">// 获取nativeBuffer配置。</span></li><li>                OH_NativeBuffer_Config config;</li><li>                <span class="hljs-built_in">OH_NativeBuffer_GetConfig</span>(nativeBuffer, &amp;config);</li><li>
</li><li>                <span class="hljs-comment">// 获取buffer地址。</span></li><li>                <span class="hljs-type">uint8_t</span> *buf = <span class="hljs-built_in">OH_AVBuffer_GetAddr</span>(buffer);</li><li>                <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">nullptr</span>) {</li><li>                    <span class="hljs-keyword">return</span>;</li><li>                }</li><li>                <span class="hljs-comment">// 使用buffer数据。</span></li><li>
</li><li>                <span class="hljs-comment">// nativeBuffer的引用计数值减一，当引用计数值减为0，释放该资源。</span></li><li>                <span class="hljs-built_in">OH_NativeBuffer_Unreference</span>(nativeBuffer);</li><li>            }</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bufferType == OH_SCREEN_CAPTURE_BUFFERTYPE_AUDIO_INNER) {</li><li>            <span class="hljs-comment">// 内录buffer。</span></li><li>            <span class="hljs-comment">// 获取buffer属性。</span></li><li>            OH_AVCodecBufferAttr info;</li><li>            <span class="hljs-built_in">OH_AVBuffer_GetBufferAttr</span>(buffer, &amp;info);</li><li>
</li><li>            <span class="hljs-comment">// 获取buffer容量。</span></li><li>            <span class="hljs-type">int</span> bufferLen = <span class="hljs-built_in">OH_AVBuffer_GetCapacity</span>(buffer);</li><li>
</li><li>            <span class="hljs-comment">// 获取buffer地址。</span></li><li>            <span class="hljs-type">uint8_t</span> *buf = <span class="hljs-built_in">OH_AVBuffer_GetAddr</span>(buffer);</li><li>            <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">nullptr</span>) {</li><li>                <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 使用buffer数据。</span></li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (bufferType == OH_SCREEN_CAPTURE_BUFFERTYPE_AUDIO_MIC) {</li><li>            <span class="hljs-comment">// 麦克风buffer。</span></li><li>            <span class="hljs-comment">// 获取buffer容量。</span></li><li>            <span class="hljs-type">int</span> bufferLen = <span class="hljs-built_in">OH_AVBuffer_GetCapacity</span>(buffer);</li><li>
</li><li>            <span class="hljs-comment">// 获取buffer地址。</span></li><li>            <span class="hljs-type">uint8_t</span> *buf = <span class="hljs-built_in">OH_AVBuffer_GetAddr</span>(buffer);</li><li>            <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">nullptr</span>) {</li><li>                <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-comment">// 使用buffer数据。</span></li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="停止录屏">停止录屏<i class="anchor-icon anchor-icon-link" anchorid="停止录屏" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_stopscreencapture" target="_blank">OH_AVScreenCapture_StopScreenCapture</a>后应用会停止录屏或屏幕共享，释放麦克风。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 停止录屏。</span></li><li><span class="hljs-built_in">OH_AVScreenCapture_StopScreenCapture</span>(capture);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="释放资源">释放资源<i class="anchor-icon anchor-icon-link" anchorid="释放资源" tips="复制节点链接"></i></h3>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h#oh_avscreencapture_release" target="_blank">OH_AVScreenCapture_Release</a>释放创建的OH_AVScreenCapture实例，需要在停止录屏后释放。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放录屏资源。</span></li><li><span class="hljs-built_in">OH_AVScreenCapture_Release</span>(capture);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="pc2in1弹窗模式配置说明">PC/2in1弹窗模式配置说明<i class="anchor-icon anchor-icon-link" anchorid="pc2in1弹窗模式配置说明" tips="复制节点链接"></i></h2>          <p>系统提供的录屏模式：<a href="/consumer/cn/doc/harmonyos-guides/avscreencapture-c-basic-process#录制指定屏幕">录制指定屏幕</a>、<a href="/consumer/cn/doc/harmonyos-guides/avscreencapture-c-basic-process#录制主屏幕">录制主屏幕</a>和<a href="/consumer/cn/doc/harmonyos-guides/avscreencapture-c-basic-process#录制指定窗口推荐">录制指定窗口</a>。</p>     <p>录屏模式会使用到屏幕ID（displayId）和窗口ID（missionIds）。获取方式可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-display-manager-h#oh_nativedisplaymanager_createalldisplays" target="_blank">获取displayid</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowproperties9" target="_blank">获取missionIds</a>。</p>    </div>    <div class="tiledSection">     <h3 id="录制指定屏幕" class="firsth2">录制指定屏幕<i class="anchor-icon anchor-icon-link" anchorid="录制指定屏幕" tips="复制节点链接"></i></h3>          <p>即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_capturemode" target="_blank">OH_CAPTURE_SPECIFIED_SCREEN</a>模式。</p>     <p>在此模式下，启动录屏后，PC/2in1设备会弹出选择共享内容弹窗，并默认选中videoCapInfo.displayId参数对应的屏幕，如果传入的displayId对应的窗口不存在，则不做任何选中。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-lua" data-highlighted="yes"><ol class="linenums"><li>// 根据PC/<span class="hljs-number">2</span>in1设备分辨率在<span class="hljs-built_in">config</span>中配置录屏的宽度、高度。</li><li><span class="hljs-built_in">config</span>.videoInfo.videoCapInfo.videoFrameWidth = <span class="hljs-number">2880</span>;</li><li><span class="hljs-built_in">config</span>.videoInfo.videoCapInfo.videoFrameHeight = <span class="hljs-number">1920</span>;</li><li>
</li><li>// 设置录屏模式为OH_CAPTURE_SPECIFIED_SCREEN，传入屏幕Id。</li><li><span class="hljs-built_in">config</span>.captureMode = OH_CAPTURE_SPECIFIED_SCREEN;</li><li><span class="hljs-built_in">config</span>.videoInfo.videoCapInfo.displayId = <span class="hljs-number">0</span>;</li></ol></pre></div></div>     <p>如下图所示：</p>     <p><span><img originheight="1608" originwidth="2472" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114451.96859898848141595672617620440818:50001231000000:2800:3B716E1650E6AACB7674BA0FD5E62204E216A0F23095CE3964A9961C08388796.png" width="920" height="598.4466019417476"></span></p>    </div>    <div class="tiledSection">     <h3 id="录制主屏幕">录制主屏幕<i class="anchor-icon anchor-icon-link" anchorid="录制主屏幕" tips="复制节点链接"></i></h3>          <p>即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_capturemode" target="_blank">OH_CAPTURE_HOME_SCREEN</a>模式。</p>     <p>在此模式下，启动录屏后，PC/2in1设备不会弹出选择录屏内容弹窗，会弹出隐私保护弹窗，同时配置的videoCapInfo.displayId参数不会生效，默认生效主屏的displayId。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-lua" data-highlighted="yes"><ol class="linenums"><li>// 根据PC/<span class="hljs-number">2</span>in1设备分辨率在<span class="hljs-built_in">config</span>中配置录屏的宽度、高度。</li><li><span class="hljs-built_in">config</span>.videoInfo.videoCapInfo.videoFrameWidth = <span class="hljs-number">2880</span>;</li><li><span class="hljs-built_in">config</span>.videoInfo.videoCapInfo.videoFrameHeight = <span class="hljs-number">1920</span>;</li><li>
</li><li>// 设置录屏模式为OH_CAPTURE_HOME_SCREEN，传入屏幕Id。</li><li><span class="hljs-built_in">config</span>.captureMode = OH_CAPTURE_HOME_SCREEN;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="录制指定窗口推荐">录制指定窗口（推荐）<i class="anchor-icon anchor-icon-link" anchorid="录制指定窗口推荐" tips="复制节点链接"></i></h3>          <p>即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-base-h#oh_capturemode" target="_blank">OH_CAPTURE_SPECIFIED_WINDOW</a>模式。</p>     <p>应用需根据PC/2in1设备分辨率配置录屏的高度和宽度值并传入屏幕Id。</p>     <p>若期望录制某个指定窗口，需要设置指定的窗口Id。该场景下，启动录屏后，会弹出选择共享内容弹窗，并默认选中指定的窗口。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 根据PC/2in1设备分辨率在config中配置录屏的宽度、高度。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">videoFrameWidth</span> = <span class="hljs-number">2880</span>;</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">videoFrameHeight</span> = <span class="hljs-number">1920</span>;</li><li>
</li><li><span class="hljs-comment">// 设置录屏模式为OH_CAPTURE_SPECIFIED_WINDOW，传入屏幕Id。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">captureMode</span> = <span class="hljs-variable">OH_CAPTURE_SPECIFIED_WINDOW</span>;</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">displayId</span> = <span class="hljs-number">0</span>;</li><li>
</li><li><span class="hljs-comment">// (可选)若有期望录制的窗口，可传入单个窗口Id。</span></li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">int32_t</span>&gt; <span class="hljs-title class_">missionIds</span> = {<span class="hljs-number">61</span>}; <span class="hljs-comment">// 表示弹出的Picker默认选中61号窗口。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">missionIDs</span> = &amp;<span class="hljs-title class_">missionIds</span>[<span class="hljs-number">0</span>];</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">missionIDsLen</span> = <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">int32_t</span>&gt;(<span class="hljs-variable">missionIds</span>.<span class="hljs-title function_">size</span>());</li></ol></pre></div></div>     <p><span><img originheight="1608" originwidth="2472" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114451.00117715704752186862249960815844:50001231000000:2800:948A18208A40BE6587168C7EFDC0AE8660E208DD1AD86DE7AC35A4EAE08D5C54.png" width="920" height="598.4466019417476"></span></p>     <p>若期望同时录制多个窗口，需要传入期望录制的窗口Id列表。该场景下，不弹出选择共享内容弹窗，弹出隐私保护弹窗。</p>     <div _ngcontent-whb-c106="" class="highlight-div"><div _ngcontent-whb-c106="" class="highlight-div-header"><div _ngcontent-whb-c106="" class="highlight-div-header-left"><div _ngcontent-whb-c106="" class="handle-button expand-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-whb-c106="" class="highlight-div-header-right"><div _ngcontent-whb-c106="" class="handle-button ai-button"></div><div _ngcontent-whb-c106="" class="handle-button line-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-whb-c106="" class="handle-button theme-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-whb-c106="" class="handle-button copy-button"><div _ngcontent-whb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-whb-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 根据PC/2in1设备分辨率在config中配置录屏的宽度、高度。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">videoFrameWidth</span> = <span class="hljs-number">2880</span>;</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">videoFrameHeight</span> = <span class="hljs-number">1920</span>;</li><li>
</li><li><span class="hljs-comment">// 设置录屏模式为OH_CAPTURE_SPECIFIED_WINDOW，传入屏幕Id。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">captureMode</span> = <span class="hljs-variable">OH_CAPTURE_SPECIFIED_WINDOW</span>;</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">displayId</span> = <span class="hljs-number">0</span>;</li><li>
</li><li><span class="hljs-comment">// 传入多个窗口Id。</span></li><li><span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">int32_t</span>&gt; <span class="hljs-variable">missionIds</span> = {<span class="hljs-number">60</span>, <span class="hljs-number">61</span>}; <span class="hljs-comment">// 表示期望同时录制60、61号窗口。</span></li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">missionIDs</span> = &amp;<span class="hljs-title class_">missionIds</span>[<span class="hljs-number">0</span>];</li><li><span class="hljs-variable">config</span>.<span class="hljs-variable">videoInfo</span>.<span class="hljs-variable">videoCapInfo</span>.<span class="hljs-variable">missionIDsLen</span> = <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">int32_t</span>&gt;(<span class="hljs-variable">missionIds</span>.<span class="hljs-title function_">size</span>());</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="更多资源">更多资源<i class="anchor-icon anchor-icon-link" anchorid="更多资源" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>API参考：详细的API描述请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avscreen-capture-h" target="_blank">native_avscreen_capture.h</a>。</p></li>      <li>       <p>示例工程：该示例调用了媒体AVScreenCapture组件提供的接口能力，提供屏幕捕获的功能，详情见<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/Media/ScreenCapture/ScreenCaptureSample" target="_blank">录屏示例工程</a>。</p></li>     </ul>    </div>   </div>   <div></div></div>