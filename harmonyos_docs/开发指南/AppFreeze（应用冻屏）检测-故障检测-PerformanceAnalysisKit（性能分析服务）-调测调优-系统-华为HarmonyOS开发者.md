<h1 _ngcontent-wgk-c119="" class="doc-title ng-star-inserted" title="AppFreeze（应用冻屏）检测"> AppFreeze（应用冻屏）检测 </h1>

<div _ngcontent-wgk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2>          <p>用户在使用应用时，如果出现点击无反应或应用无响应等情况，并且持续时间超过一定限制，就会被定义为应用冻屏（AppFreeze），即应用无响应。系统会检测应用无响应，并生成AppFreeze日志，供应用开发者分析。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>本文仅适用于Stage模型下的应用。在根据本文分析日志前，开发者需要具备JS在系统中运行情况、C++程序堆栈信息的相关基础知识，并对应用相关的子系统有一定了解。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="检测原理">检测原理<i class="anchor-icon anchor-icon-link" anchorid="检测原理" tips="复制节点链接"></i></h2>          <p>目前应用冻屏检测从以下三个维度检测，了解其原理有助于应用开发者定位和分析AppFreeze故障。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>AppFreeze检测仅对<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/performance-analysis-kit-terminology#release版本应用">release版本应用</a>生效，对<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/performance-analysis-kit-terminology#debug版本应用">debug版本应用</a>不生效。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.1" valign="top" width="50%">故障类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">THREAD_BLOCK_6S</td>         <td class="cellrowborder" valign="top" width="50%">应用主线程卡死超时</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">APP_INPUT_BLOCK</td>         <td class="cellrowborder" valign="top" width="50%">用户输入响应超时</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">LIFECYCLE_TIMEOUT</td>         <td class="cellrowborder" valign="top" width="50%">Ability生命周期切换超时</td>        </tr>             </tbody></table></div>     </div>     <p>当应用发生上述故障时，为了保证可恢复，会杀死应用。并上报应用冻屏事件，可通过HiAppEvent订阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events">应用冻屏事件</a>。</p>    </div>    <div class="tiledSection">     <h3 id="thread_block_6s-应用主线程卡死超时" class="firsth2">THREAD_BLOCK_6S 应用主线程卡死超时<i class="anchor-icon anchor-icon-link" anchorid="thread_block_6s-应用主线程卡死超时" tips="复制节点链接"></i></h3>          <p><strong>概述</strong>：发生该故障，表示当前应用主线程有卡死或者执行任务过多的情况，影响应用的流畅度和体验。</p>     <p><strong>检测原理</strong>：应用的watchdog线程定期向主线程插入判活检测任务。如果判活检测超过3s未被执行，将上报THREAD_BLOCK_3S告警事件；如果超过6s仍未被执行，将上报THREAD_BLOCK_6S主线程卡死事件。两个事件匹配生成THREAD_BLOCK的应用无响应日志。</p>     <p>检测原理如下图：</p>     <p><strong>图1</strong></p>     <p><span><img originheight="625" originwidth="829" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115051.13365123273066992563922505258169:50001231000000:2800:9D401B518A76374825C85591618B85B13262A0559BEB95E7DA9F34F357660051.png" width="829" height="625"></span></p>    </div>    <div class="tiledSection">     <h3 id="app_input_block-用户输入响应超时">APP_INPUT_BLOCK 用户输入响应超时<i class="anchor-icon anchor-icon-link" anchorid="app_input_block-用户输入响应超时" tips="复制节点链接"></i></h3>          <p><strong>概述</strong>：该故障是指点击事件超过5s未得到响应。</p>     <p><strong>检测原理</strong>：用户点击应用时，输入系统会向应用侧发送点击事件；应用侧的响应反馈回执超时，则上报该故障。</p>     <p>检测原理如下图：</p>     <p><strong>图2</strong></p>     <p><span><img originheight="614" originwidth="1140" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115051.99406719758184190938849560310764:50001231000000:2800:635E0D9501DAB25A9242FF931CD6EA56CC620CB0033BC4FBA8CE0B4D14EE4770.png" width="920" height="495.50877192982455"></span></p>    </div>    <div class="tiledSection">     <h3 id="生命周期切换超时">生命周期切换超时<i class="anchor-icon anchor-icon-link" anchorid="生命周期切换超时" tips="复制节点链接"></i></h3>          <p><strong>概述</strong>：生命周期切换超时分为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-lifecycle">UIAbility生命周期</a>切换超时和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/pageability-lifecycle">PageAbility生命周期</a>切换超时。</p>     <p>该故障发生在生命周期切换过程中，影响应用内Ability的切换或者不同PageAbility之间的切换。</p>     <p><strong>检测原理</strong>：foundation的AMS服务向应用进程发送生命周期切换指令，随后等待应用返回结果，固定时间内未成功移除任务将上报故障。</p>     <p>生命周期切换超时由LIFECYCLE_HALF_TIMEOUT和LIFECYCLE_TIMEOUT两个事件组合而成。LIFECYCLE_HALF_TIMEOUT作为LIFECYCLE_TIMEOUT的告警事件，抓取binder等信息。</p>     <p><strong>图3</strong></p>     <p><span><img originheight="619" originwidth="963" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115051.14479784741698550090254485714776:50001231000000:2800:80AFB070F502792716CC56EE99CCB5AE663B3263977A70306278BCAC4AF302A4.png" width="920" height="591.3603322949117"></span></p>     <p>不同的生命周期超时，对应的超时时间各不相同。具体如下表所示：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.1" valign="top" width="50%">生命周期</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.9.1.3.1.2" valign="top" width="50%">超时时间</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">Load</td>         <td class="cellrowborder" valign="top" width="50%">10s</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Foreground</td>         <td class="cellrowborder" valign="top" width="50%">5s</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="日志获取">日志获取<i class="anchor-icon anchor-icon-link" anchorid="日志获取" tips="复制节点链接"></i></h2>          <p>应用冻屏日志和进程崩溃日志一致，都是由Faultlogger模块进行管理，可通过以下方式获取：</p>     <p><strong>方式一：通过DevEco Studio获取日志</strong></p>     <p>DevEco Studio会收集设备/data/log/faultlog/faultlogger/路径下的进程崩溃故障日志到FaultLog下，根据进程名和故障时间分类显示。获取日志的方法参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-fault-log" target="_blank">DevEco Studio使用指南-FaultLog</a>。</p>     <p><strong>方式二：通过HiAppEvent接口订阅</strong></p>     <p>HiAppEvent给开发者提供了故障订阅接口，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-intro">HiAppEvent介绍</a>。参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events-arkts">订阅应用冻屏事件（ArkTS）</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events-ndk">订阅应用冻屏事件（C/C++）</a>完成应用冻屏事件订阅，并通过事件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events#事件字段说明">external_log</a>字段读取故障日志文件内容。</p>     <p><strong>方式三：通过hdc获取日志，需打开开发者选项</strong></p>     <p>在开发者选项打开的情况下，开发者可以通过hdc file recv /data/log/faultlog/faultlogger D:\命令导出故障日志到本地，故障日志文件名格式为appfreeze-进程名-进程UID-毫秒级时间.log。</p>    </div>    <div class="tiledSection">     <h2 id="日志规格">日志规格<i class="anchor-icon anchor-icon-link" anchorid="日志规格" tips="复制节点链接"></i></h2>          <p>应用冻屏（AppFreeze）问题需要结合应用冻屏日志和hilog流水日志进行分析。</p>     <p>当前提供一个故障分析示例，请开发者根据具体问题具体分析。</p>     <p>应用冻屏日志主要分以下几个模块信息：</p>    </div>    <div class="tiledSection">     <h3 id="日志头部信息" class="firsth2">日志头部信息<i class="anchor-icon anchor-icon-link" anchorid="日志头部信息" tips="复制节点链接"></i></h3>          <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Generated</span> <span class="hljs-variable">by</span> <span class="hljs-variable">HiviewDFX</span>@<span class="hljs-title function_">HarmonyOS</span></li><li>================================================================</li><li><span class="hljs-variable">Device</span> <span class="hljs-variable">info</span>:<span class="hljs-title class_">HUAWEI</span> <span class="hljs-title class_">Mate</span> <span class="hljs-number">60</span> <span class="hljs-title class_">Pro</span></li><li><span class="hljs-variable">Build</span> <span class="hljs-variable">info</span>:<span class="hljs-title class_">ALN</span>-<span class="hljs-title class_">AL00</span> <span class="hljs-number">6.0</span><span class="hljs-number">.0.328</span>(<span class="hljs-title class_">C00E1R4P3DEVDUlog</span>)</li><li><span class="hljs-variable">Fingerprint</span>:<span class="hljs-title class_">e18a33c12e1361173ec9ac1c93f2bd0c2daa88f03c7f76b228cca14bdc6a21b1</span></li><li><span class="hljs-variable">Module</span> <span class="hljs-variable">name</span>:<span class="hljs-title class_">com</span>.<span class="hljs-title class_">samples</span>.<span class="hljs-title class_">freezedebug</span></li><li><span class="hljs-variable">Version</span>:<span class="hljs-number">1.0</span><span class="hljs-number">.0</span></li><li><span class="hljs-variable">VersionCode</span>:<span class="hljs-number">1000000</span></li><li><span class="hljs-variable">PreInstalled</span>:<span class="hljs-title class_">No</span></li><li><span class="hljs-variable">Foreground</span>:<span class="hljs-title class_">Yes</span></li><li><span class="hljs-variable">Pid</span>:<span class="hljs-number">13680</span></li><li><span class="hljs-variable">Uid</span>:<span class="hljs-number">20020177</span></li><li><span class="hljs-variable">Reason</span>:<span class="hljs-title class_">THREAD_BLOCK_6S</span></li><li><span class="hljs-variable">appfreeze</span>: <span class="hljs-title class_">com</span>.<span class="hljs-title class_">samples</span>.<span class="hljs-title class_">freezedebug</span> <span class="hljs-title class_">THREAD_BLOCK_6S</span> <span class="hljs-title class_">at</span> <span class="hljs-number">20250628140837</span></li><li><span class="hljs-variable">DisplayPowerInfo</span>:<span class="hljs-title class_">powerState</span>:<span class="hljs-title class_">UNKNOWN</span></li><li><span class="hljs-variable">HitraceIdInfo</span>: <span class="hljs-title class_">hitrace_id</span>: <span class="hljs-title class_">a92ab27238f409a</span>, <span class="hljs-variable">span_id</span>: <span class="hljs-number">1</span><span class="hljs-title class_">cd61c9</span>, <span class="hljs-variable">parent_span_id</span>: <span class="hljs-number">3072</span><span class="hljs-title class_">e</span>, <span class="hljs-variable">trace_flag</span>: <span class="hljs-number">0</span></li><li><span class="hljs-variable">Page</span> <span class="hljs-variable">switch</span> <span class="hljs-variable">history</span>:</li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">30</span>:<span class="hljs-number">327</span> /<span class="hljs-variable">ets</span>/<span class="hljs-variable">pages</span>/<span class="hljs-variable">Index</span>:<span class="hljs-title class_">Appfreeze</span></li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">28</span>:<span class="hljs-number">986</span> /<span class="hljs-variable">ets</span>/<span class="hljs-variable">pages</span>/<span class="hljs-variable">Index</span></li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">26</span>:<span class="hljs-number">502</span> :<span class="hljs-title class_">enters</span> <span class="hljs-title class_">foreground</span></li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">07</span>:<span class="hljs-number">606</span> :<span class="hljs-title class_">leaves</span> <span class="hljs-title class_">foreground</span></li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">06</span>:<span class="hljs-number">246</span> /<span class="hljs-variable">ets</span>/<span class="hljs-variable">pages</span>/<span class="hljs-variable">Index</span>:<span class="hljs-title class_">Appfreeze</span></li><li>  <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">01</span>:<span class="hljs-number">955</span> :<span class="hljs-title class_">enters</span> <span class="hljs-title class_">foreground</span></li><li>&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;</li><li><span class="hljs-variable">DOMAIN</span>:<span class="hljs-title class_">AAFWK</span></li><li><span class="hljs-variable">STRINGID</span>:<span class="hljs-title class_">THREAD_BLOCK_6S</span></li><li><span class="hljs-variable">TIMESTAMP</span>:<span class="hljs-number">2025</span>/<span class="hljs-number">06</span>/<span class="hljs-number">28</span>-<span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">37</span>:<span class="hljs-number">360</span></li><li><span class="hljs-variable">PID</span>:<span class="hljs-number">13680</span></li><li><span class="hljs-variable">UID</span>:<span class="hljs-number">20020177</span></li><li><span class="hljs-variable">PACKAGE_NAME</span>:<span class="hljs-title class_">com</span>.<span class="hljs-title class_">samples</span>.<span class="hljs-title class_">freezedebug</span></li><li><span class="hljs-variable">PROCESS_NAME</span>:<span class="hljs-title class_">com</span>.<span class="hljs-title class_">samples</span>.<span class="hljs-title class_">freezedebug</span></li><li><span class="hljs-variable">NOTE</span>: <span class="hljs-title class_">Current</span> <span class="hljs-title class_">fault</span> <span class="hljs-title class_">may</span> <span class="hljs-title class_">be</span> <span class="hljs-title class_">caused</span> <span class="hljs-title class_">by</span> <span class="hljs-title class_">the</span> <span class="hljs-title class_">system</span><span class="hljs-string">'s low memory or thermal throttling, you may ignore it and analysis other faults.</span></li><li><span class="hljs-string">***</span></li></ol></pre></div></div>     <p>从API version 20开始，当整机资源告警（如整机低内存或热限频）时，会输出NOTE行。出现此行时，开发者可以忽略应用冻屏故障。在之前的API版本中，无论整机资源状态如何，均无此行输出。</p>     <p>从API version 20开始，发生THREAD_BLOCK_6S故障时，日志中新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hitracechain#hitraceid" target="_blank">HiTraceId</a>信息打印。HitraceId是HiTraceChain提供的唯一跟踪标识，用于跟踪业务流程调用链。可以协助开发者查看故障时间段内，故障流程的hilog日志，分析日志查看应用的执行状态。</p>     <p>三种AppFreeze事件都包含以下几部分信息，具体解释如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.1" valign="top" width="50%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">Reason</td>         <td class="cellrowborder" valign="top" width="50%">应用无响应原因，与应用无响应检测能力点对应。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PID</td>         <td class="cellrowborder" valign="top" width="50%">发生故障时的pid。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PACKAGE_NAME</td>         <td class="cellrowborder" valign="top" width="50%">应用进程包名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cppcrash-guidelines#有页面切换轨迹的故障场景日志规格">Page switch history</a></td>         <td class="cellrowborder" valign="top" width="50%">从API 20开始，维测进程会记录应用切换历史。应用发生故障后，生成的故障文件将包含页面切换历史轨迹。如果维测服务进程出现故障或未缓存切换轨迹，则不包含此字段。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="日志主干通用信息">日志主干通用信息<i class="anchor-icon anchor-icon-link" anchorid="日志主干通用信息" tips="复制节点链接"></i></h3>          <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">start</span> <span class="hljs-variable">time</span>: <span class="hljs-number">2025</span>/<span class="hljs-number">06</span>/<span class="hljs-number">28</span>-<span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34</span>:<span class="hljs-number">318</span></li><li><span class="hljs-variable">DOMAIN</span> = <span class="hljs-variable">AAFWK</span></li><li><span class="hljs-variable">EVENTNAME</span> = <span class="hljs-variable">THREAD_BLOCK_3S</span></li><li><span class="hljs-variable">TIMESTAMP</span> = <span class="hljs-number">2025</span>/<span class="hljs-number">06</span>/<span class="hljs-number">28</span>-<span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34</span>:<span class="hljs-number">310</span></li><li><span class="hljs-variable">PID</span> = <span class="hljs-number">13680</span></li><li><span class="hljs-variable">UID</span> = <span class="hljs-number">20020177</span></li><li><span class="hljs-variable">TID</span> = <span class="hljs-number">13680</span></li><li><span class="hljs-variable">PACKAGE_NAME</span> = <span class="hljs-variable">com</span>.<span class="hljs-variable">samples</span>.<span class="hljs-variable">freezedebug</span></li><li><span class="hljs-variable">PROCESS_NAME</span> = <span class="hljs-variable">com</span>.<span class="hljs-variable">samples</span>.<span class="hljs-variable">freezedebug</span></li><li><span class="hljs-variable">eventLog_action</span> = <span class="hljs-variable">ffrt</span>,<span class="hljs-variable">t</span>,<span class="hljs-variable">GpuStack</span>,<span class="hljs-variable">cmd</span>:<span class="hljs-title class_">m</span>,<span class="hljs-variable">hot</span></li><li><span class="hljs-variable">eventLog_interval</span> = <span class="hljs-number">10</span></li><li><span class="hljs-variable">MSG</span> =</li><li><span class="hljs-variable">Fault</span> <span class="hljs-variable">time</span>:<span class="hljs-number">2025</span>/<span class="hljs-number">06</span>/<span class="hljs-number">28</span>-<span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34</span></li><li><span class="hljs-variable">App</span> <span class="hljs-keyword">main</span> <span class="hljs-variable">thread</span> <span class="hljs-keyword">is</span> <span class="hljs-variable">not</span> <span class="hljs-variable">response</span>!</li><li><span class="hljs-variable">Main</span> <span class="hljs-variable">handler</span> <span class="hljs-variable">dump</span> <span class="hljs-variable">start</span> <span class="hljs-variable">time</span>: <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34.067</span></li><li><span class="hljs-variable">mainHandler</span> <span class="hljs-variable">dump</span> <span class="hljs-keyword">is</span>:</li><li> <span class="hljs-variable">EventHandler</span> <span class="hljs-variable">dump</span> <span class="hljs-variable">begin</span> <span class="hljs-variable">curTime</span>: <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34.067</span></li><li> <span class="hljs-variable">Event</span> <span class="hljs-variable">runner</span> (<span class="hljs-variable">Thread</span> <span class="hljs-variable">name</span> = , <span class="hljs-variable">Thread</span> <span class="hljs-variable">ID</span> = <span class="hljs-number">13680</span>) <span class="hljs-keyword">is</span> <span class="hljs-variable">running</span></li><li> <span class="hljs-variable">Current</span> <span class="hljs-variable">Running</span>: <span class="hljs-title class_">start</span> <span class="hljs-title class_">at</span> <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">27.354</span>, <span class="hljs-variable">Event</span> { <span class="hljs-variable">send</span> <span class="hljs-variable">thread</span> = <span class="hljs-number">13680</span>, <span class="hljs-variable">send</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.353</span>, <span class="hljs-variable">handle</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">27.353</span>, <span class="hljs-variable">trigger</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">27.354</span>, <span class="hljs-variable">task</span> <span class="hljs-variable">name</span> = <span class="hljs-variable">uv_timer_task</span>, <span class="hljs-variable">caller</span> = [<span class="hljs-variable">ohos_loop_handler</span>.<span class="hljs-title function_">cpp</span>(<span class="hljs-variable">OnTriggered</span>:<span class="hljs-number">72</span>)] }</li><li> <span class="hljs-variable">History</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">No</span>. <span class="hljs-number">0</span> : <span class="hljs-title class_">Event</span> { <span class="hljs-variable">send</span> <span class="hljs-variable">thread</span> = <span class="hljs-number">13856</span>, <span class="hljs-variable">send</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.336</span>, <span class="hljs-variable">handle</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.336</span>, <span class="hljs-variable">trigger</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.336</span>, <span class="hljs-variable">completeTime</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.337</span>, <span class="hljs-variable">priority</span> = <span class="hljs-variable">VIP</span>, <span class="hljs-variable">task</span> <span class="hljs-variable">name</span> = <span class="hljs-variable">MMITask</span>, <span class="hljs-variable">caller</span> = [<span class="hljs-variable">deamon_io_waiter</span>.<span class="hljs-title function_">cpp</span>(<span class="hljs-variable">HandleFileDescriptorEvent</span>:<span class="hljs-number">225</span>)] }</li><li>...</li><li> <span class="hljs-variable">No</span>. <span class="hljs-number">31</span> : <span class="hljs-title class_">Event</span> { <span class="hljs-variable">send</span> <span class="hljs-variable">thread</span> = <span class="hljs-number">13856</span>, <span class="hljs-variable">send</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.330</span>, <span class="hljs-variable">handle</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.380</span>, <span class="hljs-variable">trigger</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.330</span>, <span class="hljs-variable">completeTime</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">22.331</span>, <span class="hljs-variable">priority</span> = <span class="hljs-variable">VIP</span>, <span class="hljs-variable">task</span> <span class="hljs-variable">name</span> = <span class="hljs-variable">vSyncTask</span>, <span class="hljs-variable">caller</span> = [<span class="hljs-variable">deamon_io_waiter</span>.<span class="hljs-title function_">cpp</span>(<span class="hljs-variable">PostTaskForVsync</span>:<span class="hljs-number">159</span>)] }</li><li> <span class="hljs-variable">VIP</span> <span class="hljs-variable">priority</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">No</span><span class="hljs-number">.1</span> : <span class="hljs-title class_">Event</span> { <span class="hljs-variable">send</span> <span class="hljs-variable">thread</span> = <span class="hljs-number">13843</span>, <span class="hljs-variable">send</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">31.066</span>, <span class="hljs-variable">handle</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">31.066</span>, <span class="hljs-variable">id</span> = <span class="hljs-number">1</span>, <span class="hljs-variable">caller</span> = [<span class="hljs-variable">watchdog</span>.<span class="hljs-title function_">cpp</span>(<span class="hljs-variable">Timer</span>:<span class="hljs-number">233</span>)] }</li><li> <span class="hljs-variable">No</span><span class="hljs-number">.2</span> : <span class="hljs-title class_">Event</span> { <span class="hljs-variable">send</span> <span class="hljs-variable">thread</span> = <span class="hljs-number">13843</span>, <span class="hljs-variable">send</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34.067</span>, <span class="hljs-variable">handle</span> <span class="hljs-variable">time</span> = <span class="hljs-number">2025</span>-<span class="hljs-number">06</span>-<span class="hljs-number">28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">34.067</span>, <span class="hljs-variable">id</span> = <span class="hljs-number">1</span>, <span class="hljs-variable">caller</span> = [<span class="hljs-variable">watchdog</span>.<span class="hljs-title function_">cpp</span>(<span class="hljs-variable">Timer</span>:<span class="hljs-number">233</span>)] }</li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">VIP</span> <span class="hljs-variable">events</span> : <span class="hljs-number">2</span></li><li> <span class="hljs-variable">Immediate</span> <span class="hljs-variable">priority</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">Immediate</span> <span class="hljs-variable">events</span> : <span class="hljs-number">0</span></li><li> <span class="hljs-variable">High</span> <span class="hljs-variable">priority</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">High</span> <span class="hljs-variable">events</span> : <span class="hljs-number">0</span></li><li> <span class="hljs-variable">Low</span> <span class="hljs-variable">priority</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">Low</span> <span class="hljs-variable">events</span> : <span class="hljs-number">0</span></li><li> <span class="hljs-variable">Idle</span> <span class="hljs-variable">priority</span> <span class="hljs-variable">event</span> <span class="hljs-variable">queue</span> <span class="hljs-variable">information</span>:</li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">size</span> <span class="hljs-variable">of</span> <span class="hljs-variable">Idle</span> <span class="hljs-variable">events</span> : <span class="hljs-number">0</span></li><li> <span class="hljs-variable">Total</span> <span class="hljs-variable">event</span> <span class="hljs-variable">size</span> : <span class="hljs-number">2</span></li></ol></pre></div></div>     <p>三种AppFreeze事件都包含以下几部分信息，具体解释如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.4.1.3.1.1" valign="top" width="50%">主要信息字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">EVENTNAME</td>         <td class="cellrowborder" valign="top" width="50%">组成卡死检测事件。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">TIMESTAMP</td>         <td class="cellrowborder" valign="top" width="50%">发生故障时上报事件的时刻，可以根据应用无响应检测能力点中说明的超时时间，在相应hilog流水日志中缩小查看日志的时间范围。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PID</td>         <td class="cellrowborder" valign="top" width="50%">发生故障时候的pid。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">UID</td>         <td class="cellrowborder" valign="top" width="50%">故障进程UID。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">TID</td>         <td class="cellrowborder" valign="top" width="50%">发生故障时候的tid。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PACKAGE_NAME</td>         <td class="cellrowborder" valign="top" width="50%">应用进程包名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PROCESS_NAME</td>         <td class="cellrowborder" valign="top" width="50%">应用进程名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MSG</td>         <td class="cellrowborder" valign="top" width="50%">发生故障时间及EventHandler信息。</td>        </tr>             </tbody></table></div>     </div>     <p>EventHandler信息，具体解释如下：</p>     <p>dump信息组成结构：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.3.1.1" valign="top" width="50%">主要信息字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">EventHandler dump begin curTime</td>         <td class="cellrowborder" valign="top" width="50%">获取dump信息时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Event runner</td>         <td class="cellrowborder" valign="top" width="50%">EventHandler对应的线程名和线程号。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Current Running</td>         <td class="cellrowborder" valign="top" width="50%">当前正在执行的完整任务信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">History event queue information</td>         <td class="cellrowborder" valign="top" width="50%">历史执行任务信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">VIP priority event queue information</td>         <td class="cellrowborder" valign="top" width="50%">VIP级任务队列信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Immediate priority event queue information</td>         <td class="cellrowborder" valign="top" width="50%">立即执行任务队列信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">High priority event queue information</td>         <td class="cellrowborder" valign="top" width="50%">高优先级任务队列信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Low priority event queue information</td>         <td class="cellrowborder" valign="top" width="50%">低优先级任务队列信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Idle priority event queue information</td>         <td class="cellrowborder" valign="top" width="50%">挂起任务队列信息。</td>        </tr>             </tbody></table></div>     </div>     <p>任务组成部分：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.1" valign="top" width="50%">主要信息字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.9.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">send thread</td>         <td class="cellrowborder" valign="top" width="50%">提交任务线程号。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">send time</td>         <td class="cellrowborder" valign="top" width="50%">提交任务时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">task name</td>         <td class="cellrowborder" valign="top" width="50%">任务队列中的任务名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">priority</td>         <td class="cellrowborder" valign="top" width="50%">任务优先级。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">caller</td>         <td class="cellrowborder" valign="top" width="50%">任务提交方法。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">handle time</td>         <td class="cellrowborder" valign="top" width="50%">任务预期执行时间。与实际的任务执行时间（trigger time）可能存在偏差</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">trigger time</td>         <td class="cellrowborder" valign="top" width="50%">任务执行时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">completeTime time</td>         <td class="cellrowborder" valign="top" width="50%">任务执行完成时间（如果没有打印则表示该任务未执行完成）。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>EventHandler信息中，开发者只需重点关注EventHandler dump begin curTime，trigger time和completeTime time时间即可。</p>       <p>EventHandler信息详细指导可参考：<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-app-freeze-way#section190014865618" target="_blank">查看eventHandler信息</a></p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="堆栈信息">堆栈信息<i class="anchor-icon anchor-icon-link" anchorid="堆栈信息" tips="复制节点链接"></i></h3>          <p>显示故障进程堆栈信息。</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li>Tid:13680, Name:les.freezedebug</li><li>#00 pc 000000000000186c [shmm](__kernel_gettimeofday+72)</li><li>#01 pc 00000000001d887c /system/lib/ld-musl-aarch64.so.1(gettimeofday+40)(f1a940981720250b920ee26d2d76af5b)</li><li>#02 pc 000000000058fb5c /system/lib64/platformsdk/libark_jsruntime.so(panda::ecmascript::builtins::BuiltinsDate::Now(panda::ecmascript::EcmaRuntimeCallInfo*)+48)(0f1928b77d36d27edb5512bd89806a6f)</li><li>#03 pc 0000000000cff5dc /system/lib64/module/arkcompiler/stub.an(RTStub_PushCallArgsAndDispatchNative+40)</li><li>#04 pc 000000000036aaf4 /system/lib64/module/arkcompiler/stub.an(BCStub_HandleCallthis0Imm8V8StwCopy+380)</li><li>#05 at wait15s (entry/<span class="hljs-attribute">src/main/ets/pages/Index.ets</span>:<span class="hljs-number">16</span>:<span class="hljs-number">10</span>)</li><li>#<span class="hljs-number">06</span> pc <span class="hljs-number">000000000026</span>b1dc /system/lib64/platformsdk/libark_jsruntime.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">panda</span>::<span class="hljs-attribute">ecmascript</span>::<span class="hljs-attribute">InterpreterAssembly</span>::<span class="hljs-built_in">Execute</span>(<span class="hljs-attribute">panda</span>::<span class="hljs-attribute">ecmascript</span>::EcmaRuntimeCallInfo*)+<span class="hljs-number">536</span>)(<span class="hljs-number">0</span>f1928b77d36d27edb5512bd89806a6f)</li><li>#<span class="hljs-number">07</span> pc <span class="hljs-number">000000000096</span>b188 /system/lib64/platformsdk/libark_jsruntime.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">panda</span>::<span class="hljs-attribute">FunctionRef</span>::<span class="hljs-built_in">CallForNapi</span>(<span class="hljs-attribute">panda</span>::<span class="hljs-attribute">ecmascript</span>::EcmaVM const*, <span class="hljs-attribute">panda</span>::JSValueRef*, <span class="hljs-attribute">panda</span>::JSValueRef* const*, int)+<span class="hljs-number">1432</span>)(<span class="hljs-number">0</span>f1928b77d36d27edb5512bd89806a6f)</li><li>#<span class="hljs-number">08</span> pc <span class="hljs-number">000000000006</span>b7a4 /system/lib64/platformsdk/libace_napi.z.<span class="hljs-built_in">so</span>(napi_call_function+<span class="hljs-number">212</span>)(eaa639519e67e8495ca596293a0d33cd)</li><li>#<span class="hljs-number">09</span> pc <span class="hljs-number">000000000000</span>b17c /system/lib64/platformsdk/libtimer.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">JsSysModule</span>::<span class="hljs-attribute">Timer</span>::<span class="hljs-built_in">TimerCallback</span>(uv_timer_s*) (.cfi)+<span class="hljs-number">528</span>)(<span class="hljs-number">764291289</span>e89523cdbe9c3c78c1cca35)</li><li>#<span class="hljs-number">10</span> pc <span class="hljs-number">0000000000013</span>ea8 /system/lib64/platformsdk/libuv.<span class="hljs-built_in">so</span>(uv__run_timers+<span class="hljs-number">68</span>)(<span class="hljs-number">9</span>e7eb59ca1a45f4230b641a7c940a20b)</li><li>#<span class="hljs-number">11</span> pc <span class="hljs-number">000000000001</span>a344 /system/lib64/platformsdk/libuv.<span class="hljs-built_in">so</span>(uv_run+<span class="hljs-number">376</span>)(<span class="hljs-number">9</span>e7eb59ca1a45f4230b641a7c940a20b)</li><li>#<span class="hljs-number">12</span> pc <span class="hljs-number">00000000000895</span>a8 /system/lib64/platformsdk/libruntime.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AbilityRuntime</span>::<span class="hljs-attribute">OHOSLoopHandler</span>::<span class="hljs-built_in">OnTriggered</span>()+<span class="hljs-number">140</span>)(daf29e377c47e3e26282e745dd1b3488)</li><li>#<span class="hljs-number">13</span> pc <span class="hljs-number">0000000000089</span>b4c /system/lib64/platformsdk/libruntime.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">std</span>::<span class="hljs-attribute">__h</span>::<span class="hljs-attribute">__function</span>::__func&lt;<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AbilityRuntime</span>::<span class="hljs-attribute">OHOSLoopHandler</span>::<span class="hljs-built_in">OnTriggered</span>()::$_0, <span class="hljs-attribute">std</span>::<span class="hljs-attribute">__h</span>::allocator&lt;<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AbilityRuntime</span>::<span class="hljs-attribute">OHOSLoopHandler</span>::<span class="hljs-built_in">OnTriggered</span>()::$_0&gt;, void ()&gt;::<span class="hljs-built_in">operator</span>()() (.<span class="hljs-number">9</span>efded9864dc55830f61b3b92d59beab)+<span class="hljs-number">52</span>)(daf29e377c47e3e26282e745dd1b3488)</li><li>#<span class="hljs-number">14</span> pc <span class="hljs-number">000000000001</span>ff6c /system/lib64/chipset-sdk-sp/libeventhandler.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::(anonymous namespace)::<span class="hljs-attribute">EventRunnerImpl</span>::<span class="hljs-built_in">ExecuteEventHandler</span>(<span class="hljs-attribute">std</span>::<span class="hljs-attribute">__h</span>::unique_ptr&lt;<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::InnerEvent, void (*)(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::InnerEvent*)&gt;&amp;)+<span class="hljs-number">2228</span>)(<span class="hljs-number">475713336</span>c2720d372d5aeb99dda5f9f)</li><li>#<span class="hljs-number">15</span> pc <span class="hljs-number">000000000001</span>a7d8 /system/lib64/chipset-sdk-sp/libeventhandler.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::(anonymous namespace)::<span class="hljs-attribute">EventRunnerImpl</span>::<span class="hljs-built_in">Run</span>()+<span class="hljs-number">648</span>)(<span class="hljs-number">475713336</span>c2720d372d5aeb99dda5f9f)</li><li>#<span class="hljs-number">16</span> pc <span class="hljs-number">000000000003</span>f5f4 /system/lib64/chipset-sdk-sp/libeventhandler.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::<span class="hljs-attribute">EventRunner</span>::<span class="hljs-built_in">Run</span>()+<span class="hljs-number">404</span>)(<span class="hljs-number">475713336</span>c2720d372d5aeb99dda5f9f)</li><li>#<span class="hljs-number">17</span> pc <span class="hljs-number">00000000000</span>a50f0 /system/lib64/platformsdk/libappkit_native.z.<span class="hljs-built_in">so</span>(<span class="hljs-attribute">OHOS</span>::<span class="hljs-attribute">AppExecFwk</span>::<span class="hljs-attribute">MainThread</span>::<span class="hljs-built_in">Start</span>()+<span class="hljs-number">504</span>)(e794b687fdf46631ae5144eba250f8c0)</li><li>#<span class="hljs-number">18</span> pc <span class="hljs-number">0000000000005278</span> /system/lib64/appspawn/appspawn/libappspawn_ace.z.<span class="hljs-built_in">so</span>(<span class="hljs-built_in">RunChildProcessor</span>(AppSpawnContent*, AppSpawnClient*)+<span class="hljs-number">568</span>)(<span class="hljs-number">143</span>c05087e9460f0fd794b9dce5dec29)</li><li>#<span class="hljs-number">19</span> pc <span class="hljs-number">000000000000</span>baa8 /system/bin/<span class="hljs-built_in">appspawn</span>(AppSpawnChild+<span class="hljs-number">648</span>)(<span class="hljs-number">25</span>ab88f6e04b1d2c8feb5d3eebfb4664)</li><li>#<span class="hljs-number">20</span> pc <span class="hljs-number">0000000000016478</span> /system/bin/<span class="hljs-built_in">appspawn</span>(ProcessSpawnReqMsg+<span class="hljs-number">3260</span>)(<span class="hljs-number">25</span>ab88f6e04b1d2c8feb5d3eebfb4664)</li><li>#<span class="hljs-number">21</span> pc <span class="hljs-number">0000000000013</span>aac /system/bin/<span class="hljs-built_in">appspawn</span>(OnReceiveRequest+<span class="hljs-number">724</span>)(<span class="hljs-number">25</span>ab88f6e04b1d2c8feb5d3eebfb4664)</li><li>#<span class="hljs-number">22</span> pc <span class="hljs-number">0000000000017844</span> /system/lib64/chipset-sdk-sp/libbegetutil.z.<span class="hljs-built_in">so</span>(HandleRecvMsg_+<span class="hljs-number">384</span>)(a9ddb8b84cc09183cc6bd2e5bb875f30)</li><li>#<span class="hljs-number">23</span> pc <span class="hljs-number">000000000001715</span>c /system/lib64/chipset-sdk-sp/libbegetutil.z.<span class="hljs-built_in">so</span>(HandleStreamEvent_+<span class="hljs-number">152</span>)(a9ddb8b84cc09183cc6bd2e5bb875f30)</li><li>#<span class="hljs-number">24</span> pc <span class="hljs-number">000000000001444</span>c /system/lib64/chipset-sdk-sp/libbegetutil.z.<span class="hljs-built_in">so</span>(ProcessEvent+<span class="hljs-number">380</span>)(a9ddb8b84cc09183cc6bd2e5bb875f30)</li><li>#<span class="hljs-number">25</span> pc <span class="hljs-number">0000000000013</span>edc /system/lib64/chipset-sdk-sp/libbegetutil.z.<span class="hljs-built_in">so</span>(RunLoop_.llvm.<span class="hljs-number">16927440879641410339</span>+<span class="hljs-number">656</span>)(a9ddb8b84cc09183cc6bd2e5bb875f30)</li><li>#<span class="hljs-number">26</span> pc <span class="hljs-number">0000000000010</span>dcc /system/bin/<span class="hljs-built_in">appspawn</span>(AppSpawnRun+<span class="hljs-number">212</span>)(<span class="hljs-number">25</span>ab88f6e04b1d2c8feb5d3eebfb4664)</li><li>#<span class="hljs-number">27</span> pc <span class="hljs-number">000000000000</span>eb90 /system/bin/<span class="hljs-built_in">appspawn</span>(main+<span class="hljs-number">728</span>)(<span class="hljs-number">25</span>ab88f6e04b1d2c8feb5d3eebfb4664)</li><li>#<span class="hljs-number">28</span> pc <span class="hljs-number">00000000000</span>a9804 /system/lib/ld-musl-aarch64.so.<span class="hljs-number">1</span>(libc_start_main_stage2+<span class="hljs-number">84</span>)(f1a940981720250b920ee26d2d76af5b)</li></ol></pre></div></div>     <p>大部分情况下，THREAD_BLOCK_6S、LIFECYCLE_TIMEOUT以及APP_INPUT_BLOCK故障的堆栈信息，可以协助开发者定位到异常代码。</p>     <p>其他情况下（比如瞬时栈场景），由于主线程繁忙等问题，导致获取堆栈信息延迟，无法及时捕获到异常代码段，堆栈的栈顶信息并非开发者期望获取的结果。</p>     <p>为解决上述问题，从API version 21开始，支持获取AppFreeze的增强日志。协助开发者定位问题，详见<a href="/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines#实现原理">AppFreeze（应用冻屏）增强日志实现原理</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在整机高负载情况（如CPU高负载）下，采用低开销方式获取调用栈时，可能损失函数名信息。</p>       <p>从API version 21开始，出现'Failed to dump normal stacktrace'字样时，系统采取轻量化的frame pointer回溯模式。栈回溯可能中断在非使能frame pointer的库（在GCC编译使用 -fomit-frame-pointer 选项时，编译产物会非使能frame pointer），以及受轻量化的限制，单个线程的回栈层数不会超过50层。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="对端信息与当前故障进程通信的进程信息">对端信息（与当前故障进程通信的进程信息）<i class="anchor-icon anchor-icon-link" anchorid="对端信息与当前故障进程通信的进程信息" tips="复制节点链接"></i></h3>          <p>（1）BinderCatcher：显示进程间通信的调用信息及等待时间过长的情况。</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">PeerBinderCatcher</span> -- <span class="hljs-variable">pid</span>==<span class="hljs-number">13680</span></li><li><span class="hljs-variable">BinderCatcher</span> --</li><li>    <span class="hljs-number">13840</span>:<span class="hljs-number">14102</span> <span class="hljs-title class_">to</span> <span class="hljs-number">901</span>:<span class="hljs-number">4079</span> <span class="hljs-title class_">code</span> <span class="hljs-number">16</span> <span class="hljs-title class_">wait</span>:<span class="hljs-number">0.25653125</span> <span class="hljs-title class_">s</span> <span class="hljs-title class_">frz_state</span>:<span class="hljs-number">3</span>,  <span class="hljs-variable">ns</span>:-<span class="hljs-number">1</span>:-<span class="hljs-number">1</span> <span class="hljs-title class_">to</span> -<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>, <span class="hljs-variable">debug</span>:<span class="hljs-number">13840</span>:<span class="hljs-number">14102</span> <span class="hljs-title class_">to</span> <span class="hljs-number">901</span>:<span class="hljs-number">4079</span>, <span class="hljs-variable">active_code</span>:<span class="hljs-number">0</span>, <span class="hljs-variable">active_thread</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">pending_async_proc</span>=<span class="hljs-number">0</span></li><li>    <span class="hljs-number">3712</span>:<span class="hljs-number">3712</span> <span class="hljs-title class_">to</span> <span class="hljs-number">13967</span>:<span class="hljs-number">14076</span> <span class="hljs-title class_">code</span> <span class="hljs-title class_">d2</span> <span class="hljs-title class_">wait</span>:<span class="hljs-number">0.703385417</span> <span class="hljs-title class_">s</span> <span class="hljs-title class_">frz_state</span>:<span class="hljs-number">3</span>,  <span class="hljs-variable">ns</span>:-<span class="hljs-number">1</span>:-<span class="hljs-number">1</span> <span class="hljs-title class_">to</span> -<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>, <span class="hljs-variable">debug</span>:<span class="hljs-number">3712</span>:<span class="hljs-number">3712</span> <span class="hljs-title class_">to</span> <span class="hljs-number">13967</span>:<span class="hljs-number">14076</span>, <span class="hljs-variable">active_code</span>:<span class="hljs-number">0</span>, <span class="hljs-variable">active_thread</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">pending_async_proc</span>=<span class="hljs-number">0</span></li><li>    <span class="hljs-number">1733</span>:<span class="hljs-number">2285</span> <span class="hljs-title class_">to</span> <span class="hljs-number">3712</span>:<span class="hljs-number">3712</span> <span class="hljs-title class_">code</span> <span class="hljs-title class_">b</span> <span class="hljs-title class_">wait</span>:<span class="hljs-number">1.365925521</span> <span class="hljs-title class_">s</span> <span class="hljs-title class_">frz_state</span>:<span class="hljs-number">3</span>,  <span class="hljs-variable">ns</span>:-<span class="hljs-number">1</span>:-<span class="hljs-number">1</span> <span class="hljs-title class_">to</span> -<span class="hljs-number">1</span>:-<span class="hljs-number">1</span>, <span class="hljs-variable">debug</span>:<span class="hljs-number">1733</span>:<span class="hljs-number">2285</span> <span class="hljs-title class_">to</span> <span class="hljs-number">3712</span>:<span class="hljs-number">3712</span>, <span class="hljs-variable">active_code</span>:<span class="hljs-number">0</span>, <span class="hljs-variable">active_thread</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">pending_async_proc</span>=<span class="hljs-number">0</span></li><li>...</li><li><span class="hljs-variable">pid</span> <span class="hljs-variable">context</span>     <span class="hljs-variable">request</span> <span class="hljs-variable">started</span> <span class="hljs-variable">max</span> <span class="hljs-variable">ready</span>   <span class="hljs-variable">free_async_space</span></li><li><span class="hljs-number">14072</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">2</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">14103</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">4</span>   <span class="hljs-number">16</span>  <span class="hljs-number">6</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13967</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">3</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13878</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">2</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13840</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">2</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13863</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">1</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13680</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">2</span>   <span class="hljs-number">16</span>  <span class="hljs-number">3</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13770</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">3</span>   <span class="hljs-number">16</span>  <span class="hljs-number">5</span>   <span class="hljs-number">520192</span></li><li><span class="hljs-number">13749</span>   <span class="hljs-variable">binder</span>  <span class="hljs-number">0</span>   <span class="hljs-number">3</span>   <span class="hljs-number">16</span>  <span class="hljs-number">5</span>   <span class="hljs-number">520192</span></li><li>...</li></ol></pre></div></div>     <p>进程间通信调用信息解释如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.3.1.1" valign="top" width="50%">主要信息字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.11.5.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">xxx:xxx to xxx:xxx</td>         <td class="cellrowborder" valign="top" width="50%">客户端进程号、线程号 to 服务端进程号、线程号。其中async表示异步，无async表示同步。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">code</td>         <td class="cellrowborder" valign="top" width="50%">客户端和服务端达成一致约束的业务码。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">wait</td>         <td class="cellrowborder" valign="top" width="50%">通信等待时长。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">frz_state</td>         <td class="cellrowborder" valign="top" width="50%">          <p>进程冻结状态。</p>          <p>-1 未知</p>          <p>1 默认</p>          <p>2 正在向用户态发送binder状态信息</p>          <p>3 走到了binder接收线程。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">ns</td>         <td class="cellrowborder" valign="top" width="50%">客户端进程号、线程号 to 服务端进程号、线程号（非卓易通内进程显示-1）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">debug</td>         <td class="cellrowborder" valign="top" width="50%">IPC通信双方的信息补充。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">active_code</td>         <td class="cellrowborder" valign="top" width="50%">正在处理的异步消息code。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">active_thread</td>         <td class="cellrowborder" valign="top" width="50%">处理这个异步消息的线程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">pending_async_proc</td>         <td class="cellrowborder" valign="top" width="50%">被这个异步消息阻塞的进程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">pid</td>         <td class="cellrowborder" valign="top" width="50%">进程PID。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">context</td>         <td class="cellrowborder" valign="top" width="50%">通信方式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">request</td>         <td class="cellrowborder" valign="top" width="50%">请求申请的IPC线程数量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">started</td>         <td class="cellrowborder" valign="top" width="50%">已经申请启动的IPC线程数量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">max</td>         <td class="cellrowborder" valign="top" width="50%">可以申请的最大IPC线程数量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">ready</td>         <td class="cellrowborder" valign="top" width="50%">空闲IPC线程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">free_async_space</td>         <td class="cellrowborder" valign="top" width="50%">空闲异步空间，用于观测异步信息阻塞。</td>        </tr>             </tbody></table></div>     </div>     <p>（2）PeerBinder Stacktrace：故障进程相关的对端进程有卡死，会抓取对端的进程堆栈，即与当前进程通信的进程堆栈</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-shell" data-highlighted="yes"><ol class="linenums"><li>Tid:48841, Name:xxx</li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">00 pc 000000000016adf4 /system/lib/ld-musl-aarch64.so.1</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">01 pc 000000000001c0d4 /system/lib64/chipset-sdk-sp/libeventhandler.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">02 pc 000000000001a7f4 /system/lib64/chipset-sdk-sp/libeventhandler.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">03 pc 000000000003f5f4 /system/lib64/chipset-sdk-sp/libeventhandler.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">04 pc 00000000000a50f0 /system/lib64/platformsdk/libappkit_native.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">05 pc 0000000000005278 /system/lib64/appspawn/appspawn/libappspawn_ace.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">06 pc 000000000000baa8 /system/bin/appspawn</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">07 pc 0000000000016478 /system/bin/appspawn</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">08 pc 0000000000013aac /system/bin/appspawn</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">09 pc 0000000000017844 /system/lib64/chipset-sdk-sp/libbegetutil.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">10 pc 000000000001715c /system/lib64/chipset-sdk-sp/libbegetutil.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">11 pc 000000000001444c /system/lib64/chipset-sdk-sp/libbegetutil.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">12 pc 0000000000013edc /system/lib64/chipset-sdk-sp/libbegetutil.z.so</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">13 pc 0000000000010dcc /system/bin/appspawn</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">14 pc 000000000000eb90 /system/bin/appspawn</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">15 pc 00000000000a9804 /system/lib/ld-musl-aarch64.so.1</span></li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">16 pc 000000000000b754 /system/bin/appspawn</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="cpu信息">CPU信息<i class="anchor-icon anchor-icon-link" anchorid="cpu信息" tips="复制节点链接"></i></h3>          <p>整机CPU信息及解释如下：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">Load average:</span> <span class="hljs-number">14.3</span> <span class="hljs-string">/</span> <span class="hljs-number">12.9</span> <span class="hljs-string">/</span> <span class="hljs-number">11.4</span><span class="hljs-string">;</span> <span class="hljs-string">the</span> <span class="hljs-string">cpu</span> <span class="hljs-string">load</span> <span class="hljs-string">average</span> <span class="hljs-string">in</span> <span class="hljs-number">1</span> <span class="hljs-string">min,</span> <span class="hljs-number">5</span> <span class="hljs-string">min</span> <span class="hljs-string">and</span> <span class="hljs-number">15</span> <span class="hljs-string">min</span></li><li><span class="hljs-string">CPU</span> <span class="hljs-string">usage</span> <span class="hljs-string">from</span> <span class="hljs-number">2025-06-28 14:08:36 </span><span class="hljs-string">to</span> <span class="hljs-number">2025-06-28 14:08:37</span></li><li><span class="hljs-attr">Total:</span> <span class="hljs-number">22.45</span><span class="hljs-string">%;</span> <span class="hljs-attr">User Space:</span> <span class="hljs-number">13.64</span><span class="hljs-string">%;</span> <span class="hljs-attr">Kernel Space:</span> <span class="hljs-number">8.81</span><span class="hljs-string">%;</span> <span class="hljs-attr">iowait:</span> <span class="hljs-number">0.33</span><span class="hljs-string">%;</span> <span class="hljs-attr">irq:</span> <span class="hljs-number">0.07</span><span class="hljs-string">%;</span> <span class="hljs-attr">idle:</span> <span class="hljs-number">77.15</span><span class="hljs-string">%</span></li><li><span class="hljs-attr">Details of Processes:</span></li><li>    <span class="hljs-string">PID</span>   <span class="hljs-string">Total</span> <span class="hljs-string">Usage</span>      <span class="hljs-string">User</span> <span class="hljs-string">Space</span>    <span class="hljs-string">Kernel</span> <span class="hljs-string">Space</span>    <span class="hljs-string">Page</span> <span class="hljs-string">Fault</span> <span class="hljs-string">Minor</span>    <span class="hljs-string">Page</span> <span class="hljs-string">Fault</span> <span class="hljs-string">Major</span>    <span class="hljs-string">Name</span></li><li>    <span class="hljs-number">13680</span>      <span class="hljs-number">8.86</span><span class="hljs-string">%</span>           <span class="hljs-number">8.31</span><span class="hljs-string">%</span>          <span class="hljs-number">0.55</span><span class="hljs-string">%</span>            <span class="hljs-number">4711                </span><span class="hljs-number">6637            </span><span class="hljs-string">com.samples.freezedebug</span></li><li>    <span class="hljs-number">644</span>        <span class="hljs-number">2.55</span><span class="hljs-string">%</span>           <span class="hljs-number">1.40</span><span class="hljs-string">%</span>          <span class="hljs-number">1.15</span><span class="hljs-string">%</span>          <span class="hljs-number">210104</span>                <span class="hljs-number">7391            </span><span class="hljs-string">hiview</span></li><li>    <span class="hljs-number">600</span>        <span class="hljs-number">0.89</span><span class="hljs-string">%</span>           <span class="hljs-number">0.78</span><span class="hljs-string">%</span>          <span class="hljs-number">0.10</span><span class="hljs-string">%</span>           <span class="hljs-number">60192</span>                 <span class="hljs-number">514</span>            <span class="hljs-string">hilogd</span></li><li>    <span class="hljs-number">1685       </span><span class="hljs-number">0.53</span><span class="hljs-string">%</span>           <span class="hljs-number">0.31</span><span class="hljs-string">%</span>          <span class="hljs-number">0.22</span><span class="hljs-string">%</span>          <span class="hljs-number">879838</span>               <span class="hljs-number">59636</span>            <span class="hljs-string">foundation</span></li></ol></pre></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.3.1.1" valign="top" width="50%">主要信息字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">PID</td>         <td class="cellrowborder" valign="top" width="50%">进程PID。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Total Usage</td>         <td class="cellrowborder" valign="top" width="50%">CPU使用率，Total Usage = User Space+Kernel Space。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">User Space</td>         <td class="cellrowborder" valign="top" width="50%">用户态使用率。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Kernel Space</td>         <td class="cellrowborder" valign="top" width="50%">内核态使用率。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Page Fault Minor</td>         <td class="cellrowborder" valign="top" width="50%">次要缺页错误。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Page Fault Major</td>         <td class="cellrowborder" valign="top" width="50%">主要缺页错误。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Name</td>         <td class="cellrowborder" valign="top" width="50%">进程名。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="内存信息">内存信息<i class="anchor-icon anchor-icon-link" anchorid="内存信息" tips="复制节点链接"></i></h3>          <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">Get</span> freeze memory <span class="hljs-keyword">start</span> <span class="hljs-type">time</span>: <span class="hljs-number">2025</span><span class="hljs-number">-06</span><span class="hljs-number">-28</span> <span class="hljs-number">14</span>:<span class="hljs-number">08</span>:<span class="hljs-number">37.112</span></li><li><span class="hljs-keyword">some</span> avg10<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> avg60<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> avg300<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> total<span class="hljs-operator">=</span><span class="hljs-number">56</span></li><li><span class="hljs-keyword">full</span> avg10<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> avg60<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> avg300<span class="hljs-operator">=</span><span class="hljs-number">56.81</span> total<span class="hljs-operator">=</span><span class="hljs-number">56</span></li><li>...</li><li>ReclaimAvailBuffer:                    <span class="hljs-number">4676608</span> kB</li><li>...</li></ol></pre></div></div>     <p>整机内存信息如上所示，其中ReclaimAvailBuffer为整机剩余可用内存，主要用于确认是否是低内存问题。</p>    </div>    <div class="tiledSection">     <h2 id="日志差异性信息">日志差异性信息<i class="anchor-icon anchor-icon-link" anchorid="日志差异性信息" tips="复制节点链接"></i></h2>          <p><strong>生命周期超时事件</strong></p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">DOMAIN</span>:<span class="hljs-title class_">AAFWK</span></li><li><span class="hljs-variable">STRINGID</span>:<span class="hljs-title class_">LIFECYCLE_TIMEOUT</span></li><li><span class="hljs-variable">TIMEOUT</span> <span class="hljs-variable">TIMESTAMP</span>:<span class="hljs-number">2025</span>/<span class="hljs-number">02</span>/<span class="hljs-number">10</span>-<span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">59</span>:<span class="hljs-number">113</span></li><li><span class="hljs-variable">PID</span>:<span class="hljs-number">1561</span></li><li><span class="hljs-variable">UID</span>:<span class="hljs-number">20010039</span></li><li><span class="hljs-variable">PACKAGE_NAME</span>:<span class="hljs-title class_">com</span>.<span class="hljs-title class_">example</span>.<span class="hljs-title class_">myapplication</span></li><li><span class="hljs-variable">PROCESS_NAME</span>:<span class="hljs-title class_">com</span>.<span class="hljs-title class_">example</span>.<span class="hljs-title class_">myapplication</span></li><li><span class="hljs-variable">MSG</span>:<span class="hljs-title class_">ability</span>:<span class="hljs-title class_">EntryAbility</span> <span class="hljs-title class_">background</span> <span class="hljs-title class_">timeout</span></li><li><span class="hljs-variable">server</span> <span class="hljs-variable">actions</span> <span class="hljs-keyword">for</span> <span class="hljs-variable">ability</span>:</li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.376</span>; <span class="hljs-title class_">AbilityRecord</span>::<span class="hljs-title class_">ProcessForegroundAbility</span>; <span class="hljs-title class_">the</span> <span class="hljs-title class_">ProcessForegroundAbility</span> <span class="hljs-title class_">lifecycle</span> <span class="hljs-title class_">starts</span>.</li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.377</span>; <span class="hljs-title class_">ServiceInner</span>::<span class="hljs-title class_">UpdateAbilityState</span></li><li><span class="hljs-variable">server</span> <span class="hljs-variable">actions</span> <span class="hljs-keyword">for</span> <span class="hljs-variable">app</span>:</li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.397</span>; <span class="hljs-title class_">AppRunningRecord</span>::<span class="hljs-title class_">OnWindowVisibilityChanged</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.851</span>; <span class="hljs-title class_">AppRunningRecord</span>::<span class="hljs-title class_">OnWindowVisibilityChanged</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">58.668</span>; <span class="hljs-title class_">AppRunningRecord</span>::<span class="hljs-title class_">OnWindowVisibilityChanged</span></li><li><span class="hljs-variable">client</span> <span class="hljs-variable">actions</span> <span class="hljs-keyword">for</span> <span class="hljs-variable">ability</span>:</li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.378</span>; <span class="hljs-title class_">AbilityThread</span>::<span class="hljs-title class_">ScheduleAbilityTransaction</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.378</span>; <span class="hljs-title class_">AbilityThread</span>::<span class="hljs-title class_">HandleAbilityTransaction</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.382</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">OnStart</span> <span class="hljs-title class_">begin</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.382</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">OnStart</span> <span class="hljs-title class_">end</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.387</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">OnSceneCreated</span> <span class="hljs-title class_">begin</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.388</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">OnSceneCreated</span> <span class="hljs-title class_">end</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.388</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">WindowScene</span>::<span class="hljs-title class_">GoForeground</span> <span class="hljs-title class_">begin</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.389</span>; <span class="hljs-title class_">UIAbilityImpl</span>::<span class="hljs-title class_">WindowLifeCycleImpl</span>::<span class="hljs-title class_">AfterForeground</span></li><li><span class="hljs-number">2025</span>-<span class="hljs-number">02</span>-<span class="hljs-number">10</span> <span class="hljs-number">21</span>:<span class="hljs-number">40</span>:<span class="hljs-number">56.390</span>; <span class="hljs-title class_">JsUIAbility</span>::<span class="hljs-title class_">OnForeground</span> <span class="hljs-title class_">begin</span></li><li><span class="hljs-variable">client</span> <span class="hljs-variable">actions</span> <span class="hljs-keyword">for</span> <span class="hljs-variable">app</span>:</li></ol></pre></div></div>     <p>下面用两个完整生命周期切换示例来解释MSG中的信息。</p>     <p>（1）load 阶段事件（应用进程未创建举例）</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.4.1.1" valign="top" width="33.33333333333333%">server</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.4.1.2" valign="top" width="33.33333333333333%">client</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.6.1.4.1.3" valign="top" width="33.33333333333333%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AbilityRecord::LoadAbility; the LoadAbility lifecycle starts.</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppMgrServiceInner::LoadAbility</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">创建进程前。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppMgrService::AttachApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">进程创建成功，进程attach。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ServiceInner::AttachApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">进程attach。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ServiceInner::LaunchApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用执行加载流程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppRunningRecord::LaunchApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用执行加载流程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppScheduler::ScheduleLaunchApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用执行加载流程。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ScheduleLaunchApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用收到加载调度请求。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">HandleLaunchApplication begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用加载开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">HandleLaunchApplication end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用加载结束。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppRunningRecord::LaunchPendingAbilities</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用启动ability。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">MainThread::ScheduleLaunchAbility</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用收到请求加载ability。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">MainThread::HandleLaunchAbility</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程处理。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsAbilityStage::Create</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">加载abilityStage。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsAbilityStage::OnCreate begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">abilityStage onCreate生命周期开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsAbilityStage::OnCreate end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">abilityStage onCreate生命周期结束。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AbilityThread::Attach</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ability attach到ams，load过程结束。</td>        </tr>             </tbody></table></div>     </div>     <p>（2）foreground 阶段事件，冷启动</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.4.1.1" valign="top" width="33.33333333333333%">server</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.4.1.2" valign="top" width="33.33333333333333%">client</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.8.1.4.1.3" valign="top" width="33.33333333333333%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AbilityRecord::ProcessForegroundAbility; the ProcessForegroundAbility lifecycle starts.</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%"></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ServiceInner::UpdateAbilityState</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">先调度应用前台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppRunningRecord::ScheduleForegroundRunning</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用前台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppScheduler::ScheduleForegroundApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度应用前台。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ScheduleForegroundApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用收到调度。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">HandleForegroundApplication</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程执行调度。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AppMgrService::AppForegrounded</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用前台完成。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ServiceInner::AppForegrounded</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用前台完成。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AbilityThread::ScheduleAbilityTransaction</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用收到ability前台调度。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">AbilityThread::HandleAbilityTransaction</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程执行ability前台调度。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnStart begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">onCreate生命周期开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnStart end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">onCreate生命周期结束。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnSceneCreated begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">创建窗口scene开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnSceneCreated end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">创建窗口scene结束。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnWillForeground begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnWillForeground end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::WindowScene::GoForeground begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调用窗口接口执行 goForeground。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">UIAbilityImpl::WindowLifeCycleImpl::AfterForeground</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">窗口迁台后回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnForeground begin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">onForeground生命周期开始。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">JsUIAbility::OnForeground end</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">onForeground生命周期结束。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%"></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">当窗口回调和onForeground都完成后，前台生命周期结束。</td>        </tr>             </tbody></table></div>     </div>     <p>参考<a href="/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines#日志规格">日志规格</a>分析其他日志信息。特别说明：大多数情况下，生命周期切换时主线程会卡死。可以结合两个日志的堆栈和BinderCatcher信息对比查看。</p>     <p><strong>APP_INPUT_BLOCK 用户输入响应超时</strong></p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Generated</span> <span class="hljs-variable">by</span> <span class="hljs-variable">HiviewDFX</span>@<span class="hljs-title function_">HarmonyOS</span></li><li>================================================================</li><li>...</li><li><span class="hljs-variable">Reason</span>:<span class="hljs-title class_">APP_INPUT_BLOCK</span></li><li><span class="hljs-variable">appfreeze</span>: <span class="hljs-title class_">com</span>.<span class="hljs-title class_">samples</span>.<span class="hljs-title class_">freezedebug</span> <span class="hljs-title class_">APP_INPUT_BLOCK</span> <span class="hljs-title class_">at</span> <span class="hljs-number">20251129123745</span></li><li><span class="hljs-variable">Wait</span> <span class="hljs-title function_">Event</span>(<span class="hljs-number">430</span>) <span class="hljs-variable">to</span> <span class="hljs-variable">be</span> <span class="hljs-variable">marked</span> <span class="hljs-variable">exceed</span> <span class="hljs-number">8000</span><span class="hljs-variable">ms</span>, <span class="hljs-title function_">lastDispatchEvent</span>(<span class="hljs-number">430</span>), <span class="hljs-title function_">lastProcessEvent</span>(<span class="hljs-number">429</span>), <span class="hljs-title function_">lastMarkedEvent</span>(<span class="hljs-number">428</span>)</li><li><span class="hljs-variable">DisplayPowerInfo</span>:<span class="hljs-title class_">powerState</span>:<span class="hljs-title class_">AWAKE</span></li><li>...</li></ol></pre></div></div>     <p>从API version 22开始，发生APP_INPUT_BLOCK故障时，日志中会同步输出多模点击输入（包含鼠标、键盘、触控板及触屏等输入方式）超时事件（Wait Event）。该事件信息中包含事件id，事件检测超时阈值，及前置事件id。</p>     <p>事件检测超时阈值：log版本为8000毫秒，nolog版本为5000毫秒。</p>     <p>前置事件中包含：lastDispatchEvent为上次分发的事件；lastProcessEvent为上次处理的事件；lastMarkedEvent为上次标记的事件。</p>     <p>在上述示例中，上次分发的事件是430，上次处理的事件是429，上次标记的事件是428，表明430事件已分发完毕，在处理环节，已超时8000毫秒。此日志可以用于APP_INPUT_BLOCK事件的简单定界，帮助问题分析。</p>    </div>    <div class="tiledSection">     <h2 id="appfreeze应用冻屏增强日志信息">AppFreeze（应用冻屏）增强日志信息<i class="anchor-icon anchor-icon-link" anchorid="appfreeze应用冻屏增强日志信息" tips="复制节点链接"></i></h2>          <p>从API version 21开始，支持获取AppFreeze的增强日志。该日志通过采集整机及主线程的运行负载，并抓取多份主线程调用栈，帮助开发者分析问题根源。相比原有日志，AppFreeze的增强日志主要解决了以下两个不足：</p>     <ol>      <li>       <p>难以定位故障期间的主线程热点。</p></li>      <li>       <p>缺乏对主线程繁忙或阻塞的资源层面分析。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="实现原理" class="firsth2">实现原理<i class="anchor-icon anchor-icon-link" anchorid="实现原理" tips="复制节点链接"></i></h3>          <p>生成AppFreeze增强日志的流程分为以下两个阶段，具体如下：</p>     <ol>      <li>       <p>应用进程在运行时发生THREAD_BLOCK_3S或LIFECYCLE_HALF_TIMEOUT时，会开启采集主线程调用栈流程，记录当前时刻的一些CPU信息。</p></li>      <li>       <p>应用进程在运行时发生THREAD_BLOCK_6S、LIFECYCLE_TIMEOUT或APP_INPUT_BLOCK时，会停止上述流程的采集主线程调用栈流程，并计算周期内的CPU信息。一般情况下，会抓取1~10次堆栈日志。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>由于应用冻屏事件的采样栈会与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-mainthreadjank-events">MAIN_THREAD_JANK</a>冲突，如果应用接入MAIN_THREAD_JANK的setEventConfig接口自定义配置采集堆栈的个数，应用冻屏事件的采集堆栈的会与应用当前配置的采集堆栈的个数一致。</p>         <p>APP_INPUT_BLOCK故障有增强日志的前提是：先发生THREAD_BLOCK_3S或LIFECYCLE_HALF_TIMEOUT。</p>        </div></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="日志获取-1">日志获取<i class="anchor-icon anchor-icon-link" anchorid="日志获取-1" tips="复制节点链接"></i></h3>          <p>开发者可通过以下方式获取Appfreeze增强日志路径：</p>     <p><strong>方式一：通过HiAppEvent接口订阅</strong></p>     <p>应用需要在AppScope/app.json5文件中配置如下环境变量：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>"appEnvironments": [</li><li>  {</li><li>    "name": "DFX_APPFREEZE_LOG_OPTIONS",</li><li>    "value": "mainthread_sampling:enable"</li><li>  }</li><li>]</li></ol></pre></div></div>     <p>HiAppEvent给开发者提供了故障订阅接口，开发者可以使用HiAppEvent监听应用冻屏事件，获取文件内容，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events">应用冻屏事件介绍</a>。参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events-arkts">订阅应用冻屏事件（ArkTS）</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events-ndk">订阅应用冻屏事件（C/C++）</a>完成应用冻屏事件订阅。</p>     <p>开发者可以通过事件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-freeze-events#事件字段说明">external_log</a>字段读取应用冻屏事件生成的故障文件和应用冻屏事件的增强日志文件。增强日志文件的命名与应用冻屏事件生成的故障文件名称格式相同。</p>     <p>external_log是字符串数组，第一个元素为应用冻屏事件生成的故障文件路径；第二个元素为应用冻屏事件生成的增强日志文件路径。</p>     <p><strong>方式二：通过hdc获取日志，需打开开发者选项</strong></p>     <p>在开发者选项打开的情况下，开发者可以通过“hdc file recv /data/log/faultlog/freeze_ext D:\”命令导出故障日志到本地，故障日志文件名格式为：freeze-cpuinfo-ext-进程名-进程UID-毫秒级时间。</p>    </div>    <div class="tiledSection">     <h3 id="日志规格-1">日志规格<i class="anchor-icon anchor-icon-link" anchorid="日志规格-1" tips="复制节点链接"></i></h3>          <p>增强日志的信息头字段如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.3.1.4.1.1" valign="top" width="33.33333333333333%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.3.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.3.1.4.1.3" valign="top" width="33.33333333333333%">起始API版本</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">TimeStamp</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">日志生成时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">Module name</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">故障模块名。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>             </tbody></table></div>     </div>     <p>增强日志的CPU总体耗时信息字段如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.5.1.4.1.1" valign="top" width="33.33333333333333%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.5.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.5.1.4.1.3" valign="top" width="33.33333333333333%">起始API版本</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ProcessCpuTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计周期内，进程运行时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">DeviceRuntime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计周期内，设备所有CPU的运行时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">Tid</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">线程号。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">StartTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计开始时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">EndTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计结束时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">StaticsDuration</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计持续时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">CpuTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计周期内，主线程运行时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SyncWaitTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程等待时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">OptimalCpuTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">统计周期内，主线程最优负载运行时间（使用最大核的最高算力运行）。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SupplyAvailableTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">调度可优化时间。如果值较小，说明主线程繁忙，需要开发者考虑优化主线程的任务。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>             </tbody></table></div>     </div>     <p>增强日志的堆栈信息字段如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.4.1.1" valign="top" width="33.33333333333333%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.4.1.2" valign="top" width="33.33333333333333%">描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.18.7.1.4.1.3" valign="top" width="33.33333333333333%">起始API版本</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SnapshotTime</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">本次抓取主线程堆栈的时间。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">ThreadInfos Tid</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">线程号。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">Name</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">线程名。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">Stack</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程调用栈。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">SubmitterStacktrace</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">任务提交者调用栈。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">21</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="增强日志规格">增强日志规格<i class="anchor-icon anchor-icon-link" anchorid="增强日志规格" tips="复制节点链接"></i></h3>          <p>本节主要介绍增强日志的一般日志规格，以下是一份Appfreeze增强日志的核心内容。可以使用<a href="/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines#聚类脚本说明">聚类脚本</a>提取主线程堆栈关键信息，提高问题定位效率及准确性。</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>Generated by HiviewDFX @HarmonyOS</li><li>===============================================================</li><li>TimeStamp: 2021-01-01 20:06:01.175  &lt;- 日志生成时间</li><li>Module name: com.example.freeze   &lt;- 模块名</li><li>
</li><li>#Basic Concepts   &lt;- CPU时间注释</li><li>T1:  StaticsDuration, EndTime - StartTime.</li><li>T2:  CpuTime              --Time that spend on CPU.</li><li>T3:  SyncWaitTime         --SleepingTime + Runnable Time, etc.</li><li>T4:  OptimalCpuTime       --run the thread at the max Core's max cpu capacity.</li><li>T5:  SupplyAvailableTime  --T2 - T4. Time can be optimized by scheduling.</li><li>Equation:  T1 = T2 + T3. T2 = T4 + T5.</li><li>|-----------------------------------StaticsDuration-----------------------------------|.</li><li>|-------------------------CpuTime----------------------|--------SyncWaitTime----------|.</li><li>|----OptimalCpuTime----|------SupplyAvailableTime------|--------SyncWaitTime----------|.</li><li>
</li><li>#Basic Statistical Infomation  &lt;- CPU基本统计信息</li><li>ProcessCpuTime: 0 ms  &lt;- 统计周期内，进程运行时间</li><li>DeviceRuntime: 0 ms  &lt;- 统计周期内，设备所有CPU的运行时间</li><li>Tid: 2320  &lt;- 故障主线程号</li><li>StartTime: 2021-01-01 20:05:58:177  &lt;- 统计开始时间</li><li>EndTime: 2021-01-01 20:06:01:172  &lt;- 统计结束时间</li><li>StaticsDuration: 2995 ms  &lt;- 统计持续时间</li><li>CpuTime: 0 ms  &lt;- 统计周期内，主线程运行时间</li><li>SyncWaitTime: 2995 ms  &lt;- 主线程等待时间</li><li>OptimalCpuTime: 0 ms  &lt;- 统计周期内，主线程最优负载运行时间（使用最大核的最高算力运行）</li><li>SupplyAvailableTime: 0 ms  &lt;- 调度可优化时间</li><li>
</li><li>#CpuFreq Usage (usage &gt;=1%)  &lt;- 当CPU单个频点使用率&gt;=1%时，这些频点及频点的使用率就会被列出来。</li><li>start time: 2021-01-01 20:06:00:888  &lt;- 计算CPU使用率开始时间</li><li>cpu0 Usage 23.5%, 1430MHZ 21.04%  &lt;- cpu0的总使用率，cpu0单个频点的使用率（在1430MHZ频点下的使用率）</li><li>cpu1 Usage 23.5%, 1430MHZ 21.04%</li><li>cpu2 Usage 23.5%, 1430MHZ 21.04%</li><li>cpu3 Usage 23.5%, 1430MHZ 21.04%</li><li>.......</li><li>end time: 2021-01-01 20:06:00:888  &lt;- 计算CPU使用率结束时间</li><li>#ThreadInfos Tid: 2204, Name: com.example.freeze  &lt;- 故障线程号，线程名</li><li>SnapshotTime: 2021-01-01-20-05-58.292875  &lt;- 获取主线程的时间</li><li>#00 pc 00000000000015b8 [shmm](__kernel_gettimeofday+72) &lt;- 主线程调用栈</li><li>#01 pc 00000000001d7e44 /system/lib64/ld-musl-aarck64.so.1(clock_gettime+48)(f8a0616c89b184992d0e8883cc78f638)</li><li>#02 pc 00000000001d9f20 /system/lib64/ld-musl-aarck64.so.1(time+32)(f8a0616c89b184992d0e8883cc78f638)</li><li>#03 pc 0000000000007e2c /data/storage/el1/bundle/libs/arm64/libsample.so(WaitSomeTime()+76)(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#04 pc 0000000000009b2c /data/storage/el1/bundle/libs/arm64/libsample.so(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#05 pc 00000000000a0500 /system/lib64/platformsdk/libruntime.z.so(c2f75213ee12fdf08da323fe546923ff)</li><li>#06 pc 0000000000017b04 /system/lib64/chipset-sdk-sp/libeventhandler.z.so(366b4d7f2eba693ad06f14469b08943b)</li><li>#07 pc 0000000000016f38 /system/lib64/chipset-sdk-sp/libeventhandler.z.so(366b4d7f2eba693ad06f14469b08943b)</li><li>#08 pc 000000000003e160 /system/lib64/chipset-sdk-sp/libeventhandler.z.so(OHOS::AppExecFwk::EventRunner::Run()+396)(366b4d7f2eba693ad06f14469b08943b)</li><li>.......</li><li>========SubmitterStacktrace======== &lt;- 任务提交者调用栈(最多抓取16层调用栈)</li><li>#00 pc 0000000000013108 /system/lib64/platformsdk/libuv.so(uv_queue_work+292)(366b4d7f2eba693ad06f14469b08943b)</li><li>#01 pc 0000000000008cdc /data/storage/el1bundle/libs/arm64/libsample.so(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#02 pc 000000000005ae00 /system/lib64/platformsdk/libace_napi.z.so(panda::JSValueRef ArkNativeFunctionCallBack&lt;true&gt;(panda::JsiRuntimeCallInfo*)+272)(bc1c64aabbe5c7d4db2282a6137443e1)</li><li>#03 pc 0000000000de3efc /system/lib64/module/arkcompiler/stub.an(RTStub_PushCallArgsAndDispatchNative+44)</li><li>#04 pc 0000000000448dd4 /system/lib64/module/arkcompiler/stub.an(BCStub_HandleCallthis0Imm8V8StwCopy+372)</li><li>#05 at anonymous (sample|sample|1.0.0|src/main/ets/pages/Index.ts:381:36)</li><li>#06 pc 00000000001e5c8c /system/lib64/platformsdk/libark_jsruntime.so(ce0b05d90b9fae02e7abf8e9f1e5a0f3)</li><li>.......</li><li>
</li><li>SnapshotTime: 2021-01-01-20-05-58.549685</li><li>#00 pc 00000000000015b8 [shmm](__kernel_gettimeofday+72)</li><li>#01 pc 00000000001d7e44 /system/lib64/ld-musl-aarck64.so.1(clock_gettime+48)(f8a0616c89b184992d0e8883cc78f638)</li><li>#02 pc 00000000001d9f20 /system/lib64/ld-musl-aarck64.so.1(time+32)(f8a0616c89b184992d0e8883cc78f638)</li><li>#03 pc 0000000000007e2c /data/storage/el1/bundle/libs/arm64/libsample.so(WaitSomeTime()+76)(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#04 pc 0000000000009b2c /data/storage/el1/bundle/libs/arm64/libsample.so(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#05 pc 00000000000a0500 /system/lib64/platformsdk/libruntime.z.so(c2f75213ee12fdf08da323fe546923ff)</li><li>.......</li><li>========SubmitterStacktrace========</li><li>#00 pc 0000000000013108 /system/lib64/platformsdk/libuv.so(uv_queue_work+292)(366b4d7f2eba693ad06f14469b08943b)</li><li>#01 pc 0000000000008cdc /data/storage/el1bundle/libs/arm64/libsample.so(8b74cdc906ea6b2eba95d891bc91c72a)</li><li>#02 pc 000000000005ae00 /system/lib64/platformsdk/libace_napi.z.so(panda::JSValueRef ArkNativeFunctionCallBack&lt;true&gt;(panda::JsiRuntimeCallInfo*)+272)(bc1c64aabbe5c7d4db2282a6137443e1)</li><li>#03 pc 0000000000de3efc /system/lib64/module/arkcompiler/stub.an(RTStub_PushCallArgsAndDispatchNative+44)</li><li>#04 pc 0000000000448dd4 /system/lib64/module/arkcompiler/stub.an(BCStub_HandleCallthis0Imm8V8StwCopy+372)</li><li>#05 at anonymous (sample|sample|1.0.0|src/main/ets/pages/Index.ts:381:36)</li><li>.......</li></ol></pre></div></div>     <p><strong>Native栈帧内容说明</strong></p>     <p>详细说明见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cppcrash-guidelines#一般故障场景日志规格">Cpp Crash一般故障场景日志规格</a>中的调用栈帧内容说明。</p>     <p><strong>JS混合栈帧内容说明</strong></p>     <p>详细说明见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/jscrash-guidelines#异常代码调用栈格式">JS Crash异常代码调用栈格式</a>。</p>    </div>    <div class="tiledSection">     <h3 id="增强日志聚类规则">增强日志聚类规则<i class="anchor-icon anchor-icon-link" anchorid="增强日志聚类规则" tips="复制节点链接"></i></h3>          <p><strong>聚类规则说明</strong></p>     <p>在一份包含多个应用主线程堆栈（如10份）的日志中，对每份采样栈执行以下操作。</p>     <p>1.过滤系统栈</p>     <p>如需过滤掉系统栈帧（如 /system/lib/...、ld-musl 等）。系统栈帧格式示例：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li># 00 pc 000e8400 /system/lib/ld-musl-arm.so.1(raise+176)(a40044d0acb68107cfc4adb5049c0725)</li></ol></pre></div></div>     <p>2.保留业务栈</p>     <p>如需保留业务栈帧（以“at”为起始字符，或包含“/data/storage”子串，JS 栈帧默认视为业务栈帧（来自应用代码）。业务栈帧格式示例：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>at onPageShow har1 (har1/src/main/ets/pages/Index.ets:7:13)</li></ol></pre></div></div>     <p>3.标准化栈帧</p>     <p>定义标准化栈帧的内容，自行去除易变信息（如行号、字节偏移、BuildID），根据实际聚类需求保留聚类的关键信息。</p>     <p>对每一帧业务栈帧，执行以下清洗操作：</p>     <p>（1）Native栈帧标准化</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.14.1.3.1.1" valign="top" width="50%">原始栈帧内容</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.14.1.3.1.2" valign="top" width="50%">标准化后栈帧内容</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"># 01 pc 00006e95 /data/crasher_cpp(DfxCrasher::RaiseSegmentFaultException()+92)(d6cead5be17c9bb7eee2a9b4df4b7626)</td>         <td class="cellrowborder" valign="top" width="50%">/data/crasher_cpp(DfxCrasher::RaiseSegmentFaultException()+92)</td>        </tr>             </tbody></table></div>     </div>     <p>按以下步骤处理：</p>     <p>a. 提取函数签名部分（括号内的内容，含类名、函数名、参数）；</p>     <p>b. 忽略PC偏移和BuildID；</p>     <p>c. 保留函数完整签名（包括 const、参数类型等，若日志中已解析）。</p>     <p>（2）JS栈帧标准化</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.20.1.3.1.1" valign="top" width="50%">原始栈帧内容</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.20.1.3.1.2" valign="top" width="50%">标准化后栈帧内容</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"># 00 at onPageShow (entry|har1|1.0.0|src/main/ets/pages/Index.ts:7:13)</td>         <td class="cellrowborder" valign="top" width="50%">onPageShow (entry|har1|1.0.0|src/main/ets/pages/Index.ts:7:13)</td>        </tr>             </tbody></table></div>     </div>     <p>按以下步骤处理：</p>     <p>a. 去除行号；</p>     <p>b. 保留函数名（如 onPageShow）；</p>     <p>c. 保留文件路径（如 src/main/ets/pages/Index.ts）；</p>     <p>d. 最终生成一个标准化的业务调用栈序列，用于后续聚类分析。</p>     <p>4.生成聚类特征</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.20.27.1.3.1.1" valign="top" width="50%">原始采样栈</th>         <th align="left" class="cellrowborder" id="mcps1.3.20.27.1.3.1.2" valign="top" width="50%">最终聚类特征（调用顺序从上到下）</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p># 00 pc 000e8400 /system/lib/ld-musl-arm.so.1(raise+176)(a40044d0...)</p>          <p># 01 pc 00006e95 /data/crasher_cpp(DfxCrasher::RaiseSegmentFaultException()+92)(d6ce...)</p>          <p># 02 pc 00008909 /data/crasher_cpp(DfxCrasher::ParseAndDoCrash(char const*) const+612)(d6ce...)</p>          <p># 03 at onPageShow (entry|har1|1.0.0|src/main/ets/pages/Index.ts:7:13)</p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>/data/crasher_cpp(DfxCrasher::RaiseSegmentFaultException()+92)</p>          <p>/data/crasher_cpp(DfxCrasher::ParseAndDoCrash(char const*) const+612)</p>          <p>at onPageShow (entry|har1|1.0.0|src/main/ets/pages/Index.ts:7:13)</p></td>        </tr>             </tbody></table></div>     </div>     <p>根据聚类特征直接聚类所有采样栈。</p>    </div>    <div class="tiledSection">     <h3 id="聚类脚本说明">聚类脚本说明<i class="anchor-icon anchor-icon-link" anchorid="聚类脚本说明" tips="复制节点链接"></i></h3>          <p>该脚本的使用仅限于<a href="/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines#增强日志规格">appfreeze增强日志</a>。当日志内容过长、主线程堆栈存在多次重复时，用于提取业务栈聚类信息（业务栈内容、总出现次数及代表性完整堆栈等），更快定位问题。</p>     <p>1.脚本功能</p>     <p>该脚本用于批量处理指定文件夹中的.zip日志文件。按以下步骤处理：</p>     <p>（1）从输入文件夹中读取所有.zip文件中采样栈文件；</p>     <p>（2）自动逐一解压，解析及转换；</p>     <p>（3）将处理结果输出到指定文件夹中。</p>     <p>2.运行方式</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">get_all_result</span>(<span class="hljs-variable">input_dir</span>: <span class="hljs-title class_">str</span>, <span class="hljs-variable">output_dir</span>: <span class="hljs-title class_">str</span>)</li></ol></pre></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.5.1.2" valign="top" width="25%">是否必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.5.1.3" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.21.10.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">input_dir</td>         <td class="cellrowborder" valign="top" width="25%">必填</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">输入文件夹路径，需包含若干.zip日志文件。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">output_dir</td>         <td class="cellrowborder" valign="top" width="25%">必填</td>         <td class="cellrowborder" valign="top" width="25%">字符串</td>         <td class="cellrowborder" valign="top" width="25%">输出文件夹路径，脚本会将处理后的结果写入该目录。</td>        </tr>             </tbody></table></div>     </div>     <p>示例：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-python" data-highlighted="yes"><ol class="linenums"><li>get_all_result(<span class="hljs-string">r"D:\log\input"</span>, <span class="hljs-string">r"D:\log\output"</span>)</li></ol></pre></div></div>     <p>3.输入要求</p>     <p>input_dir目录下应为若干.zip文件。</p>     <p>不限制文件名，可为嵌套结构（脚本可拓展支持.zip内还有.zip）。</p>     <p>zip文件中必须带采样栈日志文件。</p>     <p>4.输出说明</p>     <p>脚本会在output_dir中生成处理结果（例如）：</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>output_dir/</li><li>├─stack_summary.txt</li><li>├─ 业务栈聚类.txt</li><li>└─ 业务栈聚类.xlsx</li></ol></pre></div></div>     <p>实际输出类型依脚本逻辑而定（解压文件/转换文件/汇总文本/JSON/CSV等）。</p>     <p>5.运行前准备</p>     <p>确保本机或部署环境满足以下条件:</p>     <p>（1）已安装Python 3.x。</p>     <p>（2）已安装脚本依赖（如 os/zipfile/pandas 等）。</p>     <p>（3）output_dir不存在时脚本会自动创建（若脚本未实现自动创建，请提前建好目录）。</p>     <p>（4）该脚本不支持在DevEco Studio中执行，请在已按照的python环境下运行该脚本。</p>     <p>6.聚类脚本源码</p>     <div _ngcontent-wgk-c106="" class="highlight-div"><div _ngcontent-wgk-c106="" class="highlight-div-header"><div _ngcontent-wgk-c106="" class="highlight-div-header-left"><div _ngcontent-wgk-c106="" class="handle-button expand-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wgk-c106="" class="highlight-div-header-right"><div _ngcontent-wgk-c106="" class="handle-button ai-button"></div><div _ngcontent-wgk-c106="" class="handle-button line-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wgk-c106="" class="handle-button theme-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wgk-c106="" class="handle-button copy-button"><div _ngcontent-wgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wgk-c106="" class="highlight-scroll-div"><pre class="Python prettyprint linenums hljs language-Python" hw-language="Python" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> re</li><li><span class="hljs-keyword">from</span> collections <span class="hljs-keyword">import</span> Counter, defaultdict</li><li><span class="hljs-keyword">import</span> os</li><li><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd</li><li><span class="hljs-keyword">import</span> zipfile</li><li><span class="hljs-keyword">import</span> glob</li><li><span class="hljs-keyword">from</span> pathlib <span class="hljs-keyword">import</span> Path</li><li>
</li><li><span class="hljs-comment"># 日志目录</span></li><li>log_dir = <span class="hljs-string">r"D:\log\input"</span>  <span class="hljs-comment"># 改成你日志目录</span></li><li><span class="hljs-comment"># 输出结果</span></li><li>output_file = <span class="hljs-string">r"D:\log\stack_summary.txt"</span></li><li><span class="hljs-comment"># 匹配堆栈行</span></li><li>stack_line_pattern = re.<span class="hljs-built_in">compile</span>(<span class="hljs-string">r'^\s*(#\d+\s+pc\s+[0-9a-f]+.*|#?\d*\s*at .+)$'</span>)</li><li>
</li><li>
</li><li><span class="hljs-comment"># 判断是否是业务栈</span></li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_business_stack</span>(<span class="hljs-params">line</span>):</li><li>    line = line.strip()</li><li>    <span class="hljs-keyword">return</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r'^(#\d+\s+)?at .+\(.+\)$'</span>, line) <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span></li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">process_log_file</span>(<span class="hljs-params">path</span>):</li><li>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(path, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>, errors=<span class="hljs-string">'ignore'</span>) <span class="hljs-keyword">as</span> f:</li><li>        lines = f.readlines()</li><li>
</li><li>    all_stacks = []</li><li>    current_stack = []</li><li>    <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> lines:</li><li>        <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">"SnapshotTime:"</span>):</li><li>            <span class="hljs-keyword">if</span> current_stack:</li><li>                all_stacks.append(current_stack)</li><li>                current_stack = []</li><li>        <span class="hljs-keyword">elif</span> stack_line_pattern.<span class="hljs-keyword">match</span>(line):</li><li>            <span class="hljs-comment"># 忽略无关紧要的系统行</span></li><li>            <span class="hljs-keyword">if</span> re.<span class="hljs-keyword">match</span>(<span class="hljs-string">r'#\d+\s+pc\s+[0-9a-f]+$'</span>, line.strip()):</li><li>                <span class="hljs-keyword">continue</span></li><li>            current_stack.append(line.strip())</li><li>    <span class="hljs-keyword">if</span> current_stack:</li><li>        all_stacks.append(current_stack)</li><li>
</li><li>    <span class="hljs-comment"># 对同一日志的堆栈进行计数</span></li><li>    stack_counter = Counter()</li><li>    <span class="hljs-keyword">for</span> stack <span class="hljs-keyword">in</span> all_stacks:</li><li>        business_lines = [line <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> stack <span class="hljs-keyword">if</span> is_business_stack(line)]</li><li>        <span class="hljs-keyword">if</span> business_lines:</li><li>            key = <span class="hljs-string">"\n"</span>.join(business_lines[<span class="hljs-number">0</span>:<span class="hljs-number">5</span>])</li><li>        <span class="hljs-keyword">else</span>:</li><li>            key = <span class="hljs-string">"\n"</span>.join(stack)</li><li>        stack_counter[key] += <span class="hljs-number">1</span></li><li>
</li><li>    <span class="hljs-comment"># 只保留出现次数大于5的</span></li><li>    result = {k: v <span class="hljs-keyword">for</span> k, v <span class="hljs-keyword">in</span> stack_counter.items() <span class="hljs-keyword">if</span> v &gt;= <span class="hljs-number">1</span>}</li><li>    <span class="hljs-keyword">return</span> result</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">remove_lineno</span>(<span class="hljs-params">line</span>):</li><li>    <span class="hljs-keyword">return</span> re.sub(<span class="hljs-string">r'^#\d+\s+'</span>, <span class="hljs-string">''</span>, line.strip())</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">normalize_frame</span>(<span class="hljs-params">line: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">str</span>:</li><li>    <span class="hljs-string">"""</span></li><li><span class="hljs-string">    去掉无关信息，提取业务栈的关键部分</span></li><li><span class="hljs-string">    """</span></li><li>    line = line.strip()</li><li>    <span class="hljs-comment"># 去掉 "#数字 pc 地址" 或 "#数字 at"</span></li><li>    line = re.sub(<span class="hljs-string">r'^#\d+\s+(pc\s+[0-9a-f]+\s+)?'</span>, <span class="hljs-string">''</span>, line)</li><li>    <span class="hljs-comment"># 去掉行号 (:123:1)</span></li><li>    line = re.sub(<span class="hljs-string">r':\d+(:\d+)?'</span>, <span class="hljs-string">''</span>, line)</li><li>    <span class="hljs-keyword">return</span> line</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">is_business_frame</span>(<span class="hljs-params">line: <span class="hljs-built_in">str</span></span>) -&gt; <span class="hljs-built_in">bool</span>:</li><li>    <span class="hljs-string">"""</span></li><li><span class="hljs-string">    判断是否是业务栈</span></li><li><span class="hljs-string">    """</span></li><li>    <span class="hljs-keyword">return</span> (</li><li>            line.startswith(<span class="hljs-string">"at "</span>) <span class="hljs-keyword">or</span></li><li>            <span class="hljs-string">"/data/storage/"</span> <span class="hljs-keyword">in</span> line</li><li>    )</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">unzip_all</span>(<span class="hljs-params">src_dir, dest_dir</span>):</li><li>    <span class="hljs-comment"># 确保目标目录存在</span></li><li>    os.makedirs(dest_dir, exist_ok=<span class="hljs-literal">True</span>)</li><li>
</li><li>    <span class="hljs-comment"># 找到所有 zip 文件</span></li><li>    zip_files = glob.glob(os.path.join(src_dir, <span class="hljs-string">"*.zip"</span>))</li><li>
</li><li>    <span class="hljs-keyword">for</span> zip_path <span class="hljs-keyword">in</span> zip_files:</li><li>        <span class="hljs-comment"># 以 zip 文件名（去掉扩展名）作为子目录</span></li><li>        base_name = os.path.splitext(os.path.basename(zip_path))[<span class="hljs-number">0</span>]</li><li>        extract_path = os.path.join(dest_dir, base_name)</li><li>
</li><li>        os.makedirs(extract_path, exist_ok=<span class="hljs-literal">True</span>)</li><li>
</li><li>        <span class="hljs-comment"># 解压</span></li><li>        <span class="hljs-keyword">with</span> zipfile.ZipFile(zip_path, <span class="hljs-string">"r"</span>) <span class="hljs-keyword">as</span> zip_ref:</li><li>            zip_ref.extractall(extract_path)</li><li>
</li><li>        <span class="hljs-built_in">print</span>(<span class="hljs-string">f"✅ 解压完成: <span class="hljs-subst">{zip_path}</span> → <span class="hljs-subst">{extract_path}</span>"</span>)</li><li>
</li><li>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"\n全部解压完成，共 <span class="hljs-subst">{<span class="hljs-built_in">len</span>(zip_files)}</span> 个 zip 文件。"</span>)</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_cluster</span>(<span class="hljs-params">input_dir</span>):</li><li>    input_file = os.path.join(input_dir, <span class="hljs-string">'stack_summary.txt'</span>)</li><li>    <span class="hljs-comment"># 统计次数和代表性堆栈</span></li><li>    cluster_count = defaultdict(<span class="hljs-built_in">int</span>)</li><li>    cluster_sample = {}  <span class="hljs-comment"># 片段 key -&gt; 代表性完整堆栈</span></li><li>
</li><li>    current_stack = []</li><li>    current_count = <span class="hljs-number">0</span></li><li>
</li><li>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(input_file, <span class="hljs-string">"r"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:</li><li>        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> f:</li><li>            line = line.rstrip()</li><li>            <span class="hljs-keyword">if</span> line.startswith(<span class="hljs-string">"出现次数:"</span>):</li><li>                current_count = <span class="hljs-built_in">int</span>(re.search(<span class="hljs-string">r'\d+'</span>, line).group())</li><li>                current_stack = []</li><li>            <span class="hljs-keyword">elif</span> line.startswith(<span class="hljs-string">"="</span> * <span class="hljs-number">10</span>) <span class="hljs-keyword">or</span> line == <span class="hljs-string">""</span>:</li><li>                <span class="hljs-keyword">if</span> current_stack:</li><li>                    <span class="hljs-comment"># 找第一个业务栈</span></li><li>                    business_frame = <span class="hljs-literal">None</span></li><li>                    <span class="hljs-keyword">for</span> frame <span class="hljs-keyword">in</span> current_stack:</li><li>                        norm = normalize_frame(frame)</li><li>                        <span class="hljs-keyword">if</span> is_business_frame(norm):</li><li>                            business_frame = norm</li><li>                            <span class="hljs-keyword">break</span></li><li>                    <span class="hljs-keyword">if</span> business_frame:</li><li>                        cluster_count[business_frame] += <span class="hljs-number">1</span></li><li>                        <span class="hljs-keyword">if</span> business_frame <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> cluster_sample:  <span class="hljs-comment"># 保存代表性堆栈</span></li><li>                            cluster_sample[business_frame] = <span class="hljs-string">"\n"</span>.join(current_stack)</li><li>                current_stack = []</li><li>            <span class="hljs-keyword">else</span>:</li><li>                current_stack.append(line)</li><li>    output_file = os.path.join(input_dir, <span class="hljs-string">'业务栈聚类.txt'</span>)</li><li>    <span class="hljs-comment"># 输出到txt</span></li><li>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:</li><li>        <span class="hljs-keyword">for</span> top_line, total_count <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(cluster_count.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>):</li><li>            f.write(<span class="hljs-string">f"业务栈: <span class="hljs-subst">{top_line}</span>\n"</span>)</li><li>            f.write(<span class="hljs-string">f"总出现次数: <span class="hljs-subst">{total_count}</span>\n"</span>)</li><li>            f.write(<span class="hljs-string">"代表性完整堆栈:\n"</span>)</li><li>            f.write(cluster_sample[top_line] + <span class="hljs-string">"\n"</span>)</li><li>            f.write(<span class="hljs-string">"-"</span> * <span class="hljs-number">80</span> + <span class="hljs-string">"\n"</span>)</li><li>
</li><li>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"业务栈聚类完成，结果输出到 <span class="hljs-subst">{output_file}</span>"</span>)</li><li>
</li><li>    <span class="hljs-comment"># 输出到excel</span></li><li>    rows = []</li><li>    <span class="hljs-keyword">for</span> key, count <span class="hljs-keyword">in</span> <span class="hljs-built_in">sorted</span>(cluster_count.items(), key=<span class="hljs-keyword">lambda</span> x: x[<span class="hljs-number">1</span>], reverse=<span class="hljs-literal">True</span>):</li><li>        rows.append({</li><li>            <span class="hljs-string">"业务栈片段"</span>: key,</li><li>            <span class="hljs-string">"总出现次数"</span>: count,</li><li>            <span class="hljs-string">"代表性完整堆栈"</span>: cluster_sample[key]</li><li>        })</li><li>    output_excel = os.path.join(input_dir, <span class="hljs-string">'业务栈聚类.xlsx'</span>)</li><li>    df = pd.DataFrame(rows)</li><li>    df.to_excel(output_excel, index=<span class="hljs-literal">False</span>)</li><li>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"业务栈聚类已导出到 <span class="hljs-subst">{output_excel}</span>"</span>)</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_stack_summary</span>(<span class="hljs-params">log_dir, output_dir</span>):</li><li>    all_results = {}</li><li>    <span class="hljs-keyword">for</span> root, dirs, files <span class="hljs-keyword">in</span> os.walk(log_dir):</li><li>        <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> files:</li><li>            <span class="hljs-keyword">if</span> <span class="hljs-string">"freeze-cpuinfo-ext"</span> <span class="hljs-keyword">in</span> filename:</li><li>                path = os.path.join(root, filename)</li><li>                result = process_log_file(path)</li><li>                <span class="hljs-keyword">if</span> result:</li><li>                    all_results[path] = result</li><li>    folder = Path(output_dir)  <span class="hljs-comment">#统一转成 Path</span></li><li>    output_file = folder / <span class="hljs-string">'stack_summary.txt'</span>  <span class="hljs-comment">#自动拼路径</span></li><li>    folder.mkdir(parents=<span class="hljs-literal">True</span>, exist_ok=<span class="hljs-literal">True</span>)</li><li>    <span class="hljs-comment"># 输出结果</span></li><li>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(output_file, <span class="hljs-string">"w"</span>, encoding=<span class="hljs-string">"utf-8"</span>) <span class="hljs-keyword">as</span> f:</li><li>        <span class="hljs-keyword">for</span> log_file, stacks <span class="hljs-keyword">in</span> all_results.items():</li><li>            f.write(<span class="hljs-string">f"日志文件: <span class="hljs-subst">{log_file}</span>\n"</span>)</li><li>            <span class="hljs-keyword">for</span> stack_text, count <span class="hljs-keyword">in</span> stacks.items():</li><li>                f.write(<span class="hljs-string">f"出现次数: <span class="hljs-subst">{count}</span>\n"</span>)</li><li>                f.write(stack_text + <span class="hljs-string">"\n"</span>)</li><li>                f.write(<span class="hljs-string">"="</span> * <span class="hljs-number">80</span> + <span class="hljs-string">"\n"</span>)</li><li>    <span class="hljs-built_in">print</span>(<span class="hljs-string">f"处理完成，结果输出到 <span class="hljs-subst">{output_file}</span>"</span>)</li><li>
</li><li>
</li><li><span class="hljs-keyword">def</span> <span class="hljs-title function_">get_all_result</span>(<span class="hljs-params">log_dir, output_dir</span>):</li><li>    unzip_all(log_dir, log_dir)</li><li>    get_stack_summary(log_dir, output_dir)</li><li>    get_cluster(output_dir)</li><li>
</li><li>
</li><li><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">"__main__"</span>:</li><li>    get_all_result(<span class="hljs-string">r"D:\log\input"</span>, <span class="hljs-string">r"D:\log\output"</span>)</li></ol></pre></div></div>    </div>   </div>   <div></div></div>