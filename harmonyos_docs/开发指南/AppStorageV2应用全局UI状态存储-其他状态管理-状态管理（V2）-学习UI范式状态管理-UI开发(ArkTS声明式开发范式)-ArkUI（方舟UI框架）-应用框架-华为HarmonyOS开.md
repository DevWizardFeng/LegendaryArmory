<h1 _ngcontent-rwh-c119="" class="doc-title ng-star-inserted" title="AppStorageV2: 应用全局UI状态存储"> AppStorageV2: 应用全局UI状态存储 </h1>

<div _ngcontent-rwh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了增强状态管理框架对应用全局UI状态变量的共享能力，开发者可以使用AppStorageV2存储应用全局UI的状态变量数据。</p>    <p>AppStorageV2是提供状态变量在应用级全局共享的能力，开发者可以通过connect绑定同一个key，进行跨ability的数据共享。</p>    <p>在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2和@Trace</a>，配合阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#appstoragev2" target="_blank">AppStorageV2-API文档</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>AppStorageV2从API version 12开始支持。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>AppStorageV2是在应用UI启动时会被创建的单例。它的目的是为了提供应用状态数据的中心存储，这些状态数据在应用级别都是可访问的。AppStorageV2将在应用运行过程保留其数据。数据通过唯一的键字符串值访问。需要注意的是，AppStorage与AppStorageV2之间的数据互不共享。</p>     <p>AppStorageV2可以修改connect的返回值，实现与UI组件的同步。</p>     <p>AppStorageV2支持应用的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/thread-model-stage">主线程</a>内多个UIAbility实例间的状态共享。</p>    </div>    <div class="tiledSection">     <h2 id="使用说明">使用说明<i class="anchor-icon anchor-icon-link" anchorid="使用说明" tips="复制节点链接"></i></h2>          <ul>      <li>connect：创建或获取存储的数据。</li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>1、若未指定key，使用第二个参数作为默认构造器；否则使用第三个参数作为默认构造器（第二个参数非法也使用第三个参数作为默认构造器）。</p>       <p>2、确保数据已经存储在AppStorageV2中，可省略默认构造器，获取存储的数据；否则必须指定默认构造器，不指定将导致应用异常。</p>       <p>3、同一个key，connect不同类型的数据会导致应用异常，应用需要确保类型匹配。</p>       <p>4、key建议使用有意义的值，可由字母、数字、下划线组成，长度不超过255，使用非法字符或空字符的行为是未定义的。</p>       <p>5、关联<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed</a>对象时，由于该类型的name属性未定义，需要指定key或者自定义name属性。</p>      </div></div></div>     <ul>      <li>remove：删除指定key的存储数据。</li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>删除AppStorageV2中不存在的key会报警告。</p>      </div></div></div>     <ul>      <li>keys：返回所有AppStorageV2中的key。</li>     </ul>     <p>以上接口详细描述请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#appstoragev2" target="_blank">状态管理API指南</a>。</p>    </div>    <div class="tiledSection">     <h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2>          <p>1、只支持class类型。</p>     <p>2、需要配合UI使用（UI线程），不能在其他线程使用，如不支持@Sendable。</p>     <p>3、不支持collections.Set、collections.Map等类型。</p>     <p>4、不支持非built-in类型，如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>、NativePointer、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arraylist" target="_blank">ArrayList</a>等Native类型。</p>     <p>5、不支持存储基本类型，如string、number、boolean等。注意：不支持存储基本类型意味着connect接口传入的类型不能是基本类型，但connect传入的class中可以包含基本类型。</p>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="使用appstoragev2" class="firsth2">使用AppStorageV2<i class="anchor-icon anchor-icon-link" anchorid="使用appstoragev2" tips="复制节点链接"></i></h3>          <p>AppStorageV2使用connect接口即可实现对AppStorageV2中数据的修改和同步，如果修改的数据被@Trace装饰，该数据的修改会同步更新UI。需要注意的是，使用remove接口只会将数据从AppStorageV2中删除，不影响组件中已创建的数据，详见以下示例代码：</p>     <div _ngcontent-rwh-c106="" class="highlight-div"><div _ngcontent-rwh-c106="" class="highlight-div-header"><div _ngcontent-rwh-c106="" class="highlight-div-header-left"><div _ngcontent-rwh-c106="" class="handle-button expand-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rwh-c106="" class="highlight-div-header-right"><div _ngcontent-rwh-c106="" class="handle-button ai-button"></div><div _ngcontent-rwh-c106="" class="handle-button line-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rwh-c106="" class="handle-button theme-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rwh-c106="" class="handle-button copy-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rwh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Message</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">userID</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">userName</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">userID?: <span class="hljs-built_in">number</span>, userName?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userID</span> = userID ?? <span class="hljs-number">1</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">userName</span> = userName ?? <span class="hljs-string">'Jack'</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 使用connect在AppStorageV2中创建一个key为Message的对象</span></li><li>  <span class="hljs-comment">// 修改connect的返回值即可同步回AppStorageV2</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>())!;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 修改@Trace装饰的类属性，UI能同步刷新</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Index userID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message.userID}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">userID</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 修改非@Trace装饰的类属性，UI不会同步刷新，但修改的类属性已同步回AppStorageV2</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Index userName: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message.userName}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">userName</span> += <span class="hljs-string">'suf'</span>;</li><li>        })</li><li>      <span class="hljs-comment">// remove key Message, 会从AppStorageV2中删除key为Message的对象</span></li><li>      <span class="hljs-comment">// remove之后，修改父组件的userId，子组件能同步变化，因为remove只是从AppStorageV2删除，不会影响组件中已存在的数据</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'remove key: Message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">remove</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>);</li><li>        })</li><li>      <span class="hljs-comment">// connect key Message, 会从AppStorageV2中添加key为Message的对象</span></li><li>      <span class="hljs-comment">// remove之后，重新添加，修改父子组件的userID，可以发现数据已经不同步，子组件重新connect之后，数据一致</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'connect key: Message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-number">5</span>, <span class="hljs-string">'Rose'</span>))!;</li><li>        })</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 使用connect在AppStorageV2中取出一个key为Message的对象，已在父组件中创建</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-title class_">Message</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>())!;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">userName</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 修改@Trace装饰的类属性，UI同步刷新，父组件能感知该变化</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Child userID: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.message.userID}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">userID</span> += <span class="hljs-number">5</span>;</li><li>        })</li><li>      <span class="hljs-comment">// 修改父组件中的userName属性，点击name可以同步父组件的类属性修改</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Child name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-property">userName</span>;</li><li>        })</li><li>      <span class="hljs-comment">// remove key Message, 会从AppStorageV2中删除key为Message的对象</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'remove key: Message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">remove</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>);</li><li>        })</li><li>      <span class="hljs-comment">// connect key Message, 会从AppStorageV2中添加key为Message的对象</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'connect key: Message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-property">connect</span>&lt;<span class="hljs-title class_">Message</span>&gt;(<span class="hljs-title class_">Message</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Message</span>(<span class="hljs-number">10</span>, <span class="hljs-string">'Lucy'</span>))!;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在两个页面之间存储数据">在两个页面之间存储数据<i class="anchor-icon anchor-icon-link" anchorid="在两个页面之间存储数据" tips="复制节点链接"></i></h3>          <p>数据页面</p>     <div _ngcontent-rwh-c106="" class="highlight-div"><div _ngcontent-rwh-c106="" class="highlight-div-header"><div _ngcontent-rwh-c106="" class="highlight-div-header-left"><div _ngcontent-rwh-c106="" class="handle-button expand-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rwh-c106="" class="highlight-div-header-right"><div _ngcontent-rwh-c106="" class="handle-button ai-button"></div><div _ngcontent-rwh-c106="" class="handle-button line-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rwh-c106="" class="handle-button theme-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rwh-c106="" class="handle-button copy-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rwh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 数据中心</span></li><li><span class="hljs-comment">// Sample.ets</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sample</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">p1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">p2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li></ol></pre></div></div>     <p>页面1</p>     <div _ngcontent-rwh-c106="" class="highlight-div"><div _ngcontent-rwh-c106="" class="highlight-div-header"><div _ngcontent-rwh-c106="" class="highlight-div-header-left"><div _ngcontent-rwh-c106="" class="handle-button expand-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rwh-c106="" class="highlight-div-header-right"><div _ngcontent-rwh-c106="" class="handle-button ai-button"></div><div _ngcontent-rwh-c106="" class="handle-button line-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rwh-c106="" class="handle-button theme-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rwh-c106="" class="handle-button copy-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rwh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page1.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Sample</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../Sample'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page1</span> {</li><li>  <span class="hljs-comment">// 在AppStorageV2中创建一个key为Sample的键值对（如果存在，则返回AppStorageV2中的数据），并且和prop关联</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">prop</span>: <span class="hljs-title class_">Sample</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">Sample</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>())!;</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Go to page2'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page2'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Page1 connect the key Sample'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 在AppStorageV2中创建一个key为Sample的键值对（如果存在，则返回AppStorageV2中的数据），并且和prop关联</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">Sample</span>, <span class="hljs-string">'Sample'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>())!;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Page1 remove the key Sample'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 从AppStorageV2中删除后，prop将不会再与key为Sample的值关联</span></li><li>            <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-title class_">Sample</span>);</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Page1 add 1 to prop.p1: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.prop.p1}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span>.<span class="hljs-property">p1</span>++;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Page1 add 1 to prop.p2: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.prop.p2}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 页面不刷新，但是p2的值改变了</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span>.<span class="hljs-property">p2</span>++;</li><li>          })</li><li>
</li><li>        <span class="hljs-comment">// 获取当前AppStorageV2里面的所有key</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`all keys in AppStorage: <span class="hljs-subst">${AppStorageV2.keys()}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>页面2</p>     <div _ngcontent-rwh-c106="" class="highlight-div"><div _ngcontent-rwh-c106="" class="highlight-div-header"><div _ngcontent-rwh-c106="" class="highlight-div-header-left"><div _ngcontent-rwh-c106="" class="handle-button expand-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rwh-c106="" class="highlight-div-header-right"><div _ngcontent-rwh-c106="" class="handle-button ai-button"></div><div _ngcontent-rwh-c106="" class="handle-button line-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rwh-c106="" class="handle-button theme-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rwh-c106="" class="handle-button copy-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rwh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page2.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AppStorageV2</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Sample</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../Sample'</span>;</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">Page2Builder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page2</span>()</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page2</span> {</li><li>  <span class="hljs-comment">// 在AppStorageV2中创建一个key为Sample的键值对（如果存在，则返回AppStorageV2中的数据），并且和prop关联</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">prop</span>: <span class="hljs-title class_">Sample</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">Sample</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>())!;</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Page2 connect the key Sample1'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 在AppStorageV2中创建一个key为Sample1的键值对（如果存在，则返回AppStorageV2中的数据），并且和prop关联</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span> = <span class="hljs-title class_">AppStorageV2</span>.<span class="hljs-title function_">connect</span>(<span class="hljs-title class_">Sample</span>, <span class="hljs-string">'Sample1'</span>, <span class="hljs-function">() =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Sample</span>())!;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Page2 add 1 to prop.p1: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.prop.p1}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span>.<span class="hljs-property">p1</span>++;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Page2 add 1 to prop.p2: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.prop.p2}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 页面不刷新，但是p2的值改变了；只有重新初始化才会改变</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">prop</span>.<span class="hljs-property">p2</span>++;</li><li>          })</li><li>
</li><li>        <span class="hljs-comment">// 获取当前AppStorageV2里面的所有key</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`all keys in AppStorage: <span class="hljs-subst">${AppStorageV2.keys()}</span>`</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用Navigation时，需要添加配置系统路由表文件src/main/resources/base/profile/route_map.json，并替换pageSourceFile为Page2页面的路径，并且在module.json5中添加："routerMap": "$profile:route_map"。</p>     <div _ngcontent-rwh-c106="" class="highlight-div"><div _ngcontent-rwh-c106="" class="highlight-div-header"><div _ngcontent-rwh-c106="" class="highlight-div-header-left"><div _ngcontent-rwh-c106="" class="handle-button expand-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rwh-c106="" class="highlight-div-header-right"><div _ngcontent-rwh-c106="" class="handle-button ai-button"></div><div _ngcontent-rwh-c106="" class="handle-button line-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rwh-c106="" class="handle-button theme-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rwh-c106="" class="handle-button copy-button"><div _ngcontent-rwh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rwh-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"routerMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/Page2.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page2Builder"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"description"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"AppStorageV2 example"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </div>   </div>   <div></div></div>