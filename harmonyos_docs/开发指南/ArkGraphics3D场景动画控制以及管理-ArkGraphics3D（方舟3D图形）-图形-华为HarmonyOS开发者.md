<h1 _ngcontent-mcs-c119="" class="doc-title ng-star-inserted" title="ArkGraphics 3D场景动画控制以及管理"> ArkGraphics 3D场景动画控制以及管理 </h1>

<div _ngcontent-mcs-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>动画（animation）：动画是3D场景中重要的资源类型，用于控制场景中各种元素的运动。比如想要场景中的人物进行走路这个动作，每帧计算人物每一个关节的旋转角并进行设置是难以实现的。所以在完成类似的要求时，3D场景资源的制作者会将动画制作好，在模型文件中保存动画的关键帧数据以及关键帧间的插值器类型。</p> <p>ArkGraphics 3D提供播放并控制场景动画的能力，支持开发者灵活地控制动画的状态，达到预期的渲染效果。</p>  <div class="tiledSection"><h2 id="动画资源的创建">动画资源的创建<i class="anchor-icon anchor-icon-link" anchorid="动画资源的创建" tips="复制节点链接"></i></h2><p>动画资源是模型资源制作者在制作模型的过程中制作并保存到模型文件中的。ArkGraphics 3D提供从glTF模型资源中提取并播放动画的能力，进而使得开发者可以进行动画状态的控制。</p> <div _ngcontent-mcs-c106="" class="highlight-div"><div _ngcontent-mcs-c106="" class="highlight-div-header"><div _ngcontent-mcs-c106="" class="highlight-div-header-left"><div _ngcontent-mcs-c106="" class="handle-button expand-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mcs-c106="" class="highlight-div-header-right"><div _ngcontent-mcs-c106="" class="handle-button ai-button"></div><div _ngcontent-mcs-c106="" class="handle-button line-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mcs-c106="" class="handle-button theme-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mcs-c106="" class="handle-button copy-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mcs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Animation</span>, <span class="hljs-title class_">Scene</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics3D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createAnimation</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// 加载场景资源，支持.gltf和.glb格式，路径和文件名可根据项目实际资源自定义</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">scene</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Scene</span>&gt; = <span class="hljs-title class_">Scene</span>.<span class="hljs-title function_">load</span>($rawfile(<span class="hljs-string">"gltf/CubeWithFloor/glTF/AnimatedCube.glb"</span>));</li><li>  scene.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">result</span>: <span class="hljs-title class_">Scene</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">animations</span> &amp;&amp; result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>]) {</li><li>      <span class="hljs-comment">// 获取动画资源</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">anim</span>: <span class="hljs-title class_">Animation</span> = result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>];</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="动画状态的控制">动画状态的控制<i class="anchor-icon anchor-icon-link" anchorid="动画状态的控制" tips="复制节点链接"></i></h2><p>ArkGraphics 3D提供的动画状态控制操作主要包含如下几种：</p> <ul><li>开始（start）：基于当前进度开始播放一个动画。</li><li>停止（stop）：停止播放一个动画，并将动画的进度设置到未开始状态。</li><li>结束（finish）：直接跳转到动画的最后，并将动画的进度设置到已结束状态。</li><li>暂停（pause）：将动画暂停，动画的播放进度保持在当前状态。</li><li>重启（restart）：从动画的起点开始播放动画。</li></ul> <p>示例代码如下：</p> <div _ngcontent-mcs-c106="" class="highlight-div"><div _ngcontent-mcs-c106="" class="highlight-div-header"><div _ngcontent-mcs-c106="" class="highlight-div-header-left"><div _ngcontent-mcs-c106="" class="handle-button expand-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mcs-c106="" class="highlight-div-header-right"><div _ngcontent-mcs-c106="" class="handle-button ai-button"></div><div _ngcontent-mcs-c106="" class="handle-button line-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mcs-c106="" class="handle-button theme-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mcs-c106="" class="handle-button copy-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mcs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Animation</span>, <span class="hljs-title class_">Scene</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics3D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">animationControl</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// 加载场景资源，支持.gltf和.glb格式，路径和文件名可根据项目实际资源自定义</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">scene</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Scene</span>&gt; = <span class="hljs-title class_">Scene</span>.<span class="hljs-title function_">load</span>($rawfile(<span class="hljs-string">"gltf/CubeWithFloor/glTF/AnimatedCube.glb"</span>));</li><li>  scene.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">result</span>: <span class="hljs-title class_">Scene</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">animations</span> &amp;&amp; result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>]) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">anim</span>: <span class="hljs-title class_">Animation</span> = result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-comment">// 动画状态控制方法示例，仅用于展示接口，非实际播放流程</span></li><li>      anim.<span class="hljs-title function_">start</span>();</li><li>      anim.<span class="hljs-title function_">pause</span>();</li><li>      anim.<span class="hljs-title function_">stop</span>();</li><li>      anim.<span class="hljs-title function_">restart</span>();</li><li>      anim.<span class="hljs-title function_">finish</span>();</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="动画回调的使用">动画回调的使用<i class="anchor-icon anchor-icon-link" anchorid="动画回调的使用" tips="复制节点链接"></i></h2><p>动画回调指的是在动画执行到某些状态时执行的函数，用于帮助开发者以动画状态为基础做触发式的逻辑控制工作。ArkGraphics 3D提供给开发者如下回调：</p> <ul><li>onStarted()：当动画开始播放时执行的回调函数，start操作以及restart操作也会触发这个回调。</li><li>onFinished()：动画播放结束时执行的回调函数，动画播放完成或者finish操作会触发这个回调。</li></ul> <p>示例代码如下：</p> <div _ngcontent-mcs-c106="" class="highlight-div"><div _ngcontent-mcs-c106="" class="highlight-div-header"><div _ngcontent-mcs-c106="" class="highlight-div-header-left"><div _ngcontent-mcs-c106="" class="handle-button expand-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mcs-c106="" class="highlight-div-header-right"><div _ngcontent-mcs-c106="" class="handle-button ai-button"></div><div _ngcontent-mcs-c106="" class="handle-button line-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mcs-c106="" class="handle-button theme-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mcs-c106="" class="handle-button copy-button"><div _ngcontent-mcs-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mcs-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Animation</span>, <span class="hljs-title class_">Scene</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics3D'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">callBacks</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">// 加载场景资源，支持.gltf和.glb格式，路径和文件名可根据项目实际资源自定义</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">scene</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">Scene</span>&gt; = <span class="hljs-title class_">Scene</span>.<span class="hljs-title function_">load</span>($rawfile(<span class="hljs-string">"gltf/CubeWithFloor/glTF/AnimatedCube.glb"</span>));</li><li>  scene.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">result</span>: <span class="hljs-title class_">Scene</span>) =&gt; {</li><li>    <span class="hljs-keyword">if</span> (result &amp;&amp; result.<span class="hljs-property">animations</span> &amp;&amp; result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>]) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">anim</span>: <span class="hljs-title class_">Animation</span> = result.<span class="hljs-property">animations</span>[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-comment">// 注册回调函数</span></li><li>      anim.<span class="hljs-title function_">onFinished</span>(<span class="hljs-function">()=&gt;</span>{</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onFinished"</span>);</li><li>      });</li><li>      anim.<span class="hljs-title function_">onStarted</span>(<span class="hljs-function">()=&gt;</span>{</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onStarted"</span>);</li><li>      });</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2><ul><li><a href="https://gitcode.com/HarmonyOS_Samples/Graphics3D" target="_blank">基于3D引擎接口实现3D图形渲染功能（ArkTS）</a></li></ul> </div> </div> <div></div></div>