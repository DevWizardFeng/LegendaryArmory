<h1 _ngcontent-vvc-c119="" class="doc-title ng-star-inserted" title="ArkGuard混淆常见问题"> ArkGuard混淆常见问题 </h1>

<div _ngcontent-vvc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="如何排查功能异常">如何排查功能异常<i class="anchor-icon anchor-icon-link" anchorid="如何排查功能异常" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="排查功能异常步骤" class="firsth2">排查功能异常步骤<i class="anchor-icon anchor-icon-link" anchorid="排查功能异常步骤" tips="复制节点链接"></i></h3><ol><li>在obfuscation-rules.txt中配置-disable-obfuscation选项关闭混淆，确认问题是否由混淆引起。</li><li>若确认开启混淆后功能出现异常，请先阅读文档，了解模块已配置的混淆规则的能力和需要配置白名单的语法场景，以确保应用功能正常。下文简要介绍默认开启的四项选项功能，详情请参阅对应选项的完整描述。<ol><li><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-toplevel-obfuscation">-enable-toplevel-obfuscation</a>为顶层作用域名称混淆开关。</p>  </li><li><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-property-obfuscation">-enable-property-obfuscation</a>为属性混淆开关。配置白名单的主要场景包括网络数据访问、json字段访问、动态属性访问、调用so库接口等。需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-keep-property-name">-keep-property-name</a>来保留指定的属性名称。</p>  </li><li><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-export-obfuscation">-enable-export-obfuscation</a>为导入/导出名称混淆。一般与-enable-toplevel-obfuscation和-enable-property-obfuscation选项配合使用。配置白名单的主要场景为模块对外接口不能混淆。需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-keep-global-name">-keep-global-name</a>来保留指定的导出/导入名称。</p>  </li><li><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-enable-filename-obfuscation">-enable-filename-obfuscation</a>为文件名混淆。配置白名单的主要场景为动态import或运行时直接加载的文件路径。需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation#section-keep-file-name">-keep-file-name</a>来保留这些文件路径及名称。</p>  </li></ol>  </li><li>参考以下典型报错案例，若遇到相似场景，可参照对应解决方法快速处理。</li><li>若以下报错案例中未找到相似场景，建议依据各项配置功能正向定位（若不需要相应功能，可删除对应配置项）。</li><li>应用运行时崩溃分析方法：<ol><li>打开应用运行日志，或点击DevEco Studio中出现的Crash弹窗，找到运行时崩溃栈。</li><li>应用运行时异常栈中的行号为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation-guide#查看混淆效果">编译产物</a>的行号，方法名也可能为混淆后名称；因此排查时建议直接根据异常栈查看编译产物，进而分析哪些名称不能被混淆，然后将其配置到白名单中。</li></ol>  </li><li>应用在运行时未崩溃但出现功能异常（如白屏）的分析方法：<ol><li><p>打开应用运行日志：选择HiLog，检索与功能异常直接相关的日志，定位问题发生的上下文。</p>  </li><li><p>定位异常代码段：分析日志，找到引发功能异常的代码块。</p>  </li><li><p>增强日志输出：在疑似异常的功能代码中，增加日志打印以检查数据是否正常。</p>  </li><li><p>分析并确定关键字段：通过分析新增的日志输出，判断数据异常是否由混淆导致。</p>  </li><li><p>配置白名单以保护关键字段：将混淆后对应用功能有直接影响的关键字段添加到白名单中。</p>  </li></ol>  </li></ol> </div>  <div class="tiledSection"><h3 id="排查非预期的混淆能力">排查非预期的混淆能力<i class="anchor-icon anchor-icon-link" anchorid="排查非预期的混淆能力" tips="复制节点链接"></i></h3><p>若出现预期外的混淆效果，检查是否由于依赖的本地模块或三方库开启了某些混淆选项。</p> <p>示例：</p> <p>假设当前模块未配置-compact，但混淆的中间产物中代码都被压缩成一行，可按照以下步骤排查混淆选项：</p> <ol><li>查看当前模块的oh-package.json5中的dependencies，此字段记录了当前模块的依赖信息。</li><li>在依赖的模块/三方库中的混淆配置文件内检索"-compact"：<ul><li>在本地依赖的library中的consumer-rules.txt文件中检索"-compact"。</li><li>在工程目录下的oh_modules文件夹中，对全部的obfuscation.txt文件检索"-compact"。</li></ul>  </li></ol> <p>从API version 18开始，主模块默认不合并三方库的obfuscation.txt文件中的混淆选项，保留选项仍然有效。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <p>三方库中的consumer-rules.txt不建议配置以下开关选项。这些选项在主模块开启混淆时会生效，可能导致意外的混淆效果，甚至应用运行时崩溃。如果发现三方库的obfuscation.txt文件中包含以下开关选项，建议联系发布该三方库的团队删除这些选项并重新打包发布。</p> <p>-enable-property-obfuscation</p> <p>-enable-string-property-obfuscation</p> <p>-enable-toplevel-obfuscation</p> <p>-remove-log</p> <p>-compact</p>  </div></div></div> </div>  <div class="tiledSection"><h2 id="典型报错案例及解决方案">典型报错案例及解决方案<i class="anchor-icon anchor-icon-link" anchorid="典型报错案例及解决方案" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="报错信息为error-message-cannot-read-property-xxx-of-undefined" class="firsth2">报错信息为：Error message: Cannot read property xxx of undefined<i class="anchor-icon anchor-icon-link" anchorid="报错信息为error-message-cannot-read-property-xxx-of-undefined" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-property-obfuscation</span></li></ol></pre></div></div> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例JSON文件结构（test.json）：</span></li><li><span class="hljs-comment">/*</span></li><li><span class="hljs-comment">{</span></li><li><span class="hljs-comment">  "jsonObj": {</span></li><li><span class="hljs-comment">    "jsonProperty": "value"</span></li><li><span class="hljs-comment">  }</span></li><li><span class="hljs-comment">}</span></li><li><span class="hljs-comment">*/</span></li><li>
</li><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-keyword">import</span> jsonData <span class="hljs-keyword">from</span> <span class="hljs-string">"./testjson"</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> jsonProp = jsonData.<span class="hljs-property">jsonObj</span>.<span class="hljs-property">jsonProperty</span>;</li><li>
</li><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-keyword">import</span> jsonData <span class="hljs-keyword">from</span> <span class="hljs-string">"./test.json"</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> jsonProp = jsonData.<span class="hljs-property">i</span>.<span class="hljs-property">j</span>;</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>开启属性混淆后，源码会被混淆，但json文件不会。源码中通过jsonData.i访问属性时，由于属性名称已经被混淆，json数据中并不存在对应的字段，导致获取的值为undefined。</p> <p><strong>解决方案</strong></p> <p>将json文件中的字段配置到属性白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-keep-property-name</span></li><li>jsonObj</li><li>jsonProperty</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="报错信息为error-message-is-not-callable">报错信息为：Error message: is not callable<i class="anchor-icon anchor-icon-link" anchorid="报错信息为error-message-is-not-callable" tips="复制节点链接"></i></h3><p><strong>场景一：导出namespace中的方法时，该方法定义处被混淆，调用时未被混淆</strong></p> <p><strong>问题现象</strong></p> <p>混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-toplevel-obfuscation</span></li><li><span class="hljs-deletion">-enable-export-obfuscation</span></li></ol></pre></div></div> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-comment">// export.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> NS {</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>) {}</li><li>}</li><li>
</li><li><span class="hljs-comment">// import.ts</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable constant_">NS</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./export'</span>;</li><li>
</li><li><span class="hljs-variable constant_">NS</span>.<span class="hljs-title function_">foo</span>();</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-comment">// export.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">namespace</span> i {</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">j</span>(<span class="hljs-params"></span>) {}</li><li>}</li><li>
</li><li><span class="hljs-comment">// import.ts</span></li><li><span class="hljs-keyword">import</span> { i } <span class="hljs-keyword">from</span> <span class="hljs-string">'./export'</span>;</li><li>
</li><li>i.<span class="hljs-title function_">foo</span>();</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>namespace中的foo属于export元素，当通过NS.foo调用时被视为属性。由于未开启-enable-property-obfuscation选项，导致foo在使用时未被混淆。</p> <p><strong>解决方案</strong></p> <p>方案一：开启-enable-property-obfuscation选项。</p> <p>方案二：使用-keep-global-name选项将namespace中导出的方法配置到白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>-keep-<span class="hljs-keyword">global</span>-name</li><li>foo</li></ol></pre></div></div> <p><strong>场景二：动态导入某个类，类定义处被混淆，调用时未被混淆</strong></p> <p><strong>问题现象</strong></p> <p>混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-toplevel-obfuscation</span></li><li><span class="hljs-deletion">-enable-export-obfuscation</span></li></ol></pre></div></div> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-comment">// utils.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addNum</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">return</span> a + b;</li><li>}</li><li>
</li><li><span class="hljs-comment">// main.ts</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">loadAndUseAdd</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> mathUtils = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">'./utils'</span>);</li><li>    <span class="hljs-keyword">const</span> result = mathUtils.<span class="hljs-title function_">addNum</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failure reason:'</span>, error);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-title function_">loadAndUseAdd</span>();</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-comment">// utils.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">c1</span>(<span class="hljs-params">d1: <span class="hljs-built_in">number</span>, e1: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> d1 + e1;</li><li>}</li><li>
</li><li><span class="hljs-comment">// main.ts</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">i</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>        <span class="hljs-keyword">const</span> a1 = <span class="hljs-keyword">await</span> <span class="hljs-keyword">import</span>(<span class="hljs-string">"@normalized:N&amp;&amp;&amp;entry/src/main/ets/pages/utils&amp;"</span>);</li><li>        <span class="hljs-keyword">const</span> b1 = a1.<span class="hljs-title function_">addNum</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</li><li>    }</li><li>    <span class="hljs-keyword">catch</span> (z) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failure reason:'</span>, z);</li><li>    }</li><li>}</li><li><span class="hljs-title function_">i</span>();</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>函数addNum在定义时位于顶层作用域，但通过.addNum访问时被视为属性。由于未开启-enable-property-obfuscation选项，导致addNum被使用时未进行混淆。</p> <p><strong>解决方案</strong></p> <p>方案一：开启-enable-property-obfuscation选项。</p> <p>方案二：使用-keep-global-name选项将add配置到白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>-keep-global-name</li><li>addNum</li></ol></pre></div></div> <p><strong>场景三：调用so库的方法后导致crash</strong></p> <p><strong>问题现象</strong></p> <p>混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-property-obfuscation</span></li><li><span class="hljs-deletion">-enable-export-obfuscation</span></li></ol></pre></div></div> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/main/cpp/types/libentry/Index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">addNum</span>: <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// example.ets</span></li><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>testNapi.<span class="hljs-title function_">addNum</span>();</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// example.ets</span></li><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">"@normalized:Y&amp;&amp;&amp;libentry.so&amp;"</span>;</li><li>
</li><li>testNapi.<span class="hljs-title function_">m</span>();</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>混淆工具仅支持js/ts/ets代码的混淆。so库中的方法定义在C++侧，因此这些方法在定义处不会被混淆，但在调用处会被混淆。</p> <p><strong>解决方案</strong></p> <p>将so库导出的方法配置到属性白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>-keep-property-name</li><li>addNum</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="报错信息为module1file1-does-not-provide-an-export-name-x-which-is-imported-by-module2file2">报错信息为：'module1/file1' does not provide an export name 'x', which is imported by 'module2/file2'<i class="anchor-icon anchor-icon-link" anchorid="报错信息为module1file1-does-not-provide-an-export-name-x-which-is-imported-by-module2file2" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>主模块和HSP模块的混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-toplevel-obfuscation</span></li><li><span class="hljs-deletion">-enable-export-obfuscation</span></li></ol></pre></div></div> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-comment">// hsp模块</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">addNum</span>(<span class="hljs-params"></span>) {}</li><li>
</li><li><span class="hljs-comment">// entry模块</span></li><li><span class="hljs-keyword">import</span> { addNum } <span class="hljs-keyword">from</span> <span class="hljs-string">'hsp'</span>;</li><li>
</li><li><span class="hljs-title function_">addNum</span>();</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-comment">// hsp模块</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">b</span>(<span class="hljs-params"></span>) {}</li><li>
</li><li><span class="hljs-comment">// entry模块</span></li><li><span class="hljs-keyword">import</span> { n } <span class="hljs-keyword">from</span> <span class="hljs-string">'@normalized:N&amp;myhsp&amp;&amp;myhsp/Index&amp;'</span>;</li><li>
</li><li><span class="hljs-title function_">n</span>();</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>当同时开启-enable-toplevel-obfuscation和-enable-export-obfuscation选项时，主模块与被调用模块的混淆情况如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.10.1.4.1.1" valign="top" width="33.33333333333333%">主模块</th> <th align="left" class="cellrowborder" id="mcps1.3.7.10.1.4.1.2" valign="top" width="33.33333333333333%">依赖模块</th> <th align="left" class="cellrowborder" id="mcps1.3.7.10.1.4.1.3" valign="top" width="33.33333333333333%">导入与导出的名称混淆情况</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">HAP/HSP</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">HSP</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">HSP和主模块是独立编译的，混淆后名称会不一致，因此都需要配置白名单。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">HAP/HSP</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">本地HAR</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">本地HAR与主模块一起编译，混淆后名称一致。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">HAP/HSP</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">三方库</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">三方库中导出的名称及其属性会被收集到白名单，因此导入和导出时都不会被混淆。</td> </tr>  </tbody></table></div> </div> <p>由于HAP和HSP模块是独立编译，因此混淆后导入和导出名称不一致，从而导致HAP引用HSP的方法时报错。</p> <p><strong>解决方案</strong></p> <p>将HSP模块导出的方法配置到-keep-global-name下，并且需要在HSP的consumer-rules.txt和obfuscation-rules.txt文件中都进行对应配置。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>// consumer-rules.txt</li><li>-keep-global-name</li><li>addNum</li><li>
</li><li>// obfuscation-rules.txt</li><li>-keep-global-name</li><li>addNum</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="应用运行后无crash信息但功能异常的情况">应用运行后无crash信息，但功能异常的情况<i class="anchor-icon anchor-icon-link" anchorid="应用运行后无crash信息但功能异常的情况" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="使用recordstring-object作为对象的类型定义时属性被混淆" class="firsth2">使用Record&lt;string, Object&gt;作为对象的类型定义时，属性被混淆<i class="anchor-icon anchor-icon-link" anchorid="使用recordstring-object作为对象的类型定义时属性被混淆" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>parameters的类型为Record&lt;string, Object&gt;。开启属性混淆后，parameters对象中的linkSource属性被混淆，导致功能异常。</p> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">petalMapWant</span>: <span class="hljs-title class_">Want</span> = {</li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>,</li><li>  <span class="hljs-attr">uri</span>: <span class="hljs-string">'maps://'</span>,</li><li>  <span class="hljs-attr">parameters</span>: {</li><li>    <span class="hljs-attr">linkSource</span>: <span class="hljs-string">'com.other.app'</span></li><li>  }</li><li>}</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"@ohos:app.ability.Want"</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">petalMapWant</span>: <span class="hljs-title class_">Want</span> = {</li><li>    <span class="hljs-attr">bundleName</span>: <span class="hljs-string">'com.example.myapplication'</span>,</li><li>    <span class="hljs-attr">uri</span>: <span class="hljs-string">'maps://'</span>,</li><li>    <span class="hljs-attr">parameters</span>: {</li><li>        <span class="hljs-attr">i</span>: <span class="hljs-string">'com.other.app'</span></li><li>    }</li><li>};</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>示例中parameters的类型为Record&lt;string, Object&gt;，这仅表示以字符串为键的对象的泛型定义，未详细描述其内部属性。因此，混淆工具无法识别对象内部哪些属性不应被混淆，导致linkSource被混淆后，引发功能异常。</p> <p><strong>解决方案</strong></p> <p>将混淆后会出现问题的属性名配置到属性白名单中，示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-keep-property-name</span></li><li>linkSource</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="跨文件调用某属性该属性在一个文件中保留在另一个文件中被混淆">跨文件调用某属性，该属性在一个文件中保留，在另一个文件中被混淆<i class="anchor-icon anchor-icon-link" anchorid="跨文件调用某属性该属性在一个文件中保留在另一个文件中被混淆" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>混淆规则配置如下所示：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-enable-property-obfuscation</span></li><li><span class="hljs-deletion">-keep</span></li><li>./file1.ts</li></ol></pre></div></div> <p>在file2.ts中导入file1.ts的接口。该接口包含一个对象类型的属性。此对象属性在file1.ts中被保留，但在file2.ts中被混淆，导致调用时出现功能异常。</p> <p>示例代码如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-comment">// file1.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInfo</span> {</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">address</span>: {</li><li>    <span class="hljs-attr">city1</span>: <span class="hljs-built_in">string</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// file2.ts</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./file1'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">MyInfo</span> = {</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,</li><li>  <span class="hljs-attr">address</span>: {</li><li>    <span class="hljs-attr">city1</span>: <span class="hljs-string">"shanghai"</span></li><li>  }</li><li>}</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-comment">// file1.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInfo</span> {</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">address</span>: {</li><li>    <span class="hljs-attr">city1</span>: <span class="hljs-built_in">string</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// file2.ts</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">MyInfo</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./file1'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">person</span>: <span class="hljs-title class_">MyInfo</span> = {</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-number">20</span>,</li><li>  <span class="hljs-attr">address</span>: {</li><li>    <span class="hljs-attr">i</span>: <span class="hljs-string">"shanghai"</span></li><li>  }</li><li>}</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>使用-keep选项保留file1.ts文件时，该文件中的代码不会被混淆。导出属性（如address）所属类型内的属性不会自动加入白名单，因此在其他文件中使用时会被混淆。</p> <p><strong>解决方案</strong></p> <p>方案一：使用interface定义该属性的类型，并使用export进行导出，这样该属性将被自动加入到属性白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// file1.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AddressType</span> {</li><li>  <span class="hljs-attr">city1</span>: <span class="hljs-built_in">string</span>;</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyInfo</span> {</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">address</span>: <span class="hljs-title class_">AddressType</span>;</li><li>}</li></ol></pre></div></div> <p>方案二：使用-keep-property-name选项，将未直接导出的类型内的属性配置到属性白名单中。示例如下：</p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-keep-property-name</span></li><li>city1</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="未开启-enable-string-property-obfuscation字符串字面量属性名却被混淆">未开启-enable-string-property-obfuscation，字符串字面量属性名却被混淆<i class="anchor-icon anchor-icon-link" anchorid="未开启-enable-string-property-obfuscation字符串字面量属性名却被混淆" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆前</span></li><li><span class="hljs-keyword">const</span> person = {</li><li>  <span class="hljs-attr">myAge</span>: <span class="hljs-number">18</span></li><li>}</li><li>person[<span class="hljs-string">"myAge"</span>] = <span class="hljs-number">20</span>;</li></ol></pre></div></div> <div _ngcontent-vvc-c106="" class="highlight-div"><div _ngcontent-vvc-c106="" class="highlight-div-header"><div _ngcontent-vvc-c106="" class="highlight-div-header-left"><div _ngcontent-vvc-c106="" class="handle-button expand-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vvc-c106="" class="highlight-div-header-right"><div _ngcontent-vvc-c106="" class="handle-button ai-button"></div><div _ngcontent-vvc-c106="" class="handle-button line-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vvc-c106="" class="handle-button theme-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vvc-c106="" class="handle-button copy-button"><div _ngcontent-vvc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vvc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 混淆后</span></li><li><span class="hljs-keyword">const</span> person = {</li><li>  <span class="hljs-attr">myAge</span>: <span class="hljs-number">18</span></li><li>}</li><li>person[<span class="hljs-string">"m"</span>] = <span class="hljs-number">20</span>;</li></ol></pre></div></div> <p><strong>问题原因</strong></p> <p>主模块所依赖的其他模块中的consumer-rules.txt文件配置了-enable-string-property-obfuscation选项，主模块会合并该选项，导致字符串字面量属性名被混淆。</p> <p><strong>解决方案</strong></p> <p>从API version 18开始，主模块默认不会被三方库的混淆规则所影响，因此不会有这种情况。但如果API version低于18，可参考以下两种解决方案。</p> <p>方案一：确认依赖的远程HAR包的obfuscation.txt文件中是否配置了-enable-string-property-obfuscation选项。若配置了则会影响主模块，需将其关闭。参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/source-obfuscation-questions#排查非预期的混淆能力">排查非预期的混淆能力</a>。</p> <p>方案二：若工程复杂无法找到配置了该混淆选项的远程HAR包，可以将属性名直接配置到白名单中。</p> </div>  <div class="tiledSection"><h3 id="数据库相关的字段被混淆后导致功能异常">数据库相关的字段被混淆后导致功能异常<i class="anchor-icon anchor-icon-link" anchorid="数据库相关的字段被混淆后导致功能异常" tips="复制节点链接"></i></h3><p><strong>问题现象</strong></p> <p>Hilog日志中报错信息为：table Account has no column named a23 in 'INSERT INTO Account(a23)'。</p> <p><strong>问题原因</strong></p> <p>混淆时代码中的SQL语句字段名称被混淆，但数据库中字段为原始名称，从而导致报错。</p> <p><strong>解决方案</strong></p> <p>使用-keep-property-name选项将使用到的数据库字段配置到白名单。</p> </div> </div> <div></div></div>