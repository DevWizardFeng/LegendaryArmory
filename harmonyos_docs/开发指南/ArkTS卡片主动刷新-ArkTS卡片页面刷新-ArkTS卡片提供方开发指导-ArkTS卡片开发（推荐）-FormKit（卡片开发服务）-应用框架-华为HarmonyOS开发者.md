<h1 _ngcontent-bfb-c119="" class="doc-title ng-star-inserted" title="ArkTS卡片主动刷新"> ArkTS卡片主动刷新 </h1>

<div _ngcontent-bfb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本文主要提供主动刷新的开发指导，刷新流程请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-ui-widget-interaction-overview#主动刷新">主动刷新概述</a>。</p>    <div class="tiledSection">     <h2 id="卡片提供方主动刷新卡片内容">卡片提供方主动刷新卡片内容<i class="anchor-icon anchor-icon-link" anchorid="卡片提供方主动刷新卡片内容" tips="复制节点链接"></i></h2>          <p>卡片提供方可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formprovider#formproviderupdateform" target="_blank">updateForm</a>接口进行主动刷新。推荐与卡片生命周期回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonformevent" target="_blank">onFormEvent</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonupdateform" target="_blank">onUpdateForm</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability#formextensionabilityonaddform" target="_blank">onAddForm</a>接口搭配使用。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <p>下面给出一个示例，实现如下功能：卡片添加至桌面后，点击卡片上的刷新按钮，刷新卡片信息。</p>     <ol>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-ui-widget-creation">创建卡片</a>。</p></li>      <li>       <p>实现卡片布局，在卡片上添加一个刷新按钮，点击按钮后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-postcardaction#postcardaction-1" target="_blank">postCardAction</a>接口，触发onFormEvent回调。</p>       <div _ngcontent-bfb-c106="" class="highlight-div"><div _ngcontent-bfb-c106="" class="highlight-div-header"><div _ngcontent-bfb-c106="" class="highlight-div-header-left"><div _ngcontent-bfb-c106="" class="handle-button expand-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bfb-c106="" class="highlight-div-header-right"><div _ngcontent-bfb-c106="" class="handle-button ai-button"></div><div _ngcontent-bfb-c106="" class="handle-button line-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bfb-c106="" class="handle-button theme-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bfb-c106="" class="handle-button copy-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/updatebymessage/pages/UpdateByMessageCard.ets</span></li><li><span class="hljs-keyword">let</span> storageUpdateByMsg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storageUpdateByMsg)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">UpdateByMessageCard</span> {</li><li>  <span class="hljs-comment">// 创建两个待刷新的Text，Text初始内容分别为'Title default'、'Description default'。资源文件定义请参见下方步骤4</span></li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'title'</span>) <span class="hljs-attr">title</span>: <span class="hljs-title class_">ResourceStr</span> = $r(<span class="hljs-string">'app.string.default_title'</span>);</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'detail'</span>) <span class="hljs-attr">detail</span>: <span class="hljs-title class_">ResourceStr</span> = $r(<span class="hljs-string">'app.string.DescriptionDefault'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">title</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.9</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'8%'</span>, <span class="hljs-attr">left</span>: <span class="hljs-string">'10%'</span> })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">detail</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>          .<span class="hljs-title function_">opacity</span>(<span class="hljs-number">0.6</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'5%'</span>, <span class="hljs-attr">left</span>: <span class="hljs-string">'10%'</span> })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-comment">// 添加一个按钮，资源文件定义请参见下方步骤4</span></li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>($r(<span class="hljs-string">'app.string.update'</span>))</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#45A6F4'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">120</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">32</span>)</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-string">'30%'</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-string">'10%'</span> })</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFF'</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-title function_">postCardAction</span>(<span class="hljs-variable language_">this</span>, {</li><li>            <span class="hljs-attr">action</span>: <span class="hljs-string">'message'</span>,</li><li>            <span class="hljs-attr">params</span>: { <span class="hljs-attr">msgTest</span>: <span class="hljs-string">'messageEvent'</span> }</li><li>          });</li><li>        })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Start</span>)</li><li>    .<span class="hljs-title function_">backgroundImage</span>($r(<span class="hljs-string">'app.media.CardEvent'</span>))</li><li>    .<span class="hljs-title function_">backgroundImageSize</span>(<span class="hljs-title class_">ImageSize</span>.<span class="hljs-property">Cover</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在onFormEvent回调函数的实现中，通过updateForm接口刷新卡片数据。</p>       <div _ngcontent-bfb-c106="" class="highlight-div"><div _ngcontent-bfb-c106="" class="highlight-div-header"><div _ngcontent-bfb-c106="" class="highlight-div-header-left"><div _ngcontent-bfb-c106="" class="handle-button expand-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bfb-c106="" class="highlight-div-header-right"><div _ngcontent-bfb-c106="" class="handle-button ai-button"></div><div _ngcontent-bfb-c106="" class="handle-button line-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bfb-c106="" class="handle-button theme-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bfb-c106="" class="handle-button copy-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/entryformability/EntryFormAbility.ts</span></li><li><span class="hljs-keyword">import</span> { formBindingData, <span class="hljs-title class_">FormExtensionAbility</span>, formInfo, formProvider } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'EntryFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onAddForm</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formBindingData.<span class="hljs-property">FormBindingData</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onAddForm'</span>);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, want.<span class="hljs-property">parameters</span>?.[formInfo.<span class="hljs-property">FormParam</span>.<span class="hljs-property">NAME_KEY</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formData</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = { };</li><li>    <span class="hljs-keyword">return</span> formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onCastToNormalForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onCastToNormalForm'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onUpdateForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onUpdateForm'</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onChangeFormVisibility</span>(<span class="hljs-attr">newStatus</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onChangeFormVisibility'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onFormEvent</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`FormAbility onFormEvent, formId = <span class="hljs-subst">${formId}</span>, message: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(message)}</span>`</span>);</li><li>    <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormDataClass</span> {</li><li>      <span class="hljs-comment">// 定义Text刷新后的内容，分别为'Title Update'、'Description update success'</span></li><li>      <span class="hljs-attr">title</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Title Update.'</span>;</li><li>      <span class="hljs-attr">detail</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Description update success.'</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> formData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormDataClass</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(formData);</li><li>    formProvider.<span class="hljs-title function_">updateForm</span>(formId, formInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'FormAbility updateForm success.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`Operation updateForm failed. Cause: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onRemoveForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onRemoveForm'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-params">config: Configuration</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onConfigurationUpdate:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(config));</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onAcquireFormState</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formInfo.<span class="hljs-property">FormState</span> {</li><li>    <span class="hljs-keyword">return</span> formInfo.<span class="hljs-property">FormState</span>.<span class="hljs-property">READY</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>资源文件如下。</p>       <div _ngcontent-bfb-c106="" class="highlight-div"><div _ngcontent-bfb-c106="" class="highlight-div-header"><div _ngcontent-bfb-c106="" class="highlight-div-header-left"><div _ngcontent-bfb-c106="" class="handle-button expand-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bfb-c106="" class="highlight-div-header-right"><div _ngcontent-bfb-c106="" class="handle-button ai-button"></div><div _ngcontent-bfb-c106="" class="handle-button line-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bfb-c106="" class="handle-button theme-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bfb-c106="" class="handle-button copy-button"><div _ngcontent-bfb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bfb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/resources/zh_CN/element/string.json</span></li><li>{</li><li>  <span class="hljs-string">"string"</span>: [</li><li>    <span class="hljs-comment">// ...</span></li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"default_title"</span>,</li><li>      <span class="hljs-string">"value"</span>: <span class="hljs-string">"Title default."</span></li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"DescriptionDefault"</span>,</li><li>      <span class="hljs-string">"value"</span>: <span class="hljs-string">"Description default."</span></li><li>    },</li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"update"</span>,</li><li>      <span class="hljs-string">"value"</span>: <span class="hljs-string">"刷新"</span></li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="运行结果">运行结果<i class="anchor-icon anchor-icon-link" anchorid="运行结果" tips="复制节点链接"></i></h3>          <p><span><img originheight="842" originwidth="406" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114918.79098549936083872430039672974712:50001231000000:2800:0F8923DBBBE9865C2EC388CD8051EBAF4A921EFBF3C8DA7FED07EEC7B86B16FF.gif" width="406" height="842"></span></p>    </div>   </div>   <div></div></div>