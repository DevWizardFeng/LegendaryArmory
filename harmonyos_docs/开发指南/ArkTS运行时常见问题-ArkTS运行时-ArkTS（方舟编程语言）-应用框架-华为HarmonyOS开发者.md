<h1 _ngcontent-owt-c119="" class="doc-title ng-star-inserted" title="ArkTS运行时常见问题"> ArkTS运行时常见问题 </h1>

<div _ngcontent-owt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="方舟正则运算与预期输出结果不一致场景">方舟正则运算与预期输出结果不一致场景<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算与预期输出结果不一致场景" tips="复制节点链接"></i></h2>          <p>如果使用方舟正则运算时结果与期望不符，请检查以下场景。</p>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算对于b处理与预期不一致" class="firsth2">方舟正则运算对于\b处理与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算对于b处理与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> str = <span class="hljs-string">"\u2642"</span>;</li><li><span class="hljs-keyword">let</span> res = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/\b/g</span>, <span class="hljs-string">"/"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"res = "</span> + res);</li><li><span class="hljs-comment">// 期望输出: res = ♂</span></li><li><span class="hljs-comment">// 实际输出: res = /♂/</span></li></ol></pre></div></div>     <p>规避方案：暂无。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>正则匹配\b（单词边界）遇到某些ASCII编码之外的字符时，会将其当成ASCII字符来处理，从而将不是单词边界匹配识别成单词边界。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算对于先行断言pattern或pattern-嵌套在后行断言pattern或pattern内部的场景与预期不一致">方舟正则运算对于先行断言((?=pattern)或(?!pattern)) 嵌套在后行断言((?&lt;=pattern)或(?&lt;!pattern))内部的场景与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算对于先行断言pattern或pattern-嵌套在后行断言pattern或pattern内部的场景与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`res:<span class="hljs-subst">${<span class="hljs-string">"abcdef"</span>.match(/(?&lt;=ab(?=c)cd)ef/)}</span>`</span>);</li><li><span class="hljs-comment">// 期望输出: res:ef</span></li><li><span class="hljs-comment">// 实际输出: res:null</span></li></ol></pre></div></div>     <p>规避方案：使用/(?&lt;=abcd)ef/代替/(?&lt;=ab(?=c)cd)ef/。</p>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算对于大小写的处理与预期不一致">方舟正则运算对于大小写的处理与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算对于大小写的处理与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> res = <span class="hljs-regexp">/\u{10400}/ui</span>.<span class="hljs-title function_">test</span>(<span class="hljs-string">"\u{10428}"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"res = "</span> + res);</li><li><span class="hljs-comment">// 期望输出: res = true</span></li><li><span class="hljs-comment">// 实际输出: res = false</span></li></ol></pre></div></div>     <p>规避方案：暂无。</p>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算ug匹配时lastindex与预期不一致">方舟正则运算/()/ug匹配时lastIndex与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算ug匹配时lastindex与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> L = <span class="hljs-string">"\ud800"</span>;</li><li><span class="hljs-keyword">let</span> T = <span class="hljs-string">"\udc00"</span>;</li><li><span class="hljs-keyword">let</span> u = <span class="hljs-regexp">/()/ug</span>;</li><li>u.<span class="hljs-property">lastIndex</span> = <span class="hljs-number">1</span>;</li><li>u.<span class="hljs-title function_">exec</span>(L + T + L + T);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"u.lastIndex = "</span> + u.<span class="hljs-property">lastIndex</span>);</li><li><span class="hljs-comment">// 期望输出: u.lastIndex = 0</span></li><li><span class="hljs-comment">// 实际输出: u.lastIndex = 1</span></li></ol></pre></div></div>     <p>规避方案：暂无。</p>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算内部使用-与预期不一致">方舟正则运算[]内部使用'-'与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算内部使用-与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> str =  <span class="hljs-string">"a-b"</span>;</li><li><span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/[+-\s]/</span>;</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reg.exec(str) = "</span> + reg.<span class="hljs-title function_">exec</span>(str));</li><li><span class="hljs-comment">// 期望输出: reg.exec(str) = -</span></li><li><span class="hljs-comment">// 实际输出: reg.exec(str) = null</span></li></ol></pre></div></div>     <p>规避方案：使用转义后的"-"。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> str =  <span class="hljs-string">"a-b"</span>;</li><li><span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/[+\-\s]/</span>;</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"reg.exec(str) = "</span> + reg.<span class="hljs-title function_">exec</span>(str));</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="方舟正则运算具名捕获组获取与预期不一致">方舟正则运算具名捕获组获取与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则运算具名捕获组获取与预期不一致" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> reg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">"(a)(?&lt;b&gt;b)"</span>);</li><li><span class="hljs-keyword">let</span> res = reg.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"ab"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"JSON.stringify(res?.groups) = "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res?.<span class="hljs-property">groups</span>));</li><li><span class="hljs-comment">// 期望输出: JSON.stringify(res?.groups) = {"b":"b"}</span></li><li><span class="hljs-comment">// 实际输出: JSON.stringify(res?.groups) = {"b":"a"}</span></li></ol></pre></div></div>     <p>规避方案：计算具名捕获组位置获取具名捕获组匹配的内容。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> reg = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RegExp</span>(<span class="hljs-string">"(a)(?&lt;b&gt;b)"</span>);</li><li><span class="hljs-keyword">let</span> res = reg.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"ab"</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;;</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"JSON.stringify(res?.groups) = {\"b\":"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res[<span class="hljs-number">2</span>]) + <span class="hljs-string">"}"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="方舟正则匹配使用与预期不一致">方舟正则匹配使用'|'与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟正则匹配使用与预期不一致" tips="复制节点链接"></i></h3>          <p>在使用正则匹配时，如果'|'前是一个空匹配，会导致'|'后的匹配不成功。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> reg = <span class="hljs-regexp">/a(?:|x)$/</span>;</li><li><span class="hljs-keyword">let</span> res = reg.<span class="hljs-title function_">exec</span>(<span class="hljs-string">"ax"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"JSON.stringify(res) = "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(res));</li><li><span class="hljs-comment">// 期望输出: JSON.stringify(res) = ["ax"]</span></li><li><span class="hljs-comment">// 实际输出: JSON.stringify(res) = null</span></li></ol></pre></div></div>     <p>规避方案：使用reg2或reg3替换reg1。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> reg1 = <span class="hljs-regexp">/a(?:|x)$/</span>;</li><li><span class="hljs-keyword">let</span> reg2 = <span class="hljs-regexp">/a(?:x)?$/</span>;</li><li><span class="hljs-keyword">let</span> reg3 = <span class="hljs-regexp">/a(?:x){0,1}$/</span>;</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="方舟字符串-replace-接口对于第一个参数为空字符串的场景与预期不一致">方舟字符串 replace 接口对于第一个参数为空字符串的场景与预期不一致<i class="anchor-icon anchor-icon-link" anchorid="方舟字符串-replace-接口对于第一个参数为空字符串的场景与预期不一致" tips="复制节点链接"></i></h3>          <p>在使用字符串replace接口时，如果第一个参数是空字符串，则直接返回原始字符串。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> str = <span class="hljs-string">"dddd"</span></li><li><span class="hljs-keyword">let</span> res = str.<span class="hljs-title function_">replace</span>(<span class="hljs-string">""</span>, <span class="hljs-string">"abc"</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"res = "</span> + res);</li><li><span class="hljs-comment">// 期望输出: res = abcdddd</span></li><li><span class="hljs-comment">// 实际输出: res = dddd</span></li></ol></pre></div></div>     <p>规避方案：使用正则表达式 /^/ 表示字符串起始符，作为第一个参数。</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> str = <span class="hljs-string">"dddd"</span></li><li><span class="hljs-keyword">let</span> res = str.<span class="hljs-title function_">replace</span>(<span class="hljs-regexp">/^/</span>, <span class="hljs-string">"abc"</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="async函数内部异常的处理机制">Async函数内部异常的处理机制<i class="anchor-icon anchor-icon-link" anchorid="async函数内部异常的处理机制" tips="复制节点链接"></i></h2>          <p><strong>场景</strong></p>     <p>如果在Async函数内部产生了异常，且没有使用catch捕获该异常，在ArkTS中不会导致进程退出。其本质是Async函数返回了一个rejected状态的Promise对象，没有被处理，使得Promise的rejected状态没有被捕获。Async函数内部的异常会变成 unhandledRejection，表现为异常未抛出。</p>     <p><strong>Async函数内部异常的捕获方式</strong></p>     <ol>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-errormanager#errormanageronerror" target="_blank">errorManager.on()</a>捕获到Async函数产生的unhandledrejection事件，再通过编写errorManager.on()注册的回调函数，来进行异常处理操作。</p>       <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>   errorManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">"unhandledRejection"</span>, <span class="hljs-function">(<span class="hljs-params">a:ESObject, b:<span class="hljs-built_in">Promise</span>&lt;ESObject&gt;</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Async test"</span>, a);</li><li>   })</li></ol></pre></div></div></li>      <li>       <p>在Async函数内部，针对可能发生异常的代码块添加try-catch逻辑，直接捕获可能出现的异常。</p></li>     </ol>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>注意必须在Async函数内部，外部无法捕获Async函数内部的异常，外部只能通过errorManager.on()监听。</p>      </div></div></div>     <p><strong>查看Async函数内部是否有异常的方式</strong></p>     <p>若开发者仅需要查看Async函数内部是否产生异常，首先需要在DevEco Studio终端执行以下hilog命令开启debug级别日志打印：</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>   hilog -b D</li></ol></pre></div></div>     <p>然后点击DevEco Studio下方HiLog选项卡，输入过滤条件“Throw error:”，即可查看到Async函数内产生的异常信息。</p>     <p><span><img originheight="660" originwidth="1270" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114737.79370474913774080358821021995337:50001231000000:2800:61E67DC51792A5E1BEF0E6374B7B4FA9404AE43D44E60C8D4CEE1FB14943D026.png" width="920" height="478.1102362204725"></span></p>    </div>    <div class="tiledSection">     <h2 id="方舟arrayflatmap接口常见问题">方舟Array.flatMap()接口常见问题<i class="anchor-icon anchor-icon-link" anchorid="方舟arrayflatmap接口常见问题" tips="复制节点链接"></i></h2>          <p>Array.flatMap()接口在处理包含Proxy的Array时，未正确展平嵌套的Proxy Array，导致返回结果与预期不一致。</p>    </div>    <div class="tiledSection">     <h3 id="arkts使用场景" class="firsth2">ArkTS使用场景<i class="anchor-icon anchor-icon-link" anchorid="arkts使用场景" tips="复制节点链接"></i></h3>          <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> arr1 = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>];</li><li><span class="hljs-keyword">let</span> arr2 = [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li><span class="hljs-keyword">const</span> emptyHandler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">ProxyHandler</span>&lt;<span class="hljs-built_in">number</span>[]&gt;;</li><li><span class="hljs-keyword">let</span> proxy1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(arr1, emptyHandler);</li><li><span class="hljs-keyword">let</span> proxy2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Proxy</span>(arr2, emptyHandler);</li><li><span class="hljs-keyword">let</span> arr3 = [proxy1, proxy2];</li><li><span class="hljs-keyword">let</span> res = arr3.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x);</li><li>
</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"res length:"</span>, res.<span class="hljs-property">length</span>.<span class="hljs-title function_">toString</span>());</li><li><span class="hljs-comment">// 期望输出: res length: 4</span></li><li><span class="hljs-comment">// 实际输出: res length: 2</span></li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"res[0] is: "</span>, res[<span class="hljs-number">0</span>].<span class="hljs-title function_">toString</span>());</li><li><span class="hljs-comment">// 期望输出: res[0] is: 0</span></li><li><span class="hljs-comment">// 实际输出: res[0] is: 0,1</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="arkui使用场景">ArkUI使用场景<i class="anchor-icon anchor-icon-link" anchorid="arkui使用场景" tips="复制节点链接"></i></h3>          <p>ArkUI状态管理框架会为使用状态变量装饰器（如@State、@Trace、@Local）装饰的Array添加一层代理，用于观测API调用产生的变化。如果状态修饰器与Array组合，并且调用Array.flatMap，会出现如下问题。</p>     <p>以状态管理V2为例：</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>   <span class="hljs-meta">@Local</span> <span class="hljs-attr">p</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>];</li><li>   <span class="hljs-meta">@Local</span> <span class="hljs-attr">q</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li>   <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span>[][] = [<span class="hljs-variable language_">this</span>.<span class="hljs-property">p</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">q</span>];</li><li>   <span class="hljs-attr">d</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>
</li><li>   <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">d</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">c</span>.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">it</span> =&gt;</span> it);</li><li>   }</li><li>
</li><li>   <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>         <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.d[<span class="hljs-number">0</span>]}</span>`</span>); <span class="hljs-comment">// 预期显示：0; 实际显示：0,1</span></li><li>      }</li><li>   }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="arrayflatmap规避方案">Array.flatMap规避方案<i class="anchor-icon anchor-icon-link" anchorid="arrayflatmap规避方案" tips="复制节点链接"></i></h3>          <p>避免使用Array.flatMap()接口，改为调用Array.map()接口后再调用深度为1的Array.flat()接口。以上文ArkTS使用场景为例：</p>     <div _ngcontent-owt-c106="" class="highlight-div"><div _ngcontent-owt-c106="" class="highlight-div-header"><div _ngcontent-owt-c106="" class="highlight-div-header-left"><div _ngcontent-owt-c106="" class="handle-button expand-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owt-c106="" class="highlight-div-header-right"><div _ngcontent-owt-c106="" class="handle-button ai-button"></div><div _ngcontent-owt-c106="" class="handle-button line-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owt-c106="" class="handle-button theme-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owt-c106="" class="handle-button copy-button"><div _ngcontent-owt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owt-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 使用规避方案前</span></li><li><span class="hljs-keyword">let</span> res = arr3.<span class="hljs-title function_">flatMap</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x);</li><li><span class="hljs-comment">// 使用规避方案后</span></li><li><span class="hljs-keyword">let</span> res = arr3.<span class="hljs-title function_">map</span>(<span class="hljs-function"><span class="hljs-params">x</span> =&gt;</span> x).<span class="hljs-title function_">flat</span>();</li></ol></pre></div></div>    </div>   </div>   <div></div></div>