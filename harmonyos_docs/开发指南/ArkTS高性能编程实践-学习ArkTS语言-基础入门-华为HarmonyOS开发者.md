<h1 _ngcontent-fmm-c119="" class="doc-title ng-star-inserted" title="ArkTS高性能编程实践"> ArkTS高性能编程实践 </h1>

<div _ngcontent-fmm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>本文提供应用性能敏感场景下的高性能编程建议，帮助开发者编写高性能应用。高性能编程实践是在开发过程中总结的一些高性能写法和建议。在实现业务功能时，应同步思考并理解高性能写法的原理，并将其应用于代码逻辑中。关于ArkTS编程规范，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-coding-style-guide">ArkTS编程规范</a>。</p> </div>  <div class="tiledSection"><h2 id="声明与表达式">声明与表达式<i class="anchor-icon anchor-icon-link" anchorid="声明与表达式" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="使用const声明不变的变量" class="firsth2">使用const声明不变的变量<i class="anchor-icon anchor-icon-link" anchorid="使用const声明不变的变量" tips="复制节点链接"></i></h3><p>不变的变量推荐使用const声明。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> index = <span class="hljs-number">10000</span>; <span class="hljs-comment">// 该变量在后续过程中未发生改变，建议声明成常量</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="number类型变量避免整型和浮点型混用">number类型变量避免整型和浮点型混用<i class="anchor-icon anchor-icon-link" anchorid="number类型变量避免整型和浮点型混用" tips="复制节点链接"></i></h3><p>针对number类型，运行时在优化时会区分整型和浮点型数据。建议避免在初始化后改变数据类型。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> intNum = <span class="hljs-number">1</span>;</li><li>intNum = <span class="hljs-number">1.1</span>;  <span class="hljs-comment">// 该变量在声明时为整型数据，建议后续不要赋值浮点型数据</span></li><li>
</li><li><span class="hljs-keyword">let</span> doubleNum = <span class="hljs-number">1.1</span>;</li><li>doubleNum = <span class="hljs-number">1</span>;  <span class="hljs-comment">// 该变量在声明时为浮点型数据，建议后续不要赋值整型数据</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="数值计算避免溢出">数值计算避免溢出<i class="anchor-icon anchor-icon-link" anchorid="数值计算避免溢出" tips="复制节点链接"></i></h3><p>常见的可能导致溢出的数值计算包括如下场景，溢出之后，会导致引擎走入慢速的溢出逻辑分支处理，影响后续的性能。</p> <ul><li><p>针对加法、减法、乘法、指数运算等运算操作，应避免数值大于INT32_MAX（2147483647）或小于INT32_MIN（-2147483648）。</p>  </li><li><p>针对&amp;（and）、&gt;&gt;&gt;（无符号右移）等运算操作，应避免数值大于INT32_MAX。</p>  </li></ul> </div>  <div class="tiledSection"><h3 id="循环中常量提取减少属性访问次数">循环中常量提取，减少属性访问次数<i class="anchor-icon anchor-icon-link" anchorid="循环中常量提取减少属性访问次数" tips="复制节点链接"></i></h3><p>如果常量在循环中不会改变，可以将其提取到循环外部，减少访问次数。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Time</span> {</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">start</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">info</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>];</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getNum</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">348</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0x8000</span>; index &gt; <span class="hljs-number">0x8</span>; index &gt;&gt;= <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-comment">// 此处会多次对Time的info及start进行查找，并且每次查找出来的值是相同的</span></li><li>    total += ((<span class="hljs-title class_">Time</span>.<span class="hljs-property">info</span>[num - <span class="hljs-title class_">Time</span>.<span class="hljs-property">start</span>] &amp; index) !== <span class="hljs-number">0</span>) ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> total;</li><li>}</li></ol></pre></div></div> <p>优化后的代码如下，可以将Time.info[num - Time.start]提取为常量，这样可以显著减少属性访问次数，提升性能。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Time</span> {</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">start</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-attr">info</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>, <span class="hljs-number">9</span>, <span class="hljs-number">10</span>, <span class="hljs-number">11</span>, <span class="hljs-number">12</span>];</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getNum</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">total</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">348</span>;</li><li>  <span class="hljs-keyword">const</span> info = <span class="hljs-title class_">Time</span>.<span class="hljs-property">info</span>[num - <span class="hljs-title class_">Time</span>.<span class="hljs-property">start</span>];  <span class="hljs-comment">// 从循环中提取不变量</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0x8000</span>; index &gt; <span class="hljs-number">0x8</span>; index &gt;&gt;= <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">if</span> ((info &amp; index) != <span class="hljs-number">0</span>) {</li><li>      total++;</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">return</span> total;</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="函数">函数<i class="anchor-icon anchor-icon-link" anchorid="函数" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="建议使用参数传递函数外的变量" class="firsth2">建议使用参数传递函数外的变量<i class="anchor-icon anchor-icon-link" anchorid="建议使用参数传递函数外的变量" tips="复制节点链接"></i></h3><p>使用闭包会造成额外的开销。在性能敏感场景中，建议使用参数传递函数外的变量替代。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>];</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">return</span> arr[<span class="hljs-number">0</span>] + arr[<span class="hljs-number">1</span>];</li><li>}</li><li>
</li><li><span class="hljs-title function_">foo</span>();</li></ol></pre></div></div> <p>建议使用参数传递函数外部的变量，以替代使用闭包。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>];</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">foo</span>(<span class="hljs-params">array: <span class="hljs-built_in">number</span>[]</span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">return</span> array[<span class="hljs-number">0</span>] + array[<span class="hljs-number">1</span>];</li><li>}</li><li>
</li><li><span class="hljs-title function_">foo</span>(arr);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="避免使用可选参数">避免使用可选参数<i class="anchor-icon anchor-icon-link" anchorid="避免使用可选参数" tips="复制节点链接"></i></h3><p>函数的可选参数表示参数可能为undefined，在函数内部使用该参数时，需要进行非空值的判断，造成额外的开销。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">left?: <span class="hljs-built_in">number</span>, right?: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">if</span> (left != <span class="hljs-literal">undefined</span> &amp;&amp; right != <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span> left + right;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div> <p>根据业务需求，将函数参数声明为必选参数。考虑使用默认参数。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">left: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>, right: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">return</span> left + right;</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="数组">数组<i class="anchor-icon anchor-icon-link" anchorid="数组" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="数值数组推荐使用typedarray" class="firsth2">数值数组推荐使用TypedArray<i class="anchor-icon anchor-icon-link" anchorid="数值数组推荐使用typedarray" tips="复制节点链接"></i></h3><p>涉及纯数值计算时，推荐使用TypedArray数据结构。</p> <p>优化前的代码示例：</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> arr1 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</li><li><span class="hljs-keyword">const</span> arr2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>);</li><li><span class="hljs-keyword">let</span> res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">3</span>);</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {</li><li>  res[i] = arr1[i] + arr2[i];</li><li>}</li></ol></pre></div></div> <p>优化后的代码示例：</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> typedArray1 = <span class="hljs-title class_">Int8Array</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);</li><li><span class="hljs-keyword">const</span> typedArray2 = <span class="hljs-title class_">Int8Array</span>.<span class="hljs-title function_">from</span>([<span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>]);</li><li><span class="hljs-keyword">let</span> res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(<span class="hljs-number">3</span>);</li><li><span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">3</span>; i++) {</li><li>  res[i] = typedArray1[i] + typedArray2[i];</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="避免使用稀疏数组">避免使用稀疏数组<i class="anchor-icon anchor-icon-link" anchorid="避免使用稀疏数组" tips="复制节点链接"></i></h3><p>运行时在分配超过1024大小的数组或稀疏数组时，会采用hash表来存储元素。在该模式下，访问数组元素速度较慢。代码开发时应避免数组变成稀疏数组。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 直接分配100000大小的数组，运行时会处理成用hash表来存储元素</span></li><li><span class="hljs-keyword">let</span> count = <span class="hljs-number">100000</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(count);</li><li>
</li><li><span class="hljs-comment">// 创建数组后，直接在9999处赋值，会变成稀疏数组</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: <span class="hljs-built_in">number</span>[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>result[<span class="hljs-number">9999</span>] = <span class="hljs-number">0</span>;</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="避免使用联合类型数组">避免使用联合类型数组<i class="anchor-icon anchor-icon-link" anchorid="避免使用联合类型数组" tips="复制节点链接"></i></h3><p>避免使用联合类型数组。避免在数值数组中混合使用整型数据和浮点型数据。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrNum</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">1.1</span>, <span class="hljs-number">2</span>];  <span class="hljs-comment">// 数值数组中混合使用整型数据和浮点型数据</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrUnion</span>: (<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>)[] = [<span class="hljs-number">1</span>, <span class="hljs-string">'hello'</span>];  <span class="hljs-comment">// 联合类型数组</span></li></ol></pre></div></div> <p>根据业务需求，将相同类型的数据放在同一数组中。</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrInt</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrDouble</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">0.1</span>, <span class="hljs-number">0.2</span>, <span class="hljs-number">0.3</span>];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrString</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'hello'</span>, <span class="hljs-string">'world'</span>];</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="异常">异常<i class="anchor-icon anchor-icon-link" anchorid="异常" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="避免频繁抛出异常" class="firsth2">避免频繁抛出异常<i class="anchor-icon anchor-icon-link" anchorid="避免频繁抛出异常" tips="复制节点链接"></i></h3><p>创建异常时会构造异常的栈帧，造成性能损耗。在性能敏感场景下，如for循环语句中，应避免频繁抛出异常。</p> <p>优化前的代码示例：</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">div</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">if</span> (a &lt;= <span class="hljs-number">0</span> || b &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">'Invalid numbers.'</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> a / b;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> t = <span class="hljs-number">1</span>; t &lt; <span class="hljs-number">100</span>; t++) {</li><li>      sum += <span class="hljs-title function_">div</span>(t, num);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(e.<span class="hljs-property">message</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> sum;</li><li>}</li></ol></pre></div></div> <p>优化后的代码示例：</p> <div _ngcontent-fmm-c106="" class="highlight-div"><div _ngcontent-fmm-c106="" class="highlight-div-header"><div _ngcontent-fmm-c106="" class="highlight-div-header-left"><div _ngcontent-fmm-c106="" class="handle-button expand-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fmm-c106="" class="highlight-div-header-right"><div _ngcontent-fmm-c106="" class="handle-button ai-button"></div><div _ngcontent-fmm-c106="" class="handle-button line-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fmm-c106="" class="handle-button theme-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fmm-c106="" class="handle-button copy-button"><div _ngcontent-fmm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fmm-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">div</span>(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">if</span> (a &lt;= <span class="hljs-number">0</span> || b &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">NaN</span>;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> a / b;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">sum</span>(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>): <span class="hljs-built_in">number</span> {</li><li>  <span class="hljs-keyword">let</span> sum = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> t = <span class="hljs-number">1</span>; t &lt; <span class="hljs-number">100</span>; t++) {</li><li>    <span class="hljs-comment">// 直接拦截异常场景，避免频繁抛出异常</span></li><li>    <span class="hljs-keyword">if</span> (num &lt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Invalid numbers.'</span>);</li><li>    }</li><li>    sum += <span class="hljs-title function_">div</span>(t, num);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> sum;</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>