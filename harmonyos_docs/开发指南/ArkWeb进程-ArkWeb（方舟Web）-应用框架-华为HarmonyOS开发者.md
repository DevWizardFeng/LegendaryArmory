<h1 _ngcontent-lce-c119="" class="doc-title ng-star-inserted" title="ArkWeb进程"> ArkWeb进程 </h1>

<div _ngcontent-lce-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkWeb是多进程模型，分为应用进程、Web渲染进程、Web GPU进程、Web孵化进程和Foundation进程。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>Web内核对内存大小的申请没有限制约束。</p>     </div></div></div>    <p><strong>图1</strong> ArkWeb进程模型图</p>    <p><span><img originheight="1035" originwidth="1331" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114714.47803393325033326334147681399890:50001231000000:2800:7B80D1DE680D65FFBF865C75FC9C42FEB9D463F9D1936ECE863F3662159CE4B3.png" width="920" height="715.4019534184824"></span></p>    <ul>     <li>      <p>应用进程中Web相关线程（应用唯一）</p>      <ul>       <li>        <p>应用进程为主进程。包含网络线程、Video线程、Audio线程和IO线程等。</p></li>       <li>        <p>负责Web组件的对外接口与回调处理，网络请求、媒体服务等需要与其他系统服务交互的功能。</p></li>      </ul></li>     <li>      <p>Foundation进程（系统唯一）</p>      <p>负责接收应用进程进行孵化进程的请求，管理应用进程和Web渲染进程的绑定关系。</p></li>     <li>      <p>Web孵化进程（系统唯一）</p>      <ul>       <li>        <p>负责接收Foundation进程的请求，执行孵化Web渲染进程与Web GPU进程。</p></li>       <li>        <p>执行孵化后处理安全沙箱降权、预加载动态库，以提升性能。</p></li>      </ul></li>     <li>      <p>Web渲染进程（应用可指定多Web实例间共享或独立进程）</p>      <ul>       <li>        <p>负责运行Web渲染进程引擎（HTML解析、排版、绘制、渲染）。</p></li>       <li>        <p>负责运行ArkWeb执行引擎（JavaScript、Web Assembly）。</p></li>       <li>        <p>提供接口供应用选择多Web实例间是否共享渲染进程，满足不同场景对安全性、稳定性、内存占用的诉求。</p></li>       <li>        <p>默认策略：移动设备上共享渲染进程以节省内存，2in1设备上独立渲染进程提升安全与稳定性。</p></li>      </ul></li>     <li>      <p>Web GPU进程（应用唯一）</p>      <p>负责光栅化、合成送显等与GPU、RenderService交互功能。提升应用进程稳定性、安全性。</p></li>    </ul>    <ol>     <li>      <p>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setrenderprocessmode12" target="_blank">setRenderProcessMode</a>设置渲染子进程的模式，从而控制渲染过程的单进程或多进程状态。</p>      <p>移动设备默认为单进程渲染，而2in1设备则默认采用多进程渲染。通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#getrenderprocessmode12" target="_blank">getRenderProcessMode</a>可查询当前的渲染子进程模式，其中枚举值0表示单进程模式，枚举值1对应多进程模式。若获取的值不在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-e#renderprocessmode12" target="_blank">RenderProcessMode</a>枚举值范围内，则系统将自动采用多进程渲染模式作为默认设置。</p>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getRenderProcessMode'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> mode = webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">getRenderProcessMode</span>();</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"getRenderProcessMode: "</span> + mode);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'setRenderProcessMode'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setRenderProcessMode</span>(webview.<span class="hljs-property">RenderProcessMode</span>.<span class="hljs-property">MULTIPLE</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span>     BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#terminaterenderprocess12" target="_blank">terminateRenderProcess</a>来主动关闭渲染进程。若渲染进程尚未启动或已销毁，此操作将不会产生任何影响。此外，销毁渲染进程将同时影响所有与之关联的其他实例。</p>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'terminateRenderProcess'</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> result = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">terminateRenderProcess</span>();</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"terminateRenderProcess result: "</span> + result);</li><li>      })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onrenderexited9" target="_blank">onRenderExited</a>来监听渲染进程的退出事件，从而获知退出的具体原因（如内存OOM、crash或正常退出等）。由于多个Web组件可能共用同一个渲染进程，因此，每当渲染进程退出时，每个受此影响的Web组件均会触发相应的回调。</p>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'chrome://crash/'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onRenderExited</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'reason:'</span> + event.<span class="hljs-property">renderExitReason</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onrenderprocessnotresponding12" target="_blank">onRenderProcessNotResponding</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onrenderprocessresponding12" target="_blank">onRenderProcessResponding</a>来监听渲染进程的无响应状态。</p>      <p>当Web组件无法处理输入事件，或未能在预期时间内导航至新URL时，系统会判定网页进程为无响应状态，并触发onRenderProcessNotResponding回调。在网页进程持续无响应期间，该回调可能反复触发，直至进程恢复至正常运行状态，此时将触发onRenderProcessResponding回调。</p>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onRenderProcessNotResponding</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onRenderProcessNotResponding: [jsStack]= "</span> + data.<span class="hljs-property">jsStack</span> +</li><li>            <span class="hljs-string">", [process]="</span> + data.<span class="hljs-property">pid</span> + <span class="hljs-string">", [reason]="</span> + data.<span class="hljs-property">reason</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onRenderProcessResponding</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onRenderProcessResponding again"</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web" target="_blank">Web组件</a>创建参数涵盖了多进程模型的运用。其中，sharedRenderProcessToken标识了当前Web组件所指定的共享渲染进程的token。在多渲染进程模式下，拥有相同token的Web组件将优先尝试重用与该token绑定的渲染进程。token与渲染进程的绑定关系，在渲染进程的初始化阶段形成。一旦渲染进程不再关联任何Web组件，它与token的绑定关系将被解除。</p>      <div _ngcontent-lce-c106="" class="highlight-div"><div _ngcontent-lce-c106="" class="highlight-div-header"><div _ngcontent-lce-c106="" class="highlight-div-header-left"><div _ngcontent-lce-c106="" class="handle-button expand-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lce-c106="" class="highlight-div-header-right"><div _ngcontent-lce-c106="" class="handle-button ai-button"></div><div _ngcontent-lce-c106="" class="handle-button line-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lce-c106="" class="handle-button theme-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lce-c106="" class="handle-button copy-button"><div _ngcontent-lce-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lce-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller1</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">controller2</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller1</span>, <span class="hljs-attr">sharedRenderProcessToken</span>: <span class="hljs-string">"111"</span> })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.w3.org'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller2</span>, <span class="hljs-attr">sharedRenderProcessToken</span>: <span class="hljs-string">"111"</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>    </ol>   </div>   <div></div></div>