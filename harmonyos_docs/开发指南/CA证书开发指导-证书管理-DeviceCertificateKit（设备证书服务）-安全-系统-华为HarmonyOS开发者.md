<h1 _ngcontent-gmo-c119="" class="doc-title ng-star-inserted" title="CA证书开发指导"> CA证书开发指导 </h1>

<div _ngcontent-gmo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>本开发指导需使用API version 12及以上版本SDK。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="场景说明">场景说明<i class="anchor-icon anchor-icon-link" anchorid="场景说明" tips="复制节点链接"></i></h2>          <p>典型场景。</p>     <ul>      <li>安装用户CA证书。调用者可以将用户CA证书安装在当前用户或者设备公共位置下。       <ul>        <li>安装在当前用户时，仅当前用户的业务可以访问该证书。</li>        <li>安装在设备公共位置下，所有用户下的业务都可以访问。</li>       </ul></li>      <li>获取用户CA证书列表。可以选择获取当前用户或者设备公共位置下的用户CA证书列表。</li>      <li>获取用户CA证书详情。</li>      <li>删除指定的用户CA证书。</li>      <li>获取CA证书的存储路径。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>详细接口说明可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-certmanager" target="_blank">API参考</a>。</p>     <p>以上场景涉及的常用接口如下表所示。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.1" valign="top" width="33.33333333333333%">实例名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.2" valign="top" width="33.33333333333333%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.3" valign="top" width="33.33333333333333%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">installUserTrustedCertificateSync(cert: Uint8Array, certScope: CertScope) : CMResult<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">安装用户CA证书。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">uninstallUserTrustedCertificateSync(certUri: string) : void<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">删除用户CA证书。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">getAllUserTrustedCertificates(): Promise&lt;CMResult&gt;</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">获取当前用户和设备公共位置的所有用户根CA证书列表。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">getAllUserTrustedCertificates(scope: CertScope): Promise&lt;CMResult&gt;<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">根据证书的位置获取用户根CA证书列表。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">getUserTrustedCertificate(certUri: string): Promise&lt;CMResult&gt;</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">获取用户根CA证书的详细信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificateManager</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">getCertificateStorePath(property: CertStoreProperty): string<sup>18+</sup></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">获取证书的存储路径。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>权限申请和声明。</p>       <p>使用安装和删除接口需要申请权限：ohos.permission.ACCESS_ENTERPRISE_USER_TRUSTED_CERT或ohos.permission.ACCESS_USER_TRUSTED_CERT</p>       <p>使用获取列表和获取详情接口需要申请权限：ohos.permission.ACCESS_CERT_MANAGER</p>       <p>申请流程请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/determine-application-mode">申请应用权限</a></p>       <p>声明权限请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a></p></li>      <li>       <p>导入相关模块。</p>       <div _ngcontent-gmo-c106="" class="highlight-div"><div _ngcontent-gmo-c106="" class="highlight-div-header"><div _ngcontent-gmo-c106="" class="highlight-div-header-left"><div _ngcontent-gmo-c106="" class="handle-button expand-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gmo-c106="" class="highlight-div-header-right"><div _ngcontent-gmo-c106="" class="handle-button ai-button"></div><div _ngcontent-gmo-c106="" class="handle-button line-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gmo-c106="" class="handle-button theme-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gmo-c106="" class="handle-button copy-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gmo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { certificateManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DeviceCertificateKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>安装用户CA证书、获取用户CA证书列表、获取用户证书详情、删除用户CA证书。</p>       <div _ngcontent-gmo-c106="" class="highlight-div"><div _ngcontent-gmo-c106="" class="highlight-div-header"><div _ngcontent-gmo-c106="" class="highlight-div-header-left"><div _ngcontent-gmo-c106="" class="handle-button expand-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gmo-c106="" class="highlight-div-header-right"><div _ngcontent-gmo-c106="" class="handle-button ai-button"></div><div _ngcontent-gmo-c106="" class="handle-button line-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gmo-c106="" class="handle-button theme-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gmo-c106="" class="handle-button copy-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gmo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">userCASample</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">/* 安装的用户CA证书数据需要业务赋值。 */</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">userCAData</span>: <span class="hljs-title class_">Uint8Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([</li><li>    <span class="hljs-number">0x30</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x2E</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x14</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x75</span>, <span class="hljs-number">0x71</span>, <span class="hljs-number">0x22</span>, <span class="hljs-number">0xDF</span>, <span class="hljs-number">0xDC</span>, <span class="hljs-number">0xCB</span>,</li><li>    <span class="hljs-number">0xD4</span>, <span class="hljs-number">0xE5</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0x89</span>, <span class="hljs-number">0xEB</span>, <span class="hljs-number">0x77</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0xF4</span>, <span class="hljs-number">0x62</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x06</span>,</li><li>    <span class="hljs-number">0x08</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x06</span>,</li><li>    <span class="hljs-number">0x03</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x6F</span>,</li><li>    <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x43</span>, <span class="hljs-number">0x41</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x1E</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x31</span>,</li><li>    <span class="hljs-number">0x31</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x17</span>, <span class="hljs-number">0x0D</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x37</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x32</span>, <span class="hljs-number">0x33</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x31</span>,</li><li>    <span class="hljs-number">0x35</span>, <span class="hljs-number">0x38</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x5A</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x1A</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x18</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x55</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x03</span>,</li><li>    <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x0F</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0x61</span>, <span class="hljs-number">0x6D</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0x65</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x52</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x74</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x43</span>,</li><li>    <span class="hljs-number">0x41</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x59</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x13</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x08</span>,</li><li>    <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x07</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x42</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x39</span>, <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xE1</span>, <span class="hljs-number">0x3F</span>,</li><li>    <span class="hljs-number">0x36</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x82</span>, <span class="hljs-number">0x28</span>, <span class="hljs-number">0x56</span>, <span class="hljs-number">0xBB</span>, <span class="hljs-number">0xE7</span>, <span class="hljs-number">0x97</span>, <span class="hljs-number">0x6C</span>, <span class="hljs-number">0xA9</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x3E</span>, <span class="hljs-number">0xD7</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xF2</span>,</li><li>    <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x05</span>, <span class="hljs-number">0x81</span>, <span class="hljs-number">0xE8</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x57</span>, <span class="hljs-number">0x90</span>, <span class="hljs-number">0x5D</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0x6A</span>, <span class="hljs-number">0xAD</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x2F</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0x6F</span>, <span class="hljs-number">0x31</span>,</li><li>    <span class="hljs-number">0x31</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x35</span>, <span class="hljs-number">0x84</span>, <span class="hljs-number">0x7F</span>, <span class="hljs-number">0xF6</span>, <span class="hljs-number">0xE4</span>, <span class="hljs-number">0xD5</span>, <span class="hljs-number">0x7B</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0xDD</span>, <span class="hljs-number">0x93</span>, <span class="hljs-number">0x2B</span>, <span class="hljs-number">0x0C</span>, <span class="hljs-number">0x1B</span>, <span class="hljs-number">0x42</span>,</li><li>    <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0xE3</span>, <span class="hljs-number">0xC6</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0xF5</span>, <span class="hljs-number">0xFE</span>, <span class="hljs-number">0x66</span>, <span class="hljs-number">0x78</span>, <span class="hljs-number">0xF7</span>, <span class="hljs-number">0xBD</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0x06</span>, <span class="hljs-number">0x08</span>,</li><li>    <span class="hljs-number">0x2A</span>, <span class="hljs-number">0x86</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xCE</span>, <span class="hljs-number">0x3D</span>, <span class="hljs-number">0x04</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x03</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x30</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x02</span>, <span class="hljs-number">0x21</span>, <span class="hljs-number">0x00</span>,</li><li>    <span class="hljs-number">0xCC</span>, <span class="hljs-number">0xA7</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xC5</span>, <span class="hljs-number">0xC0</span>, <span class="hljs-number">0x31</span>, <span class="hljs-number">0x36</span>, <span class="hljs-number">0x19</span>, <span class="hljs-number">0x3F</span>, <span class="hljs-number">0xA4</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0x48</span>, <span class="hljs-number">0xC3</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0x7D</span>, <span class="hljs-number">0x33</span>,</li><li>    <span class="hljs-number">0x1F</span>, <span class="hljs-number">0x0A</span>, <span class="hljs-number">0xCF</span>, <span class="hljs-number">0xB0</span>, <span class="hljs-number">0x73</span>, <span class="hljs-number">0x58</span>, <span class="hljs-number">0x6B</span>, <span class="hljs-number">0xB7</span>, <span class="hljs-number">0xC9</span>, <span class="hljs-number">0xAE</span>, <span class="hljs-number">0x16</span>, <span class="hljs-number">0x34</span>, <span class="hljs-number">0xF1</span>, <span class="hljs-number">0x8F</span>, <span class="hljs-number">0xAF</span>, <span class="hljs-number">0xC8</span>,</li><li>    <span class="hljs-number">0x02</span>, <span class="hljs-number">0x20</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x9C</span>, <span class="hljs-number">0x64</span>, <span class="hljs-number">0xC2</span>, <span class="hljs-number">0xE2</span>, <span class="hljs-number">0x60</span>, <span class="hljs-number">0x26</span>, <span class="hljs-number">0x01</span>, <span class="hljs-number">0x5F</span>, <span class="hljs-number">0xF2</span>, <span class="hljs-number">0x0B</span>, <span class="hljs-number">0x8C</span>, <span class="hljs-number">0x9F</span>, <span class="hljs-number">0x7D</span>,</li><li>    <span class="hljs-number">0x18</span>, <span class="hljs-number">0x6E</span>, <span class="hljs-number">0x91</span>, <span class="hljs-number">0xA6</span>, <span class="hljs-number">0xB3</span>, <span class="hljs-number">0x5E</span>, <span class="hljs-number">0x2C</span>, <span class="hljs-number">0xF0</span>, <span class="hljs-number">0x68</span>, <span class="hljs-number">0x45</span>, <span class="hljs-number">0x11</span>, <span class="hljs-number">0x1D</span>, <span class="hljs-number">0xA0</span>, <span class="hljs-number">0xCB</span>, <span class="hljs-number">0x83</span>, <span class="hljs-number">0xEB</span>,</li><li>    <span class="hljs-number">0xE6</span>, <span class="hljs-number">0x25</span>,</li><li>  ]);</li><li>
</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">certUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">let</span> certScope = certificateManager.<span class="hljs-property">CertScope</span>.<span class="hljs-property">CURRENT_USER</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">/* 在当前用户下，安装用户CA证书。 */</span></li><li>    <span class="hljs-keyword">let</span> result = certificateManager.<span class="hljs-title function_">installUserTrustedCertificateSync</span>(userCAData, certScope);</li><li>    certUri = (result.<span class="hljs-property">uri</span> != <span class="hljs-literal">undefined</span>) ? result.<span class="hljs-property">uri</span> : <span class="hljs-string">''</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Succeeded in install user ca cert, certUri is <span class="hljs-subst">${certUri}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to install user ca cert. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">/* 获取用户CA证书详情。 */</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> certificateManager.<span class="hljs-title function_">getUserTrustedCertificate</span>(certUri);</li><li>    <span class="hljs-keyword">if</span> (result === <span class="hljs-literal">undefined</span> || result.<span class="hljs-property">certInfo</span> == <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'The result of getting user ca cert is undefined.'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">let</span> certInfo = result.<span class="hljs-property">certInfo</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting user ca cert.'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get user ca certificate. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">/* 获取当前用户下的用户CA证书列表。 */</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-keyword">await</span> certificateManager.<span class="hljs-title function_">getAllUserTrustedCertificates</span>(certScope);</li><li>    <span class="hljs-keyword">if</span> (result == <span class="hljs-literal">undefined</span>) { <span class="hljs-comment">/* 用户根CA证书个数为0时，返回result为undefined。 */</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'the count of the user trusted certificates is 0'</span>);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (result.<span class="hljs-property">certList</span> == <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'The result of getting current user trusted certificates is undefined.'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">let</span> list = result.<span class="hljs-property">certList</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in getting user ca cert list.'</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get user ca certificate. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">/* 删除安装的用户CA证书。 */</span></li><li>    certificateManager.<span class="hljs-title function_">uninstallUserTrustedCertificateSync</span>(certUri);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to uninstall user ca certificate. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>获取系统CA证书路径、用户CA证书路径。应用可以直接通过该路径访问CA证书。</p>       <div _ngcontent-gmo-c106="" class="highlight-div"><div _ngcontent-gmo-c106="" class="highlight-div-header"><div _ngcontent-gmo-c106="" class="highlight-div-header-left"><div _ngcontent-gmo-c106="" class="handle-button expand-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gmo-c106="" class="highlight-div-header-right"><div _ngcontent-gmo-c106="" class="handle-button ai-button"></div><div _ngcontent-gmo-c106="" class="handle-button line-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gmo-c106="" class="handle-button theme-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gmo-c106="" class="handle-button copy-button"><div _ngcontent-gmo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gmo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getUserCAPath</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-comment">/* 获取系统CA的存储位置。 */</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">property1</span>: certificateManager.<span class="hljs-property">CertStoreProperty</span> = {</li><li>      <span class="hljs-attr">certType</span>: certificateManager.<span class="hljs-property">CertType</span>.<span class="hljs-property">CA_CERT_SYSTEM</span>,</li><li>    }</li><li>    <span class="hljs-keyword">let</span> systemCAPath = certificateManager.<span class="hljs-title function_">getCertificateStorePath</span>(property1);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Success to get system ca path: <span class="hljs-subst">${systemCAPath}</span>`</span>);</li><li>
</li><li>    <span class="hljs-comment">/* 获取当前用户的用户CA存储位置。 */</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">property2</span>: certificateManager.<span class="hljs-property">CertStoreProperty</span> = {</li><li>      <span class="hljs-attr">certType</span>: certificateManager.<span class="hljs-property">CertType</span>.<span class="hljs-property">CA_CERT_USER</span>,</li><li>      <span class="hljs-attr">certScope</span>: certificateManager.<span class="hljs-property">CertScope</span>.<span class="hljs-property">CURRENT_USER</span>,</li><li>    }</li><li>    <span class="hljs-keyword">let</span> userCACurrentPath = certificateManager.<span class="hljs-title function_">getCertificateStorePath</span>(property2);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Success to get current user's user ca path: <span class="hljs-subst">${userCACurrentPath}</span>`</span>);</li><li>
</li><li>    <span class="hljs-comment">/* 获取设备公共的用户CA存储位置。 */</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">property3</span>: certificateManager.<span class="hljs-property">CertStoreProperty</span> = {</li><li>      <span class="hljs-attr">certType</span>: certificateManager.<span class="hljs-property">CertType</span>.<span class="hljs-property">CA_CERT_USER</span>,</li><li>      <span class="hljs-attr">certScope</span>: certificateManager.<span class="hljs-property">CertScope</span>.<span class="hljs-property">GLOBAL_USER</span>,</li><li>    }</li><li>    <span class="hljs-keyword">let</span> globalCACurrentPath = certificateManager.<span class="hljs-title function_">getCertificateStorePath</span>(property3);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Success to get global user's user ca path: <span class="hljs-subst">${globalCACurrentPath}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to get store path. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>