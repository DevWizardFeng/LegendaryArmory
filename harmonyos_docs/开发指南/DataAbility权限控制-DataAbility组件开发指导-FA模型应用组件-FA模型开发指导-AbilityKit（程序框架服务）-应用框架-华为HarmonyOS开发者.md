<h1 _ngcontent-pxo-c119="" class="doc-title ng-star-inserted" title="DataAbility权限控制"> DataAbility权限控制 </h1>

<div _ngcontent-pxo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>DataAbility提供数据服务，并不是所有的Ability都有权限读写它，DataAbility有一套权限控制机制来保证数据安全。分为静态权限控制和动态权限控制两部分。</p>  <div class="tiledSection"><h2 id="静态权限控制">静态权限控制<i class="anchor-icon anchor-icon-link" anchorid="静态权限控制" tips="复制节点链接"></i></h2><p>DataAbility作为服务端，在被拉起的时候，会根据config.json里面配置的权限来进行校验，有"readPermission"、"writePermission"和"Permission"三个配置项，可以不配或者为空。示例如下:</p> <div _ngcontent-pxo-c106="" class="highlight-div"><div _ngcontent-pxo-c106="" class="highlight-div-header"><div _ngcontent-pxo-c106="" class="highlight-div-header-left"><div _ngcontent-pxo-c106="" class="handle-button expand-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxo-c106="" class="highlight-div-header-right"><div _ngcontent-pxo-c106="" class="handle-button ai-button"></div><div _ngcontent-pxo-c106="" class="handle-button line-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxo-c106="" class="handle-button theme-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxo-c106="" class="handle-button copy-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxo-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".DataAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"srcLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ets"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"srcPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"DataAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:icon"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:DataAbility_desc"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"data"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"uri"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"dataability://com.samples.famodelabilitydevelop.DataAbility"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"readPermission"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.READ_CONTACTS"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"writePermission"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.WRITE_CONTACTS"</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-comment">// ...</span></li><li><span class="hljs-punctuation">]</span></li></ol></pre></div></div> <p>客户端在拉起DataAbility的时候，需要校验客户端是否有权限拉起该DataAbility。客户端的权限配置在config.json配置文件的"module"对象的"reqPermissions"对象中，示例如下：</p> <div _ngcontent-pxo-c106="" class="highlight-div"><div _ngcontent-pxo-c106="" class="highlight-div-header"><div _ngcontent-pxo-c106="" class="highlight-div-header-left"><div _ngcontent-pxo-c106="" class="handle-button expand-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pxo-c106="" class="highlight-div-header-right"><div _ngcontent-pxo-c106="" class="handle-button ai-button"></div><div _ngcontent-pxo-c106="" class="handle-button line-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pxo-c106="" class="handle-button theme-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pxo-c106="" class="handle-button copy-button"><div _ngcontent-pxo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pxo-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"reqPermissions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.READ_CONTACTS"</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.permission.WRITE_CONTACTS"</span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="动态权限控制">动态权限控制<i class="anchor-icon anchor-icon-link" anchorid="动态权限控制" tips="复制节点链接"></i></h2><p>静态权限校验只能控制某个DataAbility是否能被另一个Ability或应用拉起，无法精确校验每个读写接口的权限，因为拉起DataAbility的时候，还不知道应用是否需要读写它的数据。</p> <p>动态权限控制是校验每个数据操作的接口是否有对应的权限。客户端调用数据操作接口所需的权限如下表所示。</p> <p> <strong>表1</strong> 接口对应的读写权限配置</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.5.1.4.1.1" valign="top" width="33.33333333333333%">需要配置读权限的接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.4.1.2" valign="top" width="33.33333333333333%">需要配置写权限的接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.4.1.3" valign="top" width="33.33333333333333%">根据实际操作配置读写权限的接口</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">query、normalizeUri、denormalizeUri、openfile（传入mode有'r'）</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">insert、batchInsert、delete、update、openfile（传入mode有'w'）</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">executeBatch</td> </tr>  </tbody></table></div> </div> <p>对于需要配置读权限的接口，服务端需要配置readPermission，客户端必须申请相应的读权限才能调用相关的接口。</p> <p>对于需要配置写权限的接口，服务端需要配置writePermission，客户端必须申请相应的写权限才能调用相关的接口。</p> </div> </div> <div></div></div>