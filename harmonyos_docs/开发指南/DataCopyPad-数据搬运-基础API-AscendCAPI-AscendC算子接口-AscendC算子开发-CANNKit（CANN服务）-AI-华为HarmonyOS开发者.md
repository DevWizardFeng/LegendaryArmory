<h1 _ngcontent-ily-c119="" class="doc-title ng-star-inserted" title="DataCopyPad"> DataCopyPad </h1>

<div _ngcontent-ily-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section618mcpsimp">功能说明<i class="anchor-icon anchor-icon-link" anchorid="section618mcpsimp" tips="复制节点链接"></i></h2><p>该接口提供数据非对齐搬运的功能，支持的数据传输通路如下。</p> <ul><li>GM-&gt;VECIN/VECOUT</li><li>VECIN/VECOUT-&gt;GM</li><li>VECIN/VECOUT-&gt;TSCM</li></ul> <p>其中从GM-&gt;VECIN/VECOUT进行数据搬运时，可以根据开发者的需要自行填充数据。</p> </div> <div class="tiledSection"><h2 id="section620mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section620mcpsimp" tips="复制节点链接"></i></h2><ul><li>dataCopyParams为<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table10572141063919">DataCopyExtParams</a>类型，相比于<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table9182515919">DataCopyParams</a>类型，支持的操作数步长等参数取值范围更大<ul><li>通路：GM-&gt;VECIN/VECOUT<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">template</span> &lt;<span class="hljs-title class_">typename</span> <span class="hljs-title class_">T</span>&gt;</li><li><span class="hljs-variable">__aicore__</span> <span class="hljs-variable">inline</span>  <span class="hljs-variable">void</span> <span class="hljs-title function_">DataCopyPad</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">LocalTensor</span>&lt;<span class="hljs-title class_">T</span>&gt; &amp;<span class="hljs-title class_">dstLocal</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">GlobalTensor</span>&lt;<span class="hljs-title class_">T</span>&gt; &amp;<span class="hljs-title class_">srcGlobal</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">DataCopyExtParams</span> &amp;<span class="hljs-title class_">dataCopyParams</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">DataCopyPadExtParams</span>&lt;<span class="hljs-title class_">T</span>&gt; &amp;<span class="hljs-title class_">padParams</span>)</li></ol></pre></div></div> </li><li>通路：VECIN/VECOUT-&gt;GM<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">template</span> &lt;<span class="hljs-title class_">typename</span> <span class="hljs-title class_">T</span>&gt;</li><li><span class="hljs-variable">__aicore__</span> <span class="hljs-variable">inline</span>  <span class="hljs-variable">void</span> <span class="hljs-title function_">DataCopyPad</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">GlobalTensor</span>&lt;<span class="hljs-title class_">T</span>&gt; &amp;<span class="hljs-title class_">dstGlobal</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">LocalTensor</span>&lt;<span class="hljs-title class_">T</span>&gt; &amp;<span class="hljs-title class_">srcLocal</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">DataCopyExtParams</span> &amp;<span class="hljs-title class_">dataCopyParams</span>)</li></ol></pre></div></div> </li></ul> </li><li>dataCopyParams为<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table9182515919">DataCopyParams</a>类型<ul><li>通路：GM-&gt;VECIN/VECOUT<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span></li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopyPad</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; dstLocal, <span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; srcGlobal, <span class="hljs-type">const</span> DataCopyParams&amp; dataCopyParams, <span class="hljs-type">const</span> DataCopyPadParams&amp; padParams)</span></span></li></ol></pre></div></div> </li><li>通路：VECIN/VECOUT-&gt;GM<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-keyword">template</span>&lt;<span class="hljs-keyword">typename</span> T&gt;</span></li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">DataCopyPad</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; dstGlobal, <span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; srcLocal,<span class="hljs-type">const</span> DataCopyParams&amp; dataCopyParams)</span></span></li></ol></pre></div></div> </li></ul> </li></ul> </div> <div class="tiledSection"><h2 id="section622mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section622mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>模板参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.1" valign="top" width="18.21%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.2" valign="top" width="81.78999999999999%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.21%"><p>T</p> </td> <td class="cellrowborder" valign="top" width="81.78999999999999%"><p>操作数以及paddingValue（待填充数据值）的数据类型。</p> <p>Kirin9020系列处理器，支持的数据类型为：int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> <p>KirinX90系列处理器，支持的数据类型为：int8_t/uint8_t/int16_t/uint16_t/int32_t/uint32_t/half/float</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>接口参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.1" valign="top" width="18.54%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.2" valign="top" width="10.05%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.3" valign="top" width="71.41%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.54%"><p>dstLocal, dstGlobal</p> </td> <td class="cellrowborder" valign="top" width="10.05%"><p>输出</p> </td> <td class="cellrowborder" valign="top" width="71.41%"><p>目的操作数，类型为LocalTensor或GlobalTensor。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.54%"><p>srcLocal, srcGlobal</p> </td> <td class="cellrowborder" valign="top" width="10.05%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="71.41%"><p>源操作数，类型为LocalTensor或GlobalTensor。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.54%"><p>dataCopyParams</p> </td> <td class="cellrowborder" valign="top" width="10.05%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="71.41%"><p>搬运参数。</p> <ul><li>DataCopyExtParams类型，定义如下，具体参数说明请参考<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table10572141063919">表3</a>。<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DataCopyExtParams</span> {</li><li>    <span class="hljs-type">uint16_t</span> blockCount = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint32_t</span> blockLen = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint32_t</span> srcStride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint32_t</span> dstStride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint32_t</span> rsv = <span class="hljs-number">0</span>; <span class="hljs-comment">// reserved information</span></li><li>};</li></ol></pre></div></div> </li><li>DataCopyParams类型，定义如下，具体参数说明请参考<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table9182515919">表4</a>。<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">DataCopyParams</span> {</li><li>    <span class="hljs-type">uint16_t</span> blockCount = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> blockLen = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> srcStride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> dstStride = <span class="hljs-number">0</span>;</li><li>};</li></ol></pre></div></div> </li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.54%"><p>padParams</p> </td> <td class="cellrowborder" valign="top" width="10.05%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="71.41%"><p>从GM-&gt;VECIN/VECOUT进行数据搬运时，可以根据开发者需要，在搬运数据左边或右边填充数据。padParams是用于控制数据填充过程的参数，DataCopyPadExtParams类型，定义如下，具体参数请参考<a href="/consumer/cn/doc/harmonyos-guides/cannkit-datacopypad#zh-cn_topic_0000002149825465_table844881954715">表5</a>。</p> <div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-keyword">typename</span> T&gt; <span class="hljs-keyword">struct</span> <span class="hljs-title class_">DataCopyPadExtParams</span> {</li><li>    <span class="hljs-type">bool</span> isPad = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-type">uint8_t</span> leftPadding = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint8_t</span> rightPadding = <span class="hljs-number">0</span>;</li><li>    T paddingValue = <span class="hljs-number">0</span>;</li><li>};</li></ol></pre></div></div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.54%"><p>nd2nzParams</p> </td> <td class="cellrowborder" valign="top" width="10.05%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="71.41%"><p>从VECIN/VECOUT-&gt;TSCM进行数据搬运时，可以进行ND到NZ的数据格式转换。nd2nzParams是用于控制数据格式转换的参数，Nd2NzParams类型，定义如下。</p> <div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">struct</span> <span class="hljs-title class_">Nd2NzParams</span> {</li><li>    <span class="hljs-type">uint16_t</span> ndNum = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> nValue = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> dValue = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> srcNdMatrixStride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> srcDValue = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> dstNzC0Stride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> dstNzNStride = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint16_t</span> dstNzMatrixStride = <span class="hljs-number">0</span>;</li><li>};</li></ol></pre></div></div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>Nd2NzParams的ndNum仅支持设置为1。</p> </div></div></div> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table id="zh-cn_topic_0000002149825465_table10572141063919" class="layoutFixed idpTab"><caption><b>表3 </b>DataCopyExtParams结构体参数定义</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.4.2.3.1.1" valign="top" width="15%"><p>参数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.4.2.3.1.2" valign="top" width="85%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>blockCount</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令包含的连续传输数据块个数，数据类型为uint16_t，取值范围：blockCount∈[1, 4095]。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>blockLen</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令每个连续传输数据块长度，<strong>该指令支持非对齐搬运</strong>，<strong>每个连续传输数据块长度单位为Byte</strong>。数据类型为uint32_t，blockLen不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>srcStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>源操作数，相邻连续数据块的间隔（前面一个数据块的尾与后面数据块的头的间隔），<strong>如果源操作数的逻辑位置为VECIN/VECOUT，则单位为dataBlock(32Bytes), 如果源操作数的逻辑位置为GM,则单位为Byte</strong>。数据类型为uint32_t，srcStride不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>dstStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>目的操作数，相邻连续数据块间的间隔（前面一个数据块的尾与后面数据块的头的间隔），<strong>如果目的操作数的逻辑位置为VECIN/VECOUT，则单位为dataBlock(32Bytes)，如果目的操作数的逻辑位置为GM，则单位为Byt</strong><strong>e</strong>。数据类型为uint32_t，dstStride不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>rsv</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>保留字段。</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table id="zh-cn_topic_0000002149825465_table9182515919" class="layoutFixed idpTab"><caption><b>表4 </b>DataCopyParams结构体参数定义</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.5.2.3.1.1" valign="top" width="15%"><p>参数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.2.3.1.2" valign="top" width="85%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>blockCount</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令包含的连续传输数据块个数，数据类型为uint16_t，取值范围：blockCount∈[1, 4095]。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>blockLen</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>指定该指令每个连续传输数据块长度，<strong>该指令支持非对齐搬运</strong>，<strong>每个连续传输数据块长度单位为Byte</strong>。数据类型为uint16_t，blockLen不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>srcStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>源操作数，相邻连续数据块的间隔（前面一个数据块的尾与后面数据块的头的间隔），<strong>如果源操作数的逻辑位置为VECIN/VECOUT，则单位为dataBlock(32Bytes), 如果源操作数的逻辑位置为GM,则单位为Byte</strong>。数据类型为uint16_t，srcStride不要超出该数据类型的取值范围。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>dstStride</p> </td> <td class="cellrowborder" valign="top" width="85%"><p>目的操作数，相邻连续数据块间的间隔（前面一个数据块的尾与后面数据块的头的间隔），<strong>如果目的操作数的逻辑位置为VECIN/VECOUT，则单位为dataBlock(32Bytes)，如果目的操作数的逻辑位置为GM，则单位为Byt</strong><strong>e</strong>。数据类型为uint16_t，dstStride不要超出该数据类型的取值范围。</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table id="zh-cn_topic_0000002149825465_table844881954715" class="layoutFixed idpTab"><caption><b>表5 </b>DataCopyPadExtParams结构体参数定义</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.6.2.3.1.1" valign="top" width="18.44%"><p>参数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.6.2.3.1.2" valign="top" width="81.56%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.44%"><p>isPad</p> </td> <td class="cellrowborder" valign="top" width="81.56%"><p>是否需要填充开发者自定义的数据，取值范围：true，false。</p> <p><span style="color: rgb(29,29,26);">true：</span><span style="color: rgb(29,29,26);">填充padding value</span>。</p> <p><span style="color: rgb(29,29,26);">false：</span>表示<span style="color: rgb(29,29,26);">开发者不需要指定填充值，会默认填充</span>随机值。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.44%"><p>leftPadding</p> </td> <td class="cellrowborder" valign="top" width="81.56%"><p>连续搬运数据块左侧需要补充的数据范围，单位为元素个数。</p> <p><strong>leftPadding、rightPadding的字节数均不能超过32Bytes。</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.44%"><p>rightPadding</p> </td> <td class="cellrowborder" valign="top" width="81.56%"><p>连续搬运数据块右侧需要补充的数据范围，单位为元素个数。</p> <p><strong>leftPadding、rightPadding的字节数均不能超过32Bytes。</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.44%"><p>paddingValue</p> </td> <td class="cellrowborder" valign="top" width="81.56%"><p>左右两侧需要填充的数据值，需要保证在数据占用字节范围内。</p> <p>数据类型和源操作数保持一致，T数据类型。</p> <p><strong>当数据类型长度为64位时，该参数只能设置为0。</strong></p> </td> </tr>  </tbody></table></div> </div> <ul><li><strong>GM</strong>-&gt;<strong>VECIN/VECOUT</strong><div class="p"><strong>参数解释</strong>：<ul><li>当blockLen+<span style="color: rgb(29,29,26);">leftPadding+rightPadding满足32字节对齐时</span>，<span style="color: rgb(29,29,26);">isPad为false，左右两侧填充的数据值会默认为随机值，否则为paddingValue。</span></li><li><span style="color: rgb(29,29,26);">当blockLen+leftPadding+rightPadding不满足32字节对齐时，框架会填充一些假数据dummy，保证左右填充的数据和blockLen、假数据为32字节对齐。若leftPadding、rightPadding都为0：dummy会默认填充待搬运数据块的第一个元素值。若leftPadding/rightPadding不为0：</span><span style="color: rgb(29,29,26);">isPad为false，左右两侧填充的数据值和dummy值均为随机值，否则为paddingValue</span>。</li></ul> </div> <div class="p"><strong>配置示例1：</strong><ul><li>blockLen为64，每个连续传输数据块包含64Bytes。srcStride为1，因为源操作数的逻辑位置为GM，srcStride的单位为Byte，也就是说源操作数相邻数据块之间间隔1Byte；dstStride为1，因为目的操作数的逻辑位置为VECIN/VECOUT，dstStride的单位为dataBlock(32Bytes)，也就是说目的操作数相邻数据块之间间隔1个dataBlock。</li><li>blockLen+<span style="color: rgb(29,29,26);">leftPadding+rightPadding满足32字节对齐</span>，<span style="color: rgb(29,29,26);">isPad为false，左右两侧填充的数据值会默认为随机值，否则为paddingValue。此处示例中，</span><span style="color: rgb(29,29,26);">leftPadding、rightPadding</span>均为0，则不填充。</li><li><span style="color: rgb(29,29,26);">blockLen+leftPadding+rightPadding不满足32字节对齐时，框架会填充一些假数据dummy，保证左右填充的数据和blockLen、假数据为32字节对齐。</span><span style="color: rgb(29,29,26);">leftPadding/rightPadding不为0：若</span><span style="color: rgb(29,29,26);">isPad为false，左右两侧填充的数据值和dummy值均为随机值，否则为paddingValue</span>。<p><span><img height="275.31" originheight="433" originwidth="821" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114312.52433224190403968788497782135414:50001231000000:2800:6EDC77F32945FDE37A63E0A4F8BDAFC885820966A5D4737E3C858F46AF1FA143.png" title="点击放大" width="523.6875"></span></p> </li></ul> </div> <div class="p"><strong>配置示例2：</strong><ul><li>blockLen为47，每个连续传输数据块包含47Bytes；srcStride为1，表示源操作数相邻数据块之间间隔1Byte；dstStride为1，表示目的操作数相邻数据块之间间隔1个dataBlock。</li><li>blockLen+<span style="color: rgb(29,29,26);">leftPadding+rightPadding不满足32字节对齐</span>，<span style="color: rgb(29,29,26);">leftPadding、rightPadding均为0：</span><span style="color: rgb(29,29,26);">dummy会默认填充待搬运数据块的第一个元素值</span>。</li><li><span style="color: rgb(29,29,26);">blockLen+leftPadding+rightPadding不满足32字节对齐，</span><span style="color: rgb(29,29,26);">leftPadding/rightPadding不为0：若</span><span style="color: rgb(29,29,26);">isPad为false，左右两侧填充的数据值和dummy值均为随机值，否则为paddingValue</span>。<p><span><img height="269.325" originheight="443" originwidth="859" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114312.30169861864282840936318204231304:50001231000000:2800:0675A2D63E312AF8F69CE959D31B1E69EA6762FCC356C4351EAC09F4CF3603C6.png" title="点击放大" width="523.6875"></span></p> </li></ul> </div> </li></ul> </div> <ul><li><strong>VECIN/VECOUT</strong>-&gt;<strong>GM</strong><p>当每个连续传输数据块长度blockLen为32字节对齐时，下图呈现了需要传入的DataCopyParams示例，blockLen为64，每个连续传输数据块包含64Bytes；srcStride为1，因为源操作数的逻辑位置为VECIN/VECOUT，srcStride的单位为dataBlock(32Bytes)，也就是说源操作数相邻数据块之间间隔1个dataBlock；dstStride为1，因为目的操作数的逻辑位置为GM，dstStride的单位为Byte，也就是说目的操作数相邻数据块之间间隔1Byte。</p> <p><span><img height="142.6425" originheight="221" originwidth="806" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114312.70840398381312265817319970551066:50001231000000:2800:18A22D8FE0786564EB2870530672142EB44806CE62D5B9B22025CAD9A0C5A7C3.png" title="点击放大" width="523.6875"></span></p> <p>当每个连续传输数据块长度blockLen不满足32字节对齐，由于<span>Unified Buffer</span>要求32字节对齐，框架在搬出时会自动补充一些假数据来保证对齐，但在当搬到GM时会自动将填充的假数据丢弃掉。下图呈现了该场景下需要传入的DataCopyParams示例和假数据补齐的原理。blockLen为47，每个连续传输数据块包含47Bytes，不满足32字节对齐；srcStride为1，表示源操作数相邻数据块之间间隔1个dataBlock；dstStride为1，表示目的操作数相邻数据块之间间隔1Byte。框架在搬出时会自动补充17Bytes的假数据来保证对齐，搬到GM时再自动将填充的假数据丢弃掉。</p> <p><span><img height="148.6275" originheight="229" originwidth="806" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114312.60144976603232819892464263505305:50001231000000:2800:F0467296D4E0A1821BD6F6FE12FE37AAC938C319FCC92BDC669C14A93A674B37.png" title="点击放大" width="523.6875"></span></p> </li><li><strong>VECIN/VECOUT</strong><strong>-&gt;TSCM</strong><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>内部实现涉及AIC和AIV之间的通信，实际搬运路径为VECIN/VECOUT-&gt;GM-&gt;TSCM，<strong>发送通信消息会有开销，性能会受到影响</strong>。</p> </div></div></div> <p>如下图所示，展示了从VECIN/VECOUT搬运到GM，再搬运到TSCM的过程：示例中数据类型为half，单个datablock（32B）含有16个half元素，源操作数中的 A1~A6、B1~B6、C1~C6为需要进行搬运的数据。</p> <p><span><img height="510.72" originheight="538" originwidth="551" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114312.41366307503164923986631208909148:50001231000000:2800:19D224D459AFE2D29B091D1AF0F102F8C7E83DF484A65B5FDF9BD323CBC65746.png" title="点击放大" width="523.6875"></span></p> <div class="p">从VECIN/VECOUT-&gt;GM的搬运，数据存储格式没有发生转变，依然是ND。<ul><li><strong>blockCount</strong>为需要搬运的连续传输数据块个数，设置为3。</li><li><strong>blockLen</strong>为一个连续传输数据块的大小(单位为Byte)，设置为6 * 32 = 192。</li><li><strong>srcStride</strong>为源操作数相邻连续数据块的间隔（前面一个数据块的尾与后面数据块的头的间隔），源操作数逻辑位置为VECIN/VECOUT，其单位为datablock, 两个连续传输数据块（A1~A6、B1~B6）中间相隔1个A7，因此srcStride设置为1。</li><li><strong>dstStride</strong>为目的操作数，相邻连续数据块间的间隔（前面一个数据块的尾与后面数据块的头的间隔），目的操作数逻辑位置为GM，其单位为Byte，两个连续传输数据块（A1~A6、B1~B6）中间相隔2个空白的datablock，因此dstStride设置为64Byte。</li></ul> </div> <div class="p">从GM-&gt;TSCM的搬运，数据存储格式由ND转换为NZ。<ul><li><strong>ndNum</strong>固定为1，即A1~A6、B1~B6、C1~C6视作一整个ndMatrix。</li><li><strong>nValue</strong>为ndMatrix的行数，即为3行。</li><li><strong>dValue</strong>为ndMatrix中一行包含的元素个数，即为6 * 16 = 96个元素。</li><li><strong>srcNdMatrixStride</strong>为相邻ndMatrix之间的距离，因为仅涉及1个ndMatrix，所以可填为0。</li><li><strong>srcDValue</strong>表明ndMatrix的第x行和第x+1行所相隔的元素个数，如A1~B1的距离，即为8个datablock，8 * 16 = 128个元素。</li><li><strong>dstNzC0Stride</strong>为src同一行的相邻datablock在NZ矩阵中相隔datablock数，如A1~A2的距离，即为7个datablock (A1 + 空白 + B1 + 空白 + C1 + 空白 * 2)。</li><li><strong>dstNzNStride</strong>为src中ndMatrix的相邻行在NZ矩阵中相隔多少个datablock，如A1~B1的距离，即为2个datablock (A1 + 空白) 。</li><li><strong>dstNzMatrixStride</strong>为相邻NZ矩阵之间的元素个数，因为仅涉及1个NZ矩阵，所以可以填为1。</li></ul> </div> <p></p> </li></ul> <div class="tiledSection"><h2 id="section640mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section640mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section631mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section631mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器。</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section633mcpsimp">约束说明<i class="anchor-icon anchor-icon-link" anchorid="section633mcpsimp" tips="复制节点链接"></i></h2><p>leftPadding、rightPadding的字节数均不能超过32Bytes。</p> </div> <div class="tiledSection"><h2 id="section177231425115410">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section177231425115410" tips="复制节点链接"></i></h2><div class="p">本示例实现了GM-&gt;VECIN-&gt;GM的非对齐搬运过程。<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel_operator.h"</span></span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">TestDataCopyPad</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-title">TestDataCopyPad</span><span class="hljs-params">()</span> </span>{}</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Init</span><span class="hljs-params">(__gm__ <span class="hljs-type">uint8_t</span>* srcGm, __gm__ <span class="hljs-type">uint8_t</span>* dstGm)</span></span></li><li><span class="hljs-function">    </span>{</li><li>        srcGlobal.<span class="hljs-built_in">SetGlobalBuffer</span>((__gm__ half *)srcGm);</li><li>        dstGlobal.<span class="hljs-built_in">SetGlobalBuffer</span>((__gm__ half *)dstGm);</li><li>        pipe.<span class="hljs-built_in">InitBuffer</span>(inQueueSrc, <span class="hljs-number">1</span>, <span class="hljs-number">32</span> * <span class="hljs-built_in">sizeof</span>(half));</li><li>        pipe.<span class="hljs-built_in">InitBuffer</span>(outQueueDst, <span class="hljs-number">1</span>, <span class="hljs-number">32</span> * <span class="hljs-built_in">sizeof</span>(half));</li><li>    }</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Process</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function">    </span>{</li><li>        <span class="hljs-built_in">CopyIn</span>();</li><li>        <span class="hljs-built_in">Compute</span>();</li><li>        <span class="hljs-built_in">CopyOut</span>();</li><li>    }</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">CopyIn</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function">    </span>{</li><li>        AscendC::LocalTensor&lt;half&gt; srcLocal = inQueueSrc.<span class="hljs-built_in">AllocTensor</span>&lt;half&gt;();</li><li>        AscendC::DataCopyExtParams copyParams{<span class="hljs-number">1</span>, <span class="hljs-number">20</span> * <span class="hljs-built_in">sizeof</span>(half), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>}; <span class="hljs-comment">// 结构体DataCopyExtParams最后一个参数是rsv保留位</span></li><li>        AscendC::DataCopyPadExtParams&lt;half&gt; padParams{<span class="hljs-literal">true</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>};</li><li>        AscendC::<span class="hljs-built_in">DataCopyPad</span>(srcLocal, srcGlobal, copyParams, padParams); <span class="hljs-comment">// 从GM-&gt;VECIN搬运40Bytes</span></li><li>        inQueueSrc.<span class="hljs-built_in">EnQue</span>&lt;half&gt;(srcLocal);</li><li>    }</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">Compute</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function">    </span>{</li><li>        AscendC::LocalTensor&lt;half&gt; srcLocal = inQueueSrc.<span class="hljs-built_in">DeQue</span>&lt;half&gt;();</li><li>        AscendC::LocalTensor&lt;half&gt; dstLocal = outQueueDst.<span class="hljs-built_in">AllocTensor</span>&lt;half&gt;();</li><li>        AscendC::<span class="hljs-built_in">Adds</span>(dstLocal, srcLocal, scalar, <span class="hljs-number">20</span>);</li><li>        outQueueDst.<span class="hljs-built_in">EnQue</span>(dstLocal);</li><li>        inQueueSrc.<span class="hljs-built_in">FreeTensor</span>(srcLocal);</li><li>    }</li><li>    <span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">CopyOut</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function">    </span>{</li><li>        AscendC::LocalTensor&lt;half&gt; dstLocal = outQueueDst.<span class="hljs-built_in">DeQue</span>&lt;half&gt;();</li><li>        AscendC::DataCopyExtParams copyParams{<span class="hljs-number">1</span>, <span class="hljs-number">20</span> * <span class="hljs-built_in">sizeof</span>(half), <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>};</li><li>        AscendC::<span class="hljs-built_in">DataCopyPad</span>(dstGlobal, dstLocal, copyParams); <span class="hljs-comment">// 从VECIN-&gt;GM搬运40Bytes</span></li><li>        outQueueDst.<span class="hljs-built_in">FreeTensor</span>(dstLocal);</li><li>    }</li><li><span class="hljs-keyword">private</span>:</li><li>    AscendC::TPipe pipe;</li><li>    AscendC::TQue&lt;AscendC::QuePosition::VECIN, <span class="hljs-number">1</span>&gt; inQueueSrc;</li><li>    AscendC::TQue&lt;AscendC::QuePosition::VECOUT, <span class="hljs-number">1</span>&gt; outQueueDst;</li><li>    AscendC::GlobalTensor&lt;half&gt; srcGlobal;</li><li>    AscendC::GlobalTensor&lt;half&gt; dstGlobal;</li><li>    AscendC::DataCopyPadExtParams&lt;half&gt; padParams;</li><li>    AscendC::DataCopyExtParams copyParams;</li><li>    half scalar = <span class="hljs-number">0</span>;</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> <span class="hljs-function">__global__ __aicore__ <span class="hljs-type">void</span> <span class="hljs-title">kernel_data_copy_pad_kernel</span><span class="hljs-params">(__gm__ <span class="hljs-type">uint8_t</span>* src_gm, __gm__ <span class="hljs-type">uint8_t</span>* dst_gm)</span></span></li><li><span class="hljs-function"></span>{</li><li>    TestDataCopyPad op;</li><li>    op.<span class="hljs-built_in">Init</span>(src_gm, dst_gm);</li><li>    op.<span class="hljs-built_in">Process</span>();</li><li>}</li></ol></pre></div></div> </div> <div class="p">结果示例：<div _ngcontent-ily-c106="" class="highlight-div"><div _ngcontent-ily-c106="" class="highlight-div-header"><div _ngcontent-ily-c106="" class="highlight-div-header-left"><div _ngcontent-ily-c106="" class="handle-button expand-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ily-c106="" class="highlight-div-header-right"><div _ngcontent-ily-c106="" class="handle-button ai-button"></div><div _ngcontent-ily-c106="" class="handle-button line-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ily-c106="" class="handle-button theme-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ily-c106="" class="handle-button copy-button"><div _ngcontent-ily-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ily-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-makefile" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-section">输入数据(src0Global): [1 2 3 ... 32]</span></li><li><span class="hljs-section">输出数据(dstGlobal):[1 2 3 ... 20]</span></li></ol></pre></div></div> </div> </div> </div> <div></div></div>