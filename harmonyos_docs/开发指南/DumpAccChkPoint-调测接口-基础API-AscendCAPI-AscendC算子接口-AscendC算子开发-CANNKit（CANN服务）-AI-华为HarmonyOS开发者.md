<h1 _ngcontent-vlq-c119="" class="doc-title ng-star-inserted" title="DumpAccChkPoint"> DumpAccChkPoint </h1>

<div _ngcontent-vlq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section29836mcpsimp">函数功能<i class="anchor-icon anchor-icon-link" anchorid="section29836mcpsimp" tips="复制节点链接"></i></h2><p>基于算子工程开发的算子，可以使用该接口Dump指定Tensor的内容。同时支持打印自定义的附加信息（仅支持uint32_t数据类型的信息），比如打印当前行号等。区别于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumptensor">DumpTensor</a>，使用该接口可以支持指定偏移位置的Tensor打印。</p> <p>在算子kernel侧实现代码中需要打印偏移后Tensor数据的地方调用DumpAccChkPoint接口打印相关内容。样例如下。</p> <div _ngcontent-vlq-c106="" class="highlight-div"><div _ngcontent-vlq-c106="" class="highlight-div-header"><div _ngcontent-vlq-c106="" class="highlight-div-header-left"><div _ngcontent-vlq-c106="" class="handle-button expand-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vlq-c106="" class="highlight-div-header-right"><div _ngcontent-vlq-c106="" class="handle-button ai-button"></div><div _ngcontent-vlq-c106="" class="handle-button line-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vlq-c106="" class="handle-button theme-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vlq-c106="" class="handle-button copy-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vlq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AscendC::<span class="hljs-built_in">DumpAccChkPoint</span>(srcLocal,<span class="hljs-number">5</span>, <span class="hljs-number">32</span>, dataLen);</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>DumpAccChkPoint接口打印功能会对算子实际运行的性能带来一定影响，通常在调测阶段使用。开发者可以按需通过如下方式关闭打印功能。</p> <p>自定义算子工程：</p> <p>修改算子工程op_kernel目录下的CMakeLists.txt文件，首行增加编译选项-DASCENDC_DUMP=0，关闭ASCENDC_DUMP开关，示例如下。</p> <div _ngcontent-vlq-c106="" class="highlight-div"><div _ngcontent-vlq-c106="" class="highlight-div-header"><div _ngcontent-vlq-c106="" class="highlight-div-header-left"><div _ngcontent-vlq-c106="" class="handle-button expand-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vlq-c106="" class="highlight-div-header-right"><div _ngcontent-vlq-c106="" class="handle-button ai-button"></div><div _ngcontent-vlq-c106="" class="handle-button line-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vlq-c106="" class="handle-button theme-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vlq-c106="" class="handle-button copy-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vlq-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 关闭所有算子的printf打印功能 </span></li><li><span class="hljs-built_in">add_ops_compile_options</span>(ALL OPTIONS -DASCENDC_DUMP=<span class="hljs-number">0</span>)</li></ol></pre></div></div> </div></div></div> <p>Dump时，每个block核的dump信息前会增加对应信息头DumpHead（32字节大小），用于记录核号和资源使用信息。每次Dump的Tensor数据前也会添加信息头DumpTensorHead（32字节大小），用于记录Tensor的相关信息。如下图所示，展示了多核打印场景下的打印信息结构。</p> <p class="msonormal"><span><img height="136.99" originheight="221" originwidth="842" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114315.52513025386334287819430337140336:50001231000000:2800:27EB485F1E3A06203EB1AD6A9916BF5871B6C6A3413CDAEDBA0AB0E2609D2355.png" title="点击放大" width="526.6800000000001"></span></p> <p><strong>DumpHead的具体信息如下。</strong></p> <ul><li>block_id：当前运行的核号。</li><li>total_block_num：此次dump的核数。</li><li>block_remain_len：当前核剩余可用的dump的空间。</li><li>block_initial_space：当前核初始分配的dump空间。</li><li>magic：内存校验魔术字。</li></ul> <p><strong>DumpTensorHead的具体信息如下。</strong></p> <ul><li>desc：开发者自定义附加信息。</li><li>addr：Tensor的地址。</li><li>data_type：Tensor的数据类型。</li><li>position：表示Tensor所在的物理存储位置，当前仅支持Unified Buffer/L1 Buffer/L0C Buffer/Global Memory。</li></ul> <p>打印结果的样例如下。</p> <div _ngcontent-vlq-c106="" class="highlight-div"><div _ngcontent-vlq-c106="" class="highlight-div-header"><div _ngcontent-vlq-c106="" class="highlight-div-header-left"><div _ngcontent-vlq-c106="" class="handle-button expand-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vlq-c106="" class="highlight-div-header-right"><div _ngcontent-vlq-c106="" class="handle-button ai-button"></div><div _ngcontent-vlq-c106="" class="handle-button line-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vlq-c106="" class="handle-button theme-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vlq-c106="" class="handle-button copy-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vlq-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">DumpHead</span>: <span class="hljs-title class_">block_id</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">total_block_num</span>=<span class="hljs-number">16</span>, <span class="hljs-variable">block_remain_len</span>=<span class="hljs-number">1048448</span>, <span class="hljs-variable">block_initial_space</span>=<span class="hljs-number">1048576</span>, <span class="hljs-variable">magic</span>=<span class="hljs-number">5</span><span class="hljs-variable">aa5bccd</span> </li><li><span class="hljs-variable">DumpTensor</span>: <span class="hljs-title class_">desc</span>=<span class="hljs-number">5</span>, <span class="hljs-variable">addr</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">data_type</span>=<span class="hljs-variable">DT_FLOAT16</span>, <span class="hljs-variable">position</span>=<span class="hljs-variable">UB</span> </li><li>[<span class="hljs-number">40</span>, <span class="hljs-number">82</span>, <span class="hljs-number">60</span>, <span class="hljs-number">11</span>, <span class="hljs-number">24</span>, <span class="hljs-number">55</span>, <span class="hljs-number">52</span>, <span class="hljs-number">60</span>, <span class="hljs-number">31</span>, <span class="hljs-number">86</span>, <span class="hljs-number">53</span>, <span class="hljs-number">61</span>, <span class="hljs-number">47</span>, <span class="hljs-number">54</span>, <span class="hljs-number">34</span>, <span class="hljs-number">62</span>, <span class="hljs-number">84</span>, <span class="hljs-number">29</span>, <span class="hljs-number">48</span>, <span class="hljs-number">95</span>, <span class="hljs-number">16</span>, <span class="hljs-number">0</span>, <span class="hljs-number">20</span>, <span class="hljs-number">77</span>, <span class="hljs-number">3</span>, <span class="hljs-number">55</span>, <span class="hljs-number">69</span>, <span class="hljs-number">73</span>, <span class="hljs-number">75</span>, <span class="hljs-number">40</span>, <span class="hljs-number">35</span>, <span class="hljs-number">13</span>] </li><li><span class="hljs-variable">DumpHead</span>: <span class="hljs-title class_">block_id</span>=<span class="hljs-number">1</span>, <span class="hljs-variable">total_block_num</span>=<span class="hljs-number">16</span>, <span class="hljs-variable">block_remain_len</span>=<span class="hljs-number">1048448</span>, <span class="hljs-variable">block_initial_space</span>=<span class="hljs-number">1048576</span>, <span class="hljs-variable">magic</span>=<span class="hljs-number">5</span><span class="hljs-variable">aa5bccd</span> </li><li><span class="hljs-variable">DumpTensor</span>: <span class="hljs-title class_">desc</span>=<span class="hljs-number">5</span>, <span class="hljs-variable">addr</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">data_type</span>=<span class="hljs-variable">DT_FLOAT16</span>, <span class="hljs-variable">position</span>=<span class="hljs-variable">UB</span> </li><li>[<span class="hljs-number">58</span>, <span class="hljs-number">84</span>, <span class="hljs-number">22</span>, <span class="hljs-number">54</span>, <span class="hljs-number">41</span>, <span class="hljs-number">93</span>, <span class="hljs-number">1</span>, <span class="hljs-number">45</span>, <span class="hljs-number">50</span>, <span class="hljs-number">9</span>, <span class="hljs-number">72</span>, <span class="hljs-number">81</span>, <span class="hljs-number">23</span>, <span class="hljs-number">96</span>, <span class="hljs-number">86</span>, <span class="hljs-number">45</span>, <span class="hljs-number">36</span>, <span class="hljs-number">9</span>, <span class="hljs-number">36</span>, <span class="hljs-number">34</span>, <span class="hljs-number">78</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">29</span>, <span class="hljs-number">47</span>, <span class="hljs-number">26</span>, <span class="hljs-number">13</span>, <span class="hljs-number">24</span>, <span class="hljs-number">27</span>, <span class="hljs-number">55</span>, <span class="hljs-number">90</span>, <span class="hljs-number">5</span>] </li><li><span class="hljs-comment">// ... </span></li><li><span class="hljs-variable">DumpHead</span>: <span class="hljs-title class_">block_id</span>=<span class="hljs-number">7</span>, <span class="hljs-variable">total_block_num</span>=<span class="hljs-number">16</span>, <span class="hljs-variable">block_remain_len</span>=<span class="hljs-number">1048448</span>, <span class="hljs-variable">block_initial_space</span>=<span class="hljs-number">1048576</span>, <span class="hljs-variable">magic</span>=<span class="hljs-number">5</span><span class="hljs-variable">aa5bccd</span> </li><li><span class="hljs-variable">DumpTensor</span>: <span class="hljs-title class_">desc</span>=<span class="hljs-number">5</span>, <span class="hljs-variable">addr</span>=<span class="hljs-number">0</span>, <span class="hljs-variable">data_type</span>=<span class="hljs-variable">DT_FLOAT16</span>, <span class="hljs-variable">position</span>=<span class="hljs-variable">UB</span> </li><li>[<span class="hljs-number">28</span>, <span class="hljs-number">27</span>, <span class="hljs-number">79</span>, <span class="hljs-number">39</span>, <span class="hljs-number">86</span>, <span class="hljs-number">5</span>, <span class="hljs-number">23</span>, <span class="hljs-number">97</span>, <span class="hljs-number">89</span>, <span class="hljs-number">5</span>, <span class="hljs-number">65</span>, <span class="hljs-number">69</span>, <span class="hljs-number">59</span>, <span class="hljs-number">13</span>, <span class="hljs-number">49</span>, <span class="hljs-number">2</span>, <span class="hljs-number">34</span>, <span class="hljs-number">6</span>, <span class="hljs-number">52</span>, <span class="hljs-number">38</span>, <span class="hljs-number">4</span>, <span class="hljs-number">90</span>, <span class="hljs-number">11</span>, <span class="hljs-number">11</span>, <span class="hljs-number">61</span>, <span class="hljs-number">50</span>, <span class="hljs-number">71</span>, <span class="hljs-number">98</span>, <span class="hljs-number">19</span>, <span class="hljs-number">54</span>, <span class="hljs-number">54</span>, <span class="hljs-number">99</span>]</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29878mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section29878mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-vlq-c106="" class="highlight-div"><div _ngcontent-vlq-c106="" class="highlight-div-header"><div _ngcontent-vlq-c106="" class="highlight-div-header-left"><div _ngcontent-vlq-c106="" class="handle-button expand-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vlq-c106="" class="highlight-div-header-right"><div _ngcontent-vlq-c106="" class="handle-button ai-button"></div><div _ngcontent-vlq-c106="" class="handle-button line-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vlq-c106="" class="handle-button theme-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vlq-c106="" class="handle-button copy-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vlq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpAccChkPoint</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; tensor, <span class="hljs-type">uint32_t</span> index, <span class="hljs-type">uint32_t</span> countOff, <span class="hljs-type">uint32_t</span> dumpSize)</span> </span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpAccChkPoint</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt;&amp; tensor, <span class="hljs-type">uint32_t</span> index, <span class="hljs-type">uint32_t</span> countOff, <span class="hljs-type">uint32_t</span> dumpSize)</span></span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29881mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section29881mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="16%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="72%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="16%"><p>tensor</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>需要dump的Tensor。</p> <p>待dump的tensor位于Unified Buffer/L1 Buffer/L0C Buffer时使用LocalTensor类型的tensor参数输入。</p> <p>待dump的tensor位于Global Memory时使用GlobalTensor类型的tensor参数输入。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>index</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>开发者自定义附加信息（行号或其他自定义数字）。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>dumpSize</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>需要dump的元素个数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>countOff</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>偏移元素个数。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section29927mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section29927mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section29930mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section29930mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section29935mcpsimp">约束说明<i class="anchor-icon anchor-icon-link" anchorid="section29935mcpsimp" tips="复制节点链接"></i></h2><ul><li>该功能仅在如下场景支持：<p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-overview-of-engineering-operator">工程化算子开发</a>方式调用算子。</p> </li><li>当前仅支持打印存储位置为Unified Buffer/L1 Buffer/L0C Buffer/Global Memory的Tensor信息。</li><li>操作数地址偏移对齐要求请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-general-constraints">通用约束</a>。</li><li>待dump的元素总长度需要32Byte对齐。</li><li>偏移量需保证32字节对齐，即：偏移元素个数 * sizeof（T）需按32B对齐。</li><li>程序中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-printf">printf</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-assert">assert</a>接口使用的空间+调用DumpTensor及DumpAccChkPoint接口使用的空间+框架dump功能所使用的空间，每个核上不可超过1M。请开发者自行控制待打印的内容数据量，超出则不会打印。</li></ul> </div> <div class="tiledSection"><h2 id="section29960mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section29960mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-vlq-c106="" class="highlight-div"><div _ngcontent-vlq-c106="" class="highlight-div-header"><div _ngcontent-vlq-c106="" class="highlight-div-header-left"><div _ngcontent-vlq-c106="" class="handle-button expand-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vlq-c106="" class="highlight-div-header-right"><div _ngcontent-vlq-c106="" class="handle-button ai-button"></div><div _ngcontent-vlq-c106="" class="handle-button line-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vlq-c106="" class="handle-button theme-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vlq-c106="" class="handle-button copy-button"><div _ngcontent-vlq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vlq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AscendC::<span class="hljs-built_in">DumpAccChkPoint</span>(srcLocal, <span class="hljs-number">7</span>, <span class="hljs-number">32</span> , <span class="hljs-number">128</span>);</li></ol></pre></div></div> </div> </div> <div></div></div>