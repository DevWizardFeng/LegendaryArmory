<h1 _ngcontent-hxl-c119="" class="doc-title ng-star-inserted" title="DumpAccChkPoint功能"> DumpAccChkPoint功能 </h1>

<div _ngcontent-hxl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section2913mcpsimp">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section2913mcpsimp" tips="复制节点链接"></i></h2><p>使用工具进行算子调测时，支持指定偏移位置的Tensor打印。<strong>该功能与</strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-function-dumptensor">DumpTensor功能</a><strong>类似</strong>，其使用更加灵活。</p> <p>当Tensor数据较大时，可通过DumpAccChkPoint指定偏移位置，截取指定长度的元素值打印。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>simulator调测场景下的Dump偏移位置Tensor，受dump mode参数控制。</li></ul> <ul><li>固定为每个核分配的打印数据的最大可使用空间为1M，目前该大小不支持修改，若打印超过1M，打印内容不再显示，请开发者控制待打印的数据量。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section2928mcpsimp">使用方法（命令行）<i class="anchor-icon anchor-icon-link" anchorid="section2928mcpsimp" tips="复制节点链接"></i></h2><ol><li><span>在核函数代码中按需在需要打印Tensor偏移数据的地方调用DumpAccChkPoint接口，接口说明参见表1，样例如下。</span><p></p><div _ngcontent-hxl-c106="" class="highlight-div"><div _ngcontent-hxl-c106="" class="highlight-div-header"><div _ngcontent-hxl-c106="" class="highlight-div-header-left"><div _ngcontent-hxl-c106="" class="handle-button expand-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hxl-c106="" class="highlight-div-header-right"><div _ngcontent-hxl-c106="" class="handle-button ai-button"></div><div _ngcontent-hxl-c106="" class="handle-button line-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hxl-c106="" class="handle-button theme-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hxl-c106="" class="handle-button copy-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hxl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">DumpAccChkPoint</span>(srcLocal, <span class="hljs-number">5</span>, <span class="hljs-number">32</span>, dataLen);</li></ol></pre></div></div> <p></p></li><li><span>simulator调测场景执行如下命令，使能Dump开关。</span><p></p><div _ngcontent-hxl-c106="" class="highlight-div"><div _ngcontent-hxl-c106="" class="highlight-div-header"><div _ngcontent-hxl-c106="" class="highlight-div-header-left"><div _ngcontent-hxl-c106="" class="handle-button expand-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hxl-c106="" class="highlight-div-header-right"><div _ngcontent-hxl-c106="" class="handle-button ai-button"></div><div _ngcontent-hxl-c106="" class="handle-button line-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hxl-c106="" class="handle-button theme-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hxl-c106="" class="handle-button copy-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hxl-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>ascendebug kernel<strong class="shell, console"> --backend</strong> simulator<strong class="shell, console"> --dump-mode</strong> acc_chk ... {其他simulator调测参数}</li></ol></pre></div></div> <p>--dump-mode取acc_chk，开启偏移位置打印Tensor模式，其他参数参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cli-parameters#section1351011652416">NPU调测参数</a>按需配置。</p> <p></p></li><li><span>查看dump结果。</span><p></p><p>Dump偏移位置Tensor数据存放在${root}/${work_dir}/npu路径下，其目录结构、结果说明与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-function-dumptensor">DumpTensor功能</a>类似。</p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section2959mcpsimp">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section2959mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>DumpAccChkPoint接口说明表</caption><tbody><tr><th class="firstcol" id="mcps1.3.3.2.2.4.1.1" valign="top"><p>函数原型</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>void DumpAccChkPoint(const LocalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t offset, uint32_t dumpNum)</li><li>void DumpAccChkPoint(const GlobalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t offset, uint32_t dumpNum)</li></ul> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.2.1" valign="top"><p>函数功能</p> </th> <td class="cellrowborder" colspan="2" valign="top"><p>支持指定偏移位置的Tensor打印。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.3.1" rowspan="4" valign="top" width="23%"><p>参数(IN)</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>tensor</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>开发者需要Dump的Tensor。多个DumpTensor调用时，不可重复。</p> <ul><li>待dump的Tensor位于Unified Buffer/L1 Buffer/L0C Buffer时使用LocalTensor类型的Tensor参数输入。</li><li>待dump的Tensor位于Global Memory时使用GlobalTensor类型的Tensor参数输入。</li><li>当前支持的数据类型为uint8_t、int8_t、int16_t、uint16_t、int32_t、uint32_t、float、half。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>desc</p> </td> <td class="cellrowborder" valign="top"><p>开发者自定义附加信息（行号或其他自定义数字）。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>offset</p> </td> <td class="cellrowborder" valign="top"><p>偏移元素个数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>dumpNum</p> </td> <td class="cellrowborder" valign="top"><p>需要Dump的元素个数。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.7.1" valign="top" width="23%"><p>参数(OUT)</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.8.1" valign="top" width="23%"><p>返回值</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.9.1" valign="top"><p>使用约束</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>当前接口仅支持位于Unified Buffer/L1 Buffer/L0C Buffer/Global Memory的数据Dump。</li><li>偏移量需符合UB读取数据32B对齐的限制，即offset*sizeof(T)需按32B对齐。</li><li>每次Dump的大小(dataNum*sizeof(T))需要32B对齐。</li></ul> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.10.1" valign="top"><p>调用示例</p> </th> <td class="cellrowborder" colspan="2" valign="top"><div _ngcontent-hxl-c106="" class="highlight-div"><div _ngcontent-hxl-c106="" class="highlight-div-header"><div _ngcontent-hxl-c106="" class="highlight-div-header-left"><div _ngcontent-hxl-c106="" class="handle-button expand-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hxl-c106="" class="highlight-div-header-right"><div _ngcontent-hxl-c106="" class="handle-button ai-button"></div><div _ngcontent-hxl-c106="" class="handle-button line-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hxl-c106="" class="handle-button theme-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hxl-c106="" class="handle-button copy-button"><div _ngcontent-hxl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hxl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">DumpAccChkPoint</span>(srcLocal, <span class="hljs-number">7</span>, <span class="hljs-number">32</span> , <span class="hljs-number">128</span>);</li></ol></pre></div></div> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>