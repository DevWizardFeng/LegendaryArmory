<h1 _ngcontent-crt-c119="" class="doc-title ng-star-inserted" title="DumpTensor"> DumpTensor </h1>

<div _ngcontent-crt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section29454mcpsimp">函数功能<i class="anchor-icon anchor-icon-link" anchorid="section29454mcpsimp" tips="复制节点链接"></i></h2><p>基于算子工程开发的算子，可以使用该接口Dump指定Tensor的内容。同时支持打印自定义的附加信息（仅支持uint32_t数据类型的信息），比如打印当前行号等。</p> <p>在算子kernel侧实现代码中需要打印Tensor数据的地方调用DumpTensor接口打印相关内容。样例如下。</p> <div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AscendC::<span class="hljs-built_in">DumpTensor</span>(srcLocal,<span class="hljs-number">5</span>, dataLen);</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>DumpTensor接口打印功能会对算子实际运行的性能带来一定影响，通常在调测阶段使用。开发者可以按需通过如下方式关闭打印功能。</p> <p>自定义算子工程：</p> <p>修改算子工程op_kernel目录下的CMakeLists.txt文件，首行增加编译选项-DASCENDC_DUMP=0，关闭ASCENDC_DUMP开关，示例如下。</p> <div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 关闭所有算子的printf打印功能 </span></li><li><span class="hljs-built_in">add_ops_compile_options</span>(ALL OPTIONS -DASCENDC_DUMP=<span class="hljs-number">0</span>)</li></ol></pre></div></div> </div></div></div> <p>打印示例如下。</p> <div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-diff" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-deletion">-19.046875,62.15625,-56.0625,-12.515625,-82.8125,70.5625,-57.65625,67.0625,</span></li><li>62.8125,30.234375,48.0,-10.8984375,18.171875,-30.4375,-25.3125,-77.1875,</li><li>21.21875,-70.25,-2.8125,69.375,-69.1875,-60.8125,-48.3125,51.21875,</li><li>74.3125,-47.5,2.923828125,-7.05859375,63.5,-89.1875,2.236328125,-52.1875,</li><li>97.75,-17.21875,-0.30322265625,31.640625,39.09375,-3.013671875,36.125,-30.015625,</li><li><span class="hljs-deletion">-39.40625,26.59375,27.859375,89.0,-36.125,61.6875,70.375,74.5625,</span></li><li><span class="hljs-deletion">-75.875,-46.0625,73.5625,51.59375,-30.09375,96.3125,77.25,42.90625,</span></li><li><span class="hljs-deletion">-74.9375,-89.9375,30.046875,-76.1875,61.5625,-8.7578125,38.28125,-55.71875,</span></li><li>
</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29495mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section29495mcpsimp" tips="复制节点链接"></i></h2><ul><li>无Tensor shape的打印<div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpTensor</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt; &amp;tensor, <span class="hljs-type">uint32_t</span> desc, <span class="hljs-type">uint32_t</span> dumpSize)</span> </span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpTensor</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor&lt;T&gt;&amp; tensor, <span class="hljs-type">uint32_t</span> desc, <span class="hljs-type">uint32_t</span> dumpSize)</span></span></li></ol></pre></div></div> </li><li>带Tensor shape的打印<div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpTensor</span><span class="hljs-params">(<span class="hljs-type">const</span> LocalTensor&lt;T&gt; &amp;tensor, <span class="hljs-type">uint32_t</span> desc, <span class="hljs-type">uint32_t</span> dumpNum, <span class="hljs-type">const</span> ShapeInfo&amp; shapeInfo)</span> </span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DumpTensor</span><span class="hljs-params">(<span class="hljs-type">const</span> GlobalTensor&lt;T&gt; &amp;tensor, <span class="hljs-type">uint32_t</span> desc, <span class="hljs-type">uint32_t</span> dumpNum, <span class="hljs-type">const</span> ShapeInfo&amp; shapeInfo)</span></span></li></ol></pre></div></div> </li></ul> </div> <div class="tiledSection"><h2 id="section29504mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section29504mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="16%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="72%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="16%"><p>tensor</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>需要dump的Tensor。</p> <ul><li>待dump的tensor位于Unified Buffer/L1 Buffer/L0C Buffer时使用LocalTensor类型的tensor参数输入。</li><li>待dump的tensor位于Global Memory时使用GlobalTensor类型的tensor参数输入。</li><li>当前支持的数据类型为uint8_t/int8_t/int16_t/uint16_t/int32_t/uint32_t/int64_t/uint64_t/float/half。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>desc</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>开发者自定义附加信息（行号或其他自定义数字）。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>dumpSize</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>需要dump的元素个数。<strong>dump的元素总长度需要32Byte对齐。</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>shapeInfo</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>传入Tensor的shape信息，可按照shape信息进行打印。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section29553mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section29553mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section29556mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section29556mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section29561mcpsimp">约束说明<i class="anchor-icon anchor-icon-link" anchorid="section29561mcpsimp" tips="复制节点链接"></i></h2><ul><li><strong>该功能仅在如下场景支持：</strong><p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-overview-of-engineering-operator">工程化算子开发</a>方式调用算子。</p> </li><li><strong>当前仅支持打印存储位置为Unified Buffer/L1 Buffer/L0C Buffer/Global Memory的Tensor信息。</strong></li><li>操作数地址偏移对齐要求请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-general-constraints">通用约束</a>。</li><li>程序中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-printf">printf</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-assert">assert</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumpaccch">DumpAccChkPoint</a>接口使用的空间+调用DumpTensor接口使用的空间+框架dump功能所使用的空间，每个核上不可超过1M。请开发者自行控制待打印的内容数据量，超出则不会打印。</li></ul> </div> <div class="tiledSection"><h2 id="section29586mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section29586mcpsimp" tips="复制节点链接"></i></h2><ul><li>无Tensor shape的打印<div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AscendC::<span class="hljs-built_in">DumpTensor</span>(srcLocal,<span class="hljs-number">5</span>, dataLen);</li></ol></pre></div></div> </li><li>带Tensor shape的打印<div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint32_t</span> array[] = {<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(<span class="hljs-number">8</span>),<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(<span class="hljs-number">8</span>)}; </li><li><span class="hljs-function">AscendC::ShapeInfo <span class="hljs-title">shapeInfo</span><span class="hljs-params">(<span class="hljs-number">2</span>, array)</span></span>;       <span class="hljs-comment">// dim为2， shape为(8,8) </span></li><li>AscendC::<span class="hljs-built_in">DumpTensor</span>(x, <span class="hljs-number">2</span>, <span class="hljs-number">64</span>, shapeInfo);     <span class="hljs-comment">// dump x的64个元素，且解析按照shapeInfo的(8,8)排列</span></li></ol></pre></div></div> </li></ul> <div class="p">打印结果如下。<div _ngcontent-crt-c106="" class="highlight-div"><div _ngcontent-crt-c106="" class="highlight-div-header"><div _ngcontent-crt-c106="" class="highlight-div-header-left"><div _ngcontent-crt-c106="" class="handle-button expand-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-crt-c106="" class="highlight-div-header-right"><div _ngcontent-crt-c106="" class="handle-button ai-button"></div><div _ngcontent-crt-c106="" class="handle-button line-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-crt-c106="" class="handle-button theme-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-crt-c106="" class="handle-button copy-button"><div _ngcontent-crt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-crt-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-attr">[[150.000000,83.000000,109.000000,166.000000,129.000000,50.000000,150.000000,74.000000]</span>, </li><li><span class="hljs-selector-attr">[135.000000,79.000000,98.000000,134.000000,146.000000,166.000000,112.000000,70.000000]</span>, </li><li><span class="hljs-selector-attr">[122.000000,51.000000,116.000000,68.000000,172.000000,72.000000,102.000000,69.000000]</span>, </li><li><span class="hljs-selector-attr">[136.000000,83.000000,88.000000,88.000000,112.000000,148.000000,79.000000,136.000000]</span>, </li><li><span class="hljs-selector-attr">[133.000000,104.000000,83.000000,71.000000,83.000000,99.000000,103.000000,151.000000]</span>, </li><li><span class="hljs-selector-attr">[98.000000,118.000000,128.000000,83.000000,25.000000,105.000000,179.000000,34.000000]</span>, </li><li><span class="hljs-selector-attr">[104.000000,169.000000,115.000000,113.000000,134.000000,121.000000,88.000000,96.000000]</span>, </li><li><span class="hljs-selector-attr">[29.000000,139.000000,70.000000,40.000000,158.000000,138.000000,72.000000,171.000000]</span>]</li></ol></pre></div></div> </div> </div> </div> <div></div></div>