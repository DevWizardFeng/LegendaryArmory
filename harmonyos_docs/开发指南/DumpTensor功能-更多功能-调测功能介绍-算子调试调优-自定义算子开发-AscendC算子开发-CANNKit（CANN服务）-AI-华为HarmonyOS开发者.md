<h1 _ngcontent-fpj-c119="" class="doc-title ng-star-inserted" title="DumpTensor功能"> DumpTensor功能 </h1>

<div _ngcontent-fpj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section2781mcpsimp">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section2781mcpsimp" tips="复制节点链接"></i></h2><p>使用工具进行算子调测时，支持DumpTensor功能，默认从Tensor的第0位元素开始打印指定长度的元素值。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>simulator调测场景下的DumpTensor，受dump mode参数控制。</li></ul> <ul><li>固定为每个核分配的打印数据的最大可使用空间为1M，目前该大小不支持修改，若打印超过1M，打印内容不再显示，请开发者控制待打印的数据量。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section2790mcpsimp">使用方法（命令行）<i class="anchor-icon anchor-icon-link" anchorid="section2790mcpsimp" tips="复制节点链接"></i></h2><ol><li><span>在核函数代码中按需在目标位置调用DumpTensor接口，接口说明参见表1，样例如下。</span><p></p><div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">DumpTensor</span>(srcLocal, <span class="hljs-number">5</span>, dataNum); </li></ol></pre></div></div> <p></p></li><li><span>simulator调测场景执行如下命令，使能Dump开关。</span><p></p><div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>ascendebug kernel<strong> <span class="hljs-attr">--backend</span></strong> simulator<strong class="shell"> <span class="hljs-attr">--dump-mode</span></strong> <span class="hljs-attribute">normal</span> ... {其他simulator调测参数}</li></ol></pre></div></div> <p>--dump-mode取normal，开启通用打印Tensor模式，其他参数参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cli-parameters#section1351011652416">NPU调测参数</a>按需配置。</p> <p></p></li><li><span>查看dump结果，具体参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-function-dumptensor#section2903mcpsimp">产物说明</a>。</span></li></ol> </div> <div class="tiledSection"><h2 id="section2806mcpsimp">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section2806mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>DumpTensor接口说明表</caption><tbody><tr><th class="firstcol" id="mcps1.3.3.2.2.4.1.1" valign="top"><p>函数原型</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>void DumpTensor(const LocalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t dumpNum)</li><li>void DumpTensor(const GlobalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t dumpNum)</li><li>void DumpTensor(const LocalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t dumpNum, const ShapeInfo&amp; shapeInfo)</li><li>void DumpTensor(const GlobalTensor&lt;T&gt; &amp;tensor, uint32_t desc, uint32_t dumpNum, const ShapeInfo&amp; shapeInfo)</li></ul> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.2.1" valign="top"><p>函数功能</p> </th> <td class="cellrowborder" colspan="2" valign="top"><p>从Tensor的第0位元素开始打印指定长度的元素值。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.3.1" rowspan="4" valign="top" width="19.8%"><p>参数(IN)</p> </th> <td class="cellrowborder" valign="top" width="19.8%"><p>tensor</p> </td> <td class="cellrowborder" valign="top" width="60.4%"><p>开发者需要Dump的Tensor。多个DumpTensor调用时，不可重复。</p> <ul><li>待dump的tensor位于Unified Buffer/L1 Buffer/L0C Buffer时使用LocalTensor类型的tensor参数输入。</li><li>待dump的tensor位于Global Memory时使用GlobalTensor类型的tensor参数输入。</li><li>当前支持的数据类型为uint8_t/int8_t/int16_t/uint16_t/int32_t/uint32_t/int64_t/uint64_t/float/half。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>desc</p> </td> <td class="cellrowborder" valign="top"><p>开发者自定义附加信息（行号或其他自定义数字）。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>dumpNum</p> </td> <td class="cellrowborder" valign="top"><p>需要Dump的元素个数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>shapeInfo</p> </td> <td class="cellrowborder" valign="top"><p>如果有Tensor的shape信息，工具可解析shapeInfo并进行打印。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.7.1" valign="top" width="19.8%">&nbsp;&nbsp;</th> <td class="cellrowborder" valign="top" width="19.8%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="60.4%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.8.1" valign="top" width="19.8%">&nbsp;&nbsp;</th> <td class="cellrowborder" valign="top" width="19.8%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="60.4%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.9.1" valign="top"><p>参数(OUT)</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>当前接口仅支持位于Unified Buffer/L1 Buffer/L0C Buffer/Global Memory的数据Dump。</li><li>每次Dump的大小(dataNum*sizeof(T))需要32B对齐。</li></ul> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.10.1" valign="top"><p>调用示例</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>示例1：无Tensor shape的打印<div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">DumpTensor</span>(srcLocal,<span class="hljs-number">5</span>, dataNum);      # <span class="hljs-function">Dump LM</span></li><li><span class="hljs-function"><span class="hljs-title">DumpTensor</span><span class="hljs-params">(<span class="hljs-keyword">this</span>-&gt;gm_, <span class="hljs-number">0</span>, dataNum)</span></span>;    # Dump GM</li></ol></pre></div></div> </li></ul> <ul><li>示例2：带Tensor shape的打印<div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">uint32_t</span> array[] = {<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(<span class="hljs-number">8</span>),<span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(<span class="hljs-number">8</span>)}; </li><li><span class="hljs-function">ShapeInfo <span class="hljs-title">shapeInfo</span><span class="hljs-params">(<span class="hljs-number">2</span>, array)</span></span>;       <span class="hljs-meta"># dim为2， shape为(8,8) </span></li><li><span class="hljs-built_in">DumpTensor</span>(x, <span class="hljs-number">2</span>, <span class="hljs-number">64</span>, shapeInfo);     <span class="hljs-meta"># dump x的64个元素，且解析按照shapeInfo的(8,8)排列</span></li></ol></pre></div></div> <p>打印结果如下。</p> <div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li> [[150.000000,83.000000,109.000000,166.000000,129.000000,50.000000,150.000000,74.000000], </li><li> [135.000000,79.000000,98.000000,134.000000,146.000000,166.000000,112.000000,70.000000], </li><li> [122.000000,51.000000,116.000000,68.000000,172.000000,72.000000,102.000000,69.000000], </li><li> [136.000000,83.000000,88.000000,88.000000,112.000000,148.000000,79.000000,136.000000], </li><li> [133.000000,104.000000,83.000000,71.000000,83.000000,99.000000,103.000000,151.000000], </li><li> [98.000000,118.000000,128.000000,83.000000,25.000000,105.000000,179.000000,34.000000], </li><li> [104.000000,169.000000,115.000000,113.000000,134.000000,121.000000,88.000000,96.000000], </li><li> [29.000000,139.000000,70.000000,40.000000,158.000000,138.000000,72.000000,171.000000]]</li></ol></pre></div></div> </li></ul> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section2903mcpsimp">产物说明<i class="anchor-icon anchor-icon-link" anchorid="section2903mcpsimp" tips="复制节点链接"></i></h2><p>Dump的Tensor数据存放在${root}/${work_dir}/simulator路径下，其中${root}表示当前操作路径，${work_dir}表示调测工作空间，默认为/debug_workspace/${op_type}目录，${op_type}为算子名。目录结构示例如下。</p> <div _ngcontent-fpj-c106="" class="highlight-div"><div _ngcontent-fpj-c106="" class="highlight-div-header"><div _ngcontent-fpj-c106="" class="highlight-div-header-left"><div _ngcontent-fpj-c106="" class="handle-button expand-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fpj-c106="" class="highlight-div-header-right"><div _ngcontent-fpj-c106="" class="handle-button ai-button"></div><div _ngcontent-fpj-c106="" class="handle-button line-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fpj-c106="" class="handle-button theme-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fpj-c106="" class="handle-button copy-button"><div _ngcontent-fpj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fpj-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>├ ${op_type}     // 算子名 </li><li>├── simulator </li><li>│   ├── dump </li><li>│       ├── PARSER_${timestamp} </li><li>│           ├── dump_data </li><li>│               ├──0                     // core number </li><li>│                   ├──index_5           // index是dump接口的desc唯一标识值 </li><li>│                       ├──core_0_index_5_loop_0.bin </li><li>│                       ├──core_0_index_5_loop_0.txt    </li><li>│                       ├──core_0_index_5_loop_1.bin </li><li>│                       ├──core_0_index_5_loop_1.txt </li><li>│               ├──index_dtype.json       // 存放每个dump Tensor的数据类型</li></ol></pre></div></div> <p>其中core_${core_id}_index_${index}_loop_${loop}.txt是工具根据bin文件自动解析的Dump结果，其命名规则为：</p> <ul><li>${core_id}：计算核id。</li><li>${index}：是Dump接口的desc唯一标识值。</li><li>${loop}：若DumpTensor接口在for循环中被调用，其表示循环的索引值，否则默认为0。</li></ul> </div> </div> <div></div></div>