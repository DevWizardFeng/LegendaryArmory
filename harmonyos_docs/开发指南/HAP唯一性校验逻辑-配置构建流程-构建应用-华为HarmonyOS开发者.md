<h1 _ngcontent-css-c119="" class="doc-title ng-star-inserted" title="HAP唯一性校验逻辑"> HAP唯一性校验逻辑 </h1>

<div _ngcontent-css-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001772544660"><p id="ZH-CN_TOPIC_0000002478174504__p17874414565">HAP是应用安装的基本单位，在DevEco Studio工程目录中，一个HAP对应一个Module。应用打包时，每个Module生成一个.hap文件。</p> <p id="ZH-CN_TOPIC_0000002478174504__p9620205516546">应用如果包含多个Module，在应用市场上架时，会将多个.hap文件打包成一个.app文件（称为Bundle），但在云端分发和端侧安装时，仍然是以HAP为基本单位。</p> <p id="ZH-CN_TOPIC_0000002478174504__p6734116413">为了能够正常分发和安装应用，需要保证一个应用安装到设备时，Module的名称、Ability的名称不重复，并且只有一个Entry类型的Module与目标设备相对应。</p> <p id="ZH-CN_TOPIC_0000002478174504__p433925810205">DevEco Studio会在编译构建时，对HAP进行上述唯一性校验，如果校验不通过，将会编译失败或给出告警。</p> <div class="tiledSection"><h2 id="section155433555205">Module校验逻辑<i class="anchor-icon anchor-icon-link" anchorid="section155433555205" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174504__p13147144434411">校验目的：同一目标设备上Module唯一。</p> <ol id="ZH-CN_TOPIC_0000002478174504__ol1373583035616"><li id="li19735133075610"><span>校验Module的Name。如果多个Module的Name不同，则校验通过。如果Name相同，继续校验deviceType。</span></li><li id="li13383124895718"><span>校验设备类型deviceType。如果deviceType不相交，则校验通过。如果deviceType相交，继续校验distributionFilter。</span><p></p><p id="ZH-CN_TOPIC_0000002478174504__p57461024501">deviceType不相交是指两个Module的deviceType中配置了完全不同的设备，例如：</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" id="ZH-CN_TOPIC_0000002478174504__screen16481811713" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Module1和Module2配置了完全不同的设备，deviceType不相交。</span></li><li><span class="hljs-comment">//Module1</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"deviceType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"tv"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"tablet"</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li><li><span class="hljs-comment">//Module2</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"deviceType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"car"</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478174504__p477115171620">deviceType相交是指两个Module的deviceType中包含了相同的设备，例如：</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" id="ZH-CN_TOPIC_0000002478174504__screen6631805580" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Module1和Module2因为都包含"tablet"设备，导致deviceType相交。</span></li><li><span class="hljs-comment">//Module1</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"deviceType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"tv"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"tablet"</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li><li><span class="hljs-comment">//Module2</span></li><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"deviceType"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span><span class="hljs-string">"car"</span><span class="hljs-punctuation">,</span> <span class="hljs-string">"tablet"</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> <p></p></li><li id="li1036818685914"><span>校验分发规则distributionFilter。如果distributionFilter不相交，则校验通过。如果distributionFilter相交，则无法保证Module唯一性，校验失败，打包失败。</span><p></p><p id="ZH-CN_TOPIC_0000002478174504__p1766718241092">distributionFilter中包含属性apiVersion、screenShape、screenWindow、screenDensity和countryCode。相交的相关含义如下：</p> <ul id="ZH-CN_TOPIC_0000002478174504__ul64172396915"><li id="li184177394910">distributionFilter不相交：如果两个distributionFilter中任意一个属性不相交，则两个distributionFilter不相交。</li><li id="li2196164216918">distributionFilter相交：如果两个distributionFilter中所有属性都相交，则两个distributionFilter相交。</li></ul> <p id="ZH-CN_TOPIC_0000002478174504__p18109142107">例如，两 Module 中的apiVersion、screenShape、screenWindow、screenDensity都相交，但countryCode不相交，则可以区分两个Module，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen6397162819105" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Module1和Module2的两个distributionFilter中，countryCode不相交，则两个distributionFilter不相交。</span></li><li><span class="hljs-comment">//Module1</span></li><li>{</li><li>  <span class="hljs-string">"distributionFilter"</span>: {</li><li>    <span class="hljs-string">"apiVersion"</span> : {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-number">10</span>,<span class="hljs-number">11</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenShape"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"rect"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenWindow"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"454*454"</span>, <span class="hljs-string">"466*466"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenDensity"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"ldpi"</span>, <span class="hljs-string">"xldpi"</span>]</li><li>    },</li><li>    <span class="hljs-string">"countryCode"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"CN"</span>, <span class="hljs-string">"HK"</span>]</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-comment">//Module2</span></li><li>{</li><li>  <span class="hljs-string">"distributionFilter"</span>: {</li><li>    <span class="hljs-string">"apiVersion"</span> : {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-number">10</span>,<span class="hljs-number">11</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenShape"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"rect"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenWindow"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"454*454"</span>, <span class="hljs-string">"466*466"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenDensity"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"ldpi"</span>, <span class="hljs-string">"xldpi"</span>]</li><li>    },</li><li>    <span class="hljs-string">"countryCode"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"USA"</span>, <span class="hljs-string">"UK"</span>]</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section95465556203">Ability校验逻辑<i class="anchor-icon anchor-icon-link" anchorid="section95465556203" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174504__p323517354442">校验目的：同一目标设备上Ability唯一。</p> <ol id="ZH-CN_TOPIC_0000002478174504__ol1594712114319"><li id="li394719211433"><span>校验Ability的Name。如果多个Ability的Name不同，则校验通过。如果Name相同，继续校验Ability所属Module的deviceType。</span></li><li id="li156611557164313"><span>校验Ability所属Module的deviceType。如果deviceType不相交，校验通过。如果deviceType相交，继续校验Ability所属Module的distributionFilter。</span><p></p><p id="ZH-CN_TOPIC_0000002478174504__p177461721516">例如，两个Ability的Name相同，但其所属Module的deviceType不相交，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen659055105118" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Ability1和Ability2虽然名称相同，但由于其所属Module的deviceType不相交，所以可以区分两个Ability，校验通过。</span></li><li><span class="hljs-comment">//Ability1</span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample1"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"tv"</span></span>, <span class=""><span class="hljs-string">"tablet"</span></span>],</li><li>    <span class=""><span class="hljs-string">"abilities"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"ability_sample"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class="hljs-comment">//Ability2</span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample2"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"car"</span></span>],</li><li>    <span class=""><span class="hljs-string">"abilities"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"ability_sample"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li><li id="li19701529104719"><span>校验Ability所属Module的distributionFilter。如果distributionFilter不相交，校验通过。如果distributionFilter相交，校验失败，抛出告警。</span><p></p><p id="ZH-CN_TOPIC_0000002478174504__p18887451533">例如，两个Ability的Name相同，其所属Module的deviceType也相交，但其所属Module的distributionFilter不相交，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen157059323572" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//Ability1和Ability2的Name相同，而且其所属Module的deviceType相交，但其所属Module的distributionFilter不相交，所以可以区分两个Ability，校验通过。</span></li><li><span class="hljs-comment">//Ability1</span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"tv"</span></span>, <span class=""><span class="hljs-string">"tablet"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_config_sample1"</span></span></li><li>      }</li><li>    ],</li><li>    <span class=""><span class="hljs-string">"abilities"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"ability_sample"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class="hljs-comment">//Ability1所属Module的distributionFilter</span></li><li>{</li><li>  <span class="hljs-string">"distributionFilter"</span>: {</li><li>    <span class="hljs-string">"apiVersion"</span> : {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-number">10</span>,<span class="hljs-number">11</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenShape"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"rect"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenWindow"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"454*454"</span>, <span class="hljs-string">"466*466"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenDensity"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"ldpi"</span>, <span class="hljs-string">"xldpi"</span>]</li><li>    },</li><li>    <span class="hljs-string">"countryCode"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"CN"</span>, <span class="hljs-string">"HK"</span>]</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">//Ability2</span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample2"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>:  [<span class=""><span class="hljs-string">"tv"</span></span>, <span class=""><span class="hljs-string">"tablet"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_config_sample2"</span></span></li><li>      }</li><li>    ],</li><li>    <span class=""><span class="hljs-string">"abilities"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"ability_sample"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class="hljs-comment">//Ability2所属Module的distributionFilter</span></li><li>{</li><li>  <span class="hljs-string">"distributionFilter"</span>: {</li><li>    <span class="hljs-string">"apiVersion"</span> : {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-number">10</span>,<span class="hljs-number">11</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenShape"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"rect"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenWindow"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"454*454"</span>, <span class="hljs-string">"466*466"</span>]</li><li>    },</li><li>    <span class="hljs-string">"screenDensity"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"ldpi"</span>, <span class="hljs-string">"xldpi"</span>]</li><li>    },</li><li>    <span class="hljs-string">"countryCode"</span>: {</li><li>      <span class="hljs-string">"policy"</span>: <span class="hljs-string">"include"</span>,</li><li>      <span class="hljs-string">"value"</span>: [<span class="hljs-string">"USA"</span>, <span class="hljs-string">"UK"</span>]</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section1354845542015">Entry校验逻辑<i class="anchor-icon anchor-icon-link" anchorid="section1354845542015" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174504__p1794115173913">校验目的：目标设备只有一个Entry类型的Module与之对应，Feature类型的Module经过deviceType及distributionFilter指明的目标设备都需要存在Entry类型的Module。</p> <ol id="ZH-CN_TOPIC_0000002478174504__ol18962124373512"><li id="li1496234383510"><span>校验Feature类型的Module经过deviceType及distributionFilter指明的目标设备都存在Entry类型的Module。</span><p></p><p id="ZH-CN_TOPIC_0000002478174504__p18798247142">例如，Bundle中存在一个Entry类型Module1，其支持设备为tablet和wearable，其分发规则为circle和rect形状的屏幕，同时存在一个Feature类型的Module2，通过分发规则可知，其可以分发到rect形状的tablet和wearable设备上，而rect形状的tablet和wearable设备上存在Entry类型的Module1，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen2349653194910" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">//Entry</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module1</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample1"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"entry"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"tablet"</span></span>, <span class=""><span class="hljs-string">"wearable"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_config1"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Module1</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">distributionFilter</span></span><span class=""><span class="hljs-comment">，</span></span><span class=""><span class="hljs-comment">distributionFilter_config1.json</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"screenShape"</span></span>:{</li><li>    <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>,</li><li>    <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"circle"</span></span>, <span class=""><span class="hljs-string">"rect"</span></span>]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Feature</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module2</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample2"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"feature"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"tablet"</span></span>, <span class=""><span class="hljs-string">"wearable"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_config2"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Module2</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">distributionFilter</span></span><span class=""><span class="hljs-comment">，</span></span><span class=""><span class="hljs-comment">distributionFilter_config2.json</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"screenShape"</span></span>:{</li><li>    <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>,</li><li>    <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"rect"</span></span>]</li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li><li id="li10450158144618"><span>校验目标设备只有一个Entry类型的Module与之对应。</span><p></p><ol id="ZH-CN_TOPIC_0000002478174504__ol17708183334713"><li id="li435173320476">校验Entry类型Module的deviceType。如果deviceType不相交，校验通过。如果deviceType相交，继续校验Entry类型Module的distributionFilter。<p id="ZH-CN_TOPIC_0000002478174504__p14366172845015">例如，同一个Bundle中存在两个Entry类型的Module，分别为Module1和Module2，两者的deviceType不相交，可以有效区分两个Module，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen9578201710503" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">//Entry</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module1</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample1"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"entry"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"tablet"</span></span>]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Entry</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module2</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample2"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"entry"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"wearable"</span></span>]</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li163896487482">校验Entry类型Module的distributionFilter。如果distributionFilter不相交，校验通过。如果distributionFilter相交，校验失败，打包失败。<p id="ZH-CN_TOPIC_0000002478174504__p32111712545">例如，同一个Bundle中存在两个Entry类型的Module，分别为Module1和Module2，两者的deviceType相交，但两者的distributionFilter不相交，可以有效区分两个Module，校验通过。</p> <div _ngcontent-css-c106="" class="highlight-div"><div _ngcontent-css-c106="" class="highlight-div-header"><div _ngcontent-css-c106="" class="highlight-div-header-left"><div _ngcontent-css-c106="" class="handle-button expand-button"><div _ngcontent-css-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-css-c106="" class="highlight-div-header-right"><div _ngcontent-css-c106="" class="handle-button ai-button"></div><div _ngcontent-css-c106="" class="handle-button line-button"><div _ngcontent-css-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-css-c106="" class="handle-button theme-button"><div _ngcontent-css-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-css-c106="" class="handle-button copy-button"><div _ngcontent-css-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-css-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174504__screen68789504516" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">//Entry</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module1</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample1"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"entry"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"wearable"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>:<span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_sample1"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Module1</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">distributionFilter</span></span><span class=""><span class="hljs-comment">，</span></span><span class=""><span class="hljs-comment">distributionFilter_sample1.json</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"distributionFilter"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"screenShape"</span></span>:{</li><li>      <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>,</li><li>      <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"rect"</span></span>]</li><li>    }</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Entry</span></span><span class=""><span class="hljs-comment">类型</span></span><span class=""><span class="hljs-comment">Module2</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"module_sample2"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"entry"</span></span>,</li><li>    <span class=""><span class="hljs-string">"deviceType"</span></span>: [<span class=""><span class="hljs-string">"wearable"</span></span>],</li><li>    <span class=""><span class="hljs-string">"metadata"</span></span>: [</li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>:<span class=""><span class="hljs-string">"distributionFilter_config"</span></span>,</li><li>        <span class=""><span class="hljs-string">"resource"</span></span>: <span class=""><span class="hljs-string">"$profile:distributionFilter_sample2"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li><li><span class=""><span class="hljs-comment">//Module2</span></span><span class=""><span class="hljs-comment">的</span></span><span class=""><span class="hljs-comment">distributionFilter</span></span><span class=""><span class="hljs-comment">，</span></span><span class=""><span class="hljs-comment">distributionFilter_sample2.json</span></span></li><li>{</li><li>  <span class=""><span class="hljs-string">"distributionFilter"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"screenShape"</span></span>:{</li><li>      <span class=""><span class="hljs-string">"policy"</span></span>: <span class=""><span class="hljs-string">"include"</span></span>,</li><li>      <span class=""><span class="hljs-string">"value"</span></span>: [<span class=""><span class="hljs-string">"circle"</span></span>]</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </li></ol> <p></p></li></ol> </div> </div> <div></div></div>