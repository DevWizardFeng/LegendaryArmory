<h1 _ngcontent-yso-c119="" class="doc-title ng-star-inserted" title="IFAA免密身份认证"> IFAA免密身份认证 </h1>

<div _ngcontent-yso-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section166891210175717">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section166891210175717" tips="复制节点链接"></i></h2>          <ul>      <li>开通：提供移动端开通生物特征（指纹/3D人脸）IFAA免密身份认证的能力。使用用户已有的生物特征类型进行开通，会开通移动端对应生物特征类型的IFAA免密身份认证能力。</li>      <li>认证：提供移动端认证生物特征（指纹/3D人脸）IFAA免密身份认证的能力。使用用户已开通的生物特征进行认证，认证成功；使用未开通的生物特征进行认证，认证失败。</li>      <li>注销：提供移动端注销生物特征（指纹/3D人脸）IFAA免密身份认证的能力。使用用户已开通的生物特征类型进行注销，会注销移动端对应生物特征类型的IFAA免密身份认证能力。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section763525116117">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section763525116117" tips="复制节点链接"></i></h2>          <p>互联网金融身份认证联盟IIFAA（IIFAA），全称为International Internet Finance Authentication Alliance，是一个生物识别框架，它由IIFAA联盟推出并持续维护。</p>    </div>    <div class="tiledSection">     <h2 id="section1150719113128">相关权限<i class="anchor-icon anchor-icon-link" anchorid="section1150719113128" tips="复制节点链接"></i></h2>          <ul>      <li>获取生物识别权限：ohos.permission.ACCESS_BIOMETRIC。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section4799111216538">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section4799111216538" tips="复制节点链接"></i></h2>          <ul>      <li>开发者应用已接入IIFAA联盟，可以从IIFAA中心服务器获取签名数据。</li>      <li>移动端设备需要支持生物特征（指纹/3D人脸），查询当前移动端设备是否支持ATL4级别的认证可信等级。       <div _ngcontent-yso-c106="" class="highlight-div"><div _ngcontent-yso-c106="" class="highlight-div-header"><div _ngcontent-yso-c106="" class="highlight-div-header-left"><div _ngcontent-yso-c106="" class="handle-button expand-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yso-c106="" class="highlight-div-header-right"><div _ngcontent-yso-c106="" class="handle-button ai-button"></div><div _ngcontent-yso-c106="" class="handle-button line-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yso-c106="" class="handle-button theme-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yso-c106="" class="handle-button copy-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span>  <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { userAuth } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UserAuthenticationKit'</span>;</li><li><span class="hljs-comment">// 示例，查询设备人脸识别是否支持ATL4级别的认证可信等级</span></li><li><span class="hljs-keyword">try</span> {</li><li>    userAuth.<span class="hljs-title function_">getAvailableStatus</span>(userAuth.<span class="hljs-property">UserAuthType</span>.<span class="hljs-property">FACE</span>, userAuth.<span class="hljs-property">AuthTrustLevel</span>.<span class="hljs-property">ATL4</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'current auth trust level is supported'</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`current auth trust level is not supported. Code is <span class="hljs-subst">${err?.code}</span>, message is <span class="hljs-subst">${err?.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>移动端设备使用此服务时需要处于联网状态。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section12611620155710">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section12611620155710" tips="复制节点链接"></i></h2>          <p><span><img height="677.3025" originheight="6600" originwidth="5100" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115017.65418013100688396237638874093565:50001231000000:2800:E9C26F644134E0042E16A718EE8B87ECAEDC65A46B41385B597865E10C7570DE.png" title="点击放大" width="523.6875"></span></p>    </div>    <div class="tiledSection">     <h2 id="section0514113610250">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section0514113610250" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <caption>        <b>表1 </b>开通、认证、注销的所需要的接口       </caption>       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.2.3.1.1" valign="top" width="50.690000000000005%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.2.3.1.2" valign="top" width="49.309999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50.690000000000005%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/onlineauthentication-ifaa-api#section52104409318" target="_blank">register</a>(registerData: Uint8Array): Promise&lt;Uint8Array&gt;</p></td>         <td class="cellrowborder" valign="top" width="49.309999999999995%">          <p>开通指定用户的指定生物信息类型（指纹/3D人脸）的IFAA免密身份认证能力。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50.690000000000005%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/onlineauthentication-ifaa-api#section13182438548" target="_blank">auth</a>(authToken: Uint8Array, authData: Uint8Array): Promise&lt;Uint8Array&gt;</p></td>         <td class="cellrowborder" valign="top" width="49.309999999999995%">          <p>使用指定用户的生物信息类型进行IFAA免密身份认证。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50.690000000000005%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/onlineauthentication-ifaa-api#section9272165315411" target="_blank">deregisterSync</a>(deregisterData: Uint8Array): void</p></td>         <td class="cellrowborder" valign="top" width="49.309999999999995%">          <p>注销指定用户指定生物信息类型（指纹/3D人脸）的IFAA免密身份认证能力。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50.690000000000005%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/onlineauthentication-ifaa-api#section107341055618" target="_blank">getAnonymousIdSync</a>(userToken: Uint8Array): Uint8Array</p></td>         <td class="cellrowborder" valign="top" width="49.309999999999995%">          <p>获取移动端设备标识ID。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section16481104724118">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section16481104724118" tips="复制节点链接"></i></h2>          <ol>      <li><span>注册IFAA免密身份认证。</span>       <p></p>       <div _ngcontent-yso-c106="" class="highlight-div"><div _ngcontent-yso-c106="" class="highlight-div-header"><div _ngcontent-yso-c106="" class="highlight-div-header-left"><div _ngcontent-yso-c106="" class="handle-button expand-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yso-c106="" class="highlight-div-header-right"><div _ngcontent-yso-c106="" class="handle-button ai-button"></div><div _ngcontent-yso-c106="" class="handle-button line-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yso-c106="" class="handle-button theme-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yso-c106="" class="handle-button copy-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ ifaa } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.OnlineAuthenticationKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ <span class="hljs-title class_">BusinessError</span> } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.BasicServicesKit'</span></span><span class="">;</span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者根据I</span></span><span class=""><span class="hljs-comment">IFAA</span></span><span class=""><span class="hljs-comment">协议构造</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">入参，转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.getAnonymousIdSync</span></span><span class=""><span class="hljs-comment">接口。此处</span></span><span class=""><span class="hljs-comment">new Uint8Array([0])</span></span><span class=""><span class="hljs-comment">需要替换为开发者定义的用户标识。</span></span></li><li><span class="hljs-keyword">let</span> <span class="">arg </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">getAnonIdResult</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">getAnonymousIdSync</span></span><span class="">(</span><span class="">arg</span><span class="">)</span><span class="">;</span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者需使用</span></span><span class=""><span class="hljs-comment">getAnonIdResult从</span></span><span class=""><span class="hljs-comment">服务端获取签名后的开通数据</span></span></li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者将开通数据（</span></span><span class=""><span class="hljs-comment">IIFAA</span></span><span class=""><span class="hljs-comment">协议的</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">格式）转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.register</span></span><span class=""><span class="hljs-comment">接口。此处</span></span><span class=""><span class="hljs-comment">new Uint8Array([0])</span></span><span class=""><span class="hljs-comment">需要替换为有效数据。</span></span></li><li><span class="hljs-keyword">let</span> <span class="">TLV_Register_fp </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">registerPromise</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Promise</span></span><span class="">&lt;</span><span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">&gt;</span><span class=""> = </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">register</span></span><span class="">(</span><span class="">TLV_Register_fp</span><span class="">)</span><span class="">;</span></li><li><span class="">registerPromise</span><span class="">.</span><span class=""><span class="hljs-title function_">then</span></span><span class="">(</span><span class=""><span class="hljs-function"><span class="hljs-params">registerResult</span> </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Succeeded in doing </span><span class=""><span class="hljs-string">register</span></span><span class="hljs-string">."</span>);</li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开通成功，开发者获取</span></span><span class=""><span class="hljs-comment">ifaa.register</span></span><span class=""><span class="hljs-comment">结果并处理。</span></span></li><li><span class="">}</span><span class="">)</span><span class="">.</span><span class=""><span class="hljs-title function_">catch</span></span><span class="">(<span class="hljs-function">(</span></span><span class=""><span class="hljs-function"><span class="hljs-params">err</span></span></span><span class=""><span class="hljs-function"><span class="hljs-params">: </span></span></span><span class="hljs-function"><span class="hljs-params">BusinessError</span></span><span class=""><span class="hljs-function">) </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span><span class="">{</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to call </span><span class=""><span class="hljs-string">register</span></span><span class="hljs-string">. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开通失败，开发者获取</span></span><span class=""><span class="hljs-comment">ifaa.register</span></span><span class=""><span class="hljs-comment">错误并处理。</span></span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div>       <p></p></li>      <li><span>使用IFAA免密身份认证进行认证。</span>       <p></p>       <div _ngcontent-yso-c106="" class="highlight-div"><div _ngcontent-yso-c106="" class="highlight-div-header"><div _ngcontent-yso-c106="" class="highlight-div-header-left"><div _ngcontent-yso-c106="" class="handle-button expand-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yso-c106="" class="highlight-div-header-right"><div _ngcontent-yso-c106="" class="handle-button ai-button"></div><div _ngcontent-yso-c106="" class="handle-button line-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yso-c106="" class="handle-button theme-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yso-c106="" class="handle-button copy-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {<span class=""> ifaa } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.OnlineAuthenticationKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">userAuth</span><span class=""> } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.UserAuthenticationKit'</span></span><span class="">;</span></li><li><span class="hljs-keyword">import</span> <span class="">{ <span class="hljs-title class_">BusinessError</span> } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.BasicServicesKit'</span></span><span class="">;</span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者根据IIFAA</span></span><span class=""><span class="hljs-comment">协议构造</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">入参，转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.getAnonymousIdSync</span></span><span class=""><span class="hljs-comment">接口。</span></span><span class=""><span class="hljs-comment">arg</span></span><span class=""><span class="hljs-comment">需要替换开发者自定义数据。</span></span></li><li><span class="hljs-keyword">let</span> <span class="">arg </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">getAnonIdResult</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">getAnonymousIdSync</span></span><span class="">(</span><span class="">arg</span><span class="">)</span><span class="">;</span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者需使用</span></span><span class=""><span class="hljs-comment">getAnonIdResult</span></span><span class=""><span class="hljs-comment">从服务端获取签名后的认证数据</span></span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">获取此次免密支付的</span></span><span class=""><span class="hljs-comment">challenge</span></span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">ifaaChallenge</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">preAuthSync</span></span><span class="">()</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">authParam</span></span><span class="">: </span><span class="">userAuth</span><span class="">.</span><span class=""><span class="hljs-property">AuthParam</span> </span><span class="">= </span><span class="">{</span></li><li>  <span class=""><span class="hljs-attr">challenge</span></span><span class="">: </span><span class="">ifaaChallenge</span><span class="">,</span></li><li>  <span class=""><span class="hljs-attr">authType</span></span><span class="">: </span><span class="">[</span><span class="">userAuth</span><span class="">.</span><span class=""><span class="hljs-property">UserAuthType</span></span><span class="">.</span><span class=""><span class="hljs-property">FINGERPRINT</span></span><span class="">]</span><span class="">,</span></li><li>  <span class=""><span class="hljs-attr">authTrustLevel</span></span><span class="">: </span><span class="">userAuth</span><span class="">.</span><span class=""><span class="hljs-property">AuthTrustLevel</span></span><span class="">.</span><span class=""><span class="hljs-property">ATL4</span></span><span class="">,</span></li><li><span class="">}</span><span class="">;</span></li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">使用</span></span><span class=""><span class="hljs-comment">preAuthResult</span></span><span class=""><span class="hljs-comment">请求身份认证</span></span></li><li><span class="hljs-keyword">let</span> <span class="">userAuthInstance </span><span class="">= </span><span class="">userAuth</span><span class="">.</span><span class=""><span class="hljs-title function_">getUserAuthInstance</span></span><span class="">(</span><span class="">authParam</span><span class="">,  </span><span class="">{</span><span class=""><span class="hljs-attr">title</span></span><span class="">: </span><span class=""><span class="hljs-string">' </span></span><span class=""><span class="hljs-string">'</span></span><span class="">}</span><span class="">)</span><span class="">;</span></li><li><span class="">userAuthInstance</span><span class="">.</span><span class=""><span class="hljs-title function_">on</span></span><span class="">(</span><span class=""><span class="hljs-string">'result'</span></span><span class="">, </span><span class="">{</span></li><li>  <span class="hljs-keyword">async</span> <span class="">onResult </span><span class="">(</span><span class="">result</span><span class="">) </span><span class="">{</span></li><li>    <span class="hljs-keyword">let</span> <span class="">authToken </span><span class="">= </span><span class="">result</span><span class="">.</span><span class=""><span class="hljs-property">token</span></span><span class="">;</span></li><li>    <span class="hljs-keyword">try</span> <span class="">{</span></li><li>      <span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">生物特征认证成功后，调用</span></span><span class=""><span class="hljs-comment">IFAA</span></span><span class=""><span class="hljs-comment">认证</span></span></li><li>      <span class=""><span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(</span><span class=""><span class="hljs-string">"IFAA auth start"</span></span><span class="">)</span><span class="">;</span></li><li><span class="">      <span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者将认证数据（IIFAA</span></span><span class=""><span class="hljs-comment">协议的</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">格式）转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.auth</span></span><span class=""><span class="hljs-comment">接口。此处</span></span><span class=""><span class="hljs-comment">new Uint8Array([0])</span></span><span class=""><span class="hljs-comment">需要替换为有效数据。</span></span></li><li>      <span class="hljs-keyword">let</span> <span class="">TLV_Auth_fp </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="">      <span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者根据业务需求选择同步</span></span><span class=""><span class="hljs-comment">/</span></span><span class=""><span class="hljs-comment">异步接口</span></span></li><li>      <span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">authResult</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">authSync</span></span><span class="">(</span>authToken<span class="">, </span><span class="">TLV_Auth_fp</span><span class="">)</span><span class="">;</span></li><li><span class="">      <span class="hljs-variable language_">console</span></span><span class="">.</span><span class=""><span class="hljs-title function_">info</span></span><span class="">(</span><span class=""><span class="hljs-string">"authSyn authResult"</span> </span><span class="">+ </span><span class="">authResult</span><span class="">)</span><span class="">;</span></li><li><span class="">      <span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者处理</span></span><span class=""><span class="hljs-comment">authResult</span></span></li><li>    <span class="">} </span><span class="hljs-keyword">catch</span> <span class="">(</span>error<span class="">) </span><span class="">{</span></li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;  </li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to call </span><span class=""><span class="hljs-string">auth</span></span><span class="hljs-string">. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    <span class="">}</span></li><li><span class="">  }</span></li><li><span class="">}</span><span class="">)</span><span class="">;</span></li><li><span class="">userAuthInstance</span><span class="">.</span><span class=""><span class="hljs-title function_">start</span></span><span class="">()</span><span class="">;</span></li></ol></pre></div></div>       <p></p></li>      <li><span>注销IFAA免密身份认证。</span>       <p></p>       <div _ngcontent-yso-c106="" class="highlight-div"><div _ngcontent-yso-c106="" class="highlight-div-header"><div _ngcontent-yso-c106="" class="highlight-div-header-left"><div _ngcontent-yso-c106="" class="handle-button expand-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yso-c106="" class="highlight-div-header-right"><div _ngcontent-yso-c106="" class="handle-button ai-button"></div><div _ngcontent-yso-c106="" class="handle-button line-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yso-c106="" class="handle-button theme-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yso-c106="" class="handle-button copy-button"><div _ngcontent-yso-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yso-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">{ ifaa } </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@kit.OnlineAuthenticationKit'</span></span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者根据IIFAA</span></span><span class=""><span class="hljs-comment">协议构造</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">入参，转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.getAnonymousIdSync</span></span><span class=""><span class="hljs-comment">接口。此处</span></span><span class=""><span class="hljs-comment">new Uint8Array([0])</span></span><span class=""><span class="hljs-comment">需要替换为开发者定义的用户标识。</span></span></li><li><span class="hljs-keyword">let</span> <span class="">arg </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="hljs-keyword">let</span> <span class=""><span class="hljs-attr">getAnonIdResult</span></span><span class="">: </span><span class=""><span class="hljs-title class_">Uint8Array</span> </span><span class="">= </span><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">getAnonymousIdSync</span></span><span class="">(</span><span class="">arg</span><span class="">)</span><span class="">;</span></li><li>
</li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者需使用</span></span><span class=""><span class="hljs-comment">getAnonymousId</span></span><span class=""><span class="hljs-comment">的结果从服务端获取签名后的注销数据</span></span></li><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">开发者将注销数据（IIFAA</span></span><span class=""><span class="hljs-comment">协议的</span></span><span class=""><span class="hljs-comment">TLV</span></span><span class=""><span class="hljs-comment">格式）转换为</span></span><span class=""><span class="hljs-comment">Uint8Array, </span></span><span class=""><span class="hljs-comment">再使用</span></span><span class=""><span class="hljs-comment">ifaa.deregisterSync</span></span><span class=""><span class="hljs-comment">接口。此处</span></span><span class=""><span class="hljs-comment">new Uint8Array([0])</span></span><span class=""><span class="hljs-comment">需要替换为有效数据。</span></span></li><li><span class="hljs-keyword">let</span> <span class="">TLV_deregister_fp </span><span class="">= </span><span class="hljs-keyword">new</span> <span class=""><span class="hljs-title class_">Uint8Array</span></span><span class="">([</span><span class=""><span class="hljs-number">0</span></span><span class="">])</span><span class="">;</span></li><li><span class="">ifaa</span><span class="">.</span><span class=""><span class="hljs-title function_">deregisterSync</span></span><span class="">(</span><span class="">TLV_deregister_fp</span><span class="">)</span><span class="">;</span></li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1548234734118">常见问题<i class="anchor-icon anchor-icon-link" anchorid="section1548234734118" tips="复制节点链接"></i></h2>          <p>现象描述：开通IFAA免密身份认证失败。</p>     <p>可能原因：移动端设备没有联网。</p>     <p>处理步骤：移动端设备连接WIFI或热点，再次尝试。</p>    </div>   </div>   <div></div></div>