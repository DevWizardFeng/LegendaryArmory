<h1 _ngcontent-hdg-c119="" class="doc-title ng-star-inserted" title="IPC与RPC通信开发指导(ArkTS)"> IPC与RPC通信开发指导(ArkTS) </h1>

<div _ngcontent-hdg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>IPC/RPC的主要工作是跨进程建立对象通信的连接（客户端进程的Proxy和服务端进程的Stub建立一一对应关系），从而通过Proxy的接口可以和Stub进行IPC/RPC通信。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="客户端连接服务获取服务代理对象proxy" class="firsth2">客户端连接服务，获取服务代理对象Proxy<i class="anchor-icon anchor-icon-link" anchorid="客户端连接服务获取服务代理对象proxy" tips="复制节点链接"></i></h3>          <p><strong>创建变量want和connect</strong></p>     <ol>      <li>       <p>创建变量want，指定要连接的Ability所在应用的包名、组件名。在跨设备的场景下，还需要连接目标设备的NetworkId（组网场景下对应设备的标识符，可以使用distributedDeviceManager获取目标设备的NetworkId）。</p></li>      <li>       <p>创建变量connect，指定连接成功、连接失败和断开连接时的回调函数。</p>       <p>在IPC场景中，创建变量want和connect。</p>       <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>  <span class="hljs-comment">// 包名和组件名写实际的值</span></li><li>  <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"ohos.rpc.test.server"</span>,</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ohos.rpc.test.server.ServiceAbility"</span>,</li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connect</span>: common.<span class="hljs-property">ConnectOptions</span> = {</li><li>  <span class="hljs-attr">onConnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName, remoteProxy</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: js onConnect called'</span>);</li><li>    proxy = remoteProxy;</li><li>  },</li><li>  <span class="hljs-attr">onDisconnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onDisconnect'</span>);</li><li>  },</li><li>  <span class="hljs-attr">onFailed</span>: <span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onFailed'</span>);</li><li>  }</li><li>};</li></ol></pre></div></div>       <p>在RPC场景中，创建变量want和connect。</p>       <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span>, common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">dmInstance</span>: distributedDeviceManager.<span class="hljs-property">DeviceManager</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">deviceList</span>: <span class="hljs-title class_">Array</span>&lt;distributedDeviceManager.<span class="hljs-property">DeviceBasicInfo</span>&gt; | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">networkId</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connect</span>: common.<span class="hljs-property">ConnectOptions</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-keyword">try</span>{</li><li>  dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">"ohos.rpc.test"</span>);</li><li>} <span class="hljs-keyword">catch</span>(error) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'createDeviceManager errCode:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">', errMessage:'</span> + err.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用distributedDeviceManager获取目标设备NetworkId</span></li><li><span class="hljs-keyword">if</span> (dmInstance != <span class="hljs-literal">undefined</span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    deviceList = dmInstance.<span class="hljs-title function_">getAvailableDeviceListSync</span>();</li><li>    <span class="hljs-keyword">if</span> (deviceList.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span>) {</li><li>      networkId = deviceList[<span class="hljs-number">0</span>].<span class="hljs-property">networkId</span>;</li><li>      want = {</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"ohos.rpc.test.server"</span>,</li><li>        <span class="hljs-attr">abilityName</span>: <span class="hljs-string">"ohos.rpc.test.service.ServiceAbility"</span>,</li><li>        <span class="hljs-attr">deviceId</span>: networkId,</li><li>      };</li><li>      connect = {</li><li>        <span class="hljs-attr">onConnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName, remoteProxy</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: js onConnect called'</span>);</li><li>          proxy = remoteProxy;</li><li>        },</li><li>        <span class="hljs-attr">onDisconnect</span>: <span class="hljs-function">(<span class="hljs-params">elementName</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onDisconnect'</span>);</li><li>        },</li><li>        <span class="hljs-attr">onFailed</span>: <span class="hljs-function">() =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'RpcClient: onFailed'</span>);</li><li>        }</li><li>      };</li><li>    }</li><li>  }<span class="hljs-keyword">catch</span>(error) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'createDeviceManager err:'</span> + err);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>     <p><strong>连接服务</strong></p>     <p>FA模型使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-ability-featureability#featureabilityconnectability7" target="_blank">connectAbility</a>接口连接Ability。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { featureAbility } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 建立连接后返回的Id需要保存下来，在解绑服务时需要作为参数传入</span></li><li><span class="hljs-keyword">let</span> connectId = featureAbility.<span class="hljs-title function_">connectAbility</span>(want, connect);</li></ol></pre></div></div>     <p>Stage模型使用common.UIAbilityContext的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#connectserviceextensionability" target="_blank">connectServiceExtensionAbility</a>接口连接Ability。</p>     <p>在本文档的示例中，通过this.getUIContext().getHostContext()来获取UIAbilityContext，其中this代表继承自UIAbility的UIAbility实例。如需要在页面中使用UIAbilityContext提供的能力，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(); <span class="hljs-comment">// UIAbilityContext</span></li><li><span class="hljs-comment">// 建立连接后返回的Id需要保存下来，在解绑服务时需要作为参数传入</span></li><li><span class="hljs-keyword">let</span> connectId = context.<span class="hljs-title function_">connectServiceExtensionAbility</span>(want,connect);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="客户端发送信息给服务端">客户端发送信息给服务端<i class="anchor-icon anchor-icon-link" anchorid="客户端发送信息给服务端" tips="复制节点链接"></i></h3>          <p>成功连接服务后，可以通过onConnect回调函数获取服务端的代理对象Proxy。然后，使用该Proxy调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#sendmessagerequest9-2" target="_blank">sendMessageRequest</a>方法发起请求。当服务端处理请求并返回数据时，可在Promise契约（用于表示一个异步操作的成功/失败的结果值）中接收结果。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 此示例代码段中的proxy是在与服务端连接成功后的onConnect回调里拿到的proxy</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">proxy</span>: rpc.<span class="hljs-property">IRemoteObject</span> | <span class="hljs-literal">undefined</span>;</li><li>
</li><li><span class="hljs-comment">// 使用Promise契约</span></li><li><span class="hljs-keyword">let</span> option = <span class="hljs-keyword">new</span> rpc.<span class="hljs-title class_">MessageOption</span>();</li><li><span class="hljs-keyword">let</span> data = rpc.<span class="hljs-property">MessageSequence</span>.<span class="hljs-title function_">create</span>();</li><li><span class="hljs-keyword">let</span> reply = rpc.<span class="hljs-property">MessageSequence</span>.<span class="hljs-title function_">create</span>();</li><li><span class="hljs-comment">// 在data里写入参数，以传递字符串为例</span></li><li>data.<span class="hljs-title function_">writeString</span>(<span class="hljs-string">"hello world"</span>);</li><li>
</li><li><span class="hljs-keyword">if</span> (proxy != <span class="hljs-literal">undefined</span>) {</li><li>  proxy.<span class="hljs-title function_">sendMessageRequest</span>(<span class="hljs-number">1</span>, data, reply, option)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: rpc.RequestResult</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (result.<span class="hljs-property">errCode</span> != <span class="hljs-number">0</span>) {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'sendMessageRequest failed, errCode: '</span> + result.<span class="hljs-property">errCode</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-comment">// 从result.reply里读取结果</span></li><li>      <span class="hljs-comment">// 此处是根据前面创建ServiceExtensionAbility，实现服务端做的示例</span></li><li>      result.<span class="hljs-property">reply</span>.<span class="hljs-title function_">readString</span>();</li><li>    })</li><li>    .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'sendMessageRequest got exception: '</span> + e);</li><li>    })</li><li>    .<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      data.<span class="hljs-title function_">reclaim</span>();</li><li>      reply.<span class="hljs-title function_">reclaim</span>();</li><li>    })</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="服务端处理客户端请求">服务端处理客户端请求<i class="anchor-icon anchor-icon-link" anchorid="服务端处理客户端请求" tips="复制节点链接"></i></h3>          <p>服务端在onConnect回调函数里返回继承自<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#remoteobject" target="_blank">rpc.RemoteObject</a>的Stub对象，该对象需要实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-rpc#onremotemessagerequest9" target="_blank">onRemoteMessageRequest</a>方法，处理客户端的请求。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Stub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">rpc.RemoteObject</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">descriptor: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">super</span>(descriptor);</li><li>  }</li><li>  <span class="hljs-title function_">onRemoteMessageRequest</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: rpc.<span class="hljs-property">MessageSequence</span>, <span class="hljs-attr">reply</span>: rpc.<span class="hljs-property">MessageSequence</span>,</li><li>    <span class="hljs-attr">option</span>: rpc.<span class="hljs-property">MessageOption</span>): <span class="hljs-built_in">boolean</span> | <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>    <span class="hljs-comment">// 服务端Stub根据不同的请求code分别执行对应的处理流程</span></li><li>    <span class="hljs-keyword">if</span> (code == <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">let</span> str = data.<span class="hljs-title function_">readString</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'stub receive str : '</span> + str);</li><li>      <span class="hljs-comment">// 服务端使用reply回传请求处理的结果给客户端</span></li><li>      reply.<span class="hljs-title function_">writeString</span>(<span class="hljs-string">"hello rpc"</span>);</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'stub unknown code: '</span> + code);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="断开连接">断开连接<i class="anchor-icon anchor-icon-link" anchorid="断开连接" tips="复制节点链接"></i></h3>          <p>IPC通信结束后，FA模型使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-ability-featureability#featureabilitydisconnectability7" target="_blank">disconnectAbility</a>接口断开连接，此处的connectId是在连接服务时保存的。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { featureAbility } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.AbilityKit"</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">disconnectCallback</span>(<span class="hljs-params"></span>) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'disconnect ability done'</span>);</li><li>}</li><li><span class="hljs-comment">// 断开连接，使用连接服务成功时保存下来的connectId断开连接</span></li><li>featureAbility.<span class="hljs-title function_">disconnectAbility</span>(connectId, disconnectCallback);</li></ol></pre></div></div>     <p>Stage模型使用common.UIAbilityContext提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#disconnectserviceextensionability-1" target="_blank">disconnectServiceExtensionAbility</a>接口断开连接，此处的connectId是在连接服务时保存的。</p>     <p>在本文档的示例中，通过this.getUIContext().getHostContext()来获取UIAbilityContext，其中this代表继承自UIAbility的UIAbility实例。如需要在页面中使用UIAbilityContext提供的能力，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>     <div _ngcontent-hdg-c106="" class="highlight-div"><div _ngcontent-hdg-c106="" class="highlight-div-header"><div _ngcontent-hdg-c106="" class="highlight-div-header-left"><div _ngcontent-hdg-c106="" class="handle-button expand-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hdg-c106="" class="highlight-div-header-right"><div _ngcontent-hdg-c106="" class="handle-button ai-button"></div><div _ngcontent-hdg-c106="" class="handle-button line-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hdg-c106="" class="handle-button theme-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hdg-c106="" class="handle-button copy-button"><div _ngcontent-hdg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hdg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>(); <span class="hljs-comment">// UIAbilityContext</span></li><li> </li><li><span class="hljs-comment">// 断开连接，使用连接服务成功时保存下来的connectId断开连接</span></li><li>context.<span class="hljs-title function_">disconnectServiceExtensionAbility</span>(connectId);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <p>针对IPC与RPC通信开发，端到端的完整示例，请参考：</p>     <ul>      <li><a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/SystemFeature/IPC/ObjectTransfer" target="_blank">IPC通信完整样例-使用Parcelable/ArrayBuffer通信</a></li>     </ul>    </div>   </div>   <div></div></div>