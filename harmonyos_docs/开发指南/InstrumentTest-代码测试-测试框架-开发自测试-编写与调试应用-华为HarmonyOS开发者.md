<h1 _ngcontent-yra-c119="" class="doc-title ng-star-inserted" title="Instrument Test"> Instrument Test </h1>

<div _ngcontent-yra-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001806795804"><div class="tiledSection"><h2 id="section36049271219">创建ArkTS测试用例<i class="anchor-icon anchor-icon-link" anchorid="section36049271219" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1022373715218" class="firsth2">创建默认测试用例<i class="anchor-icon anchor-icon-link" anchorid="section1022373715218" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174500__zh-cn_topic_0000001259259587_ol39561137184512"><li id="zh-cn_topic_0000001259259587_li15956153714455"><span>在工程目录下打开待测试模块（支持HAP、HAR、HSP模块）下的ets文件，将光标置于代码中任意位置，单击<strong>右键 &gt; Show Context Actions</strong><strong> &gt; Create Instrument Test</strong>或快捷键<strong>Alt+Enter</strong><strong> （macOS为Option+Enter）&gt; Create Instrument Test</strong>创建测试类。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p1559444411216"><span><img originheight="91" originwidth="758" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104845.23118940199106443496683799905679:50001231000000:2800:1BF5E7D9B2DCBD958E875A1E1BEFB2E9FF02ADF81270FDFB02E19B90B13F0A65.png" width="758" height="91"></span></p> <p></p></li><li id="zh-cn_topic_0000001259259587_li27275718261"><span>在弹出的Create Instrument Test窗口，输入或选择如下参数。</span><p></p><ul id="ZH-CN_TOPIC_0000002478174500__ul2092504313193"><li id="li1692518435191"><strong>Testing library</strong>：测试类型，默认为DECC-ArkTSUnit，JS语言默认为DECC-JSUnit。</li><li id="li3925164391911"><strong>ArkTS name</strong>：创建的测试文件名称，测试文件中包含了测试用例。测试文件名称要求在工程目录范围内具有唯一性，仅支持字母、数字、下划线（_）和点（.）。</li><li id="li892518430196"><strong>Destination package</strong>：测试文件存放的位置，建议存放在待测试模块的test目录下。</li></ul> <p id="ZH-CN_TOPIC_0000002478174500__p1291641753119"><span><img originheight="180" originwidth="789" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104845.36537500057799564992230578337602:50001231000000:2800:1AFA3207031042122BB0790690DF81BD16310859BCC3FF5F7B95912BDFA15132.png" width="789" height="180"></span></p> <p></p></li><li id="li199251443101917"><span>DevEco Studio在ohosTest/ets/test目录下自动生成对应的测试类。在测试类中，DevEco Studio会生成对应方法的用例模板，具体测试代码需要开发者根据业务逻辑进行开发，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkxtest-guidelines" target="_blank">自动化测试框架使用指导</a>。</span><p></p><div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul id="ZH-CN_TOPIC_0000002478174500__ul4381100715"><li id="li193821601479">您也可以手动在ohosTest &gt; ets &gt; test文件夹下创建测试用例，手动创建后，需要在List.test.ets文件中添加创建的用例类。手动创建的工程或历史工程，ohosTest &gt; ets &gt; test文件夹下所有文件的文件名必须以.test.ets结尾，否则将在运行时弹窗提示“Error: Test files must end with '.test.ets'.”请点击<strong>Fix</strong>按钮，DevEco Studio将自动对ohosTest &gt; ets &gt; test目录下的文件名进行修改。</li><li id="li238210020713">首次在HarmonyOS设备上运行UI测试框架需要使用命令“hdc -n shell param set persist.ace.testmode.enabled 1”使能UiTest测试能力。</li></ul> </div></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section760061533">自定义Ability和Resources<i class="anchor-icon anchor-icon-link" anchorid="section760061533" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p18373115614613">从5.0.3.403版本开始，新创建的工程/模块的ohosTest目录下默认不创建testability、testrunner和resources目录，历史工程仍保留这些目录，如果新工程需要使用ability或resources能力，需要开发者自行创建。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174500__p523146181214">如果需要使用ability能力，需要同时创建testrunner目录及OpenHarmonyTestRunner.ets文件。</p> </div></div></div>  <div class="tablenoborder"><div class="tbBox"><table id="table988904811377" style="border-style: none;" class="layoutFixed idpTab"><caption><b>表1 </b><strong>新旧版本ohosTest目录对比</strong></caption><tbody><tr id="ZH-CN_TOPIC_0000002478174500__row988912488371"><td align="center" class="nocellnorowborder" style="border: none;" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1788911489371"><strong>新版本</strong></p> </td> <td align="center" class="cell-norowborder" style="border: none;" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p178891248123711"><strong>历史版本</strong></p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row118891748203717"><td align="center" class="row-nocellborder" style="border: none;" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p28898483379"><span><img originheight="182" originwidth="208" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104845.28575523184972463550929758808385:50001231000000:2800:9F40E1E17BA05D7CEB633C04640234B9B3698C01D47747F4CB562C8D43D2004A.png" class="notEnlarge" width="208" height="182"></span></p> </td> <td align="center" class="cellrowborder" style="border: none;" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1788919487371"><span><img originheight="324" originwidth="288" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104845.56605852936902982780203559751156:50001231000000:2800:33A415F35D1902EEECE47E675DC24B2B0E61BD520F1A207DFF7C52C1E6DF59E0.png" class="notEnlarge" width="288" height="324"></span></p> </td> </tr>  </tbody></table></div> </div> <ol id="ZH-CN_TOPIC_0000002478174500__ol10826123125620"><li id="li1826163195613"><span>创建以下目录或文件，文件内容示例可在<a href="/consumer/cn/doc/harmonyos-guides/ide-instrument-test#section1574003717165">运行Instrument Test测试用例</a>后，在对应模块的build/{productName}/intermediates/src/ohosTest下查看，其中productName是当前生效的product，可以通过点击DevEco Studio右上方<span><img originheight="14" originwidth="15" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.13721053629176869892400092183739:50001231000000:2800:3355FE19A2DC613CC058888D1FC09DD98D3151272ADD026860497CA68D40EF16.png" class="IconPic notEnlarge" width="15" height="14"></span>图标进行查看。</span><p></p><ul id="ZH-CN_TOPIC_0000002478174500__ul191814471907"><li id="li139186472003">testability目录 &gt; TestAbility.ets文件</li><li id="li1950717216116">testability目录 &gt; pages目录 &gt; Index.ets文件</li><li id="li866254117165">testrunner目录 &gt; OpenHarmonyTestRunner.ets文件</li><li id="li995783516137">resources目录 &gt; base目录 &gt; element目录 &gt; color.json文件</li><li id="li162235017205">resources目录 &gt; base目录 &gt; element目录 &gt; string.json文件</li><li id="li1859770141517">resources目录 &gt; base目录 &gt; profile目录 &gt; test_pages.json文件</li></ul> <p></p></li><li id="li039715281903"><span>在module.json5文件中补充ability配置字段mainElement、pages、abilities，关于字段的具体说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file" target="_blank">module.json5配置文件</a>。</span><p></p><div _ngcontent-yra-c106="" class="highlight-div"><div _ngcontent-yra-c106="" class="highlight-div-header"><div _ngcontent-yra-c106="" class="highlight-div-header-left"><div _ngcontent-yra-c106="" class="handle-button expand-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yra-c106="" class="highlight-div-header-right"><div _ngcontent-yra-c106="" class="handle-button ai-button"></div><div _ngcontent-yra-c106="" class="handle-button line-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yra-c106="" class="handle-button theme-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yra-c106="" class="handle-button copy-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yra-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478174500__screen19511650107" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class=""><span class="hljs-string">"module"</span></span>: {</li><li>    <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"entry_test"</span></span>,</li><li>    <span class=""><span class="hljs-string">"type"</span></span>: <span class=""><span class="hljs-string">"feature"</span></span>,</li><li><span class="">    <span class="hljs-string">"description"</span></span>: <span class=""><span class="hljs-string">"$string:module_test_desc"</span></span>,</li><li>    <span class=""><span class="hljs-string">"mainElement"</span></span>: <span class=""><span class="hljs-string">"TestAbility"</span></span>,                                   <span class="hljs-comment">// 对应下方abilities中的ability name。</span></li><li>    <span class=""><span class="hljs-string">"deviceTypes"</span></span>: [</li><li>      <span class=""><span class="hljs-string">"phone"</span></span>,</li><li>      <span class=""><span class="hljs-string">"tablet"</span></span>,</li><li>      <span class=""><span class="hljs-string">"2in1"</span></span></li><li>    ],</li><li>    <span class=""><span class="hljs-string">"deliveryWithInstall"</span></span>: <span class=""><span class="hljs-keyword">true</span></span>,</li><li>    <span class=""><span class="hljs-string">"installationFree"</span></span>: <span class=""><span class="hljs-keyword">false</span></span>,</li><li>    <span class=""><span class="hljs-string">"pages"</span></span>: <span class=""><span class="hljs-string">"$profile:test_pages"</span></span>,                                 <span class="hljs-comment">// 对应resources目录 &gt; base目录 &gt; profile目录 &gt; test_pages.json文件。</span></li><li>    <span class=""><span class="hljs-string">"abilities"</span></span>: [                                                  <span class="hljs-comment">// 添加的ability的配置信息。</span></li><li>      {</li><li>        <span class=""><span class="hljs-string">"name"</span></span>: <span class=""><span class="hljs-string">"TestAbility"</span></span>,</li><li>        <span class=""><span class="hljs-string">"srcEntry"</span></span>: <span class=""><span class="hljs-string">"./ets/testability/TestAbility.ets"</span></span>,</li><li>        <span class=""><span class="hljs-string">"description"</span></span>: <span class=""><span class="hljs-string">"$string:TestAbility_desc"</span></span>,</li><li>        <span class=""><span class="hljs-string">"icon"</span></span>: <span class=""><span class="hljs-string">"$media:icon"</span></span>,    <span class="hljs-comment">// 确保引用的资源都存在</span></li><li>        <span class=""><span class="hljs-string">"label"</span></span>: <span class=""><span class="hljs-string">"$string:TestAbility_label"</span></span>,</li><li>        <span class=""><span class="hljs-string">"exported"</span></span>: <span class=""><span class="hljs-keyword">true</span></span>,</li><li>        <span class=""><span class="hljs-string">"startWindowIcon"</span></span>: <span class=""><span class="hljs-string">"$media:icon"</span></span>,</li><li>        <span class=""><span class="hljs-string">"startWindowBackground"</span></span>: <span class=""><span class="hljs-string">"$color:start_window_background"</span></span></li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section14415226122419">运行测试用例<i class="anchor-icon anchor-icon-link" anchorid="section14415226122419" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section1574003717165" class="firsth2">运行模式<i class="anchor-icon anchor-icon-link" anchorid="section1574003717165" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p1769471714182">使用DevEco Studio运行测试用例前，需要将设备与电脑进行连接，将工程编译成带签名信息的HAP，再安装到真机设备或模拟器上运行，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-device">使用本地真机运行应用</a><span id="ZH-CN_TOPIC_0000002478174500__ph17127528518">或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-run-emulator">使用模拟器运行应用</a></span>。</p> <div class="p" id="ZH-CN_TOPIC_0000002478174500__p4971811185117">可以采用运行工程目录（test）、测试文件（如Ability.test.ets）、测试套件（describe）、测试方法（it）的方式来运行测试用例：<ul id="ZH-CN_TOPIC_0000002478174500__zh-cn_topic_0000001259259587_ul147252098424"><li id="li120015112015">在工程目录中，单击<strong>右键 &gt; Run'测试文件名称'</strong>，执行测试。<p id="ZH-CN_TOPIC_0000002478174500__p955915365562"><span><img originheight="440" originwidth="407" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.45942423256512223638298980805692:50001231000000:2800:7FA05BA0997E8E64F4283F4649034BA417ECCD20D19BB6FCC15FBC76C214D15B.png" width="407" height="440"></span></p> </li><li id="li520112111206">打开测试文件，单击测试套件左侧按钮。<p id="ZH-CN_TOPIC_0000002478174500__p18201161182010"><span><img originheight="217" originwidth="337" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.79457938239097570426723110007663:50001231000000:2800:759868F880E21529088D0C125D59C224511CD8EDE1997150982D0CE0EB61E97B.png" width="337" height="217"></span></p> </li><li id="li1420110142017">如果要根据自定义的配置执行Instrument Test，在<a href="/consumer/cn/doc/harmonyos-guides/ide-instrument-test#section65264166107">创建测试用例运行任务</a>后，通过如下方式的其中之一，执行Instrument Test：<ul id="ZH-CN_TOPIC_0000002478174500__ul5759195101616"><li id="li192014152019">在工具栏主菜单单击<strong>Run &gt; Run'测试名称'</strong>。</li><li id="li57591581616">在DevEco Studio的右上角，选择测试任务，然后单击右侧的<span><img originheight="16" originwidth="15" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.24538609880591314925129805506636:50001231000000:2800:093C9A4A51A028E02CA03B2DD3ECDA8D6628C85F04F68AF831235764F84FCC7C.png" class="IconPic notEnlarge" width="15" height="16"></span>按钮，执行Instrument Test。<p id="ZH-CN_TOPIC_0000002478174500__p1181541264912"><span><img originheight="27" originwidth="339" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.56219455244346124122497851374886:50001231000000:2800:A5504ED3E0A6173EF2D312EA285F78A8B107C78C4C411A4D056BA05583F2D8D7.png" width="339" height="27"></span></p> </li></ul> </li></ul> </div> <p id="ZH-CN_TOPIC_0000002478174500__p1821362016513">执行完测试任务后，查看测试结果。</p> <p id="ZH-CN_TOPIC_0000002478174500__p128755065413"><span><img originheight="302" originwidth="1742" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.24284623296666729253859668683028:50001231000000:2800:6FC00C5A38508399C11C1550B843D3818CF05CD46E9A40EABB8B328FDAD4CEC3.png" width="920" height="159.49483352468425"></span></p> </div> <div class="tiledSection"><h3 id="section51431457172419">调试模式<i class="anchor-icon anchor-icon-link" anchorid="section51431457172419" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p27762046182815">调试模式相比运行模式增加了断点管理功能。在断点命中时，可以选择单步执行、步入步出、进入下个断点等方式进行调试，另外可以使用线程堆栈可视化、变量和表达式可视化功能，快速定位问题。</p> <p id="ZH-CN_TOPIC_0000002478174500__p17962155043116">以文件级别为例，在添加断点之后，在工程目录中，选中文件，单击<strong>右键 &gt; Debug'测试文件名称'</strong>，以调试模式执行测试任务。</p> <p id="ZH-CN_TOPIC_0000002478174500__p9280171918584"><span><img originheight="451" originwidth="417" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.45454973995995984214921267077639:50001231000000:2800:F0A8E1045FA111D1555BCF4D5192A4F52E0902FFD7EAB09A94110D974255759E.png" width="417" height="451"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p839112261334">在断点命中时，下方将出现Debug窗口。开发者可在该窗口中进行断点管理与基础调试能力的可视化操作，在断点命中时可查看当前线程的变量和堆栈信息。</p> <p id="ZH-CN_TOPIC_0000002478174500__p6111030201419"><span><img originheight="716" originwidth="1007" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.68151798336786837246372026388523:50001231000000:2800:105C81436A2E308487E161E9BDC12641FBB99C9B477240150511896C5E516718.png" width="920" height="654.1410129096325"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p233651120378">断点命中时，在代码编辑器窗口单击右键，在弹出的菜单中将出现调试模式特有功能，如计算表达式、添加变量监视等。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1523112399163"><span><img originheight="544" originwidth="869" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.91069759810102668189462688895060:50001231000000:2800:2FDB50FFC1D853B32050BBC1A189E4E054610C893B292A42C1CF9800D02BFF2B.png" width="869" height="544"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p1065793414486">在跳出所有断点后，测试结束，与运行模式相同，在测试窗口查看测试结果。</p> <p id="ZH-CN_TOPIC_0000002478174500__p106344882010"><span><img originheight="815" originwidth="1547" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.11766517615576242439238275218840:50001231000000:2800:87F77541CC7132D98D50A68114718FDB092E488A74981C544E629E5EA4B9ED42.png" width="920" height="484.68002585649646"></span></p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174500__p169213116574">DevEco Studio支持设置调试代码类型，具体请参考<a href="/consumer/cn/doc/harmonyos-guides/ide-instrument-test#section0164586312">设置调试代码类型</a>。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section1989615417457">覆盖率统计模式<i class="anchor-icon anchor-icon-link" anchorid="section1989615417457" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p105501249472">在Instrument Test运行的基础上支持代码覆盖率统计。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1221853443">开发者可以自定义需要参与覆盖率测试的文件，具体配置方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ui-test#section13756446154">配置覆盖率过滤文件</a>。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1852019521877">可以采用运行工程目录（test）、测试文件（如Ability.test.ets）、测试套件（describe）、测试方法（it）的方式来启动代码覆盖率的统计。</p> <p id="ZH-CN_TOPIC_0000002478174500__p16940529447">以文件级别为例，有两种方式启动测试：</p> </div> <ul id="ZH-CN_TOPIC_0000002478174500__ul18949229949"><li id="li1494816296418">方式一：在工程目录中，选中文件，单击<strong>右键 &gt; Run '测试文件名称' with Coverage</strong>，执行测试。<p id="ZH-CN_TOPIC_0000002478174500__p1760642122914"><span><img originheight="474" originwidth="418" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.01757695639443921725262472058570:50001231000000:2800:F59F2E0335AB6F61B43E36A48F0898A8F82F7FBDBD14CD96DDBE3A5FBA16C1DE.png" width="418" height="474"></span></p> </li><li id="li10949102912418">方式二：在DevEco Studio的右上角，选择测试任务，然后单击右侧的<span><img originheight="21" originwidth="20" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.35325738393909328867523487829229:50001231000000:2800:82565D74FC9886A0F77B8CAD60D6AEAF086A116DF2B57DF3DE624E844C847BE4.png" class="IconPic notEnlarge" width="20" height="21"></span>按钮，执行测试。<p id="ZH-CN_TOPIC_0000002478174500__p1872944714279"><span><img originheight="30" originwidth="487" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.57948537545753416490404201422337:50001231000000:2800:48DB5965F8946828230FD5097A7EC0ECB3C788A5C5137DE846A3B07E625B0F8F.png" width="487" height="30"></span></p> </li></ul> <p id="ZH-CN_TOPIC_0000002478174500__p87162011960">启动测试后，进行编译构建，底部将出现Cover窗口，构建结束后自动拉起Cover窗口，测试任务结束后，窗口中会打印测试报告的路径。</p> <p id="ZH-CN_TOPIC_0000002478174500__p881753716494"><span><img originheight="324" originwidth="1456" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.38909432034010178436526253581226:50001231000000:2800:31A62FD1E1FF8E72646188DA378E76FCE13BC5D8CF5353A242ADA79534FC7BA9.png" width="920" height="204.72527472527472"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p992014161264">点击链接可打开报告，查看ArkTS代码覆盖率详情，关于覆盖率的计算方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-ui-test#section10394362109">查看覆盖率报告</a>。</p> <p id="ZH-CN_TOPIC_0000002478174500__p968181714614"><span><img originheight="463" originwidth="1775" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.58015904862279313248422793729040:50001231000000:2800:2C530B72840A9D9855AA5CBCF3AD0D944F33EC33FFC2BAFC3A7E3AC10ADB6929.png" width="920" height="239.9774647887324"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p108471644757">在Cover窗口中，单击rerun按钮可以按照之前的设置，重新执行覆盖率用例。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1334620143117"><span><img originheight="185" originwidth="400" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.51896814872643997829667372866840:50001231000000:2800:3CAF6CBDFACB15C1EFDD7B1F78191DDCD0014A74C8554C9439680229442299BE.png" width="400" height="185"></span></p> <div class="tiledSection"><h2 id="section65264166107">（可选）自定义测试用例运行任务<i class="anchor-icon anchor-icon-link" anchorid="section65264166107" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174500__zh-cn_topic_0000001259259587_p104021871516">默认情况下，测试用例可直接运行，如果需要自定义测试用例运行任务，可通过如下方法进行设置。</p> <ol id="ZH-CN_TOPIC_0000002478174500__zh-cn_topic_0000001259259587_ol19417830105513"><li id="zh-cn_topic_0000001259259587_li1741713308552"><span>在工具栏主菜单单击<strong>Run</strong> &gt;<strong> Edit Configurations</strong>进入Run/Debug Configurations界面。</span></li><li id="zh-cn_topic_0000001259259587_li1955273420152"><span>在<strong>Run/Debug Configurations</strong>界面，单击+按钮，在弹出的下拉菜单中，单击Instrument Test。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p22960329257"><span><img originheight="182" originwidth="206" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104846.61887039227571747572849921795490:50001231000000:2800:A19F79B2BABF2F44D795257732E12366CD1B781A3BD6C43B783B65A7077BF77E.png" class="notEnlarge" width="206" height="182"></span></p> <p></p></li><li id="zh-cn_topic_0000001259259587_li6924203513265"><span>根据实际情况，配置Instrument Test的运行参数。然后单击<strong>OK</strong>，完成配置。</span><p></p><ul id="ZH-CN_TOPIC_0000002478174500__ul1736175123919"><li id="li204845477355">如果模块依赖共享包，请提前设置HAP安装方式，勾选“<strong>Keep Application Data</strong>”，则表示采用覆盖安装方式，保留应用/元服务缓存数据。</li><li id="li2791124223620">如果工程中HAP/HSP模块直接依赖其他HSP模块（如entry模块依赖HSP模块）或间接依赖其他模块（如entry模块依赖HAR模块，HAR又依赖HSP模块）时，在测试阶段需要同时安装模块包及其所有依赖模块的包到设备中。此时，可以勾选“<strong>Auto Dependencies</strong>”，测试时会自动将所有依赖的模块都安装到设备上。该选项默认勾选。</li><li id="li15736105153910">如果不涉及UI测试，勾选“<strong>Only OhosTest Package</strong>”，则只会推送OhosTest测试包到设备上，不会推送HAP/HSP包，可以缩短推包时间。</li></ul> <p id="ZH-CN_TOPIC_0000002478174500__p1682792811291"><span><img originheight="731" originwidth="894" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.46690515990211741113376889974703:50001231000000:2800:305CACD13CF99429AFA7556DE080DDE1A560353676618C4438CCE5C86D6CB537.png" width="894" height="731"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section925320179314" class="firsth2">使用过滤条件筛选待运行的测试用例<i class="anchor-icon anchor-icon-link" anchorid="section925320179314" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174500__ol17910927152315"><li id="li291012273236"><span>在用例编写时，通过配置it的第二个入参，为每个用例添加过滤参数。此参数用于为测试用例添加标注，不添加则参数默认为0表示未被标注。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p420118273538"><span><img originheight="468" originwidth="1022" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.79346134011607956224880342307820:50001231000000:2800:B377723532172851DFD7B0487342C24E9977DDED1AC7DB80A37D297BA9501CE9.png" width="920" height="421.29158512720153"></span></p> <p></p></li><li id="li183529313245"><span>打开<strong>Run/Debug Configurations</strong>窗口，点击Test Args<span><img originheight="13" originwidth="12" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.25072252529029890661975009826002:50001231000000:2800:5E886DC1809EF647BAFE52F5751C1951CA54F022B4DCA5DA641F643C067FBBEB.png" class="IconPic notEnlarge" width="12" height="13"></span>，打开<strong>Test Args</strong>界面，添加命令行参数。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p1982464919450"><span><img originheight="534" originwidth="892" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.83156542055174899390852915606714:50001231000000:2800:022612F6F75E2916F94571D05017D02F1B5A968260CAD319B3D8D0A8E2396F3B.png" width="892" height="534"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p0621174352411">例如将测试参数配置为level=1, size=medium</p> <p id="ZH-CN_TOPIC_0000002478174500__p1062411441464"><span><img originheight="533" originwidth="893" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.55354349966055002120892450975202:50001231000000:2800:6D5AC16EF3A31C201EDC179EA668BF8D0FFF3A9C2406995CBAAC13E99F0C76DA.png" width="893" height="533"></span></p> <div class="p" id="ZH-CN_TOPIC_0000002478174500__p1430014312242"> <div class="tablenoborder"><div class="tbBox"><table id="table1113612561615" class="layoutFixed idpTab"><caption><b>表2 </b>参数规则参考</caption><thead><tr id="ZH-CN_TOPIC_0000002478174500__row4136105616610"><th align="left" class="cellrowborder" id="mcps1.3.16.2.2.2.4.1.2.4.1.1" valign="top" width="16.491649164916492%"><p id="ZH-CN_TOPIC_0000002478174500__p1777101917715">Key</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.2.2.2.4.1.2.4.1.2" valign="top" width="17.331733173317332%"><p id="ZH-CN_TOPIC_0000002478174500__p67710196720">含义说明</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.16.2.2.2.4.1.2.4.1.3" valign="top" width="66.17661766176617%"><p id="ZH-CN_TOPIC_0000002478174500__p2077181917719">Value取值范围</p> </th> </tr> </thead> <tbody><tr id="ZH-CN_TOPIC_0000002478174500__row6136956963"><td class="cellrowborder" valign="top" width="16.491649164916492%"><p id="ZH-CN_TOPIC_0000002478174500__p17771319177">level</p> </td> <td class="cellrowborder" valign="top" width="17.331733173317332%"><p id="ZH-CN_TOPIC_0000002478174500__p07718194715">用例级别</p> </td> <td class="cellrowborder" valign="top" width="66.17661766176617%"><p id="ZH-CN_TOPIC_0000002478174500__p17772019974">"0","1","2","3","4", 例如：-s level 1</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row113618561260"><td class="cellrowborder" valign="top" width="16.491649164916492%"><p id="ZH-CN_TOPIC_0000002478174500__p13771819375">size</p> </td> <td class="cellrowborder" valign="top" width="17.331733173317332%"><p id="ZH-CN_TOPIC_0000002478174500__p15770192712">用例粒度</p> </td> <td class="cellrowborder" valign="top" width="66.17661766176617%"><p id="ZH-CN_TOPIC_0000002478174500__p15771819374">"small","medium","large", 例如：-s size small</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row181377568620"><td class="cellrowborder" valign="top" width="16.491649164916492%"><p id="ZH-CN_TOPIC_0000002478174500__p5779191875">testType</p> </td> <td class="cellrowborder" valign="top" width="17.331733173317332%"><p id="ZH-CN_TOPIC_0000002478174500__p147718191973">用例测试类型</p> </td> <td class="cellrowborder" valign="top" width="66.17661766176617%"><p id="ZH-CN_TOPIC_0000002478174500__p97712191476">"function","performance","power","reliability","security","global","compatibility","user","standard","safety","resilience", 例如：-s testType function</p> </td> </tr>  </tbody></table></div> </div> </div> <p></p></li><li id="li29107272236"><span>完成以上配置后，在运行此项配置对应的测试任务时，只运行过滤后的测试用例。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p17487112119528"><span><img originheight="961" originwidth="1730" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.36178994368512369549578480305682:50001231000000:2800:0791D7212F53006418309DB548141E0BE6A6C8410F1C141F5189019E81FFBF67.png" width="920" height="511.05202312138726"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h3 id="section0164586312">设置调试代码类型<i class="anchor-icon anchor-icon-link" anchorid="section0164586312" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p155418280329">点击<strong>Run &gt; Edit Configurations</strong>，打开<strong>Run/Debug Configurations</strong>窗口，选择Instrument Test，点击<strong>Debugger</strong>页签，设置Debug type。</p> <p id="ZH-CN_TOPIC_0000002478174500__p2440143210202"><span><img originheight="568" originwidth="892" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.47217616852266810656746453058945:50001231000000:2800:C15E6E5DD0DA1FBFF71C8CE610DA34F776E82419448BC24E338DAC074670B9FC.png" width="892" height="568"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p87591621171815">调试类型Debug type默认为Detect Automatically，关于各调试类型的说明如下表所示：</p>  <div class="tablenoborder"><div class="tbBox"><table id="table2084015181815" class="layoutFixed idpTab"><thead><tr id="ZH-CN_TOPIC_0000002478174500__row6840218312"><th align="left" class="cellrowborder" id="mcps1.3.17.5.1.3.1.1" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p178403181516">调试类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.17.5.1.3.1.2" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p684091810119">调试代码</p> </th> </tr> </thead> <tbody><tr id="ZH-CN_TOPIC_0000002478174500__row484018181612"><td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1284016183119">Detect Automatically</p> </td> <td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p28401118311">自动检测。根据工程模块及其依赖的模块涉及的编程语言，自动启动对应的调试器。</p> <p id="ZH-CN_TOPIC_0000002478174500__p58409189110">如果检测到是Native模块，出现两个调试窗口（PandaDebugger、Native）；如果不是Native模块，只出现PandaDebugger调试窗口。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row384181815119"><td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p158415181013">ArkTS/JS</p> </td> <td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p58414188112">只调试ArkTS/JS，只出现PandaDebugger调试窗口。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row4841418718"><td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1384110181611">Native</p> </td> <td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p198411318412">单独调试C++，只出现Native调试窗口。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002478174500__row148411718515"><td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1884110183116">Dual(ArkTS/JS + Native)</p> </td> <td class="cellrowborder" valign="top" width="50%"><p id="ZH-CN_TOPIC_0000002478174500__p1784115181116">支持ArkTS/JS和C++混合调试，出现两个调试窗口（PandaDebugger、Native）。</p> </td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174500__p8432184911311">调试C++代码时，当前模块及所有依赖的HSP模块的<a href="/consumer/cn/doc/harmonyos-guides/ide-instrument-test#section8352185341915">Address Sanitizer配置</a>要保持一致，若不一致，可能无法进入C++代码的断点处。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section8352185341915">ASan检测<i class="anchor-icon anchor-icon-link" anchorid="section8352185341915" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p1920221655817">Instrument Test针对C/C++方法提供ASan检测能力，关于ASan的介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-asan">ASan检测</a>，当前不支持JS语言。</p> <ol id="ZH-CN_TOPIC_0000002478174500__ol19174193295914"><li id="li15174832115918"><span>在运行/调试配置窗口，选择对应的Instrument Test，点击<strong>Diagnostics</strong>页签，勾选<strong>Address Sanitizer</strong>选项，勾选后，测试包和源码包均开启ASan能力。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p1915118714109"><span><img originheight="188" originwidth="857" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.16249999669562693604416768123882:50001231000000:2800:A4E68072C75A84718B9B8D5A13EA9474530A3C30ADA586E3C63FA2F9CC6BDE83.png" width="857" height="188"></span></p> <p></p></li><li id="li17749104615131"><span>如果有引用本地library，需在library模块的build-profile.json5文件中，配置arguments字段值为“-DOHOS_ENABLE_ASAN=ON”，表示以ASan模式编译so文件。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p175054505139"><span><img originheight="553" originwidth="774" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.52368673600779008374787269757344:50001231000000:2800:919FC066260F8C67DBED45C4C4E2C28A39A22A51AAE84F4FCBC02C201782917C.png" width="774" height="553"></span></p> <p></p></li><li id="li216641535314"><span>运行测试用例。</span></li><li id="li1293112919222"><span>当程序出现内存错误时，弹出ASan log信息，点击信息中的链接即可跳转至引起内存错误的代码处。</span><p></p><p id="ZH-CN_TOPIC_0000002478174500__p6479151310444"><span><img originheight="756" originwidth="1447" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.31526630849764584167304837088534:50001231000000:2800:84D52BD01F13AD184B7E11AE5FC8ECC792FD8181E731516909F0B0E7F81C5F11.png" width="920" height="480.6634416033172"></span></p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section1617524564017">测试C++代码<i class="anchor-icon anchor-icon-link" anchorid="section1617524564017" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478174500__p158213581412">从DevEco Studio 6.0.0 Beta5版本开始，支持对C++代码进行测试，包括运行/调试C++测试代码、对C++代码进行覆盖率统计。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1093734117324">由于C++的测试so无法直接在设备上运行，需要通过Node-API的方式拉起，即通过ArkTS/JS语言拉起C/C++测试用例。</p> </div> <div class="tiledSection"><h3 id="section185617375429" class="firsth2">运行C++测试代码<i class="anchor-icon anchor-icon-link" anchorid="section185617375429" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002478174500__ol77821753125216"><li id="li1878212538527">创建cpp测试目录，鼠标右键单击ohosTest目录，选择<strong>New &gt; C/C++ File(Napi)</strong>，在ohosTest下生成cpp测试目录，以entry模块为例，目录结构如下。<ul id="ZH-CN_TOPIC_0000002478174500__ul166811421744"><li id="li11125611165513"><strong>src &gt; ohosTest &gt; cpp &gt; types</strong>：用于存放C++的API接口描述文件。</li><li id="li812513114556"><strong>src &gt; ohosTest &gt; cpp &gt; types</strong> <strong>&gt; libentry_test &gt; index.d.ts</strong>：描述C++ API接口行为，如接口名、入参、返回参数等。</li><li id="li1712511155514"><strong>src &gt; ohosTest &gt; cpp &gt; types</strong> <strong>&gt; libentry_test &gt; oh-package.json5</strong>：配置.so三方包声明文件的入口及包名。</li><li id="li9125171185516"><strong>src &gt; ohosTest &gt; cpp &gt; CMakeLists.txt</strong>：CMake配置文件，提供CMake构建脚本。</li><li id="li166828216415"><strong>src &gt; ohosTest &gt; cpp &gt; napi_init.cpp：</strong>定义C++ API接口的文件<strong>。</strong></li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174500__p2071916272205">DevEco Studio生成的cpp测试目录中不包含C++测试框架，需要开发者自行选择开源测试框架使用。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002478174500__p1412215872514"><span><img originheight="359" originwidth="671" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.70037615581565686847068600057723:50001231000000:2800:A33B3C3D965B2D958602E36D64291A6E2B0E2359E0E5D5A35EAE346F2499A639.png" width="671" height="359"></span></p> </li><li id="li95751736893">通过ArkTS测试用例拉起C++测试，示例如下。<div _ngcontent-yra-c106="" class="highlight-div"><div _ngcontent-yra-c106="" class="highlight-div-header"><div _ngcontent-yra-c106="" class="highlight-div-header-left"><div _ngcontent-yra-c106="" class="handle-button expand-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yra-c106="" class="highlight-div-header-right"><div _ngcontent-yra-c106="" class="handle-button ai-button"></div><div _ngcontent-yra-c106="" class="handle-button line-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yra-c106="" class="handle-button theme-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yra-c106="" class="handle-button copy-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yra-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478174500__screen161911537163010" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkTS测试文件Ability.test.ets</span></li><li><span class="hljs-keyword">import</span> entryTest <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry_test.so'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">abilityTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'ActsAbilityTest'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    ...</li><li>    <span class="hljs-title function_">it</span>(<span class="hljs-string">'testNative'</span>, <span class="hljs-number">0</span>, <span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'testNative it begin'</span>);</li><li>      <span class="hljs-keyword">let</span> result = entryTest.<span class="hljs-title function_">runNativeTest</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'%{public}s'</span>, result)</li><li>      <span class="hljs-title function_">expect</span>(result).<span class="hljs-title function_">assertContain</span>(<span class="hljs-string">"ended"</span>);</li><li>    })</li><li>  })</li><li>}</li></ol></pre></div></div> </li><li id="li92324114356">运行testNative测试用例，查看测试结果。<p id="ZH-CN_TOPIC_0000002478174500__p2365622104113"><span><img originheight="159" originwidth="655" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.17430825594907616595039802177308:50001231000000:2800:5C59C7C65DB6E5B46341EE53C0DC803A8B25DE987FE533D6A93BC1771448CD45.png" width="655" height="159"></span></p> </li></ol> </div> <div class="tiledSection"><h3 id="section78632353441">收集代码覆盖率<i class="anchor-icon anchor-icon-link" anchorid="section78632353441" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478174500__p1420011410578">DevEco Studio默认不收集C++代码覆盖率，需要通过以下方式开启。</p> <ol id="ZH-CN_TOPIC_0000002478174500__ol14890184565415"><li id="li58901945165415">在测试目录下的CMakeLists.txt中添加以下代码，开启覆盖率编译插桩能力。<div _ngcontent-yra-c106="" class="highlight-div"><div _ngcontent-yra-c106="" class="highlight-div-header"><div _ngcontent-yra-c106="" class="highlight-div-header-left"><div _ngcontent-yra-c106="" class="handle-button expand-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yra-c106="" class="highlight-div-header-right"><div _ngcontent-yra-c106="" class="handle-button ai-button"></div><div _ngcontent-yra-c106="" class="handle-button line-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yra-c106="" class="handle-button theme-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yra-c106="" class="handle-button copy-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yra-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" id="ZH-CN_TOPIC_0000002478174500__screen1723391724010" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">set</span>(CMAKE_CXX_FLAGS <span class=""><span class="hljs-string">"<span class="hljs-variable">${CMAKE_CXX_FLAGS}</span> -fprofile-instr-generate -fcoverage-mapping"</span></span>)</li><li><span class="hljs-built_in">set</span>(CMAKE_C_FLAGS <span class=""><span class="hljs-string">"<span class="hljs-variable">${CMAKE_C_FLAGS}</span> -fprofile-instr-generate -fcoverage-mapping"</span></span>)</li></ol></pre></div></div> </li><li id="li358120121006"><p id="ZH-CN_TOPIC_0000002478174500__p105801341268">在napi_init.cpp文件的RunNativeTest方法中，调用__llvm_profile_write_file方法，将覆盖率数据保存到设备的/data/storage/el2/base路径下的c++_coverage.profraw文件中，该路径和文件名不可修改，示例代码如下。</p> <div _ngcontent-yra-c106="" class="highlight-div"><div _ngcontent-yra-c106="" class="highlight-div-header"><div _ngcontent-yra-c106="" class="highlight-div-header-left"><div _ngcontent-yra-c106="" class="handle-button expand-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yra-c106="" class="highlight-div-header-right"><div _ngcontent-yra-c106="" class="handle-button ai-button"></div><div _ngcontent-yra-c106="" class="handle-button line-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yra-c106="" class="handle-button theme-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yra-c106="" class="handle-button copy-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yra-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002478174500__screen44941215104114" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-keyword">extern</span></span> <span class=""><span class="hljs-string">"C"</span></span> {</li><li>    <span class=""><span class="hljs-type">void</span></span> __llvm_profile_set_filename(<span class=""><span class="hljs-type">char</span></span> *);</li><li>    <span class=""><span class="hljs-type">int</span></span> __llvm_profile_write_file(<span class=""><span class="hljs-type">void</span></span>);</li><li>}</li><li>
</li><li><span class=""><span class="hljs-function"><span class="hljs-type">static</span></span></span><span class="hljs-function"> napi_value <span class="hljs-title">RunNativeTest</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class=""><span class="hljs-type">char</span></span> filename[<span class=""><span class="hljs-number">256</span></span>];</li><li>    <span class="hljs-built_in">snprintf</span>(filename, <span class=""><span class="hljs-built_in">sizeof</span></span>(filename), <span class=""><span class="hljs-string">"/data/storage/el2/base/c++_coverage.profraw"</span></span>); <span class="hljs-comment">// 覆盖率报告文件路径和文件名，不可修改</span></li><li>    __llvm_profile_set_filename(filename);</li><li>    <span class=""><span class="hljs-comment">// 开启测试</span></span></li><li>    ...</li><li>    <span class="hljs-comment">// 结束测试，保存数据</span></li><li>     __llvm_profile_write_file();</li><li>    ...</li><li>}</li><li>
</li><li>
</li></ol></pre></div></div> </li><li id="li5141824183016">运行覆盖率测试，选中ArkTS测试文件，单击<strong>右键 &gt;</strong><strong> Run '测试文件名称' with Coverage</strong>，执行测试。<p id="ZH-CN_TOPIC_0000002478174500__p15011043913"><span><img originheight="538" originwidth="506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.55502066099518836412741122207192:50001231000000:2800:995B6F5AD7B5B681D4D9850D2368ACFC6EF526297A16317316A3F8385953497C.png" width="506" height="538"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p16468547124612">启动测试后，进行编译构建，底部将出现Cover窗口，构建结束后自动拉起Cover窗口，测试任务结束后，窗口中会打印测试报告的路径。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1026618463444"><span><img originheight="489" originwidth="1821" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.12121494634530334129700496982427:50001231000000:2800:548537CC56CF682C1926E1F552FCCE1B2FAD199441B9874C1DA82CB059AC0EF9.png" width="920" height="247.05107084019767"></span></p> <p id="ZH-CN_TOPIC_0000002478174500__p66064612475">点击链接可打开报告，查看C++代码覆盖率详情。</p> <p id="ZH-CN_TOPIC_0000002478174500__p1788924110301"><span><img originheight="412" originwidth="1315" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104847.25884574103010733155666886230409:50001231000000:2800:3FF55F90FA283F2DAC0C8EB06AAD24F74E1330ABF8F64D743A6D2F4B1014F985.png" width="920" height="288.24334600760454"></span></p> </li></ol> </div> <div class="tiledSection"><h2 id="section14255191913322">使用命令行执行测试Instrument Test<i class="anchor-icon anchor-icon-link" anchorid="section14255191913322" tips="复制节点链接"></i></h2><div class="p" id="ZH-CN_TOPIC_0000002478174500__p2508373311">通过命令行方式执行Instrument Test，在工程根目录下执行命令：<div _ngcontent-yra-c106="" class="highlight-div"><div _ngcontent-yra-c106="" class="highlight-div-header"><div _ngcontent-yra-c106="" class="highlight-div-header-left"><div _ngcontent-yra-c106="" class="handle-button expand-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yra-c106="" class="highlight-div-header-right"><div _ngcontent-yra-c106="" class="handle-button ai-button"></div><div _ngcontent-yra-c106="" class="handle-button line-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yra-c106="" class="handle-button theme-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yra-c106="" class="handle-button copy-button"><div _ngcontent-yra-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yra-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" id="ZH-CN_TOPIC_0000002478174500__screen1948012317589" data-highlighted="yes"><ol class="linenums"><li>hvigorw onDeviceTest -p <span class="hljs-built_in">module</span>={moduleName} -p coverage={<span class="hljs-literal">true</span>|<span class="hljs-literal">false</span>} -p scope={suiteName}#{methodName} -p ohos-<span class="hljs-built_in">debug</span>-asan={<span class="hljs-literal">true</span>|<span class="hljs-literal">false</span>}</li></ol></pre></div></div> <ul id="ZH-CN_TOPIC_0000002478174500__ul16352189265"><li id="li1839917584520">module：执行测试的模块，缺省默认是执行所有模块的用例。</li><li id="li8995118154510">coverage：是否生成覆盖率报告，缺省默认是true。<p id="ZH-CN_TOPIC_0000002478174500__p33379194456">覆盖率测试报告路径：&lt;module-path&gt;/.test/default/outputs/ohosTest/reports/index.html</p> <p id="ZH-CN_TOPIC_0000002478174500__p195321512195710">如果开启了C++代码覆盖率测试，会生成C++代码的覆盖率报告，路径：&lt;module-path&gt;/.test/default/outputs/ohosTest/cpp_reports/index.html</p> </li><li id="li109871928616">scope：格式为{suiteName}#{methodName}或{suiteName}，分别表示测试用例级别或测试套件级别的测试，缺省默认是执行当前模块的所有用例。</li><li id="li1042732411117">ohos-debug-asan：是否启用ASan检测，缺省默认是false。从DevEco Studio 5.1.1 Beta1版本开始支持。<p id="ZH-CN_TOPIC_0000002478174500__p11790926111118">ASan日志路径：&lt;module-path&gt;/.test/default/intermediates/ohosTest/coverage_data</p> </li></ul> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478174500__p230317153458">多个module和scope之间用逗号分隔。</p> </div></div></div> <p id="ZH-CN_TOPIC_0000002478174500__p1894742617436">测试结果文件：&lt;module-path&gt;/.test/default/intermediates/ohosTest/coverage_data/test_result.txt</p> </div> </div> <div></div></div>