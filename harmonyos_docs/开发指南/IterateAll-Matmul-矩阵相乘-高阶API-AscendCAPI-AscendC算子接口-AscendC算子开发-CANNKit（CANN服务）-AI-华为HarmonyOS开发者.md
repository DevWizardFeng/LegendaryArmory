<h1 _ngcontent-bdy-c119="" class="doc-title ng-star-inserted" title="IterateAll"> IterateAll </h1>

<div _ngcontent-bdy-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section815763061418">功能说明<i class="anchor-icon anchor-icon-link" anchorid="section815763061418" tips="复制节点链接"></i></h2><p>调用一次IterateAll，会计算出singleCoreM * singleCoreN大小的C矩阵。迭代顺序可通过tiling参数iterateOrder调整。</p> </div> <div class="tiledSection"><h2 id="section1515763091410">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section1515763091410" tips="复制节点链接"></i></h2><div _ngcontent-bdy-c106="" class="highlight-div"><div _ngcontent-bdy-c106="" class="highlight-div-header"><div _ngcontent-bdy-c106="" class="highlight-div-header-left"><div _ngcontent-bdy-c106="" class="handle-button expand-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdy-c106="" class="highlight-div-header-right"><div _ngcontent-bdy-c106="" class="handle-button ai-button"></div><div _ngcontent-bdy-c106="" class="handle-button line-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdy-c106="" class="handle-button theme-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdy-c106="" class="handle-button copy-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdy-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-type">bool</span> sync = <span class="hljs-literal">true</span>&gt; __aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-built_in">IterateAll</span>(<span class="hljs-type">const</span> GlobalTensor&lt;DstT&gt;&amp; gm, <span class="hljs-type">uint8_t</span> enAtomic = <span class="hljs-number">0</span>, <span class="hljs-type">bool</span> enSequentialWrite = <span class="hljs-literal">false</span>, <span class="hljs-type">bool</span> waitIterateAll = <span class="hljs-literal">false</span>, <span class="hljs-type">bool</span> fakeMsg = <span class="hljs-literal">false</span>)</li><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-type">bool</span> sync = <span class="hljs-literal">true</span>&gt; __aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-built_in">IterateAll</span>(<span class="hljs-type">const</span> LocalTensor&lt;DstT&gt;&amp; ubCmatrix, <span class="hljs-type">uint8_t</span> enAtomic = <span class="hljs-number">0</span>)</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section1615823014143">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section1615823014143" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>模板参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.1" valign="top" width="17.169999999999998%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.2" valign="top" width="82.83%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="17.169999999999998%"><p>sync</p> </td> <td class="cellrowborder" valign="top" width="82.83%"><p>获取C矩阵过程分为同步和异步两种模式：</p> <ul><li>同步：需要同步等待IterateAll执行结束。</li><li>异步：不需要同步等待IterateAll执行结束。</li></ul> <p>通过该参数设置同步或者异步模式：同步模式设置为true，异步模式设置为false，默认为同步模式。</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>接口参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.1" valign="top" width="15%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.3" valign="top" width="73%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="15%"><p>gm</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>C矩阵放置于Global Memory的地址。</p> <p>Kirin9020系列处理器，支持的数据类型为：half</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>ubCmatrix</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>C矩阵放置于Local Memory的地址。TPosition可设置为TPosition::TSCM。</p> <p>Kirin9020系列处理器，支持的数据类型为：half</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>enAtomic</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>是否开启Atomic操作，默认值为0。</p> <p>参数取值：</p> <p>0：不开启Atomic操作</p> <p>1：开启AtomicAdd累加操作</p> <p>2：开启AtomicMax求最大值操作</p> <p>3：开启AtomicMin求最小值操作<strong>。</strong></p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>enSequentialWrite</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>是否开启连续写模式（连续写，写入[baseM, baseN]。非连续写，写入[singleCoreM、singleCoreN]中对应的位置），默认值false（非连续写模式）。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>waitIterateAll</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>仅在异步场景下使用，是否需要通过WaitIterateAll接口等待IterateAll执行结束。</p> <p>true：需要通过WaitIterateAll接口等待IterateAll执行结束。</p> <p>false：不需要通过WaitIterateAll接口等待IterateAll执行结束，开发者自行处理等待IterateAll执行结束的过程。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="15%"><p>fakeMsg</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="73%"><p>仅在IBShare（模板参数中开启了doIBShareNorm开关）场景使用。</p> <p>IBShare用于保证复用L1上相同的A矩阵或B矩阵数据，要求AIV分核调用IterateAll的次数必须匹配，此时需要调用IterateAll并设置fakeMsg为true，不执行真正的计算，仅用来保证IterateAll调用成对出现。默认值为false，表示执行真正的计算。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section62276309140">返回值<i class="anchor-icon anchor-icon-link" anchorid="section62276309140" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section922719308144">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section922719308144" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> </div> <div class="tiledSection"><h2 id="section82271730101411">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section82271730101411" tips="复制节点链接"></i></h2><p>传入的C矩阵地址空间大小需要保证不小于singleM * singleN。</p> </div> <div class="tiledSection"><h2 id="section182271030161412">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section182271030161412" tips="复制节点链接"></i></h2><div _ngcontent-bdy-c106="" class="highlight-div"><div _ngcontent-bdy-c106="" class="highlight-div-header"><div _ngcontent-bdy-c106="" class="highlight-div-header-left"><div _ngcontent-bdy-c106="" class="handle-button expand-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bdy-c106="" class="highlight-div-header-right"><div _ngcontent-bdy-c106="" class="handle-button ai-button"></div><div _ngcontent-bdy-c106="" class="handle-button line-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bdy-c106="" class="handle-button theme-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bdy-c106="" class="handle-button copy-button"><div _ngcontent-bdy-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bdy-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">REGIST_MATMUL_OBJ</span>(&amp;pipe, <span class="hljs-built_in">GetSysWorkSpacePtr</span>(), mm, &amp;tiling); </li><li>mm.<span class="hljs-built_in">SetTensorA</span>(gm_a); </li><li>mm.<span class="hljs-built_in">SetTensorB</span>(gm_b); </li><li>mm.<span class="hljs-built_in">SetBias</span>(gm_bias); </li><li>mm.<span class="hljs-built_in">IterateAll</span>(gm_c);    <span class="hljs-comment">// 计算</span></li></ol></pre></div></div> </div> </div> <div></div></div>