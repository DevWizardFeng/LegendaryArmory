<h1 _ngcontent-xqv-c119="" class="doc-title ng-star-inserted" title="JSVM-API常见问题"> JSVM-API常见问题 </h1>

<div _ngcontent-xqv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="定位方法">定位方法<i class="anchor-icon anchor-icon-link" anchorid="定位方法" tips="复制节点链接"></i></h2><p>程序崩溃类问题：通过C++崩溃时调用栈查询FAQ的方式定位代码问题</p> <p>程序执行结果不符合预期类问题：需应用通过JSVM-API调用返回值定位到执行失败或执行结果不符合预期的位置，通过函数名查询FAQ</p> </div>  <div class="tiledSection"><h2 id="程序崩溃类">程序崩溃类<i class="anchor-icon anchor-icon-link" anchorid="程序崩溃类" tips="复制节点链接"></i></h2><ol><li><p>Q：在OH_JSVM_RunScript或OH_JSVM_CallFunction时crash，调用栈顶层为SetReturnValue</p>  <div _ngcontent-xqv-c106="" class="highlight-div"><div _ngcontent-xqv-c106="" class="highlight-div-header"><div _ngcontent-xqv-c106="" class="highlight-div-header-left"><div _ngcontent-xqv-c106="" class="handle-button expand-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqv-c106="" class="highlight-div-header-right"><div _ngcontent-xqv-c106="" class="handle-button ai-button"></div><div _ngcontent-xqv-c106="" class="handle-button line-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqv-c106="" class="handle-button theme-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqv-c106="" class="handle-button copy-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-id">#00</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">c68ef0</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8impl</span>::(anonymous namespace)::<span class="hljs-attribute">FunctionCallbackWrapper</span>::<span class="hljs-built_in">SetReturnValue</span>(JSVM_Value__*)+<span class="hljs-number">16</span>)</li><li><span class="hljs-selector-id">#01</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">c5ad30</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8impl</span>::(anonymous namespace)::<span class="hljs-attribute">FunctionCallbackWrapper</span>::<span class="hljs-built_in">Invoke</span>(<span class="hljs-attribute">v8</span>::FunctionCallbackInfo&lt;<span class="hljs-attribute">v8</span>::Value&gt; const&amp;)+<span class="hljs-number">332</span>)</li><li><span class="hljs-selector-id">#02</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000014</span><span class="hljs-selector-tag">a9e58</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span></li><li><span class="hljs-selector-id">#03</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000014</span><span class="hljs-selector-tag">a95d4</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-built_in">Builtin_HandleApiCall</span>(int, unsigned long*, <span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*)+<span class="hljs-number">176</span>)</li><li><span class="hljs-selector-id">#04</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">f7dab4</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_CEntry_Return1_ArgvOnStack_BuiltinExit+<span class="hljs-number">84</span>)</li><li><span class="hljs-selector-id">#05</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#06</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#07</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#08</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#09</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#10</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#11</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#12</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eece40</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_InterpreterEntryTrampoline+<span class="hljs-number">288</span>)</li><li><span class="hljs-selector-id">#13</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">fe09f4</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_PromiseFulfillReactionJob+<span class="hljs-number">52</span>)</li><li><span class="hljs-selector-id">#14</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">f155c0</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_RunMicrotasks+<span class="hljs-number">672</span>)</li><li><span class="hljs-selector-id">#15</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">eeab54</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(Builtins_JSRunMicrotasksEntry+<span class="hljs-number">148</span>)</li><li><span class="hljs-selector-id">#16</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">bed78</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::(anonymous namespace)::<span class="hljs-built_in">Invoke</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*, <span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::(anonymous namespace)::InvokeParams const&amp;)+<span class="hljs-number">2520</span>)</li><li><span class="hljs-selector-id">#17</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">bf50c</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::(anonymous namespace)::<span class="hljs-built_in">InvokeWithTryCatch</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*, <span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::(anonymous namespace)::InvokeParams const&amp;)+<span class="hljs-number">104</span>)</li><li><span class="hljs-selector-id">#18</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">bf730</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-attribute">Execution</span>::<span class="hljs-built_in">TryRunMicrotasks</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*, <span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::MicrotaskQueue*)+<span class="hljs-number">80</span>)</li><li><span class="hljs-selector-id">#19</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">ecf4c</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-attribute">MicrotaskQueue</span>::<span class="hljs-built_in">RunMicrotasks</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*)+<span class="hljs-number">312</span>)</li><li><span class="hljs-selector-id">#20</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">ecd9c</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-attribute">MicrotaskQueue</span>::<span class="hljs-built_in">PerformCheckpointInternal</span>(<span class="hljs-attribute">v8</span>::Isolate*)+<span class="hljs-number">52</span>)</li><li><span class="hljs-selector-id">#21</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">deaa0</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-attribute">Isolate</span>::<span class="hljs-built_in">FireCallCompletedCallbackInternal</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::MicrotaskQueue*)+<span class="hljs-number">280</span>)</li><li><span class="hljs-selector-id">#22</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000014334</span><span class="hljs-selector-tag">e8</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::CallDepthScope&lt;true&gt;::~<span class="hljs-built_in">CallDepthScope</span>()+<span class="hljs-number">248</span>)</li><li><span class="hljs-selector-id">#23</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000014330</span><span class="hljs-selector-tag">a4</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">Script</span>::<span class="hljs-built_in">Run</span>(<span class="hljs-attribute">v8</span>::Local&lt;<span class="hljs-attribute">v8</span>::Context&gt;, <span class="hljs-attribute">v8</span>::Local&lt;<span class="hljs-attribute">v8</span>::Data&gt;)+<span class="hljs-number">884</span>)</li><li><span class="hljs-selector-id">#24</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000000</span><span class="hljs-selector-tag">c5c2ac</span> /<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(OH_JSVM_RunScript+<span class="hljs-number">272</span>)</li></ol></pre></div></div>  <p>A：SetReturnValue用于设置js函数的返回值，在js完成注入的native函数调用后触发。需检查native函数的返回值是否正确，如返回值（JSVM_Value）是否未初始化就直接返回。</p>  </li><li><p>Q：js执行虚拟机初始化注入的native函数时程序崩溃</p>  <p>A：检查JSVM_CallbackStruct是否为栈上变量。如果跨函数使用，需确保JSVM_CallbackStruct的生命周期长于JSVM_Env的生命周期。</p>  <div _ngcontent-xqv-c106="" class="highlight-div"><div _ngcontent-xqv-c106="" class="highlight-div-header"><div _ngcontent-xqv-c106="" class="highlight-div-header-left"><div _ngcontent-xqv-c106="" class="handle-button expand-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqv-c106="" class="highlight-div-header-right"><div _ngcontent-xqv-c106="" class="handle-button ai-button"></div><div _ngcontent-xqv-c106="" class="handle-button line-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqv-c106="" class="handle-button theme-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqv-c106="" class="handle-button copy-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>func {</li><li>    <span class="hljs-comment">// ...</span></li><li>    JSVM_CallbackStruct param[] = {</li><li>        {.data = <span class="hljs-literal">nullptr</span>, .callback = ConsoleInfo},</li><li>        {.data = <span class="hljs-literal">nullptr</span>, .callback = Add},</li><li>    };</li><li>    JSVM_PropertyDescriptor descriptor[] = {</li><li>        {<span class="hljs-string">"consoleinfo"</span>, <span class="hljs-literal">NULL</span>, &amp;param[<span class="hljs-number">0</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, JSVM_DEFAULT},</li><li>        {<span class="hljs-string">"add"</span>, <span class="hljs-literal">NULL</span>, &amp;param[<span class="hljs-number">1</span>], <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, <span class="hljs-literal">NULL</span>, JSVM_DEFAULT},</li><li>    };</li><li>    <span class="hljs-comment">// create env, register native method, and open env scope</span></li><li>    JSVM_Env env;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateEnv</span>(vm, <span class="hljs-built_in">sizeof</span>(descriptor) / <span class="hljs-built_in">sizeof</span>(descriptor[<span class="hljs-number">0</span>]), descriptor, &amp;env);</li><li>   <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-built_in">OH_JSVM_DestroyEnv</span>(env);</li><li>   <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>  <p>在上述示例代码中，JS引擎实例在函数结束前被关闭，因此可以直接使用栈上的param。</p>  </li><li><p>Q：OH_JSVM_ReferenceRef、OH_JSVM_ReferenceUnRef、OH_JSVM_CreateReference、OH_JSVM_DeleteReference时程序崩溃</p>  <p>A：检查是否同时有多个线程持有和释放JSVM_Ref，见 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/jsvm-guidelines#多线程共享引擎实例">多线程共享引擎实例</a></p>  </li><li><p>Q：在虚拟机引擎实例中创建JS类型实例崩溃（如OH_JSVM_CreateDouble），调用栈如下</p>  <div _ngcontent-xqv-c106="" class="highlight-div"><div _ngcontent-xqv-c106="" class="highlight-div-header"><div _ngcontent-xqv-c106="" class="highlight-div-header-left"><div _ngcontent-xqv-c106="" class="handle-button expand-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xqv-c106="" class="highlight-div-header-right"><div _ngcontent-xqv-c106="" class="handle-button ai-button"></div><div _ngcontent-xqv-c106="" class="handle-button line-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xqv-c106="" class="handle-button theme-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xqv-c106="" class="handle-button copy-button"><div _ngcontent-xqv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xqv-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-id">#00</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000001</span><span class="hljs-selector-tag">d209e4</span>/<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">base</span>::<span class="hljs-number">0S</span>::<span class="hljs-built_in">Abort</span>()+<span class="hljs-number">28</span>)</li><li><span class="hljs-selector-id">#01</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">0000000001408480</span>/<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">Utils</span>::<span class="hljs-built_in">ReportApiFailure</span>(char const*,char const*)+<span class="hljs-number">124</span>)</li><li><span class="hljs-selector-id">#02</span> <span class="hljs-selector-tag">pc</span> <span class="hljs-number">00000000015</span><span class="hljs-selector-tag">c99b8</span>/<span class="hljs-selector-tag">system</span>/<span class="hljs-selector-tag">lib64</span>/<span class="hljs-selector-tag">ndk</span>/<span class="hljs-selector-tag">libjsvm</span><span class="hljs-selector-class">.so</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::<span class="hljs-attribute">HandleScope</span>::<span class="hljs-built_in">Extend</span>(<span class="hljs-attribute">v8</span>::<span class="hljs-attribute">internal</span>::Isolate*+<span class="hljs-number">200</span>)</li></ol></pre></div></div>  <p>A：检查HandleScope的使用是否正确，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/jsvm-guidelines#生命周期管理">生命周期管理</a></p>  </li></ol> </div>  <div class="tiledSection"><h2 id="jsvm-api执行失败类">JSVM-API执行失败类<i class="anchor-icon anchor-icon-link" anchorid="jsvm-api执行失败类" tips="复制节点链接"></i></h2><ol><li><p>Q：OH_JSVM_GetCbInfo无法获取JS函数参数</p>  <p>A：检查函数传递的参数是否正确，见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/jsvm-guidelines#获取js传入参数及其数量">获取JS传入参数及其数量</a></p>  </li><li><p>Q：OH_JSVM_CreateFunction等函数调用失败，返回值为JSVM_PENDING_EXCEPTION</p>  <p>A：JSVM_PENDING_EXCEPTION表明当前虚拟机环境中存在未处理的异常，可能是由于本次调用产生的JS异常，也可能是之前调用产生的未被清理的异常。可以通过在函数调用前插入OH_JSVM_GetAndClearLastException排查之前是否有未清除的异常。如果为之前的未清理异常，检查是否有JSVM接口调用未处理异常返回值；如果是本次产生的异常，需清理异常，避免影响后续的函数调用。获取并清理异常的函数为OH_JSVM_GetAndClearLastException</p>  </li><li><p>Q：JS执行时无法找到 OH_JSVM_DefineClass 定义的类</p>  <p>A：检查是否将定义的类绑定到上下文中，见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/jsvm-guidelines#上下文绑定对象">上下文绑定对象</a></p>  </li></ol> </div> </div> <div></div></div>