<h1 _ngcontent-hrx-c119="" class="doc-title ng-star-inserted" title="JS卡片开发指导（Stage模型）"> JS卡片开发指导（Stage模型） </h1>

<div _ngcontent-hrx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Stage模型是从API version 9开始支持，目前主推且会长期演进的模型。该模型采用面向对象的方式，将应用组件以类接口的形式开放给开发者，可以进行派生，利于扩展能力。</p>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>FormExtensionAbility类拥有如下API接口，具体的API介绍详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formextensionability" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">onAddForm(want: Want): formBindingData.FormBindingData</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收创建卡片的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onCastToNormalForm(formId: string): void</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收临时卡片转常态卡片的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onUpdateForm(formId: string, wantParams?: Record&lt;string, Object&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收更新卡片的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onChangeFormVisibility(newStatus: Record&lt;string, number&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收修改可见性的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onFormEvent(formId: string, message: string): void</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收处理卡片事件的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onRemoveForm(formId: string): void</td>         <td class="cellrowborder" valign="top" width="50%">卡片提供方接收销毁卡片的通知接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">onConfigurationUpdate(newConfig: Configuration): void</td>         <td class="cellrowborder" valign="top" width="50%">当系统配置更新时调用。</td>        </tr>             </tbody></table></div>     </div>     <p>formProvider类部分API接口如下，具体的API介绍详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formprovider" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.5.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">setFormNextRefreshTime(formId: string, minute: number, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">设置指定卡片的下一次更新时间，使用callback异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setFormNextRefreshTime(formId: string, minute: number): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">设置指定卡片的下一次更新时间，使用Promise异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">updateForm(formId: string, formBindingData: formBindingData.FormBindingData, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">更新指定的卡片，使用callback异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">updateForm(formId: string, formBindingData: formBindingData.FormBindingData): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">更新指定的卡片，使用Promise异步回调。</td>        </tr>             </tbody></table></div>     </div>     <p>formBindingData类部分API接口如下，具体的API介绍详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-form-formbindingdata" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.7.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">createFormBindingData(obj?: Object | string): FormBindingData</td>         <td class="cellrowborder" valign="top" width="50%">创建一个FormBindingData对象。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>Stage卡片开发，即基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/stage-model-development-overview">Stage模型</a>的卡片提供方开发，主要涉及如下关键步骤：</p>     <ul>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#创建卡片formextensionability">创建卡片FormExtensionAbility</a>：卡片生命周期回调函数FormExtensionAbility开发。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#配置卡片配置文件">配置卡片配置文件</a>：配置应用配置文件module.json5和profile配置文件。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#卡片信息的持久化">卡片信息的持久化</a>：对卡片信息进行持久化管理。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#卡片数据交互">卡片数据交互</a>：通过updateForm更新卡片显示的信息。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#开发卡片页面">开发卡片页面</a>：使用HML+CSS+JSON开发JS卡片页面。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/js-ui-widget-development#开发卡片事件">开发卡片事件</a>：为卡片添加router事件和message事件。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="创建卡片formextensionability" class="firsth2">创建卡片FormExtensionAbility<i class="anchor-icon anchor-icon-link" anchorid="创建卡片formextensionability" tips="复制节点链接"></i></h3>          <p>创建Stage模型的卡片，需实现FormExtensionAbility生命周期接口。先参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-service-widget" target="_blank">DevEco Studio服务卡片开发指南</a>生成服务卡片模板。</p>     <ol>      <li>       <p>在EntryFormAbility.ets中，导入相关模块。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { formBindingData, <span class="hljs-title class_">FormExtensionAbility</span>, formInfo, formProvider } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'JsCardFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li></ol></pre></div></div></li>      <li>       <p>在EntryFormAbility.ets中，实现FormExtension生命周期接口。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onAddForm</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formBindingData.<span class="hljs-property">FormBindingData</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onAddForm'</span>);</li><li>    <span class="hljs-comment">// 使用方创建卡片时触发，提供方需要返回卡片数据绑定类</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-string">'title'</span>: <span class="hljs-string">'titleOnCreate'</span>,</li><li>      <span class="hljs-string">'detail'</span>: <span class="hljs-string">'detailOnCreate'</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formData</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(obj);</li><li>    <span class="hljs-keyword">return</span> formData;</li><li>  }</li><li>  <span class="hljs-title function_">onCastToNormalForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 使用方将临时卡片转换为常态卡片触发，提供方需要做相应的处理，当前卡片使用方不存在临时卡片场景</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onCastToNormalForm'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">onUpdateForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 若卡片支持定时更新/定点更新/卡片使用方主动请求更新功能，则提供方需要重写该方法以支持数据更新</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onUpdateForm'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-string">'title'</span>: <span class="hljs-string">'titleOnUpdate'</span>,</li><li>      <span class="hljs-string">'detail'</span>: <span class="hljs-string">'detailOnUpdate'</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formData</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(obj);</li><li>    formProvider.<span class="hljs-title function_">updateForm</span>(formId, formData).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] updateForm, error:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>    });</li><li>  }</li><li>  <span class="hljs-title function_">onChangeFormVisibility</span>(<span class="hljs-attr">newStatus</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 使用方发起可见或者不可见通知触发，提供方需要做相应的处理，仅系统应用生效</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onChangeFormVisibility'</span>);</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>  <span class="hljs-title function_">onFormEvent</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 若卡片支持触发事件，则需要重写该方法并实现对事件的触发</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onFormEvent'</span>);</li><li>  }</li><li>  <span class="hljs-title function_">onRemoveForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 删除卡片实例数据</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onRemoveForm'</span>);</li><li>    <span class="hljs-comment">//...</span></li><li>  }</li><li>  <span class="hljs-title function_">onAcquireFormState</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formInfo.<span class="hljs-property">FormState</span> {</li><li>    <span class="hljs-keyword">return</span> formInfo.<span class="hljs-property">FormState</span>.<span class="hljs-property">READY</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>FormExtensionAbility不能常驻后台，即在卡片生命周期回调函数中无法处理长时间的任务。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="配置卡片配置文件">配置卡片配置文件<i class="anchor-icon anchor-icon-link" anchorid="配置卡片配置文件" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>卡片需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file">module.json5配置文件</a>中的extensionAbilities标签下，配置ExtensionAbility相关信息。FormExtensionAbility需要填写metadata元信息标签，其中键名称为固定字符串"ohos.extension.form"，资源为卡片的具体配置信息的索引。</p>       <p>配置示例如下：</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"extensionAbilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JsCardFormAbility"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/jscardformability/JsCardFormAbility.ts"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:JSCardFormAbility_desc"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"label"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:JSCardFormAbility_label"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"form"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ohos.extension.form"</span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"resource"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$profile:form_jscard_config"</span></li><li>          <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>卡片的具体配置信息。在上述FormExtensionAbility的元信息（"metadata"配置项）中，可以指定卡片具体配置信息的资源索引。例如当resource指定为$profile:form_jscard_config时，会使用开发视图的resources/base/profile/目录下的form_jscard_config.json作为卡片profile配置文件。内部字段结构说明如下表所示。</p>       <p><strong>表1</strong> 卡片profile配置文件</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.5.1.1" valign="top" width="25%">属性名称</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.5.1.2" valign="top" width="25%">含义</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.5.1.3" valign="top" width="25%">数据类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.5.2.2.3.1.5.1.4" valign="top" width="25%">是否可缺省</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="25%">name</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片的类名，字符串最大长度为127字节。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">description</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片的描述。取值可以是描述性内容，也可以是对描述性内容的资源索引，以支持多语言。字符串最大长度为255字节。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省为空。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">src</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片对应的UI代码的完整路径。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">window</td>           <td class="cellrowborder" valign="top" width="25%">用于定义与显示窗口相关的配置。</td>           <td class="cellrowborder" valign="top" width="25%">对象</td>           <td class="cellrowborder" valign="top" width="25%">可缺省。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">isDefault</td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示该卡片是否为默认卡片，每个UIAbility有且只有一个默认卡片。</p>            <p>- true：默认卡片。</p>            <p>- false：非默认卡片。</p></td>           <td class="cellrowborder" valign="top" width="25%">布尔值</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">colorMode<sup>(deprecated)</sup></td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示卡片的主题样式，取值范围如下：</p>            <p>- auto：跟随系统的颜色模式值选取主题。</p>            <p>- dark：深色主题。</p>            <p>- light：浅色主题。</p>            <p><strong>说明：</strong></p>            <p>1. 从API version 12开始支持该配置项，从API version 20开始废弃该配置项，卡片主题样式统一跟随系统的颜色模式。</p></td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为“auto”。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">supportDimensions</td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示卡片支持的外观规格，取值范围：</p>            <p>- 1 * 1：表示1行1列的一宫格。</p>            <p>- 1 * 2：表示1行2列的二宫格。</p>            <p>- 2 * 2：表示2行2列的四宫格。</p>            <p>- 2 * 4：表示2行4列的八宫格。</p>            <p>- 2 * 3：表示2行3列的六宫格。</p>            <p>- 3 * 3：表示3行3列的九宫格。</p>            <p>- 4 * 4：表示4行4列的十六宫格。</p>            <p>- 6 * 4：表示6行4列的二十四宫格。</p>            <p><strong>说明</strong>： 2 * 3和 3 * 3仅支持手表设备， 1 * 1只支持在锁屏上使用。</p></td>           <td class="cellrowborder" valign="top" width="25%">字符串数组</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">defaultDimension</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片的默认外观规格，取值必须在该卡片supportDimensions配置的列表中。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">updateEnabled</td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示卡片是否支持周期性刷新，取值范围：</p>            <p>- true：表示支持周期性刷新，可以在定时刷新（updateDuration）和定点刷新（scheduledUpdateTime）两种方式任选其一，优先选择定时刷新。</p>            <p>- false：表示不支持周期性刷新。</p></td>           <td class="cellrowborder" valign="top" width="25%">布尔类型</td>           <td class="cellrowborder" valign="top" width="25%">否</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">scheduledUpdateTime</td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示卡片的定点刷新的时刻，采用24小时制，精确到分钟。</p>            <p>updateDuration参数优先级高于scheduledUpdateTime，两者同时配置时，以updateDuration配置的刷新时间为准。</p></td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为“0:0”。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">updateDuration</td>           <td class="cellrowborder" valign="top" width="25%">            <p>表示卡片定时刷新的更新周期，单位为30分钟，取值为自然数。</p>            <p>当取值为0时，表示该参数不生效。</p>            <p>当取值为正整数N时，表示刷新周期为30*N分钟。</p>            <p>updateDuration参数优先级高于scheduledUpdateTime，两者同时配置时，以updateDuration配置的刷新时间为准。</p></td>           <td class="cellrowborder" valign="top" width="25%">数值</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为“0”。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">formConfigAbility</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片的配置跳转链接，采用URI格式。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为空。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">formVisibleNotify</td>           <td class="cellrowborder" valign="top" width="25%">标识是否允许卡片使用卡片可见性通知。</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为空。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">metaData</td>           <td class="cellrowborder" valign="top" width="25%">表示卡片的自定义信息，包含customizeData数组标签。</td>           <td class="cellrowborder" valign="top" width="25%">对象</td>           <td class="cellrowborder" valign="top" width="25%">可缺省，缺省值为空。</td>          </tr>                 </tbody></table></div>       </div>       <p>配置示例如下：</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"forms"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"WidgetJS"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:JSCardEntryAbility_desc"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"src"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./js/WidgetJS/pages/index/index"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"window"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"designWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">720</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"autoDesignWidth"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"isDefault"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"updateEnabled"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"scheduledUpdateTime"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"10:30"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"updateDuration"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">1</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"defaultDimension"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2*2"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"supportDimensions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-string">"2*2"</span></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="卡片信息的持久化">卡片信息的持久化<i class="anchor-icon anchor-icon-link" anchorid="卡片信息的持久化" tips="复制节点链接"></i></h3>          <p>因大部分卡片提供方都不是常驻服务，只有在需要使用时才会被拉起获取卡片信息，且卡片管理服务支持对卡片进行多实例管理，卡片ID对应实例ID，因此若卡片提供方支持对卡片数据进行配置，则需要对卡片的业务数据按照卡片ID进行持久化管理，以便在后续获取、更新以及拉起时能获取到正确的卡片业务数据。</p>     <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { formBindingData, <span class="hljs-title class_">FormExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { preferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'JsCardFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DATA_STORAGE_PATH</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'/data/storage/el2/base/haps/form_store'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> storeFormInfo = <span class="hljs-keyword">async</span> (<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">formName</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">tempFlag</span>: <span class="hljs-built_in">boolean</span>, <span class="hljs-attr">context</span>: common.<span class="hljs-property">FormExtensionContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {</li><li>  <span class="hljs-comment">// 此处仅对卡片ID：formId，卡片名：formName和是否为临时卡片：tempFlag进行了持久化</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">formInfo</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span> | <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">number</span>&gt; = {</li><li>    <span class="hljs-string">'formName'</span>: formName,</li><li>    <span class="hljs-string">'tempFlag'</span>: tempFlag,</li><li>    <span class="hljs-string">'updateCount'</span>: <span class="hljs-number">0</span></li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">storage</span>: preferences.<span class="hljs-property">Preferences</span> = <span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">getPreferences</span>(context, <span class="hljs-variable constant_">DATA_STORAGE_PATH</span>);</li><li>    <span class="hljs-comment">// put form info</span></li><li>    <span class="hljs-keyword">await</span> storage.<span class="hljs-title function_">put</span>(formId, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(formInfo));</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`[EntryFormAbility] storeFormInfo, put form info successfully, formId: <span class="hljs-subst">${formId}</span>`</span>);</li><li>    <span class="hljs-keyword">await</span> storage.<span class="hljs-title function_">flush</span>();</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`[EntryFormAbility] failed to storeFormInfo, err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err <span class="hljs-keyword">as</span> BusinessError)}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsCardFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onAddForm</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): formBindingData.<span class="hljs-property">FormBindingData</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[JsCardFormAbility] onAddForm'</span>);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (want.<span class="hljs-property">parameters</span>) {</li><li>      <span class="hljs-keyword">let</span> formId = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(want.<span class="hljs-property">parameters</span>[<span class="hljs-string">'ohos.extra.param.key.form_identity'</span>]);</li><li>      <span class="hljs-keyword">let</span> formName = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(want.<span class="hljs-property">parameters</span>[<span class="hljs-string">'ohos.extra.param.key.form_name'</span>]);</li><li>      <span class="hljs-keyword">let</span> tempFlag = want.<span class="hljs-property">parameters</span>[<span class="hljs-string">'ohos.extra.param.key.form_temporary'</span>] <span class="hljs-keyword">as</span> <span class="hljs-built_in">boolean</span>;</li><li>      <span class="hljs-comment">// 将创建的卡片信息持久化，以便在下次获取/更新该卡片实例时进行使用</span></li><li>      <span class="hljs-comment">// 此接口请根据实际情况实现，具体请参考：FormExtAbility Stage模型卡片实例</span></li><li>      <span class="hljs-title function_">storeFormInfo</span>(formId, formName, tempFlag, <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-string">'title'</span>: <span class="hljs-string">'titleOnCreate'</span>,</li><li>      <span class="hljs-string">'detail'</span>: <span class="hljs-string">'detailOnCreate'</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formData</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(obj);</li><li>    <span class="hljs-keyword">return</span> formData;</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>且需要适配onRemoveForm卡片删除通知接口，在其中实现卡片实例数据的删除。</p>     <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FormExtensionAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { preferences } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'JsCardFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DATA_STORAGE_PATH</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'/data/storage/el2/base/haps/form_store'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> deleteFormInfo = <span class="hljs-keyword">async</span> (<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">context</span>: common.<span class="hljs-property">FormExtensionContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; =&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">storage</span>: preferences.<span class="hljs-property">Preferences</span> = <span class="hljs-keyword">await</span> preferences.<span class="hljs-title function_">getPreferences</span>(context, <span class="hljs-variable constant_">DATA_STORAGE_PATH</span>);</li><li>    <span class="hljs-comment">// del form info</span></li><li>    <span class="hljs-keyword">await</span> storage.<span class="hljs-title function_">delete</span>(formId);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`[EntryFormAbility] deleteFormInfo, del form info successfully, formId: <span class="hljs-subst">${formId}</span>`</span>);</li><li>    <span class="hljs-keyword">await</span> storage.<span class="hljs-title function_">flush</span>();</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`[EntryFormAbility] failed to deleteFormInfo, err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err <span class="hljs-keyword">as</span> BusinessError)}</span>`</span>);</li><li>  };</li><li>};</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JsCardFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onRemoveForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 删除卡片实例数据</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onRemoveForm'</span>);</li><li>    <span class="hljs-comment">// 删除之前持久化的卡片实例数据</span></li><li>    <span class="hljs-comment">// 此接口请根据实际情况实现，具体请参考：FormExtAbility Stage模型卡片实例</span></li><li>    <span class="hljs-title function_">deleteFormInfo</span>(formId, <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>具体的持久化方法可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-data-persistence-overview">轻量级数据存储开发指导</a>。</p>     <p>需要注意的是，卡片使用方在请求卡片时传递给提供方应用的Want数据中存在临时标记字段，表示此次请求的卡片是否为临时卡片：</p>     <ul>      <li>       <p>常态卡片：卡片使用方会持久化的卡片。</p></li>      <li>       <p>临时卡片：卡片使用方不会持久化的卡片，当前卡片使用方不存在临时卡片场景。</p></li>     </ul>     <p>由于临时卡片的数据具有非持久化的特殊性，某些场景例如卡片服务框架死亡重启，此时临时卡片数据在卡片管理服务中已经删除，且对应的卡片ID不会通知到提供方，所以卡片提供方需要自己负责清理长时间未删除的临时卡片数据。同时对应的卡片使用方可能会将之前请求的临时卡片转换为常态卡片。如果转换成功，卡片提供方也需要对对应的临时卡片ID进行处理，把卡片提供方记录的临时卡片数据转换为常态卡片数据，防止提供方在清理长时间未删除的临时卡片时，把已经转换为常态卡片的临时卡片信息删除，导致卡片信息丢失。</p>    </div>    <div class="tiledSection">     <h3 id="卡片数据交互">卡片数据交互<i class="anchor-icon anchor-icon-link" anchorid="卡片数据交互" tips="复制节点链接"></i></h3>          <p>当卡片应用需要更新数据时（如触发了定时更新或定点更新），卡片应用获取最新数据，并调用updateForm()接口主动触发卡片的更新。</p>     <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { formBindingData, <span class="hljs-title class_">FormExtensionAbility</span>, formProvider } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.FormKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'JsCardFormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryFormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onUpdateForm</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 若卡片支持定时更新/定点更新/卡片使用方主动请求更新功能，则提供方需要重写该方法以支持数据更新</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onUpdateForm'</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-string">'title'</span>: <span class="hljs-string">'titleOnUpdate'</span>,</li><li>      <span class="hljs-string">'detail'</span>: <span class="hljs-string">'detailOnUpdate'</span></li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">formData</span>: formBindingData.<span class="hljs-property">FormBindingData</span> = formBindingData.<span class="hljs-title function_">createFormBindingData</span>(obj);</li><li>    formProvider.<span class="hljs-title function_">updateForm</span>(formId, formData).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] updateForm, error:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(error));</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="开发卡片页面">开发卡片页面<i class="anchor-icon anchor-icon-link" anchorid="开发卡片页面" tips="复制节点链接"></i></h3>          <p>开发者可以使用类Web范式（HML+CSS+JSON）开发JS卡片页面。生成如下卡片页面，可以这样配置卡片页面文件：</p>     <p><span><img originheight="179" originwidth="360" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114732.34230990627002208736271329094513:50001231000000:2800:700DB2F8431478C8EB7A512518DB1878966D1A12FB95F874045E8E74BEEDCFF9.png" width="360" height="179"></span></p>     <ul>      <li>       <p>HML：使用类Web范式的组件描述卡片的页面信息。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">stack</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-img"</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/common/widget.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-img"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-inner"</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span>&gt;</span>{{title}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"detail_text"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"routerEvent"</span>&gt;</span>{{detail}}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li></ol></pre></div></div></li>      <li>       <p>CSS：HML中类Web范式组件的样式信息。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="css prettyprint linenums hljs language-css" hw-language="css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-class">.container</span> {</li><li>  <span class="hljs-attribute">flex-direction</span>: column;</li><li>  <span class="hljs-attribute">justify-content</span>: center;</li><li>  <span class="hljs-attribute">align-items</span>: center;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.bg-img</span> {</li><li>  <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.container-inner</span> {</li><li>  <span class="hljs-attribute">flex-direction</span>: column;</li><li>  <span class="hljs-attribute">justify-content</span>: flex-end;</li><li>  <span class="hljs-attribute">align-items</span>: flex-start;</li><li>  <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</li><li>  <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</li><li>  <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.title</span> {</li><li>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">19px</span>;</li><li>  <span class="hljs-attribute">font-weight</span>: bold;</li><li>  <span class="hljs-attribute">color</span>: white;</li><li>  <span class="hljs-attribute">text-overflow</span>: ellipsis;</li><li>  max-lines: <span class="hljs-number">1</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.detail_text</span> {</li><li>  <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;</li><li>  <span class="hljs-attribute">color</span>: white;</li><li>  <span class="hljs-attribute">opacity</span>: <span class="hljs-number">0.66</span>;</li><li>  <span class="hljs-attribute">text-overflow</span>: ellipsis;</li><li>  max-lines: <span class="hljs-number">1</span>;</li><li>  <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6px</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>JSON：卡片页面中的数据和事件交互。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TitleDefault"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"detail"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TextDefault"</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"routerEvent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"abilityName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"EntryAbility"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"add detail"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="开发卡片事件">开发卡片事件<i class="anchor-icon anchor-icon-link" anchorid="开发卡片事件" tips="复制节点链接"></i></h3>          <p>卡片支持为组件设置交互事件（action），包括router事件和message事件，其中router事件用于UIAbility跳转，message事件用于卡片开发人员自定义点击事件。</p>     <p>关键步骤说明如下：</p>     <ol>      <li>       <p>在HML中为组件设置onclick属性，其值对应到JSON文件的actions字段中。</p></li>      <li>       <p>设置router事件：</p>       <ul>        <li>action属性值为"router"。</li>        <li>abilityName为跳转目标的UIAbility名（支持跳转FA模型的PageAbility组件和Stage模型的UIAbility组件），如目前DevEco Studio创建的Stage模型的UIAbility默认名为EntryAbility。</li>        <li>params为传递给跳转目标UIAbility的自定义参数，可以按需填写。其值可以在目标UIAbility启动时的want中的parameters里获取。如Stage模型MainAbility的onCreate生命周期里的入参want的parameters字段下获取到配置的参数。</li>       </ul></li>      <li>       <p>设置message事件：</p>       <ul>        <li>action属性值为"message"。</li>        <li>params为message事件的用户自定义参数，可以按需填写。其值可以在卡片生命周期函数onFormEvent()中的message里获取。</li>       </ul></li>     </ol>     <p>示例如下。</p>     <ul>      <li>       <p>HML文件</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">stack</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-img"</span>&gt;</span></li><li>            <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/common/CardWebImg.png"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"bg-img"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">image</span>&gt;</span></li><li>            <span class="hljs-tag">&lt;<span class="hljs-name">image</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"/common/CardWebImgMatrix.png"</span></span></li><li><span class="hljs-tag">                   <span class="hljs-attr">class</span>=<span class="hljs-string">"bottom-img"</span>/&gt;</span></li><li>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container-inner"</span>&gt;</span></li><li>            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"title"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"routerEvent"</span>&gt;</span>{{ title }}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></li><li>            <span class="hljs-tag">&lt;<span class="hljs-name">text</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"detail_text"</span> <span class="hljs-attr">onclick</span>=<span class="hljs-string">"messageEvent"</span>&gt;</span>{{ detail }}<span class="hljs-tag">&lt;/<span class="hljs-name">text</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">stack</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li></ol></pre></div></div></li>      <li>       <p>CSS文件</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="css prettyprint linenums hljs language-css" hw-language="css" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-selector-class">.container</span> {</li><li>    <span class="hljs-attribute">flex-direction</span>: column;</li><li>    <span class="hljs-attribute">justify-content</span>: center;</li><li>    <span class="hljs-attribute">align-items</span>: center;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.bg-img</span> {</li><li>    <span class="hljs-attribute">flex-shrink</span>: <span class="hljs-number">0</span>;</li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</li><li>    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">1</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.bottom-img</span> {</li><li>    <span class="hljs-attribute">position</span>: absolute;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">150px</span>;</li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">56px</span>;</li><li>    <span class="hljs-attribute">top</span>: <span class="hljs-number">63%</span>;</li><li>    <span class="hljs-attribute">background-color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">216</span>, <span class="hljs-number">216</span>, <span class="hljs-number">216</span>, <span class="hljs-number">0.15</span>);</li><li>    <span class="hljs-attribute">filter</span>: <span class="hljs-built_in">blur</span>(<span class="hljs-number">20px</span>);</li><li>    <span class="hljs-attribute">z-index</span>: <span class="hljs-number">2</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.container-inner</span> {</li><li>    <span class="hljs-attribute">flex-direction</span>: column;</li><li>    <span class="hljs-attribute">justify-content</span>: flex-end;</li><li>    <span class="hljs-attribute">align-items</span>: flex-start;</li><li>    <span class="hljs-attribute">height</span>: <span class="hljs-number">100%</span>;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</li><li>    <span class="hljs-attribute">padding</span>: <span class="hljs-number">12px</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.title</span> {</li><li>    <span class="hljs-attribute">font-family</span>: HarmonyHeiTi-Medium;</li><li>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">14px</span>;</li><li>    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.90</span>);</li><li>    <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">0.6px</span>;</li><li>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">500</span>;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</li><li>    <span class="hljs-attribute">text-overflow</span>: ellipsis;</li><li>    max-lines: <span class="hljs-number">1</span>;</li><li>}</li><li>
</li><li><span class="hljs-selector-class">.detail_text</span> {</li><li>    <span class="hljs-attribute">font-family</span>: HarmonyHeiTi;</li><li>    <span class="hljs-attribute">font-size</span>: <span class="hljs-number">12px</span>;</li><li>    <span class="hljs-attribute">color</span>: <span class="hljs-built_in">rgba</span>(<span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">255</span>, <span class="hljs-number">0.60</span>);</li><li>    <span class="hljs-attribute">letter-spacing</span>: <span class="hljs-number">0.51px</span>;</li><li>    <span class="hljs-attribute">font-weight</span>: <span class="hljs-number">400</span>;</li><li>    <span class="hljs-attribute">text-overflow</span>: ellipsis;</li><li>    max-lines: <span class="hljs-number">1</span>;</li><li>    <span class="hljs-attribute">margin-top</span>: <span class="hljs-number">6px</span>;</li><li>    <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>JSON文件</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"title"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TitleDefault"</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"detail"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"TextDefault"</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"actions"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"routerEvent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"abilityName"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"JSCardEntryAbility"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"info"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router info"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"message"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"router message"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"messageEvent"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"action"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"message"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"params"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"detail"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"message detail"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <p>说明：</p>       <p>"data"中JSON Value支持多级嵌套数据，在更新数据时，需要注意携带完整数据。</p>       <p>例如：当前卡片显示07.18日Mr.Zhang的课程信息，示例如下。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"data"</span>: {</li><li>    <span class="hljs-string">"Day"</span>: <span class="hljs-string">"07.18"</span>,</li><li>    <span class="hljs-string">"teacher"</span>: {</li><li>        <span class="hljs-string">"name"</span>: <span class="hljs-string">"Mr.Zhang"</span>,</li><li>        <span class="hljs-string">"course"</span>: <span class="hljs-string">"Math"</span></li><li>    }</li><li>}</li></ol></pre></div></div>       <p>当卡片内容需要更新为07.18日Mr.Li的课程信息时，需要传递待更新的完整数据，不能只传递单个数据项，如只传name或只传course，示例如下。</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"teacher"</span>: {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Mr.Li"</span>,</li><li>    <span class="hljs-string">"course"</span>: <span class="hljs-string">"English"</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>在UIAbility中接收router事件并获取参数</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">UIAbility</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.UIAbility'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">AbilityConstant</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.AbilityConstant'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Want'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'EtsCardEntryAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EtsCardEntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (want.<span class="hljs-property">parameters</span>) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">Object</span>&gt; = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(<span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(want.<span class="hljs-property">parameters</span>.<span class="hljs-property">params</span>));</li><li>      <span class="hljs-comment">// 获取router事件中传递的info参数</span></li><li>      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">info</span> === <span class="hljs-string">'router info'</span>) {</li><li>        <span class="hljs-comment">// 执行业务逻辑</span></li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`router info: <span class="hljs-subst">${params.info}</span>`</span>);</li><li>      }</li><li>      <span class="hljs-comment">// 获取router事件中传递的message参数</span></li><li>      <span class="hljs-keyword">if</span> (params.<span class="hljs-property">message</span> === <span class="hljs-string">'router message'</span>) {</li><li>        <span class="hljs-comment">// 执行业务逻辑</span></li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`router message: <span class="hljs-subst">${params.message}</span>`</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>};</li></ol></pre></div></div></li>      <li>       <p>在FormExtensionAbility中接收message事件并获取参数</p>       <div _ngcontent-hrx-c106="" class="highlight-div"><div _ngcontent-hrx-c106="" class="highlight-div-header"><div _ngcontent-hrx-c106="" class="highlight-div-header-left"><div _ngcontent-hrx-c106="" class="handle-button expand-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-hrx-c106="" class="highlight-div-header-right"><div _ngcontent-hrx-c106="" class="handle-button ai-button"></div><div _ngcontent-hrx-c106="" class="handle-button line-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-hrx-c106="" class="handle-button theme-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-hrx-c106="" class="handle-button copy-button"><div _ngcontent-hrx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-hrx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">FormExtension</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.form.FormExtensionAbility'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'FormAbility'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FormAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FormExtension</span> {</li><li>  <span class="hljs-title function_">onFormEvent</span>(<span class="hljs-attr">formId</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 若卡片支持触发事件，则需要重写该方法并实现对事件的触发</span></li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'[EntryFormAbility] onFormEvent'</span>);</li><li>    <span class="hljs-comment">// 获取message事件中传递的detail参数</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">msg</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>(message);</li><li>    <span class="hljs-keyword">if</span> (msg.<span class="hljs-property">detail</span> === <span class="hljs-string">'message detail'</span>) {</li><li>      <span class="hljs-comment">// 执行业务逻辑</span></li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'message info:'</span> + msg.<span class="hljs-property">detail</span>);</li><li>    }</li><li>  }</li><li>};</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>