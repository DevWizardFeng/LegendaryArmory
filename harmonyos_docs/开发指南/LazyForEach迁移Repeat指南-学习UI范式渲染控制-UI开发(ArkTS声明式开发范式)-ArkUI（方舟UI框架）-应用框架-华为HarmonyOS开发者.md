<h1 _ngcontent-jwu-c119="" class="doc-title ng-star-inserted" title="LazyForEach迁移Repeat指南"> LazyForEach迁移Repeat指南 </h1>

<div _ngcontent-jwu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat">Repeat</a>是ArkUI在API version 12中新引入的循环渲染组件，相比<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach">LazyForEach</a>具有更简洁的API、更丰富的功能以及更强的性能优化能力。本指南帮助开发者将LazyForEach平滑地迁移到Repeat。</p>    <div class="tiledSection">     <h2 id="基础用法迁移">基础用法迁移<i class="anchor-icon anchor-icon-link" anchorid="基础用法迁移" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="数据首次渲染" class="firsth2">数据首次渲染<i class="anchor-icon anchor-icon-link" anchorid="数据首次渲染" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>LazyForEach根据数据源循环渲染子组件。</p>     <p>示例1中，在容器组件<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list">List</a>中使用LazyForEach，并基于数据源循环渲染出了一系列<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-components-text-display">Text</a>子组件。</p>     <p><strong>示例1 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以上是一个典型的使用LazyForEach循环渲染子组件的场景，下面将介绍如何将此示例迁移至Repeat。</p>     <p><strong>迁移步骤</strong></p>     <ol>      <li>       <p>使用状态管理V2装饰器。</p>       <p>Repeat推荐和状态管理V2装饰器配合使用（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#循环渲染能力说明">懒加载</a>模式下只支持和状态管理V2装饰器配合使用）。如果之前使用的是状态管理V1装饰器，需要修改为状态管理V2装饰器。</p>       <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 迁移前 - LazyForEach</span></li><li><span class="hljs-meta">@Component</span> <span class="hljs-comment">// 状态管理V1</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-title class_">LazyForEach</span>(...)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...其他属性、方法</span></li><li>}</li><li>  </li><li><span class="hljs-comment">// 迁移后 - Repeat</span></li><li><span class="hljs-meta">@ComponentV2</span> <span class="hljs-comment">// 状态管理V2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-title class_">Repeat</span>(...)</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>  <span class="hljs-comment">// ...其他属性、方法</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>迁移数据源。</p>       <p>LazyForEach使用专用的数据结构<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#idatasource" target="_blank">IDataSource</a>作为数据源。迁移至Repeat后，不再使用IDataSource作为数据源，而是使用状态管理V2装饰的数组作为数据源。</p>       <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 迁移前 - LazyForEach</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>  </li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>  </li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>  </li><li>  <span class="hljs-comment">// ...其他方法</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 迁移后 - Repeat</span></li><li><span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li></ol></pre></div></div></li>      <li>       <p>迁移组件生成函数和键值生成函数。</p>       <p>LazyForEach与Repeat均通过组件生成函数，为每一项数据创建一个子组件；通过键值生成函数，为每一项数据生成一个唯一的键值。</p>       <p>从LazyForEach迁移至Repeat时，两者的语法存在差异。Repeat需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#each" target="_blank">.each()</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#template" target="_blank">.template()</a>中设置组件生成函数，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#key" target="_blank">.key()</a>中设置键值生成函数。</p>       <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 迁移前 - LazyForEach</span></li><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-comment">// 数据源</span></li><li>    <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-comment">// 组件生成函数</span></li><li>      <span class="hljs-title class_">ListItem</span>() {</li><li>        <span class="hljs-title class_">Text</span>(item)</li><li>      }</li><li>    },</li><li>    <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item <span class="hljs-comment">// 键值生成函数</span></li><li>  )</li><li>}</li><li>
</li><li><span class="hljs-comment">// 迁移后 - Repeat</span></li><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>) <span class="hljs-comment">// 数据源</span></li><li>    .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 组件生成函数</span></li><li>      <span class="hljs-title class_">ListItem</span>() {</li><li>        <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>)</li><li>      }</li><li>    })</li><li>    .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item) <span class="hljs-comment">// 键值生成函数</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>配置懒加载功能。</p>       <p>Repeat具有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#循环渲染能力说明">懒加载</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#关闭懒加载">全量加载</a>两种模式。</p>       <ul>        <li>全量加载模式渲染所有子节点（对标<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach">ForEach</a>）。</li>        <li>懒加载模式动态渲染屏幕区域和预加载区域内的子节点（需要与容器组件配合使用，对标LazyForEach）。</li>       </ul>       <p>从LazyForEach迁移至Repeat时，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#virtualscroll" target="_blank">virtualScroll</a>)属性，使能懒加载。</p>       <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 迁移前 - LazyForEach</span></li><li><span class="hljs-title class_">LazyForEach</span>(data, <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> {...}, <span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> item)</li><li>
</li><li><span class="hljs-comment">// 迁移后 - Repeat</span></li><li><span class="hljs-title class_">Repeat</span>(data)</li><li>  .<span class="hljs-title function_">virtualScroll</span>() <span class="hljs-comment">// 使能懒加载</span></li></ol></pre></div></div></li>     </ol>     <p><strong>迁移后代码</strong></p>     <p>通过以上步骤，可以将示例1从LazyForEach迁移至Repeat，迁移后的完整示例如下所示。</p>     <p><strong>示例1 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span> <span class="hljs-comment">// 使用状态管理V2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []; <span class="hljs-comment">// 数据源为状态管理V2装饰的数组</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>) <span class="hljs-comment">// 使用Repeat</span></li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 组件生成函数</span></li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${repeatItem.item}</span>`</span>);</li><li>                })</li><li>            }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item) <span class="hljs-comment">// 键值生成函数</span></li><li>        .<span class="hljs-title function_">virtualScroll</span>() <span class="hljs-comment">// 使能懒加载</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="700" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.44445877978326456115512166069395:50001231000000:2800:779C8FDEA4CFD6B616234BEFD33A75E1CE4730994FF38D9BD8B999DCDFAB63B4.gif" width="350" height="700"></span></p>    </div>    <div class="tiledSection">     <h3 id="数据更新操作">数据更新操作<i class="anchor-icon anchor-icon-link" anchorid="数据更新操作" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>当LazyForEach的数据源发生变化时，开发者需要根据数据源的变化情况调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#datachangelistener" target="_blank">DataChangeListener</a>对应的接口，通知LazyForEach做相应的更新。主要的数据操作包括：添加数据、删除数据、交换数据、修改单个数据、修改多个数据、精准批量修改数据。</p>     <p>示例2演示了主要的数据操作。</p>     <p><strong>示例2 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 添加数据</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 删除数据</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataDelete</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 交换数据</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">moveData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">temp</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-keyword">from</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-keyword">from</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[to];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[to] = temp;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 修改单个数据</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">changeData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataChange</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 修改多个数据</span></li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">modifyAllData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-string">'Changed '</span> + item;</li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-comment">// 点击追加子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Add new item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`New item <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count++}</span>`</span>);</li><li>        })</li><li>      <span class="hljs-comment">// 点击删除子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Delete item 0'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">deleteData</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>      <span class="hljs-comment">// 点击交换子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Swap item 0 and item 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">moveData</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-comment">// 点击修改单个子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change item 0'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">changeData</span>(<span class="hljs-number">0</span>, <span class="hljs-string">`Changed item <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count++}</span>`</span>);</li><li>        })</li><li>      <span class="hljs-comment">// 点击修改多个子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change all items'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">modifyAllData</span>();</li><li>        })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>            }</li><li>          }</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以上是一个典型的更新数据后LazyForEach重新渲染子组件的场景，下面将介绍如何将此示例迁移至Repeat。</p>     <p><strong>迁移步骤</strong></p>     <ol>      <li>       <p>迁移准备。</p>       <p>根据数据首次渲染小节中的步骤，将LazyForEach替换为Repeat。</p>       <ol>        <li>使用状态管理V2装饰器。</li>        <li>迁移数据源。</li>        <li>迁移组件生成函数与键值生成函数。</li>        <li>使能懒加载。</li>       </ol></li>      <li>       <p>迁移数据源修改方式。</p>       <ul>        <li>对于LazyForEach，在修改数据源后需要调用对应的接口通知其更新。</li>        <li>对于Repeat，由状态管理V2监听其数据源变化，并触发更新。因此，开发者直接修改数据源即可，无需其他额外操作。</li>       </ul>       <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 以修改单个数据为例</span></li><li><span class="hljs-comment">// 迁移前 - LazyForEach</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>  </li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">changeData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">newData</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataChange</span>(index);</li><li>  }</li><li>  </li><li>  <span class="hljs-comment">// ...其他方法</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 迁移后 - Repeat</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>, data);</li></ol></pre></div></div>       <p>其他数据更新操作，如添加数据、删除数据、交换数据等，与以上方法类似，可通过直接修改数据源数组实现。</p></li>     </ol>     <p><strong>迁移后代码</strong></p>     <p>迁移后的完整示例如下。</p>     <p><strong>示例2 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-comment">// 点击追加子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Add new item'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`New item <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count++}</span>`</span>); })</li><li>      <span class="hljs-comment">// 点击删除子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Delete item 0'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>); })</li><li>      <span class="hljs-comment">// 点击交换子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Swap item 0 and item 1'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">let</span> <span class="hljs-attr">temp</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>];</li><li>                         <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[<span class="hljs-number">0</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[<span class="hljs-number">1</span>];</li><li>                         <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>[<span class="hljs-number">1</span>] = temp; })</li><li>      <span class="hljs-comment">// 点击修改单个子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change item 0'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-string">`Changed item <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count++}</span>`</span>); })</li><li>      <span class="hljs-comment">// 点击修改多个子组件</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change all items'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> { <span class="hljs-keyword">return</span> <span class="hljs-string">'Changed '</span> + item; }); })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>              }</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="585" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.18580064218920521453628512022161:50001231000000:2800:F83926AD581E7856B39599FFE01AA7829E95D6D49B04C7E90BCB2C7773CFFD1C.gif" width="350" height="585"></span></p>    </div>    <div class="tiledSection">     <h2 id="典型场景迁移">典型场景迁移<i class="anchor-icon anchor-icon-link" anchorid="典型场景迁移" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="修改数据子属性" class="firsth2">修改数据子属性<i class="anchor-icon anchor-icon-link" anchorid="修改数据子属性" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>LazyForEach可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed与@ObjectLink</a>装饰器实现对数据子属性的观测。当有数据子属性发生变化时，仅更新使用了该子属性的组件，从而提高性能。</p>     <p>示例3演示了对子属性的观测。</p>     <p><strong>示例3 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          item.<span class="hljs-property">message</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>        })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat需要和状态管理V2一起使用，状态管理V2提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObserveV2和@Trace</a>装饰器对子属性进行深度观测。迁移时，需要将@Observe和@ObjectLink装饰器迁移至@ObserveV2和@Trace装饰器。</p>     <p>迁移后的示例如下所示。</p>     <p><strong>示例3 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>; <span class="hljs-comment">// 观测子属性</span></li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${repeatItem.item.message}</span>`</span>);</li><li>              })</li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'0'</span>;</li><li>          })</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>()</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.09614219566612942289518971939269:50001231000000:2800:8A2433E0B516230EBD48C3D38CC40D0A23B3DF8EBB4EBE085CDC7239C3251A0F.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h3 id="状态管理v2观测组件内部状态">状态管理V2观测组件内部状态<i class="anchor-icon anchor-icon-link" anchorid="状态管理v2观测组件内部状态" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>状态管理V2的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>装饰器提供了观测自定义组件内部变量的能力。被@Local装饰的变量发生变化时，会通知LazyForEach更新对应的组件。</p>     <p>示例4演示了在LazyForEach中使用@Local装饰器观测数据变化，触发组件更新。</p>     <p><strong>示例4 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 修改@ObservedV2装饰类中@Trace装饰的变量，触发刷新此处Text组件</span></li><li>                item.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>              })</li><li>            <span class="hljs-title class_">ChildComponent</span>()</li><li>          }</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'?'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 修改@Local装饰的变量，触发刷新此处Text组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'?'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat本身支持与状态管理V2联合使用，将LazyForEach相关代码修改为Repeat后，即可实现对组件内部状态变量的观测。</p>     <p>迁移后的示例如下所示。</p>     <p><strong>示例4 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>                .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-comment">// 修改@ObservedV2装饰类中@Trace装饰的变量，触发刷新此处Text组件</span></li><li>                  repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>                })</li><li>              <span class="hljs-title class_">ChildComponent</span>()</li><li>            }</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>()</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'?'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 修改@Local装饰的变量，触发刷新此处Text组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'?'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.42084056381888187352093067745394:50001231000000:2800:BD4F713DDD780EADEFC88A7906AD0833D4AD42888817551318649E4FA98AECFA.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h3 id="状态管理v2观测组件外部输入">状态管理V2观测组件外部输入<i class="anchor-icon anchor-icon-link" anchorid="状态管理v2观测组件外部输入" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>状态管理V2的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a>装饰器提供了观测自定义组件外部输入变量的能力，可以实现父子组件间的数据同步。将父组件的变量传递给子组件，并用@Param装饰，当父组件变量发生变化时，会通知对应的组件更新。</p>     <p>示例5演示了在LazyForEach中使用@Param装饰器观测数据变化，触发组件更新。</p>     <p><strong>示例5 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item.<span class="hljs-property">message</span> }) <span class="hljs-comment">// 向自定义组件内传入变量</span></li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              item.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>            })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// 接收来自外部的变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat本身支持与状态管理V2联合使用，将LazyForEach相关代码修改为Repeat后，即可实现对组件外部输入状态变量的观测。</p>     <p>迁移后的示例如下所示。</p>     <p><strong>示例5 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span> }) <span class="hljs-comment">// 向自定义组件内传入变量</span></li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>              })</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>()</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>; <span class="hljs-comment">// 接收来自外部的变量</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.33892128682719939606767998613305:50001231000000:2800:566C91DEAC9F2B84D5FA7D631D299ED4C2D38F99B30D7D9EA6E246AFF0E66AB6.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h3 id="拖拽排序">拖拽排序<i class="anchor-icon anchor-icon-link" anchorid="拖拽排序" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>LazyForEach的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-drag-sorting#onmove" target="_blank">onMove</a>属性提供了拖拽排序能力。</p>     <p>示例6为典型用例。</p>     <p><strong>示例6 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">moveDataWithoutNotify</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(to, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(i.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>              .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span> })</li><li>          }.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFFFF'</span>)</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          .<span class="hljs-title function_">onMove</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">from</span>: <span class="hljs-built_in">number</span>, to: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-comment">// 实现拖拽排序</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">moveDataWithoutNotify</span>(<span class="hljs-keyword">from</span>, to);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFDCDCDC'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat具有与LazyForEach相同的onMove属性。将LazyForEach相关代码修改为Repeat后，即可实现拖拽排序。</p>     <p>迁移后的示例如下所示。</p>     <p><strong>示例6 - 迁移后</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(i.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">moveData</span>(<span class="hljs-params"><span class="hljs-keyword">from</span>: <span class="hljs-built_in">number</span>, to: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">splice</span>(to, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-title function_">toString</span>())</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span> })</li><li>            }.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFFFF'</span>)</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>          .<span class="hljs-title function_">onMove</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">from</span>: <span class="hljs-built_in">number</span>, to: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-comment">// 实现拖拽排序</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">moveData</span>(<span class="hljs-keyword">from</span>, to);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFDCDCDC'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.32208769394695406680201628727523:50001231000000:2800:ED20C555A745CBA7BD92079D9D46EB98CE2CDD17F52182F01EE5A18787DC5912.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h3 id="组件复用">组件复用<i class="anchor-icon anchor-icon-link" anchorid="组件复用" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>LazyForEach自身并不具备组件复用能力，为实现组件复用，需要与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable">@Reusable</a>装饰器配合使用（被@Reusable装饰的自定义组件具有复用能力）。</p>     <p>示例7演示了组件复用的典型场景。</p>     <p><strong>示例7 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>            .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onAppear: <span class="hljs-subst">${item.message}</span>`</span>);</li><li>            })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 对复用的组件进行数据更新</span></li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = params.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">StringData</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat本身具备组件复用能力，同时也支持与状态管理V2的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-reusablev2">@ReusableV2</a>装饰器联合使用。因此，迁移至Repeat后，其组件复用具有两种实现方案。</p>     <ol>      <li>直接使用Repeat自身的复用能力。</li>      <li>使用@ReusableV2装饰器提供的复用能力。</li>     </ol>     <p>需要注意的是，Repeat默认使能自身的复用能力，且优先级高于@ReusableV2装饰器。若要使用@ReusableV2装饰器，需要先手动关闭Repeat自身的复用能力（@ReusableV2装饰器从API version 18开始支持，Repeat从API version 19开始支持关闭自身复用能力）。</p>     <p><strong>示例7 - 迁移方案1：使用Repeat自身的复用能力</strong></p>     <p>Repeat本身具备复用能力，且默认开启。将LazyForEach相关代码迁移至Repeat后，便已经具备了复用能力。</p>     <p>修改后的示例如下。</p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>) <span class="hljs-comment">// Repeat自身具备复用功能</span></li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>()</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>示例7 - 迁移方案2：使用@ReusableV2装饰器</strong></p>     <p>若要使用@ReusableV2装饰器，首先需要通过.virtualScroll({ reusable: false })关闭Repeat自身的复用功能，再用@ReusableV2装饰需要复用的自定义组件。</p>     <p>相较于Repeat自身的复用，@ReusableV2装饰的自定义组件在回收和复用时，会触发aboutToRecycle和aboutToReuse两个生命周期。</p>     <p>使用@ReusableV2装饰器的迁移示例如下所示。</p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: repeatItem.<span class="hljs-property">item</span> })</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onAppear: <span class="hljs-subst">${repeatItem.item.message}</span>`</span>);</li><li>              })</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">reusable</span>: <span class="hljs-literal">false</span> }) <span class="hljs-comment">// 关闭Repeat自身的复用功能（API 19）</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用@ReusableV2实现组件复用（API 18）</span></li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.41126381306338799756061588698615:50001231000000:2800:3A6178037036FBB38EE418CA3020ABA84B21C7C1F9D5E21D5B2B364AEA798E3D.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h3 id="模板渲染">模板渲染<i class="anchor-icon anchor-icon-link" anchorid="模板渲染" tips="复制节点链接"></i></h3>          <p><strong>LazyForEach示例</strong></p>     <p>LazyForEach自身并不具备模板渲染能力。为实现模板渲染能力，需要开发者自己实现逻辑判断，为不同的数据项选择不同的渲染模板。</p>     <p>示例8演示了模板渲染的典型场景。</p>     <p><strong>示例8 - 迁移前</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getType</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> &gt;= <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">200</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>, i % <span class="hljs-number">2</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-comment">// 开发者自己实现逻辑判断，为不同的数据项选择不同的渲染模板</span></li><li>          <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">getType</span>() == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-comment">// 模板A</span></li><li>            <span class="hljs-title class_">ChildComponentA</span>({ <span class="hljs-attr">data</span>: item })</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A onAppear: <span class="hljs-subst">${item.message}</span>`</span>);</li><li>              })</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// 模板B</span></li><li>            <span class="hljs-title class_">ChildComponentB</span>({ <span class="hljs-attr">data</span>: item })</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B onAppear: <span class="hljs-subst">${item.message}</span>`</span>);</li><li>              })</li><li>          }</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用@Reusable实现组件复用</span></li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponentA</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = params.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">StringData</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Type A'</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponentB</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = params.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">StringData</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Type B'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>迁移Repeat</strong></p>     <p>Repeat本身具备模板渲染能力，开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#templateid" target="_blank">templateId</a>方法为不同的数据项选择不同的模板，再通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#template" target="_blank">template</a>方法为不同的模板配置不同的组件生成函数。同时，开发者仍然可以选择自己实现逻辑判断，为不同的数据项分配不同的模板。</p>     <p>需要注意的是，如果开发者选择自己实现模板渲染，则需要关闭Repeat自身的复用功能。否则，Repeat在复用子组件时无法选择正确的模板，会导致渲染异常。</p>     <p><strong>示例8 - 迁移方案1：使用Repeat自身的模板渲染能力</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getType</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> &gt;= <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">200</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>, i % <span class="hljs-number">2</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Default item'</span>)</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">template</span>(<span class="hljs-string">'A'</span>, <span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> { <span class="hljs-comment">// 模板A</span></li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Type A'</span>)</li><li>            }</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">template</span>(<span class="hljs-string">'B'</span>, <span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> { <span class="hljs-comment">// 模板B</span></li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(repeatItem.<span class="hljs-property">item</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Type B'</span>)</li><li>            }</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData</span>) =&gt;</span> { <span class="hljs-comment">// 为不同的数据项选择不同的模板</span></li><li>          <span class="hljs-keyword">if</span> (item.<span class="hljs-title function_">getType</span>() == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-string">'A'</span>;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-string">'B'</span>;</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>()</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>示例8 - 迁移方案2：由开发者实现模板渲染能力</strong></p>     <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">type</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, <span class="hljs-keyword">type</span>: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> = <span class="hljs-keyword">type</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">getType</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">type</span> &gt;= <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">200</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>, i % <span class="hljs-number">2</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>)</li><li>        .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">repeatItem</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-comment">// 开发者自己实现逻辑判断，为不同的数据项选择不同的渲染模板</span></li><li>            <span class="hljs-keyword">if</span> (repeatItem.<span class="hljs-property">item</span>.<span class="hljs-title function_">getType</span>() == <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-title class_">ChildComponentA</span>({ <span class="hljs-attr">data</span>: repeatItem.<span class="hljs-property">item</span> }) <span class="hljs-comment">// 模板A</span></li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A onAppear: <span class="hljs-subst">${repeatItem.item.message}</span>`</span>);</li><li>                })</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-title class_">ChildComponentB</span>({ <span class="hljs-attr">data</span>: repeatItem.<span class="hljs-property">item</span> }) <span class="hljs-comment">// 模板B</span></li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B onAppear: <span class="hljs-subst">${repeatItem.item.message}</span>`</span>);</li><li>                })</li><li>            }</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">reusable</span>: <span class="hljs-literal">false</span> }) <span class="hljs-comment">// 关闭Repeat自身的复用功能（API 19），避免渲染异常</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用@ReusableV2实现组件复用（API 18）</span></li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponentA</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type A aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Type A'</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ReusableV2</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponentB</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToReuse</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`type B aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Type B'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示。</p>     <p><span><img originheight="715" originwidth="350" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114849.86561870833157630665281316211589:50001231000000:2800:3DD0B26C20B62AD3A6E378BB46B54149B7163EFA846BEF40830E430E8219EE55.gif" width="350" height="715"></span></p>    </div>    <div class="tiledSection">     <h2 id="basicdatasource示例代码">BasicDataSource示例代码<i class="anchor-icon anchor-icon-link" anchorid="basicdatasource示例代码" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="string类型数组的basicdatasource代码" class="firsth2">string类型数组的BasicDataSource代码<i class="anchor-icon anchor-icon-link" anchorid="string类型数组的basicdatasource代码" tips="复制节点链接"></i></h3>          <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// BasicDataSource实现了IDataSource接口，用于管理listener监听，以及通知LazyForEach数据更新</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.ADD, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.CHANGE, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.DELETE, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange(</span></li><li>      <span class="hljs-comment">//         [{type: DataOperationType.EXCHANGE, index: {start: from, end: to}}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="stringdata类型数组的basicdatasource代码">StringData类型数组的BasicDataSource代码<i class="anchor-icon anchor-icon-link" anchorid="stringdata类型数组的basicdatasource代码" tips="复制节点链接"></i></h3>          <div _ngcontent-jwu-c106="" class="highlight-div"><div _ngcontent-jwu-c106="" class="highlight-div-header"><div _ngcontent-jwu-c106="" class="highlight-div-header-left"><div _ngcontent-jwu-c106="" class="handle-button expand-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jwu-c106="" class="highlight-div-header-right"><div _ngcontent-jwu-c106="" class="handle-button ai-button"></div><div _ngcontent-jwu-c106="" class="handle-button line-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jwu-c106="" class="handle-button theme-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jwu-c106="" class="handle-button copy-button"><div _ngcontent-jwu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jwu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>