<h1 _ngcontent-ouv-c119="" class="doc-title ng-star-inserted" title="LazyForEach：数据懒加载"> LazyForEach：数据懒加载 </h1>

<div _ngcontent-ouv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>API参数说明见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach API参数说明</a>。</p>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>LazyForEach为开发者提供了基于数据源渲染出一系列子组件的能力。具体而言，LazyForEach从数据源中按需迭代数据，并在每次迭代时创建相应组件。当在滚动容器中使用了LazyForEach，框架会根据滚动容器可视区域按需创建组件，当组件滑出可视区域外时，框架会销毁并回收组件以降低内存占用。</p>     <p>本文档依次介绍了LazyForEach的<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#基本用法">基本用法</a>、<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#高级用法">高级用法</a>和<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#常见问题">常见问题</a>，开发者可以按需阅读。在<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#首次渲染">首次渲染</a>小节中，给出了简单的示例，可以帮助开发者快速上手LazyForEach的使用。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在大量子组件的的场景下，LazyForEach与缓存列表项、动态预加载、组件复用等方法配合使用，可以进一步提升滑动帧率并降低应用内存占用。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-best-practices-long-list" target="_blank">长列表加载丢帧优化</a>。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2>          <ul>      <li>LazyForEach必须在容器组件内使用，仅有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list" target="_blank">List</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitemgroup" target="_blank">ListItemGroup</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid" target="_blank">Grid</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper" target="_blank">Swiper</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-waterflow" target="_blank">WaterFlow</a>组件支持数据懒加载（可配置cachedCount属性，即只加载可视部分以及其前后少量数据用于缓冲），其他组件仍然是一次性加载所有的数据。支持数据懒加载的父组件根据自身及子组件的高度或宽度计算可视区域内需布局的子节点数量，高度或宽度的缺失会导致部分场景<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#懒加载失效">懒加载失效</a>。</li>      <li>LazyForEach依赖生成的键值判断是否刷新子组件，键值不变则不触发刷新。</li>      <li>容器组件内只能包含一个LazyForEach。以List为例，不建议同时包含ListItem、ForEach、LazyForEach，不建议同时包含多个LazyForEach。</li>      <li>LazyForEach在每次迭代中，必须创建且只允许创建一个子组件；即LazyForEach的子组件生成函数有且只有一个根组件。</li>      <li>生成的子组件必须是允许包含在LazyForEach父容器组件中的子组件。</li>      <li>允许LazyForEach包含在if/else条件渲染语句中，也允许LazyForEach中出现if/else条件渲染语句。</li>      <li>键值生成器必须针对每个数据生成唯一的值，如果键值相同，将导致键值相同的UI组件渲染出现问题。</li>      <li>LazyForEach必须使用一个数据变化监听器DataChangeListener对象进行更新（具体参数使用参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach" target="_blank">LazyForEach</a>），重新赋值第一个参数dataSource会导致异常；dataSource使用状态变量时，状态变量改变不会触发LazyForEach的UI刷新。</li>      <li>为了高性能渲染，使用DataChangeListener对象的onDataChange方法更新UI时，需要生成不同于原来的键值来触发组件刷新。</li>      <li>LazyForEach和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable">@Reusable装饰器</a>一起使用能触发节点复用。使用方法：将@Reusable装饰在LazyForEach列表的组件上，见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable#列表滚动配合lazyforeach使用">列表滚动配合LazyForEach使用</a>。</li>      <li>LazyForEach和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-reusablev2">@ReusableV2装饰器</a>一起使用能触发节点复用。详见@ReusableV2装饰器指南文档中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-reusablev2#在lazyforeach组件中使用">在LazyForEach组件中使用</a>。</li>      <li>LazyForEach的子节点在离开可视区域和预加载区域时，不会立即被析构或回收，LazyForEach会在空闲时析构或回收这些节点。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="基本用法">基本用法<i class="anchor-icon anchor-icon-link" anchorid="基本用法" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="设置数据源" class="firsth2">设置数据源<i class="anchor-icon anchor-icon-link" anchorid="设置数据源" tips="复制节点链接"></i></h3>          <p>为了管理<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#datachangelistener" target="_blank">DataChangeListener</a>监听器和通知LazyForEach更新数据，开发者需要使用如下方法：首先实现LazyForEach提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#idatasource" target="_blank">IDataSource</a>接口，将其作为LazyForEach的数据源，然后管理监听器和更新数据。</p>     <p>为实现基本的数据管理和监听能力，开发者需要实现IDataSource的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#totalcount" target="_blank">totalCount</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#getdata" target="_blank">getData</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#registerdatachangelistener" target="_blank">registerDataChangeListener</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#unregisterdatachangelistener" target="_blank">unregisterDataChangeListener</a>方法，具体请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#basicdatasource示例代码">BasicDataSource示例代码</a>。当数据源变化时，通过调用监听器的接口通知LazyForEach更新，具体请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#数据更新">数据更新</a>。</p>    </div>    <div class="tiledSection">     <h3 id="键值生成规则">键值生成规则<i class="anchor-icon anchor-icon-link" anchorid="键值生成规则" tips="复制节点链接"></i></h3>          <p>在LazyForEach循环渲染过程中，系统为每个item生成一个唯一且持久的键值，用于标识对应的组件。键值变化时，ArkUI框架将视为该数组元素已被替换或修改，并基于新的键值创建新的组件。</p>     <p>LazyForEach提供了参数keyGenerator，开发者可以使用该函数生成自定义键值。如果未定义keyGenerator函数，ArkUI框架将使用默认的键值生成函数：(item: Object, index: number) =&gt; { return viewId + '-' + index.toString(); }。viewId在编译器转换过程中生成，同一个LazyForEach组件内的viewId一致。</p>     <p>键值应满足以下条件。</p>     <ol>      <li>键值具有唯一性，每个数据项对应的键值互不相同。</li>      <li>键值具有一致性，数据项不变时对应的键值也不变。</li>     </ol>     <p>上述条件保证LazyForEach正确、高效地更新子组件，否则可能存在渲染结果异常、渲染效率降低等问题。</p>    </div>    <div class="tiledSection">     <h3 id="组件创建规则">组件创建规则<i class="anchor-icon anchor-icon-link" anchorid="组件创建规则" tips="复制节点链接"></i></h3>          <p>在确定键值生成规则后，LazyForEach的第二个参数itemGenerator函数会根据组件创建规则为数据源的每个数组项创建组件。组件的创建包括两种情况：LazyForEach<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#首次渲染">首次渲染</a>和LazyForEach非首次渲染的<a href="/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach#数据更新">数据更新</a>。</p>    </div>    <div class="tiledSection">     <h3 id="首次渲染">首次渲染<i class="anchor-icon anchor-icon-link" anchorid="首次渲染" tips="复制节点链接"></i></h3>          <p>使用LazyForEach时，开发者需要提供数据源、键值生成函数和组件创建函数。<strong>开发者需保证键值生成函数为每项数据生成不同的键值。</strong></p>     <p>在LazyForEach首次渲染时，会根据上述键值生成规则为数据源的每个数组项生成唯一键值并创建相应的组件。</p>     <p>对于预加载区域内的节点，若创建耗时较长，框架会分帧执行创建任务。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上述代码中，keyGenerator函数的返回值是item。LazyForEach循环渲染时，为数据源数组项依次生成键值Hello 0、Hello 1 ... Hello 20，并创建对应的ListItem子组件渲染到界面上。</p>     <p>运行效果如下图所示。</p>     <p><strong>图1</strong> LazyForEach正常首次渲染</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.02502916938619254525938943706291:50001231000000:2800:7E47DD53D5A6A69FB513B9BA05EFE4E87749470BC03D19DB01A46482C852E866.gif" width="303" height="610"></span></p>     <p><strong>错误案例：键值相同导致渲染异常</strong></p>     <p>当不同数据项生成的键值相同时，框架的行为是不可预测的。例如，在以下代码中，LazyForEach渲染的数据项键值均相同，在滑动过程中，LazyForEach会预加载划入划出当前页面的子组件，而新建的子组件和销毁的旧子组件具有相同的键值，框架可能取用错误的缓存，导致子组件渲染出现问题。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-string">`same key`</span>) <span class="hljs-comment">// 自定义键值生成函数，返回相同键值</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果如下图所示。</p>     <p><strong>图2</strong> LazyForEach存在相同键值</p>     <p><span><img originheight="589" originwidth="278" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.96644888573420226800141869821731:50001231000000:2800:95C68BE2DD8757748A12EF90FF5B2318953938DEF9805E28DBE665B43F2C5857.gif" class="notEnlarge" width="278" height="589"></span></p>     <p>修改上述示例中LazyForEach的键值生成函数，使每个数据项生成唯一的键值，保证渲染效果符合预期。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">ListItem</span>() {</li><li>   <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>      })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${item}</span>-<span class="hljs-subst">${index}</span>`</span>) <span class="hljs-comment">// 自定义键值生成函数，返回唯一键值</span></li></ol></pre></div></div>     <p>修改后运行效果如下图所示。</p>     <p><strong>图3</strong> LazyForEach生成唯一键值</p>     <p><span><img originheight="589" originwidth="278" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.98500043794890134023425906386105:50001231000000:2800:066EDFAAFC65B012C7D08F5783EE42B33CCAEED531D308E8DED7440C7FD06A0E.gif" class="notEnlarge" width="278" height="589"></span></p>    </div>    <div class="tiledSection">     <h3 id="数据更新">数据更新<i class="anchor-icon anchor-icon-link" anchorid="数据更新" tips="复制节点链接"></i></h3>          <p>当LazyForEach数据源发生变化，需要再次渲染时，开发者应根据数据源的变化情况调用listener对应的接口，通知LazyForEach做相应的更新。LazyForEach的更新操作包括：添加数据、删除数据、交换数据、改变单个数据、改变多个数据以及精准批量修改数据，各使用场景示例如下。</p>     <p><strong>添加数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 点击追加子组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.totalCount()}</span>`</span>);</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>点击LazyForEach的子组件时，首先调用数据源data的pushData方法。此方法会在数据源末尾添加数据，并调用notifyDataAdd方法。notifyDataAdd方法内部会调用listener.onDataAdd方法，通知LazyForEach有数据添加。LazyForEach接收到通知后，在该索引处新建子组件。</p>     <p>运行效果如下图所示。</p>     <p><strong>图4</strong> LazyForEach添加数据</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.01332717038141484200301541714228:50001231000000:2800:BEDDD77209C845892FE4E9D421CC6FA440865FB1F582CE2ED82E134FF7361733.gif" width="303" height="610"></span></p>     <p><strong>删除数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getAllData</span>(): <span class="hljs-built_in">string</span>[] {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataDelete</span>(index);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 点击删除子组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">deleteData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">getAllData</span>().<span class="hljs-title function_">indexOf</span>(item));</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>点击LazyForEach的子组件时，调用数据源data的deleteData方法。此方法删除数据源中对应索引的数据，并调用notifyDataDelete方法。notifyDataDelete方法内调用listener.onDataDelete方法，通知 LazyForEach删除该索引处的子组件。</p>     <p>运行效果如下图所示。</p>     <p><strong>图5</strong> LazyForEach删除数据</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.13907186092256104161155902142016:50001231000000:2800:1FDBD1680E0B71441AE06B29E52696B0507C598EE3D9438BE9E3D2C5947A4796.gif" width="303" height="610"></span></p>     <p><strong>交换数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getAllData</span>(): <span class="hljs-built_in">string</span>[] {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">moveData</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">temp</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-keyword">from</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-keyword">from</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[to];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[to] = temp;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">moved</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">getAllData</span>().<span class="hljs-title function_">indexOf</span>(item));</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">moved</span>.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) {</li><li>            <span class="hljs-comment">// 点击交换子组件</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">moveData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">moved</span>[<span class="hljs-number">0</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">moved</span>[<span class="hljs-number">1</span>]);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">moved</span> = [];</li><li>          }</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>首次点击LazyForEach的子组件时，将要移动的数据索引存储在moved成员变量中。再次点击LazyForEach的另一个子组件时，将首次点击的子组件移到此处。调用数据源data的moveData方法，该方法将数据源中的数据移动到预期位置，并调用notifyDataMove方法。notifyDataMove方法会调用listener.onDataMove方法，通知LazyForEach在该处有数据需要移动。LazyForEach将from和to索引处的子组件进行位置调换。</p>     <p>运行效果如下图所示。</p>     <p><strong>图6</strong> LazyForEach交换数据</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.01428808846757865682114211673592:50001231000000:2800:4CD9F72A581AFC6D5BA76F6D62D43D5DD5EA54776E916CDAF4E877116693A443.gif" width="303" height="610"></span></p>     <p><strong>改变单个数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">changeData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>, data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataChange</span>(index);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">changeData</span>(index, item + <span class="hljs-string">'00'</span>);</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>点击LazyForEach的子组件时，首先改变当前数据，然后调用数据源data的changeData方法。changeData 方法会调用notifyDataChange方法，该方法又会调用listener.onDataChange方法，通知LazyForEach组件数据发生变化。LazyForEach会在对应索引处重建子组件。</p>     <p>运行效果如下图所示。</p>     <p><strong>图7</strong> LazyForEach改变单个数据</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.67963773572161028763840933902146:50001231000000:2800:2B0F6C174985B123D5DE40F32452E05AEC835B34279B7D1E9122A1B367075B2C.gif" width="303" height="610"></span></p>     <p><strong>改变多个数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">reloadData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">modifyAllData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> item + <span class="hljs-string">'0'</span>;</li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">modifyAllData</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">reloadData</span>();</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>点击LazyForEach的子组件时，首先调用data的modifyAllData方法修改数据源中的所有数据，然后调用数据源的reloadData方法。该方法内会调用notifyDataReload方法，notifyDataReload方法内会调用listener.onDataReloaded方法，通知LazyForEach重建所有子节点。LazyForEach会将原数据项和新数据项进行键值比对，若键值相同则使用缓存，若键值不同则重新构建。</p>     <p>运行效果如下图所示。</p>     <p><strong>图8</strong> LazyForEach改变多个数据</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.74546318693273381696333355893267:50001231000000:2800:A978853B8301857666BB84B6C60C78313024BCBB92B7B59FF7E3BDFAF39F5FC4.gif" width="303" height="610"></span></p>     <p><strong>精准批量修改数据</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">operateData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dataArray.join(<span class="hljs-string">', '</span>)}</span>]`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">4</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-number">1</span>]);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">1</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-keyword">let</span> temp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-number">4</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-number">4</span>] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-number">6</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[<span class="hljs-number">6</span>] = temp;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">8</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'Hello 1'</span>, <span class="hljs-string">'Hello 2'</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">12</span>, <span class="hljs-number">2</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`[<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.dataArray.join(<span class="hljs-string">', '</span>)}</span>]`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDatasetChange</span>([</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">MOVE</span>, <span class="hljs-attr">index</span>: { <span class="hljs-attr">from</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">to</span>: <span class="hljs-number">3</span> } },</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">EXCHANGE</span>, <span class="hljs-attr">index</span>: { <span class="hljs-attr">start</span>: <span class="hljs-number">4</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">6</span> } },</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">ADD</span>, <span class="hljs-attr">index</span>: <span class="hljs-number">8</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> },</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">DELETE</span>, <span class="hljs-attr">index</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> }]);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">init</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-string">'Hello a'</span>, <span class="hljs-string">'Hello b'</span>, <span class="hljs-string">'Hello c'</span>, <span class="hljs-string">'Hello d'</span>, <span class="hljs-string">'Hello e'</span>, <span class="hljs-string">'Hello f'</span>, <span class="hljs-string">'Hello g'</span>, <span class="hljs-string">'Hello h'</span>,</li><li>      <span class="hljs-string">'Hello i'</span>, <span class="hljs-string">'Hello j'</span>, <span class="hljs-string">'Hello k'</span>, <span class="hljs-string">'Hello l'</span>, <span class="hljs-string">'Hello m'</span>, <span class="hljs-string">'Hello n'</span>, <span class="hljs-string">'Hello o'</span>, <span class="hljs-string">'Hello p'</span>, <span class="hljs-string">'Hello q'</span>, <span class="hljs-string">'Hello r'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">init</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'change data'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">5</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">operateData</span>();</li><li>        })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">35</span>)</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>                })</li><li>            }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>          }</li><li>
</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>())</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>onDatasetChange接口允许开发者一次性通知LazyForEach进行数据添加、删除、移动和交换等操作。在上述例子中，点击“change data”文本后，第二项数据被移动到第四项位置，第五项与第七项数据交换位置，并且从第九项开始添加了数据"Hello 1"和"Hello 2"，同时从第十一项开始删除了两项数据。</p>     <p><strong>图9</strong> LazyForEach改变多个数据</p>     <p><span><img originheight="741" originwidth="347" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114836.78928881209168310440425138671992:50001231000000:2800:062183C52AC0CA6962D286B9AB365F9A118E283E5022961BC2ED7E62B1622559.gif" width="347" height="741"></span></p>     <p>第二个例子，直接给数组赋值，不涉及 splice 操作。operations直接从比较原数组和新数组得到。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">operateData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> =</li><li>      [<span class="hljs-string">'Hello x'</span>, <span class="hljs-string">'Hello 1'</span>, <span class="hljs-string">'Hello 2'</span>, <span class="hljs-string">'Hello b'</span>, <span class="hljs-string">'Hello c'</span>, <span class="hljs-string">'Hello e'</span>, <span class="hljs-string">'Hello d'</span>, <span class="hljs-string">'Hello f'</span>, <span class="hljs-string">'Hello g'</span>, <span class="hljs-string">'Hello h'</span>];</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDatasetChange</span>([</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">CHANGE</span>, <span class="hljs-attr">index</span>: <span class="hljs-number">0</span> },</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">ADD</span>, <span class="hljs-attr">index</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">count</span>: <span class="hljs-number">2</span> },</li><li>      { <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">EXCHANGE</span>, <span class="hljs-attr">index</span>: { <span class="hljs-attr">start</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">end</span>: <span class="hljs-number">4</span> } },</li><li>    ]);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">init</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = [<span class="hljs-string">'Hello a'</span>, <span class="hljs-string">'Hello b'</span>, <span class="hljs-string">'Hello c'</span>, <span class="hljs-string">'Hello d'</span>, <span class="hljs-string">'Hello e'</span>, <span class="hljs-string">'Hello f'</span>, <span class="hljs-string">'Hello g'</span>, <span class="hljs-string">'Hello h'</span>];</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">init</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Multi-Data Change'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>        .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">5</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">operateData</span>();</li><li>        })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Row</span>() {</li><li>              <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">35</span>)</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>                })</li><li>            }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>          }</li><li>
</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item + <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>().<span class="hljs-title function_">getTime</span>())</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图10</strong> LazyForEach改变多个数据</p>     <p><span><img originheight="432" originwidth="355" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.30708475214235594617108036588984:50001231000000:2800:4EBECE8E73C65F13EE0B721F4B444EDB97C8F0AF8141D103B967DDC36DA8B321.gif" width="355" height="432"></span></p>     <p>使用该接口时请注意以下事项。</p>     <ol>      <li>       <p>不要将onDatasetChange与其他操作数据的接口混用。</p></li>      <li>       <p>传入onDatasetChange的operations中，每一项operation的index均从修改前的原数组中查找。因此，operations中的index不总是与Datasource中的index一一对应，并且不能为负数。</p>       <p>第一个例子清楚地显示了这一点:</p>       <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 修改之前的数组</span></li><li>[<span class="hljs-string">'Hello a'</span>,<span class="hljs-string">'Hello b'</span>,<span class="hljs-string">'Hello c'</span>,<span class="hljs-string">'Hello d'</span>,<span class="hljs-string">'Hello e'</span>,<span class="hljs-string">'Hello f'</span>,<span class="hljs-string">'Hello g'</span>,<span class="hljs-string">'Hello h'</span>,<span class="hljs-string">'Hello i'</span>,<span class="hljs-string">'Hello j'</span>,<span class="hljs-string">'Hello k'</span>,<span class="hljs-string">'Hello l'</span>,<span class="hljs-string">'Hello m'</span>,<span class="hljs-string">'Hello n'</span>,<span class="hljs-string">'Hello o'</span>,<span class="hljs-string">'Hello p'</span>,<span class="hljs-string">'Hello q'</span>,<span class="hljs-string">'Hello r'</span>]</li><li><span class="hljs-comment">// 修改之后的数组</span></li><li>[<span class="hljs-string">'Hello a'</span>,<span class="hljs-string">'Hello c'</span>,<span class="hljs-string">'Hello d'</span>,<span class="hljs-string">'Hello b'</span>,<span class="hljs-string">'Hello g'</span>,<span class="hljs-string">'Hello f'</span>,<span class="hljs-string">'Hello e'</span>,<span class="hljs-string">'Hello h'</span>,<span class="hljs-string">'Hello 1'</span>,<span class="hljs-string">'Hello 2'</span>,<span class="hljs-string">'Hello i'</span>,<span class="hljs-string">'Hello j'</span>,<span class="hljs-string">'Hello m'</span>,<span class="hljs-string">'Hello n'</span>,<span class="hljs-string">'Hello o'</span>,<span class="hljs-string">'Hello p'</span>,<span class="hljs-string">'Hello q'</span>,<span class="hljs-string">'Hello r'</span>]</li></ol></pre></div></div>       <p>"Hello b" 从第2项变成第4项，因此第一个 operation 为 { type: DataOperationType.MOVE, index: { from: 1, to: 3 } }。</p>       <p>"Hello e" 跟 "Hello g" 对调了，而 "Hello e" 在修改前的原数组中的 index=4，"Hello g" 在修改前的原数组中的 index=6, 因此第二个 operation 为 { type: DataOperationType.EXCHANGE, index: { start: 4, end: 6 } }。</p>       <p>"Hello 1","Hello 2" 在 "Hello h" 之后插入，而 "Hello h" 在修改前的原数组中的 index=7，因此第三个 operation 为 { type: DataOperationType.ADD, index: 8, count: 2 }。</p>       <p>"Hello k","Hello l" 被删除了，而 "Hello k" 在原数组中的 index=10，因此第四个 operation 为 { type: DataOperationType.DELETE, index: 10, count: 2 }。</p></li>      <li>       <p>在同一个onDatasetChange批量处理数据时，如果多个DataOperation操作同一个index，只有第一个DataOperation生效。</p></li>      <li>       <p>部分操作由开发者传入键值，LazyForEach不再重复调用keygenerator获取键值，开发者需保证传入键值的正确性。</p></li>      <li>       <p>若操作集合中包含RELOAD操作，则其他操作均不生效。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="高级用法">高级用法<i class="anchor-icon anchor-icon-link" anchorid="高级用法" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="改变数据子属性" class="firsth2">改变数据子属性<i class="anchor-icon anchor-icon-link" anchorid="改变数据子属性" tips="复制节点链接"></i></h3>          <p>若仅靠LazyForEach的刷新机制，当item变化时若想更新子组件，需要将原来的子组件全部销毁再重新构建，在子组件结构较为复杂的情况下，靠改变键值去刷新渲染性能较低。因此框架提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed装饰器和@ObjectLink装饰器</a>机制进行深度观测，可以做到仅刷新使用了该属性的组件，提高渲染性能。开发者可根据其自身业务特点选择使用哪种刷新方式。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          item.<span class="hljs-property">message</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>        })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>点击LazyForEach子组件改变item.message时，重渲染依赖ChildComponent的@ObjectLink成员变量对子属性的监听。框架仅刷新Text(this.data.message)，不会重建整个ListItem子组件。</p>     <p><strong>图11</strong> LazyForEach改变数据子属性</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.47015263074680210718894603093263:50001231000000:2800:3BEFB30BFFB48F0BA7562B0AD7B7B4AB9E102BE8929DD9974A9A1FC78330AF6C.gif" width="303" height="610"></span></p>    </div>    <div class="tiledSection">     <h3 id="使用状态管理v2">使用状态管理V2<i class="anchor-icon anchor-icon-link" anchorid="使用状态管理v2" tips="复制节点链接"></i></h3>          <p>状态管理V2提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2装饰器和@Trace装饰器</a>，用于实现属性的深度观测。使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local装饰器</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param装饰器</a>，可以管理子组件的刷新，仅刷新使用了对应属性的组件。</p>     <p><strong>嵌套类属性变化观测</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">firstLayer</span>: <span class="hljs-title class_">FirstLayer</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">firstLayer: FirstLayer</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">firstLayer</span> = firstLayer;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstLayer</span> {</li><li>  <span class="hljs-attr">secondLayer</span>: <span class="hljs-title class_">SecondLayer</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">secondLayer: SecondLayer</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">secondLayer</span> = secondLayer;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">SecondLayer</span> {</li><li>  <span class="hljs-attr">thirdLayer</span>: <span class="hljs-title class_">ThirdLayer</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">thirdLayer: ThirdLayer</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">thirdLayer</span> = thirdLayer;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ThirdLayer</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">fourthLayer</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">fourthLayer: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fourthLayer</span> = fourthLayer;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstLayer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">SecondLayer</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ThirdLayer</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>)))));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">firstLayer</span>.<span class="hljs-property">secondLayer</span>.<span class="hljs-property">thirdLayer</span>.<span class="hljs-property">fourthLayer</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              item.<span class="hljs-property">firstLayer</span>.<span class="hljs-property">secondLayer</span>.<span class="hljs-property">thirdLayer</span>.<span class="hljs-property">fourthLayer</span> += <span class="hljs-string">'!'</span>;</li><li>            })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@ObservedV2与@Trace用于装饰类以及类中的属性，配合使用能深度观测被装饰的类和属性。示例中，展示了深度嵌套类结构下，通过@ObservedV2和@Trace实现对多层嵌套属性变化的观测和子组件刷新。当点击子组件Text修改被@Trace修饰的嵌套类最内层的类成员属性时，仅重新渲染依赖了该属性的组件。</p>     <p><strong>组件内部状态</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>
</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-comment">// 修改@ObservedV2装饰类中@Trace装饰的变量，触发刷新此处Text组件</span></li><li>                item.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>              })</li><li>            <span class="hljs-title class_">ChildComponent</span>()</li><li>          }</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'?'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 修改@Local装饰的变量，触发刷新此处Text组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'?'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@Local使得自定义组件内被修饰的变量具有观测其变化的能力，该变量必须在组件内部进行初始化。示例中，点击Text组件修改item.message触发变量更新并刷新使用该变量的组件，ChildComponent中@Local装饰的变量message变化时也能刷新子组件。</p>     <p><strong>组件外部输入</strong></p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item.<span class="hljs-property">message</span> })</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              item.<span class="hljs-property">message</span> += <span class="hljs-string">'!'</span>;</li><li>            })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用@Param装饰器，子组件可以接受外部输入参数，实现父子组件间的数据同步。在MyComponent中创建子组件时，传递item.message，并用@Param修饰的变量data与其关联。点击ListItem中的组件修改item.message，数据变化会从父组件传递到子组件，触发子组件刷新。</p>    </div>    <div class="tiledSection">     <h3 id="拖拽排序">拖拽排序<i class="anchor-icon anchor-icon-link" anchorid="拖拽排序" tips="复制节点链接"></i></h3>          <p>当LazyForEach在List组件下使用，并且设置了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-drag-sorting#onmove" target="_blank">onMove</a>事件，可以使能拖拽排序。拖拽排序释放后，如果数据位置发生变化，将触发onMove事件，上报原始索引号和目标索引号。在onMove事件中，根据上报的索引号修改数据源。修改数据源时，无需调用DataChangeListener接口通知数据源变化。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">moveDataWithoutNotify</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> tmp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(to, <span class="hljs-number">0</span>, tmp[<span class="hljs-number">0</span>]);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(i.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-title function_">toString</span>())</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>              .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span> })</li><li>          }.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFFFF'</span>)</li><li>        }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>          .<span class="hljs-title function_">onMove</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">from</span>: <span class="hljs-built_in">number</span>, to: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">moveDataWithoutNotify</span>(<span class="hljs-keyword">from</span>, to);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFDCDCDC'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图12</strong> LazyForEach拖拽排序效果图</p>     <p><span><img originheight="652" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.49418565609850400316860946501862:50001231000000:2800:5CCD5213FC1A9D1B1B0D9378DCBDB4F7F6E61E07EA46DCA72BF7356110BF7CDC.gif" width="348" height="652"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="渲染结果非预期" class="firsth2">渲染结果非预期<i class="anchor-icon anchor-icon-link" anchorid="渲染结果非预期" tips="复制节点链接"></i></h3>          <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataDelete</span>(index);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 点击删除子组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">deleteData</span>(index);</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图13</strong> LazyForEach删除数据非预期</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.41413683373046713355445788545799:50001231000000:2800:978D83C8BF7404522662BC3BB88D32C96AE1B1DFFD0AC90F2269BBF4D9CB3983.gif" width="303" height="610"></span></p>     <p>多次点击子组件时，发现删除的不一定是点击的那个子组件。原因在于删除某个子组件后，该子组件之后的数据项的index应减1，但实际后续数据项对应的子组件仍使用最初分配的index，itemGenerator中的index未更新，导致删除结果与预期不符。</p>     <p>修复代码如下。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">deleteData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataDelete</span>(index);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">reloadData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 点击删除子组件</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">deleteData</span>(index);</li><li>          <span class="hljs-comment">// 重置所有子组件的index索引</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">reloadData</span>();</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item + index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在删除一个数据项后调用reloadData方法，重建后面的数据项，以达到更新index索引的目的。要保证reloadData方法重建数据项，必须保证数据项能生成新的key。这里用了item + index.toString()保证被删除数据项后面的数据项都被重建。如果用item + Date.now().toString()替代，那么所有数据项都生成新的key，导致所有数据项都被重建。这种方法，效果是一样的，只是性能略差。</p>     <p><strong>图14</strong> 修复LazyForEach删除数据非预期</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.09262895935795275171550558226281:50001231000000:2800:C6B4990732D17FCE5321CC2585F231606B8173707EE4939FC2EAF656358C8F3D.gif" width="303" height="610"></span></p>    </div>    <div class="tiledSection">     <h3 id="重渲染时图片闪烁">重渲染时图片闪烁<i class="anchor-icon anchor-icon-link" anchorid="重渲染时图片闪烁" tips="复制节点链接"></i></h3>          <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">reloadData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">imgSrc</span>: <span class="hljs-title class_">Resource</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, imgSrc: Resource</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSrc</span> = imgSrc;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-comment">// 此处'app.media.img'仅作示例，请开发者自行替换，否则imageSource创建失败会导致后续无法正常执行。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>, $r(<span class="hljs-string">'app.media.img'</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item.message}</span>`</span>);</li><li>              })</li><li>            <span class="hljs-title class_">Image</span>(item.<span class="hljs-property">imgSrc</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          item.<span class="hljs-property">message</span> += <span class="hljs-string">'00'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">reloadData</span>();</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-property">message</span>) <span class="hljs-comment">// 修改message属性会导致键值变化</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图15</strong> LazyForEach仅改变文字但是图片闪烁问题</p>     <p><span><img originheight="613" originwidth="309" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.85967229444525781167215265560044:50001231000000:2800:3D7370E2812E2389A61B5FE22A79ECADF2A5DE0EB8E1DACC31579B0B8D2F3BBB.gif" width="309" height="613"></span></p>     <p>单击ListItem子组件时，只改变了数据项的message属性，但因为键值发生变化，导致整个ListItem被重建。由于Image组件异步刷新，视觉上图片会闪烁。解决方法是保持键值不变，并使用@ObjectLink和@Observed单独刷新子组件Text。</p>     <p>修复代码如下。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// @Observed类装饰器 和 @ObjectLink 用于在涉及嵌套对象或数组的场景中进行双向数据同步</span></li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">imgSrc</span>: <span class="hljs-title class_">Resource</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span>, imgSrc: Resource</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgSrc</span> = imgSrc;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-comment">// 此处'app.media.img'仅作示例，请开发者自行替换，否则imageSource创建失败会导致后续无法正常执行。</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>, $r(<span class="hljs-string">'app.media.img'</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          item.<span class="hljs-property">message</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>()) <span class="hljs-comment">// 键值不受message属性影响</span></li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-comment">// 用状态变量来驱动UI刷新，而不是通过Lazyforeach的api来驱动UI刷新</span></li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">imgSrc</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">500</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图16</strong> 修复LazyForEach仅改变文字但是图片闪烁问题</p>     <p><span><img originheight="613" originwidth="309" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.45258157680156919658940443273494:50001231000000:2800:12516C7A934405AECC0542BCC39CA5A34FF0E195DFD9CB483D87434651D5969E.gif" width="309" height="613"></span></p>    </div>    <div class="tiledSection">     <h3 id="objectlink属性变化ui未更新">@ObjectLink属性变化UI未更新<i class="anchor-icon anchor-icon-link" anchorid="objectlink属性变化ui未更新" tips="复制节点链接"></i></h3>          <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-title class_">NestedString</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: NestedString</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NestedString</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedString</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          item.<span class="hljs-property">message</span>.<span class="hljs-property">message</span> += <span class="hljs-string">'0'</span>;</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-property">message</span>.<span class="hljs-property">message</span> + index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message.message}</span>`</span>);</li><li>        })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图17</strong> ObjectLink属性变化后UI未更新</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.91656181155925331715280541367855:50001231000000:2800:EAC689715345CCE4A0C9E775C49E280D4967D262A9F44128634E005AF3336246.gif" width="303" height="610"></span></p>     <p>@ObjectLink装饰的成员变量仅能监听到其子属性的变化，无法监听深层嵌套属性，因此，只能通过修改子属性来通知组件重新渲染。具体请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink装饰器与@Observed装饰器的详细使用方法和限制条件</a>。</p>     <p>修复代码如下。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-title class_">NestedString</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: NestedString</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NestedString</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedString</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// @ObjectLink装饰的成员变量仅能监听到其子属性的变化，再深入嵌套的属性便无法观测到</span></li><li>          item.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NestedString</span>(item.<span class="hljs-property">message</span>.<span class="hljs-property">message</span> + <span class="hljs-string">'0'</span>);</li><li>        })</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item.<span class="hljs-property">message</span>.<span class="hljs-property">message</span> + index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@ObjectLink</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message.message}</span>`</span>);</li><li>        })</li><li>    }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图18</strong> 修复ObjectLink属性变化后UI更新</p>     <p><span><img originheight="610" originwidth="303" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.81305647713094298826787865454002:50001231000000:2800:32606D29836CFA95583ED0787FD8B0F805E727EA143C3990A883E15C3E6191FB.gif" width="303" height="610"></span></p>    </div>    <div class="tiledSection">     <h3 id="在list内使用屏幕闪烁">在List内使用屏幕闪烁<i class="anchor-icon anchor-icon-link" anchorid="在list内使用屏幕闪烁" tips="复制节点链接"></i></h3>          <p>在List的onScrollIndex方法中调用onDataReloaded可能会导致屏幕闪烁。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">operateData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> totalCount = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">const</span> batch = <span class="hljs-number">5</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = totalCount; i &lt; totalCount + batch; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">10</span>)</li><li>    .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start, end, center</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (end === <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">totalCount</span>() - <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'scroll to end'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">operateData</span>();</li><li>      }</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图19</strong> 当List下拉到底时，屏幕闪烁</p>     <p><span><img originheight="541" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.21397669782051181771834372899897:50001231000000:2800:D3C634351B5E06EE29F78EC0262DC02E56E90F172485D7CCC21D94DE5450984E.gif" width="320" height="541"></span></p>     <p>使用onDatasetChange代替onDataReloaded，不仅可以修复闪屏问题，还能提升加载性能。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">operateData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> totalCount = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>    <span class="hljs-keyword">const</span> batch = <span class="hljs-number">5</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = totalCount; i &lt; totalCount + batch; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 替换 notifyDataReload</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDatasetChange</span>([{ <span class="hljs-attr">type</span>: <span class="hljs-title class_">DataOperationType</span>.<span class="hljs-property">ADD</span>, <span class="hljs-attr">index</span>: totalCount - <span class="hljs-number">1</span>, <span class="hljs-attr">count</span>: batch }]);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">moved</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>              .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`appear: <span class="hljs-subst">${item}</span>`</span>);</li><li>              })</li><li>          }.<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">10</span> })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">10</span>)</li><li>    .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start, end, center</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (end === <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">totalCount</span>() - <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'scroll to end'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">operateData</span>();</li><li>      }</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图20</strong> 修复后，当List下拉到底时，屏幕不闪烁</p>     <p><span><img originheight="541" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.77176386141689785520785617100188:50001231000000:2800:82786247D41AB1200A7128F7B47716C792B9309C76A3395EC12824D915A0109B.gif" width="320" height="541"></span></p>    </div>    <div class="tiledSection">     <h3 id="组件复用渲染异常">组件复用渲染异常<i class="anchor-icon anchor-icon-link" anchorid="组件复用渲染异常" tips="复制节点链接"></i></h3>          <p>@Reusable装饰器与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2装饰器</a>混用会导致组件渲染异常。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: StringData类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">StringData</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">`Hello<span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">data</span>: item })</li><li>            .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onAppear: <span class="hljs-subst">${item.message}</span>`</span>);</li><li>            })</li><li>        }</li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: StringData, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> index.<span class="hljs-title function_">toString</span>())</li><li>    }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">StringData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringData</span>(<span class="hljs-string">''</span>);</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToAppear: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToRecycle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToRecycle: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 对复用的组件进行数据更新</span></li><li>  <span class="hljs-title function_">aboutToReuse</span>(<span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-title class_">ESObject</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span> = params.<span class="hljs-property">data</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">StringData</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`aboutToReuse: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.data.message}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>反例中，在@ComponentV2装饰的组件MyComponent中，LazyForEach列表使用了@Reusable装饰的组件ChildComponent，导致组件渲染失败。从日志中可以看到，组件触发了onAppear，但没有触发aboutToAppear。</p>     <p>将@ComponentV2修改为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component">@Component</a>可以修复渲染异常。修复后，当滑动事件触发组件节点下树时，对应的可复用组件ChildComponent会被加入复用缓存，而非被销毁，并触发aboutToRecycle事件，打印日志信息。当列表滑动，出现新节点时，会将可复用的组件从复用缓存中重新加入到节点树，触发aboutToReuse刷新组件数据，并打印日志信息。</p>    </div>    <div class="tiledSection">     <h3 id="组件不刷新">组件不刷新<i class="anchor-icon anchor-icon-link" anchorid="组件不刷新" tips="复制节点链接"></i></h3>          <p>开发者需要定义合适的键值生成函数，返回与目标数据相关联的键值。目标数据发生改变时，LazyForEach识别到键值改变才会刷新对应组件。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">updateAllData</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">map</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item + <span class="hljs-string">`!`</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataReload</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`update all`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">updateAllData</span>();</li><li>        })</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>        <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">ListItem</span>() {</li><li>            <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          }</li><li>        })</li><li>      }.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">5</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>图21</strong> 点击按钮更新数据，组件不会刷新</p>     <p><span><img originheight="446" originwidth="268" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.87739756288730016009204414570397:50001231000000:2800:07C84A0E3E92E31CE3E1D444B1787045E65E6C1B557A9E975648A79F88C9E5D7.gif" class="notEnlarge" width="268" height="446"></span></p>     <p>LazyForEach依赖生成的键值判断是否刷新子组件，如果更新的数据没有改变键值（如示例中开发者没有定义键值生成函数，此时键值仅与组件索引index有关，更新数据时键值不变），则LazyForEach不会刷新对应组件。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-title class_">ListItem</span>() {</li><li>    <span class="hljs-title class_">Text</span>(item).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>  }</li><li>}, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item) <span class="hljs-comment">// 定义键值生成函数</span></li></ol></pre></div></div>     <p><strong>图22</strong> 定义键值生成函数后，点击按钮更新数据，组件刷新</p>     <p><span><img originheight="446" originwidth="268" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114837.34653954644019632222087779848428:50001231000000:2800:196397E7929395161F0791F44EA5E0F55A73B85CAA8BC068523CE5BC35796179.gif" class="notEnlarge" width="268" height="446"></span></p>    </div>    <div class="tiledSection">     <h3 id="懒加载失效">懒加载失效<i class="anchor-icon anchor-icon-link" anchorid="懒加载失效" tips="复制节点链接"></i></h3>          <p>支持数据懒加载的父组件基于自身和子组件的高度或宽度计算可视范围内应布局的子节点数量，高度或宽度的缺失会导致部分场景懒加载失效。如下示例，在纵向布局中，首次渲染时子组件的高度缺失，所有数据项对应组件都会被创建。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">/** BasicDataSource代码见文档末尾BasicDataSource示例代码: string类型数组的BasicDataSource代码 **/</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyDataSource</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">BasicDataSource</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">dataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">pushData</span>(<span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-title function_">push</span>(data);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArray</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">MyDataSource</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyDataSource</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt;= <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>.<span class="hljs-title function_">pushData</span>(<span class="hljs-string">``</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">List</span>() {</li><li>      <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>        <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">message</span>: item, <span class="hljs-attr">index</span>: index })</li><li>        <span class="hljs-comment">// 子组件未设置默认高度，首次渲染时所有数据项对应组件都被创建</span></li><li>        <span class="hljs-comment">// .height(60)</span></li><li>      }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item + index)</li><li>    }</li><li>    .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">``</span>;</li><li>  <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`about to appear <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.index}</span>`</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>上述示例由于子组件ChildComponent的变量message初始值为空字符串，导致其内部的Text组件高度为 0，同时子组件未显式设置默认高度（如.height(60)），因此在首次渲染时所有子组件的高度均被计算为0。父组件List在基于高度计算可视范围时，判断所有子组件均位于可视区域内，导致懒加载机制失效，最终触发了全部数据项对应组件的创建（可通过日志观察到所有about to appear打印）。</p>     <p>为子组件设置默认高度，确保父组件能正确计算可视范围，从而恢复此场景下懒加载功能。</p>     <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">List</span>() {</li><li>  <span class="hljs-title class_">LazyForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">data</span>, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-title class_">ChildComponent</span>({ <span class="hljs-attr">message</span>: item, <span class="hljs-attr">index</span>: index })</li><li>      <span class="hljs-comment">// 设置子组件默认高度，首次渲染懒加载生效</span></li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>  }, <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item + index)</li><li>}</li><li>.<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="basicdatasource示例代码">BasicDataSource示例代码<i class="anchor-icon anchor-icon-link" anchorid="basicdatasource示例代码" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="string类型数组的basicdatasource代码" class="firsth2">string类型数组的BasicDataSource代码<i class="anchor-icon anchor-icon-link" anchorid="string类型数组的basicdatasource代码" tips="复制节点链接"></i></h3>          <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// BasicDataSource实现了IDataSource接口，用于管理listener监听，以及通知LazyForEach数据更新</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为LazyForEach组件向其数据源处添加listener监听</span></li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 该方法为框架侧调用，为对应的LazyForEach组件在数据源处去除listener监听</span></li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要重载所有子组件</span></li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处添加子组件</span></li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.ADD, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件在index对应索引处数据有变化，需要重建该子组件</span></li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.CHANGE, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件需要在index对应索引处删除该子组件</span></li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange([{type: DataOperationType.DELETE, index: index}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 通知LazyForEach组件将from索引和to索引处的子组件进行交换</span></li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>      <span class="hljs-comment">// 写法2：listener.onDatasetChange(</span></li><li>      <span class="hljs-comment">//         [{type: DataOperationType.EXCHANGE, index: {start: from, end: to}}]);</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="stringdata类型数组的basicdatasource代码">StringData类型数组的BasicDataSource代码<i class="anchor-icon anchor-icon-link" anchorid="stringdata类型数组的basicdatasource代码" tips="复制节点链接"></i></h3>          <div _ngcontent-ouv-c106="" class="highlight-div"><div _ngcontent-ouv-c106="" class="highlight-div-header"><div _ngcontent-ouv-c106="" class="highlight-div-header-left"><div _ngcontent-ouv-c106="" class="handle-button expand-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ouv-c106="" class="highlight-div-header-right"><div _ngcontent-ouv-c106="" class="handle-button ai-button"></div><div _ngcontent-ouv-c106="" class="handle-button line-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ouv-c106="" class="handle-button theme-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ouv-c106="" class="handle-button copy-button"><div _ngcontent-ouv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ouv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">BasicDataSource</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IDataSource</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">listeners</span>: <span class="hljs-title class_">DataChangeListener</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">originDataArray</span>: <span class="hljs-title class_">StringData</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">totalCount</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>.<span class="hljs-property">length</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-title function_">getData</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-title class_">StringData</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">originDataArray</span>[index];</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">registerDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener) &lt; <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'add listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">push</span>(listener);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">unregisterDataChangeListener</span>(<span class="hljs-attr">listener</span>: <span class="hljs-title class_">DataChangeListener</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> pos = <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">indexOf</span>(listener);</li><li>    <span class="hljs-keyword">if</span> (pos &gt;= <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'remove listener'</span>);</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">splice</span>(pos, <span class="hljs-number">1</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataReload</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataReloaded</span>();</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataAdd</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataAdd</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataChange</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataChange</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataDelete</span>(<span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataDelete</span>(index);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDataMove</span>(<span class="hljs-attr">from</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">to</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDataMove</span>(<span class="hljs-keyword">from</span>, to);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">notifyDatasetChange</span>(<span class="hljs-attr">operations</span>: <span class="hljs-title class_">DataOperation</span>[]): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">listeners</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function"><span class="hljs-params">listener</span> =&gt;</span> {</li><li>      listener.<span class="hljs-title function_">onDatasetChange</span>(operations);</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>