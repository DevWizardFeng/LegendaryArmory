<h1 _ngcontent-myk-c119="" class="doc-title ng-star-inserted" title="LocalStorage：页面级UI状态存储"> LocalStorage：页面级UI状态存储 </h1>

<div _ngcontent-myk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>LocalStorage是页面级的UI状态存储，通过@Entry装饰器接收的参数可以在页面内共享同一个LocalStorage实例。LocalStorage支持UIAbility实例内多个页面间状态共享。</p>    <p>本文仅介绍LocalStorage使用场景和相关的装饰器：@LocalStorageProp和@LocalStorageLink。</p>    <p>在阅读本文档前，需要开发者对状态管理框架有基本的了解。建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state-management-overview">状态管理概述</a>。</p>    <p>LocalStorage还提供了API接口，可以让开发者通过接口在自定义组件外手动触发Storage对应key的增删改查，建议配合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-state-management#localstorage9" target="_blank">LocalStorage API文档</a>阅读。最佳实践请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-status-management" target="_blank">状态管理最佳实践</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>LocalStorage从API version 9开始支持。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>LocalStorage是ArkTS为构建页面级别状态变量提供存储的内存内的“数据库”。</p>     <ul>      <li>       <p>应用程序可以创建多个LocalStorage实例，LocalStorage实例可以在页面内共享，也可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getsharedlocalstorage12" target="_blank">getSharedLocalStorage</a>接口，实现跨页面、跨<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-overview">UIAbility</a>实例共享。</p></li>      <li>       <p>组件树的根节点，即被<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-entry#entry" target="_blank">@Entry</a>装饰的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component">@Component</a>，可以被分配一个LocalStorage实例，此组件的所有子组件实例将自动获得对该LocalStorage实例的访问权限。</p></li>      <li>       <p>@Component装饰的组件既可以自动继承来自父组件的LocalStorage实例，也可以传入指定的LocalStorage的实例，详见：<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#自定义组件接收localstorage实例">自定义组件接收LocalStorage实例</a>。</p></li>      <li>       <p>LocalStorage中的所有属性都是可变的。</p></li>     </ul>     <p>应用程序决定LocalStorage对象的生命周期。当应用释放最后一个指向LocalStorage的引用时，比如销毁最后一个自定义组件，LocalStorage将被JS Engine垃圾回收。</p>     <p>LocalStorage根据与@Component装饰的组件的同步类型不同，提供了两个装饰器：</p>     <ul>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorageprop">@LocalStorageProp</a>：@LocalStorageProp装饰的变量与LocalStorage中给定属性建立单向同步关系。</p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstoragelink">@LocalStorageLink</a>：@LocalStorageLink装饰的变量与LocalStorage中给定属性建立双向同步关系。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="localstorageprop">@LocalStorageProp<i class="anchor-icon anchor-icon-link" anchorid="localstorageprop" tips="复制节点链接"></i></h2>          <p>在上文中已经提到，如果要建立LocalStorage和自定义组件的联系，需要使用@LocalStorageProp和@LocalStorageLink装饰器。使用@LocalStorageProp(key)/@LocalStorageLink(key)装饰组件内的变量，key标识了LocalStorage的属性。</p>     <p>当自定义组件初始化的时候，@LocalStorageProp(key)/@LocalStorageLink(key)装饰的变量会通过给定的key，绑定LocalStorage对应的属性，完成初始化。本地初始化是必要的，因为无法保证LocalStorage一定存在给定的key（这取决于应用逻辑是否在组件初始化之前在LocalStorage实例中存入对应的属性）。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 9开始，该装饰器支持在ArkTS卡片中使用。</p>       <p>从API version 11开始，该装饰器支持在元服务中使用。</p>      </div></div></div>     <p>@LocalStorageProp(key)和LocalStorage中key对应的属性建立单向数据同步，ArkUI框架支持修改@LocalStorageProp(key)在本地的值，但是对本地值的修改不会同步回LocalStorage中。相反，如果LocalStorage中key对应的属性值发生改变，例如通过set接口对LocalStorage中的值进行修改，改变会同步给@LocalStorageProp(key)，并覆盖掉本地的值。</p>    </div>    <div class="tiledSection">     <h3 id="装饰器使用规则" class="firsth2">装饰器使用规则<i class="anchor-icon anchor-icon-link" anchorid="装饰器使用规则" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.3.1.1" valign="top" width="50%">@LocalStorageProp变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">key：常量字符串，必填（字符串需要有引号）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>Object、class、string、number、boolean、enum类型，以及这些类型的数组。</p>          <p>API version 12及以上支持Map、Set、Date、undefined和null类型以及这些类型的联合类型，示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorage支持联合类型">LocalStorage支持联合类型</a>。</p>          <p>嵌套类型的场景请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#观察变化和行为表现">观察变化和行为表现</a>。</p>          <p><strong>说明：</strong></p>          <p>变量类型必须被指定，建议和LocalStorage中对应属性类型相同，否则会发生类型隐式转换，从而导致应用行为异常。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">同步类型</td>         <td class="cellrowborder" valign="top" width="50%">单向同步：从LocalStorage的对应属性到组件的状态变量。组件本地的修改是允许的，但是LocalStorage中给定的属性一旦发生变化，将覆盖本地的修改。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">被装饰变量的初始值</td>         <td class="cellrowborder" valign="top" width="50%">必须指定，如果LocalStorage实例中不存在属性，则用该初始值初始化该属性，并存入LocalStorage中。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="变量的传递访问规则">变量的传递/访问规则<i class="anchor-icon anchor-icon-link" anchorid="变量的传递访问规则" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.3.1.1" valign="top" width="50%">传递/访问规则</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">从父节点初始化和更新</td>         <td class="cellrowborder" valign="top" width="50%">禁止，@LocalStorageProp不支持从父节点初始化，只能从LocalStorage中key对应的属性初始化，如果没有对应的key，将使用本地默认值初始化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">初始化子节点</td>         <td class="cellrowborder" valign="top" width="50%">支持，可用于初始化@State、@Link、@Prop、@Provide。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">是否支持组件外访问</td>         <td class="cellrowborder" valign="top" width="50%">否。</td>        </tr>             </tbody></table></div>     </div>     <p><span><img originheight="370" originwidth="824" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114956.65182917181288119100330851751193:50001231000000:2800:BA2C4420A99500CDE35DB8A379AFF3D1835BE8D4E9BF5AB5515030DD16C6246A.png" width="824" height="370"></span></p>     <p><strong>图1</strong> @LocalStorageProp初始化规则图示</p>    </div>    <div class="tiledSection">     <h3 id="观察变化和行为表现">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现" tips="复制节点链接"></i></h3>          <p><strong>观察变化</strong></p>     <ul>      <li>       <p>当装饰的数据类型为boolean、string、number类型时，可以观察到数值的变化。</p></li>      <li>       <p>当装饰的数据类型为class或者Object时，可以观察到对象整体赋值和对象属性变化（详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#从ui内部使用localstorage">从ui内部使用localstorage</a>）。</p></li>      <li>       <p>当装饰的对象是数组时，可以观察到数组添加、删除、更新数组单元的变化。</p></li>      <li>       <p>当装饰的对象是Date时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds 更新Date的属性。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰date类型变量">装饰Date类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Map时，可以观察到Map整体的赋值，同时可通过调用Map的接口set, clear, delete 更新Map的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰map类型变量">装饰Map类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Set时，可以观察到Set整体的赋值，同时可通过调用Set的接口add, clear, delete 更新Set的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰set类型变量">装饰Set类型变量</a>。</p></li>     </ul>     <p><strong>框架行为</strong></p>     <ol>      <li>       <p>使用@LocalStorageProp(key)装饰的变量更新时，不会写回LocalStorage，但会触发当前自定义组件的重新渲染。</p></li>      <li>       <p>当LocalStorage中对应key的值发生变化时，所有使用@LocalStorageProp(key)装饰的变量都会同步更新，覆盖本地修改。</p></li>     </ol>     <p><strong>LocalStorage与@LocalStorageProp数据同步如下图所示</strong></p>     <p><span><img originheight="346" originwidth="598" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114956.19936259703995573033570856443031:50001231000000:2800:28C9D453C2FCDC955AD2574B999E774A03BB45BBB0D55721826A5B8F9A80CFFA.png" width="598" height="346"></span></p>     <p><strong>图2</strong> LocalStorage与@LocalStorageProp数据同步图示</p>    </div>    <div class="tiledSection">     <h2 id="localstoragelink">@LocalStorageLink<i class="anchor-icon anchor-icon-link" anchorid="localstoragelink" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 11开始，该装饰器支持在元服务中使用。</p>      </div></div></div>     <p>如果我们需要将自定义组件的状态变量的更新同步回LocalStorage，就需要用到@LocalStorageLink。</p>     <p>@LocalStorageLink(key)是和LocalStorage中key对应的属性建立双向数据同步：</p>     <ol>      <li>       <p>本地修改发生，该修改会被写回LocalStorage中。</p></li>      <li>       <p>LocalStorage中的修改发生后，该修改会被同步到所有绑定LocalStorage对应key的属性上，包括单向（@LocalStorageProp和通过prop创建的单向绑定变量）、双向（@LocalStorageLink和通过link创建的双向绑定变量）变量。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="装饰器使用规则-1" class="firsth2">装饰器使用规则<i class="anchor-icon anchor-icon-link" anchorid="装饰器使用规则-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.12.2.1.3.1.1" valign="top" width="50%">@LocalStorageLink变量装饰器</th>         <th align="left" class="cellrowborder" id="mcps1.3.12.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">装饰器参数</td>         <td class="cellrowborder" valign="top" width="50%">key：常量字符串，必填（字符串需要有引号）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">允许装饰的变量类型</td>         <td class="cellrowborder" valign="top" width="50%">          <p>Object、class、string、number、boolean、enum类型，以及这些类型的数组。</p>          <p>API version 12及以上支持Map、Set、Date、undefined和null类型以及这些类型的联合类型。示例见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#localstorage支持联合类型">LocalStorage支持联合类型</a>。</p>          <p>嵌套类型的场景请参考<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#观察变化和行为表现-1">观察变化和行为表现</a>。</p>          <p><strong>说明：</strong></p>          <p>变量类型必须被指定，建议和LocalStorage中对应属性类型相同，否则会发生类型隐式转换，从而导致应用行为异常。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">同步类型</td>         <td class="cellrowborder" valign="top" width="50%">双向同步：从LocalStorage的对应属性到自定义组件，从自定义组件到LocalStorage对应属性。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">被装饰变量的初始值</td>         <td class="cellrowborder" valign="top" width="50%">必须指定，如果LocalStorage实例中不存在属性，则用该初始值初始化该属性，并存入LocalStorage中。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="变量的传递访问规则-1">变量的传递/访问规则<i class="anchor-icon anchor-icon-link" anchorid="变量的传递访问规则-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.13.2.1.3.1.1" valign="top" width="50%">传递/访问规则</th>         <th align="left" class="cellrowborder" id="mcps1.3.13.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">从父节点初始化和更新</td>         <td class="cellrowborder" valign="top" width="50%">禁止，@LocalStorageLink不支持从父节点初始化，只能从LocalStorage中key对应的属性初始化，如果没有对应的key，将使用本地默认值初始化。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">初始化子节点</td>         <td class="cellrowborder" valign="top" width="50%">支持，可用于初始化@State、@Link、@Prop、@Provide。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">是否支持组件外访问</td>         <td class="cellrowborder" valign="top" width="50%">否。</td>        </tr>             </tbody></table></div>     </div>     <p><span><img originheight="370" originwidth="824" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114956.41560349594594907029934413492420:50001231000000:2800:7D0922942551EE7745D6177FD043EA1CD98E08297FC0398C7B4BB75937B1403C.png" width="824" height="370"></span></p>     <p><strong>图3</strong> @LocalStorageLink初始化规则图示</p>    </div>    <div class="tiledSection">     <h3 id="观察变化和行为表现-1">观察变化和行为表现<i class="anchor-icon anchor-icon-link" anchorid="观察变化和行为表现-1" tips="复制节点链接"></i></h3>          <p><strong>观察变化</strong></p>     <ul>      <li>       <p>当装饰的数据类型为boolean、string、number类型时，可以观察到数值的变化。</p></li>      <li>       <p>当装饰的数据类型为class或者Object时，可以观察到对象整体赋值和对象属性变化（详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#从ui内部使用localstorage">从ui内部使用localstorage</a>）。</p></li>      <li>       <p>当装饰的对象是数组时，可以观察到数组添加、删除、更新数组单元的变化。</p></li>      <li>       <p>当装饰的对象是Date时，可以观察到Date整体的赋值，同时可通过调用Date的接口setFullYear, setMonth, setDate, setHours, setMinutes, setSeconds, setMilliseconds, setTime, setUTCFullYear, setUTCMonth, setUTCDate, setUTCHours, setUTCMinutes, setUTCSeconds, setUTCMilliseconds 更新Date的属性。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰date类型变量">装饰Date类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Map时，可以观察到Map整体的赋值，同时可通过调用Map的接口set, clear, delete 更新Map的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰map类型变量">装饰Map类型变量</a>。</p></li>      <li>       <p>当装饰的变量是Set时，可以观察到Set整体的赋值，同时可通过调用Set的接口add, clear, delete 更新Set的值。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#装饰set类型变量">装饰Set类型变量</a>。</p></li>     </ul>     <p><strong>框架行为</strong></p>     <ol>      <li>       <p>使用@LocalStorageLink(key)装饰的变量更新时，会同步写回LocalStorage对应的key，还会触发当前自定义组件的重新渲染。</p></li>      <li>       <p>当LocalStorage中对应key的值发生变化时，所有绑定该key的数据（包括双向@LocalStorageLink和单向@LocalStorageProp）都会同步更新。</p></li>     </ol>     <p><strong>LocalStorage与@LocalStorageLink数据同步如下图所示</strong></p>     <p><span><img originheight="345" originwidth="589" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114956.16845084038757245341946299863415:50001231000000:2800:6FA133EE48CE448264489C492171A4373B539CA91AD1548494436C65C46ADC76.png" width="589" height="345"></span></p>     <p><strong>图4</strong> LocalStorage与@LocalStorageLink数据同步图示</p>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>@LocalStorageProp/@LocalStorageLink的参数必须为string类型，否则编译期会报错。</p>       <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-number">48</span>);</li><li>
</li><li><span class="hljs-comment">// 错误写法，编译报错</span></li><li><span class="hljs-meta">@LocalStorageProp</span>() <span class="hljs-attr">localStorageProp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-meta">@LocalStorageLink</span>() <span class="hljs-attr">localStorageLink</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li>
</li><li><span class="hljs-comment">// 正确写法</span></li><li><span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">localStorageProp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li><span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">localStorageLink</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li></ol></pre></div></div></li>      <li>       <p>@LocalStorageProp与@LocalStorageLink不支持装饰Function类型的变量，框架会抛出运行时错误。</p></li>      <li>       <p>LocalStorage创建后，命名属性的类型不可更改。后续调用Set时必须使用相同类型的值。</p></li>      <li>       <p>LocalStorage是页面级存储，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext#getsharedlocalstorage12" target="_blank">getSharedLocalStorage</a>接口仅能获取当前Stage通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#loadcontent9" target="_blank">windowStage.loadContent</a>传入的LocalStorage实例，否则返回undefined。例子可见<a href="/consumer/cn/doc/harmonyos-guides/arkts-localstorage#将localstorage实例从uiability共享到一个或多个页面">将LocalStorage实例从UIAbility共享到一个或多个页面</a>。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="应用逻辑使用localstorage" class="firsth2">应用逻辑使用LocalStorage<i class="anchor-icon anchor-icon-link" anchorid="应用逻辑使用localstorage" tips="复制节点链接"></i></h3>          <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>,<span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'PropA'</span>: <span class="hljs-number">47</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(para); <span class="hljs-comment">// 创建新实例并使用给定对象初始化</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">propA</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> = storage.<span class="hljs-title function_">get</span>(<span class="hljs-string">'PropA'</span>); <span class="hljs-comment">// propA == 47</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">link1</span>: <span class="hljs-title class_">SubscribedAbstractProperty</span>&lt;<span class="hljs-built_in">number</span>&gt; = storage.<span class="hljs-title function_">link</span>(<span class="hljs-string">'PropA'</span>); <span class="hljs-comment">// link1.get() == 47</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">link2</span>: <span class="hljs-title class_">SubscribedAbstractProperty</span>&lt;<span class="hljs-built_in">number</span>&gt; = storage.<span class="hljs-title function_">link</span>(<span class="hljs-string">'PropA'</span>); <span class="hljs-comment">// link2.get() == 47</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">prop</span>: <span class="hljs-title class_">SubscribedAbstractProperty</span>&lt;<span class="hljs-built_in">number</span>&gt; = storage.<span class="hljs-title function_">prop</span>(<span class="hljs-string">'PropA'</span>); <span class="hljs-comment">// prop.get() == 47</span></li><li>link1.<span class="hljs-title function_">set</span>(<span class="hljs-number">48</span>); <span class="hljs-comment">// 双向同步: link1.get() == link2.get() == prop.get() == 48</span></li><li>prop.<span class="hljs-title function_">set</span>(<span class="hljs-number">1</span>); <span class="hljs-comment">// 单向同步: prop.get() == 1; 但 link1.get() == link2.get() == 48</span></li><li>link1.<span class="hljs-title function_">set</span>(<span class="hljs-number">49</span>); <span class="hljs-comment">// 双向同步: link1.get() == link2.get() == prop.get() == 49</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="从ui内部使用localstorage">从UI内部使用LocalStorage<i class="anchor-icon anchor-icon-link" anchorid="从ui内部使用localstorage" tips="复制节点链接"></i></h3>          <p>除了应用程序逻辑使用LocalStorage，还可以借助LocalStorage相关的两个装饰器@LocalStorageProp和@LocalStorageLink，在UI组件内部获取到LocalStorage实例中存储的状态变量。</p>     <p>本示例以@LocalStorageLink为例，展示了：</p>     <ul>      <li>       <p>使用构造函数创建LocalStorage实例storage。</p></li>      <li>       <p>使用@Entry装饰器将storage添加到Parent顶层组件中。</p></li>      <li>       <p>@LocalStorageLink绑定LocalStorage对给定的属性，建立双向数据同步。</p></li>     </ul>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {</li><li> <span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li> <span class="hljs-title function_">constructor</span>(<span class="hljs-params">code: <span class="hljs-built_in">number</span></span>) {</li><li>   <span class="hljs-variable language_">this</span>.<span class="hljs-property">code</span> = code;</li><li> }</li><li>}</li><li><span class="hljs-comment">// 创建新实例并使用给定对象初始化</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'PropA'</span>: <span class="hljs-number">47</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(para);</li><li>storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>(<span class="hljs-number">50</span>));</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li> <span class="hljs-comment">// @LocalStorageLink变量装饰器与LocalStorage中的'PropA'属性建立双向绑定</span></li><li> <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">childLinkNumber</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li> <span class="hljs-comment">// @LocalStorageLink变量装饰器与LocalStorage中的'PropB'属性建立双向绑定</span></li><li> <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-attr">childLinkObject</span>: <span class="hljs-title class_">Data</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>(<span class="hljs-number">0</span>);</li><li>
</li><li> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>   <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>     <span class="hljs-comment">// 更改将同步至LocalStorage中的'PropA'以及Parent.parentLinkNumber</span></li><li>     <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Child from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childLinkNumber}</span>`</span>)</li><li>       .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">childLinkNumber</span> += <span class="hljs-number">1</span>;</li><li>       })</li><li>     <span class="hljs-comment">// 更改将同步至LocalStorage中的'PropB'以及Parent.parentLinkObject.code</span></li><li>     <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Child from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.childLinkObject.code}</span>`</span>)</li><li>       .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">childLinkObject</span>.<span class="hljs-property">code</span> += <span class="hljs-number">1</span>;</li><li>       })</li><li>   }</li><li> }</li><li>}</li><li><span class="hljs-comment">// 使LocalStorage可从@Component组件访问</span></li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li> <span class="hljs-comment">// @LocalStorageLink变量装饰器与LocalStorage中的'PropA'属性建立双向绑定</span></li><li> <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">parentLinkNumber</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li> <span class="hljs-comment">// @LocalStorageLink变量装饰器与LocalStorage中的'PropB'属性建立双向绑定</span></li><li> <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-attr">parentLinkObject</span>: <span class="hljs-title class_">Data</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Data</span>(<span class="hljs-number">0</span>);</li><li>
</li><li> <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>   <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>     <span class="hljs-comment">// 由于LocalStorage中PropA已经被初始化，因此this.parentLinkNumber的值为47</span></li><li>     <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Parent from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.parentLinkNumber}</span>`</span>)</li><li>       .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentLinkNumber</span> += <span class="hljs-number">1</span>;</li><li>       })</li><li>     <span class="hljs-comment">// 由于LocalStorage中PropB已经被初始化，因此this.parentLinkObject.code的值为50</span></li><li>     <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Parent from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.parentLinkObject.code}</span>`</span>)</li><li>       .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>         <span class="hljs-variable language_">this</span>.<span class="hljs-property">parentLinkObject</span>.<span class="hljs-property">code</span> += <span class="hljs-number">1</span>;</li><li>       })</li><li>     <span class="hljs-comment">// @Component子组件自动获得对Parent LocalStorage实例的访问权限。</span></li><li>     <span class="hljs-title class_">Child</span>()</li><li>   }</li><li> }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="localstorageprop和localstorage单向同步的简单场景">@LocalStorageProp和LocalStorage单向同步的简单场景<i class="anchor-icon anchor-icon-link" anchorid="localstorageprop和localstorage单向同步的简单场景" tips="复制节点链接"></i></h3>          <p>本示例展示了Parent和Child组件各自在本地创建与storage中'PropA'属性的单向数据同步：</p>     <ul>      <li>       <p>Parent中对this.storageProp1的修改，只会在Parent中生效，并没有同步回storage。</p></li>      <li>       <p>Child组件中，Text绑定的storageProp2 依旧显示47。</p></li>     </ul>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建新实例并使用给定对象初始化</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'PropA'</span>: <span class="hljs-number">47</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(para);</li><li><span class="hljs-comment">// 使LocalStorage可从@Component组件访问</span></li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-comment">// @LocalStorageProp变量装饰器与LocalStorage中的'PropA'属性建立单向绑定</span></li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">storageProp1</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>      <span class="hljs-comment">// 点击后从47开始加1，只改变当前组件显示的storageProp1，不会同步到LocalStorage中</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Parent from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageProp1}</span>`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageProp1</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Child</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// @LocalStorageProp变量装饰器与LocalStorage中的'PropA'属性建立单向绑定</span></li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">storageProp2</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">15</span> }) {</li><li>      <span class="hljs-comment">// 当Parent改变时，当前storageProp2不会改变，显示47</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Parent from LocalStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageProp2}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="localstoragelink和localstorage双向同步的简单场景">@LocalStorageLink和LocalStorage双向同步的简单场景<i class="anchor-icon anchor-icon-link" anchorid="localstoragelink和localstorage双向同步的简单场景" tips="复制节点链接"></i></h3>          <p>下面的示例展示了@LocalStorageLink装饰的数据和LocalStorage双向同步的场景：</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 构造LocalStorage实例</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'PropA'</span>: <span class="hljs-number">47</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(para);</li><li><span class="hljs-comment">// 调用link（api9以上）接口构造'PropA'的双向同步数据，linkToPropA 是全局变量</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">linkToPropA</span>: <span class="hljs-title class_">SubscribedAbstractProperty</span>&lt;<span class="hljs-built_in">object</span>&gt; = storage.<span class="hljs-title function_">link</span>(<span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>
</li><li>  <span class="hljs-comment">// @LocalStorageLink('PropA')在Parent自定义组件中创建'PropA'的双向同步数据，初始值为47，因为在构造LocalStorage已经给“PropA”设置47</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">storageLink</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`incr @LocalStorageLink variable`</span>)</li><li>        <span class="hljs-comment">// 点击“incr @LocalStorageLink variable”，this.storageLink加1，改变同步回storage，全局变量linkToPropA也会同步改变</span></li><li>
</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">storageLink</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>
</li><li>      <span class="hljs-comment">// 并不建议在组件内使用全局变量linkToPropA.get()，因为可能会有生命周期不同引起的错误。</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`@LocalStorageLink: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.storageLink}</span> - linkToPropA: <span class="hljs-subst">${linkToPropA.get()}</span>`</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="兄弟组件之间同步状态变量">兄弟组件之间同步状态变量<i class="anchor-icon anchor-icon-link" anchorid="兄弟组件之间同步状态变量" tips="复制节点链接"></i></h3>          <p>下面的示例展示了通过@LocalStorageLink双向同步兄弟组件之间的状态。</p>     <p>先看Parent自定义组件中发生的变化：</p>     <ol>      <li>       <p>点击“playCount ${this.playCount} dec by 1”，this.playCount减1，修改同步回LocalStorage中，Child组件中的playCountLink绑定的组件会同步刷新。</p></li>      <li>       <p>点击“countStorage ${this.playCount} incr by 1”，调用LocalStorage的set接口，更新LocalStorage中“countStorage”对应的属性，Child组件中的playCountLink绑定的组件会同步刷新。</p></li>      <li>       <p>Text组件“playCount in LocalStorage for debug ${storage.get&lt;number&gt;('countStorage')}”没有同步刷新，因为storage.get&lt;number&gt;('countStorage')返回的是常规变量，常规变量的更新并不会引起Text组件的重新渲染。</p></li>     </ol>     <p>Child自定义组件中的变化：</p>     <ol>      <li>playCountLink的刷新会同步回LocalStorage，并且引起兄弟组件和父组件相应的刷新。</li>     </ol>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">count</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = { <span class="hljs-string">'countStorage'</span>: <span class="hljs-number">1</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(count);</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-comment">// 子组件实例的名字</span></li><li>  <span class="hljs-attr">label</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'no name'</span>;</li><li>  <span class="hljs-comment">// 和LocalStorage中“countStorage”的双向绑定数据</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'countStorage'</span>) <span class="hljs-attr">playCountLink</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">label</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`playCountLink <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.playCountLink}</span>: inc by 1`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">playCountLink</span> += <span class="hljs-number">1</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'countStorage'</span>) <span class="hljs-attr">playCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Parent'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`playCount <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.playCount}</span> dec by 1`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">playCount</span> -= <span class="hljs-number">1</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'LocalStorage'</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`countStorage <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.playCount}</span> incr by 1`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            storage.<span class="hljs-property">set</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>&gt;(<span class="hljs-string">'countStorage'</span>, <span class="hljs-title class_">Number</span>(storage.<span class="hljs-property">get</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'countStorage'</span>)) + <span class="hljs-number">1</span>);</li><li>          })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">250</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>
</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">'ChildA'</span> })</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">label</span>: <span class="hljs-string">'ChildB'</span> })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`playCount in LocalStorage for debug <span class="hljs-subst">${storage.get&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-string">'countStorage'</span>)}</span>`</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">12</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="将localstorage实例从uiability共享到一个或多个页面">将LocalStorage实例从UIAbility共享到一个或多个页面<i class="anchor-icon anchor-icon-link" anchorid="将localstorage实例从uiability共享到一个或多个页面" tips="复制节点链接"></i></h3>          <p>上面的实例中，LocalStorage的实例仅仅在一个@Entry装饰的组件和其所属的子组件（一个页面）中共享，如果希望其在多个页面中共享，可以在所属UIAbility中创建LocalStorage实例，并调用windowStage.<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#loadcontent9" target="_blank">loadContent</a>。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-attr">para</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = {</li><li>    <span class="hljs-string">'PropA'</span>: <span class="hljs-number">47</span></li><li>  };</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">para</span>);</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在UI页面通过getSharedLocalStorage获取当前stage共享的LocalStorage实例。</p>       <p>this.getUIContext().getSharedLocalStorage()只在模拟器或者实机上才有效，在Previewer预览器中使用不生效。</p>      </div></div></div>     <p>在下面的用例中，Index页面中的propA通过使用共享的LocalStorage实例。点击Button跳转到Page页面，点击Change propA改变propA的值，back回Index页面后，页面中propA的值也同步修改。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.ets</span></li><li>
</li><li><span class="hljs-comment">// 预览器上不支持获取页面共享的LocalStorage实例。</span></li><li><span class="hljs-meta">@Entry</span>({ <span class="hljs-attr">useSharedStorage</span>: <span class="hljs-literal">true</span> })</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 可以使用@LocalStorageLink/Prop与LocalStorage实例中的变量建立联系</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">propA</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-attr">pageStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>) {</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.propA}</span>`</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'To Page'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageStack</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'Page'</span>, <span class="hljs-literal">null</span>);</li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Page.ets</span></li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PageBuilder</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Page</span>()</li><li>}</li><li>
</li><li><span class="hljs-comment">// Page组件获得了父亲Index组件的LocalStorage实例</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-attr">propA</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">2</span>;</li><li>  <span class="hljs-attr">pathStack</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.propA}</span>`</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>
</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Change propA'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">propA</span> = <span class="hljs-number">100</span>;</li><li>            })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Back Index'</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span>.<span class="hljs-title function_">pop</span>();</li><li>            })</li><li>        }</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">(<span class="hljs-params">context: NavDestinationContext</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pathStack</span> = context.<span class="hljs-property">pathStack</span>;</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用Navigation时，需要添加配置系统路由表文件src/main/resources/base/profile/route_map.json，并替换pageSourceFile为Page页面的路径，并且在module.json5中添加："routerMap": "$profile:route_map"。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"routerMap"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Page"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"pageSourceFile"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"src/main/ets/pages/Page.ets"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"buildFunction"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"PageBuilder"</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-attr">"data"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"description"</span> <span class="hljs-punctuation">:</span> <span class="hljs-string">"LocalStorage example"</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>对于开发者更建议使用这个方式来构建LocalStorage的实例，并且在创建LocalStorage实例的时候就写入默认值，因为默认值可以作为运行异常的备份，也可以用作页面的单元测试。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="自定义组件接收localstorage实例">自定义组件接收LocalStorage实例<i class="anchor-icon anchor-icon-link" anchorid="自定义组件接收localstorage实例" tips="复制节点链接"></i></h3>          <p>除了根节点可通过@Entry来接收LocalStorage实例，自定义组件（子节点）也可以通过构造参数来传递LocalStorage实例。</p>     <p>本示例以@LocalStorageLink为例，展示了：</p>     <ul>      <li>       <p>父组件中的Text，显示LocalStorage实例localStorage1中PropA的值为“PropA”。</p></li>      <li>       <p>Child组件中，Text绑定的PropB，显示LocalStorage实例localStorage2中PropB的值为“PropB”。</p></li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 12开始，自定义组件支持接收LocalStorage实例。</p>       <p>当自定义组件作为子节点，定义了成员属性时，LocalStorage实例必须要放在第二个参数位置传递，否则会报类型不匹配的编译问题。</p>       <p>当在自定义组件中定义了属性时，暂时不支持只有一个LocalStorage实例作为入参。如果没定义属性，可以只传入一个LocalStorage实例作为入参。</p>       <p>如果定义的属性不需要从父组件初始化变量，则第一个参数需要传{}。</p>       <p>作为构造参数传给子组件的LocalStorage实例在初始化时就会被决定，可以通过@LocalStorageLink或者LocalStorage的API修改LocalStorage实例中保存的属性值，但LocalStorage实例自身不能被动态修改。</p>      </div></div></div>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage1</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage1.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage2</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage2.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-string">'PropB'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(localStorage1)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 'PropA'，和localStorage1中'PropA'的双向同步</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-comment">// 使用LocalStorage 实例localStorage2</span></li><li>        <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> }, localStorage2)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Link</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-comment">//  'Hello World'和localStorage2中'PropB'的双向同步，如果localStorage2中没有'PropB'，则使用默认值'Hello World'</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-title class_">PropB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropB</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <ol>      <li>       <p>当自定义组件没有定义属性时，可以只传入一个LocalStorage实例作为入参。</p>       <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage1</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage1.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage2</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage2.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-string">'PropB'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(localStorage1)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 'PropA'，和localStorage1中'PropA'的双向同步</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-comment">// 使用LocalStorage 实例localStorage2</span></li><li>        <span class="hljs-title class_">Child</span>(localStorage2)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'hello'</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>当定义的属性不需要从父组件初始化变量时，第一个参数需要传{}。</p>       <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage1</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage1.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorage2</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorage2.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-string">'PropB'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span>(localStorage1)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-comment">// 'PropA'，和localStorage1中'PropA'的双向同步</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        <span class="hljs-comment">// 使用LocalStorage 实例localStorage2</span></li><li>        <span class="hljs-title class_">Child</span>({}, localStorage2)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>;</li><li>  <span class="hljs-comment">// 'Hello World'，和localStorage2中'PropB'的双向同步，如果localStorage2中没有'PropB'，则使用默认值'Hello World'</span></li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-title class_">PropB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PropB</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>      .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="navigation组件和localstorage联合使用">Navigation组件和LocalStorage联合使用<i class="anchor-icon anchor-icon-link" anchorid="navigation组件和localstorage联合使用" tips="复制节点链接"></i></h3>          <p>可以通过传递不同的LocalStorage实例给自定义组件，从而实现在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-navigation" target="_blank">Navigation</a>跳转到不同的页面时，绑定不同的LocalStorage实例，显示对应绑定的值。</p>     <p>本示例以@LocalStorageLink为例，展示了：</p>     <ul>      <li>       <p>点击父组件中的Button "Next Page",创建并跳转到name为"pageOne"的子页面，Text显示信息为LocalStorage实例localStorageA中绑定的PropA的值，为"PropA"。</p></li>      <li>       <p>继续点击页面上的Button "Next Page",创建并跳转到name为"pageTwo"的子页面，Text显示信息为LocalStorage实例localStorageB中绑定的PropB的值，为"PropB"。</p></li>      <li>       <p>继续点击页面上的Button "Next Page",创建并跳转到name为"pageTree"的子页面，Text显示信息为LocalStorage实例localStorageC中绑定的PropC的值，为"PropC"。</p></li>      <li>       <p>继续点击页面上的Button "Next Page",创建并跳转到name为"pageOne"的子页面，Text显示信息为LocalStorage实例localStorageA中绑定的PropA的值，为"PropA"。</p></li>      <li>       <p>NavigationContentMsgStack自定义组件中的Text组件，共享对应自定义组件树上LocalStorage实例绑定的PropA的值。</p></li>     </ul>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageA</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageA.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropA'</span>, <span class="hljs-string">'PropA'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageB</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageB.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropB'</span>, <span class="hljs-string">'PropB'</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localStorageC</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>localStorageC.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'PropC'</span>, <span class="hljs-string">'PropC'</span>);</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyNavigationTestStack</span> {</li><li>  <span class="hljs-meta">@Provide</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NavPathStack</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">PageMap</span>(<span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>) {</li><li>    <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageOne'</span>) {</li><li>      <span class="hljs-comment">// 传递不同的LocalStorage实例</span></li><li>      <span class="hljs-title class_">PageOneStack</span>({}, localStorageA)</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageTwo'</span>) {</li><li>      <span class="hljs-title class_">PageTwoStack</span>({}, localStorageB)</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (name === <span class="hljs-string">'pageThree'</span>) {</li><li>      <span class="hljs-title class_">PageThreeStack</span>({}, localStorageC)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">Navigation</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>) {</li><li>        <span class="hljs-title class_">Column</span>() {</li><li>          <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>            .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPath</span>({ <span class="hljs-attr">name</span>: <span class="hljs-string">'pageOne'</span> }); <span class="hljs-comment">//将name指定的NavDestination页面信息入栈</span></li><li>            })</li><li>        }</li><li>      }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'NavIndex'</span>)</li><li>      .<span class="hljs-title function_">navDestination</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">PageMap</span>)</li><li>      .<span class="hljs-title function_">mode</span>(<span class="hljs-title class_">NavigationMode</span>.<span class="hljs-property">Stack</span>)</li><li>      .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageOneStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>        <span class="hljs-comment">// 显示绑定的LocalStorage中PropA的值'PropA'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropA}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageTwo'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageOne'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageTwoStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-title class_">PropB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>        <span class="hljs-comment">// 如果绑定的LocalStorage中没有PropB,显示本地初始化的值 'Hello World'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropB}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageThree'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageTwo'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PageThreeStack</span> {</li><li>  <span class="hljs-meta">@Consume</span>(<span class="hljs-string">'pageInfo'</span>) <span class="hljs-attr">pageInfo</span>: <span class="hljs-title class_">NavPathStack</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropC'</span>) <span class="hljs-title class_">PropC</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'pageThreeStack'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">NavDestination</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">NavigationContentMsgStack</span>()</li><li>
</li><li>        <span class="hljs-comment">// 如果绑定的LocalStorage中没有PropC,显示本地初始化的值 'pageThreeStack'</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropC}</span>`</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Next Page'</span>, { <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pushPathByName</span>(<span class="hljs-string">'pageOne'</span>, <span class="hljs-literal">null</span>);</li><li>          })</li><li>
</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }.<span class="hljs-title function_">title</span>(<span class="hljs-string">'pageThree'</span>)</li><li>    .<span class="hljs-title function_">onBackPressed</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pageInfo</span>.<span class="hljs-title function_">pop</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">NavigationContentMsgStack</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropA}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="localstorage支持联合类型">LocalStorage支持联合类型<i class="anchor-icon anchor-icon-link" anchorid="localstorage支持联合类型" tips="复制节点链接"></i></h3>          <p>在下面的示例中，变量A的类型为number | null，变量B的类型为number | undefined。Text组件初始化分别显示为null和undefined，点击切换为数字，再次点击切换回null和undefined。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocalStorageLinkComponent</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'LinkA'</span>) <span class="hljs-title class_">LinkA</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'LinkB'</span>) <span class="hljs-title class_">LinkB</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'@LocalStorageLink接口初始化，@LocalStorageLink取值'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.LinkA}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkA</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkA</span> = <span class="hljs-literal">null</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkA</span> = <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.LinkB}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkB</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkB</span> = <span class="hljs-literal">undefined</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkB</span> = <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">3</span>).<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>
</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocalStoragePropComponent</span> {</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'PropA'</span>) <span class="hljs-title class_">PropA</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-meta">@LocalStorageProp</span>(<span class="hljs-string">'PropB'</span>) <span class="hljs-title class_">PropB</span>: <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'@LocalStorageProp接口初始化，@LocalStorageProp取值'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropA}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span> = <span class="hljs-literal">null</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropA</span> = <span class="hljs-number">1</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.PropB}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropB</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropB</span> = <span class="hljs-literal">undefined</span> : <span class="hljs-variable language_">this</span>.<span class="hljs-property">PropB</span> = <span class="hljs-number">1</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">3</span>)</li><li>    .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>)</li><li>
</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>(storage)</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">LocalStorageLinkComponent</span>()</li><li>        <span class="hljs-title class_">LocalStoragePropComponent</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰date类型变量">装饰Date类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰date类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 12开始，LocalStorage支持Date类型。</p>      </div></div></div>     <p>在下面的示例中，@LocalStorageLink装饰的selectedDate类型为Date，点击Button改变selectedDate的值，UI会随之刷新。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocalDateSample</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'date'</span>) <span class="hljs-attr">selectedDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2021-08-08'</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set selectedDate to 2023-07-08'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2023-07-08'</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the year by 1'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setFullYear</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getFullYear</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the month by 1'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setMonth</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'increase the day by 1'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">setDate</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectedDate</span>.<span class="hljs-title function_">getDate</span>() + <span class="hljs-number">1</span>);</li><li>        })</li><li>      <span class="hljs-title class_">DatePicker</span>({</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'1970-1-1'</span>),</li><li>        <span class="hljs-attr">end</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(<span class="hljs-string">'2100-1-1'</span>),</li><li>        <span class="hljs-attr">selected</span>: $$this.<span class="hljs-property">selectedDate</span></li><li>      })</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰map类型变量">装饰Map类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰map类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 12开始，LocalStorage支持Map类型。</p>      </div></div></div>     <p>在下面的示例中，@LocalStorageLink装饰的message类型为Map&lt;number, string&gt;，点击Button改变message的值，UI会随之刷新。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocalMapSample</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'map'</span>) <span class="hljs-attr">message</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>]</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init map'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">'a'</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">'b'</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">'c'</span>]]);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">4</span>, <span class="hljs-string">'d'</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">clear</span>();</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'replace the existing one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">set</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'aa'</span>);</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the existing one'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="装饰set类型变量">装饰Set类型变量<i class="anchor-icon anchor-icon-link" anchorid="装饰set类型变量" tips="复制节点链接"></i></h3>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 12开始，LocalStorage支持Set类型。</p>      </div></div></div>     <p>在下面的示例中，@LocalStorageLink装饰的memberSet类型为Set&lt;number&gt;，点击Button改变memberSet的值，UI会随之刷新。</p>     <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LocalSetSample</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'set'</span>) <span class="hljs-attr">memberSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">memberSet</span>.<span class="hljs-title function_">entries</span>()), <span class="hljs-function">(<span class="hljs-params">item: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>]</span>) =&gt;</span> {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${item[<span class="hljs-number">0</span>]}</span>`</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          <span class="hljs-title class_">Divider</span>()</li><li>        })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'init set'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">memberSet</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set new one'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">memberSet</span>.<span class="hljs-title function_">add</span>(<span class="hljs-number">5</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">memberSet</span>.<span class="hljs-title function_">clear</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'delete the first one'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">memberSet</span>.<span class="hljs-title function_">delete</span>(<span class="hljs-number">0</span>);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="自定义组件外改变状态变量">自定义组件外改变状态变量<i class="anchor-icon anchor-icon-link" anchorid="自定义组件外改变状态变量" tips="复制节点链接"></i></h3>          <div _ngcontent-myk-c106="" class="highlight-div"><div _ngcontent-myk-c106="" class="highlight-div-header"><div _ngcontent-myk-c106="" class="highlight-div-header-left"><div _ngcontent-myk-c106="" class="handle-button expand-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-myk-c106="" class="highlight-div-header-right"><div _ngcontent-myk-c106="" class="handle-button ai-button"></div><div _ngcontent-myk-c106="" class="handle-button line-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-myk-c106="" class="handle-button theme-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-myk-c106="" class="handle-button copy-button"><div _ngcontent-myk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-myk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'count'</span>, <span class="hljs-number">47</span>);</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> {</li><li>  <span class="hljs-attr">storage</span>: <span class="hljs-title class_">LocalStorage</span> = storage;</li><li>
</li><li>  <span class="hljs-title function_">call</span>(<span class="hljs-params">propName: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">storage</span>.<span class="hljs-property">setOrCreate</span>&lt;<span class="hljs-built_in">number</span>&gt;(propName, value);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">model</span>: <span class="hljs-title class_">Model</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Model</span>();</li><li>
</li><li><span class="hljs-meta">@Entry</span>({ <span class="hljs-attr">storage</span>: storage })</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Test</span> {</li><li>  <span class="hljs-meta">@LocalStorageLink</span>(<span class="hljs-string">'count'</span>) <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`count值: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          model.<span class="hljs-title function_">call</span>(<span class="hljs-string">'count'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> + <span class="hljs-number">1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>