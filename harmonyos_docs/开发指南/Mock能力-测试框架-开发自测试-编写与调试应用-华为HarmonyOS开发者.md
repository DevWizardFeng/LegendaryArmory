<h1 _ngcontent-fcd-c119="" class="doc-title ng-star-inserted" title="Mock能力"> Mock能力 </h1>

<div _ngcontent-fcd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000002020003105"><p id="ZH-CN_TOPIC_0000002478334570__p1099335911391">在实际开发中，一些接口或者对象依赖于外部资源或复杂的逻辑，这些依赖在测试环境中难以复现，导致这些接口或者对象难以测试，此时，可以使用Mock能力，对这些接口或对象进行模拟。当前Instrument Test和Local Test均支持对模块进行Mock，对于调用系统模块API或外部依赖模块，使用import mock，对于本地模块，使用hamock/hypium插件包的mock接口或者import mock。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002478334570__p1436862154511">仅API 11及以上版本的Stage工程支持。</p> </div></div></div> <div class="tiledSection"><h2 id="section8353132513310">系统模块/依赖模块Mock<i class="anchor-icon anchor-icon-link" anchorid="section8353132513310" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478334570__p321914344337">通过import mock对系统模块API或依赖模块的方法进行Mock，在mock-config.json5配置文件中定义目标模块和Mock实现代码文件的映射关系，运行时import目标模块都将指向Mock实现代码。以系统API bluetoothManager为例，具体实现如下。</p> <ol id="ZH-CN_TOPIC_0000002478334570__ol1538654616478"><li id="li9386134614710">在src/mock目录下新建一个ArkTS文件，例如bluetooth_manager.mock.ets，在这个文件内定义目标模块的Mock实现。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478334570__screen1021912348338" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/mock/bluetooth_manager.mock.ets</span></li><li><span class="hljs-keyword">enum</span> <span class="hljs-title class_">BluetoothState</span> {</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is off */</span></li><li>  <span class="hljs-variable">STATE_OFF</span> = <span class="hljs-number">0</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is turning on */</span></li><li>  <span class="hljs-variable">STATE_TURNING_ON</span> = <span class="hljs-number">1</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is on, and ready for use */</span></li><li>  <span class="hljs-variable">STATE_ON</span> = <span class="hljs-number">2</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is turning off */</span></li><li>  <span class="hljs-variable">STATE_TURNING_OFF</span> = <span class="hljs-number">3</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is turning LE mode on */</span></li><li>  <span class="hljs-variable">STATE_BLE_TURNING_ON</span> = <span class="hljs-number">4</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is in LE only mode */</span></li><li>  <span class="hljs-variable">STATE_BLE_ON</span> = <span class="hljs-number">5</span>,</li><li>  <span class="hljs-comment">/** Indicates the local Bluetooth is turning off LE only mode */</span></li><li>  <span class="hljs-variable">STATE_BLE_TURNING_OFF</span> = <span class="hljs-number">6</span></li><li>}</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">BluetoothInfo</span> {</li><li>  <span class="hljs-variable">state</span>: <span class="hljs-title class_">number</span></li><li>}</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">MockBluetoothManager</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt; = {</li><li>  <span class="hljs-string">'getBluetoothInfo'</span>: () =&gt; {</li><li>    <span class="hljs-keyword">return</span> { <span class="hljs-variable">state</span> : <span class="hljs-title class_">BluetoothState</span>.<span class="hljs-title class_">STATE_BLE_TURNING_ON</span> } <span class="hljs-keyword">as</span> <span class="hljs-title class_">BluetoothInfo</span>;</li><li>  },</li><li>};</li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-variable">MockBluetoothManager</span>;</li></ol></pre></div></div> </li><li id="li11387144614473">在Mock配置文件src/mock/mock-config.json5中定义目标模块与Mock实现的映射关系。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478334570__screen1921963463310" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"@ohos.enterprise.bluetoothManager"</span>: {  <span class="hljs-comment">// 待替换的模块名</span></li><li>  <span class="hljs-string">"source"</span>: <span class="hljs-string">"src/mock/bluetooth_manager.mock.ets"</span>  <span class="hljs-comment">// Mock代码的路径，相对于模块根目录</span></li><li>}</li></ol></pre></div></div> </li><li id="li103871946174715">在测试文件中编写如下代码。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen12191434123314" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// bluetoothManager.test.ets</span></li><li><span class="hljs-keyword">import</span> { describe, it, expect } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hypium'</span>;</li><li><span class="hljs-keyword">import</span> { bluetoothManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MDMKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mock_system_api</span>(<span class="hljs-params"></span>) {   </li><li>  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'mock_system_api'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">/* mock系统API */</span></li><li>    <span class="hljs-title function_">it</span>(<span class="hljs-string">'mock_system_api'</span>, <span class="hljs-number">0</span>, <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> bluetoothInfo = bluetoothManager.<span class="hljs-title function_">getBluetoothInfo</span>({</li><li>        <span class="hljs-attr">bundleName</span>: <span class="hljs-string">"com.example.myapplication"</span></li><li>      })</li><li>      <span class="hljs-title function_">expect</span>(bluetoothInfo.<span class="hljs-property">state</span>).<span class="hljs-title function_">assertEqual</span>(<span class="hljs-number">4</span>)</li><li>    });</li><li>  });</li><li>}</li></ol></pre></div></div> </li><li id="li12461227534">如果测试文件是手动创建的，需要将用例类mock_system_api添加到List.test.ets文件中。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen75591321544" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> mock_system_api <span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'./bluetoothManager.test'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">testsuite</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class="hljs-title function_">mock_system_api</span><span class="">()</span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div> </li><li id="li19387194624714">执行测试，用例通过。</li></ol> </div> <div class="tiledSection"><h2 id="section1427019168307">本地模块Mock<i class="anchor-icon anchor-icon-link" anchorid="section1427019168307" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002478334570__p517614403581">有两种方式可以对本地模块进行Mock，一是使用hamock/hypium插件包的mock接口，二是使用import mock。</p> </div> <div class="tiledSection"><h3 id="section1644161411818" class="firsth2">使用hamock/hypium插件包的mock接口<i class="anchor-icon anchor-icon-link" anchorid="section1644161411818" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478334570__p2034953317194">以下例子通过mock接口模拟本地模块的某个方法，关于Mock的更多说明可以参考<a href="https://gitee.com/openharmony/testfwk_arkxtest#mock能力" target="_blank">mock能力</a>。</p> <ol id="ZH-CN_TOPIC_0000002478334570__ol1453310531474"><li id="li95331453204712">在src/main/ets目录下新建一个ArkTS文件，例如ClassForMock.ets，并在其中导出一个类。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002478334570__screen15991810101916" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ClassForMock</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>  <span class="hljs-title function_">method_1</span>(<span class="hljs-params">arg: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'888888'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">method_2</span>(<span class="hljs-params">arg: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'999999'</span>;</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li id="li1853325319471">在测试文件中编写如下代码。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen199161021916" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// afterReturnTest.test.ets</span></li><li><span class="hljs-keyword">import</span> { describe, expect, it, <span class="hljs-title class_">MockKit</span>, when } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/hypium'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ClassForMock</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'../../../main/ets/ClassForMock'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">afterReturnTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title function_">describe</span>(<span class="hljs-string">'afterReturnTest'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-title function_">it</span>(<span class="hljs-string">'afterReturnTest'</span>, <span class="hljs-number">0</span>, <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"it begin"</span>);</li><li>      <span class="hljs-comment">// 1.创建一个mock能力的对象MockKit</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">mocker</span>: <span class="hljs-title class_">MockKit</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MockKit</span>();</li><li>      <span class="hljs-comment">// 2.定义类ClassForMock，里面两个函数，然后创建一个对象classForMock</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">classForMock</span>: <span class="hljs-title class_">ClassForMock</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ClassForMock</span>();</li><li>      <span class="hljs-comment">// 3.进行mock操作,比如需要对ClassForMock类的method_1函数进行mock</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">mockFunc</span>: <span class="hljs-title class_">Function</span> = mocker.<span class="hljs-title function_">mockFunc</span>(classForMock, classForMock.<span class="hljs-property">method_1</span>);</li><li>      <span class="hljs-comment">// 4.期望classForMock.method_1函数被mock后, 以'test'为入参时调用函数返回结果'1'</span></li><li>      <span class="hljs-title function_">when</span>(mockFunc)(<span class="hljs-string">'test'</span>).<span class="hljs-title function_">afterReturn</span>(<span class="hljs-string">'1'</span>);</li><li>      <span class="hljs-comment">// 5.对mock后的函数进行断言，看是否符合预期</span></li><li>      <span class="hljs-comment">// 执行成功案例，参数为'test'</span></li><li>      <span class="hljs-title function_">expect</span>(classForMock.<span class="hljs-title function_">method_1</span>(<span class="hljs-string">'test'</span>)).<span class="hljs-title function_">assertEqual</span>(<span class="hljs-string">'1'</span>); <span class="hljs-comment">// 执行通过</span></li><li>    })</li><li>  })</li><li>}</li></ol></pre></div></div> </li><li id="li183767337817">如果测试文件是手动创建的，需要将用例类afterReturnTest添加到List.test.ets文件中。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen1737663313812" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> afterReturnTest <span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'./afterReturnTest.test'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">testsuite</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class="hljs-title function_">afterReturnTest</span><span class="">()</span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div> </li><li id="li753316533471">执行测试，用例通过。</li></ol> </div> <div class="tiledSection"><h3 id="section257342631817">使用import mock<i class="anchor-icon anchor-icon-link" anchorid="section257342631817" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002478334570__p12991336201914">使用import mock对本地模块进行Mock，操作步骤和系统模块/依赖模块的Mock类似，在mock-config.json5配置文件中定义目标模块和Mock实现代码文件的映射关系，运行时import目标模块都将指向Mock实现代码。以下例子对本地模块entry/src/main/ets/common/calc.ets中的sum函数进行Mock。</p> <ol id="ZH-CN_TOPIC_0000002478334570__ol1497665914473"><li id="li17976175916475">在src/mock目录下新建一个common目录并创建一个ArkTS文件，例如calc.mock.ets，在这个文件内定义目标模块的Mock实现。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen16620558162914" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/mock/common/calc.mock.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">sum</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class="hljs-keyword">return</span> <span class=""><span class="hljs-string">"this is mock sum"</span></span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div> <p id="ZH-CN_TOPIC_0000002478334570__p135791651295">calc.ets的原始实现如下：</p> <div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen4453111222817" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/main/ets/common/calc.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">sum</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class="hljs-keyword">return</span> <span class=""><span class="hljs-number">1</span></span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div> </li><li id="li1530821415813">在Mock配置文件src/mock/mock-config.json5中定义目标模块与Mock实现的映射关系。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002478334570__screen159595543304" data-highlighted="yes"><ol class="linenums"><li>{</li><li><span class="">  <span class="hljs-string">"common/calc.ets"</span></span><span class="">: </span>{ <span class="hljs-comment">// 本地模块只支持ets/xxx的相对路径，并需明确文件后缀</span></li><li>    <span class=""><span class="hljs-string">"source"</span></span><span class="">: </span><span class=""><span class="hljs-string">"src/mock/common/calc.mock.ets"</span></span>  <span class="hljs-comment">// Mock代码的路径，相对于模块根目录</span></li><li>  }<span class="">,</span></li><li>}</li></ol></pre></div></div> </li><li id="li45948416112">在测试文件中编写如下代码。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen98712042205816" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// </span><span class=""><span class="hljs-comment">test_mock_local_method</span></span><span class="hljs-comment">.test.ets</span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">describe</span><span class="">, </span><span class="">it</span><span class="">, </span><span class="">expect </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'@ohos/hypium'</span></span></li><li><span class="hljs-keyword">import</span> <span class="">{ </span><span class="">sum </span><span class="">} </span><span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'../../../main/ets/common/calc'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">test_mock_local_method</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-title function_">describe</span></span><span class="">(</span><span class=""><span class="hljs-string">'test_mock_local_method'</span></span><span class="">, </span><span class=""><span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>    <span class=""><span class="hljs-title function_">it</span></span><span class="">(</span><span class=""><span class="hljs-string">"test_mock_local_method"</span></span><span class="">, </span><span class=""><span class="hljs-number">0</span></span><span class="">, </span><span class=""><span class="hljs-function">() </span></span><span class=""><span class="hljs-function">=</span></span><span class=""><span class="hljs-function">&gt;</span></span> <span class="">{</span></li><li>      <span class=""><span class="hljs-title function_">expect</span></span><span class="">(</span><span class=""><span class="hljs-title function_">sum</span></span><span class="">())</span><span class="">.</span><span class=""><span class="hljs-title function_">assertEqual</span></span><span class="">(</span><span class=""><span class="hljs-string">"this is mock sum"</span></span><span class="">)</span></li><li>    <span class="">}</span><span class="">)</span></li><li>  <span class="">}</span><span class="">)</span></li><li><span class="">}</span></li></ol></pre></div></div> </li><li id="li19103191719125">如果测试文件是手动创建的，需要将用例类test_mock_local_method添加到List.test.ets文件中。<div _ngcontent-fcd-c106="" class="highlight-div"><div _ngcontent-fcd-c106="" class="highlight-div-header"><div _ngcontent-fcd-c106="" class="highlight-div-header-left"><div _ngcontent-fcd-c106="" class="handle-button expand-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fcd-c106="" class="highlight-div-header-right"><div _ngcontent-fcd-c106="" class="handle-button ai-button"></div><div _ngcontent-fcd-c106="" class="handle-button line-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fcd-c106="" class="handle-button theme-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fcd-c106="" class="handle-button copy-button"><div _ngcontent-fcd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fcd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" id="ZH-CN_TOPIC_0000002478334570__screen9103141711218" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="">test_mock_local_method</span> <span class="hljs-keyword">from</span> <span class=""><span class="hljs-string">'./test_mock_local_method.test'</span></span><span class="">;</span></li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">function</span> <span class=""><span class="hljs-title function_">testsuite</span></span><span class="">(<span class="hljs-params"></span>) </span><span class="">{</span></li><li>  <span class=""><span class="hljs-title function_">test_mock_local_method</span></span><span class="">()</span><span class="">;</span></li><li><span class="">}</span></li></ol></pre></div></div> </li><li id="li636972551212">执行测试，用例通过。</li></ol> </div> </div> <div></div></div>