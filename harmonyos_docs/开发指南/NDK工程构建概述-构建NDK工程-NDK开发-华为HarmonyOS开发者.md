<h1 _ngcontent-uno-c119="" class="doc-title ng-star-inserted" title="NDK工程构建概述"> NDK工程构建概述 </h1>

<div _ngcontent-uno-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>HarmonyOS NDK默认使用CMake作为构建系统，随包提供了符合HarmonyOS工具链的基础配置文件<a href="/consumer/cn/doc/harmonyos-guides/build-with-ndk-overview#ohostoolchaincmake简介">ohos.toolchain.cmake</a>，用于预定义CMake变量来简化开发者配置。</p> <p>常用的NDK工程构建方式有：</p> <ul><li><p>从源码构建</p>  <p>源码构建也有不同方式：</p>  <ul><li>可以使用DevEco Studio提供的C++应用模板，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/build-with-ndk-ide">用DevEco Studio来编译构建</a></li><li>也可以<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/build-with-ndk-cmake">使用命令行CMake来编译构建</a></li></ul>  </li><li><p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/build-with-ndk-prebuilts">使用预构建库构建</a></p>  </li></ul> <p>本章节将通过具体示例介绍如何在Native工程中使用NDK，以及如何编写CMake脚本来构建NDK工程。</p>  <div class="tiledSection"><h2 id="ohostoolchaincmake简介">ohos.toolchain.cmake简介<i class="anchor-icon anchor-icon-link" anchorid="ohostoolchaincmake简介" tips="复制节点链接"></i></h2><p>ohos.toolchain.cmake是HarmonyOS NDK提供给CMake的toolchain脚本，里面预定义了编译HarmonyOS应用需要设置的编译参数，如交叉编译设备的目标、C++运行时库的链接方式等；这些参数在调用CMake命令时，可以从命令行传入，来改变默认编译链接行为。此文件中的常用参数见下表。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.1" valign="top" width="33.33333333333333%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.2" valign="top" width="33.33333333333333%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">OHOS_STL</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">c++_shared/c++_static</td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>libc++的链接方式。默认为c++_shared。</p> <p>c++_shared表示采用动态链接libc++_shared.so；c++_static表示采用静态链接libc++_static.a。</p> <p>由于C++运行时中存在一些全局变量，因此同一应用中的全部Native库需要采用相同的链接方式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">OHOS_ARCH</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">armeabi-v7a/arm64-v8a/x86_64</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">设置当前Native交叉编译的目标架构，当前支持的架构为armeabi-v7a/arm64-v8a/x86_64。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">OHOS_PLATFORM</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">OHOS</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">选择平台。当前只支持HarmonyOS平台。</td> </tr>  </tbody></table></div> </div> <p>上述参数最终会控制Clang的交叉编译命令，产生合适的命令参数。</p> <ul><li><p>--target={arch}-linux-ohos参数，通知编译器生成相应架构下符合HarmonyOS ABI的二进制文件。</p>  </li><li><p>--sysroot={ndk_root}/sysroot参数，告知编译器HarmonyOS系统头文件的所在位置。</p>  </li></ul> </div> </div> <div></div></div>