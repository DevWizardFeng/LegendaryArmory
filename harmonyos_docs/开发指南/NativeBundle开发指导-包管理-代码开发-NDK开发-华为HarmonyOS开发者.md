<h1 _ngcontent-nxc-c119="" class="doc-title ng-star-inserted" title="NativeBundle开发指导"> NativeBundle开发指导 </h1>

<div _ngcontent-nxc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>开发者可以通过本指导了解在HarmonyOS应用中，如何使用Native Bundle接口获取应用自身相关信息。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>常用接口如下表所示，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-bundle" target="_blank">Native_Bundle</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getcurrentapplicationinfo" target="_blank">OH_NativeBundle_GetCurrentApplicationInfo</a></td>         <td class="cellrowborder" valign="top" width="50%">获取应用自身相关信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getappid" target="_blank">OH_NativeBundle_GetAppId</a></td>         <td class="cellrowborder" valign="top" width="50%">获取自身应用的appId信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getappidentifier" target="_blank">OH_NativeBundle_GetAppIdentifier</a></td>         <td class="cellrowborder" valign="top" width="50%">获取自身应用的appIdentifier信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getmainelementname" target="_blank">OH_NativeBundle_GetMainElementName</a></td>         <td class="cellrowborder" valign="top" width="50%">获取自身应用入口的信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getcompatibledevicetype" target="_blank">OH_NativeBundle_GetCompatibleDeviceType</a></td>         <td class="cellrowborder" valign="top" width="50%">获取自身应用适用的设备类型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_isdebugmode" target="_blank">OH_NativeBundle_IsDebugMode</a></td>         <td class="cellrowborder" valign="top" width="50%">查询当前应用的调试模式。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getmodulemetadata" target="_blank">OH_NativeBundle_GetModuleMetadata</a></td>         <td class="cellrowborder" valign="top" width="50%">获取当前应用的元数据信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-interface-bundle-h#oh_nativebundle_getabilityresourceinfo" target="_blank">OH_NativeBundle_GetAbilityResourceInfo</a></td>         <td class="cellrowborder" valign="top" width="50%">获取支持打开特定文件类型的组件资源信息列表。从API version 21开始支持。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p><strong>1. 创建工程</strong></p>     <p><span><img originheight="658" originwidth="983" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114336.57203770617997216291120981189926:50001231000000:2800:F96371E8E6BA5909C154CFA181AA635851F7E8FEDBCB4C0B41DF2CF662C1B094.png" width="920" height="615.8290946083418"></span></p>     <p><strong>2. 添加依赖</strong></p>     <p>创建完成后，DevEco Studio会在工程生成cpp目录，目录有types/libentry/index.d.ts、napi_init.cpp、CMakeLists.txt等文件。</p>     <ol>      <li>       <p>打开src/main/cpp/CMakeLists.txt，在target_link_libraries依赖中添加包管理的libbundle_ndk.z.so。</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libbundle_ndk.z.so)</li></ol></pre></div></div></li>      <li>       <p>打开src/main/cpp/napi_init.cpp文件，添加头文件。</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//napi依赖头文件</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-comment">//NDK接口依赖头文件</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"bundle/ability_resource_info.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"bundle/native_interface_bundle.h"</span></span></li><li><span class="hljs-comment">//free()函数依赖的基础库</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li></ol></pre></div></div></li>     </ol>     <p><strong>3. 修改源文件</strong></p>     <ol>      <li>       <p>打开src/main/cpp/napi_init.cpp文件，文件Init会对当前方法进行初始化映射，这里定义对外的接口。</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"add"</span>, <span class="hljs-literal">nullptr</span>, Add, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>        { <span class="hljs-string">"getCurrentApplicationInfo"</span>, <span class="hljs-literal">nullptr</span>, GetCurrentApplicationInfo, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},   <span class="hljs-comment">// 新增方法 getCurrentApplicationInfo</span></li><li>        { <span class="hljs-string">"getAppId"</span>, <span class="hljs-literal">nullptr</span>, GetAppId, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},                                     <span class="hljs-comment">// 新增方法 getAppId</span></li><li>        { <span class="hljs-string">"getAppIdentifier"</span>, <span class="hljs-literal">nullptr</span>, GetAppIdentifier, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},                     <span class="hljs-comment">// 新增方法 getAppIdentifier</span></li><li>        { <span class="hljs-string">"getMainElementName"</span>, <span class="hljs-literal">nullptr</span>, GetMainElementName, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},                 <span class="hljs-comment">// 新增方法 getMainElementName</span></li><li>        { <span class="hljs-string">"getCompatibleDeviceType"</span>, <span class="hljs-literal">nullptr</span>, GetCompatibleDeviceType, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},       <span class="hljs-comment">// 新增方法 getCompatibleDeviceType</span></li><li>        { <span class="hljs-string">"isDebugMode"</span>, <span class="hljs-literal">nullptr</span>, IsDebugMode, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},                               <span class="hljs-comment">// 新增方法 isDebugMode</span></li><li>        { <span class="hljs-string">"getModuleMetadata"</span>, <span class="hljs-literal">nullptr</span>, GetModuleMetadata, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},                   <span class="hljs-comment">// 新增方法 getModuleMetadata</span></li><li>        { <span class="hljs-string">"getAbilityResourceInfo"</span>, <span class="hljs-literal">nullptr</span>, GetAbilityResourceInfo, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}          <span class="hljs-comment">// 新增方法 getAbilityResourceInfo</span></li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>      <li>       <p>在src/main/cpp/napi_init.cpp文件中，增加对应的方法，如下所示：</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>static napi_value <span class="hljs-built_in">GetCurrentApplicationInfo</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetAppId</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetAppIdentifier</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetMainElementName</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetCompatibleDeviceType</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">IsDebugMode</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetModuleMetadata</span>(napi_env env, napi_callback_info info);</li><li>static napi_value <span class="hljs-built_in">GetAbilityResourceInfo</span>(napi_env env, napi_callback_info info);</li></ol></pre></div></div></li>      <li>       <p>在src/main/cpp/napi_init.cpp文件中获取Native的包信息对象，并转为js的包信息对象，即可在js侧获取应用的信息：</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetCurrentApplicationInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 调用Native接口获取应用信息</span></li><li>    OH_NativeBundle_ApplicationInfo nativeApplicationInfo = <span class="hljs-built_in">OH_NativeBundle_GetCurrentApplicationInfo</span>();</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;result);</li><li>    <span class="hljs-comment">// Native接口获取的应用包名转为js对象里的bundleName属性</span></li><li>    napi_value bundleName;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, nativeApplicationInfo.bundleName, NAPI_AUTO_LENGTH, &amp;bundleName);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"bundleName"</span>, bundleName);</li><li>    <span class="hljs-comment">// Native接口获取的指纹信息转为js对象里的fingerprint属性</span></li><li>    napi_value fingerprint;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, nativeApplicationInfo.fingerprint, NAPI_AUTO_LENGTH, &amp;fingerprint);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"fingerprint"</span>, fingerprint);</li><li>
</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-built_in">free</span>(nativeApplicationInfo.bundleName);</li><li>    <span class="hljs-built_in">free</span>(nativeApplicationInfo.fingerprint);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetAppId</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 调用Native接口获取应用appId</span></li><li>    <span class="hljs-type">char</span>* appId = <span class="hljs-built_in">OH_NativeBundle_GetAppId</span>();</li><li>    <span class="hljs-comment">// Native接口转成nAppId返回</span></li><li>    napi_value nAppId;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, appId, NAPI_AUTO_LENGTH, &amp;nAppId);</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-built_in">free</span>(appId);</li><li>    <span class="hljs-keyword">return</span> nAppId;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetAppIdentifier</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 调用Native接口获取应用appIdentifier</span></li><li>    <span class="hljs-type">char</span>* appIdentifier = <span class="hljs-built_in">OH_NativeBundle_GetAppIdentifier</span>();</li><li>    <span class="hljs-comment">// Native接口转成nAppIdentifier返回</span></li><li>    napi_value nAppIdentifier;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, appIdentifier, NAPI_AUTO_LENGTH, &amp;nAppIdentifier);</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-built_in">free</span>(appIdentifier);</li><li>    <span class="hljs-keyword">return</span> nAppIdentifier;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetMainElementName</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 调用Native接口获取应用入口的信息</span></li><li>    OH_NativeBundle_ElementName elementName = <span class="hljs-built_in">OH_NativeBundle_GetMainElementName</span>();</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;result);</li><li>    <span class="hljs-comment">// Native接口获取的应用包名转为js对象里的bundleName属性</span></li><li>    napi_value bundleName;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, elementName.bundleName, NAPI_AUTO_LENGTH, &amp;bundleName);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"bundleName"</span>, bundleName);</li><li>    <span class="hljs-comment">// Native接口获取的模块名称转为js对象里的moduleName属性</span></li><li>    napi_value moduleName;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, elementName.moduleName, NAPI_AUTO_LENGTH, &amp;moduleName);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"moduleName"</span>, moduleName);</li><li>    <span class="hljs-comment">// Native接口获取的ability名称转为js对象里的abilityName属性</span></li><li>    napi_value abilityName;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, elementName.abilityName, NAPI_AUTO_LENGTH, &amp;abilityName);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"abilityName"</span>, abilityName);</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-built_in">free</span>(elementName.bundleName);</li><li>    <span class="hljs-built_in">free</span>(elementName.moduleName);</li><li>    <span class="hljs-built_in">free</span>(elementName.abilityName);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetCompatibleDeviceType</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 调用Native接口获取应用deviceType</span></li><li>    <span class="hljs-type">char</span>* deviceType = <span class="hljs-built_in">OH_NativeBundle_GetCompatibleDeviceType</span>();</li><li>    <span class="hljs-comment">// Native接口转成nDeviceType返回</span></li><li>    napi_value nDeviceType;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, deviceType, NAPI_AUTO_LENGTH, &amp;nDeviceType);</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-built_in">free</span>(deviceType);</li><li>    <span class="hljs-keyword">return</span> nDeviceType;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsDebugMode</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">bool</span> isDebug = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 调用Native接口获取应用DebugMode的信息</span></li><li>    <span class="hljs-type">bool</span> isSuccess = <span class="hljs-built_in">OH_NativeBundle_IsDebugMode</span>(&amp;isDebug);</li><li>    <span class="hljs-comment">// 调用Native接口失败抛出异常</span></li><li>    <span class="hljs-keyword">if</span> (isSuccess == <span class="hljs-literal">false</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"call failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// Native接口转成debug返回</span></li><li>    napi_value debug;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, isDebug, &amp;debug);</li><li>    <span class="hljs-keyword">return</span> debug;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetModuleMetadata</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> moduleCount = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 调用Native接口获取应用元数据的信息</span></li><li>    OH_NativeBundle_ModuleMetadata* modules = <span class="hljs-built_in">OH_NativeBundle_GetModuleMetadata</span>(&amp;moduleCount);</li><li>    <span class="hljs-keyword">if</span> (modules == <span class="hljs-literal">nullptr</span> || moduleCount == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"no metadata found"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_create_array</span>(env, &amp;result);</li><li>
</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; moduleCount; i++) {</li><li>        napi_value moduleObj;</li><li>        <span class="hljs-built_in">napi_create_object</span>(env, &amp;moduleObj);</li><li>
</li><li>        <span class="hljs-comment">// Native接口获取的模块名转为js对象里的moduleName属性</span></li><li>        napi_value moduleName;</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, modules[i].moduleName, NAPI_AUTO_LENGTH, &amp;moduleName);</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, moduleObj, <span class="hljs-string">"moduleName"</span>, moduleName);</li><li>
</li><li>        napi_value metadataArray;</li><li>        <span class="hljs-built_in">napi_create_array</span>(env, &amp;metadataArray);</li><li>
</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j = <span class="hljs-number">0</span>; j &lt; modules[i].metadataArraySize; j++) {</li><li>            napi_value metadataObj;</li><li>            <span class="hljs-built_in">napi_create_object</span>(env, &amp;metadataObj);</li><li>
</li><li>            napi_value name;</li><li>            napi_value value;</li><li>            napi_value resource;</li><li>
</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, modules[i].metadataArray[j].name, NAPI_AUTO_LENGTH, &amp;name);</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, modules[i].metadataArray[j].value, NAPI_AUTO_LENGTH, &amp;value);</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, modules[i].metadataArray[j].resource, NAPI_AUTO_LENGTH, &amp;resource);</li><li>
</li><li>            <span class="hljs-comment">// Native接口获取的元数据名称转为js对象里的name属性</span></li><li>            <span class="hljs-built_in">napi_set_named_property</span>(env, metadataObj, <span class="hljs-string">"name"</span>, name);</li><li>            <span class="hljs-comment">// Native接口获取的元数据值名称转为js对象里的value属性</span></li><li>            <span class="hljs-built_in">napi_set_named_property</span>(env, metadataObj, <span class="hljs-string">"value"</span>, value);</li><li>            <span class="hljs-comment">// Native接口获取的元数据资源转为js对象里的resource属性</span></li><li>            <span class="hljs-built_in">napi_set_named_property</span>(env, metadataObj, <span class="hljs-string">"resource"</span>, resource);</li><li>
</li><li>            <span class="hljs-built_in">napi_set_element</span>(env, metadataArray, j, metadataObj);</li><li>        }</li><li>
</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, moduleObj, <span class="hljs-string">"metadata"</span>, metadataArray);</li><li>        <span class="hljs-built_in">napi_set_element</span>(env, result, i, moduleObj);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 最后为了防止内存泄漏，手动释放</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; moduleCount; i++) {</li><li>        <span class="hljs-built_in">free</span>(modules[i].moduleName);</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> j = <span class="hljs-number">0</span>; j &lt; modules[i].metadataArraySize; j++) {</li><li>            <span class="hljs-built_in">free</span>(modules[i].metadataArray[j].name);</li><li>            <span class="hljs-built_in">free</span>(modules[i].metadataArray[j].value);</li><li>            <span class="hljs-built_in">free</span>(modules[i].metadataArray[j].resource);</li><li>        }</li><li>        <span class="hljs-built_in">free</span>(modules[i].metadataArray);</li><li>    }</li><li>    <span class="hljs-built_in">free</span>(modules);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetAbilityResourceInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>];</li><li>    napi_status status;</li><li>
</li><li>    <span class="hljs-comment">// 获取传入的参数</span></li><li>    status = <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok || argc &lt; <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Invalid arguments. Expected fileType string."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 检查参数类型是否为字符串</span></li><li>    napi_valuetype valuetype;</li><li>    status = <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valuetype);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok || valuetype != napi_string) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Argument must be a string"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 获取字符串参数</span></li><li>    <span class="hljs-type">char</span> fileType[<span class="hljs-number">256</span>] = {<span class="hljs-number">0</span>}; <span class="hljs-comment">// 假设文件类型不会超过255个字符</span></li><li>    <span class="hljs-type">size_t</span> str_len;</li><li>    status = <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">0</span>], fileType, <span class="hljs-built_in">sizeof</span>(fileType) - <span class="hljs-number">1</span>, &amp;str_len);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to get fileType string"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-type">size_t</span> infosCount = <span class="hljs-number">0</span>;</li><li>    OH_NativeBundle_AbilityResourceInfo *infos = <span class="hljs-literal">nullptr</span>;</li><li>
</li><li>    <span class="hljs-comment">// 调用Native接口获取组件资源信息，使用传入的fileType</span></li><li>    BundleManager_ErrorCode ret = <span class="hljs-built_in">OH_NativeBundle_GetAbilityResourceInfo</span>(fileType, &amp;infos, &amp;infosCount);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (ret == BUNDLE_MANAGER_ERROR_CODE_PERMISSION_DENIED) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"BUNDLE_MANAGER_ERROR_CODE_PERMISSION_DENIED"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (infos == <span class="hljs-literal">nullptr</span> || infosCount == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"no metadata found"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_create_array</span>(env, &amp;result);</li><li>
</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; infosCount; i++) {</li><li>
</li><li>        <span class="hljs-keyword">auto</span> temp = (OH_NativeBundle_AbilityResourceInfo *)((<span class="hljs-type">char</span> *)infos + <span class="hljs-built_in">OH_NativeBundle_GetSize</span>() * i);</li><li>
</li><li>        napi_value infoObj;</li><li>        <span class="hljs-built_in">napi_create_object</span>(env, &amp;infoObj);</li><li>
</li><li>        <span class="hljs-comment">// 1. 添加Default App</span></li><li>        <span class="hljs-type">bool</span> IsDefaultApp = <span class="hljs-literal">true</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_CheckDefaultApp</span>(temp, &amp;IsDefaultApp);</li><li>        napi_value defaultAppValue;</li><li>        <span class="hljs-built_in">napi_get_boolean</span>(env, IsDefaultApp, &amp;defaultAppValue);</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"IsDefaultApp"</span>, defaultAppValue);</li><li>
</li><li>        <span class="hljs-comment">// 2. 添加App Index</span></li><li>        <span class="hljs-type">int</span> appIndex = <span class="hljs-number">-1</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetAppIndex</span>(temp, &amp;appIndex);</li><li>        napi_value appIndexValue;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, appIndex, &amp;appIndexValue);</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"appIndex"</span>, appIndexValue);</li><li>
</li><li>        <span class="hljs-comment">// 3. 添加Label</span></li><li>        <span class="hljs-type">char</span> *label = <span class="hljs-literal">nullptr</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetLabel</span>(temp, &amp;label);</li><li>        napi_value labelValue;</li><li>        <span class="hljs-keyword">if</span> (label) {</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, label, NAPI_AUTO_LENGTH, &amp;labelValue);</li><li>            <span class="hljs-built_in">free</span>(label);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">napi_get_null</span>(env, &amp;labelValue);</li><li>        }</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"label"</span>, labelValue);</li><li>
</li><li>        <span class="hljs-comment">// 4. 添加Bundle Name</span></li><li>        <span class="hljs-type">char</span> *bundleName = <span class="hljs-literal">nullptr</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetBundleName</span>(temp, &amp;bundleName);</li><li>        napi_value bundleNameValue;</li><li>        <span class="hljs-keyword">if</span> (bundleName) {</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, bundleName, NAPI_AUTO_LENGTH, &amp;bundleNameValue);</li><li>            <span class="hljs-built_in">free</span>(bundleName);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">napi_get_null</span>(env, &amp;bundleNameValue);</li><li>        }</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"bundleName"</span>, bundleNameValue);</li><li>
</li><li>        <span class="hljs-comment">// 5. 添加Module Name</span></li><li>        <span class="hljs-type">char</span> *moduleName = <span class="hljs-literal">nullptr</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetModuleName</span>(temp, &amp;moduleName);</li><li>        napi_value moduleNameValue;</li><li>        <span class="hljs-keyword">if</span> (moduleName) {</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, moduleName, NAPI_AUTO_LENGTH, &amp;moduleNameValue);</li><li>            <span class="hljs-built_in">free</span>(moduleName);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">napi_get_null</span>(env, &amp;moduleNameValue);</li><li>        }</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"moduleName"</span>, moduleNameValue);</li><li>
</li><li>        <span class="hljs-comment">// 6. 添加Ability Name</span></li><li>        <span class="hljs-type">char</span> *abilityName = <span class="hljs-literal">nullptr</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetAbilityName</span>(temp, &amp;abilityName);</li><li>        napi_value abilityNameValue;</li><li>        <span class="hljs-keyword">if</span> (abilityName) {</li><li>            <span class="hljs-built_in">napi_create_string_utf8</span>(env, abilityName, NAPI_AUTO_LENGTH, &amp;abilityNameValue);</li><li>            <span class="hljs-built_in">free</span>(abilityName);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">napi_get_null</span>(env, &amp;abilityNameValue);</li><li>        }</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, infoObj, <span class="hljs-string">"abilityName"</span>, abilityNameValue);</li><li>
</li><li>        <span class="hljs-comment">// 7. 获取ArkUI_DrawableDescriptor对象</span></li><li>        ArkUI_DrawableDescriptor *rawDrawable = <span class="hljs-literal">nullptr</span>;</li><li>        <span class="hljs-built_in">OH_NativeBundle_GetDrawableDescriptor</span>(temp, &amp;rawDrawable);</li><li>        <span class="hljs-keyword">if</span> (rawDrawable) {</li><li>            <span class="hljs-comment">//使用ArkUI_DrawableDescriptor对象绘制图标</span></li><li>        }</li><li>
</li><li>        <span class="hljs-built_in">napi_set_element</span>(env, result, i, infoObj);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 释放内存</span></li><li>    <span class="hljs-built_in">OH_AbilityResourceInfo_Destroy</span>(infos, infosCount);</li><li>
</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div></li>     </ol>     <p><strong>4. 接口暴露</strong></p>     <p>在src/main/cpp/types/libentry/Index.d.ts文件中，声明暴露接口。</p>     <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a: number, b: number</span>) =&gt;</span> number;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getCurrentApplicationInfo</span>: <span class="hljs-function">() =&gt;</span> object;   <span class="hljs-comment">// 新增暴露方法 getCurrentApplicationInfo</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getAppId</span>: <span class="hljs-function">() =&gt;</span> string;                    <span class="hljs-comment">// 新增暴露方法 getAppId</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getAppIdentifier</span>: <span class="hljs-function">() =&gt;</span> string;            <span class="hljs-comment">// 新增暴露方法 getAppIdentifier</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getMainElementName</span>: <span class="hljs-function">() =&gt;</span> object;          <span class="hljs-comment">// 新增暴露方法 getMainElementName</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getCompatibleDeviceType</span>: <span class="hljs-function">() =&gt;</span> string;     <span class="hljs-comment">// 新增暴露方法 getCompatibleDeviceType</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isDebugMode</span>: <span class="hljs-function">() =&gt;</span> string;                 <span class="hljs-comment">// 新增暴露方法 isDebugMode</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getModuleMetadata</span>: <span class="hljs-function">() =&gt;</span> object;           <span class="hljs-comment">// 新增暴露方法 getModuleMetadata</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getAbilityResourceInfo</span>: <span class="hljs-function">(<span class="hljs-params">fileType: string</span>) =&gt;</span> object;      <span class="hljs-comment">// 新增暴露方法 getAbilityResourceInfo</span></li></ol></pre></div></div>     <p><strong>5. js侧调用</strong></p>     <ol>      <li>       <p>打开src\main\ets\pages\index.ets, 导入"libentry.so"。</p></li>      <li>       <p>调用Native接口打印出获取的信息内容。示例如下：</p>       <div _ngcontent-nxc-c106="" class="highlight-div"><div _ngcontent-nxc-c106="" class="highlight-div-header"><div _ngcontent-nxc-c106="" class="highlight-div-header-left"><div _ngcontent-nxc-c106="" class="handle-button expand-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nxc-c106="" class="highlight-div-header-right"><div _ngcontent-nxc-c106="" class="handle-button ai-button"></div><div _ngcontent-nxc-c106="" class="handle-button line-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nxc-c106="" class="handle-button theme-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nxc-c106="" class="handle-button copy-button"><div _ngcontent-nxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nxc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">DOMAIN</span> = <span class="hljs-number">0x0000</span>;</li><li>
</li><li>@<span class="hljs-title class_">Entry</span></li><li>@<span class="hljs-title class_">Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>@<span class="hljs-title class_">State</span> <span class="hljs-attr">message</span>: string = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>($r(<span class="hljs-string">'app.float.page_text_font_size'</span>))</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Welcome'</span>;</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test NAPI 2 + 3 = %{public}d'</span>, testNapi.<span class="hljs-title function_">add</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>));</li><li>            <span class="hljs-keyword">let</span> appInfo = testNapi.<span class="hljs-title function_">getCurrentApplicationInfo</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getCurrentApplicationInfo success, data is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(appInfo));</li><li>            <span class="hljs-keyword">let</span> appId = testNapi.<span class="hljs-title function_">getAppId</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getAppId success, appId is "</span> + appId);</li><li>            <span class="hljs-keyword">let</span> appIdentifier = testNapi.<span class="hljs-title function_">getAppIdentifier</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getAppIdentifier success, appIdentifier is "</span> + appIdentifier);</li><li>            <span class="hljs-keyword">let</span> mainElement = testNapi.<span class="hljs-title function_">getMainElementName</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getMainElementName success, data is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(mainElement));</li><li>            <span class="hljs-keyword">let</span> deviceType = testNapi.<span class="hljs-title function_">getCompatibleDeviceType</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getCompatibleDeviceType success, deviceType is "</span> + deviceType);</li><li>            <span class="hljs-keyword">let</span> isDebugMode = testNapi.<span class="hljs-title function_">isDebugMode</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK isDebugMode success, isDebugMode is "</span> + isDebugMode);</li><li>            <span class="hljs-keyword">let</span> moduleMetadata = testNapi.<span class="hljs-title function_">getModuleMetadata</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getModuleMetadata success, data is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(moduleMetadata));</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">fileType</span>: string = <span class="hljs-string">'.png'</span>;</li><li>            <span class="hljs-keyword">let</span> abilityResourceInfo = testNapi.<span class="hljs-title function_">getAbilityResourceInfo</span>(fileType);</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"bundleNDK getAbilityResourceInfo success, data is "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(abilityResourceInfo));</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>}</li><li>}</li></ol></pre></div></div></li>     </ol>     <p>关于包管理NDK接口说明，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-bundle" target="_blank">Native_Bundle模块介绍</a>。</p>    </div>   </div>   <div></div></div>