<h1 _ngcontent-vwr-c119="" class="doc-title ng-star-inserted" title="NativeDisplaySoloist开发指导 (C/C++)"> NativeDisplaySoloist开发指导 (C/C++) </h1>

<div _ngcontent-vwr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>如果开发者想在独立线程中实现帧率控制的Native侧业务，可以通过DisplaySoloist来实现，如游戏、自绘制UI框架对接等场景。</p>    <p>开发者可以选择多个DisplaySoloist实例共享一个线程，也可以选择每个DisplaySoloist实例独占一个线程。</p>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">函数名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_DisplaySoloist* OH_DisplaySoloist_Create (bool useExclusiveThread)</td>         <td class="cellrowborder" valign="top" width="50%">创建一个OH_DisplaySoloist实例。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_DisplaySoloist_Destroy (OH_DisplaySoloist * displaySoloist)</td>         <td class="cellrowborder" valign="top" width="50%">销毁一个OH_DisplaySoloist实例。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_DisplaySoloist_Start (OH_DisplaySoloist * displaySoloist, OH_DisplaySoloist_FrameCallback callback, void * data )</td>         <td class="cellrowborder" valign="top" width="50%">设置每帧回调函数，每次VSync信号到来时启动每帧回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_DisplaySoloist_Stop (OH_DisplaySoloist * displaySoloist)</td>         <td class="cellrowborder" valign="top" width="50%">停止请求下一次VSync信号，并停止调用回调函数callback。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_DisplaySoloist_SetExpectedFrameRateRange (OH_DisplaySoloist* displaySoloist, DisplaySoloist_ExpectedRateRange* range)</td>         <td class="cellrowborder" valign="top" width="50%">设置期望帧率范围。</td>        </tr>             </tbody></table></div>     </div>     <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativedisplaysoloist" target="_blank">NativeDisplaySoloist</a>。</p>    </div>    <div class="tiledSection">     <h2 id="开发示例">开发示例<i class="anchor-icon anchor-icon-link" anchorid="开发示例" tips="复制节点链接"></i></h2>          <p>本范例是通过Drawing在Native侧实现图形的绘制，通过异步线程设置期望的帧率，再根据帧率进行图形的绘制并将其呈现在NativeWindow上，图形绘制部分可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/graphic-drawing-overview">使用Drawing实现图形绘制与显示</a>。</p>    </div>    <div class="tiledSection">     <h3 id="添加开发依赖" class="firsth2">添加开发依赖<i class="anchor-icon anchor-icon-link" anchorid="添加开发依赖" tips="复制节点链接"></i></h3>          <p><strong>添加动态链接库</strong></p>     <p>CMakeLists.txt中添加以下lib。</p>     <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libace_napi.z.so</li><li>libace_ndk.z.so</li><li>libnative_window.so</li><li>libnative_drawing.so</li><li>libnative_display_soloist.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ace/xcomponent/native_interface_xcomponent.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_display_soloist/native_display_soloist.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_bitmap.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_color.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_canvas.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_pen.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_brush.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_path.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_window/external_window.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cmath&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;algorithm&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdint.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;sys/mman.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>定义ArkTS接口文件XComponentContext.ts，用来对接Native层。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">XComponentContext</span> {</li><li>  <span class="hljs-title function_">register</span>(): <span class="hljs-built_in">void</span>;</li><li>  <span class="hljs-title function_">unregister</span>(): <span class="hljs-built_in">void</span>;</li><li>  <span class="hljs-title function_">destroy</span>(): <span class="hljs-built_in">void</span>;</li><li>};</li></ol></pre></div></div></li>      <li>       <p>定义演示页面，包含两个XComponent组件。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> <span class="hljs-title class_">XComponentContext</span> <span class="hljs-keyword">from</span> <span class="hljs-string">"../interface/XComponentContext"</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">xComponentContext1</span>: <span class="hljs-title class_">XComponentContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">xComponentContext2</span>: <span class="hljs-title class_">XComponentContext</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">XComponent</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'xcomponentId30'</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>, <span class="hljs-attr">libraryname</span>: <span class="hljs-string">'entry'</span> })</li><li>          .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">(<span class="hljs-params">xComponentContext</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">xComponentContext1</span> = xComponentContext <span class="hljs-keyword">as</span> <span class="hljs-title class_">XComponentContext</span>;</li><li>          }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'640px'</span>)</li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">XComponent</span>({ <span class="hljs-attr">id</span>: <span class="hljs-string">'xcomponentId120'</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">XComponentType</span>.<span class="hljs-property">SURFACE</span>, <span class="hljs-attr">libraryname</span>: <span class="hljs-string">'entry'</span> })</li><li>          .<span class="hljs-title function_">onLoad</span>(<span class="hljs-function">(<span class="hljs-params">xComponentContext</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">xComponentContext2</span> = xComponentContext <span class="hljs-keyword">as</span> <span class="hljs-title class_">XComponentContext</span>;</li><li>          }).<span class="hljs-title function_">width</span>(<span class="hljs-string">'640px'</span>) <span class="hljs-comment">// 64的倍数</span></li><li>      }.<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在 Native C++层获取NativeXComponent。建议使用单例模式保存XComponent。此步骤需要在napi_init的过程中处理。</p>       <p>创建一个PluginManager单例类，用于管理NativeXComponent。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">PluginManager</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    ~<span class="hljs-title function_">PluginManager</span>();</li><li>
</li><li>    <span class="hljs-keyword">static</span> <span class="hljs-variable">PluginManager</span> *<span class="hljs-title function_">GetInstance</span>();</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetNativeXComponent</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> &amp;<span class="hljs-title class_">id</span>, <span class="hljs-variable">OH_NativeXComponent</span> *<span class="hljs-variable">nativeXComponent</span>);</li><li>    <span class="hljs-variable">SampleBitMap</span> *<span class="hljs-title function_">GetRender</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> &amp;<span class="hljs-title class_">id</span>);</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">Export</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_value</span> <span class="hljs-variable">exports</span>);</li><li><span class="hljs-keyword">private</span>:</li><li>
</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">unordered_map</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>, <span class="hljs-title class_">OH_NativeXComponent</span> *&gt; <span class="hljs-title class_">nativeXComponentMap_</span>;</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">unordered_map</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>, <span class="hljs-title class_">SampleXComponent</span> *&gt; <span class="hljs-title class_">pluginRenderMap_</span>;</li><li>};</li></ol></pre></div></div>       <p>SampleXComponent类会在后面的绘制图形中创建。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">void</span> <span class="hljs-variable">PluginManager</span>::<span class="hljs-title class_">Export</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>, <span class="hljs-title class_">napi_value</span> <span class="hljs-title class_">exports</span>) {</li><li>    <span class="hljs-variable">nativeXComponentMap_</span>.<span class="hljs-title function_">clear</span>();</li><li>    <span class="hljs-variable">pluginRenderMap_</span>.<span class="hljs-title function_">clear</span>();</li><li>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">env</span> == <span class="hljs-variable">nullptr</span>) || (<span class="hljs-variable">exports</span> == <span class="hljs-variable">nullptr</span>)) {</li><li>        <span class="hljs-title function_">DRAWING_LOGE</span>(<span class="hljs-string">"Export: env or exports is null"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">exportInstance</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_get_named_property</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">exports</span>, <span class="hljs-variable">OH_NATIVE_XCOMPONENT_OBJ</span>, &amp;<span class="hljs-title class_">exportInstance</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>        <span class="hljs-title function_">DRAWING_LOGE</span>(<span class="hljs-string">"Export: napi_get_named_property fail"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">OH_NativeXComponent</span> *<span class="hljs-variable">nativeXComponent</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_unwrap</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">exportInstance</span>, <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">void</span> **&gt;(&amp;<span class="hljs-title class_">nativeXComponent</span>)) != <span class="hljs-variable">napi_ok</span>) {</li><li>        <span class="hljs-title function_">DRAWING_LOGE</span>(<span class="hljs-string">"Export: napi_unwrap fail"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">idStr</span>[<span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>] = {<span class="hljs-string">'\0'</span>};</li><li>    <span class="hljs-variable">uint64_t</span> <span class="hljs-variable">idSize</span> = <span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">OH_NativeXComponent_GetXComponentId</span>(<span class="hljs-variable">nativeXComponent</span>, <span class="hljs-variable">idStr</span>, &amp;<span class="hljs-title class_">idSize</span>) != <span class="hljs-variable">OH_NATIVEXCOMPONENT_RESULT_SUCCESS</span>) {</li><li>        <span class="hljs-title function_">DRAWING_LOGE</span>(<span class="hljs-string">"Export: OH_NativeXComponent_GetXComponentId fail"</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">id</span>(<span class="hljs-title class_">idStr</span>);</li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">context</span> = <span class="hljs-variable">PluginManager</span>::<span class="hljs-title class_">GetInstance</span>();</li><li>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">context</span> != <span class="hljs-variable">nullptr</span>) &amp;&amp; (<span class="hljs-variable">nativeXComponent</span> != <span class="hljs-variable">nullptr</span>)) {</li><li>        <span class="hljs-variable">context</span>-&gt;<span class="hljs-title class_">SetNativeXComponent</span>(<span class="hljs-title class_">id</span>, <span class="hljs-title class_">nativeXComponent</span>);</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">render</span> = <span class="hljs-variable">context</span>-&gt;<span class="hljs-title class_">GetRender</span>(<span class="hljs-title class_">id</span>);</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">render</span> != <span class="hljs-variable">nullptr</span>) {</li><li>            <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">RegisterCallback</span>(<span class="hljs-title class_">nativeXComponent</span>);</li><li>            <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">Export</span>(<span class="hljs-title class_">env</span>, <span class="hljs-title class_">exports</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-title function_">DRAWING_LOGE</span>(<span class="hljs-string">"render is nullptr"</span>);</li><li>        }</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>Native层配置帧率和注册回调函数。</p>       <p>定义每帧回调函数内容。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">TestCallback</span>(<span class="hljs-variable">long</span> <span class="hljs-variable">long</span> <span class="hljs-variable">timestamp</span>, <span class="hljs-variable">long</span> <span class="hljs-variable">long</span> <span class="hljs-variable">targetTimestamp</span>, <span class="hljs-variable">void</span> *<span class="hljs-variable">data</span>)</li><li>{</li><li>   <span class="hljs-comment">// ...</span></li><li>   <span class="hljs-comment">// 获取对应的XComponent</span></li><li>    <span class="hljs-variable">OH_NativeXComponent</span> *<span class="hljs-variable">component</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">component</span> = <span class="hljs-title class_">static_cast</span>&lt;<span class="hljs-title class_">OH_NativeXComponent</span> *&gt;(<span class="hljs-variable">data</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">component</span> == <span class="hljs-variable">nullptr</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"TestCallback: component is null"</span>);</li><li>       <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">idStr</span>[<span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>] = {<span class="hljs-string">'\0'</span>};</li><li>    <span class="hljs-variable">uint64_t</span> <span class="hljs-variable">idSize</span> = <span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">OH_NativeXComponent_GetXComponentId</span>(<span class="hljs-variable">component</span>, <span class="hljs-variable">idStr</span>, &amp;<span class="hljs-title class_">idSize</span>) != <span class="hljs-variable">OH_NATIVEXCOMPONENT_RESULT_SUCCESS</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"TestCallback: Unable to get XComponent id"</span>);</li><li>       <span class="hljs-keyword">return</span>;</li><li>    }</li><li> </li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">id</span>(<span class="hljs-title class_">idStr</span>);</li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">render</span> = <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">GetInstance</span>(<span class="hljs-title class_">id</span>);</li><li>    <span class="hljs-variable">OHNativeWindow</span> *<span class="hljs-variable">nativeWindow</span> = <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">GetNativeWindow</span>();</li><li>    <span class="hljs-variable">uint64_t</span> <span class="hljs-variable">width</span>;</li><li>    <span class="hljs-variable">uint64_t</span> <span class="hljs-variable">height</span>;</li><li>    <span class="hljs-comment">// 获取XComponent的surface大小</span></li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">xSize</span> = <span class="hljs-title function_">OH_NativeXComponent_GetXComponentSize</span>(<span class="hljs-variable">component</span>, <span class="hljs-variable">nativeWindow</span>, &amp;<span class="hljs-title class_">width</span>, &amp;<span class="hljs-title class_">height</span>);</li><li>    <span class="hljs-keyword">if</span> ((<span class="hljs-variable">xSize</span> == <span class="hljs-variable">OH_NATIVEXCOMPONENT_RESULT_SUCCESS</span>) &amp;&amp; (<span class="hljs-variable">render</span> != <span class="hljs-variable">nullptr</span>)) {</li><li>        <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">Prepare</span>();</li><li>        <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">Create</span>();</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">id</span> == <span class="hljs-string">"xcomponentId30"</span>) {</li><li>            <span class="hljs-comment">// 30Hz绘制时,每帧移动的距离为16像素</span></li><li>            <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">ConstructPath</span>(<span class="hljs-number">16</span>, <span class="hljs-number">16</span>, <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">defaultOffsetY</span>);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">id</span> == <span class="hljs-string">"xcomponentId120"</span>) {</li><li>            <span class="hljs-comment">// 120Hz绘制时，每帧移动的距离为4像素</span></li><li>            <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">ConstructPath</span>(<span class="hljs-number">4</span>, <span class="hljs-number">4</span>, <span class="hljs-variable">render</span>-&gt;<span class="hljs-title class_">defaultOffsetY</span>);</li><li>        }</li><li>       <span class="hljs-comment">// ...</span></li><li>    }</li><li>}</li></ol></pre></div></div>       <p>使用DisplaySoloist接口配置帧率和注册每帧回调函数。如果使用OH_DisplaySoloist_Create创建DisplaySoloist实例时传入的参数useExclusiveThread为true，则OH_DisplaySoloist_FrameCallback以独占线程方式执行，否则OH_DisplaySoloist_FrameCallback以共享线程方式执行。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <ul>          <li>实例在调用NapiRegister后，在不需要进行帧率控制时，应进行NapiUnregister操作，避免内存泄漏问题。</li>          <li>在页面跳转时，应进行NapiUnregister和NapiDestroy操作，避免内存泄漏问题。</li>         </ul>        </div></div></div>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">static</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">unordered_map</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>, <span class="hljs-title class_">OH_DisplaySoloist</span> *&gt; <span class="hljs-title class_">g_displaySync</span>;</li><li>
</li><li><span class="hljs-variable">napi_value</span> <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiRegister</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>, <span class="hljs-title class_">napi_callback_info</span> <span class="hljs-title class_">info</span>)</li><li>{</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// 获取对应的XComponent</span></li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">thisArg</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_get_cb_info</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">info</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, &amp;<span class="hljs-title class_">thisArg</span>, <span class="hljs-variable">nullptr</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"NapiRegister: napi_get_cb_info fail"</span>);</li><li>       <span class="hljs-keyword">return</span> <span class="hljs-variable">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">exportInstance</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_get_named_property</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisArg</span>, <span class="hljs-variable">OH_NATIVE_XCOMPONENT_OBJ</span>, &amp;<span class="hljs-title class_">exportInstance</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"NapiRegister: napi_get_named_property fail"</span>);</li><li>       <span class="hljs-keyword">return</span> <span class="hljs-variable">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">OH_NativeXComponent</span> *<span class="hljs-variable">nativeXComponent</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_unwrap</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">exportInstance</span>, <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">void</span> **&gt;(&amp;<span class="hljs-title class_">nativeXComponent</span>)) != <span class="hljs-variable">napi_ok</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"NapiRegister: napi_unwrap fail"</span>);</li><li>       <span class="hljs-keyword">return</span> <span class="hljs-variable">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">idStr</span>[<span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>] = {<span class="hljs-string">'\0'</span>};</li><li>    <span class="hljs-variable">uint64_t</span> <span class="hljs-variable">idSize</span> = <span class="hljs-variable">OH_XCOMPONENT_ID_LEN_MAX</span> + <span class="hljs-number">1</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">OH_NativeXComponent_GetXComponentId</span>(<span class="hljs-variable">nativeXComponent</span>, <span class="hljs-variable">idStr</span>, &amp;<span class="hljs-title class_">idSize</span>) != <span class="hljs-variable">OH_NATIVEXCOMPONENT_RESULT_SUCCESS</span>) {</li><li>       <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"NapiRegister: Unable to get XComponent id"</span>);</li><li>       <span class="hljs-keyword">return</span> <span class="hljs-variable">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-title function_">SAMPLE_LOGI</span>(<span class="hljs-string">"RegisterID = %{public}s"</span>, <span class="hljs-variable">idStr</span>);</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">id</span>(<span class="hljs-title class_">idStr</span>);</li><li>    <span class="hljs-variable">SampleXComponent</span> *<span class="hljs-variable">render</span> = <span class="hljs-title function_">SampleXComponent</span>().<span class="hljs-title function_">GetInstance</span>(<span class="hljs-variable">id</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">render</span> != <span class="hljs-variable">nullptr</span>) {</li><li>       <span class="hljs-variable">OH_DisplaySoloist</span> *<span class="hljs-variable">nativeDisplaySoloist</span> = <span class="hljs-variable">nullptr</span>;</li><li>       <span class="hljs-keyword">if</span> (<span class="hljs-variable">g_displaySync</span>.<span class="hljs-title function_">find</span>(<span class="hljs-variable">id</span>) == <span class="hljs-variable">g_displaySync</span>.<span class="hljs-title function_">end</span>()) {</li><li>          <span class="hljs-comment">// 创建OH_DisplaySoloist实例</span></li><li>          <span class="hljs-comment">// true表示OH_DisplaySoloist实例独占一个线程，false则表示共享一个线程</span></li><li>          <span class="hljs-variable">g_displaySync</span>[<span class="hljs-variable">id</span>] = <span class="hljs-title function_">OH_DisplaySoloist_Create</span>(<span class="hljs-keyword">true</span>);</li><li>       }</li><li>       <span class="hljs-variable">nativeDisplaySoloist</span> = <span class="hljs-variable">g_displaySync</span>[<span class="hljs-variable">id</span>];</li><li>       <span class="hljs-comment">// 设置期望帧率范围</span></li><li>       <span class="hljs-comment">// 此结构体成员变量分别为帧率范围的最小值、最大值以及期望帧率</span></li><li>       <span class="hljs-variable">DisplaySoloist_ExpectedRateRange</span> <span class="hljs-variable">range</span>;</li><li>       <span class="hljs-keyword">if</span> (<span class="hljs-variable">id</span> == <span class="hljs-string">"xcomponentId30"</span>) {</li><li>          <span class="hljs-comment">// 第一个XComponent期望帧率为30Hz</span></li><li>          <span class="hljs-variable">range</span> = {<span class="hljs-number">30</span>, <span class="hljs-number">120</span>, <span class="hljs-number">30</span>};</li><li>       }</li><li>       <span class="hljs-keyword">if</span> (<span class="hljs-variable">id</span> == <span class="hljs-string">"xcomponentId120"</span>) {</li><li>          <span class="hljs-comment">// 第二个XComponent期望帧率为120Hz</span></li><li>          <span class="hljs-variable">range</span> = {<span class="hljs-number">30</span>, <span class="hljs-number">120</span>, <span class="hljs-number">120</span>};</li><li>       }</li><li>       <span class="hljs-title function_">OH_DisplaySoloist_SetExpectedFrameRateRange</span>(<span class="hljs-variable">nativeDisplaySoloist</span>, &amp;<span class="hljs-title class_">range</span>);</li><li>       <span class="hljs-comment">// 注册回调与使能每帧回调</span></li><li>       <span class="hljs-title function_">OH_DisplaySoloist_Start</span>(<span class="hljs-variable">nativeDisplaySoloist</span>, <span class="hljs-variable">TestCallback</span>, <span class="hljs-variable">nativeXComponent</span>);</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">napi_value</span> <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiUnregister</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>, <span class="hljs-title class_">napi_callback_info</span> <span class="hljs-title class_">info</span>)</li><li>{</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// 取消注册每帧回调</span></li><li>    <span class="hljs-title function_">OH_DisplaySoloist_Stop</span>(<span class="hljs-variable">g_displaySync</span>[<span class="hljs-variable">id</span>]);</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-variable">napi_value</span> <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiDestroy</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>, <span class="hljs-title class_">napi_callback_info</span> <span class="hljs-title class_">info</span>)</li><li>{</li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// 销毁OH_DisplaySoloist实例</span></li><li>    <span class="hljs-title function_">OH_DisplaySoloist_Destroy</span>(<span class="hljs-variable">g_displaySync</span>[<span class="hljs-variable">id</span>]);</li><li>    <span class="hljs-variable">g_displaySync</span>.<span class="hljs-title function_">erase</span>(<span class="hljs-variable">id</span>);</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 实现XComponentContext.ts中ArkTS接口与C++接口的绑定和映射。</span></li><li><span class="hljs-variable">void</span> <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">Export</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>, <span class="hljs-title class_">napi_value</span> <span class="hljs-title class_">exports</span>) {</li><li> <span class="hljs-keyword">if</span> ((<span class="hljs-variable">env</span> == <span class="hljs-variable">nullptr</span>) || (<span class="hljs-variable">exports</span> == <span class="hljs-variable">nullptr</span>)) {</li><li>     <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"Export: env or exports is null"</span>);</li><li>     <span class="hljs-keyword">return</span>;</li><li> }</li><li> <span class="hljs-variable">napi_property_descriptor</span> <span class="hljs-variable">desc</span>[] = {</li><li>     {<span class="hljs-string">"register"</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiRegister</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">napi_default</span>, <span class="hljs-variable">nullptr</span>},</li><li>     {<span class="hljs-string">"unregister"</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiUnregister</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">napi_default</span>, <span class="hljs-variable">nullptr</span>},</li><li>     {<span class="hljs-string">"destroy"</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">SampleXComponent</span>::<span class="hljs-title class_">NapiDestroy</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">napi_default</span>, <span class="hljs-variable">nullptr</span>}};</li><li>
</li><li> <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_define_properties</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">exports</span>, <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">desc</span>) / <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">desc</span>[<span class="hljs-number">0</span>]), <span class="hljs-variable">desc</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>     <span class="hljs-title function_">SAMPLE_LOGE</span>(<span class="hljs-string">"Export: napi_define_properties failed"</span>);</li><li> }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>TS层注册和取消注册每帧回调，销毁OH_DisplaySoloist实例。</p>       <div _ngcontent-vwr-c106="" class="highlight-div"><div _ngcontent-vwr-c106="" class="highlight-div-header"><div _ngcontent-vwr-c106="" class="highlight-div-header-left"><div _ngcontent-vwr-c106="" class="handle-button expand-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vwr-c106="" class="highlight-div-header-right"><div _ngcontent-vwr-c106="" class="handle-button ai-button"></div><div _ngcontent-vwr-c106="" class="handle-button line-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vwr-c106="" class="handle-button theme-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vwr-c106="" class="handle-button copy-button"><div _ngcontent-vwr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vwr-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 离开页面时，取消回调注册与销毁OH_DisplaySoloist实例</span></li><li>aboutToDisappear(): void {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext1) {</li><li>    <span class="hljs-keyword">this</span>.xComponentContext1.unregister();</li><li>    <span class="hljs-keyword">this</span>.xComponentContext1.destroy();</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext2) {</li><li>    <span class="hljs-keyword">this</span>.xComponentContext2.unregister();</li><li>    <span class="hljs-keyword">this</span>.xComponentContext2.destroy();</li><li>  }</li><li>}</li><li>
</li><li>Row() {</li><li>    Button(<span class="hljs-string">'Start'</span>)</li><li>      .id(<span class="hljs-string">'Start'</span>)</li><li>      .fontSize(<span class="hljs-number">14</span>)</li><li>      .fontWeight(<span class="hljs-number">500</span>)</li><li>      .margin({ bottom: <span class="hljs-number">20</span>, right: <span class="hljs-number">6</span>, left: <span class="hljs-number">6</span> })</li><li>      .onClick(() =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext1) {</li><li>          <span class="hljs-keyword">this</span>.xComponentContext1.register();</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext2) {</li><li>          <span class="hljs-keyword">this</span>.xComponentContext2.register();</li><li>        }</li><li>      })</li><li>      .width(<span class="hljs-string">'30%'</span>)</li><li>      .height(<span class="hljs-number">40</span>)</li><li>      .shadow(ShadowStyle.OUTER_DEFAULT_LG)</li><li>    </li><li>    Button(<span class="hljs-string">'Stop'</span>)</li><li>      .id(<span class="hljs-string">'Stop'</span>)</li><li>      .fontSize(<span class="hljs-number">14</span>)</li><li>      .fontWeight(<span class="hljs-number">500</span>)</li><li>      .margin({ bottom: <span class="hljs-number">20</span>, left: <span class="hljs-number">6</span> })</li><li>      .onClick(() =&gt; {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext1) {</li><li>          <span class="hljs-keyword">this</span>.xComponentContext1.unregister();</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.xComponentContext2) {</li><li>          <span class="hljs-keyword">this</span>.xComponentContext2.unregister();</li><li>        }</li><li>      })</li><li>      .width(<span class="hljs-string">'30%'</span>)</li><li>      .height(<span class="hljs-number">40</span>)</li><li>      .shadow(ShadowStyle.OUTER_DEFAULT_LG)</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>