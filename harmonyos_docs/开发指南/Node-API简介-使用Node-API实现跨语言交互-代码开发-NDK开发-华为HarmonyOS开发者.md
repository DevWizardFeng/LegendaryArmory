<h1 _ngcontent-qpr-c119="" class="doc-title ng-star-inserted" title="Node-API简介"> Node-API简介 </h1>

<div _ngcontent-qpr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>HarmonyOS Node-API是基于Node.js 18.x LTS的<a href="https://nodejs.org/docs/latest-v12.x/api/n-api.html" target="_blank">Node-API</a>规范扩展开发的机制，为开发者提供了ArkTS/JS与C/C++模块之间的交互能力。它提供了一组稳定的、跨平台的API，可以在不同的操作系统上使用。</p>     <p>本文中如无特别说明，后续均使用Node-API指代HarmonyOS Node-API能力。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>HarmonyOS Node-API与Node.js 18.x LTS的Node-API规范的接口异同点，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/napi" target="_blank">Node-API参考</a></p>      </div></div></div>     <p>一般情况下HarmonyOS应用开发使用ArkTS/JS语言，但部分场景由于性能、效率等要求，比如游戏、物理模拟等，需要依赖使用现有的C/C++库。Node-API规范封装了I/O、CPU密集型、OS底层等能力并对外暴露C接口，使用C/C++模块的注册机制，向ArkTS/JS对象上挂载属性和方法的方式来实现ArkTS/JS和C/C++的交互。主要场景如下：</p>     <ul>      <li>       <p>系统可以将框架层丰富的模块功能通过Node-API的模块注册机制对外暴露ArkTS/JS的接口，将C/C++的能力开放给应用的ArkTS/JS层。</p></li>      <li>       <p>应用开发者也可以选择将一些对性能、底层系统调用有要求的核心功能用C/C++封装实现，再通过ArkTS/JS接口使用，提高应用本身的执行效率。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="node-api的组成架构">Node-API的组成架构<i class="anchor-icon anchor-icon-link" anchorid="node-api的组成架构" tips="复制节点链接"></i></h2>          <p><strong>图1</strong> Node-API的组成架构</p>     <p></p>     <p><span><img originheight="594" originwidth="1080" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114335.87922120507802543641336130793036:50001231000000:2800:5DE4D420197B131656E7BD2E24BFEF75763136E08C62DA7E99402A1D13E1AE68.png" width="920" height="506"></span></p>     <ul>      <li>       <p>Native Module：开发者使用Node-API开发的模块，用于在ArkTS侧导入使用。</p></li>      <li>       <p>Node-API：实现ArkTS与C/C++交互的逻辑。</p></li>      <li>       <p>ModuleManager：Native模块管理，包括加载、查找等。</p></li>      <li>       <p>ScopeManager：管理napi_value的生命周期。</p></li>      <li>       <p>ReferenceManager：管理napi_ref的生命周期。</p></li>      <li>       <p>NativeEngine：ArkTS引擎抽象层，统一ArkTS引擎在Node-API层的接口行为。</p></li>      <li>       <p>ArkCompiler ArkTS Runtime：ArkTS运行时。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="node-api的关键交互流程">Node-API的关键交互流程<i class="anchor-icon anchor-icon-link" anchorid="node-api的关键交互流程" tips="复制节点链接"></i></h2>          <p><strong>图2</strong> Node-API的关键交互流程</p>     <p></p>     <p><span><img originheight="832" originwidth="1657" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114335.48776662116927699407111327296945:50001231000000:2800:C37F00E7519663A49BED917F0EC88721515AC70366255491D99B114279AE4ED9.png" width="920" height="461.9432709716355"></span></p>     <p>ArkTS和C++之间的交互流程，主要分为以下两步：</p>     <ol>      <li>       <p><strong>初始化阶段</strong>：当ArkTS侧在import一个Native模块时，ArkTS引擎会调用ModuleManager加载模块对应的so及其依赖。首次加载时会触发模块的注册，将模块定义的方法属性挂载到exports对象上并返回该对象。</p></li>      <li>       <p><strong>调用阶段</strong>：当ArkTS侧通过上述import返回的对象调用方法时，ArkTS引擎会找到并调用对应的C/C++方法。</p></li>     </ol>    </div>   </div>   <div></div></div>