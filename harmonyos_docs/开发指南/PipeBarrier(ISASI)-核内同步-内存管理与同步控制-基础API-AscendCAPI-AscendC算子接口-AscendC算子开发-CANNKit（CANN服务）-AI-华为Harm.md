<h1 _ngcontent-axc-c119="" class="doc-title ng-star-inserted" title="PipeBarrier(ISASI)"> PipeBarrier(ISASI) </h1>

<div _ngcontent-axc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section8129154714436">功能说明<i class="anchor-icon anchor-icon-link" anchorid="section8129154714436" tips="复制节点链接"></i></h2><p>阻塞相同流水，具有数据依赖的相同流水之间需要插入此同步。</p> </div> <div class="tiledSection"><h2 id="section284055474417">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section284055474417" tips="复制节点链接"></i></h2><div _ngcontent-axc-c106="" class="highlight-div"><div _ngcontent-axc-c106="" class="highlight-div-header"><div _ngcontent-axc-c106="" class="highlight-div-header-left"><div _ngcontent-axc-c106="" class="handle-button expand-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-axc-c106="" class="highlight-div-header-right"><div _ngcontent-axc-c106="" class="handle-button ai-button"></div><div _ngcontent-axc-c106="" class="handle-button line-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-axc-c106="" class="handle-button theme-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-axc-c106="" class="handle-button copy-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-axc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">template</span> &lt;<span class="hljs-type">pipe_t</span> pipe&gt;</li><li><span class="hljs-function">__aicore__ <span class="hljs-keyword">inline</span> <span class="hljs-type">void</span> <span class="hljs-title">PipeBarrier</span><span class="hljs-params">()</span></span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section16571144205020">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section16571144205020" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>模板参数说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.1" valign="top" width="50%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>pipe</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>模板参数，表示阻塞的流水类别。</p> <p>支持的流水参考表2。</p> <p>如果不关注流水类别，希望阻塞所有流水，可以传入PIPE_ALL。</p> </td> </tr>  </tbody></table></div> </div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>指令流水类型和相关说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.3.1.1" valign="top" width="50%"><p>流水类型</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.3.1.2" valign="top" width="50%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_S</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>标量流水线，使用Tensor GetValue函数时为此流水</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_M</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>矩阵计算流水</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_MTE1</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>L1-&gt;L0A、L1-&gt;L0B数据搬运流水</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_MTE2</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>GM-&gt;L1、GM-&gt;L0A、GM-&gt;L0B、GM-&gt;UB数据搬运流水</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_MTE3</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>UB-&gt;GM、UB-&gt;L1数据搬运流水</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>PIPE_FIX</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>L0C-&gt;GM、L0C-&gt;L1数据搬运流水</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1162611384511">返回值<i class="anchor-icon anchor-icon-link" anchorid="section1162611384511" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section1742420195112">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section1742420195112" tips="复制节点链接"></i></h2><p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section59511612165120">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section59511612165120" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section10366101775216">约束说明<i class="anchor-icon anchor-icon-link" anchorid="section10366101775216" tips="复制节点链接"></i></h2><p>Scalar流水之间的同步由硬件自动保证，调用PipeBarrier&lt;PIPE_S&gt;()会引发硬件错误。</p> </div> <div class="tiledSection"><h2 id="section174889430512">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section174889430512" tips="复制节点链接"></i></h2><p>如下示例，Mul指令的输入dst0Local是Add指令的输出，两个矢量运算指令产生依赖，需要插入PipeBarrier保证两条指令的执行顺序。</p> <p>注：仅作为示例参考，开启自动同步的情况下，编译器自动插入PIPE_V同步，无需开发者手动插入。</p> <div class="fignone"><span class="figcap"><b>图1 </b>Mul指令和Add指令是串行关系，必须等待Add指令执行完成后，才能执行Mul指令。</span><br><span><img originheight="254" originwidth="342" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114327.13761919120295924804457895999356:50001231000000:2800:9A6F96777CC2FF066A4ADA661368F861DDC93A0242A7FF8051415363280B0F66.png" width="342" height="254"></span></div> <div _ngcontent-axc-c106="" class="highlight-div"><div _ngcontent-axc-c106="" class="highlight-div-header"><div _ngcontent-axc-c106="" class="highlight-div-header-left"><div _ngcontent-axc-c106="" class="handle-button expand-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-axc-c106="" class="highlight-div-header-right"><div _ngcontent-axc-c106="" class="handle-button ai-button"></div><div _ngcontent-axc-c106="" class="handle-button line-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-axc-c106="" class="handle-button theme-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-axc-c106="" class="handle-button copy-button"><div _ngcontent-axc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-axc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>AscendC::LocalTensor&lt;half&gt; src0Local;</li><li>AscendC::LocalTensor&lt;half&gt; src1Local;</li><li>AscendC::LocalTensor&lt;half&gt; src2Local;</li><li>AscendC::LocalTensor&lt;half&gt; dst0Local;</li><li>AscendC::LocalTensor&lt;half&gt; dst1Local;</li><li>
</li><li>AscendC::<span class="hljs-built_in">Add</span>(dst0Local, src0Local, src1Local, <span class="hljs-number">512</span>);</li><li>AscendC::<span class="hljs-built_in">PipeBarrier</span>&lt;PIPE_V&gt;();</li><li>AscendC::<span class="hljs-built_in">Mul</span>(dst1Local, dst0Local, src2Local, <span class="hljs-number">512</span>);</li></ol></pre></div></div> </div> </div> <div></div></div>