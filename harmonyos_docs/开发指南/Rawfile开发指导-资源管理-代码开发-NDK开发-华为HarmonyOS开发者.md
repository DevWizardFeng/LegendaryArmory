<h1 _ngcontent-nqx-c119="" class="doc-title ng-star-inserted" title="Rawfile开发指导"> Rawfile开发指导 </h1>

<div _ngcontent-nqx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>开发者可以通过本指导了解在HarmonyOS应用中，如何使用Native Rawfile接口操作Rawfile目录和文件。功能包括文件列表遍历、文件打开、搜索、读取和关闭Rawfile。</p>     <p>64后缀相关接口属于新增接口，新接口支持打开更大的rawfile文件(超过2G建议使用)，具体请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-rawfile" target="_blank">Rawfile接口介绍</a>。64相关的开发步骤和非64一致，将非64接口替换为64接口即可，例如：OH_ResourceManager_OpenRawFile替换为OH_ResourceManager_OpenRawFile64。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">NativeResourceManager *OH_ResourceManager_InitNativeResourceManager(napi_env env, napi_value jsResMgr)</td>         <td class="cellrowborder" valign="top" width="50%">初始化native resource manager。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">RawDir *OH_ResourceManager_OpenRawDir(const NativeResourceManager *mgr, const char *dirName)</td>         <td class="cellrowborder" valign="top" width="50%">打开指定rawfile目录。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_ResourceManager_GetRawFileCount(RawDir *rawDir)</td>         <td class="cellrowborder" valign="top" width="50%">获取指定rawfile目录下的rawfile文件数量。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">const char *OH_ResourceManager_GetRawFileName(RawDir *rawDir, int index)</td>         <td class="cellrowborder" valign="top" width="50%">获取rawfile名字。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">RawFile *OH_ResourceManager_OpenRawFile(const NativeResourceManager *mgr, const char *fileName)</td>         <td class="cellrowborder" valign="top" width="50%">打开指定rawfile文件。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">long OH_ResourceManager_GetRawFileSize(RawFile *rawFile)</td>         <td class="cellrowborder" valign="top" width="50%">获取rawfile文件大小。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_ResourceManager_ReadRawFile(const RawFile *rawFile, void *buf, size_t length)</td>         <td class="cellrowborder" valign="top" width="50%">读取rawfile文件内容。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_ResourceManager_CloseRawFile(RawFile *rawFile)</td>         <td class="cellrowborder" valign="top" width="50%">释放rawfile文件相关资源。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_ResourceManager_CloseRawDir(RawDir *rawDir)</td>         <td class="cellrowborder" valign="top" width="50%">释放rawfile目录相关资源。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">bool OH_ResourceManager_GetRawFileDescriptor(const RawFile *rawFile, RawFileDescriptor &amp;descriptor)</td>         <td class="cellrowborder" valign="top" width="50%">获取rawfile的fd。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_ResourceManager_ReleaseNativeResourceManager(NativeResourceManager *resMgr)</td>         <td class="cellrowborder" valign="top" width="50%">释放native resource manager相关资源。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">bool OH_ResourceManager_IsRawDir(const NativeResourceManager *mgr, const char *path)</td>         <td class="cellrowborder" valign="top" width="50%">判断路径是否是rawfile下的目录。</td>        </tr>             </tbody></table></div>     </div>     <p>详细的接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-rawfile" target="_blank">rawfile</a>。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>以ArkTS侧获取rawfile文件列表、获取rawfile文件内容、获取rawfile描述符（fd, offset, length）、判断是否是rawfile下的目录四种调用方式为例。</p>     <p><strong>1. 创建工程</strong></p>     <p><span><img originheight="658" originwidth="983" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114336.57921759006587224379233496717252:50001231000000:2800:0D7BA0E4BED261BB8C6E0FC10975E8DE4C2AE1D1A7891EB7BBAA669966FCF972.png" width="920" height="615.8290946083418"></span></p>     <p><strong>2. 添加依赖</strong></p>     <p>创建完成后，DevEco Studio会在工程生成cpp目录，目录下有libentry/index.d.ts、hello.cpp、CMakeLists.txt等文件。</p>     <ol>      <li>       <p>打开src/main/cpp/CMakeLists.txt，在target_link_libraries依赖中添加rawfile依赖librawfile.z.so以及日志依赖libhilog_ndk.z.so。</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so librawfile.z.so)</li></ol></pre></div></div></li>      <li>       <p>打开src/main/cpp/types/libentry/index.d.ts文件，在此文件中声明ArkTS侧接口getFileList、getRawFileContent、getRawFileDescriptor、isRawDir。</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> resourceManager <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.resourceManager'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getFileList</span>: <span class="hljs-function">(<span class="hljs-params">resmgr: resourceManager.ResourceManager, path: string</span>) =&gt;</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">String</span>&gt;;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getRawFileContent</span>: <span class="hljs-function">(<span class="hljs-params">resmgr: resourceManager.ResourceManager, path: string</span>) =&gt;</span> <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getRawFileDescriptor</span>: <span class="hljs-function">(<span class="hljs-params">resmgr: resourceManager.ResourceManager, path: string</span>) =&gt;</span> resourceManager.<span class="hljs-property">RawFileDescriptor</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isRawDir</span>: <span class="hljs-function">(<span class="hljs-params">resmgr: resourceManager.ResourceManager, path: string</span>) =&gt;</span> boolean;</li></ol></pre></div></div></li>     </ol>     <p><strong>3. 修改源文件</strong></p>     <ol>      <li>       <p>打开src/main/cpp/hello.cpp文件，在Init方法中添加ArkTS接口与C++接口的映射。ArkTS侧接口getFileList、getRawFileContent、getRawFileDescriptor、isRawDir，映射C++接口分别为GetFileList、GetRawFileContent、GetRawFileDescriptor、IsRawDir。</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"getFileList"</span>, <span class="hljs-literal">nullptr</span>, GetFileList, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>        { <span class="hljs-string">"getRawFileContent"</span>, <span class="hljs-literal">nullptr</span>, GetRawFileContent, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>        { <span class="hljs-string">"getRawFileDescriptor"</span>, <span class="hljs-literal">nullptr</span>, GetRawFileDescriptor, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>        { <span class="hljs-string">"isRawDir"</span>, <span class="hljs-literal">nullptr</span>, IsRawDir, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> }</li><li>    };</li><li>
</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>      <li>       <p>在src/main/cpp/hello.cpp文件中，增加对应的四个方法，如下所示：</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>static napi_value <span class="hljs-built_in">GetFileList</span>(napi_env env, napi_callback_info info)</li><li>static napi_value <span class="hljs-built_in">GetRawFileContent</span>(napi_env env, napi_callback_info info)</li><li>static napi_value <span class="hljs-built_in">GetRawFileDescriptor</span>(napi_env env, napi_callback_info info)</li><li>static napi_value <span class="hljs-built_in">IsRawDir</span>(napi_env env, napi_callback_info info)</li></ol></pre></div></div></li>      <li>       <p>在hello.cpp文件中实现上述四个方法。通过env和info获取Js的资源管理对象，并转换为Native的资源管理对象，即可调用Native资源管理对象的接口，示例代码如下：</p>       <p>导入头文件</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api_types.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;vector&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rawfile/raw_file_manager.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rawfile/raw_file.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"rawfile/raw_dir.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li></ol></pre></div></div>       <p>声明hilog日志打印的DOMAIN和TAG常量</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">const</span> <span class="hljs-type">int</span> GLOBAL_RESMGR = <span class="hljs-number">0xFF00</span>;</li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *TAG = <span class="hljs-string">"[Sample_rawfile]"</span>;</li></ol></pre></div></div>       <p>示例：</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例一：获取rawfile文件列表 GetFileList</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">GetFileList</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_callback_info</span> <span class="hljs-variable">info</span>)</li><li>{</li><li>    <span class="hljs-title function_">OH_LOG_Print</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-variable">LOG_INFO</span>, <span class="hljs-variable">GLOBAL_RESMGR</span>, <span class="hljs-variable">TAG</span>, <span class="hljs-string">"NDKTest GetFileList Begin"</span>);</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">argc</span> = <span class="hljs-number">2</span>;</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">argv</span>[<span class="hljs-number">2</span>] = { <span class="hljs-variable">nullptr</span> };</li><li>    <span class="hljs-comment">// 获取参数信息</span></li><li>    <span class="hljs-title function_">napi_get_cb_info</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">info</span>, &amp;<span class="hljs-title class_">argc</span>, <span class="hljs-variable">argv</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// argv[0]即为函数第一个参数Js资源对象，OH_ResourceManager_InitNativeResourceManager转为Native对象</span></li><li>    <span class="hljs-variable">NativeResourceManager</span> *<span class="hljs-variable">mNativeResMgr</span> = <span class="hljs-title function_">OH_ResourceManager_InitNativeResourceManager</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">argv</span>[<span class="hljs-number">0</span>]);</li><li>
</li><li>    <span class="hljs-comment">// 获取函数argv[1]，此为rawfile相对路径</span></li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">strSize</span>;</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">strBuf</span>[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-title function_">napi_get_value_string_utf8</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">argv</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">strBuf</span>, <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">strBuf</span>), &amp;<span class="hljs-title class_">strSize</span>);</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">dirName</span>(<span class="hljs-title class_">strBuf</span>, <span class="hljs-title class_">strSize</span>);</li><li>
</li><li>    <span class="hljs-comment">// 获取对应的rawDir指针对象</span></li><li>    <span class="hljs-variable">RawDir</span>* <span class="hljs-variable">rawDir</span> = <span class="hljs-title function_">OH_ResourceManager_OpenRawDir</span>(<span class="hljs-variable">mNativeResMgr</span>, <span class="hljs-variable">dirName</span>.<span class="hljs-title function_">c_str</span>());</li><li>
</li><li>    <span class="hljs-comment">// 获取rawDir下文件及文件夹数量</span></li><li>    <span class="hljs-variable">int</span> <span class="hljs-variable">count</span> = <span class="hljs-title function_">OH_ResourceManager_GetRawFileCount</span>(<span class="hljs-variable">rawDir</span>);</li><li>
</li><li>    <span class="hljs-comment">// 遍历获取文件名称，并保存</span></li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>&gt; <span class="hljs-title class_">tempArray</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">int</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">count</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> <span class="hljs-title class_">filename</span> = <span class="hljs-title function_">OH_ResourceManager_GetRawFileName</span>(<span class="hljs-variable">rawDir</span>, <span class="hljs-variable">i</span>);</li><li>        <span class="hljs-variable">tempArray</span>.<span class="hljs-title function_">emplace_back</span>(<span class="hljs-variable">filename</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 转为js数组</span></li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">fileList</span>;</li><li>    <span class="hljs-title function_">napi_create_array</span>(<span class="hljs-variable">env</span>, &amp;<span class="hljs-title class_">fileList</span>);</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">size_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-title class_">tempArray</span>.<span class="hljs-title class_">size</span>(); <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">napi_value</span> <span class="hljs-variable">jsString</span>;</li><li>        <span class="hljs-title function_">napi_create_string_utf8</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">tempArray</span>[<span class="hljs-variable">i</span>].<span class="hljs-title function_">c_str</span>(), <span class="hljs-variable">NAPI_AUTO_LENGTH</span>, &amp;<span class="hljs-title class_">jsString</span>);</li><li>        <span class="hljs-title function_">napi_set_element</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">fileList</span>, <span class="hljs-variable">i</span>, <span class="hljs-variable">jsString</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 关闭打开的指针对象</span></li><li>    <span class="hljs-title function_">OH_ResourceManager_CloseRawDir</span>(<span class="hljs-variable">rawDir</span>);</li><li>    <span class="hljs-title function_">OH_ResourceManager_ReleaseNativeResourceManager</span>(<span class="hljs-variable">mNativeResMgr</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">fileList</span>;</li><li>}</li></ol></pre></div></div>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例二：获取rawfile文件内容 GetRawFileContent</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">CreateJsArrayValue</span><span class="hljs-params">(napi_env env, std::unique_ptr&lt;<span class="hljs-type">uint8_t</span>[]&gt; &amp;data, <span class="hljs-type">long</span> length)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建js外部ArrayBuffer</span></li><li>    napi_value buffer;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_external_arraybuffer</span>(env, data.<span class="hljs-built_in">get</span>(), length,</li><li>        [](napi_env env, <span class="hljs-type">void</span> *data, <span class="hljs-type">void</span> *hint) {</li><li>            <span class="hljs-keyword">delete</span>[] <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">char</span>*&gt;(data);</li><li>        }, <span class="hljs-literal">nullptr</span>, &amp;buffer);</li><li>    <span class="hljs-comment">// 检测ArrayBuffer是否创建成功</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, GLOBAL_RESMGR, TAG, <span class="hljs-string">"Failed to create external array buffer"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 创建js TypedArray  将ArrayBuffer绑定到TypedArray</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_create_typedarray</span>(env, napi_uint8_array, length, buffer, <span class="hljs-number">0</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, GLOBAL_RESMGR, TAG, <span class="hljs-string">"Failed to create media typed array"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    data.<span class="hljs-built_in">release</span>();</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetRawFileContent</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"GetFileContent Begin"</span>);</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-comment">// 获取参数信息</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// argv[0]即为函数第一个参数Js资源对象，OH_ResourceManager_InitNativeResourceManager转为Native对象</span></li><li>    NativeResourceManager *mNativeResMgr = <span class="hljs-built_in">OH_ResourceManager_InitNativeResourceManager</span>(env, argv[<span class="hljs-number">0</span>]);</li><li>    <span class="hljs-type">size_t</span> strSize;</li><li>    <span class="hljs-type">char</span> strBuf[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, argv[<span class="hljs-number">1</span>], strBuf, <span class="hljs-built_in">sizeof</span>(strBuf), &amp;strSize);</li><li>    <span class="hljs-function">std::string <span class="hljs-title">filename</span><span class="hljs-params">(strBuf, strSize)</span></span>;</li><li>
</li><li>    <span class="hljs-comment">// 获取rawfile指针对象</span></li><li>    RawFile *rawFile = <span class="hljs-built_in">OH_ResourceManager_OpenRawFile</span>(mNativeResMgr, filename.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-keyword">if</span> (rawFile != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"OH_ResourceManager_OpenRawFile success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 获取rawfile大小并申请内存</span></li><li>    <span class="hljs-type">long</span> len = <span class="hljs-built_in">OH_ResourceManager_GetRawFileSize</span>(rawFile);</li><li>    std::unique_ptr&lt;<span class="hljs-type">uint8_t</span>[]&gt; data = std::<span class="hljs-built_in">make_unique</span>&lt;<span class="hljs-type">uint8_t</span>[]&gt;(len);</li><li>
</li><li>    <span class="hljs-comment">// 一次性读取rawfile全部内容</span></li><li>    <span class="hljs-type">int</span> res = <span class="hljs-built_in">OH_ResourceManager_ReadRawFile</span>(rawFile, data.<span class="hljs-built_in">get</span>(), len);</li><li>
</li><li>    <span class="hljs-comment">// 关闭打开的指针对象</span></li><li>    <span class="hljs-built_in">OH_ResourceManager_CloseRawFile</span>(rawFile);</li><li>    <span class="hljs-built_in">OH_ResourceManager_ReleaseNativeResourceManager</span>(mNativeResMgr);</li><li>    <span class="hljs-comment">// 转为js对象</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">CreateJsArrayValue</span>(env, data, len);</li><li>}</li></ol></pre></div></div>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例三：获取rawfile文件描述符 GetRawFileDescriptor</span></li><li><span class="hljs-comment">// 定义一个函数，将RawFileDescriptor转为js对象</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">createJsFileDescriptor</span><span class="hljs-params">(napi_env env, RawFileDescriptor&amp; descriptor)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建js对象</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_object</span>(env, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 将文件描述符fd存入到result对象中</span></li><li>    napi_value fd;</li><li>    status = <span class="hljs-built_in">napi_create_int32</span>(env, descriptor.fd, &amp;fd);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>    status = <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"fd"</span>, fd);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 将文件偏移量offset存入到result对象中</span></li><li>    napi_value offset;</li><li>    status = <span class="hljs-built_in">napi_create_int64</span>(env, descriptor.start, &amp;offset);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>    status = <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"offset"</span>, offset);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 将文件长度length存入到result对象中</span></li><li>    napi_value length;</li><li>    status = <span class="hljs-built_in">napi_create_int64</span>(env, descriptor.length, &amp;length);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>    status = <span class="hljs-built_in">napi_set_named_property</span>(env, result, <span class="hljs-string">"length"</span>, length);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetRawFileDescriptor</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"NDKTest GetRawFileDescriptor Begin"</span>);</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-comment">// 获取参数信息</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// argv[0]即为函数第一个参数Js资源对象，OH_ResourceManager_InitNativeResourceManager转为Native对象</span></li><li>    NativeResourceManager *mNativeResMgr = <span class="hljs-built_in">OH_ResourceManager_InitNativeResourceManager</span>(env, argv[<span class="hljs-number">0</span>]);</li><li>    <span class="hljs-type">size_t</span> strSize;</li><li>    <span class="hljs-type">char</span> strBuf[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, argv[<span class="hljs-number">1</span>], strBuf, <span class="hljs-built_in">sizeof</span>(strBuf), &amp;strSize);</li><li>    <span class="hljs-function">std::string <span class="hljs-title">filename</span><span class="hljs-params">(strBuf, strSize)</span></span>;</li><li>    <span class="hljs-comment">// 获取rawfile指针对象</span></li><li>    RawFile *rawFile = <span class="hljs-built_in">OH_ResourceManager_OpenRawFile</span>(mNativeResMgr, filename.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-keyword">if</span> (rawFile != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"OH_ResourceManager_OpenRawFile success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 获取rawfile的描述符RawFileDescriptor {fd, offset, length}</span></li><li>    RawFileDescriptor descriptor;</li><li>    <span class="hljs-built_in">OH_ResourceManager_GetRawFileDescriptor</span>(rawFile, descriptor);</li><li>    <span class="hljs-comment">// 关闭打开的指针对象</span></li><li>    <span class="hljs-built_in">OH_ResourceManager_CloseRawFile</span>(rawFile);</li><li>    <span class="hljs-built_in">OH_ResourceManager_ReleaseNativeResourceManager</span>(mNativeResMgr);</li><li>    <span class="hljs-comment">// 转为js对象</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">createJsFileDescriptor</span>(env, descriptor);</li><li>}</li></ol></pre></div></div>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 示例四：判断路径是否是rawfile下的目录 IsRawDir</span></li><li><span class="hljs-function">napi_value <span class="hljs-title">CreateJsBool</span><span class="hljs-params">(napi_env env, <span class="hljs-type">bool</span> &amp;bValue)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value jsValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">napi_get_boolean</span>(env, bValue, &amp;jsValue) != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> jsValue;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsRawDir</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_INFO, GLOBAL_RESMGR, TAG, <span class="hljs-string">"NDKTest IsRawDir Begin"</span>);</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-comment">// 获取参数信息</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// argv[0]即为函数第一个参数Js资源对象，OH_ResourceManager_InitNativeResourceManager转为Native对象</span></li><li>    NativeResourceManager *mNativeResMgr = <span class="hljs-built_in">OH_ResourceManager_InitNativeResourceManager</span>(env, argv[<span class="hljs-number">0</span>]);</li><li>
</li><li>    napi_valuetype fileNameType;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, argv[<span class="hljs-number">1</span>], &amp;fileNameType);</li><li>    <span class="hljs-keyword">if</span> (fileNameType == napi_undefined || fileNameType == napi_null) {</li><li>        <span class="hljs-built_in">OH_LOG_Print</span>(LOG_APP, LOG_ERROR, GLOBAL_RESMGR, TAG, <span class="hljs-string">"NDKTest file name is null"</span>);</li><li>        <span class="hljs-type">bool</span> temp = <span class="hljs-literal">false</span>;</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">CreateJsBool</span>(env, temp);</li><li>    }</li><li>    <span class="hljs-type">size_t</span> strSize;</li><li>    <span class="hljs-type">char</span> strBuf[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, argv[<span class="hljs-number">1</span>], strBuf, <span class="hljs-built_in">sizeof</span>(strBuf), &amp;strSize);</li><li>    <span class="hljs-function">std::string <span class="hljs-title">filename</span><span class="hljs-params">(strBuf, strSize)</span></span>;</li><li>    <span class="hljs-comment">// 判断是否是rawfile下的目录</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-built_in">OH_ResourceManager_IsRawDir</span>(mNativeResMgr, filename.<span class="hljs-built_in">c_str</span>());</li><li>    <span class="hljs-built_in">OH_ResourceManager_ReleaseNativeResourceManager</span>(mNativeResMgr);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">CreateJsBool</span>(env, result);</li><li>}</li></ol></pre></div></div></li>     </ol>     <p><strong>4. ArkTS侧调用</strong></p>     <ol>      <li>       <p>打开src\main\ets\pages\index.ets, 导入"libentry.so"。</p></li>      <li>       <p>资源获取包括获取本应用包资源、应用内跨包资源、跨应用包资源。</p>       <p>通过context.resourceManager获取本应用包resourceManager对象。</p>       <p>通过context.createModuleContext().resourceManager获取应用内跨包resourceManager对象。</p>       <p>Context的更多使用信息请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage">应用上下文Context</a>。</p></li>      <li>       <p>调用src/main/cpp/types/libentry/index.d.ts中声明的接口，如getFileList，传入js的资源管理对象以及rawfile文件夹的相对路径。</p>       <p>获取本应用包资源resourceManager对象的示例如下：</p>       <div _ngcontent-nqx-c106="" class="highlight-div"><div _ngcontent-nqx-c106="" class="highlight-div-header"><div _ngcontent-nqx-c106="" class="highlight-div-header-left"><div _ngcontent-nqx-c106="" class="handle-button expand-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nqx-c106="" class="highlight-div-header-right"><div _ngcontent-nqx-c106="" class="handle-button ai-button"></div><div _ngcontent-nqx-c106="" class="handle-button line-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nqx-c106="" class="handle-button theme-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nqx-c106="" class="handle-button copy-button"><div _ngcontent-nqx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nqx-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>; <span class="hljs-comment">// 导入so</span></li><li>
</li><li>@<span class="hljs-title class_">Entry</span></li><li>@<span class="hljs-title class_">Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  @<span class="hljs-title class_">State</span> <span class="hljs-attr">message</span>: string = <span class="hljs-string">'Hello World'</span>;</li><li>  private resMgr = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-property">resourceManager</span>; <span class="hljs-comment">// 获取本应用包的资源对象</span></li><li>  @<span class="hljs-title class_">State</span> <span class="hljs-attr">rawfileListMsg</span>: string = <span class="hljs-string">'FileList = '</span>;</li><li>  @<span class="hljs-title class_">State</span> <span class="hljs-attr">retMsg</span>: string = <span class="hljs-string">'isRawDir = '</span>;</li><li>  @<span class="hljs-title class_">State</span> <span class="hljs-attr">rawfileContentMsg</span>: string = <span class="hljs-string">'RawFileContent = '</span>;</li><li>  @<span class="hljs-title class_">State</span> <span class="hljs-attr">rawfileDescriptorMsg</span>: string = <span class="hljs-string">'RawFileDescriptor.length = '</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'hello_world'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-comment">// 传入资源管理对象，以及访问的rawfile文件夹名称</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">rawFileList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">String</span>&gt; = testNapi.<span class="hljs-title function_">getFileList</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resMgr</span>, <span class="hljs-string">''</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileListMsg</span> = <span class="hljs-string">'FileList = '</span> + rawFileList;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileListMsg</span>);</li><li>
</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">ret</span>: boolean = testNapi.<span class="hljs-title function_">isRawDir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resMgr</span>, <span class="hljs-string">'subrawfile'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">retMsg</span> = <span class="hljs-string">'isRawDir = '</span> + ret;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">retMsg</span>);</li><li>
</li><li>            <span class="hljs-comment">// 传入资源管理对象，以及访问的rawfile文件夹名称</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">rawfileArray</span>: <span class="hljs-title class_">Uint8Array</span> = testNapi.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resMgr</span>, <span class="hljs-string">'rawfile1.txt'</span>);</li><li>            <span class="hljs-comment">// 将Uint8Array转为字符串</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">textDecoder</span>: util.<span class="hljs-property">TextDecoder</span> = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextDecoder</span>();</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">rawfileContent</span>: string = textDecoder.<span class="hljs-title function_">decodeToString</span>(rawfileArray);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileContentMsg</span> = <span class="hljs-string">'RawFileContent = '</span> + rawfileContent;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileContentMsg</span>);</li><li>
</li><li>            <span class="hljs-comment">// 传入资源管理对象，以及访问的rawfile文件名称</span></li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">rawfileDescriptor</span>: resourceManager.<span class="hljs-property">RawFileDescriptor</span> =</li><li>              testNapi.<span class="hljs-title function_">getRawFileDescriptor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resMgr</span>, <span class="hljs-string">'rawfile1.txt'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileDescriptorMsg</span> = <span class="hljs-string">'RawFileDescriptor.length = '</span> + rawfileDescriptor.<span class="hljs-property">length</span>;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileDescriptorMsg</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileListMsg</span>).<span class="hljs-title function_">id</span>(<span class="hljs-string">'get_file_list'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>);</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">retMsg</span>).<span class="hljs-title function_">id</span>(<span class="hljs-string">'is_raw_dir'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>);</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileContentMsg</span>).<span class="hljs-title function_">id</span>(<span class="hljs-string">'get_raw_file_content'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>);</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">rawfileDescriptorMsg</span>).<span class="hljs-title function_">id</span>(<span class="hljs-string">'get_raw_file_descriptor'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>);</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>