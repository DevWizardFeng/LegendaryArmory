<h1 _ngcontent-xrp-c119="" class="doc-title ng-star-inserted" title="Repeat：可复用的循环渲染"> Repeat：可复用的循环渲染 </h1>

<div _ngcontent-xrp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>Repeat从API version 12开始支持。</p>      <p>本文档仅为开发指南。组件接口规范见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat" target="_blank">Repeat API参数说明</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>Repeat基于数组类型数据来进行循环渲染，一般与容器组件配合使用。</p>     <p>Repeat根据容器组件的<strong>有效加载范围</strong>（屏幕可视区域+预加载区域）加载子组件。当容器滑动/数组改变时，Repeat会根据父容器组件的布局过程重新计算有效加载范围，并管理列表子组件节点的创建与销毁。Repeat通过组件节点更新/复用从而优化性能表现，详细描述见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#节点更新复用能力说明">节点更新/复用能力说明</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Repeat与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-lazyforeach">LazyForEach</a>组件的区别：</p>       <ul>        <li>Repeat直接监听状态变量的变化，而LazyForEach需要开发者实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-lazyforeach#idatasource" target="_blank">IDataSource</a>接口，手动管理子组件内容/索引的修改。</li>        <li>Repeat还增强了节点复用能力，提高了长列表滑动和数据更新的渲染性能。</li>        <li>Repeat增加了渲染模板（template）的能力，在同一个数组中，根据开发者自定义的模板类型（template type）渲染不同的子组件。</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>Repeat必须在滚动类容器组件内使用，仅有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list" target="_blank">List</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitemgroup" target="_blank">ListItemGroup</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-grid" target="_blank">Grid</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-swiper" target="_blank">Swiper</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-waterflow" target="_blank">WaterFlow</a>组件支持Repeat懒加载场景。</p>       <p>循环渲染只允许创建一个子组件，子组件应当是允许包含在容器组件中的子组件。例如：Repeat与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list" target="_blank">List</a>组件配合使用时，子组件必须为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-listitem" target="_blank">ListItem</a>组件。</p></li>      <li>Repeat不支持V1装饰器，混用V1装饰器会导致渲染异常。</li>      <li>Repeat当前不支持动画效果。</li>      <li>滚动容器组件内只能包含一个Repeat。以List为例，不建议同时包含ListItem、ForEach、LazyForEach，不建议同时包含多个Repeat。</li>      <li>当Repeat与自定义组件或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder">@Builder</a>函数混用时，必须将RepeatItem类型整体进行传参，组件才能监听到数据变化。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#repeat与builder混用">Repeat与@Builder混用</a>。</li>     </ul>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>Repeat功能依赖数组属性的动态修改。如果数组对象被密封（sealed）或冻结（frozen），将导致Repeat部分功能失效，因为密封操作会禁止对象扩展属性并锁定现有属性的配置。</p>       <p>常见触发场景：</p>       <p>1）可观察数据的转换：使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makeobserved" target="_blank">makeObserved</a>将普通数组（如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-arkts-collections-array" target="_blank">collections.Array</a>）转换为可观察数据时，某些实现会自动密封数组。</p>       <p>2）主动对象保护：显式调用Object.seal()或Object.freeze()防止数组被修改。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="循环渲染能力说明">循环渲染能力说明<i class="anchor-icon anchor-icon-link" anchorid="循环渲染能力说明" tips="复制节点链接"></i></h2>          <p>Repeat子组件由.each()和.template()属性定义，只允许包含一个子组件。当页面首次渲染时，Repeat根据当前的有效加载范围（屏幕可视区域+预加载区域）按需创建子组件。如下图所示：</p>     <p><span><img originheight="412" originwidth="1000" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114843.97462188585549149436967596273459:50001231000000:2800:A08B8C331EBFC63F43E99209A12281B5EE181E7A6B27F819D49136AA09E7DF76.png" width="920" height="379.04"></span></p>     <p>.each()适用于只需要循环渲染一种子组件的场景。下列示例代码使用Repeat组件进行简单的循环渲染。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在List容器组件中使用Repeat</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span> <span class="hljs-comment">// 推荐使用V2装饰器</span></li><li>struct <span class="hljs-title class_">RepeatExample</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">dataArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []; <span class="hljs-comment">// 数据源</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`data_<span class="hljs-subst">${i}</span>`</span>); <span class="hljs-comment">// 为数组添加一些数据</span></li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">ri: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'each_'</span> + ri.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>.<span class="hljs-property">length</span> }) <span class="hljs-comment">// 打开懒加载，totalCount为期望加载的数据长度</span></li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// 容器组件的预加载区域大小</span></li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'70%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> }) <span class="hljs-comment">// 边框</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示：</p>     <p><span><img originheight="532" originwidth="322" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114843.78644818888793322684353847870609:50001231000000:2800:6CCA26700BE900BC24C643C9F3E5D669FB2F006B0758A1E25608EA4C0326B85B.png" width="322" height="532"></span></p>     <p>Repeat提供渲染模板（template）能力，可以在同一个数据源中渲染多种子组件。每个数据项会根据.templateId()得到template type，从而渲染type对应的.template()中的子组件。</p>     <ul>      <li>.each()等价于template type为空字符串的.template()。</li>      <li>当多个template type相同时（包括template type为空字符串），Repeat仅生效最新定义的.each()或.template()。</li>      <li>如果.templateId()缺省，或templateId()计算得到的template type不存在，则template type取默认值空字符串。</li>      <li>只有相同template type的节点可以互相复用。</li>     </ul>     <p>下列示例代码中使用Repeat组件进行循环渲染，并使用了多个渲染模板。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在List容器组件中使用Repeat</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span> <span class="hljs-comment">// 推荐使用V2装饰器</span></li><li>struct <span class="hljs-title class_">RepeatExampleWithTemplates</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">dataArr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = []; <span class="hljs-comment">// 数据源</span></li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">50</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`data_<span class="hljs-subst">${i}</span>`</span>); <span class="hljs-comment">// 为数组添加一些数据</span></li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">ri: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 默认渲染模板</span></li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'each_'</span> + ri.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgb(161,10,33)'</span>) <span class="hljs-comment">// 文本颜色为红色</span></li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>((<span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(item)) <span class="hljs-comment">// 键值生成函数</span></li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">dataArr</span>.<span class="hljs-property">length</span> }) <span class="hljs-comment">// 打开懒加载，totalCount为期望加载的数据长度</span></li><li>          .<span class="hljs-title function_">templateId</span>((<span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">index</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">string</span> =&gt;</span> { <span class="hljs-comment">// 根据返回值寻找对应的模板子组件进行渲染</span></li><li>            <span class="hljs-keyword">return</span> index &lt;= <span class="hljs-number">4</span> ? <span class="hljs-string">'A'</span> : (index &lt;= <span class="hljs-number">10</span> ? <span class="hljs-string">'B'</span> : <span class="hljs-string">''</span>); <span class="hljs-comment">// 前5个节点模板为A，接下来的5个为B，其余为默认模板</span></li><li>          })</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'A'</span>, <span class="hljs-function">(<span class="hljs-params">ri: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 'A'模板</span></li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'A_'</span> + ri.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgb(23,169,141)'</span>) <span class="hljs-comment">// 文本颜色为绿色</span></li><li>            }</li><li>          }, { <span class="hljs-attr">cachedCount</span>: <span class="hljs-number">3</span> }) <span class="hljs-comment">// 'A'模板的缓存列表容量为3</span></li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'B'</span>, <span class="hljs-function">(<span class="hljs-params">ri: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> { <span class="hljs-comment">// 'B'模板</span></li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'B_'</span> + ri.<span class="hljs-property">item</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'rgb(39,135,217)'</span>) <span class="hljs-comment">// 文本颜色为蓝色</span></li><li>            }</li><li>          }, { <span class="hljs-attr">cachedCount</span>: <span class="hljs-number">4</span> }) <span class="hljs-comment">// 'B'模板的缓存列表容量为4</span></li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>) <span class="hljs-comment">// 容器组件的预加载区域大小</span></li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'70%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> }) <span class="hljs-comment">// 边框</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行后界面如下图所示：</p>     <p><span><img originheight="506" originwidth="316" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114843.42522107405657857797136271925645:50001231000000:2800:DE72F41C34E37C7AE0A9223E2040C64956D10F673EBD0E19210C378625E58C50.png" width="316" height="506"></span></p>    </div>    <div class="tiledSection">     <h2 id="节点更新复用能力说明">节点更新/复用能力说明<i class="anchor-icon anchor-icon-link" anchorid="节点更新复用能力说明" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Repeat子组件的节点操作分为四种：节点创建、节点更新、节点复用、节点销毁。其中，节点更新和节点复用的区别为：</p>       <ul>        <li>节点更新：节点不销毁，状态变量驱动节点属性更新。</li>        <li>节点复用：旧节点不销毁，存储在空闲节点缓存池；需要创建新节点时，直接从缓存池中获取可复用的旧节点，并做相应的节点属性更新。</li>       </ul>      </div></div></div>     <p>当<strong>滚动容器组件滑动/数组改变</strong>时，Repeat将失效的子组件节点（离开有效加载范围）加入空闲节点缓存池中，即断开组件节点与页面组件树的连接但不销毁节点。在需要生成新的组件时，对缓存池里的组件节点进行复用。</p>     <p>Repeat组件默认开启节点复用功能。从API version 18开始，可以通过配置reusable字段选择是否启用复用功能。为了提高渲染性能，建议开发者保持节点复用。代码示例见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#virtualscrolloptions" target="_blank">VirtualScrollOptions</a>。</p>     <p>从API version 18开始，Repeat支持L2缓存自定义组件冻结。详细描述见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-components-freezev2#repeat">缓存池自定义组件冻结</a>。</p>     <p>下面通过典型的<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#滑动场景">滑动场景</a>和<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#数据更新场景">数据更新场景</a>示例来展示Repeat子组件的渲染逻辑。</p>     <p>定义长度为20的数组，数组前5项的template type为aa，渲染浅蓝色组件，其余项为bb，渲染橙色组件。aa缓存池容量为3，bb缓存池容量为4。容器组件的预加载区域大小为2。为了便于理解，在aa和bb缓存池中分别加入一个和两个空闲节点。</p>     <p>首次渲染，列表的节点状态如下图所示（template type在图中简写为ttype）。</p>     <p><span><img originheight="598" originwidth="887" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.20734576933446441925336557405176:50001231000000:2800:E29573D78D744F91C688CB630A093A77B19935B0F47F5230822C825E59EAD83C.png" width="887" height="598"></span></p>    </div>    <div class="tiledSection">     <h3 id="滑动场景" class="firsth2">滑动场景<i class="anchor-icon anchor-icon-link" anchorid="滑动场景" tips="复制节点链接"></i></h3>          <p>将屏幕向下滑动一个节点的距离，Repeat会复用缓存池中的节点。</p>     <p>1）index=10的节点进入有效加载范围，计算出其template type为bb。由于bb缓存池非空，Repeat会从bb缓存池中取出一个空闲节点进行复用，更新其节点属性（数据item和索引index），该子组件中涉及数据item和索引index的其他孙子组件会根据状态管理V2的规则做同步更新。</p>     <p>2）index=0的节点滑出了有效加载范围。当UI主线程空闲时，会检查aa缓存池是否已满，此时aa缓存池未满，将该节点加入到对应的缓存池中。</p>     <p>3）其余节点仍在有效加载范围，均只更新索引index。如果对应template type的缓存池已满，Repeat会在UI主线程空闲时销毁掉多余的节点。</p>     <p><span><img originheight="607" originwidth="885" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.02074750668851138365889704177942:50001231000000:2800:1A62C9A0E7ECBE0D8C814E0078BDB1763111B5528A4AAAC4A796E96FF4CBB135.png" width="885" height="607"></span></p>    </div>    <div class="tiledSection">     <h3 id="数据更新场景">数据更新场景<i class="anchor-icon anchor-icon-link" anchorid="数据更新场景" tips="复制节点链接"></i></h3>          <p>在上一小节的基础上做如下的数组更新操作，删除index=4的节点，修改节点数据07为new。</p>     <p>1）删除index=4的节点后，节点05前移。根据template type的计算规则，新的05节点的template type变为aa，直接复用旧的04节点，更新数据item和索引index，并且将旧的05节点加入bb缓存池。</p>     <p>2）后面的列表节点前移，新进入有效加载区域的节点11会复用bb缓存池中的空闲节点，其他节点均只更新索引index。</p>     <p>3）对于节点数据从07变为new的情况，页面监听到数据源变化将会触发重新渲染。Repeat数据更新触发重新渲染的逻辑是比较当前索引处节点数据item是否变化，以此判断是否进行UI刷新，仅改变键值不改变item的情况不会触发刷新。</p>     <p><span><img originheight="610" originwidth="887" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.39658000522297278464750765891259:50001231000000:2800:11359A04B51B00A00A471B7FBE33DAF771DA4139A424451636563CF27626443E.png" width="887" height="610"></span></p>    </div>    <div class="tiledSection">     <h3 id="节点复用情况查看">节点复用情况查看<i class="anchor-icon anchor-icon-link" anchorid="节点复用情况查看" tips="复制节点链接"></i></h3>          <p>查看节点是否为复用可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deveco-testing" target="_blank">DevEco Testing</a>工具进行查看，进入DevEco Testing工具后，选择实用工具，界面如下：</p>     <p><span><img originheight="1389" originwidth="2559" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.11339695986574219894868897465689:50001231000000:2800:C99CA4C635FF232E6467F0030E72F2291B24B105DBBA36C61B9760A89EC8ECB0.png" width="920" height="499.36694021101994"></span></p>     <p>在实用工具中选择UIViewer，该工具可以获取设备快照、控件树信息及控件节点属性，在右侧的控件树中选择Repeat子节点，右下方的节点属性会显示节点ID等信息，可以通过节点ID是否相同，判断组件复用或者新建的情况。</p>    </div>    <div class="tiledSection">     <h2 id="键值生成函数">键值生成函数<i class="anchor-icon anchor-icon-link" anchorid="键值生成函数" tips="复制节点链接"></i></h2>          <p>Repeat的.key()属性为每个子组件生成一个键值。Repeat通过键值识别数组增加、删除哪些数据以及哪些数据改变了位置（索引）。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>键值（key）与索引（index）的区别：键值是数据项的唯一标识符，Repeat根据键值是否发生变化判断数据项是否更新；索引只标识数据项在数组中的位置。</p>      </div></div></div>     <p>当.key()缺省时，Repeat会生成新的随机键值。当发现有重复key时，Repeat会在已有键值的基础上递归生成新的键值，直到没有重复键值。</p>     <p>键值生成函数.key()的使用限制：</p>     <ul>      <li>即使数组发生变化，开发者也必须保证键值key唯一。</li>      <li>       <p>每次执行.key()函数时，使用相同的数据项作为输入，输出必须是一致的。</p>       <p>为了实现性能最优，建议开发者自定义键值时，键值的生成应与index无关。因为当前item的键值发生变化后，该item就会被销毁，并重新创建新的item来显示当前view。如果定义的键值与index相关，那么与当前item无关的变更（如前面的数据项增加或删除）可能会触发item的销毁和节点创建，造成不必要的刷新。</p></li>      <li>允许在.key()中使用index，但不建议开发者这样做。因为在数据项移动时索引index发生变化的同时key值也会改变，导致Repeat认为数据发生变化，从而触发子组件重新渲染，降低性能表现。</li>      <li>推荐将简单类型数组转换为类对象数组，并添加一个readonly id属性，在构造函数中初始化唯一值。</li>     </ul>     <p>键值生成示例：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ExampleData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span>, n: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">str</span> = s;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span> = n;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">exampleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">ExampleData</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">exampleList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">ExampleData</span>(<span class="hljs-string">`data<span class="hljs-subst">${i}</span>`</span>, i));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">exampleList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;ExampleData&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">str</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> item.<span class="hljs-property">str</span>) <span class="hljs-comment">// UI显示刷新与属性str相关，建议在键值生成函数中设置其为返回值，此处键值生成与index无关</span></li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>在上述示例代码中，使用.key()定义键值生成函数，各子组件的键值为item元素的str属性值。</p>    </div>    <div class="tiledSection">     <h2 id="数据精准懒加载">数据精准懒加载<i class="anchor-icon anchor-icon-link" anchorid="数据精准懒加载" tips="复制节点链接"></i></h2>          <p>当数据源总长度较长，或数据项加载耗时较长时，可使用Repeat数据精准懒加载特性，避免在初始化时加载所有数据。Repeat数据精准懒加载特性从API version 19开始支持。</p>     <p>开发者可以设置.virtualScroll()的totalCount属性值或onTotalCount自定义方法用于计算期望的数据源长度，设置onLazyLoading属性实现数据精准懒加载，实现在节点首次渲染时加载对应的数据。详细说明和注意事项见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-rendering-control-repeat#virtualscrolloptions" target="_blank">VirtualScrollOptions</a>。</p>     <p><strong>示例1</strong></p>     <p>数据源总长度较长，在首次渲染、滑动屏幕、跳转显示区域时，动态加载对应区域内的数据。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatLazyLoading</span> {</li><li>  <span class="hljs-comment">// 假设数据源总长度较长，为1000。初始数组未提供数据。</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-comment">// 初始显示位置为index = 100，数据可通过懒加载自动获取。</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>, <span class="hljs-attr">space</span>: <span class="hljs-number">5</span>, <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">100</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({</li><li>            <span class="hljs-comment">// 期望的数据源总长度为1000。</span></li><li>            <span class="hljs-attr">onTotalCount</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">return</span> <span class="hljs-number">1000</span>; },</li><li>            <span class="hljs-comment">// 实现数据懒加载。</span></li><li>            <span class="hljs-attr">onLazyLoading</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = index.<span class="hljs-title function_">toString</span>(); }</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${obj.index}</span>: Item_<span class="hljs-subst">${obj.item}</span>`</span>)</li><li>              }</li><li>            }</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'80%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>})</li><li>      <span class="hljs-comment">// 显示位置跳转至index = 500，数据可通过懒加载自动获取。</span></li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'ScrollToIndex 500'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">500</span>); })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="579" originwidth="311" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.66607850036071249849834214349034:50001231000000:2800:96E980FEB923DCF847E2A3D3551ED6E158DAB3D0E6BB0B142D276CCD62C6D4F7.gif" width="311" height="579"></span></p>     <p><strong>示例2</strong></p>     <p>数据加载耗时长，在onLazyLoading方法中，首先为数据项创建占位符，再通过异步任务加载数据。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatLazyLoading</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({</li><li>            <span class="hljs-attr">onTotalCount</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">return</span> <span class="hljs-number">100</span>; },</li><li>            <span class="hljs-comment">// 实现数据懒加载。</span></li><li>            <span class="hljs-attr">onLazyLoading</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>              <span class="hljs-comment">// 创建占位符。</span></li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = <span class="hljs-string">''</span>;</li><li>              <span class="hljs-comment">// 模拟高耗时加载过程，通过异步任务加载数据。</span></li><li>              <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = index.<span class="hljs-title function_">toString</span>(); }, <span class="hljs-number">1000</span>);</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${obj.index}</span>: Item_<span class="hljs-subst">${obj.item}</span>`</span>)</li><li>              }</li><li>            }</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>})</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="652" originwidth="311" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.16064871822113171399497678018505:50001231000000:2800:478A2175AD2814FBCEDB11DA7F89A58423E938B32F1EFBF18F1226267F717EA8.gif" width="311" height="652"></span></p>     <p><strong>示例3</strong></p>     <p>使用数据懒加载，并配合设置onTotalCount: () =&gt; { return this.arr.length + 1; }，可实现数据无限懒加载。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>此场景下，开发者需要提供首屏显示所需的初始数据，并建议设置父容器组件cachedCount &gt; 0，否则将会导致渲染异常。</li>        <li>若与Swiper-Loop模式同时使用，停留在index = 0处时，将导致onLazyLoading方法被持续触发，建议避免与Swiper-Loop模式同时使用。</li>        <li>开发者需要关注内存消耗情况，避免因数据持续加载而导致内存过量消耗。</li>       </ul>      </div></div></div>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatLazyLoading</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-comment">// 提供首屏显示所需的初始数据。</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">15</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(i.<span class="hljs-title function_">toString</span>());</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({</li><li>            <span class="hljs-comment">// 数据无限懒加载。</span></li><li>            <span class="hljs-attr">onTotalCount</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span> + <span class="hljs-number">1</span>; },</li><li>            <span class="hljs-attr">onLazyLoading</span>: <span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[index] = index.<span class="hljs-title function_">toString</span>(); }</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${obj.index}</span>: Item_<span class="hljs-subst">${obj.item}</span>`</span>)</li><li>              }</li><li>            }</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>})</li><li>      <span class="hljs-comment">// 建议设置cachedCount &gt; 0。</span></li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">1</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="652" originwidth="311" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.26657483602812643871678078251592:50001231000000:2800:DEB67CEDEBBD23EA6484F0D3574BF2F6D5B97285850B26F44EEC2F743181D7E8.gif" width="311" height="652"></span></p>    </div>    <div class="tiledSection">     <h2 id="拖拽排序">拖拽排序<i class="anchor-icon anchor-icon-link" anchorid="拖拽排序" tips="复制节点链接"></i></h2>          <p>当Repeat在List组件下使用，并且设置了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-drag-sorting#onmove" target="_blank">onMove</a>事件，Repeat每次迭代都生成一个ListItem时，可以使能拖拽排序。Repeat拖拽排序特性从API version 19开始支持。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>         <p>拖拽排序离手后，如果数据位置发生变化，则会触发onMove事件，上报数据移动原始索引号和目标索引号。</p>         <p>在onMove事件中，需要根据上报的起始索引号和目标索引号修改数据源。数据源修改前后，要保持每个数据的键值不变，只是顺序发生变化，才能保证落位动画正常执行。</p></li>        <li>拖拽排序过程中，在离手之前，不允许修改数据源。</li>       </ul>      </div></div></div>     <p>示例代码：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatVirtualScrollOnMove</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`<span class="hljs-subst">${i}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>          <span class="hljs-comment">// 通过设置onMove，使能拖拽排序。</span></li><li>          .<span class="hljs-title function_">onMove</span>(<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">from</span>: <span class="hljs-built_in">number</span>, to: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> temp = <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-keyword">from</span>, <span class="hljs-number">1</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(to, <span class="hljs-number">0</span>, temp[<span class="hljs-number">0</span>]);</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(obj.<span class="hljs-property">item</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">size</span>({<span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'100%'</span>})</li><li>            }.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFFFF'</span>)</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> item;</li><li>          })</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFDCDCDC'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="480" originwidth="230" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.58410721717944664184882360383334:50001231000000:2800:5ED002856A722521CBC66EC53682AA7A1B16F46CEBCB6DB63A8C52423ED925E8.gif" class="notEnlarge" width="230" height="480"></span></p>    </div>    <div class="tiledSection">     <h2 id="前插保持">前插保持<i class="anchor-icon anchor-icon-link" anchorid="前插保持" tips="复制节点链接"></i></h2>          <p>前插保持，即在显示区域之前插入或删除数据后，保持显示区域的子组件位置不变。</p>     <p>从API version 20开始，仅当父容器组件为List且<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-list#maintainvisiblecontentposition12" target="_blank">maintainVisibleContentPosition</a>属性设置为true后，在List显示区域之前插入或删除数据时保持List显示区域子组件位置不变。</p>     <p><strong>示例代码</strong></p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">PreInsertDemo</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">cnt</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">30</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">`Hello <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cnt++}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">`insert #5`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>, <span class="hljs-string">`Hello <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cnt++}</span>`</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">`delete #0`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);</li><li>          })</li><li>      }</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`index: <span class="hljs-subst">${obj.index}</span>  `</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                  .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#70707070'</span>)</li><li>                  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">End</span>)</li><li>                  .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'40%'</span> })</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`item: <span class="hljs-subst">${obj.item}</span>`</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>                  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Start</span>)</li><li>                  .<span class="hljs-title function_">size</span>({ <span class="hljs-attr">height</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">width</span>: <span class="hljs-string">'60%'</span> })</li><li>              }</li><li>            }.<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>            .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFFFFFFF'</span>)</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> item)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">maintainVisibleContentPosition</span>(<span class="hljs-literal">true</span>) <span class="hljs-comment">// 启用前插保持</span></li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#FFDCDCDC'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>示例中，通过点击按钮在显示区域上方插入或删除数据时，显示区域的节点仅index发生改变，对应数据项不变。</p>     <p>运行效果：</p>     <p><span><img originheight="729" originwidth="343" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.88552974380107772219415856983186:50001231000000:2800:0BA1E7B8FCC8FEEC08B2559E4671D6620CCD2D66BA797B0A801D011A3F7FF674.gif" width="343" height="729"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见使用场景">常见使用场景<i class="anchor-icon anchor-icon-link" anchorid="常见使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="数据展示操作" class="firsth2">数据展示&amp;操作<i class="anchor-icon anchor-icon-link" anchorid="数据展示操作" tips="复制节点链接"></i></h3>          <p>下面的代码示例展示了Repeat修改数组的常见操作，包括<strong>插入数据、修改数据、删除数据、交换数据</strong>。点击下拉框选择索引index值，点击相应的按钮即可操作数据项，依次点击两个数据项可以进行交换。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Repeat006Clazz</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = message;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatVirtualScroll2T</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Repeat006Clazz</span>&gt; = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">exchange</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">counter</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">selectOptions</span>: <span class="hljs-title class_">SelectOption</span>[] = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">selectIdx</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'simpleList'</span>)</li><li>  <span class="hljs-title function_">reloadSelectOptions</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectOptions</span> = [];</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span>; ++i) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectOptions</span>.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">value</span>: i.<span class="hljs-title function_">toString</span>() });</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Repeat006Clazz</span>(<span class="hljs-string">`item_<span class="hljs-subst">${i}</span>`</span>));</li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadSelectOptions</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">handleExchange</span>(<span class="hljs-attr">idx</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> { <span class="hljs-comment">// 点击交换子组件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">exchange</span>.<span class="hljs-title function_">push</span>(idx);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">exchange</span>.<span class="hljs-property">length</span> === <span class="hljs-number">2</span>) {</li><li>      <span class="hljs-keyword">let</span> _a = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exchange</span>[<span class="hljs-number">0</span>];</li><li>      <span class="hljs-keyword">let</span> _b = <span class="hljs-variable language_">this</span>.<span class="hljs-property">exchange</span>[<span class="hljs-number">1</span>];</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">temp</span>: <span class="hljs-title class_">Repeat006Clazz</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[_a];</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[_a] = <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[_b];</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[_b] = temp;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">exchange</span> = [];</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'virtualScroll each()&amp;template() 2t'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Select an index and press the button to update data.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>
</li><li>      <span class="hljs-title class_">Select</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectOptions</span>)</li><li>        .<span class="hljs-title function_">selected</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>)</li><li>        .<span class="hljs-title function_">value</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>.<span class="hljs-title function_">toString</span>())</li><li>        .<span class="hljs-title function_">key</span>(<span class="hljs-string">'selectIdx'</span>)</li><li>        .<span class="hljs-title function_">onSelect</span>(<span class="hljs-function">(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span> = index;</li><li>        })</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Add No.'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>, <span class="hljs-number">0</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repeat006Clazz</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.counter++}</span>_add_item`</span>));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadSelectOptions</span>();</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Modify No.'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>, <span class="hljs-number">1</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Repeat006Clazz</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.counter++}</span>_modify_item`</span>));</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Del No.'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectIdx</span>, <span class="hljs-number">1</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadSelectOptions</span>();</li><li>          })</li><li>      }</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'Update array length to 5.'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">5</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">reloadSelectOptions</span>();</li><li>        })</li><li>
</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Click on two items to exchange.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-title class_">Repeat006Clazz</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;Repeat006Clazz&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">`[each] index<span class="hljs-subst">${obj.index}</span>: <span class="hljs-subst">${obj.item.message}</span>`</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>                .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleExchange</span>(obj.<span class="hljs-property">index</span>);</li><li>                })</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: Repeat006Clazz, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> item.<span class="hljs-property">message</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-property">length</span> })</li><li>          .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">(<span class="hljs-params">item: Repeat006Clazz, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> (index % <span class="hljs-number">2</span> === <span class="hljs-number">0</span>) ? <span class="hljs-string">'odd'</span> : <span class="hljs-string">'even'</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'odd'</span>, <span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`[odd] index<span class="hljs-subst">${ri.index}</span>: <span class="hljs-subst">${ri.item.message}</span>`</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleExchange</span>(ri.<span class="hljs-property">index</span>);</li><li>              })</li><li>          }, { <span class="hljs-attr">cachedCount</span>: <span class="hljs-number">3</span> })</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'even'</span>, <span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">`[even] index<span class="hljs-subst">${ri.index}</span>: <span class="hljs-subst">${ri.item.message}</span>`</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">25</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>)</li><li>              .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">handleExchange</span>(ri.<span class="hljs-property">index</span>);</li><li>              })</li><li>          }, { <span class="hljs-attr">cachedCount</span>: <span class="hljs-number">1</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'95%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>该示例代码展示了100项自定义类RepeatClazz的message字符串属性，List组件的cachedCount属性设为2，模板'odd'和'even'的空闲节点缓存池大小分别设为3和1。运行后界面如下图所示：</p>     <p><span><img originheight="442" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.39459368702865957592617828065579:50001231000000:2800:0BF912DC1B06757B122621130B0ECE05953431A84F6E0C347550A500DFAE4E99.gif" width="300" height="442"></span></p>    </div>    <div class="tiledSection">     <h3 id="repeat嵌套">Repeat嵌套<i class="anchor-icon anchor-icon-link" anchorid="repeat嵌套" tips="复制节点链接"></i></h3>          <p>Repeat支持嵌套使用，示例代码如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Repeat嵌套</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatNest</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">outerList</span>: <span class="hljs-built_in">string</span>[] = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">innerList</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">outerList</span>.<span class="hljs-title function_">push</span>(i.<span class="hljs-title function_">toString</span>());</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">innerList</span>.<span class="hljs-title function_">push</span>(i);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Repeat virtualScroll嵌套'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>      <span class="hljs-title class_">List</span>() {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">outerList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">'outerList item: '</span> + obj.<span class="hljs-property">item</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>                <span class="hljs-title class_">List</span>() {</li><li>                  <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">innerList</span>)</li><li>                    .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">subObj</span>) =&gt;</span> {</li><li>                      <span class="hljs-title class_">ListItem</span>() {</li><li>                        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'innerList item: '</span> + subObj.<span class="hljs-property">item</span>)</li><li>                          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>                      }</li><li>                    })</li><li>                    .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-string">'innerList_'</span> + item)</li><li>                    .<span class="hljs-title function_">virtualScroll</span>()</li><li>                }</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>                .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Orange</span>)</li><li>              }</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-string">'30%'</span>)</li><li>              .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>            }</li><li>            .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item</span>) =&gt;</span> <span class="hljs-string">'outerList_'</span> + item)</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'80%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="539" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.68238321961351867799723034050259:50001231000000:2800:72246CC0AAB75DE9AAEA198773C4A4B6419AF051F0E847699A01F3A2524BB1AA.png" width="300" height="539"></span></p>    </div>    <div class="tiledSection">     <h3 id="父容器组件应用场景">父容器组件应用场景<i class="anchor-icon anchor-icon-link" anchorid="父容器组件应用场景" tips="复制节点链接"></i></h3>          <p>本节展示Repeat与滚动容器组件的常见应用场景。</p>     <p><strong>与List组合使用</strong></p>     <p>在List容器组件中使用Repeat，示例代码如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoListItemInfo</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Resource</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, icon: Resource</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">icon</span> = icon;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">DemoList</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">videoList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">DemoListItemInfo</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-comment">// 此处app.media.listItem0、app.media.listItem1、app.media.listItem2仅作示例，请开发者自行替换</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoListItemInfo</span>(<span class="hljs-string">'视频'</span> + i,</li><li>        i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span> ? $r(<span class="hljs-string">'app.media.listItem0'</span>) :</li><li>        i % <span class="hljs-number">3</span> == <span class="hljs-number">1</span> ? $r(<span class="hljs-string">'app.media.listItem1'</span>) : $r(<span class="hljs-string">'app.media.listItem2'</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">itemEnd</span>(<span class="hljs-params">index: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>      .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>.<span class="hljs-title function_">splice</span>(index, <span class="hljs-number">1</span>);</li><li>      })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'List容器组件中包含Repeat组件'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>
</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-title class_">DemoListItemInfo</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;DemoListItemInfo&gt;</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Image</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">icon</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>                  .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>)</li><li>                <span class="hljs-title class_">Text</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">name</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>              }</li><li>            }</li><li>            .<span class="hljs-title function_">swipeAction</span>({</li><li>              <span class="hljs-attr">end</span>: {</li><li>                <span class="hljs-attr">builder</span>: <span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">itemEnd</span>(obj.<span class="hljs-property">index</span>);</li><li>                }</li><li>              }</li><li>            })</li><li>            .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AceTag'</span>, obj.<span class="hljs-property">item</span>.<span class="hljs-property">name</span>);</li><li>            })</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: DemoListItemInfo</span>) =&gt;</span> item.<span class="hljs-property">name</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">2</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">listDirection</span>(<span class="hljs-title class_">Axis</span>.<span class="hljs-property">Vertical</span>)</li><li>      .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-title class_">ListItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">divider</span>({</li><li>        <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">1</span>,</li><li>        <span class="hljs-attr">startMargin</span>: <span class="hljs-number">60</span>,</li><li>        <span class="hljs-attr">endMargin</span>: <span class="hljs-number">60</span>,</li><li>        <span class="hljs-attr">color</span>: <span class="hljs-string">'#ffe9f0f0'</span></li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Row</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除第1项'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">0</span>, <span class="hljs-number">1</span>);</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'删除第5项'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">videoList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">4</span>, <span class="hljs-number">1</span>);</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>右滑并点击按钮，或点击底部按钮，可删除视频卡片：</p>     <p><span><img originheight="688" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114844.85938501390747226470602647921322:50001231000000:2800:2FBC191AF0EAD082ECF378B3C4C988C8D71FE543F54D3AED34F7994932060126.gif" width="320" height="688"></span></p>     <p><strong>与Grid组合使用</strong></p>     <p>在Grid容器组件中使用Repeat，示例如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoGridItemInfo</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">icon</span>: <span class="hljs-title class_">Resource</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, icon: Resource</span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">icon</span> = icon;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">DemoGrid</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">itemList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">DemoGridItemInfo</span>&gt; = [];</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">isRefreshing</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">layoutOptions</span>: <span class="hljs-title class_">GridLayoutOptions</span> = {</li><li>    <span class="hljs-attr">regularSize</span>: [<span class="hljs-number">1</span>, <span class="hljs-number">1</span>],</li><li>    <span class="hljs-attr">irregularIndexes</span>: [<span class="hljs-number">10</span>]</li><li>  };</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">gridScroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>      <span class="hljs-comment">// 此处app.media.gridItem0、app.media.gridItem1、app.media.gridItem2仅作示例，请开发者自行替换</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemList</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoGridItemInfo</span>(<span class="hljs-string">'视频'</span> + i,</li><li>        i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span> ? $r(<span class="hljs-string">'app.media.gridItem0'</span>) :</li><li>        i % <span class="hljs-number">3</span> == <span class="hljs-number">1</span> ? $r(<span class="hljs-string">'app.media.gridItem1'</span>) : $r(<span class="hljs-string">'app.media.gridItem2'</span>)));</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Grid容器组件中包含Repeat组件'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>
</li><li>      <span class="hljs-title class_">Refresh</span>({ <span class="hljs-attr">refreshing</span>: $$this.<span class="hljs-property">isRefreshing</span> }) {</li><li>        <span class="hljs-title class_">Grid</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">gridScroller</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">layoutOptions</span>) {</li><li>          <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-title class_">DemoGridItemInfo</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">itemList</span>)</li><li>            .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;DemoGridItemInfo&gt;</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (obj.<span class="hljs-property">index</span> === <span class="hljs-number">10</span> ) {</li><li>                <span class="hljs-title class_">GridItem</span>() {</li><li>                  <span class="hljs-title class_">Text</span>(<span class="hljs-string">'先前浏览至此，点击刷新'</span>)</li><li>                    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>                }</li><li>                .<span class="hljs-title function_">height</span>(<span class="hljs-number">30</span>)</li><li>                .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>                .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridScroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">0</span>);</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefreshing</span> = <span class="hljs-literal">true</span>;</li><li>                })</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AceTag'</span>, obj.<span class="hljs-property">item</span>.<span class="hljs-property">name</span>);</li><li>                })</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-title class_">GridItem</span>() {</li><li>                  <span class="hljs-title class_">Column</span>() {</li><li>                    <span class="hljs-title class_">Image</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">icon</span>)</li><li>                      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>                      .<span class="hljs-title function_">height</span>(<span class="hljs-number">80</span>)</li><li>                      .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Cover</span>)</li><li>                      .<span class="hljs-title function_">borderRadius</span>({ <span class="hljs-attr">topLeft</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">topRight</span>: <span class="hljs-number">16</span> })</li><li>                    <span class="hljs-title class_">Text</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">name</span>)</li><li>                      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>                      .<span class="hljs-title function_">height</span>(<span class="hljs-number">20</span>)</li><li>                  }</li><li>                }</li><li>                .<span class="hljs-title function_">height</span>(<span class="hljs-number">100</span>)</li><li>                .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">16</span>)</li><li>                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AceTag'</span>, obj.<span class="hljs-property">item</span>.<span class="hljs-property">name</span>);</li><li>                })</li><li>              }</li><li>            })</li><li>            .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: DemoGridItemInfo</span>) =&gt;</span> item.<span class="hljs-property">name</span>)</li><li>            .<span class="hljs-title function_">virtualScroll</span>()</li><li>        }</li><li>        .<span class="hljs-title function_">columnsTemplate</span>(<span class="hljs-string">'repeat(auto-fit, 150)'</span>)</li><li>        .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">4</span>)</li><li>        .<span class="hljs-title function_">rowsGap</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">columnsGap</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">onRefreshing</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemList</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">10</span>, <span class="hljs-number">1</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemList</span>.<span class="hljs-title function_">unshift</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoGridItemInfo</span>(<span class="hljs-string">'refresh'</span>, $r(<span class="hljs-string">'app.media.gridItem0'</span>))); <span class="hljs-comment">// 此处app.media.gridItem0仅作示例，请开发者自行替换</span></li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>            <span class="hljs-comment">// 此处app.media.gridItem0、app.media.gridItem1、app.media.gridItem2仅作示例，请开发者自行替换</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">itemList</span>.<span class="hljs-title function_">unshift</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoGridItemInfo</span>(<span class="hljs-string">'新视频'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>,</li><li>              i % <span class="hljs-number">3</span> == <span class="hljs-number">0</span> ? $r(<span class="hljs-string">'app.media.gridItem0'</span>) :</li><li>              i % <span class="hljs-number">3</span> == <span class="hljs-number">1</span> ? $r(<span class="hljs-string">'app.media.gridItem1'</span>) : $r(<span class="hljs-string">'app.media.gridItem2'</span>)));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">num</span>++;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefreshing</span> = <span class="hljs-literal">false</span>;</li><li>        }, <span class="hljs-number">1000</span>);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AceTag'</span>, <span class="hljs-string">'onRefreshing'</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">refreshOffset</span>(<span class="hljs-number">64</span>)</li><li>      .<span class="hljs-title function_">pullToRefresh</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'85%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'刷新'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">gridScroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-number">0</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isRefreshing</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>下拉屏幕，或点击刷新按钮，或点击“先前浏览至此，点击刷新”，可加载新的视频内容：</p>     <p><span><img originheight="664" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.42779811613188072272333675238578:50001231000000:2800:7CA26076FA8837C0ED267703890771E0A5D41894B47F639057E3DA5222EB392E.gif" width="320" height="664"></span></p>     <p><strong>与Swiper组合使用</strong></p>     <p>在Swiper容器组件中使用Repeat，示例如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">remotePictures</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0001.jpg'</span>, <span class="hljs-comment">// 请填写具体的网络图片地址</span></li><li>  <span class="hljs-string">'https://www.example.com/xxx/0002.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0003.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0004.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0005.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0006.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0007.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0008.jpg'</span>,</li><li>  <span class="hljs-string">'https://www.example.com/xxx/0009.jpg'</span></li><li>];</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DemoSwiperItemInfo</span> {</li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'default'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">id: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span> = id;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">DemoSwiper</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">pics</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">DemoSwiperItemInfo</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">9</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pics</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">DemoSwiperItemInfo</span>(<span class="hljs-string">'pic'</span> + i));</li><li>    }</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">pics</span>[<span class="hljs-number">0</span>].<span class="hljs-property">url</span> = remotePictures[<span class="hljs-number">0</span>];</li><li>    }, <span class="hljs-number">1000</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Swiper容器组件中包含Repeat组件'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>
</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'图片加载中'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">15</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>        <span class="hljs-title class_">Swiper</span>() {</li><li>          <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pics</span>)</li><li>            .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;DemoSwiperItemInfo&gt;</span>) =&gt;</span> {</li><li>              <span class="hljs-title class_">Image</span>(obj.<span class="hljs-property">item</span>.<span class="hljs-property">url</span>)</li><li>                .<span class="hljs-title function_">onAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'AceTag'</span>, obj.<span class="hljs-property">item</span>.<span class="hljs-property">id</span>);</li><li>                })</li><li>            })</li><li>            .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: DemoSwiperItemInfo</span>) =&gt;</span> item.<span class="hljs-property">id</span>)</li><li>            .<span class="hljs-title function_">virtualScroll</span>()</li><li>        }</li><li>        .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">9</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>        .<span class="hljs-title function_">loop</span>(<span class="hljs-literal">false</span>)</li><li>        .<span class="hljs-title function_">indicator</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">index</span>) =&gt;</span> {</li><li>          <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pics</span>[index].<span class="hljs-property">url</span> = remotePictures[index];</li><li>          }, <span class="hljs-number">1000</span>);</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>定时1秒后加载图片，模拟网络延迟：</p>     <p><span><img originheight="656" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.76299547410726836678147356676951:50001231000000:2800:89C6E085C021559077E1517A8E7698AE4DB39AE6378FD7D257F8F4A3F67A6CEF.gif" width="320" height="656"></span></p>    </div>    <div class="tiledSection">     <h2 id="关闭懒加载">关闭懒加载<i class="anchor-icon anchor-icon-link" anchorid="关闭懒加载" tips="复制节点链接"></i></h2>          <p>当关闭Repeat的.virtualScroll()属性时（即省略该属性），Repeat在初始化页面时加载列表中的所有子组件，适合<strong>短数据列表/组件全部加载</strong>的场景。对于<strong>长数据列表（数据长度大于30）</strong>，如果关闭懒加载，Repeat会一次性加载全量子组件，此操作耗时长，不建议使用。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <ul>        <li>渲染模板特性（template）不可用。</li>        <li>不受滚动容器组件的限制，可以在任意场景使用。</li>        <li>支持与V1装饰器混用。</li>        <li>页面刷新取决于键值变化：如果键值相同，即使数据改变，页面也不会刷新。详见<a href="/consumer/cn/doc/harmonyos-guides/arkts-new-rendering-control-repeat#节点更新能力说明">节点更新能力说明</a>。</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="节点更新能力说明" class="firsth2">节点更新能力说明<i class="anchor-icon anchor-icon-link" anchorid="节点更新能力说明" tips="复制节点链接"></i></h3>          <p>（关闭懒加载后）页面首次渲染时，Repeat子组件全部创建。数组发生改变后，Repeat对子组件节点的处理分为以下几个步骤：</p>     <p>首先，遍历旧数组键值。如果新数组中没有该键值，将其加入键值集合deletedKeys。</p>     <p>其次，遍历新数组键值。依次判断以下条件，进行符合条件的操作：</p>     <ol>      <li>若在旧数组中能找到相同键值，直接使用对应的子组件节点，并更新索引index。</li>      <li>若deletedKeys非空，按照先进后出的顺序，更新该集合中的键值所对应的节点。</li>      <li>若deletedKeys为空，则表示没有可以更新的节点，需要创建新节点。</li>     </ol>     <p>最后，如果新数组键值遍历结束后，deletedKeys非空，则销毁集合中的键值所对应的节点。</p>     <p><span><img originheight="431" originwidth="700" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.21192501714840379736522301755542:50001231000000:2800:F5D2A8E91044E0D37A5ED097AD73764C41C91DFF52CFC328443BC4A7C6839697.png" width="700" height="431"></span></p>     <p>以下图中的数组变化为例，图中的item_X表示数据项的键值key。</p>     <p><span><img originheight="301" originwidth="600" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.64088934250421668881772804053827:50001231000000:2800:4FC30510690BF5D2A40E40400645A289E37C11492F04577D0B8E0B32D017ECA5.png" width="600" height="301"></span></p>     <p>根据上述判断逻辑：item_0没有变化，item_1和item_2只更新了索引，item_n1和item_n2分别由item_4和item_3进行节点更新获得，item_n3为新创建的节点。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>Repeat关闭懒加载场景与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-foreach">ForEach</a>组件的区别：</p>       <ul>        <li>针对特定数组更新场景的渲染性能进行了优化</li>        <li>将子组件的内容/索引管理职责转移至框架层面</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="示例">示例<i class="anchor-icon anchor-icon-link" anchorid="示例" tips="复制节点链接"></i></h3>          <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [<span class="hljs-string">'one'</span>, <span class="hljs-string">'two'</span>, <span class="hljs-string">'three'</span>];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'点击修改第3个数组项的值'</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">24</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[<span class="hljs-number">2</span>] = <span class="hljs-string">'new three'</span>;</li><li>          })</li><li>
</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>            .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">obj: RepeatItem&lt;<span class="hljs-built_in">string</span>&gt;</span>)=&gt;</span>{</li><li>              <span class="hljs-title class_">ChildItem</span>({ <span class="hljs-attr">item</span>: obj.<span class="hljs-property">item</span> })</li><li>                .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">top</span>: <span class="hljs-number">20</span>})</li><li>            })</li><li>            .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> item)</li><li>      }</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xF1F3F5</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">ChildItem</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-meta">@Require</span> <span class="hljs-attr">item</span>: <span class="hljs-built_in">string</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">item</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="179" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.42517131725163354715375918690523:50001231000000:2800:18B897F63BB76036EF7EAAF8714ECC5626727DBC8E8466A75CC2B37425B6B76C.gif" width="300" height="179"></span></p>     <p>点击红色字体，第三个数据项发生变化（直接使用旧的组件节点，仅刷新数据）。</p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="屏幕外的列表数据发生变化时保证滚动条位置不变" class="firsth2">屏幕外的列表数据发生变化时，保证滚动条位置不变<i class="anchor-icon anchor-icon-link" anchorid="屏幕外的列表数据发生变化时保证滚动条位置不变" tips="复制节点链接"></i></h3>          <p>以下示例中，屏幕外的数据源变化将影响屏幕中List列表Scroller停留的位置：</p>     <p>在List组件中声明Repeat组件，实现key值生成逻辑和each逻辑（如下示例代码），点击按钮“insert”，在屏幕显示的第一个元素前面插入一个元素，屏幕出现向下滚动。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 定义一个类，标记为可观察的</span></li><li><span class="hljs-comment">// 类中自定义一个数组，标记为可追踪的</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArrayHolder</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">arr</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-comment">// constructor，用于初始化数组个数</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">count: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; count; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(i);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatTemplateSingle</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arrayHolder</span>: <span class="hljs-title class_">ArrayHolder</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayHolder</span>(<span class="hljs-number">100</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">totalCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">19</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span> })</li><li>          .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-string">'number'</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'number'</span>, <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(r.<span class="hljs-property">index</span>! + <span class="hljs-string">':'</span> + r.<span class="hljs-property">item</span> + <span class="hljs-string">'Reuse'</span>);</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(r.<span class="hljs-property">index</span>! + <span class="hljs-string">':'</span> + r.<span class="hljs-property">item</span> + <span class="hljs-string">'eachMessage'</span>);</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'30%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`insert totalCount <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.totalCount}</span>`</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 插入元素，元素位置为屏幕显示的前一个元素</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="277" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.65316399933164332931813772051824:50001231000000:2800:EB48494C09625992909237129A2A799DB82036FE95A830EE65B3B337B7EF34AC.gif" width="320" height="277"></span></p>     <p>以下为修正后的示例：</p>     <p>在一些场景中，我们不希望屏幕外的数据源变化影响屏幕中List列表Scroller停留的位置，可以通过List组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list#响应滚动位置">onScrollIndex</a>事件对列表滚动动作进行监听，当列表发生滚动时，获取列表滚动位置。使用Scroller组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll#scrolltoindex" target="_blank">scrollToIndex</a>特性，滑动到指定index位置，实现屏幕外的数据源增加/删除数据时，Scroller停留的位置不变的效果。</p>     <p>示例代码仅对增加数据的情况进行展示。</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ...ArrayHolder的定义和上述demo代码一致</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatTemplateSingle</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arrayHolder</span>: <span class="hljs-title class_">ArrayHolder</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayHolder</span>(<span class="hljs-number">100</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">totalCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">start</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">end</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">5</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">19</span>, <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span> })</li><li>          .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-string">'number'</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'number'</span>, <span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(r.<span class="hljs-property">index</span>! + <span class="hljs-string">':'</span> + r.<span class="hljs-property">item</span> + <span class="hljs-string">'Reuse'</span>)</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">r</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(r.<span class="hljs-property">index</span>! + <span class="hljs-string">':'</span> + r.<span class="hljs-property">item</span> + <span class="hljs-string">'eachMessage'</span>)</li><li>            }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start, end</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> = start;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">end</span> = end;</li><li>      })</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'30%'</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`insert totalCount <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.totalCount}</span>`</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">60</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 插入元素，元素位置为屏幕显示的前一个元素</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">splice</span>(<span class="hljs-number">18</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span>);</li><li>          <span class="hljs-keyword">let</span> rect = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">getItemRect</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span>); <span class="hljs-comment">// 获取子组件的大小位置</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollToIndex</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">start</span> + <span class="hljs-number">1</span>); <span class="hljs-comment">// 滑动到指定index</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span>.<span class="hljs-title function_">scrollBy</span>(<span class="hljs-number">0</span>, -rect.<span class="hljs-property">y</span>); <span class="hljs-comment">// 滑动指定距离</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalCount</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">arrayHolder</span>.<span class="hljs-property">arr</span>.<span class="hljs-property">length</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">5</span> })</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>运行效果：</p>     <p><span><img originheight="279" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.94560831649163735872255976114743:50001231000000:2800:9A2FE0DC25040F82C1B31AD7E5A98651AE93A702C59404E70D3E5369885C7C7C.gif" width="320" height="279"></span></p>    </div>    <div class="tiledSection">     <h3 id="totalcount值大于数据源长度">totalCount值大于数据源长度<i class="anchor-icon anchor-icon-link" anchorid="totalcount值大于数据源长度" tips="复制节点链接"></i></h3>          <p>当数据源总长度很大时，会使用懒加载的方式先加载一部分数据，为了使Repeat显示正确的滚动条样式，需要将数据总长度赋值给totalCount，即数据源全部加载完成前，totalCount大于array.length。</p>     <p>totalCount &gt; array.length时，在父组件容器滚动过程中，应用需要保证列表即将滑动到数据源末尾时请求后续数据，开发者需要对数据请求的错误场景（如网络延迟）进行保护操作，直到数据源全部加载完成，否则列表滑动的过程中会出现滚动效果异常。</p>     <p>上述规范可以通过实现父组件List/Grid的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-create-list#响应滚动位置">onScrollIndex</a>属性的回调函数完成。示例代码如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleData</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">price</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, price: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">price</span> = price;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">VehicleDB</span> {</li><li>  <span class="hljs-keyword">public</span> <span class="hljs-attr">vehicleItems</span>: <span class="hljs-title class_">VehicleData</span>[] = [];</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 数组初始化大小 20</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">20</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VehicleData</span>(<span class="hljs-string">`Vehicle<span class="hljs-subst">${i}</span>`</span>, i));</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">EntryCompSucc</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">vehicleItems</span>: <span class="hljs-title class_">VehicleData</span>[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">VehicleDB</span>().<span class="hljs-property">vehicleItems</span>;</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">listChildrenSize</span>: <span class="hljs-title class_">ChildrenMainSize</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ChildrenMainSize</span>(<span class="hljs-number">60</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">totalCount</span>: <span class="hljs-built_in">number</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>.<span class="hljs-property">length</span>;</li><li>  <span class="hljs-attr">scroller</span>: <span class="hljs-title class_">Scroller</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Scroller</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">3</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">scroller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scroller</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>)</li><li>          .<span class="hljs-title function_">virtualScroll</span>({ <span class="hljs-attr">totalCount</span>: <span class="hljs-number">50</span> }) <span class="hljs-comment">// 数组预期长度 50</span></li><li>          .<span class="hljs-title function_">templateId</span>(<span class="hljs-function">() =&gt;</span> <span class="hljs-string">'default'</span>)</li><li>          .<span class="hljs-title function_">template</span>(<span class="hljs-string">'default'</span>, <span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>() {</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${ri.item.name}</span> + <span class="hljs-subst">${ri.index}</span>`</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-property">childDefaultSize</span>)</li><li>                  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFA07A</span>)</li><li>                  .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>                  .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>              }</li><li>            }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>          }, { <span class="hljs-attr">cachedCount</span>: <span class="hljs-number">5</span> })</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Wrong: '</span> + <span class="hljs-string">`<span class="hljs-subst">${ri.item.name}</span> + <span class="hljs-subst">${ri.index}</span>`</span>)</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>                .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>.<span class="hljs-property">childDefaultSize</span>)</li><li>                .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xFFA07A</span>)</li><li>                .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>                .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>            }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>          })</li><li>          .<span class="hljs-title function_">key</span>(<span class="hljs-function">(<span class="hljs-params">item, index</span>) =&gt;</span> <span class="hljs-string">`<span class="hljs-subst">${index}</span>:<span class="hljs-subst">${item}</span>`</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'50%'</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">childrenMainSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">listChildrenSize</span>)</li><li>      .<span class="hljs-title function_">alignListItem</span>(<span class="hljs-title class_">ListItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">onScrollIndex</span>(<span class="hljs-function">(<span class="hljs-params">start, end</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onScrollIndex'</span>, start, end);</li><li>        <span class="hljs-comment">// 数据懒加载</span></li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">50</span>) {</li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">10</span>; i++) {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">50</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">vehicleItems</span>.<span class="hljs-title function_">push</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">VehicleData</span>(<span class="hljs-string">'Vehicle_loaded'</span>, i));</li><li>            }</li><li>          }</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>示例代码运行效果：</p>     <p><span><img originheight="419" originwidth="400" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.28873738889754566894617852442268:50001231000000:2800:F289EE4C673A6C256C7F1CFBCE16098D7C79092D27671D44F18FE82BEF9F5C04.gif" width="400" height="419"></span></p>    </div>    <div class="tiledSection">     <h3 id="repeat与builder混用">Repeat与@Builder混用<i class="anchor-icon anchor-icon-link" anchorid="repeat与builder混用" tips="复制节点链接"></i></h3>          <p>当Repeat与@Builder混用时，如果只传递RepeatItem.item或RepeatItem.index，参数值的改变不会引起@Builder函数内的UI刷新。推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-builder#按引用传递参数">按引用传递</a>，即将RepeatItem类型整体进行传参，组件才能监听到数据变化。除此之外，从API version 20开始，开发者可以通过使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#makebinding20" target="_blank">UIUtils.makeBinding()</a>函数、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#bindingt20" target="_blank">Binding类</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#mutablebindingt20" target="_blank">MutableBinding类</a>实现@Builder函数中状态变量的刷新。</p>     <p>示例代码如下：</p>     <div _ngcontent-xrp-c106="" class="highlight-div"><div _ngcontent-xrp-c106="" class="highlight-div-header"><div _ngcontent-xrp-c106="" class="highlight-div-header-left"><div _ngcontent-xrp-c106="" class="handle-button expand-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xrp-c106="" class="highlight-div-header-right"><div _ngcontent-xrp-c106="" class="handle-button ai-button"></div><div _ngcontent-xrp-c106="" class="handle-button line-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xrp-c106="" class="handle-button theme-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xrp-c106="" class="handle-button copy-button"><div _ngcontent-xrp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xrp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span>, <span class="hljs-title class_">Binding</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">RepeatBuilderPage</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">simpleList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">100</span>; i++) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>.<span class="hljs-title function_">push</span>(i);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">buildItem1</span>(<span class="hljs-params">bindingData: Binding&lt;<span class="hljs-built_in">number</span>&gt;</span>) { <span class="hljs-comment">// 使用Binding类/MutableBinding类接收传参，通过value属性访问值。</span></li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'[Binding] item: '</span> + bindingData.<span class="hljs-property">value</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">buildItem2</span>(<span class="hljs-params">ri: RepeatItem&lt;<span class="hljs-built_in">number</span>&gt;</span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'[RepeatItem] item: '</span> + ri.<span class="hljs-property">item</span>)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title function_">buildItem3</span>(<span class="hljs-params">data: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">'[number] item: '</span> + data)</li><li>      .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>        <span class="hljs-title class_">Repeat</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>)</li><li>          .<span class="hljs-title function_">each</span>(<span class="hljs-function">(<span class="hljs-params">ri</span>) =&gt;</span> {</li><li>            <span class="hljs-title class_">ListItem</span>() {</li><li>              <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">2</span> }) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildItem1</span>(<span class="hljs-title class_">UIUtils</span>.<span class="hljs-property">makeBinding</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-function">() =&gt;</span> ri.<span class="hljs-property">item</span>)) <span class="hljs-comment">// 使用UIUtils.makeBinding()函数实现@Builder函数中状态变量的刷新。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildItem2</span>(ri) <span class="hljs-comment">// 按引用传递，状态变量的改变会引起@Builder函数内的UI刷新。</span></li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">buildItem3</span>(ri.<span class="hljs-property">item</span>) <span class="hljs-comment">// 反例。按值传递，状态变量的改变不会引起@Builder函数内的UI刷新。</span></li><li>              }</li><li>            }.<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>          }).<span class="hljs-title function_">virtualScroll</span>()</li><li>      }</li><li>      .<span class="hljs-title function_">cachedCount</span>(<span class="hljs-number">1</span>).<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'70%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'60%'</span>).<span class="hljs-title function_">alignListItem</span>(<span class="hljs-title class_">ListItemAlign</span>.<span class="hljs-property">Center</span>)</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'click to change data.'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">simpleList</span>[<span class="hljs-number">0</span>] = <span class="hljs-number">10000</span>; <span class="hljs-comment">// 修改第一项数据为10000。</span></li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>@Builder传参方式依次为makeBinding()、地址传递和值传递，界面展示如下图，进入页面后点击按钮改变数据。在@Builder构造函数中使用值传递传参不会引起函数内的UI刷新。</p>     <p><span><img originheight="494" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114845.66583170672246173072540898069341:50001231000000:2800:2519BC351A55A33138329C48D057978085FECCC1363810B6FE26DC8848661802.png" width="300" height="494"></span></p>    </div>    <div class="tiledSection">     <h3 id="repeat子组件声明expandsafearea属性时子组件无法扩展到全屏">Repeat子组件声明expandSafeArea属性时，子组件无法扩展到全屏<i class="anchor-icon anchor-icon-link" anchorid="repeat子组件声明expandsafearea属性时子组件无法扩展到全屏" tips="复制节点链接"></i></h3>          <p>在API version 18之前，Repeat子组件声明expandSafeArea属性，子组件无法扩展至全屏；从API version 18开始，子组件声明expandSafeArea属性可正常扩展至全屏展示。</p>    </div>   </div>   <div></div></div>