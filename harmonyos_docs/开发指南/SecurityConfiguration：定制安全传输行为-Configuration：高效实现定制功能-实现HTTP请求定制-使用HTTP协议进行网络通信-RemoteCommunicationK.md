<h1 _ngcontent-lev-c119="" class="doc-title ng-star-inserted" title="SecurityConfiguration：定制安全传输行为"> SecurityConfiguration：定制安全传输行为 </h1>

<div _ngcontent-lev-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section95791836151611">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section95791836151611" tips="复制节点链接"></i></h2>          <div class="p">      在软件开发中，安全是非常重要的一环。Remote Communication Kit提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/remote-communication-rcp#section1597118916425" target="_blank">SecurityConfiguration</a>是一个用于定制安全传输行为的工具，能够帮助开发者更好地保护其应用程序。通过合理的配置和使用，可以显著降低应用程序遭受攻击的风险。下面将详细说明如何使用证书校验来增强安全性。       <div class="tablenoborder">       <div class="tbBox"><table class="layoutFixed idpTab">        <caption>         <b>表1 </b>        </caption>        <thead>         <tr>          <th align="left" class="cellrowborder" id="mcps1.3.1.2.2.2.6.1.1" valign="top">           <p>证书校验方式</p></th>          <th align="left" class="cellrowborder" colspan="4" id="mcps1.3.1.2.2.2.6.1.2" valign="top">           <p>可以配置的参数</p></th>         </tr>        </thead>                 <tbody><tr>          <td class="cellrowborder" valign="top" width="20%">           <p>remoteValidation（客户端校验服务端证书）</p></td>          <td class="cellrowborder" valign="top" width="20%">           <p>'system'：使用系统默认证书。</p></td>          <td class="cellrowborder" valign="top" width="20%">           <p>'skip'：跳过证书校验。</p></td>          <td class="cellrowborder" valign="top" width="20%">           <p>CertificateAuthority：通过content指定证书内容，通过filePath指定证书路径，通过folderPath指定证书目录。</p></td>          <td class="cellrowborder" valign="top" width="20%">           <p>ValidationCallback：自定义证书。</p></td>         </tr>         <tr>          <td class="cellrowborder" valign="top">           <p>certificate（服务端校验客户端证书）</p></td>          <td class="cellrowborder" colspan="4" valign="top">           <p>ClientCertificate（客户端证书校验）：通过content指定证书内容，通过filePath指定证书路径，通过type指定证书类型，通过key和keyPassword指定证书的私钥和私钥密码。</p></td>         </tr>               </tbody></table></div>      </div>     </div>    </div>    <div class="tiledSection">     <h2 id="section15385135185019">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section15385135185019" tips="复制节点链接"></i></h2>          <p>定制安全传输行为能力支持Phone、2in1、Tablet、Wearable设备。并且从5.1.1(19)开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section20406181973210">客户端校验服务端证书<i class="anchor-icon anchor-icon-link" anchorid="section20406181973210" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section10766830174317" class="firsth2">1. 使用系统默认证书<i class="anchor-icon anchor-icon-link" anchorid="section10766830174317" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中配置'system'时，将使用系统中默认的CA。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: <span class="hljs-string">'system'</span>,</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section150918104411">2. 跳过证书校验<i class="anchor-icon anchor-icon-link" anchorid="section150918104411" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中配置'skip'跳过证书校验。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: <span class="hljs-string">'skip'</span>,</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section2599123115442">3. 使用字符串指定证书内容<i class="anchor-icon anchor-icon-link" anchorid="section2599123115442" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中配置content，可以配置string类型证书内容。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PEM_CA</span> = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIICPzCCAcWgAwIBAgIQBVVWvPJepDU1w6QP1atFcjAKBggqhkjOPQQDAzBhMQswCQYDVQQGEwJV\n'</span> +</li><li>  <span class="hljs-string">'UzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMSAwHgYD\n'</span> +</li><li>  <span class="hljs-string">'VQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBHMzAeFw0xMzA4MDExMjAwMDBaFw0zODAxMTUxMjAw\n'</span> +</li><li>  <span class="hljs-string">'MDBaMGExCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5k\n'</span> +</li><li>  <span class="hljs-string">'aWdpY2VydC5jb20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IEczMHYwEAYHKoZIzj0C\n'</span> +</li><li>  <span class="hljs-string">'AQYFK4EEACIDYgAE3afZu4q4C/sLfyHS8L6+c/MzXRq8NOrexpu80JX28MzQC7phW1FGfp4tn+6O\n'</span> +</li><li>  <span class="hljs-string">'YwwX7Adw9c+ELkCDnOg/QW07rdOkFFk2eJ0DQ+4QE2xy3q6Ip6FrtUPOZ9wj/wMco+I+o0IwQDAP\n'</span> +</li><li>  <span class="hljs-string">'BgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBhjAdBgNVHQ4EFgQUs9tIpPmhxdiuNkHMEWNp\n'</span> +</li><li>  <span class="hljs-string">'Yim8S8YwCgYIKoZIzj0EAwMDaAAwZQIxAK288mw/EkrRLTnDCgmXc/SINoyIJ7vmiI1Qhadj+Z4y\n'</span> +</li><li>  <span class="hljs-string">'3maTD/HMsQmP3Wyr+mt/oAIwOWZbwmSNuJ5Q3KjVSaLtx9zRSX8XAbjIho9OjIgrqJqpisXRAL34\n'</span> +</li><li>  <span class="hljs-string">'VOKa5Vt8sycX\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: {</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-variable constant_">PEM_CA</span>,</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section12302144514417">4. 使用二进制指定证书内容<i class="anchor-icon anchor-icon-link" anchorid="section12302144514417" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中配置content，可以配置ArrayBuffer类型证书内容。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">PEM_CA</span> = <span class="hljs-string">'-----BEGIN CERTIFICATE-----\n'</span> +</li><li>  <span class="hljs-string">'MIICPzCCAcWgAwIBAgIQBVVWvPJepDU1w6QP1atFcjAKBggqhkjOPQQDAzBhMQswCQYDVQQGEwJV\n'</span> +</li><li>  <span class="hljs-string">'UzEVMBMGA1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3d3cuZGlnaWNlcnQuY29tMSAwHgYD\n'</span> +</li><li>  <span class="hljs-string">'VQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBHMzAeFw0xMzA4MDExMjAwMDBaFw0zODAxMTUxMjAw\n'</span> +</li><li>  <span class="hljs-string">'MDBaMGExCzAJBgNVBAYTAlVTMRUwEwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3dy5k\n'</span> +</li><li>  <span class="hljs-string">'aWdpY2VydC5jb20xIDAeBgNVBAMTF0RpZ2lDZXJ0IEdsb2JhbCBSb290IEczMHYwEAYHKoZIzj0C\n'</span> +</li><li>  <span class="hljs-string">'AQYFK4EEACIDYgAE3afZu4q4C/sLfyHS8L6+c/MzXRq8NOrexpu80JX28MzQC7phW1FGfp4tn+6O\n'</span> +</li><li>  <span class="hljs-string">'YwwX7Adw9c+ELkCDnOg/QW07rdOkFFk2eJ0DQ+4QE2xy3q6Ip6FrtUPOZ9wj/wMco+I+o0IwQDAP\n'</span> +</li><li>  <span class="hljs-string">'BgNVHRMBAf8EBTADAQH/MA4GA1UdDwEB/wQEAwIBhjAdBgNVHQ4EFgQUs9tIpPmhxdiuNkHMEWNp\n'</span> +</li><li>  <span class="hljs-string">'Yim8S8YwCgYIKoZIzj0EAwMDaAAwZQIxAK288mw/EkrRLTnDCgmXc/SINoyIJ7vmiI1Qhadj+Z4y\n'</span> +</li><li>  <span class="hljs-string">'3maTD/HMsQmP3Wyr+mt/oAIwOWZbwmSNuJ5Q3KjVSaLtx9zRSX8XAbjIho9OjIgrqJqpisXRAL34\n'</span> +</li><li>  <span class="hljs-string">'VOKa5Vt8sycX\n'</span> +</li><li>  <span class="hljs-string">'-----END CERTIFICATE-----'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  <span class="hljs-keyword">const</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-variable constant_">PEM_CA</span>.<span class="hljs-property">length</span>);</li><li>  util.<span class="hljs-property">TextEncoder</span>.<span class="hljs-title function_">create</span>(<span class="hljs-string">'utf-8'</span>).<span class="hljs-title function_">encodeIntoUint8Array</span>(<span class="hljs-variable constant_">PEM_CA</span>, <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer));</li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: {</li><li>        <span class="hljs-attr">content</span>: buffer,</li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section713435718442">5. 使用文件指定证书内容<i class="anchor-icon anchor-icon-link" anchorid="section713435718442" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>准备证书文件。在本例中，假设证书是example.pem，使用OpenSSL命令生成目标文件。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>openssl x509 -subject_hash -<span class="hljs-keyword">in</span> ./example.<span class="hljs-property">pem</span></li></ol></pre></div></div>       <p>命令输出如下。以第一行为目标文件名，以.0为文件扩展名，以其他内容为文件内容，将输出保存为dd8e9d41.0。如果您使用Windows系统，OpenSSL可能会等待用户输入才会退出，按Enter键即可。</p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>dd8e9d41</li><li>-----<span class="hljs-variable constant_">BEGIN</span> <span class="hljs-variable constant_">CERTIFICATE</span>-----</li><li><span class="hljs-title class_">MIICPzCCAcWgAwIBAgIQBVVWvPJepDU</span>1w6QP1atFcjAKBggqhkjOPQQDAzBhMQsw</li><li><span class="hljs-title class_">CQYDVQQGEwJVUzEVMBMGA</span>1UEChMMRGlnaUNlcnQgSW5jMRkwFwYDVQQLExB3d3cu</li><li><span class="hljs-title class_">ZGlnaWNlcnQuY</span>29tMSAwHgYDVQQDExdEaWdpQ2VydCBHbG9iYWwgUm9vdCBHMzAe</li><li><span class="hljs-title class_">Fw0</span>xMzA4MDExMjAwMDBaFw0zODAxMTUxMjAwMDBaMGExCzAJBgNVBAYTAlVTMRUw</li><li><span class="hljs-title class_">EwYDVQQKEwxEaWdpQ2VydCBJbmMxGTAXBgNVBAsTEHd3</span>dy5kaWdpY2VydC5jb20x</li><li><span class="hljs-title class_">IDAeBgNVBAMTF</span>0RpZ2lDZXJ0IEdsb2JhbCBSb290IEczMHYwEAYHKoZIzj0CAQYF</li><li>K4EEACIDYgAE3afZu4q4C/sLfyHS8L6+c/<span class="hljs-title class_">MzXRq8NOrexpu80JX28MzQC7</span>phW1FG</li><li>fp4tn+6OYwwX7Adw9c+<span class="hljs-title class_">ELkCDnOg</span>/<span class="hljs-title class_">QW07</span>rdOkFFk2eJ0DQ+4QE2xy3q6Ip6FrtUPO</li><li>Z9wj/wMco+I+o0IwQDAPBgNVHRMBAf8EBTADAQH/<span class="hljs-title class_">MA4GA</span>1UdDwEB/wQEAwIBhjAd</li><li><span class="hljs-title class_">BgNVHQ4EFgQUs9</span>tIpPmhxdiuNkHMEWNpYim8S8YwCgYIKoZIzj0EAwMDaAAwZQIx</li><li><span class="hljs-title class_">AK288</span>mw/<span class="hljs-title class_">EkrRLTnDCgmXc</span>/<span class="hljs-title class_">SINoyIJ</span>7vmiI1Qhadj+Z4y3maTD/<span class="hljs-title class_">HMsQmP</span>3Wyr+mt/</li><li>oAIwOWZbwmSNuJ5Q3KjVSaLtx9zRSX8XAbjIho9OjIgrqJqpisXRAL34VOKa5Vt8</li><li>sycX</li><li>-----<span class="hljs-variable constant_">END</span> <span class="hljs-variable constant_">CERTIFICATE</span>-----</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中通过filePath指定证书路径。关于文件路径，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file" target="_blank">应用文件</a>。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: {</li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/dd8e9d41.0'</span>, <span class="hljs-comment">// 正式使用时，需替换为证书的沙箱路径。</span></li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1578326124515">6. 使用文件目录指定证书。<i class="anchor-icon anchor-icon-link" anchorid="section1578326124515" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在remoteValidation中配置folderPath指定证书所在的沙箱目录。关于文件路径，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file" target="_blank">应用文件</a>。目录中的证书文件格式和内容请参考示例5中的步骤2。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: {</li><li>        <span class="hljs-attr">folderPath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/'</span>, <span class="hljs-comment">// 正式使用时需替换成证书所在的沙箱目录。</span></li><li>      }</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section11678419194516">7. 自定义证书校验<i class="anchor-icon anchor-icon-link" anchorid="section11678419194516" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li><li><span class="hljs-keyword">import</span> { networkSecurity } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>校验证书的日期是否符合预期。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">makeItTwoChar</span>(<span class="hljs-params">s: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">if</span> (s.<span class="hljs-property">length</span> === <span class="hljs-number">1</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'0'</span> + s;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> s;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getASNDateString</span>(<span class="hljs-params"></span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">const</span> date = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</li><li>  <span class="hljs-keyword">let</span> dateStr = date.<span class="hljs-title function_">getFullYear</span>().<span class="hljs-title function_">toString</span>().<span class="hljs-title function_">slice</span>(<span class="hljs-number">2</span>);</li><li>  dateStr += <span class="hljs-title function_">makeItTwoChar</span>((date.<span class="hljs-title function_">getMonth</span>() + <span class="hljs-number">1</span>).<span class="hljs-title function_">toString</span>());</li><li>  dateStr += <span class="hljs-title function_">makeItTwoChar</span>(date.<span class="hljs-title function_">getDate</span>().<span class="hljs-title function_">toString</span>());</li><li>  dateStr += <span class="hljs-title function_">makeItTwoChar</span>(date.<span class="hljs-title function_">getHours</span>().<span class="hljs-title function_">toString</span>());</li><li>  dateStr += <span class="hljs-title function_">makeItTwoChar</span>(date.<span class="hljs-title function_">getMinutes</span>().<span class="hljs-title function_">toString</span>());</li><li>  dateStr += <span class="hljs-title function_">makeItTwoChar</span>(date.<span class="hljs-title function_">getSeconds</span>().<span class="hljs-title function_">toString</span>());</li><li>  <span class="hljs-keyword">return</span> dateStr + <span class="hljs-string">'Z'</span>;</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>自定义证书校验逻辑。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ValidationRemoteServer</span>(<span class="hljs-params">context: rcp.ValidationContext</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>  <span class="hljs-comment">// 服务器未返回证书，校验失败</span></li><li>  <span class="hljs-keyword">let</span> length = context.<span class="hljs-property">pemCerts</span>.<span class="hljs-property">length</span>;</li><li>  <span class="hljs-keyword">if</span> (length &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();</li><li>  }</li><li>  <span class="hljs-comment">// 此示例中最后一个证书为根证书，开发中请根据实际情况调整</span></li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">firstCaBlob</span>: networkSecurity.<span class="hljs-property">CertBlob</span> = {</li><li>    <span class="hljs-attr">type</span>: networkSecurity.<span class="hljs-property">CertType</span>.<span class="hljs-property">CERT_TYPE_PEM</span>,</li><li>    <span class="hljs-attr">data</span>: context.<span class="hljs-property">pemCerts</span>[length - <span class="hljs-number">1</span>],</li><li>  }</li><li>  <span class="hljs-comment">// 如果 certVerificationSync 的第二个参数未填写，则使用系统默认的 CA（"/etc/security/certificates"）进行验证</span></li><li>  <span class="hljs-keyword">if</span> (networkSecurity.<span class="hljs-title function_">certVerificationSync</span>(firstCaBlob) !== <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();</li><li>  }</li><li>  <span class="hljs-comment">// 此处可以添加所需的校验逻辑，如校验日期</span></li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> x <span class="hljs-keyword">of</span> context.<span class="hljs-property">x509Certs</span>) {</li><li>    <span class="hljs-keyword">let</span> dateStr = <span class="hljs-title function_">getASNDateString</span>();</li><li>    <span class="hljs-keyword">try</span> {</li><li>      x.<span class="hljs-title function_">checkValidityWithDate</span>(dateStr);</li><li>    } <span class="hljs-keyword">catch</span> (e) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">reject</span>();</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 校验成功</span></li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(<span class="hljs-literal">true</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>将定义好的自定义证书校验器配置到configuration中，并利用fetch发起请求。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">remoteValidation</span>: <span class="hljs-title class_">ValidationRemoteServer</span>,</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section1575352154515">服务器校验客户端证书<i class="anchor-icon anchor-icon-link" anchorid="section1575352154515" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section682264017452" class="firsth2">1. PEM证书<i class="anchor-icon anchor-icon-link" anchorid="section682264017452" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>证书及相关数据一般来自于证书颁发机构。为了介绍样例代码，本例中使用OpenSSL颁发自签名证书，开发中请使用实际的证书。使用以下命令生成证书及秘钥。每一步命令的含义是：生成私钥、生成<span style="color: rgb(46,48,51);">证书签名请求文件</span>，生成证书，生成PEM类型证书。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>openssl genrsa -<span class="hljs-keyword">out</span> cert.key <span class="hljs-number">2048</span></li><li>openssl req -<span class="hljs-keyword">new</span> -key cert.key -<span class="hljs-keyword">out</span> cert.csr</li><li>openssl x509 -req -<span class="hljs-keyword">in</span> cert.csr -<span class="hljs-keyword">out</span> cert.crt -signkey cert.key -CAcreateserial -days <span class="hljs-number">3650</span></li><li>openssl x509 -<span class="hljs-keyword">in</span> cert.crt -<span class="hljs-keyword">out</span> cert.pem -outform PEM</li></ol></pre></div></div>       <p></p></li>      <li><span>在certificate中通过filePath指定证书路径（也可以通过content指定证书内容），type配置PEM指定证书类型，key和keyPassword指定证书私钥和密码。关于文件路径，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file" target="_blank">应用文件</a>。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">certificate</span>: {</li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/cert.pem'</span>, <span class="hljs-comment">// 可以使用content字段指定证书内容</span></li><li>        <span class="hljs-attr">type</span>: <span class="hljs-string">'PEM'</span>,</li><li>        <span class="hljs-attr">key</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/cert.key'</span>, <span class="hljs-comment">// 这是证书私钥，在使用中请替换为实际的证书秘钥路径，可选</span></li><li>        <span class="hljs-attr">keyPassword</span>: <span class="hljs-string">'keyPassword'</span>, <span class="hljs-comment">// 证书私钥的密码，在使用中请替换为实际的证书秘钥密码，可选，本例中不生效</span></li><li>      }</li><li>    }</li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section659061718467">2. DER证书<i class="anchor-icon anchor-icon-link" anchorid="section659061718467" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在certificate中通过filePath指定证书内容（也可以通过content指定证书内容），type配置DER指定证书类型，key和keyPassword指定证书私钥和密码。使用openssl x509 -in cert.pem -outform der -out cert.der命令将上面例子中的pem文件转为der文件。关于文件路径，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file" target="_blank">应用文件</a>。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">certificate</span>: {</li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/cert.der'</span>, <span class="hljs-comment">// 可以使用content字段指定证书内容</span></li><li>        <span class="hljs-attr">type</span>: <span class="hljs-string">'DER'</span>,</li><li>        <span class="hljs-attr">key</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/cert.key'</span>, <span class="hljs-comment">// 这是证书私钥，在使用中请替换为实际的证书秘钥路径，可选</span></li><li>        <span class="hljs-attr">keyPassword</span>: <span class="hljs-string">'keyPassword'</span>, <span class="hljs-comment">// 证书私钥的密码，在使用中请替换为实际的证书秘钥密码，可选，本例中不生效</span></li><li>      }</li><li>    }</li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section159584331465">3. P12证书<i class="anchor-icon anchor-icon-link" anchorid="section159584331465" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在certificate中配置filePath指定证书路径（也可以配置content指定证书内容），type配置P12指定证书类型，keyPassword指定证书私钥的密码。使用openssl pkcs12 -export -out cert.p12 -inkey cert.key -in cert.pem命令将上面例子中的pem文件转为P12证书，设置密码“1234”。关于文件路径，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-file" target="_blank">应用文件</a>。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-string">'https://example.com'</span>); <span class="hljs-comment">// 请替换为实际的网址</span></li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">certificate</span>: {</li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">'/data/storage/el1/bundle/entry/resources/resfile/cert.p12'</span>, <span class="hljs-comment">// 可以使用content字段指定证书内容</span></li><li>        <span class="hljs-attr">type</span>: <span class="hljs-string">'P12'</span>, <span class="hljs-comment">// P12证书已包含私钥，不需要使用key指定私钥</span></li><li>        <span class="hljs-attr">keyPassword</span>: <span class="hljs-string">'1234'</span>, <span class="hljs-comment">// 证书私钥的密码，在使用中请替换为实际的证书秘钥密码，可选</span></li><li>      }</li><li>    }</li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response statusCode: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.statusCode)}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`response: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(response.toString())}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`response err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section12673125694317">证书锁定<i class="anchor-icon anchor-icon-link" anchorid="section12673125694317" tips="复制节点链接"></i></h2>          <p>证书锁定可以设置信任的证书的范围。通过比较证书公钥的SHA256哈希值的BASE64编码，限定可信任的证书。</p>     <ul>      <li>可以通过以下OpenSSL命令获得证书公钥，其中，example.pem是服务器的PEM格式的证书，请替换为实际证书：       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>openssl x509 -<span class="hljs-keyword">in</span> example.pem -noout -pubkey | openssl asn1parse -noout -inform pem -<span class="hljs-keyword">out</span> example.<span class="hljs-keyword">public</span>.key</li></ol></pre></div></div></li>     </ul>     <ul>      <li>可以通过以下OpenSSL命令计算公钥的SHA256哈希值的BASE64编码，其中，example.public.key是上一步生成的证书的公钥：       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-vbnet" data-highlighted="yes"><ol class="linenums"><li>openssl dgst -sha256 -<span class="hljs-keyword">binary</span> example.<span class="hljs-keyword">public</span>.<span class="hljs-keyword">key</span> | openssl enc -base64</li></ol></pre></div></div></li>     </ul>     <ol>      <li><span>导入需要的模块。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { rcp } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.RemoteCommunicationKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在certificatePinning中配置可信任的证书公钥的SHA256哈希值。</span>       <p></p>       <div _ngcontent-lev-c106="" class="highlight-div"><div _ngcontent-lev-c106="" class="highlight-div-header"><div _ngcontent-lev-c106="" class="highlight-div-header-left"><div _ngcontent-lev-c106="" class="handle-button expand-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lev-c106="" class="highlight-div-header-right"><div _ngcontent-lev-c106="" class="handle-button ai-button"></div><div _ngcontent-lev-c106="" class="handle-button line-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lev-c106="" class="handle-button theme-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lev-c106="" class="handle-button copy-button"><div _ngcontent-lev-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lev-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TEST_URL</span> = <span class="hljs-string">'https://example.com'</span>; <span class="hljs-comment">// 请替换成需要的URL</span></li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">RIGHT_EXAMPLE_PUBLIC_KEY_SHA256_HASH</span> = [</li><li>  <span class="hljs-string">'iMMpIJdSf5VlClHaxZReyhaLxLsmZMMNAiA2pMR8/M4='</span>, <span class="hljs-comment">// 请替换成需要的字符串</span></li><li>  <span class="hljs-string">'qBRjZmOmkSNJL0p70zek7odSIzqs/muR4Jk9xYyCP+E='</span>, <span class="hljs-comment">// 请替换成需要的字符串</span></li><li>];</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">TestRcp</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">const</span> session = rcp.<span class="hljs-title function_">createSession</span>();</li><li>  <span class="hljs-keyword">const</span> request = <span class="hljs-keyword">new</span> rcp.<span class="hljs-title class_">Request</span>(<span class="hljs-variable constant_">TEST_URL</span>);</li><li>  request.<span class="hljs-property">configuration</span> = {</li><li>    <span class="hljs-attr">security</span>: {</li><li>      <span class="hljs-attr">certificatePinning</span>: [</li><li>        {</li><li>          <span class="hljs-attr">kind</span>: <span class="hljs-string">'public-key'</span>,</li><li>          <span class="hljs-attr">publicKeyHash</span>: <span class="hljs-variable constant_">RIGHT_EXAMPLE_PUBLIC_KEY_SHA256_HASH</span>[<span class="hljs-number">0</span>],</li><li>          <span class="hljs-attr">hashAlgorithm</span>: <span class="hljs-string">'SHA-256'</span></li><li>        },</li><li>        {</li><li>          <span class="hljs-attr">kind</span>: <span class="hljs-string">'public-key'</span>,</li><li>          <span class="hljs-attr">publicKeyHash</span>: <span class="hljs-variable constant_">RIGHT_EXAMPLE_PUBLIC_KEY_SHA256_HASH</span>[<span class="hljs-number">1</span>],</li><li>          <span class="hljs-attr">hashAlgorithm</span>: <span class="hljs-string">'SHA-256'</span></li><li>        },</li><li>      ]</li><li>    }</li><li>  };</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> response = <span class="hljs-keyword">await</span> session.<span class="hljs-title function_">fetch</span>(request);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Test certificate pinning '</span> + response.<span class="hljs-property">statusCode</span>);</li><li>  } <span class="hljs-keyword">catch</span> (e) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Test certificate pinning '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(e));</li><li>  } <span class="hljs-keyword">finally</span> {</li><li>    session.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>   </div>   <div></div></div>