<h1 _ngcontent-nrl-c119="" class="doc-title ng-star-inserted" title="Stage模型开发概述"> Stage模型开发概述 </h1>

<div _ngcontent-nrl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <p>下图展示了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ability-terminology#stage模型">Stage模型</a>中的基本概念。</p>     <p><strong>图1</strong> Stage模型概念图</p>     <p><span><img originheight="454" originwidth="1385" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114719.36851941211896961147505527302734:50001231000000:2800:F4C62ECE2FF8A4C66331D98DA96A030444B24AEB9C9291301D830DF28EC74822.png" width="920" height="301.57400722021663"></span></p>     <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/abilitystage">AbilityStage</a></p>       <p>每个Entry类型或者Feature类型的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>在运行期都有一个AbilityStage实例，当<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>中的代码首次被加载到进程中的时候，系统会先创建AbilityStage实例。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-overview">UIAbility组件</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/extensionability-overview">ExtensionAbility组件</a></p>       <p>Stage模型提供UIAbility和ExtensionAbility两种类型的组件，这两种组件都有具体的类承载，支持面向对象的开发方式。</p>       <ul>        <li>         <p>UIAbility组件是一种包含UI的应用组件，主要用于和用户交互。例如，图库类应用可以在UIAbility组件中展示图片瀑布流，在用户选择某个图片后，在新的页面中展示图片的详细内容。同时用户可以通过返回键返回到瀑布流页面。UIAbility组件的生命周期只包含创建、销毁、前台、后台等状态，与显示相关的状态通过WindowStage的事件暴露给开发者。</p></li>        <li>         <p>ExtensionAbility组件是一种面向特定场景的应用组件。开发者并不直接从ExtensionAbility组件派生，而是需要使用ExtensionAbility组件的派生类。目前ExtensionAbility组件有用于卡片场景的FormExtensionAbility，用于输入法场景的InputMethodExtensionAbility，用于延时任务场景的WorkSchedulerExtensionAbility等多种派生类，这些派生类都是基于特定场景提供的。例如，用户在桌面创建应用的卡片，需要应用开发者从FormExtensionAbility派生，实现其中的回调函数，并在配置文件中配置该能力。ExtensionAbility组件的派生类实例由用户触发创建，并由系统管理生命周期。在Stage模型上，三方应用开发者不能开发自定义服务，而需要根据自身的业务场景通过ExtensionAbility组件的派生类来实现。</p></li>       </ul>       <p>一个HAP包中可以包含一个或多个UIAbility/ExtensionAbility组件，这些组件在运行时共用同一个AbilityStage实例。当<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package">HAP</a>中的代码（无论是UIAbility组件还是ExtensionAbility组件）首次被加载到进程中的时候，系统会先创建对应的AbilityStage实例。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-windowstage" target="_blank">WindowStage</a></p>       <p>每个UIAbility实例都会与一个WindowStage类实例绑定，该类起到了应用进程内窗口管理器的作用。它包含一个主窗口。也就是说UIAbility实例通过WindowStage持有了一个主窗口，该主窗口为ArkUI提供了绘制区域，可以加载不同的ArkUI页面。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage">Context</a></p>       <p>在Stage模型上，Context及其派生类向开发者提供在运行期可以调用的各种资源和能力。UIAbility组件和各种ExtensionAbility组件的派生类都有各自不同的Context类，他们都继承自基类Context，但是各自又根据所属组件，提供不同的能力。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="构成要素">构成要素<i class="anchor-icon anchor-icon-link" anchorid="构成要素" tips="复制节点链接"></i></h2>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-models">应用模型</a>章节中介绍了应用模型的构成要素，主要包含应用组件、配置文件、进程模型、线程模型和任务管理模型。下面我们以Demo.app这个应用为例，从应用的开发阶段和运行阶段分别展开介绍，帮助开发者更好地理解Stage模型的构成要素。</p>     <p>该Demo应用主要实现了如下功能：</p>     <ul>      <li>实现了两个独立的带界面的窗口（UIAbilityA、UIAbilityB），可以与用户交互。</li>      <li>实现了卡片功能，便于用户将应用的卡片添加到桌面上。</li>     </ul>     <p><strong>图2</strong> Stage模型构成要素</p>     <p><span><img originheight="598" originwidth="1203" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114719.91457921248443629648511244074520:50001231000000:2800:D849A6115CB8EFE36B47059081ABA68741B5527B3AE03C08303D2B64091AA694.png" width="920" height="457.3233582709892"></span></p>     <p><strong>开发阶段</strong> ：需要通过Stage模型提供的应用组件（UIAbility组件和ExtensionAbility组件）开发应用功能，并在应用的配置文件（app.json5和module.json5）中注册应用的相关信息。</p>     <ul>      <li>       <p>应用组件：本例中使用UIAbility组件开发带界面的与用户交互的模块，使用FormExtensionAbility组件开发卡片模块，实现卡片的添加、删除、更新功能。为了减少不同功能模块间的依赖和耦合，将UIAbility和FormExtensionAbility的实现分别放在不同的HAP包中，同时，将两者共同依赖的一些通用功能放在HSP包中。</p></li>      <li>       <p>配置文件：开发者可以在app.json5中配置应用的应用名、版本号、应用图标等，在module.json5中配置该HAP包下的组件清单、组件权限等信息。这些配置信息会在应用安装时注册到系统，便于系统和其他模块获取这个应用的详细信息，与应用进行交互。</p></li>     </ul>     <p><strong>运行阶段</strong>：当应用安装到设备运行时，系统通过一套应用进程和线程的管理机制，确保功能的有序运行。</p>     <ul>      <li>       <p>进程模型：在本例中，UIAbility组件默认运行在主进程中，FormExtensionAbility组件运行在独立进程中，UIAbility和FormExtensionAbility组件之间是进程隔离的。更多详情可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/process-model-stage">进程模型</a>。</p></li>      <li>       <p>线程模型：Stage模型提供了worker、taskpool等机制支撑应用多线程开发场景。应用如果有复杂的耗时逻辑需要处理，可以通过创建worker的方式开启worker线程，交由worker线程处理。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发流程">开发流程<i class="anchor-icon anchor-icon-link" anchorid="开发流程" tips="复制节点链接"></i></h2>          <p>基于Stage模型开发应用时，在应用模型部分，涉及如下开发过程。</p>     <p><strong>表1</strong> Stage模型开发流程</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.1" valign="top" width="33.33333333333333%">任务</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.2" valign="top" width="33.33333333333333%">简介</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.4.1.4.1.3" valign="top" width="33.33333333333333%">相关指导</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用组件开发</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">本章节介绍了如何使用Stage模型的UIAbility组件和ExtensionAbility组件开发应用。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-component-configuration-stage">应用/组件级配置</a></p>          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-overview">UIAbility组件</a></p>          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/extensionability-overview">ExtensionAbility组件</a></p>          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/abilitystage">AbilityStage组件管理器</a></p>          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage">应用上下文Context</a></p>          <p>- <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/component-startup-rules">组件启动规则</a></p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">了解进程模型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">本章节介绍了Stage模型的进程模型以及几种常用的进程间通信方式。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/process-model-stage">进程模型概述</a></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">了解线程模型</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">本章节介绍了Stage模型的线程模型以及几种常用的线程间通信方式。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/thread-model-stage">线程模型概述</a></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用配置文件</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">本章节介绍Stage模型中应用配置文件的开发要求。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/config-file-stage">Stage模型应用配置文件</a></td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>