<h1 _ngcontent-wvg-c119="" class="doc-title ng-star-inserted" title="TPosition"> TPosition </h1>

<div _ngcontent-wvg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>AscendC管理不同层级的物理内存时，用一种抽象的逻辑位置（TPosition）来表达各级别的存储，代替了片上物理存储的概念，达到隐藏硬件架构的目的。主要的TPosition类型包括：VECIN、VECOUT、VECCALC、A1、A2、B1、B2、CO1、CO2，其中VECIN、VECCALC、VECOUT主要用于矢量编程，A1、A2、B1、B2、C1、C2、CO1、CO2用于矩阵编程。开发者可以参考了解TPosition的基础概念，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-general-constraints">通用约束</a>表1了解TPosition和物理存储的映射关系。</p> <p>TPosition定义如下。</p> <div _ngcontent-wvg-c106="" class="highlight-div"><div _ngcontent-wvg-c106="" class="highlight-div-header"><div _ngcontent-wvg-c106="" class="highlight-div-header-left"><div _ngcontent-wvg-c106="" class="handle-button expand-button"><div _ngcontent-wvg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wvg-c106="" class="highlight-div-header-right"><div _ngcontent-wvg-c106="" class="handle-button ai-button"></div><div _ngcontent-wvg-c106="" class="handle-button line-button"><div _ngcontent-wvg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wvg-c106="" class="handle-button theme-button"><div _ngcontent-wvg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wvg-c106="" class="handle-button copy-button"><div _ngcontent-wvg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wvg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">enum class</span> <span class="hljs-title class_">TPosition</span> : <span class="hljs-type">uint8_t</span> { </li><li>    GM, </li><li>    A1, </li><li>    A2, </li><li>    B1, </li><li>    B2, </li><li>    C1, </li><li>    C2, </li><li>    CO1, </li><li>    CO2, </li><li>    VECIN, </li><li>    VECOUT, </li><li>    VECCALC, </li><li>    LCM = VECCALC, </li><li>    SPM, </li><li>    SHM = SPM, </li><li>    TSCM, </li><li>    C2PIPE2GM, </li><li>    C2PIPE2LOCAL, </li><li>    MAX, </li><li>};</li></ol></pre></div></div> <p>TPosition枚举值的具体定义如下。</p>  <div class="tablenoborder"><a name="ZH-CN_TOPIC_0000002479472765__zh-cn_topic_0000002083616850__table5376122715308"></a><a name="zh-cn_topic_0000002083616850__table5376122715308"></a><div class="tbBox"><table id="zh-cn_topic_0000002083616850__table5376122715308" class="layoutFixed idpTab"><caption><b>表1 </b>TPosition枚举值含义说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.3.1.1" valign="top" width="18%"><p>枚举值</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.3.1.2" valign="top" width="82%"><p>具体含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18%"><p>GM</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>Global Memory，对应AI Core的外部存储。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>VECIN</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矢量计算，搬入数据的存放位置，在数据搬入Vector计算单元时使用此位置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>VECOUT</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矢量计算，搬出数据的存放位置，在将Vector计算单元结果搬出时使用此位置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>VECCALC</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矢量计算/矩阵计算，在计算需要临时变量时使用此位置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>A1</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放整块A矩阵，可类比CPU多级缓存中的二级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>B1</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放整块B矩阵，可类比CPU多级缓存中的二级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>C1</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放整块Bias矩阵，可类比CPU多级缓存中的二级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>A2</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放切分后的小块A矩阵，可类比CPU多级缓存中的一级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>B2</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放切分后的小块B矩阵，可类比CPU多级缓存中的一级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>C2</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放切分后的小块Bias矩阵，可类比CPU多级缓存中的一级缓存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>CO1</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放小块结果C矩阵，可理解为Cube Out。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>CO2</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于矩阵计算，存放整块结果C矩阵，可理解为Cube Out。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>SPM</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>当Unified Buffer内存有溢出风险时，用于Unified Buffer的数据暂存。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>TSCM</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>Temp Swap Cache Memory,  用于临时把数据交换到额外空间，进行Matmul运算。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>C2PIPE2GM</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>用于存放FIXPIPE量化参数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>C2PIPE2LOCAL</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>预留参数。为后续的功能做保留，开发者暂时无需关注。</p> </td> </tr>  </tbody></table></div> </div> </div> <div></div></div>