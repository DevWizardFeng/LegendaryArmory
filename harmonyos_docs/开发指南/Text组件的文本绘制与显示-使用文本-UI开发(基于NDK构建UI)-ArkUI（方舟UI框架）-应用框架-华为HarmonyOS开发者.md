<h1 _ngcontent-ryg-c119="" class="doc-title ng-star-inserted" title="Text组件的文本绘制与显示"> Text组件的文本绘制与显示 </h1>

<div _ngcontent-ryg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>部分框架或应用具备自研的文字排版能力，在移植时，这些能力会被对接到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/complex-text-c">方舟2D图形服务的文本引擎</a>。为了避免开发者重复开发文本组件，Text组件提供了接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeattributetype" target="_blank">NODE_TEXT_CONTENT_WITH_STYLED_STRING</a>，可以直接渲染方舟文本引擎生成的文本。</p>    <p>以下场景基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面章节</a>，阐述了如何创建字体引擎文本，并利用Text组件进行渲染显示。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>涉及字体引擎的接口，需在CMakeLists.txt中添加target_link_libraries(entry PUBLIC libnative_drawing.so)，否则链接阶段会报错。</p>     </div></div></div>    <p>下图展示了 NODE_TEXT_CONTENT_WITH_STYLED_STRING 接口的主要使用流程。</p>    <p><span><img originheight="460" originwidth="376" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114755.40588299642175422934830172761652:50001231000000:2800:F40A4A408FE3C8F6443438317F187760C48C95E189390671F385E11AADC43F8A.png" width="376" height="460"></span></p>    <div class="tiledSection">     <h2 id="创建text组件">创建Text组件<i class="anchor-icon anchor-icon-link" anchorid="创建text组件" tips="复制节点链接"></i></h2>          <p>创建文本组件时，无需配置文字颜色、字体大小等样式属性，因为这些属性通过字体引擎接口设置。但仍需设置基础的通用属性，如宽度和高度。如果不指定，组件自动适应文本的宽度和高度。</p>     <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ArkUI_NativeNodeAPI_1</span> *<span class="hljs-variable">nodeApi</span> = <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">ArkUI_NativeNodeAPI_1</span> *&gt;(</li><li>    <span class="hljs-title function_">OH_ArkUI_QueryModuleInterfaceByName</span>(<span class="hljs-variable">ARKUI_NATIVE_NODE</span>, <span class="hljs-string">"ArkUI_NativeNodeAPI_1"</span>));</li><li><span class="hljs-keyword">if</span> (<span class="hljs-variable">nodeApi</span> == <span class="hljs-variable">nullptr</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li><span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">text</span> = <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_TEXT</span>);</li><li><span class="hljs-comment">// 设置宽度</span></li><li><span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">textWidth</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">300</span>}};</li><li><span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">textWidthItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">textWidth</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li><span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">textWidthItem</span>);</li><li><span class="hljs-comment">// 设置高度</span></li><li><span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">textHeight</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">100</span>}};</li><li><span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">textHeightItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">textHeight</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li><span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, &amp;<span class="hljs-title class_">textHeightItem</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="设置段落与文本样式">设置段落与文本样式<i class="anchor-icon anchor-icon-link" anchorid="设置段落与文本样式" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>设置段落样式</p>       <p>段落样式定义了一段文字的整体属性，例如最大显示行数、文字方向等。以下代码示例设置了文字居中，最大行数限制为10。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>OH_Drawing_前缀的接口由方舟字体引擎提供，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/simple-text-c">简单文本绘制与显示（C/C++)</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/complex-text-c">复杂文本绘制与显示（C/C++）</a>。</p>        </div></div></div>       <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">OH_Drawing_TypographyStyle</span> *<span class="hljs-variable">typographyStyle</span> = <span class="hljs-title function_">OH_Drawing_CreateTypographyStyle</span>();</li><li><span class="hljs-title function_">OH_Drawing_SetTypographyTextAlign</span>(<span class="hljs-variable">typographyStyle</span>, <span class="hljs-variable">OH_Drawing_TextAlign</span>::<span class="hljs-title class_">TEXT_ALIGN_CENTER</span>);</li><li><span class="hljs-title function_">OH_Drawing_SetTypographyTextMaxLines</span>(<span class="hljs-variable">typographyStyle</span>, <span class="hljs-number">10</span>);</li></ol></pre></div></div></li>      <li>       <p>设置文本样式</p>       <p>不同内容的文本可以设置不同的文本样式，但必须按照以下三个接口的逻辑调用顺序进行设置，否则将无法生效。</p>       <ol>        <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-styled-string-h#oh_arkui_styledstring_pushtextstyle" target="_blank">OH_ArkUI_StyledString_PushTextStyle</a>：将文字样式推入栈中。</li>        <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-styled-string-h#oh_arkui_styledstring_addtext" target="_blank">OH_ArkUI_StyledString_AddText</a>：添加要修改样式的文字内容。</li>        <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-styled-string-h#oh_arkui_styledstring_poptextstyle" target="_blank">OH_ArkUI_StyledString_PopTextStyle</a>：将文字样式弹出栈。</li>       </ol>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>OH_ArkUI_StyledString_前缀的接口由Text组件提供。</p>         <p>OH_Drawing_前缀的接口由方舟字体引擎提供，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/simple-text-c">简单文本绘制与显示（C/C++)</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/complex-text-c">复杂文本绘制与显示（C/C++）</a>。</p>        </div></div></div>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-text-typography-h#oh_drawing_createtextstyle" target="_blank">OH_Drawing_CreateTextStyle</a>创建文本样式。设置“Hello”字体大小28px，颜色为0xFF707070。设置“World!”字体大小为28px，颜色为0xFF2787D9。</p>       <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>ArkUI_StyledString *styledString = <span class="hljs-built_in">OH_ArkUI_StyledString_Create</span>(typographyStyle,<span class="hljs-built_in">OH_Drawing_CreateFontCollection</span>());</li><li>
</li><li>OH_Drawing_TextStyle *helloStyle = <span class="hljs-built_in">OH_Drawing_CreateTextStyle</span>();</li><li><span class="hljs-comment">// 设置字体大小</span></li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(helloStyle, <span class="hljs-number">28</span>);</li><li><span class="hljs-comment">// 设置颜色</span></li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(helloStyle, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>));</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PushTextStyle</span>(styledString, helloStyle);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_AddText</span>(styledString, <span class="hljs-string">"Hello"</span>);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PopTextStyle</span>(styledString);</li><li>
</li><li>OH_Drawing_TextStyle *worldTextStyle = <span class="hljs-built_in">OH_Drawing_CreateTextStyle</span>();</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(worldTextStyle, <span class="hljs-number">28</span>);</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(worldTextStyle, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x27</span>,<span class="hljs-number">0x87</span>, <span class="hljs-number">0xD9</span>));</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PushTextStyle</span>(styledString, worldTextStyle);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_AddText</span>(styledString, <span class="hljs-string">"World!"</span>);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PopTextStyle</span>(styledString);</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="添加占位">添加占位<i class="anchor-icon anchor-icon-link" anchorid="添加占位" tips="复制节点链接"></i></h2>          <p>占位保留指定大小的空白区域，此区域不绘制文字，但参与布局测量，影响文字排版。</p>     <p>行高是文字高度与占位高度中的较大值。</p>     <p>以下示例展示在Hello与World!中间插入占位。</p>     <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_TextStyle *helloStyle = <span class="hljs-built_in">OH_Drawing_CreateTextStyle</span>();</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(helloStyle, <span class="hljs-number">28</span>);</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(helloStyle, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>));</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PushTextStyle</span>(styledString, helloStyle);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_AddText</span>(styledString, <span class="hljs-string">"Hello"</span>);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PopTextStyle</span>(styledString);</li><li>
</li><li><span class="hljs-comment">// 设置占位宽和高</span></li><li>OH_Drawing_PlaceholderSpan placeHolder{</li><li>    .width = <span class="hljs-number">100</span>,</li><li>    .height = <span class="hljs-number">100</span>,</li><li>};</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_AddPlaceholder</span>(styledString, placeHolder);</li><li>
</li><li>OH_Drawing_TextStyle *worldTextStyle = <span class="hljs-built_in">OH_Drawing_CreateTextStyle</span>();</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(worldTextStyle, <span class="hljs-number">28</span>);</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(worldTextStyle, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x27</span>,<span class="hljs-number">0x87</span>, <span class="hljs-number">0xD9</span>));</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PushTextStyle</span>(styledString, worldTextStyle);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_AddText</span>(styledString, <span class="hljs-string">"World!"</span>);</li><li><span class="hljs-built_in">OH_ArkUI_StyledString_PopTextStyle</span>(styledString);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="文本布局与绘制">文本布局与绘制<i class="anchor-icon anchor-icon-link" anchorid="文本布局与绘制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>文本布局</p>       <p>文字样式和内容设置完成后，调用字体引擎接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-text-typography-h#oh_drawing_typographylayout" target="_blank">OH_Drawing_TypographyLayout</a>对文本进行布局，传入最大宽度。超过此宽度的文字会自动换行。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>未经过布局的文本无法显示。</p>        </div></div></div>       <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_Typography *typography = OH_ArkUI_StyledString_CreateTypography(styledString);</li><li>OH_Drawing_TypographyLayout(typography, 400);</li></ol></pre></div></div></li>      <li>       <p>文本绘制</p>       <p>文本绘制由字体引擎与图形交互完成，无需额外设置。Text组件会在ArkUI渲染机制下，在组件触发绘制时调用字体引擎绘制接口。此处仅需将已创建的StyledString对象传递给已创建的Text组件。</p>       <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">styledStringItem</span> = {.<span class="hljs-variable">object</span> = <span class="hljs-variable">styledString</span>};</li><li><span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_TEXT_CONTENT_WITH_STYLED_STRING</span>, &amp;<span class="hljs-title class_">styledStringItem</span>);</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="销毁对象">销毁对象<i class="anchor-icon anchor-icon-link" anchorid="销毁对象" tips="复制节点链接"></i></h2>          <p>Text组件不对本文涉及的任何对象的生命周期进行管理，需由开发者自行负责。字体引擎接口均配有相应的销毁方法。</p>     <p>上述涉及的字体引擎接口都有对应的销毁方法。</p>     <p>OH_Drawing_DestroyTextStyle(OH_Drawing_TextStyle *style)：销毁文本样式对象。</p>     <p>OH_Drawing_DestroyTypographyStyle(OH_Drawing_TypographyStyle *style)：销毁段落样式对象。</p>     <p>当Text组件仍在界面上显示时，此时释放会导致文字无法绘制。在实际业务场景下需确保Text组件不再使用时才释放。</p>     <p>相关字体引擎销毁的接口请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-text-typography-h#oh_drawing_destroytextstyle" target="_blank">OH_Drawing_DestroyTextStyle</a> 和 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing-text-typography-h#oh_drawing_destroytypographystyle" target="_blank">OH_Drawing_DestroyTypographyStyle</a>。</p>     <p>Text组件提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-styled-string-h#oh_arkui_styledstring_destroy" target="_blank">OH_ArkUI_StyledString_Destroy</a>，用于销毁属性字符串对象。</p>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <p>本篇示例仅提供核心接口的调用方法，完整的示例工程请参考<a href="https://gitcode.com/HarmonyOS_Samples/guide-snippets/tree/master/ArkUIKit/StyledStringNDK" target="_blank">StyledStringNDK</a>。</p>     <div _ngcontent-ryg-c106="" class="highlight-div"><div _ngcontent-ryg-c106="" class="highlight-div-header"><div _ngcontent-ryg-c106="" class="highlight-div-header-left"><div _ngcontent-ryg-c106="" class="handle-button expand-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ryg-c106="" class="highlight-div-header-right"><div _ngcontent-ryg-c106="" class="handle-button ai-button"></div><div _ngcontent-ryg-c106="" class="handle-button line-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ryg-c106="" class="handle-button theme-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ryg-c106="" class="handle-button copy-button"><div _ngcontent-ryg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ryg-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">arkui</span>/<span class="hljs-title class_">native_interface</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">arkui</span>/<span class="hljs-title class_">styled_string</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_font_collection</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">native_drawing</span>/<span class="hljs-title class_">drawing_text_declaration</span>.<span class="hljs-title class_">h</span>&gt;</li><li>
</li><li><span class="hljs-variable">void</span> <span class="hljs-title function_">CreateNativeNode</span>() {</li><li>    <span class="hljs-variable">ArkUI_NativeNodeAPI_1</span> *<span class="hljs-variable">nodeApi</span> = <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">ArkUI_NativeNodeAPI_1</span> *&gt;(</li><li>        <span class="hljs-title function_">OH_ArkUI_QueryModuleInterfaceByName</span>(<span class="hljs-variable">ARKUI_NATIVE_NODE</span>, <span class="hljs-string">"ArkUI_NativeNodeAPI_1"</span>));</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">nodeApi</span> == <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 创建一个Column容器组件</span></li><li>    <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">column</span> = <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_COLUMN</span>);</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">colWidth</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">300</span>}};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">widthItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">colWidth</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">column</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">widthItem</span>);</li><li>    <span class="hljs-comment">// 创建Text组件</span></li><li>    <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">text</span> = <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_TEXT</span>);</li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">textWidth</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">300</span>}};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">textWidthItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">textWidth</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_WIDTH</span>, &amp;<span class="hljs-title class_">textWidthItem</span>);</li><li>    </li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">textHeight</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">100</span>}};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">textHeightItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">textHeight</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_HEIGHT</span>, &amp;<span class="hljs-title class_">textHeightItem</span>);</li><li>    </li><li>    <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">borderWidth</span>[] = {{.<span class="hljs-variable">f32</span> = <span class="hljs-number">1</span>}};</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">borderWidthItem</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">borderWidth</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_BORDER_WIDTH</span>, &amp;<span class="hljs-title class_">borderWidthItem</span>);</li><li>    </li><li>    <span class="hljs-comment">// typographyStyle表示段落样式。</span></li><li>    <span class="hljs-variable">OH_Drawing_TypographyStyle</span> *<span class="hljs-variable">typographyStyle</span> = <span class="hljs-title function_">OH_Drawing_CreateTypographyStyle</span>();</li><li>    <span class="hljs-comment">// 文字居中显示</span></li><li>    <span class="hljs-title function_">OH_Drawing_SetTypographyTextAlign</span>(<span class="hljs-variable">typographyStyle</span>, <span class="hljs-variable">OH_Drawing_TextAlign</span>::<span class="hljs-title class_">TEXT_ALIGN_CENTER</span>);</li><li>    <span class="hljs-title function_">OH_Drawing_SetTypographyTextMaxLines</span>(<span class="hljs-variable">typographyStyle</span>, <span class="hljs-number">10</span>);</li><li>    <span class="hljs-variable">ArkUI_StyledString</span> *<span class="hljs-variable">styledString</span> = <span class="hljs-title function_">OH_ArkUI_StyledString_Create</span>(<span class="hljs-variable">typographyStyle</span>, <span class="hljs-title function_">OH_Drawing_CreateFontCollection</span>());</li><li>    <span class="hljs-comment">// 创建文本样式，设置字体和颜色。</span></li><li>    <span class="hljs-variable">OH_Drawing_TextStyle</span> *<span class="hljs-variable">textStyle</span> = <span class="hljs-title function_">OH_Drawing_CreateTextStyle</span>();</li><li>    <span class="hljs-title function_">OH_Drawing_SetTextStyleFontSize</span>(<span class="hljs-variable">textStyle</span>, <span class="hljs-number">28</span>);</li><li>    <span class="hljs-title function_">OH_Drawing_SetTextStyleColor</span>(<span class="hljs-variable">textStyle</span>, <span class="hljs-title function_">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>, <span class="hljs-number">0x70</span>));</li><li>    <span class="hljs-comment">// 文本样式的设置有顺序。</span></li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_PushTextStyle</span>(<span class="hljs-variable">styledString</span>, <span class="hljs-variable">textStyle</span>);</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_AddText</span>(<span class="hljs-variable">styledString</span>, <span class="hljs-string">"Hello"</span>);</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_PopTextStyle</span>(<span class="hljs-variable">styledString</span>);</li><li>    <span class="hljs-comment">// 在Hello和World中间插入100x100的占位。</span></li><li>    <span class="hljs-variable">OH_Drawing_PlaceholderSpan</span> <span class="hljs-variable">placeHolder</span>{</li><li>        .<span class="hljs-variable">width</span> = <span class="hljs-number">100</span>,</li><li>        .<span class="hljs-variable">height</span> = <span class="hljs-number">100</span>,</li><li>    };</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_AddPlaceholder</span>(<span class="hljs-variable">styledString</span>, &amp;<span class="hljs-title class_">placeHolder</span>);</li><li>    <span class="hljs-variable">OH_Drawing_TextStyle</span> *<span class="hljs-variable">worldTextStyle</span> = <span class="hljs-title function_">OH_Drawing_CreateTextStyle</span>();</li><li>    <span class="hljs-title function_">OH_Drawing_SetTextStyleFontSize</span>(<span class="hljs-variable">worldTextStyle</span>, <span class="hljs-number">28</span>);</li><li>    <span class="hljs-title function_">OH_Drawing_SetTextStyleColor</span>(<span class="hljs-variable">worldTextStyle</span>, <span class="hljs-title function_">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x27</span>, <span class="hljs-number">0x87</span>, <span class="hljs-number">0xD9</span>));</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_PushTextStyle</span>(<span class="hljs-variable">styledString</span>, <span class="hljs-variable">worldTextStyle</span>);</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_AddText</span>(<span class="hljs-variable">styledString</span>, <span class="hljs-string">"World!"</span>);</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_PopTextStyle</span>(<span class="hljs-variable">styledString</span>);</li><li>    <span class="hljs-variable">OH_Drawing_Typography</span> *<span class="hljs-variable">typography</span> = <span class="hljs-title function_">OH_ArkUI_StyledString_CreateTypography</span>(<span class="hljs-variable">styledString</span>);</li><li>    <span class="hljs-title function_">OH_Drawing_TypographyLayout</span>(<span class="hljs-variable">typography</span>, <span class="hljs-number">400</span>);</li><li>    <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">styledStringItem</span> = {.<span class="hljs-variable">object</span> = <span class="hljs-variable">styledString</span>};</li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">text</span>, <span class="hljs-title class_">NODE_TEXT_CONTENT_WITH_STYLED_STRING</span>, &amp;<span class="hljs-title class_">styledStringItem</span>);</li><li>
</li><li>    <span class="hljs-title function_">OH_ArkUI_StyledString_Destroy</span>(<span class="hljs-variable">styledString</span>);</li><li>    <span class="hljs-comment">// Text作为Column子组件</span></li><li>    <span class="hljs-variable">nodeApi</span>-&gt;<span class="hljs-title class_">addChild</span>(<span class="hljs-title class_">column</span>, <span class="hljs-title class_">text</span>);</li><li>    <span class="hljs-comment">// Column作为XComponent子组件</span></li><li>    <span class="hljs-title function_">OH_NativeXComponent_AttachNativeRootNode</span>(<span class="hljs-variable">xComponent</span>, <span class="hljs-variable">column</span>);</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="480" originwidth="480" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114756.12150225773381427846473364187561:50001231000000:2800:B6F9C5BC0CE6BD8AE5F5D6A3B9C5EC611A56F5B7CDE701526CDB222BA3A94EE7.png" width="480" height="480"></span></p>    </div>   </div>   <div></div></div>