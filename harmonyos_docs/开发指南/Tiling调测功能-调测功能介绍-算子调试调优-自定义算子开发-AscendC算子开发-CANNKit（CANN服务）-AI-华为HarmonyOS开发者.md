<h1 _ngcontent-fbx-c119="" class="doc-title ng-star-inserted" title="Tiling调测功能"> Tiling调测功能 </h1>

<div _ngcontent-fbx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section1883mcpsimp">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section1883mcpsimp" tips="复制节点链接"></i></h2><p>Tiling是算子开发中独立且关键的部分，描述了Kirin AI处理器SoC NPU IP加速器上算子的输入/输出数据切分、分块计算、多核并行等策略，以满足片上存储限制和计算pipeline的需求，最大化计算并行性和数据局部性(data locality OR data reuse)，从而发挥硬件的极致性能。</p> <p>对单算子执行Tiling调测时，根据Tiling so文件执行Tiling运算，生成Tiling bin文件。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>目前仅标准自定义算子工程场景、ops_adv算子工程场景、built-in工程场景、内源框架工程场景需要进行Tiling调测，其余场景不涉及。</p> </div></div></div> </div> <div class="tiledSection"><h2 id="section1888mcpsimp">使用方法（命令行）<i class="anchor-icon anchor-icon-link" anchorid="section1888mcpsimp" tips="复制节点链接"></i></h2><p>通过命令行进行Tiling调测的关键步骤如下，详细样例请参考Tiling调测功能。</p> <ol><li><span>完成环境搭建，并准备好输入/标杆数据文件。</span></li><li><span>执行如下命令进行Tiling调测，这里仅提供关键参数项示例，其他参数请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cli-parameters#section17161512192310">Tiling调测参数</a>按需配置。</span><p></p><div class="p">标准自定义算子场景：<div _ngcontent-fbx-c106="" class="highlight-div"><div _ngcontent-fbx-c106="" class="highlight-div-header"><div _ngcontent-fbx-c106="" class="highlight-div-header-left"><div _ngcontent-fbx-c106="" class="handle-button expand-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fbx-c106="" class="highlight-div-header-right"><div _ngcontent-fbx-c106="" class="handle-button ai-button"></div><div _ngcontent-fbx-c106="" class="handle-button line-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fbx-c106="" class="handle-button theme-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fbx-c106="" class="handle-button copy-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fbx-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>ascendebug tiling --json-file {op_config_json_file } --chip-version ${chip_version} <strong>--work-dir</strong> ${work_dir} ... {其他参数}</li></ol></pre></div></div> </div> <p>Tiling调测涉及的所有参数可通过<strong>ascendebug tiling -h</strong>或<strong>ascendebug tiling --help</strong>查看。</p> <p></p></li><li><span>查看结果文件，详细说明参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tiling-tuning#section1907mcpsimp">产物说明</a>。</span></li></ol> </div> <div class="tiledSection"><h2 id="section1907mcpsimp">产物说明<i class="anchor-icon anchor-icon-link" anchorid="section1907mcpsimp" tips="复制节点链接"></i></h2><p>Tiling调测结果存放在${root}/${work_dir}/tiling路径下，其中${root}表示当前操作路径，${work_dir}表示调测工作空间，默认为./debug_workspace/${op_type}目录，${op_type}为算子名。产物一般包含Tiling data bin文件（二进制）、结构体解析文件等，目录结构示例如下，结果文件的详细说明参见表1。</p> <div _ngcontent-fbx-c106="" class="highlight-div"><div _ngcontent-fbx-c106="" class="highlight-div-header"><div _ngcontent-fbx-c106="" class="highlight-div-header-left"><div _ngcontent-fbx-c106="" class="handle-button expand-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fbx-c106="" class="highlight-div-header-right"><div _ngcontent-fbx-c106="" class="handle-button ai-button"></div><div _ngcontent-fbx-c106="" class="handle-button line-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fbx-c106="" class="handle-button theme-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fbx-c106="" class="handle-button copy-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fbx-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>├ ${op_type}        // 算子名 </li><li>├── tiling </li><li>│   ├── attrs.json </li><li>│   ├── inputs.json </li><li>│   ├── outputs.json </li><li>│   ├── tiling_data_tiling_key_2_block_dim_1_workspace_106258432.bin </li><li>│   ├── tiling_parse_result.json </li><li>│   ├── tiling_run_info.bin</li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>Tiling调测结果说明</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.4.2.3.1.1" valign="top" width="33%"><p>文件名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.4.2.3.1.2" valign="top" width="67%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33%"><p>attrs.json</p> </td> <td class="cellrowborder" rowspan="3" valign="top" width="67%"><p>根据算子属性、输入/输出信息生成的中间文件。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>inputs.json</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>outputs.json</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33%"><p>tiling_data_tiling_key_2_block_dim_1_workspace_106258432.bin</p> </td> <td class="cellrowborder" valign="top" width="67%"><p>Tiling数据bin文件，供CPU和simulator调测使用。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>文件名中“tiling_key_2_block_dim_1_workspace_106258432”表示tiling_key=2，block_num=1，workspace=106258432，这些信息可用于后续核函数编译和运行（比如--block-num取值为block_dim值）。</p> </div></div></div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33%"><p>tiling_parse_result.json</p> </td> <td class="cellrowborder" valign="top" width="67%"><p>对生成的Tiling数据bin文件解析，生成Tiling结构体文件，该文件展现了Tiling中每个数据的数据类型dtype和数值value。</p> <div _ngcontent-fbx-c106="" class="highlight-div"><div _ngcontent-fbx-c106="" class="highlight-div-header"><div _ngcontent-fbx-c106="" class="highlight-div-header-left"><div _ngcontent-fbx-c106="" class="handle-button expand-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fbx-c106="" class="highlight-div-header-right"><div _ngcontent-fbx-c106="" class="handle-button ai-button"></div><div _ngcontent-fbx-c106="" class="handle-button line-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fbx-c106="" class="handle-button theme-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fbx-c106="" class="handle-button copy-button"><div _ngcontent-fbx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fbx-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"baseParams"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"batchSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"dtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uint"</span> <span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">24</span></li><li>        <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span> </li><li>        <span class="hljs-attr">"headNumSize"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"dtype"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"uint"</span> <span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-number">20</span></li><li>        <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33%"><p>tiling_run_info.bin</p> </td> <td class="cellrowborder" valign="top" width="67%"><p>Tiling调测过程中的信息文件，包含block_dim、workspace大小以及tiling_key等信息。该文件关键信息已映射到Tiling数据bin文件名中。</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>