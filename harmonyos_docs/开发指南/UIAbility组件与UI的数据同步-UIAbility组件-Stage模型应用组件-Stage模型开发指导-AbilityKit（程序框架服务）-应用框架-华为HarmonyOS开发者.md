<h1 _ngcontent-kbo-c119="" class="doc-title ng-star-inserted" title="UIAbility组件与UI的数据同步"> UIAbility组件与UI的数据同步 </h1>

<div _ngcontent-kbo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>基于当前的应用模型，可以通过以下几种方式来实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>组件与UI之间的数据同步。</p>    <ul>     <li><a href="/consumer/cn/doc/harmonyos-guides/uiability-data-sync-with-ui#使用eventhub进行数据通信">使用EventHub进行数据通信</a>：在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">基类Context</a>中提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-eventhub" target="_blank">EventHub</a>对象，可以通过发布订阅方式来实现事件的传递。在事件传递前，订阅者需要先进行订阅，当发布者发布事件时，订阅者将接收到事件并进行相应处理。</li>     <li><a href="/consumer/cn/doc/harmonyos-guides/uiability-data-sync-with-ui#使用appstoragelocalstorage进行数据同步">使用AppStorage/LocalStorage进行数据同步</a>：ArkUI提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage">AppStorage</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>两种应用级别的状态管理方案，可用于实现应用级别和UIAbility级别的数据同步。</li>    </ul>    <div class="tiledSection">     <h2 id="使用eventhub进行数据通信">使用EventHub进行数据通信<i class="anchor-icon anchor-icon-link" anchorid="使用eventhub进行数据通信" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-eventhub" target="_blank">EventHub</a>为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>组件提供了事件机制，使它们能够进行订阅、取消订阅和触发事件等数据通信能力。</p>     <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-context" target="_blank">基类Context</a>中，提供了EventHub对象，可用于在UIAbility组件实例内通信。使用EventHub实现UIAbility与UI之间的数据通信需要先获取EventHub对象，本章节将以此为例进行说明。</p>     <ol>      <li>       <p>在UIAbility中调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-eventhub#eventhubon" target="_blank">eventHub.on()</a>方法注册一个自定义事件“event1”，eventHub.on()有如下两种调用方式，使用其中一种即可。</p>       <div _ngcontent-kbo-c106="" class="highlight-div"><div _ngcontent-kbo-c106="" class="highlight-div-header"><div _ngcontent-kbo-c106="" class="highlight-div-header-left"><div _ngcontent-kbo-c106="" class="handle-button expand-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbo-c106="" class="highlight-div-header-right"><div _ngcontent-kbo-c106="" class="handle-button ai-button"></div><div _ngcontent-kbo-c106="" class="handle-button line-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbo-c106="" class="handle-button theme-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbo-c106="" class="handle-button copy-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Context</span>, <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">AbilityConstant</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[EventAbility]'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 获取eventHub</span></li><li>    <span class="hljs-keyword">let</span> eventhub = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>;</li><li>    <span class="hljs-comment">// 执行订阅操作</span></li><li>    eventhub.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">eventFunc</span>);</li><li>    eventhub.<span class="hljs-title function_">on</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 触发事件，完成相应的业务操作</span></li><li>    });</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">'Ability onCreate'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">eventFunc</span>(<span class="hljs-attr">argOne</span>: <span class="hljs-title class_">Context</span>, <span class="hljs-attr">argTwo</span>: <span class="hljs-title class_">Context</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'1. '</span> + <span class="hljs-string">`<span class="hljs-subst">${argOne}</span>, <span class="hljs-subst">${argTwo}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在UI中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-eventhub#eventhubemit" target="_blank">eventHub.emit()</a>方法触发该事件，在触发事件的同时，根据需要传入参数信息。</p>       <div _ngcontent-kbo-c106="" class="highlight-div"><div _ngcontent-kbo-c106="" class="highlight-div-header"><div _ngcontent-kbo-c106="" class="highlight-div-header-left"><div _ngcontent-kbo-c106="" class="handle-button expand-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbo-c106="" class="highlight-div-header-right"><div _ngcontent-kbo-c106="" class="handle-button ai-button"></div><div _ngcontent-kbo-c106="" class="handle-button line-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbo-c106="" class="handle-button theme-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbo-c106="" class="handle-button copy-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span>_EventHub {</li><li>  <span class="hljs-keyword">private</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">eventHubFunc</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 不带参数触发自定义“event1”事件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>);</li><li>    <span class="hljs-comment">// 带1个参数触发自定义“event1”事件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-number">1</span>);</li><li>    <span class="hljs-comment">// 带2个参数触发自定义“event1”事件</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'event1'</span>, <span class="hljs-number">2</span>, <span class="hljs-string">'test'</span>);</li><li>    <span class="hljs-comment">// 开发者可以根据实际的业务场景设计事件传递的参数</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-title class_">List</span>({ <span class="hljs-attr">initialIndex</span>: <span class="hljs-number">0</span> }) {</li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-comment">// ...</span></li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">eventHubFunc</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>              <span class="hljs-attr">message</span>: <span class="hljs-string">'EventHubFuncA'</span></li><li>            });</li><li>          })</li><li>        }</li><li>
</li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-title class_">ListItem</span>() {</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-comment">// ...</span></li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'event1'</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>              <span class="hljs-attr">message</span>: <span class="hljs-string">'EventHubFuncB'</span></li><li>            });</li><li>          })</li><li>        }</li><li>        <span class="hljs-comment">// ...</span></li><li>      }</li><li>      <span class="hljs-comment">// ...</span></li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在UIAbility的注册事件回调中可以得到对应的触发事件结果，运行日志结果如下所示。</p>       <div _ngcontent-kbo-c106="" class="highlight-div"><div _ngcontent-kbo-c106="" class="highlight-div-header"><div _ngcontent-kbo-c106="" class="highlight-div-header-left"><div _ngcontent-kbo-c106="" class="handle-button expand-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbo-c106="" class="highlight-div-header-right"><div _ngcontent-kbo-c106="" class="handle-button ai-button"></div><div _ngcontent-kbo-c106="" class="handle-button line-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbo-c106="" class="handle-button theme-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbo-c106="" class="handle-button copy-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbo-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">[</span>Example<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>Entry<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>EntryAbility<span class="hljs-punctuation">]</span> <span class="hljs-number">1.</span> <span class="hljs-punctuation">[</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">[</span>Example<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>Entry<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>EntryAbility<span class="hljs-punctuation">]</span> <span class="hljs-number">1.</span> <span class="hljs-punctuation">[</span><span class="hljs-number">1</span><span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">[</span>Example<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>Entry<span class="hljs-punctuation">]</span>.<span class="hljs-punctuation">[</span>EntryAbility<span class="hljs-punctuation">]</span> <span class="hljs-number">1.</span> <span class="hljs-punctuation">[</span><span class="hljs-number">2</span><span class="hljs-punctuation">,</span><span class="hljs-string">"test"</span><span class="hljs-punctuation">]</span></li></ol></pre></div></div></li>      <li>       <p>在自定义事件“event1”使用完成后，可以根据需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-eventhub#eventhuboff" target="_blank">eventHub.off()</a>方法取消该事件的订阅。</p>       <div _ngcontent-kbo-c106="" class="highlight-div"><div _ngcontent-kbo-c106="" class="highlight-div-header"><div _ngcontent-kbo-c106="" class="highlight-div-header-left"><div _ngcontent-kbo-c106="" class="handle-button expand-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kbo-c106="" class="highlight-div-header-right"><div _ngcontent-kbo-c106="" class="handle-button ai-button"></div><div _ngcontent-kbo-c106="" class="handle-button line-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kbo-c106="" class="handle-button theme-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kbo-c106="" class="handle-button copy-button"><div _ngcontent-kbo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kbo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onDestroy</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">eventHub</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'event1'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用appstoragelocalstorage进行数据同步">使用AppStorage/LocalStorage进行数据同步<i class="anchor-icon anchor-icon-link" anchorid="使用appstoragelocalstorage进行数据同步" tips="复制节点链接"></i></h2>          <p>ArkUI提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage">AppStorage</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>两种应用级别的状态管理方案，可用于实现应用级别和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>级别的数据同步。使用这些方案可以方便地管理应用状态，提高应用性能和用户体验。其中，AppStorage是一个全局的状态管理器，适用于多个UIAbility共享同一状态数据的情况；而LocalStorage则是一个局部的状态管理器，适用于单个UIAbility内部使用的状态数据。通过这两种方案，开发者可以更加灵活地控制应用状态，提高应用的可维护性和可扩展性。详细请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-application-state-management-overview">应用级变量的状态管理</a>。</p>    </div>   </div>   <div></div></div>