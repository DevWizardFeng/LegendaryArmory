<h1 _ngcontent-xny-c119="" class="doc-title ng-star-inserted" title="UIAbility组件生命周期"> UIAbility组件生命周期 </h1>

<div _ngcontent-xny-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>当用户在执行应用启动、应用前后台切换、应用退出等操作时，系统会触发相关应用组件的生命周期回调。其中，UIAbility组件的核心生命周期回调包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onforeground" target="_blank">onForeground</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onbackground" target="_blank">onBackground</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#ondestroy" target="_blank">onDestroy</a>。作为一种包含UI的应用组件，UIAbility的生命周期不可避免地与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-window-stage">WindowStage</a>的生命周期存在关联关系。</p>     <p>UIAbility的生命周期示意图如下所示。</p>     <p><span><img originheight="650" originwidth="665" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114907.37513680071500158581764515800817:50001231000000:2800:BB635DD2DCF664DBFF0B890B08B4A862B689CA893B1BCA836629532C6E308E08.png" width="665" height="650"></span></p>     <p>以下是UIAbility启动到前台和后台两种场景说明，以及生命周期回调流程讲解。</p>     <ul>      <li>       <p>UIAbility启动到前台，对应流程图参见上图。</p>       <ol>        <li>         <p>当用户启动一个UIAbility时，系统会依次触发onCreate()、onWindowStageCreate()、onForeground()生命周期回调。</p></li>        <li>         <p>当用户跳转到其他应用（当前UIAbility切换到后台）时，系统会触发onBackground()生命周期回调。</p></li>        <li>         <p>当用户再次将UIAbility切换到前台时，系统会依次触发onNewWant()、onForeground()生命周期回调。</p></li>       </ol></li>      <li>       <p>UIAbility启动到后台，对应流程图参见下图。</p>       <ol>        <li>         <p>当用户通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#startabilitybycall" target="_blank">UIAbilityContext.startAbilityByCall()</a>接口启动一个UIAbility到后台时，系统会依次触发onCreate()、onBackground()（不会执行onWindowStageCreate()生命周期回调）生命周期回调。</p></li>        <li>         <p>当用户将UIAbility拉到前台，系统会依次触发onNewWant()、onWindowStageCreate()、onForeground()生命周期回调。</p></li>       </ol>       <p><span><img originheight="613" originwidth="393" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114908.53084649841897609821925337446131:50001231000000:2800:4CB90790E6A5A55D4DE7A1755F8284912A494FC67FDDECE6B0316953016E1E0B.png" width="393" height="613"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="生命周期回调">生命周期回调<i class="anchor-icon anchor-icon-link" anchorid="生命周期回调" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>生命周期回调是在应用主线程执行，为了确保应用性能，建议在生命周期回调中，仅执行必要的轻量级操作。对于耗时任务，推荐采用异步处理或交由子线程执行，避免阻塞主线程。</li>        <li>如果需要感知UIAbility生命周期变化，开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextonabilitylifecycle" target="_blank">ApplicationContext注册接口</a>监听UIAbility生命周期变化。详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#监听uiability生命周期变化">监听UIAbility生命周期变化</a>。</li>       </ul>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="oncreate" class="firsth2">onCreate()<i class="anchor-icon anchor-icon-link" anchorid="oncreate" tips="复制节点链接"></i></h3>          <p>在首次创建UIAbility实例时，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#oncreate" target="_blank">onCreate()</a>回调。开发者可以在该回调中执行UIAbility整个生命周期中仅发生一次的启动逻辑。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-title function_">onCreate</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">launchParam</span>: <span class="hljs-title class_">AbilityConstant</span>.<span class="hljs-property">LaunchParam</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 执行UIAbility整个生命周期中仅发生一次的业务逻辑</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onwindowstagecreate">onWindowStageCreate()<i class="anchor-icon anchor-icon-link" anchorid="onwindowstagecreate" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>实例创建完成之后，在进入前台之前，系统会创建一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-window-stage">WindowStage</a>。WindowStage创建完成后会进入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onwindowstagecreate" target="_blank">onWindowStageCreate()</a>回调，开发者可以在该回调中进行UI加载、WindowStage的事件订阅。</p>     <p>在onWindowStageCreate()回调中通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#loadcontent9" target="_blank">loadContent()</a>方法设置应用要加载的页面，并根据需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-windowstage#onwindowstageevent9" target="_blank">on('windowStageEvent')</a>方法订阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-e#windowstageeventtype9" target="_blank">WindowStage的事件</a>（获焦/失焦、切到前台/切到后台、前台可交互/前台不可交互）。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>不同开发场景下<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-e#windowstageeventtype9" target="_blank">WindowStage事件</a>的时序可能存在差异，WindowStage的相关使用请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-window-stage">窗口开发指导</a>。</li>        <li>对于不同类型的产品，当应用主窗口从前台进入后台时，UIAbility生命周期的变化也会存在差异。详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/window-overview#不同设备生命周期的差异化行为">不同设备生命周期的差异化行为</a>。</li>       </ul>      </div></div></div>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 设置WindowStage的事件订阅（获焦/失焦、切到前台/切到后台、前台可交互/前台不可交互）</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>      windowStage.<span class="hljs-title function_">on</span>(<span class="hljs-string">'windowStageEvent'</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-attr">stageEventType</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span> = data;</li><li>        <span class="hljs-keyword">switch</span> (stageEventType) {</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">SHOWN</span>: <span class="hljs-comment">// 切到前台</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage foreground.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">ACTIVE</span>: <span class="hljs-comment">// 获焦状态</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage active.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">INACTIVE</span>: <span class="hljs-comment">// 失焦状态</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage inactive.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">HIDDEN</span>: <span class="hljs-comment">// 切到后台</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage background.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">RESUMED</span>: <span class="hljs-comment">// 前台可交互状态</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage resumed.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-keyword">case</span> <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStageEventType</span>.<span class="hljs-property">PAUSED</span>: <span class="hljs-comment">// 前台不可交互状态</span></li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`windowStage paused.`</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>          <span class="hljs-attr">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (exception) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>,</li><li>        <span class="hljs-string">`Failed to enable the listener for window stage event changes. Cause: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(exception)}</span>`</span>);</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`%{public}s`</span>, <span class="hljs-string">`Ability onWindowStageCreate`</span>);</li><li>    <span class="hljs-comment">// 设置UI加载</span></li><li>    windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// ...</span></li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onforeground">onForeground()<i class="anchor-icon anchor-icon-link" anchorid="onforeground" tips="复制节点链接"></i></h3>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>切换至前台时且UIAbility的UI可见之前，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onforeground" target="_blank">onForeground</a>回调。开发者可以在该回调中申请系统需要的资源，或者重新申请在onBackground()中释放的资源。系统回调该方法后，UIAbility实例进入前台状态，即UIAbility实例可以与用户交互的状态。UIAbility实例会一直处于这个状态，直到被某些动作打断（例如屏幕关闭、用户跳转到其他UIAbility）。</p>     <p>例如，应用已获得地理位置权限。在UI显示之前，开发者可以在onForeground()回调中开启定位功能，从而获取到当前的位置信息。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onForeground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 申请系统需要的资源，或者重新申请在onBackground()中释放的资源</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onbackground">onBackground()<i class="anchor-icon anchor-icon-link" anchorid="onbackground" tips="复制节点链接"></i></h3>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>的UI完全不可见之后，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onbackground" target="_blank">onBackground</a>回调，将UIAbility实例切换至后台状态。开发者可以在该回调中释放UI不可见时的无用资源，例如停止定位功能，以节省系统的资源消耗。</p>     <p>onBackground()执行时间较短，无法提供足够的时间做一些耗时动作。请勿在该方法中执行保存用户数据或执行数据库事务等耗时操作。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onBackground</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 释放UI不可见时无用的资源</span></li><li>  }</li><li>  <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onwindowstagewilldestroy">onWindowStageWillDestroy()<i class="anchor-icon anchor-icon-link" anchorid="onwindowstagewilldestroy" tips="复制节点链接"></i></h3>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>实例销毁之前，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onwindowstagewilldestroy12" target="_blank">onWindowStageWillDestroy()</a>回调。该回调在WindowStage销毁前执行，此时WindowStage可以使用。开发者可以在该回调中释放通过WindowStage获取的资源、注销WindowStage事件订阅等。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">DOMAIN_NUMBER</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span> = windowStage;</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageWillDestroy</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>    <span class="hljs-comment">// 释放通过windowStage对象获取的资源</span></li><li>    <span class="hljs-comment">// 在onWindowStageWillDestroy()中注销WindowStage事件订阅（获焦/失焦、切到前台/切到后台、前台可交互/前台不可交互）</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'windowStageEvent'</span>);</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> code = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">code</span>;</li><li>      <span class="hljs-keyword">let</span> message = (err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>).<span class="hljs-property">message</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">DOMAIN_NUMBER</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to disable the listener for windowStageEvent. Code is <span class="hljs-subst">${code}</span>, message is <span class="hljs-subst">${message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onwindowstagedestroy">onWindowStageDestroy()<i class="anchor-icon anchor-icon-link" anchorid="onwindowstagedestroy" tips="复制节点链接"></i></h3>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>实例销毁之前，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onwindowstagedestroy" target="_blank">onWindowStageDestroy()</a>回调，开发者可以在该回调中释放UI资源。该回调在WindowStage销毁后执行，此时WindowStage不可以使用。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-attr">windowStage</span>: <span class="hljs-variable language_">window</span>.<span class="hljs-property">WindowStage</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 加载UI资源</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onWindowStageDestroy</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 释放UI资源</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="ondestroy">onDestroy()<i class="anchor-icon anchor-icon-link" anchorid="ondestroy" tips="复制节点链接"></i></h3>          <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability" target="_blank">UIAbility</a>实例销毁之前，系统触发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#ondestroy" target="_blank">onDestroy</a>回调。该回调是UIAbility接收到的最后一个生命周期回调，开发者可以在onDestroy()回调中进行系统资源的释放、数据的保存等操作。</p>     <p>例如，开发者调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#terminateself" target="_blank">terminateSelf()</a>方法通知系统停止当前UIAbility实例时，系统会触发onDestroy()回调。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <ul>        <li>从API version 13开始，用户在最近任务列表中使用一键清理来关闭应用，对于无实况窗的应用将不会触发onDestroy()回调，而是会直接终止进程；对于有实况窗的应用会继续触发onDestroy()回调。</li>        <li>当在开发者模式下调试某个应用时，如果用户从最近任务列表中移除了该调试应用的一个任务，则该调试应用的进程会被强制销毁，不会触发onDestroy()回调。</li>       </ul>      </div></div></div>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIAbility</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onDestroy</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 系统资源的释放、数据的保存等</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="onnewwant">onNewWant()<i class="anchor-icon anchor-icon-link" anchorid="onnewwant" tips="复制节点链接"></i></h3>          <p>当应用的UIAbility实例已创建，再次调用方法启动该UIAbility实例时，系统触发该UIAbility的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#onnewwant" target="_blank">onNewWant()</a>回调。开发者可以在该回调中更新要加载的资源和数据等，用于后续的UI展示。</p>     <div _ngcontent-xny-c106="" class="highlight-div"><div _ngcontent-xny-c106="" class="highlight-div-header"><div _ngcontent-xny-c106="" class="highlight-div-header-left"><div _ngcontent-xny-c106="" class="handle-button expand-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xny-c106="" class="highlight-div-header-right"><div _ngcontent-xny-c106="" class="handle-button ai-button"></div><div _ngcontent-xny-c106="" class="handle-button line-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xny-c106="" class="handle-button theme-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xny-c106="" class="handle-button copy-button"><div _ngcontent-xny-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xny-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>
</li><li>  <span class="hljs-title function_">onNewWant</span>(<span class="hljs-params">want: Want, launchParam: AbilityConstant.LaunchParam</span>) {</li><li>    <span class="hljs-comment">// 更新资源、数据</span></li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>