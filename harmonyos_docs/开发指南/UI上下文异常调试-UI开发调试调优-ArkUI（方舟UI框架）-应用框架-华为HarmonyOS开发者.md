<h1 _ngcontent-cmp-c119="" class="doc-title ng-star-inserted" title="UI上下文异常调试"> UI上下文异常调试 </h1>

<div _ngcontent-cmp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本指导主要介绍如何解决因使用无效的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-uicontext" target="_blank">UIContext</a>导致文本显示异常的问题。当开发者使用了已失效的UIContext对象（通常是因为对应的UI实例已被销毁），可能导致后续UI操作无效。此类问题常见于多窗口场景。从API version 12开始，该问题也见于调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-applicationcontext#applicationcontextsetsupportedprocesscache12" target="_blank">setSupportedProcessCache</a>打开进程缓存后快速启动的情形。</p>    <div class="tiledSection">     <h2 id="定位uicontext错误问题">定位UIContext错误问题<i class="anchor-icon anchor-icon-link" anchorid="定位uicontext错误问题" tips="复制节点链接"></i></h2>          <p>出现以下异常或系统日志时，可能存在UIContext无效的问题：</p>     <ul>      <li>       <p>存在JS异常："Node Constructor error, param uiContext error"。</p>       <p>产生该异常的原因通常是在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-node">自定义节点</a>中使用了无效的UIContext，这可能导致后续UI操作被错误关联到该无效UIContext。</p></li>      <li>       <p>存在实例状态更新时，上下文实例ID大于等于100000且小于1000000的日志：</p>       <p>实例状态更新的日志格式为：</p>       <p>({currentId}:{trackedId}:{trackedReason})][{bundleName}][{moduleName}][{thisInstanceId}]: window {status}</p>       <p>各字段含义为：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.2.3.2.5.1.5.1.1" valign="top" width="25%">字段名</th>           <th align="left" class="cellrowborder" id="mcps1.3.2.3.2.5.1.5.1.2" valign="top" width="25%">类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.2.3.2.5.1.5.1.3" valign="top" width="25%">典型值</th>           <th align="left" class="cellrowborder" id="mcps1.3.2.3.2.5.1.5.1.4" valign="top" width="25%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="25%">{currentId}</td>           <td class="cellrowborder" valign="top" width="25%">整数</td>           <td class="cellrowborder" valign="top" width="25%">-1</td>           <td class="cellrowborder" valign="top" width="25%">上下文实例ID，应用正常的情况下，该字段应该为负数。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{trackedId}</td>           <td class="cellrowborder" valign="top" width="25%">整数</td>           <td class="cellrowborder" valign="top" width="25%">100000</td>           <td class="cellrowborder" valign="top" width="25%">当前可间接跟踪的实例ID，通常为正数，开发者可忽略。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{trackedReason}</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">singleton</td>           <td class="cellrowborder" valign="top" width="25%">间接跟踪的原因，开发者可不关注该字段。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{bundleName}</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">com.example.helloworld</td>           <td class="cellrowborder" valign="top" width="25%">应用的bundleName。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{moduleName}</td>           <td class="cellrowborder" valign="top" width="25%">字符串</td>           <td class="cellrowborder" valign="top" width="25%">entry</td>           <td class="cellrowborder" valign="top" width="25%">当前模块的moduleName。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{thisInstanceId}</td>           <td class="cellrowborder" valign="top" width="25%">正数</td>           <td class="cellrowborder" valign="top" width="25%">100000</td>           <td class="cellrowborder" valign="top" width="25%">被通知UI实例的ID。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="25%">{status}</td>           <td class="cellrowborder" valign="top" width="25%">实例被通知的状态</td>           <td class="cellrowborder" valign="top" width="25%">focus</td>           <td class="cellrowborder" valign="top" width="25%">            <p>可选值为:</p>            <p>- focus：获焦</p>            <p>- unfocus：失焦</p>            <p>- foreground：前台</p>            <p>- background：后台</p>            <p>- destroy：销毁</p></td>          </tr>                 </tbody></table></div>       </div>       <p>可使用如下正则表达式匹配相关日志：</p>       <p>\(-?\d+:-?\d+:(scope|active|default|singleton|foreground|undefined)\)\] \[[a-z0-9.]+\]\[[a-zA-Z][0-9a-zA-Z_.]*\]\[\d+\]: window (focus|unfocus|foreground|background|destroy)</p>       <p><strong>示例说明</strong></p>       <ul>        <li>         <p>正确日志示例：</p>         <p>(-2:100000:singleton)] [com.example.helloworld][entry][100000]: window foreground</p></li>        <li>         <p>异常日志示例：</p>         <p>(100000:100000:scoped)] [com.example.helloworld][entry][100001]: window background</p>         <p>该异常日志说明存在错误跟踪ID为100000的UI实例。</p></li>        <li>         <p>若前文出现以下特定格式的日志：</p>         <p>(-2:100000:singleton)] [com.example.helloworld][entry][100000]: window destroy</p>         <p>表示ID为100000的UI实例已销毁，后续UI操作可能受其上下文影响。</p></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="解决uicontext错误导致的显示异常问题">解决UIContext错误导致的显示异常问题<i class="anchor-icon anchor-icon-link" anchorid="解决uicontext错误导致的显示异常问题" tips="复制节点链接"></i></h2>          <p><strong>问题现象</strong></p>     <p>当发生以下问题时，可根据上文的关键日志或异常进行判断：</p>     <ol>      <li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#setstyledstring12" target="_blank">setStyledString</a>方法设置字体大小时，字体大小未发生预期变化。</li>      <li>使用UIContext成员方法时，界面没有响应或显示异常。</li>     </ol>     <p><strong>解决措施</strong></p>     <p>重新获取有效的UIContext对象。可通过以下方式获取：</p>     <ul>      <li>使用自定义组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-api#getuicontext" target="_blank">getUIContext</a>方法获取。</li>      <li>通过窗口的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getuicontext10" target="_blank">getUIContext</a>方法获取。</li>     </ul>    </div>   </div>   <div></div></div>