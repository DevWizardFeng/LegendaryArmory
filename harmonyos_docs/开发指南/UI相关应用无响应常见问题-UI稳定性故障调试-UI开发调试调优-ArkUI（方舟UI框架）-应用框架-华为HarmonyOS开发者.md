<h1 _ngcontent-kxc-c119="" class="doc-title ng-star-inserted" title="UI相关应用无响应常见问题"> UI相关应用无响应常见问题 </h1>

<div _ngcontent-kxc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本文档收集整理了一些常见的会导致应用无响应的ArkUI API错误用法，旨在帮助开发者了解这些错误用法，从而避免在实际应用开发过程中犯类似错误。</p>    <div class="tiledSection">     <h2 id="网络图片使用syncload同步下载">网络图片使用syncLoad同步下载<i class="anchor-icon anchor-icon-link" anchorid="网络图片使用syncload同步下载" tips="复制节点链接"></i></h2>          <p><strong>问题现象</strong></p>     <p>应用无响应，系统生成相应的AppFreeze问题日志，日志中有如下主线程调用栈：</p>     <div _ngcontent-kxc-c106="" class="highlight-div"><div _ngcontent-kxc-c106="" class="highlight-div-header"><div _ngcontent-kxc-c106="" class="highlight-div-header-left"><div _ngcontent-kxc-c106="" class="handle-button expand-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kxc-c106="" class="highlight-div-header-right"><div _ngcontent-kxc-c106="" class="handle-button ai-button"></div><div _ngcontent-kxc-c106="" class="handle-button line-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kxc-c106="" class="handle-button theme-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kxc-c106="" class="handle-button copy-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kxc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-number">00</span> pc <span class="hljs-number">00000000001b</span>5904 /system/lib/ld-musl-aarch64.so<span class="hljs-number">.1</span>(__timedwait_cp+<span class="hljs-number">192</span>)</li><li>#<span class="hljs-number">01</span> pc <span class="hljs-number">00000000001b</span>7908 /system/lib/ld-musl-aarch64.so<span class="hljs-number">.1</span>(__pthread_cond_timedwait+<span class="hljs-number">188</span>)</li><li>#<span class="hljs-number">02</span> pc <span class="hljs-number">00000000000</span>c11c0 /system/lib64/libc++.<span class="hljs-built_in">so</span>(std::__h::condition_variable::__do_timed_wait(std::__h::unique_lock&lt;std::__h::mutex&gt;&amp;, std::__h::chrono::time_point&lt;std::__h::chrono::system_clock, std::__h::chrono::duration&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>, std::__h::ratio&lt;<span class="hljs-number">1l</span>, <span class="hljs-number">1000000000l</span>&gt;&gt;&gt;)+<span class="hljs-number">108</span>)</li><li>#<span class="hljs-number">03</span> pc <span class="hljs-number">0000000000019</span>ed0 /system/lib64/platformsdk/libace_network.z.<span class="hljs-built_in">so</span>(std::__h::cv_status std::__h::condition_variable::wait_for&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>, std::__h::ratio&lt;<span class="hljs-number">1l</span>, <span class="hljs-number">1000000000l</span>&gt;&gt;(std::__h::unique_lock&lt;std::__h::mutex&gt;&amp;, std::__h::chrono::duration&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>, std::__h::ratio&lt;<span class="hljs-number">1l</span>, <span class="hljs-number">1000000000l</span>&gt;&gt; <span class="hljs-type">const</span>&amp;)+<span class="hljs-number">92</span>)</li><li>#<span class="hljs-number">04</span> pc <span class="hljs-number">0000000000019e5</span>c /system/lib64/platformsdk/libace_network.z.so</li><li>#<span class="hljs-number">05</span> pc <span class="hljs-number">000000000001b</span>c10 /system/lib64/platformsdk/libace_network.z.<span class="hljs-built_in">so</span>(OHOS::Ace::DownloadManagerImpl::<span class="hljs-built_in">HandleDownloadResult</span>(<span class="hljs-type">bool</span>, OHOS::Ace::DownloadCallback&amp;&amp;, std::__h::shared_ptr&lt;OHOS::Ace::DownloadCondition&gt; <span class="hljs-type">const</span>&amp;, <span class="hljs-type">int</span>, std::__h::basic_string&lt;<span class="hljs-type">char</span>, std::__h::char_traits&lt;<span class="hljs-type">char</span>&gt;, std::__h::allocator&lt;<span class="hljs-type">char</span>&gt;&gt; <span class="hljs-type">const</span>&amp;)+<span class="hljs-number">248</span>)</li><li>#<span class="hljs-number">06</span> pc <span class="hljs-number">0000000000018564</span> /system/lib64/platformsdk/libace_network.z.<span class="hljs-built_in">so</span>(OHOS::Ace::DownloadManagerImpl::<span class="hljs-built_in">DownloadSync</span>(OHOS::Ace::DownloadCallback&amp;&amp;, std::__h::basic_string&lt;<span class="hljs-type">char</span>, std::__h::char_traits&lt;<span class="hljs-type">char</span>&gt;, std::__h::allocator&lt;<span class="hljs-type">char</span>&gt;&gt; <span class="hljs-type">const</span>&amp;, <span class="hljs-type">int</span>, <span class="hljs-type">int</span>)+<span class="hljs-number">1096</span>)</li><li>#<span class="hljs-number">07</span> pc <span class="hljs-number">000000000096f</span>4a8 /system/lib64/platformsdk/libace_compatible.z.<span class="hljs-built_in">so</span>(OHOS::Ace::NG::ImageLoadingContext::<span class="hljs-built_in">PerformDownload</span>()+<span class="hljs-number">448</span>)</li></ol></pre></div></div>     <p><strong>可能原因</strong></p>     <p>应用设置的syncLoad接口用于同步下载网络图片，系统将在主线程中加载图片。在网络条件不佳时，可能会导致任务阻塞。</p>     <p><strong>解决措施</strong></p>     <p>网络图片加载不应设置syncLoad=true。</p>     <p><strong>参考链接</strong></p>     <p>相关接口详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-image#syncload8" target="_blank">syncLoad</a>。</p>    </div>    <div class="tiledSection">     <h2 id="在ui主线程执行耗时任务">在UI主线程执行耗时任务<i class="anchor-icon anchor-icon-link" anchorid="在ui主线程执行耗时任务" tips="复制节点链接"></i></h2>          <p><strong>问题现象</strong></p>     <p>应用无响应，系统生成相应的AppFreeze日志，日志中有如下非主线程调用栈：</p>     <div _ngcontent-kxc-c106="" class="highlight-div"><div _ngcontent-kxc-c106="" class="highlight-div-header"><div _ngcontent-kxc-c106="" class="highlight-div-header-left"><div _ngcontent-kxc-c106="" class="handle-button expand-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-kxc-c106="" class="highlight-div-header-right"><div _ngcontent-kxc-c106="" class="handle-button ai-button"></div><div _ngcontent-kxc-c106="" class="handle-button line-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-kxc-c106="" class="handle-button theme-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-kxc-c106="" class="handle-button copy-button"><div _ngcontent-kxc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-kxc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-number">00</span> pc <span class="hljs-number">00000000001b</span>9a7c /system/lib/ld-musl-aarch64.so<span class="hljs-number">.1</span>(__timedwait_cp+<span class="hljs-number">148</span>)</li><li>#<span class="hljs-number">01</span> pc <span class="hljs-number">00000000001b</span>bacc /system/lib/ld-musl-aarch64.so<span class="hljs-number">.1</span>(pthread_cond_timedwait+<span class="hljs-number">168</span>)</li><li>#<span class="hljs-number">02</span> pc <span class="hljs-number">00000000000</span>c115c /system/lib64/libc++.<span class="hljs-built_in">so</span>(std::__h::condition_variable::<span class="hljs-built_in">wait</span>(std::__h::unique_lock&lt;std::__h::mutex&gt;&amp;)+<span class="hljs-number">20</span>)</li><li>#<span class="hljs-number">03</span> pc <span class="hljs-number">00000000000</span>c1d1c /system/lib64/libc++.<span class="hljs-built_in">so</span>(std::__h::__assoc_sub_state::__sub_wait(std::__h::unique_lock&lt;std::__h::mutex&gt;&amp;)+<span class="hljs-number">48</span>)</li><li>#<span class="hljs-number">04</span> pc <span class="hljs-number">0000000000b</span>af2e4 /system/lib64/platformsdk/libace_compatible.z.<span class="hljs-built_in">so</span>(std::__h::__assoc_state&lt;<span class="hljs-type">int</span>&gt;::<span class="hljs-built_in">copy</span>()+<span class="hljs-number">64</span>)</li><li>#<span class="hljs-number">05</span> pc <span class="hljs-number">0000000000b</span>af0e0 /system/lib64/platformsdk/libace_compatible.z.<span class="hljs-built_in">so</span>(OHOS::Ace::CancelableCallback&lt;<span class="hljs-built_in">void</span> ()&gt;::<span class="hljs-built_in">WaitUntilComplete</span>(std::__h::chrono::duration&lt;<span class="hljs-type">long</span> <span class="hljs-type">long</span>, std::__h::ratio&lt;<span class="hljs-number">1l</span>, <span class="hljs-number">1000l</span>&gt;&gt;)+<span class="hljs-number">120</span>)</li><li>#<span class="hljs-number">06</span> pc <span class="hljs-number">0000000000b</span>aed68 /system/lib64/platformsdk/libace_compatible.z.so</li><li>#<span class="hljs-number">07</span> pc <span class="hljs-number">0000000000b</span>ae640 /system/lib64/platformsdk/libace_compatible.z.<span class="hljs-built_in">so</span>(OHOS::Ace::TaskExecutor::<span class="hljs-built_in">PostSyncTask</span>(std::__h::function&lt;<span class="hljs-built_in">void</span> ()&gt;&amp;&amp;, OHOS::Ace::TaskExecutor::TaskType, std::__h::basic_string&lt;<span class="hljs-type">char</span>, std::__h::char_traits&lt;<span class="hljs-type">char</span>&gt;, std::__h::allocator&lt;<span class="hljs-type">char</span>&gt;&gt; <span class="hljs-type">const</span>&amp;, OHOS::Ace::PriorityType) <span class="hljs-type">const</span>+<span class="hljs-number">220</span>)</li><li>#<span class="hljs-number">08</span> pc <span class="hljs-number">000000000107</span>d9d0 /system/lib64/platformsdk/libace_compatible.z.so</li></ol></pre></div></div>     <p><strong>可能原因</strong></p>     <p>该现象表示正在向主线程抛出同步任务。需要等待主线程执行完该任务后，才能继续执行后续逻辑。通常，这种情况是由于主线程正在执行一个大粒度的任务，与当前堆栈无关。</p>     <p><strong>解决措施</strong></p>     <p>该堆栈常见于多个进程的IPC互锁过程中，此处仅为互锁环的一部分，且无法直接打破。需要从其他角度解决互锁问题，比如分析等待的目标线程在处理什么任务，是否耗时任务，或是其它同步等待任务。</p>    </div>   </div>   <div></div></div>