<h1 _ngcontent-owg-c119="" class="doc-title ng-star-inserted" title="User-Agent开发指导"> User-Agent开发指导 </h1>

<div _ngcontent-owg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>User-Agent（简称UA）是一个特殊的字符串，包含设备类型、操作系统及版本等关键信息。在Web开发中，这个字符串使服务器能够识别请求的来源设备及其特性，从而根据这些信息提供定制化的内容和服务。如果页面无法正确识别UA，可能会导致多种异常情况。例如，为移动设备优化的页面布局可能会在桌面设备上显示错乱，反之亦然。此外，某些特定的浏览器功能或CSS样式可能仅在特定的浏览器版本中受支持，如果页面无法根据UA字符串做出正确的判断，就可能导致渲染问题或逻辑错误。</p>  <div class="tiledSection"><h2 id="默认user-agent结构">默认User-Agent结构<i class="anchor-icon anchor-icon-link" anchorid="默认user-agent结构" tips="复制节点链接"></i></h2><ul><li><p>默认User-Agent定义</p>  <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Mozilla</span>/<span class="hljs-number">5.0</span> ({<span class="hljs-title class_">DeviceType</span>}; {<span class="hljs-title class_">OSName</span>} {<span class="hljs-title class_">OSVersion</span>}) <span class="hljs-title class_">AppleWebKit</span>/<span class="hljs-number">537.36</span> (<span class="hljs-variable constant_">KHTML</span>, like <span class="hljs-title class_">Gecko</span>) <span class="hljs-title class_">Chrome</span>/{<span class="hljs-title class_">ChromeCompatibleVersion</span>}<span class="hljs-number">.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-title class_">Safari</span>/<span class="hljs-number">537.36</span>  <span class="hljs-title class_">ArkWeb</span>/{<span class="hljs-title class_">ArkWeb</span> <span class="hljs-title class_">VersionCode</span>} {<span class="hljs-title class_">DeviceCompat</span>} {扩展区}</li></ol></pre></div></div>  </li><li><p>举例说明</p>  <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Mozilla</span>/<span class="hljs-number">5.0</span> (<span class="hljs-title class_">Phone</span>; <span class="hljs-title class_">OpenHarmony</span> <span class="hljs-number">5.0</span>) <span class="hljs-title class_">AppleWebKit</span>/<span class="hljs-number">537.36</span> (<span class="hljs-variable constant_">KHTML</span>, like <span class="hljs-title class_">Gecko</span>) <span class="hljs-title class_">Chrome</span>/<span class="hljs-number">114.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <span class="hljs-title class_">Safari</span>/<span class="hljs-number">537.36</span>  <span class="hljs-title class_">ArkWeb</span>/<span class="hljs-number">4.1</span><span class="hljs-number">.6</span><span class="hljs-number">.1</span> <span class="hljs-title class_">Mobile</span></li></ol></pre></div></div>  </li><li><p>字段说明</p>   <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.3.2.1.3.1.1" valign="top" width="50%">字段</th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.2.1.3.1.2" valign="top" width="50%">含义</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">DeviceType</td> <td class="cellrowborder" valign="top" width="50%"><p>当前的设备类型。</p> <p>取值范围：</p> <p>- Phone：<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/phone-0000001776694632" target="_blank">手机</a>设备</p> <p>- Tablet：<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/pad-0000001823654157" target="_blank">平板</a>设备</p> <p>- PC：<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/2in1-0000001777531700" target="_blank">2in1</a>设备</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OSName</td> <td class="cellrowborder" valign="top" width="50%"><p>基础<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/glossary#section15569823194110" target="_blank">操作系统名称</a>。</p> <p>默认取值：OpenHarmony</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OSVersion</td> <td class="cellrowborder" valign="top" width="50%"><p>基础操作系统版本，两位数字，M.S。</p> <p>通过系统参数const.ohos.fullname解析版本号得到，取版本号部分M.S前两位。</p> <p>默认取值：例如5.0</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">ChromeCompatibleVersion</td> <td class="cellrowborder" valign="top" width="50%"><p>兼容Chrome主版本的版本号，从114版本开始演进。</p> <p>默认取值：114</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">ArkWeb</td> <td class="cellrowborder" valign="top" width="50%"><p>HarmonyOS版本Web内核名称。</p> <p>默认取值：ArkWeb</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">ArkWeb VersionCode</td> <td class="cellrowborder" valign="top" width="50%"><p>ArkWeb版本号，格式a.b.c.d。</p> <p>默认取值：例如4.1.6.1</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">DeviceCompat</td> <td class="cellrowborder" valign="top" width="50%"><p>前向兼容字段。</p> <p>默认取值：Mobile</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">扩展区</td> <td class="cellrowborder" valign="top" width="50%"><p>三方应用可以扩展的字段。</p> <p>三方应用使用ArkWeb组件时，可以做UA扩展，例如加入APP相关信息标识。</p> </td> </tr>  </tbody></table></div> </div>  </li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"> <ul><li><p>当前默认User-Agent的ArkWeb字段前有两个空格。</p>  </li><li><p>当前通过User-Agent中是否含有"Mobile"字段来判断是否开启前端HTML页面中meta标签的viewport属性。当User-Agent中不含有"Mobile"字段时，meta标签中viewport属性默认关闭，此时可通过显性设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#metaviewport12" target="_blank">metaViewport</a>属性为true来覆盖关闭状态。</p>  </li><li><p>建议通过OpenHarmony关键字识别是否是HarmonyOS设备，同时可以通过DeviceType识别设备类型用于不同设备上的页面显示（ArkWeb关键字表示设备使用的web内核，OpenHarmony关键字表示设备使用的操作系统，因此推荐通过OpenHarmony关键字识别是否是HarmonyOS设备）。</p>  </li><li><p>{DistributionOSName}和{DistributionOSVersion}字段在API version 15之前的版本中未启用，从API version 15版本开始不在默认User-Agent中体现。</p>  </li></ul>  </div></div></div> </div>  <div class="tiledSection"><h2 id="自定义user-agent结构">自定义User-Agent结构<i class="anchor-icon anchor-icon-link" anchorid="自定义user-agent结构" tips="复制节点链接"></i></h2><p>在下面的示例中，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#getuseragent" target="_blank">getUserAgent()</a>接口获取当前默认的用户代理（User-Agent）字符串。这一接口提供的默认User-Agent信息为开发者提供了基础，使开发者能够基于这个默认信息进行定制或扩展。</p> <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getUserAgent'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> userAgent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getUserAgent</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"userAgent: "</span> + userAgent);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>以下示例通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setcustomuseragent10" target="_blank">setCustomUserAgent()</a>接口设置自定义用户代理，但请注意，此操作会覆盖系统的用户代理。因此，我们建议将扩展字段追加在默认用户代理的末尾，比如三方应用程序的开发场景，可以在系统默认用户代理字符串的末尾追加特定的APP标识，这样既能保留原有用户代理信息，又能增加自定义的应用识别信息。</p> <p>当Web组件src设置了url时，建议在onControllerAttached回调事件中设置User-Agent，设置方式请参考示例。不建议将User-Agent设置在onLoadIntercept回调事件中，会概率性出现设置失败。如果未在onControllerAttached回调事件中设置User-Agent。再调用setCustomUserAgent方法时，可能会出现加载的页面与实际设置User-Agent不符的异常现象。</p> <p>当Web组件src设置为空字符串时，建议先调用setCustomUserAgent方法设置User-Agent，再通过loadUrl加载具体页面。</p> <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-comment">// 三方应用相关信息标识</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">customUserAgent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">' DemoApp'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>      .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"onControllerAttached"</span>);</li><li>        <span class="hljs-keyword">try</span> {</li><li>          <span class="hljs-keyword">let</span> userAgent = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getUserAgent</span>() + <span class="hljs-variable language_">this</span>.<span class="hljs-property">customUserAgent</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">setCustomUserAgent</span>(userAgent);</li><li>        } <span class="hljs-keyword">catch</span> (error) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>        }</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>从API version 20开始，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setappcustomuseragent20" target="_blank">setAppCustomUserAgent()</a>接口设置应用级自定义用户代理，或者通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setuseragentforhosts20" target="_blank">setUserAgentForHosts()</a>对特定网站设置应用级自定义用户代理，覆盖系统的用户代理，应用内所有Web组件生效。</p> <p>建议在Web组件创建前先调用静态接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#getdefaultuseragent14" target="_blank">getDefaultUserAgent</a>获取默认的用户代理（User-Agent）字符串，然后调用setAppCustomUserAgent，setUserAgentForHosts方法设置User-Agent，再创建指定src的Web组件或通过loadUrl加载具体页面。</p> <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">initializeWebEngine</span>();</li><li>      <span class="hljs-keyword">let</span> defaultUserAgent = webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">getDefaultUserAgent</span>();</li><li>      <span class="hljs-keyword">let</span> appUA = defaultUserAgent + <span class="hljs-string">" appUA"</span>;</li><li>      webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setAppCustomUserAgent</span>(appUA);</li><li>      webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setUserAgentForHosts</span>(</li><li>        appUA,</li><li>        [</li><li>          <span class="hljs-string">"www.example.com"</span>,</li><li>          <span class="hljs-string">"www.baidu.com"</span></li><li>        ]</li><li>      );</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> <p>在下面的示例中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#getcustomuseragent10" target="_blank">getCustomUserAgent()</a>接口获取自定义用户代理。</p> <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">userAgent</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'getCustomUserAgent'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">userAgent</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getCustomUserAgent</span>();</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"userAgent: "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">userAgent</span>);</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="相关user-agent接口优先级">相关User-Agent接口优先级<i class="anchor-icon anchor-icon-link" anchorid="相关user-agent接口优先级" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.1" valign="top" width="33.33333333333333%">接口名称</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.2" valign="top" width="33.33333333333333%">优先级</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">setCustomUserAgent</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">最高</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">对调用的Web组件生效。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">setUserAgentForHosts</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">低于setCustomUserAgent</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">对应用中所有Web组件访问指定网站生效。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">setAppCustomUserAgent</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">低于setUserAgentForHosts</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">对应用中所有Web组件生效。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">ArkWeb默认UA</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">最低</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">对应用中所有Web组件生效，只读，通过getDefaultUserAgent获取。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="如何通过user-agent来识别harmonyos操作系统中不同设备" class="firsth2">如何通过User-Agent来识别HarmonyOS操作系统中不同设备<i class="anchor-icon anchor-icon-link" anchorid="如何通过user-agent来识别harmonyos操作系统中不同设备" tips="复制节点链接"></i></h3><p>HarmonyOS设备的识别主要通过User-Agent中的系统、系统版本和设备类型三个维度来判断。建议同时检查系统、系统版本和设备类型，以确保更准确的设备识别。</p> <ol><li><p>系统识别</p>  <p>通过User-Agent中的{OSName}字段识别HarmonyOS系统。</p>  <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">isHarmonyOS</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-regexp">/OpenHarmony/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);</li></ol></pre></div></div>  </li><li><p>系统版本识别</p>  <p>通过User-Agent中的{OSName}和{OSVersion}字段识别HarmonyOS系统及系统版本。格式为：OpenHarmony + 版本号。</p>  <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 检测是否是HarmonyOS系统</span></li><li><span class="hljs-keyword">const</span> matches = navigator.<span class="hljs-property">userAgent</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/OpenHarmony (\d+\.?\d*)/</span>);</li><li>matches?.<span class="hljs-property">length</span> &amp;&amp; <span class="hljs-title class_">Number</span>(matches[<span class="hljs-number">1</span>]) &gt; <span class="hljs-number">0</span></li><li><span class="hljs-comment">// 检测是否是HarmonyOS NEXT系统</span></li><li><span class="hljs-keyword">const</span> matches = navigator.<span class="hljs-property">userAgent</span>.<span class="hljs-title function_">match</span>(<span class="hljs-regexp">/OpenHarmony (\d+\.?\d*)/</span>);</li><li>matches?.<span class="hljs-property">length</span> &amp;&amp; <span class="hljs-title class_">Number</span>(matches[<span class="hljs-number">1</span>]) &gt;= <span class="hljs-number">5</span>;</li></ol></pre></div></div>  </li><li><p>设备类型识别</p>  <p> 通过deviceType字段来识别不同设备类型。</p>  <div _ngcontent-owg-c106="" class="highlight-div"><div _ngcontent-owg-c106="" class="highlight-div-header"><div _ngcontent-owg-c106="" class="highlight-div-header-left"><div _ngcontent-owg-c106="" class="handle-button expand-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owg-c106="" class="highlight-div-header-right"><div _ngcontent-owg-c106="" class="handle-button ai-button"></div><div _ngcontent-owg-c106="" class="handle-button line-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owg-c106="" class="handle-button theme-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owg-c106="" class="handle-button copy-button"><div _ngcontent-owg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owg-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 检测是否为手机设备</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">isPhone</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-regexp">/Phone/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);</li><li>
</li><li><span class="hljs-comment">// 检测是否为平板设备</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">isTablet</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-regexp">/Tablet/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);</li><li>
</li><li><span class="hljs-comment">// 检测是否为2in1设备</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-title function_">is2in1</span> = (<span class="hljs-params"></span>) =&gt; <span class="hljs-regexp">/PC/i</span>.<span class="hljs-title function_">test</span>(navigator.<span class="hljs-property">userAgent</span>);</li></ol></pre></div></div>  </li></ol> </div>  <div class="tiledSection"><h3 id="如何模拟harmonyos操作系统的user-agent进行前端调试">如何模拟HarmonyOS操作系统的User-Agent进行前端调试<i class="anchor-icon anchor-icon-link" anchorid="如何模拟harmonyos操作系统的user-agent进行前端调试" tips="复制节点链接"></i></h3><p>在Windows/Mac/Linux等操作系统中，可以通过Chrome/Edge/Firefox等浏览器DevTools提供的User-Agent复写能力，模拟HarmonyOS User-Agent。</p> </div>  <div class="tiledSection"><h3 id="如何在harmonyos中自定义user-agent以实现h5兼容性">如何在HarmonyOS中自定义User-Agent以实现H5兼容性<i class="anchor-icon anchor-icon-link" anchorid="如何在harmonyos中自定义user-agent以实现h5兼容性" tips="复制节点链接"></i></h3><p>HarmonyOS提供<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#setcustomuseragent10" target="_blank">setCustomUserAgent</a>接口以支持User-Agent的自定义设置。为适配移动端H5页面通常依赖的UA标识检测（如Mobile、Android等），并确保不覆盖系统默认UA信息，推荐按如下方式操作：首先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#getdefaultuseragent14" target="_blank">getDefaultUserAgent</a>接口获取系统默认User-Agent字符串，随后将H5兼容所需的自定义标识字段追加至该字符串末尾，最后调用setCustomUserAgent接口设置修改后的完整UA字符串。</p> </div>  <div class="tiledSection"><h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2><ul><li><a href="https://gitcode.com/harmonyos_samples/web-user-agent" target="_blank">Web用户代理</a></li></ul> </div> </div> <div></div></div>