<h1 _ngcontent-cld-c119="" class="doc-title ng-star-inserted" title="V1-&gt;V2迁移指导概述"> V1-&gt;V2迁移指导概述 </h1>

<div _ngcontent-cld-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2><p>ArkUI状态管理的主要职责是：将可观察数据的变化自动同步到UI界面，实现数据驱动的UI刷新，使开发者能专注于UI界面的设计与实现。</p> <p>在状态管理框架的演进过程中，先后推出了状态管理V1和V2两个版本。V1强调组件层级的状态管理，而V2则增强了对数据对象的深度观察与管理能力，不再局限于组件层级。通过V2，开发者能够更灵活地控制数据和状态，实现更高效的UI刷新。具体V1和V2的区别可以参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state-management-overview">状态管理概述</a>。</p> </div>  <div class="tiledSection"><h2 id="v1v2使用指引">V1V2使用指引<i class="anchor-icon anchor-icon-link" anchorid="v1v2使用指引" tips="复制节点链接"></i></h2><ol><li>V2是V1的增强版本，正在持续迭代优化来为开发者提供更多功能和灵活性。</li><li>对于新开发的应用，建议直接使用V2版本范式进行开发。</li><li>对于已经使用V1的应用，如果V1的功能和性能已能满足需求，无需立即切换到V2。</li><li>对于需要在现阶段混用V1和V2的场景，请参阅<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-component-mixed-scenarios">混用文档</a>。编译器、工具链、DevEco Studio对某些不推荐的误用和混用场景会进行校验，虽然开发者可以通过特殊手段绕过这些校验，但强烈建议开发者遵循<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-component-mixed-scenarios">混用文档</a>的指导，避免因双重代理等问题给应用带来不确定性。</li></ol> </div>  <div class="tiledSection"><h2 id="迁移指南的目的">迁移指南的目的<i class="anchor-icon anchor-icon-link" anchorid="迁移指南的目的" tips="复制节点链接"></i></h2><ol><li>对希望将现有V1应用迁移到V2的开发者，提供系统化的模板和指导，帮助开发者完成V1到V2的迁移。</li><li>对希望逐步将V1应用过渡到V2的开发者，提供参考，结合本迁移文档与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-component-mixed-scenarios">混用文档</a>，帮助开发者实现逐步改造。</li><li>尚未开始开发应用但已熟悉V1状态管理规则的开发者，可以参考本迁移文档及V2文档，开始使用V2进行开发。</li></ol> </div>  <div class="tiledSection"><h2 id="v1v2能力对比及迁移简表">V1V2能力对比及迁移简表<i class="anchor-icon anchor-icon-link" anchorid="v1v2能力对比及迁移简表" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.1" valign="top" width="33.33333333333333%">V1装饰器名\场景</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.2" valign="top" width="33.33333333333333%">V2装饰器名\API</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>表明当前对象为可观察对象。但两者能力并不相同。 </p> <p>@Observed可观察第一层的属性，需要搭配<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink</a>使用才能生效。 </p> <p>@ObservedV2本身无观察能力，仅代表当前class可被观察，如果要观察其属性，需要搭配@Trace使用。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-class#objectlinkobservedtrack---observedv2trace">@ObjectLink/@Observed/@Track迁移场景</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-track">@Track</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>V1装饰器@Track为精确观察，不使用则无法做到类属性的精准观察。 </p> <p>V2@Trace装饰的属性可以被精确跟踪观察。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-class#objectlinkobservedtrack---observedv2trace">@ObjectLink/@Observed/@Track迁移场景</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#component">@Component</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>@Component为搭配V1状态变量使用的自定义组件装饰器。</p> <p>@ComponentV2为搭配V2状态变量使用的自定义组件装饰器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>无外部初始化：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a></p> <p>外部初始化一次：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-once">@Once</a></p> </td> <td class="cellrowborder" valign="top" width="33.33333333333333%">@State和@Local类似都是数据源的概念，在不需要外部传入初始化时，可直接迁移。如果需要外部传入初始化，则可以迁移为@Param@Once。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#state-local">@State迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">@Prop和@Param类似都是自定义组件参数的概念。当输入参数为复杂类型时，@Prop为深拷贝，@Param为引用。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#prop---param">@Prop迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-link">@Link</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-param">@Param</a><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-event">@Event</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">@Link是框架自己封装实现的双向同步，对于V2开发者可以通过@Param@Event自己实现双向同步。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#link---paramevent">@Link迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@ObjectLink</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">直接兼容，@ObjectLink需要被@Observed装饰的class的实例初始化，主要应用于观察嵌套类场景。在状态管理V2中可以使用@ObservedV2@Trace。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-class#objectlinkobservedtrack---observedv2trace">@ObjectLink/@Observed/@Track迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Provide</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Provider</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">兼容。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#provideconsume---providerconsumer">@Provide@Consume迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-provide-and-consume">@Consume</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-provider-and-consumer">@Consumer</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">兼容。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#provideconsume---providerconsumer">@Provide@Consume迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-watch">@Watch</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>@Watch用于监听V1状态变量的变化，具有监听状态变量本身和其第一层属性变化的能力。状态变量可观察到的变化会触发其@Watch监听事件。</p> <p>@Monitor用于监听V2状态变量的变化，搭配@Trace使用，可有深层监听的能力。状态变量在一次事件中多次变化时，仅会以最终的结果判断是否触发@Monitor监听事件。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#watch---monitor">@Watch迁移场景</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">重复计算</td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-computed">@Computed</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">状态管理V1无计算属性相关能力，状态管理V2可使用@Computed避免重复计算。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component#computed">@Computed使用场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">@ObservedV2@Trace</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">兼容。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#localstorage-observedv2trace">LocalStorage迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage">AppStorage</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-appstoragev2">AppStorageV2</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">兼容。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#appstorage-appstoragev2">AppStorage迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-environment">Environment</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">调用Ability接口获取系统环境变量</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">Environment获取环境变量能力和AppStorage耦合。在V2中可直接调用Ability接口获取系统环境变量。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#environment-调用ability接口直接获取系统环境变量">Environment迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-persiststorage">PersistentStorage</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-persistencev2">PersistenceV2</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">PersistentStorage持久化能力和AppStorage耦合，PersistenceV2持久化能力可独立使用。详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#persistentstorage-persistencev2">PersistentStorage迁移场景</a>。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="v1v2迁移场景">V1V2迁移场景<i class="anchor-icon anchor-icon-link" anchorid="v1v2迁移场景" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.1" valign="top" width="33.33333333333333%">场景</th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.2" valign="top" width="33.33333333333333%">涉及V2装饰器和API</th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">V1现有功能向V2的逐步迁移场景</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">@ObservedV2、@Trace和@Monitor</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">对于已经使用V1开发的应用，逐步迁移V2的示例，详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#v1现有功能向v2的逐步迁移场景">V1现有功能向V2的逐步迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">滑动组件场景</td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-makeobserved">makeObserved</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#滑动组件">滑动组件迁移场景</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-user-defined-modifier">Modifier</a>场景</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">makeObserved、@ObservedV2、@Trace</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">详情见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others#modifier">Modifier迁移场景</a>。</td> </tr>  </tbody></table></div> </div> </div> </div> <div> <ul class="ullinks"> <li class="ulchildlink"><strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-component">组件内状态变量迁移指导</a></strong><br> </li> <li class="ulchildlink"><strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-inner-class">数据对象状态变量的迁移指导</a></strong><br> </li> <li class="ulchildlink"><strong><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-v1-v2-migration-application-and-others">应用内状态变量和其他场景迁移指导</a></strong><br> </li> </ul> </div></div>