<h1 _ngcontent-mwg-c119="" class="doc-title ng-star-inserted" title="Vulkan平台"> Vulkan平台 </h1>

<div _ngcontent-mwg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section113441433181811">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section113441433181811" tips="复制节点链接"></i></h2>          <p>基于Vulkan图形API平台，系统送显模式的主要业务流程如下：</p>     <p></p>     <p><span><img originheight="893" originwidth="965" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114415.78088492185907354091061365654923:50001231000000:2800:58DB22288F1AC950862A900E025B20F857580B878B13F980CE8E0C4415DAE083.png" width="920" height="851.3575129533679"></span></p>     <ol>      <li>用户进入超帧适用的游戏场景。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#gac39606d03c25d898c656ab6973bb54f3" target="_blank">HMS_FG_CreateContext_VK</a>接口创建超帧上下文实例。如超帧上下文实例创建失败，则无需在步骤6提供当前帧信息，只需逐帧对场景进行渲染送显即可。</li>      <li>游戏应用调用接口配置超帧实例属性。包括调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga9262d0cde377603a6ccc1239095be917" target="_blank">HMS_FG_SetAlgorithmMode_VK</a>（必选）设置超帧算法模式并选择内插模式；按需调用其他插帧相关配置接口。</li>      <li>设置集成模式，选择系统侧集成调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#section1557174711191" target="_blank">HMS_FG_SetIntegrationMode_VK</a>（可选）设置超帧预测的集成信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_f_g___intergration_info" target="_blank">FG_IntegrationInfo</a>并选择系统侧送显；系统送显预测帧模式下可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#section9619114861914" target="_blank">HMS_FG_SetUiPredictionEnabled_VK</a>（可选）启用UI预测功能，不启用时预测帧会复用上一帧的UI进行展示；系统送显模式下可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#section655214195204" target="_blank">HMS_FG_SetTargetFps_VK</a>（可选）设置超帧后的目标帧率。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6871faa08ebf19d380301cf400c086a8" target="_blank">HMS_FG_Activate_VK</a>接口激活超帧上下文实例。</li>      <li>游戏应用渲染真实帧，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga21f86a194e72e99dd54fd39080385a37" target="_blank">HMS_FG_Dispatch_VK</a>接口并传入真实帧颜色信息、深度信息、相机矩阵信息，生成预测帧。</li>      <li>游戏应用完成UI绘制，并送显当前真实帧。</li>      <li>用户退出超帧适用的游戏场景。</li>      <li>游戏应用调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6be707669124e0bb6e5d61c2e24043be" target="_blank">HMS_FG_DestroyContext_VK</a>接口销毁超帧上下文实例并释放内存资源。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section831014124119">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section831014124119" tips="复制节点链接"></i></h2>          <p>本节阐述基于Vulkan图形API平台的系统送显模式调用示例。</p>    </div>    <ol>     <li>设置meta-data。在应用的module.json5中声明meta-data以支持系统送显模式。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>         <span class="hljs-comment">// 其他的配置项</span></li><li>         <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-attr">"metadata"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>            <span class="hljs-punctuation">{</span></li><li>                <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"GraphicsAccelerateKit_FusionAware"</span><span class="hljs-punctuation">,</span></li><li>                <span class="hljs-attr">"value"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Vulkan"</span></li><li>            <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>     <li>引用Graphics Accelerate Kit超帧头文件：frame_generation_vk.h。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 引用超帧frame_generation_vk.h头文件</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;graphics_game_sdk/frame_generation_vk.h&gt;</span></span></li></ol></pre></div></div></li>     <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#gac39606d03c25d898c656ab6973bb54f3" target="_blank">HMS_FG_CreateContext_VK</a>接口创建超帧上下文实例。如果返回nullptr，则说明超帧上下文实例创建失败，或当前硬件设备不支持开启超帧。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 变量声明</span></li><li>VkInstance vkInstance = VK_NULL_HANDLE;</li><li>VkPhysicalDevice vkPhysicalDevice = VK_NULL_HANDLE;</li><li>VkDevice vkDevice = VK_NULL_HANDLE;</li><li>
</li><li><span class="hljs-comment">// 创建超帧上下文实例</span></li><li>FG_ContextDescription_VK contextDescription{};</li><li>contextDescription.vkInstance = vkInstance;</li><li>contextDescription.vkPhysicalDevice = vkPhysicalDevice;</li><li>contextDescription.vkDevice = vkDevice;</li><li>contextDescription.framesInFlight = <span class="hljs-number">1</span>;</li><li>contextDescription.fnVulkanLoaderFunction = vkGetInstanceProcAddr;</li><li>FG_Context_VK* m_context = <span class="hljs-built_in">HMS_FG_CreateContext_VK</span>(&amp;contextDescription);</li><li><span class="hljs-keyword">if</span> (m_context == <span class="hljs-literal">nullptr</span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>     <li>调用超帧实例属性配置接口，超帧算法模式选择内插模式并指定系统送显预测帧模式。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 初始化超帧接口调用错误码</span></li><li>FG_ErrorCode errorCode = FG_SUCCESS;</li><li>
</li><li><span class="hljs-comment">// 超帧算法模式</span></li><li>FG_AlgorithmModeInfo aInfo{};</li><li>aInfo.predictionMode = FG_PREDICTION_MODE_INTERPOLATION;                  <span class="hljs-comment">// 内插模式</span></li><li>aInfo.meMode = FG_ME_MODE_BASIC;                                          <span class="hljs-comment">// 运动估计基础模式</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_SetAlgorithmMode_VK</span>(m_context, &amp;aInfo);                <span class="hljs-comment">// [必选] 设置超帧算法模式</span></li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 调用其他插帧相关配置接口</span></li><li><span class="hljs-comment">// ...</span></li><li>
</li><li><span class="hljs-comment">// 超帧预测的集成信息</span></li><li>FG_IntegrationInfo integrationInfo {};</li><li>integrationInfo.presentMode = FG_PRESENT_BY_SYSTEM;                       <span class="hljs-comment">// 预测帧送显模式</span></li><li>integrationInfo.textureCachedByGame = <span class="hljs-literal">false</span>;                              <span class="hljs-comment">// 输入的颜色纹理和深度纹理游戏侧缓存 系统不会复制一份再做预测 默认游戏不会缓存</span></li><li>integrationInfo.needFlipInputColor = <span class="hljs-literal">false</span>;                               <span class="hljs-comment">// 颜色纹理需要翻转 默认false</span></li><li>integrationInfo.needFlipOutputColor = <span class="hljs-literal">false</span>;                              <span class="hljs-comment">// 预测帧需要翻转 默认false</span></li><li><span class="hljs-comment">// 设置超帧预测的集成信息</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_SetIntegrationMode_VK</span>(m_context, &amp;integrationInfo);</li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// [可选] 设置是否启用UI预测功能，仅在系统送显模式下有效，在游戏送显模式下无效，接口不调用默认为false，预测帧会复用上一帧的UI进行展示</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_SetUiPredictionEnabled_VK</span>(m_context, <span class="hljs-literal">false</span>);</li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// [可选] 设置超帧后的目标帧率，仅在系统送显模式下且游戏上架后有效，在游戏送显模式下无效，接口不调用默认不会限制帧率，取决于游戏渲染帧率</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_SetTargetFps_VK</span>(m_context, <span class="hljs-number">60</span>);</li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>     <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6871faa08ebf19d380301cf400c086a8" target="_blank">HMS_FG_Activate_VK</a>接口激活超帧上下文实例。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 激活超帧上下文实例</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_Activate_VK</span>(m_context);</li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>     <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga7733f097ea5f4ae4d2aa53d11d7e60ff" target="_blank">HMS_FG_CreateImage_VK</a>接口创建真实渲染帧颜色缓冲区图像实例、深度模板缓冲区图像实例。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 变量声明</span></li><li>VkImage inputColorImage = VK_NULL_HANDLE;</li><li>VkImageView inputColorImageView = VK_NULL_HANDLE;</li><li>VkImage inputDepthStencilImage = VK_NULL_HANDLE;</li><li>VkImageView inputDepthStencilImageView = VK_NULL_HANDLE;</li><li>
</li><li><span class="hljs-comment">// 创建真实帧颜色缓冲区图像实例</span></li><li>FG_Image_VK* inputColor = <span class="hljs-built_in">HMS_FG_CreateImage_VK</span>(m_context, inputColorImage, inputColorImageView);</li><li><span class="hljs-keyword">if</span> (!inputColor) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li><li><span class="hljs-comment">// 创建真实帧深度模板缓冲区图像实例</span></li><li>FG_Image_VK* inputDepthStencil = <span class="hljs-built_in">HMS_FG_CreateImage_VK</span>(m_context, inputDepthStencilImage, inputDepthStencilImageView);</li><li><span class="hljs-keyword">if</span> (!inputDepthStencil) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>     <li>游戏运行中，渲染真实帧时，缓存颜色信息、深度信息和相机矩阵等属性信息。渲染预测帧时，需调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga21f86a194e72e99dd54fd39080385a37" target="_blank">HMS_FG_Dispatch_VK</a>接口并传入真实帧属性信息，指定预测帧缓冲区索引，生成预测帧。游戏送显自己真实帧，系统会在真实帧和上一帧间完成预测帧的展示。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 帧循环</span></li><li><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>) {</li><li>    <span class="hljs-comment">// 真实帧渲染阶段</span></li><li>    <span class="hljs-comment">// 渲染当前帧渲染画面，缓存颜色、深度、相机矩阵等信息，用于下一帧预测帧生成</span></li><li>    <span class="hljs-comment">// ...</span></li><li>
</li><li>    <span class="hljs-comment">// 绘制真实帧</span></li><li>    <span class="hljs-comment">// ...</span></li><li>
</li><li>    <span class="hljs-comment">// 绘制UI</span></li><li>    <span class="hljs-comment">// ...</span></li><li>
</li><li>    <span class="hljs-comment">// 预测帧渲染阶段           </span></li><li>    <span class="hljs-comment">// 设置预测帧生成前真实帧颜色缓冲区同步状态</span></li><li>    FG_ImageSync_VK inputColorInitImageSync{};</li><li>    inputColorInitImageSync.stages = VK_PIPELINE_STAGE_COLOR_ATTACHMENT_OUTPUT_BIT;</li><li>    inputColorInitImageSync.layout = VK_IMAGE_LAYOUT_COLOR_ATTACHMENT_OPTIMAL;</li><li>    inputColorInitImageSync.accessMask = VK_ACCESS_COLOR_ATTACHMENT_WRITE_BIT;</li><li>
</li><li>    <span class="hljs-comment">// 设置预测帧生成后真实帧颜色缓冲区同步状态</span></li><li>    FG_ImageSync_VK inputColorFinalImageSync{};</li><li>    inputColorFinalImageSync.stages = VK_PIPELINE_STAGE_TRANSFER_BIT;</li><li>    inputColorFinalImageSync.layout = VK_IMAGE_LAYOUT_TRANSFER_SRC_OPTIMAL;</li><li>    inputColorFinalImageSync.accessMask = VK_ACCESS_TRANSFER_READ_BIT;</li><li>
</li><li>    <span class="hljs-comment">// 创建真实帧颜色缓冲区图像属性实例</span></li><li>    FG_ImageInfo_VK inputColorImageInfo{};</li><li>    inputColorImageInfo.image = inputColor;</li><li>    inputColorImageInfo.initialSync = inputColorInitImageSync;</li><li>    inputColorImageInfo.finalSync = inputColorFinalImageSync;</li><li>
</li><li>    <span class="hljs-comment">// 设置预测帧生成前深度模板缓冲区同步状态</span></li><li>    FG_ImageSync_VK depthInitImageSync{};</li><li>    depthInitImageSync.stages = VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT;</li><li>    depthInitImageSync.layout = VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL;</li><li>    depthInitImageSync.accessMask = VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_WRITE_BIT;</li><li>
</li><li>    <span class="hljs-comment">// 设置预测帧生成后深度模板缓冲区同步状态</span></li><li>    FG_ImageSync_VK depthFinalImageSync{};</li><li>    depthFinalImageSync.stages = VK_PIPELINE_STAGE_LATE_FRAGMENT_TESTS_BIT;</li><li>    depthFinalImageSync.layout = VK_IMAGE_LAYOUT_DEPTH_STENCIL_ATTACHMENT_OPTIMAL;</li><li>    depthFinalImageSync.accessMask = VK_ACCESS_DEPTH_STENCIL_ATTACHMENT_READ_BIT;</li><li>
</li><li>    <span class="hljs-comment">// 创建真实帧深度模板缓冲区图像属性实例</span></li><li>    FG_ImageInfo_VK depthImageInfo{};</li><li>    depthImageInfo.image = inputDepthStencil;</li><li>    depthImageInfo.initialSync = depthInitImageSync;</li><li>    depthImageInfo.finalSync = depthFinalImageSync;</li><li>
</li><li>    <span class="hljs-comment">// 帧生成属性配置结构体</span></li><li>    FG_DispatchDescription_VK dispatchDescription{};</li><li>    <span class="hljs-comment">// 传入真实渲染帧颜色缓冲区属性信息</span></li><li>    dispatchDescription.inputColorInfo = inputColorImageInfo;</li><li>    <span class="hljs-comment">// 传入真实渲染帧深度模板缓冲区属性信息</span></li><li>    dispatchDescription.inputDepthStencilInfo = depthImageInfo;</li><li>
</li><li>    <span class="hljs-comment">// 变量声明</span></li><li>    FG_Mat4x4 preViewProj;</li><li>    FG_Mat4x4 preInvViewProj;</li><li>    VkCommandBuffer vkCommandBuffer = VK_NULL_HANDLE;</li><li>
</li><li>    <span class="hljs-comment">// 传入上一帧真实渲染帧视图投影矩阵</span></li><li>    dispatchDescription.viewProj = preViewProj;</li><li>    <span class="hljs-comment">// 传入上一帧真实渲染帧视图投影逆矩阵</span></li><li>    dispatchDescription.invViewProj = preInvViewProj;</li><li>    <span class="hljs-comment">// 传入用于录入超帧绘制指令的命令缓冲区句柄</span></li><li>    dispatchDescription.vkCommandBuffer = vkCommandBuffer;</li><li>
</li><li>    <span class="hljs-comment">// 生成预测帧</span></li><li>    errorCode = <span class="hljs-built_in">HMS_FG_Dispatch_VK</span>(m_context, &amp;dispatchDescription);</li><li>    <span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">switch</span> (errorCode) {</li><li>        <span class="hljs-keyword">case</span> FG_SUCCESS: {</li><li>            <span class="hljs-comment">// 预测成功</span></li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>        <span class="hljs-keyword">case</span> FG_COLLECTING_PREVIOUS_FRAMES:</li><li>            <span class="hljs-comment">// 传入真实帧数量未达到固定阈值，无预测帧生成，外插模式传入真实帧数量&lt;3时返回该状态码，此时不要将预测帧送显</span></li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-comment">// 预测帧生成失败</span></li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 送显真实帧</span></li><li>    <span class="hljs-comment">// ...    </span></li><li>}</li></ol></pre></div></div></li>     <li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/_graphics_accelerate#ga6be707669124e0bb6e5d61c2e24043be" target="_blank">HMS_FG_DestroyContext_VK</a>接口销毁超帧实例，释放内存资源。      <div _ngcontent-mwg-c106="" class="highlight-div"><div _ngcontent-mwg-c106="" class="highlight-div-header"><div _ngcontent-mwg-c106="" class="highlight-div-header-left"><div _ngcontent-mwg-c106="" class="handle-button expand-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mwg-c106="" class="highlight-div-header-right"><div _ngcontent-mwg-c106="" class="handle-button ai-button"></div><div _ngcontent-mwg-c106="" class="handle-button line-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mwg-c106="" class="handle-button theme-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mwg-c106="" class="handle-button copy-button"><div _ngcontent-mwg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mwg-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 销毁超帧上下文实例并释放内存资源</span></li><li>errorCode = <span class="hljs-built_in">HMS_FG_DestroyContext_VK</span>(&amp;m_context);</li><li><span class="hljs-keyword">if</span> (errorCode != FG_SUCCESS) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>}</li></ol></pre></div></div></li>    </ol>   </div>   <div></div></div>