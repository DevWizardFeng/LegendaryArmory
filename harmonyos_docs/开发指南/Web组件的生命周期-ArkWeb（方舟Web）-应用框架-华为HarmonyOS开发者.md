<h1 _ngcontent-dri-c119="" class="doc-title ng-star-inserted" title="Web组件的生命周期"> Web组件的生命周期 </h1>

<div _ngcontent-dri-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>开发者可以使用Web组件加载本地或者在线网页。</p>     <p>Web组件提供生命周期回调接口，用于感知状态变化和处理业务。</p>     <p>Web组件的状态主要包括：Controller绑定到Web组件、网页加载开始、网页加载进度、网页加载结束、页面即将可见。</p>     <p>Web页面保活可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-offline-mode">使用离线Web组件</a>。</p>     <p>自定义组件析构销毁时执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttodisappear" target="_blank">aboutToDisappear</a>函数，Web组件会被销毁，Web组件与WebviewController解绑，js运行环境也会一并销毁。</p>     <p><strong>图1</strong> Web组件网页正常加载过程中的回调事件</p>     <p><span><img originheight="628" originwidth="271" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114714.78721742047965097855107392400362:50001231000000:2800:8208BB6EE0CB42D4FCC678F6D8AF01E2A7C0BACD3AC1F3C7D04E000F3319D02A.png" class="notEnlarge" width="271" height="628"></span></p>    </div>    <div class="tiledSection">     <h2 id="web组件网页正常加载过程所涉及的状态说明">Web组件网页正常加载过程所涉及的状态说明<i class="anchor-icon anchor-icon-link" anchorid="web组件网页正常加载过程所涉及的状态说明" tips="复制节点链接"></i></h2>          <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttoappear" target="_blank">aboutToAppear</a>函数：在创建自定义组件的新实例后，在执行其build函数前执行。建议在此设置WebDebug调试模式、自定义协议URL的权限、Cookie等。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontrollerattached10" target="_blank">onControllerAttached</a>事件：当Controller成功绑定到Web组件时触发该回调，且禁止在该事件回调前调用Web组件相关的接口，否则会抛出js-error异常。建议在此事件中注入JS对象、设置自定义用户代理，使用操作网页不相关的接口。但因该回调调用时网页还未加载，因此无法在回调中使用有关操作网页的接口，例如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#zoomin" target="_blank">zoomIn</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#zoomout" target="_blank">zoomOut</a>等。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onloadintercept10" target="_blank">onLoadIntercept</a>事件：当Web组件加载url之前触发该回调，用于判断是否阻止此次访问。默认允许加载。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oninterceptrequest9" target="_blank">onInterceptRequest</a>事件：当Web组件加载url之前触发该回调，用于拦截url并返回响应数据。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onpagebegin" target="_blank">onPageBegin</a>事件：网页开始加载时触发该回调，且只在主frame（表示一个用于展示HTML页面的元素）触发。如果是iframe或者frameset（用于包含frame的HTML标签）的内容加载时则不会触发此回调。多frame页面可能同时加载，主frame加载结束时子frame可能仍在加载。同一页面导航或失败的导航不会触发该回调。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onprogresschange" target="_blank">onProgressChange</a>事件：告知开发者当前页面加载的进度。多frame页面或者子frame可能还在继续加载而主frame已经加载结束，所以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onpageend" target="_blank">onPageEnd</a>事件后仍可能收到该事件。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onpageend" target="_blank">onPageEnd</a>事件：网页加载完成时触发该回调，且只在主frame触发。多frame页面有可能同时开始加载，即使主frame已经加载结束，子frame也有可能才开始或者继续加载中。同一页面导航或失败的导航不会触发该回调。建议在此回调中执行JavaScript脚本。注意，收到该回调不能保证下一帧反映DOM状态。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="web组件网页异常加载过程所涉及的状态说明">Web组件网页异常加载过程所涉及的状态说明<i class="anchor-icon anchor-icon-link" anchorid="web组件网页异常加载过程所涉及的状态说明" tips="复制节点链接"></i></h2>          <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onoverrideurlloading12" target="_blank">onOverrideUrlLoading</a>事件：当URL将要加载到当前Web中时，让宿主应用程序有机会获得控制权，回调函数返回true将导致当前Web中止加载URL，而返回false则会导致Web继续照常加载URL。onLoadIntercept接口和onOverrideUrlLoading接口行为不一致，触发时机也不同，所以在应用场景上存在一定区别。onLoadIntercept事件在LoadUrl和iframe加载时触发，但onOverrideUrlLoading事件在LoadUrl和特定iframe加载时不会触发。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onpagevisible9" target="_blank">onPageVisible</a>事件：Web回调事件。渲染流程中当HTTP响应的主体开始加载，新页面即将可见时触发该回调。此时文档加载还处于早期，因此链接的资源比如在线CSS、在线图片等可能尚不可用。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onrenderexited9" target="_blank">onRenderExited</a>事件：应用渲染进程异常退出时触发该回调，可以在此回调中进行系统资源的释放、数据的保存等操作。如果应用希望异常恢复，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#loadurl" target="_blank">loadUrl</a>接口重新加载页面。详细用法参考<a href="/consumer/cn/doc/harmonyos-guides/web-event-sequence#应用如何避免web组件渲染子进程异常退出导致的页面卡死问题">应用如何避免Web组件渲染子进程异常退出导致的页面卡死问题</a>。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-show-hide#ondisappear" target="_blank">onDisAppear</a>事件：组件卸载消失时触发此回调。该事件在组件卸载时触发。</p></li>     </ul>     <p>应用侧代码。</p>     <div _ngcontent-dri-c106="" class="highlight-div"><div _ngcontent-dri-c106="" class="highlight-div-header"><div _ngcontent-dri-c106="" class="highlight-div-header-left"><div _ngcontent-dri-c106="" class="handle-button expand-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dri-c106="" class="highlight-div-header-right"><div _ngcontent-dri-c106="" class="handle-button ai-button"></div><div _ngcontent-dri-c106="" class="handle-button line-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dri-c106="" class="handle-button theme-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dri-c106="" class="handle-button copy-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dri-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">responseWeb</span>: <span class="hljs-title class_">WebResourceResponse</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">WebResourceResponse</span>();</li><li>  <span class="hljs-attr">heads</span>: <span class="hljs-title class_">Header</span>[] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">webData</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"&lt;!DOCTYPE html&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;html&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;head&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;title&gt;intercept test&lt;/title&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;/head&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;body&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;h1&gt;intercept test&lt;/h1&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;/body&gt;\n"</span> +</li><li>    <span class="hljs-string">"&lt;/html&gt;"</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      webview.<span class="hljs-property">WebviewController</span>.<span class="hljs-title function_">setWebDebuggingAccess</span>(<span class="hljs-literal">true</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 推荐在此loadUrl、设置自定义用户代理、注入JS对象等</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onControllerAttached execute'</span>)</li><li>        })</li><li>        .<span class="hljs-title function_">onLoadIntercept</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onLoadIntercept url:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">getRequestUrl</span>())</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'url:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">getRequestUrl</span>())</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'isMainFrame:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">isMainFrame</span>())</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'isRedirect:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">isRedirect</span>())</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'isRequestGesture:'</span> + event.<span class="hljs-property">data</span>.<span class="hljs-title function_">isRequestGesture</span>())</li><li>          }</li><li>          <span class="hljs-comment">// 返回true表示阻止此次加载，否则允许此次加载</span></li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onOverrideUrlLoading</span>(<span class="hljs-function">(<span class="hljs-params">webResourceRequest: WebResourceRequest</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (webResourceRequest &amp;&amp; webResourceRequest.<span class="hljs-title function_">getRequestUrl</span>() == <span class="hljs-string">"about:blank"</span>) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onInterceptRequest</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'url:'</span> + event.<span class="hljs-property">request</span>.<span class="hljs-title function_">getRequestUrl</span>());</li><li>          }</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">head1</span>: <span class="hljs-title class_">Header</span> = {</li><li>            <span class="hljs-attr">headerKey</span>: <span class="hljs-string">"Connection"</span>,</li><li>            <span class="hljs-attr">headerValue</span>: <span class="hljs-string">"keep-alive"</span></li><li>          }</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">head2</span>: <span class="hljs-title class_">Header</span> = {</li><li>            <span class="hljs-attr">headerKey</span>: <span class="hljs-string">"Cache-Control"</span>,</li><li>            <span class="hljs-attr">headerValue</span>: <span class="hljs-string">"no-cache"</span></li><li>          }</li><li>          <span class="hljs-comment">// 将新元素追加到数组的末尾，并返回数组的新长度。</span></li><li>          <span class="hljs-keyword">let</span> length = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heads</span>.<span class="hljs-title function_">push</span>(head1);</li><li>          length = <span class="hljs-variable language_">this</span>.<span class="hljs-property">heads</span>.<span class="hljs-title function_">push</span>(head2);</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'The response header result length is :'</span> + length);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setResponseHeader</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">heads</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setResponseData</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webData</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setResponseEncoding</span>(<span class="hljs-string">'utf-8'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setResponseMimeType</span>(<span class="hljs-string">'text/html'</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setResponseCode</span>(<span class="hljs-number">200</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>.<span class="hljs-title function_">setReasonMessage</span>(<span class="hljs-string">'OK'</span>);</li><li>          <span class="hljs-comment">// 返回响应数据则按照响应数据加载，无响应数据则返回null表示按照原来的方式加载</span></li><li>          <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">responseWeb</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onPageBegin</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onPageBegin url:'</span> + event.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onFirstContentfulPaint</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"onFirstContentfulPaint:"</span> + <span class="hljs-string">"[navigationStartTick]:"</span> +</li><li>            event.<span class="hljs-property">navigationStartTick</span> + <span class="hljs-string">", [firstContentfulPaintMs]:"</span> +</li><li>            event.<span class="hljs-property">firstContentfulPaintMs</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onProgressChange</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'newProgress:'</span> + event.<span class="hljs-property">newProgress</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// 推荐在此事件中执行JavaScript脚本</span></li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onPageEnd url:'</span> + event.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onPageVisible</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onPageVisible url:'</span> + event.<span class="hljs-property">url</span>);</li><li>        })</li><li>        .<span class="hljs-title function_">onRenderExited</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'onRenderExited reason:'</span> + event.<span class="hljs-property">renderExitReason</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">onDisAppear</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>            <span class="hljs-attr">message</span>: <span class="hljs-string">'The web is hidden'</span>,</li><li>            <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>          })</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="web组件网页加载的性能指标">Web组件网页加载的性能指标<i class="anchor-icon anchor-icon-link" anchorid="web组件网页加载的性能指标" tips="复制节点链接"></i></h2>          <p>网页加载过程中需要关注一些重要的性能指标。例如，FCP(First Contentful Paint)首次内容绘制，FMP(First Meaningful Paint)首次有效绘制，LCP(Largest Contentful Paint)最大内容绘制等。Web组件提供了如下接口来通知开发者，接口仅支持在线非PDF网页，不支持本地网页和PDF网页。</p>     <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfirstcontentfulpaint10" target="_blank">onFirstContentfulPaint</a>事件：网页首次内容绘制的回调函数。首次绘制文本、图像、非空白Canvas或SVG的时间点。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onfirstmeaningfulpaint12" target="_blank">onFirstMeaningfulPaint</a>事件：网页绘制页面主要内容的回调函数。首次绘制主要内容的时间点。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onlargestcontentfulpaint12" target="_blank">onLargestContentfulPaint</a>事件：网页绘制页面最大内容的回调函数。绘制可视区域内最大图片、文本块或视频的时间点。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="应用如何避免web组件渲染子进程异常退出导致的页面卡死问题">应用如何避免Web组件渲染子进程异常退出导致的页面卡死问题<i class="anchor-icon anchor-icon-link" anchorid="应用如何避免web组件渲染子进程异常退出导致的页面卡死问题" tips="复制节点链接"></i></h2>          <p>ArkWeb（方舟Web）是一个Web组件平台，旨在为应用程序提供展示Web页面内容的功能，并向开发者提供一系列的能力，如页面加载、交互和调试等功能。使用ArkWeb相关应用时，可能因各种原因（例如前端偶现异常导致ArkWeb渲染子进程崩溃，或是打开的应用较多，系统资源紧张导致后台ArkWeb渲染子进程被终止）而出现页面卡死的问题，这时需要重新打开页面或重启应用来解决。</p>     <p>在ArkWeb渲染子进程异常退出导致页面卡死后，应用可通过监听<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#onrenderexited9" target="_blank">onRenderExited</a>事件来获取具体的退出原因<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-e#renderexitreason9" target="_blank">RenderExitReason</a>，并在异常回调中根据退出的具体原因，执行相应的异常处理。</p>     <p><strong>开发实践案例</strong></p>     <div _ngcontent-dri-c106="" class="highlight-div"><div _ngcontent-dri-c106="" class="highlight-div-header"><div _ngcontent-dri-c106="" class="highlight-div-header-left"><div _ngcontent-dri-c106="" class="handle-button expand-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dri-c106="" class="highlight-div-header-right"><div _ngcontent-dri-c106="" class="handle-button ai-button"></div><div _ngcontent-dri-c106="" class="handle-button line-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dri-c106="" class="handle-button theme-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dri-c106="" class="handle-button copy-button"><div _ngcontent-dri-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dri-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">needReloadWhenVisible</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span> ;  <span class="hljs-comment">// Web组件不可见时render退出后阻止重新加载页面，在可见时重新加载页面。</span></li><li>  <span class="hljs-attr">webIsVisible</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;            <span class="hljs-comment">// 判断Web组件是否可见。</span></li><li>
</li><li>  <span class="hljs-comment">// 此处是将子进程异常崩溃和其它异常原因做了区分，应用开发者可根据实际业务特点，细化对应异常的处理策略。</span></li><li>  <span class="hljs-attr">renderReloadMaxForCrashed</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">5</span>;    <span class="hljs-comment">// 设置因为异常崩溃后重新加载的最大重试次数，应用可根据业务特点，自行设置试错上限。</span></li><li>  <span class="hljs-attr">renderReloadCountForCrashed</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;  <span class="hljs-comment">// 异常崩溃后重新加载的次数。</span></li><li>  <span class="hljs-attr">renderReloadMaxForOthers</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;    <span class="hljs-comment">// 设置因为其它异常原因退出的最大重试次数，应用可根据业务特点，自行设置试错上限。</span></li><li>  <span class="hljs-attr">renderReloadCountForOthers</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;   <span class="hljs-comment">// 其它异常原因退出后重新加载的次数。</span></li><li>
</li><li>  <span class="hljs-comment">// 创建Web组件。</span></li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-comment">// 指定加载的页面。</span></li><li>  <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"www.example.com"</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onVisibleAreaChange</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1.0</span>], <span class="hljs-function">(<span class="hljs-params">isVisible</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webIsVisible</span> = isVisible;</li><li>          <span class="hljs-keyword">if</span> (isVisible &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">needReloadWhenVisible</span>) { <span class="hljs-comment">// Web组件可见时重新加载页面。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">needReloadWhenVisible</span> = <span class="hljs-literal">false</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>);</li><li>          }</li><li>        })</li><li>        <span class="hljs-comment">// 应用监听渲染子进程异常退出回调，并进行异常处理。</span></li><li>        .<span class="hljs-title function_">onRenderExited</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (!event) {</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">renderExitReason</span> == <span class="hljs-title class_">RenderExitReason</span>.<span class="hljs-property">ProcessCrashed</span>) {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForCrashed</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadMaxForCrashed</span>) {</li><li>              <span class="hljs-comment">// 设置重试次数上限保护，避免必现问题导致页面被循环加载。</span></li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'renderReloadCountForCrashed: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForCrashed</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForCrashed</span>++;</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForOthers</span> &gt;= <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadMaxForOthers</span>) {</li><li>              <span class="hljs-comment">// 设置重试次数上限保护, 避免必现问题导致页面被循环加载。</span></li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'renderReloadCountForOthers: '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForOthers</span>);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">renderReloadCountForOthers</span>++;</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">webIsVisible</span>) {</li><li>            <span class="hljs-comment">// Web组件可见则立即重新加载。</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">url</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-comment">// Web组件不可见时不立即重新加载。</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">needReloadWhenVisible</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>