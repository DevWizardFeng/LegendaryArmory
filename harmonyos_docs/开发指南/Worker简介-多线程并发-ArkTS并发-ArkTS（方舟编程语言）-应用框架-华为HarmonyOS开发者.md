<h1 _ngcontent-rpq-c119="" class="doc-title ng-star-inserted" title="Worker简介"> Worker简介 </h1>

<div _ngcontent-rpq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Worker的主要作用是为应用程序提供一个多线程的运行环境，实现应用程序执行过程与宿主线程分离。通过在后台线程运行脚本处理耗时操作，避免计算密集型或高延迟任务阻塞宿主线程。具体接口信息及使用方法详情请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-worker" target="_blank">Worker</a>。</p>    <div class="tiledSection">     <h2 id="worker运作机制">Worker运作机制<i class="anchor-icon anchor-icon-link" anchorid="worker运作机制" tips="复制节点链接"></i></h2>          <p><strong>图1</strong> Worker运作机制示意图</p>     <p><span><img originheight="605" originwidth="858" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114824.23840108830512436000758419008403:50001231000000:2800:597188241334C8558948CF9F424414BDF695EEA2992028D3FA98E244DADC1FDE.png" width="858" height="605"></span></p>     <p>创建Worker的线程称为宿主线程（不局限于主线程，Worker线程也支持创建Worker子线程）。Worker子线程（或Actor线程、工作线程）是Worker自身运行的线程。每个Worker子线程和宿主线程拥有独立的实例，包含独立执行环境、对象、代码段等。因此，启动每个Worker存在一定的内存开销，需要限制Worker子线程的数量。Worker子线程和宿主线程通过消息传递机制通信，利用序列化、引用传递或转移所有权的机制完成命令和数据的交互。</p>    </div>    <div class="tiledSection">     <h2 id="worker注意事项">Worker注意事项<i class="anchor-icon anchor-icon-link" anchorid="worker注意事项" tips="复制节点链接"></i></h2>          <ul>      <li>创建Worker时，提供手动和自动两种创建方式，推荐使用自动创建方式。手动创建Worker线程目录及文件时，需同步进行相关配置，具体要求请参阅<a href="/consumer/cn/doc/harmonyos-guides/worker-introduction#创建worker的注意事项">创建Worker的注意事项</a>。</li>      <li>使用Worker能力时，构造函数中传入的Worker线程文件的路径在不同版本有不同的规则，详情请参见<a href="/consumer/cn/doc/harmonyos-guides/worker-introduction#文件路径注意事项">文件路径注意事项</a>。</li>      <li>Worker创建后需要手动管理生命周期。同时运行的Worker子线程数量最多为64个，并且与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/napi#napi_create_ark_runtime" target="_blank">napi_create_ark_runtime</a>创建的runtime总数不超过80。详情请参见<a href="/consumer/cn/doc/harmonyos-guides/worker-introduction#生命周期注意事项">生命周期注意事项</a>。</li>      <li>不同线程中上下文对象是不同的，因此Worker线程只能使用线程安全的库，例如UI相关的非线程安全库不能在Worker子线程中使用。</li>      <li>单次序列化传输的数据量大小限制为16MB。</li>      <li>使用Worker模块时，API version 18及之后的版本建议在宿主线程中注册onAllErrors回调，以捕获Worker线程生命周期内的各种异常。API version 18之前的版本应注册onerror回调。如果未注册onAllErrors或onerror回调，当Worker线程出现异常时会发生jscrash问题。注意，onerror接口仅能捕获onmessage回调中的同步异常，捕获异常后，Worker线程将进入销毁流程，无法继续使用。详情请参见<a href="/consumer/cn/doc/harmonyos-guides/worker-introduction#onallerrors接口与onerror接口之间的行为差异">onAllErrors接口与onerror接口之间的行为差异</a>。</li>      <li>不支持在多个HAP之间共享使用相同的Worker线程文件。</li>      <li>引用HAR/HSP中的worker前，需要先配置对HAR/HSP的依赖，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-har-import" target="_blank">引用共享包</a>。</li>      <li>不支持在Worker工作线程中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-appstorage">AppStorage</a>。</li>      <li>从API version 18开始，可以在构造函数的参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-worker#workeroptions" target="_blank">WorkerOptions</a>中指定Worker线程的优先级。</li>      <li>在Worker文件中禁止使用export语法导出任何内容，否则会导致jscrash问题。</li>      <li>应用挂起后，该应用的Worker线程会<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/background-task-overview">暂停运行</a>。</li>     </ul>     <p>除上述注意事项外，使用Worker时还需注意<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/multi-thread-concurrency-overview#并发注意事项">并发注意事项</a>。</p>    </div>    <div class="tiledSection">     <h3 id="创建worker的注意事项" class="firsth2">创建Worker的注意事项<i class="anchor-icon anchor-icon-link" anchorid="创建worker的注意事项" tips="复制节点链接"></i></h3>          <p>Worker线程文件需要放在"{moduleName}/src/main/ets/"目录层级之下，否则不会被打包到应用中。有手动和自动两种创建Worker线程目录及文件的方式。</p>     <ul>      <li>       <p>手动创建：开发者手动创建相关目录及文件，通常是在ets目录下创建一个workers文件夹，用于存放worker.ets文件，需要配置build-profile.json5的相关字段信息，确保Worker线程文件被打包到应用中。</p>       <p>Stage模型：</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"buildOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"sourceOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"workers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-string">"./src/main/ets/workers/worker.ets"</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>       <p>FA模型：</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"buildOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"sourceOption"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"workers"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-string">"./src/main/ets/MainAbility/workers/worker.ets"</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>自动创建：DevEco Studio支持一键生成Worker，在对应的{moduleName}目录下任意位置，单击鼠标右键 &gt; New &gt; Worker，即可自动生成Worker的模板文件及配置信息，无需再手动在build-profile.json5中进行相关配置。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="文件路径注意事项">文件路径注意事项<i class="anchor-icon anchor-icon-link" anchorid="文件路径注意事项" tips="复制节点链接"></i></h3>          <p>使用Worker模块的具体功能时，需先构造Worker实例对象。构造函数与API版本相关，且需传入Worker线程文件的路径（scriptURL）。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入模块</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">worker1</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/worker.ets'</span>);</li></ol></pre></div></div>     <p><strong>Stage模型下的文件路径规则</strong></p>     <p>构造函数中的scriptURL要求如下：</p>     <ul>      <li>scriptURL的组成包含{moduleName}/ets和相对路径relativePath。</li>      <li>relativePath是Worker线程文件相对于"{moduleName}/src/main/ets/"目录的相对路径。</li>     </ul>     <p>1） 加载Ability中的Worker线程文件：</p>     <p>加载Ability中的worker线程文件。路径规则：{moduleName}/ets/{relativePath}。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// worker线程文件所在路径："entry/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerStage1</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/worker.ets'</span>);</li><li>
</li><li><span class="hljs-comment">// worker线程文件所在路径："testworkers/src/main/ets/ThreadFile/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerStage2</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'testworkers/ets/ThreadFile/workers/worker.ets'</span>);</li></ol></pre></div></div>     <p>2） 加载<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/in-app-hsp">HSP</a>中Worker线程文件</p>     <p>加载HSP中的worker线程文件。路径规则：{moduleName}/ets/{relativePath}。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// worker线程文件所在路径： "hsp/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerStage3</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'hsp/ets/workers/worker.ets'</span>);</li></ol></pre></div></div>     <p>3） 加载<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package">HAR</a>中Worker线程文件</p>     <p>加载HAR中worker线程文件存在以下两种情况：</p>     <ul>      <li>       <p>@标识路径加载形式：所有种类的模块加载本地HAR中的Worker线程文件，加载路径规则：@{moduleName}/ets/{relativePath}。</p></li>      <li>       <p>相对路径加载形式：本地HAR加载该包内的Worker线程文件，路径规则为：创建Worker对象所在文件与Worker线程文件的相对路径。</p></li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当开启useNormalizedOHMUrl（在工程目录中与entry同级别的应用级build-profile.json5文件中，将strictMode属性下的useNormalizedOHMUrl字段配置为true）或HAR包被打包成三方包使用时，HAR包中使用Worker仅支持通过相对路径的加载形式创建。</p>      </div></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// @标识路径加载形式：</span></li><li><span class="hljs-comment">// worker线程文件所在路径: "har/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerStage4</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'@har/ets/workers/worker.ets'</span>);</li><li>
</li><li><span class="hljs-comment">// 相对路径加载形式：</span></li><li><span class="hljs-comment">// worker线程文件所在路径: "har/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-comment">// 创建Worker对象的文件所在路径："har/src/main/ets/components/mainpage/MainPage.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerStage5</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'../../workers/worker.ets'</span>);</li></ol></pre></div></div>     <p><strong>FA模型下的文件路径规则</strong></p>     <p>构造函数中的scriptURL为：Worker线程文件与"{moduleName}/src/main/ets/MainAbility"的相对路径。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 主要说明以下三种场景：</span></li><li>
</li><li><span class="hljs-comment">// 场景1： Worker线程文件所在路径："{moduleName}/src/main/ets/MainAbility/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerFA1</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'workers/worker.ets'</span>, {<span class="hljs-attr">name</span>:<span class="hljs-string">'first worker in FA model'</span>});</li><li>
</li><li><span class="hljs-comment">// 场景2： Worker线程文件所在路径："{moduleName}/src/main/ets/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerFA2</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'../workers/worker.ets'</span>);</li><li>
</li><li><span class="hljs-comment">// 场景3： Worker线程文件所在路径："{moduleName}/src/main/ets/MainAbility/ThreadFile/workers/worker.ets"</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerFA3</span>: worker.<span class="hljs-property">ThreadWorker</span> = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'ThreadFile/workers/worker.ets'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="生命周期注意事项">生命周期注意事项<i class="anchor-icon anchor-icon-link" anchorid="生命周期注意事项" tips="复制节点链接"></i></h3>          <ul>      <li>       <p>Worker的创建和销毁会消耗较多的系统资源，建议开发者合理管理并重复使用已创建的Worker。Worker空闲时仍会占用资源，当不需要Worker时，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-worker#terminate9" target="_blank">terminate()</a>接口或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-worker#close9" target="_blank">close()</a>方法主动销毁Worker。若Worker处于已销毁或正在销毁等非运行状态时，调用其功能接口，会抛出相应的错误。</p></li>      <li>       <p>Worker的数量由内存管理策略决定，设定的内存阈值为1.5GB和设备物理内存的60%中的较小值。在内存允许的情况下，系统最多可以同时运行64个Worker。尝试创建的Worker数量超出上限时，系统将抛出错误：“Worker initialization failure, the number of workers exceeds the maximum.”。实际运行的Worker数量会根据当前内存使用情况实时调整。当所有Worker和主线程的累积内存占用超过设定的阈值时，系统将触发内存溢出（OOM）错误，导致应用程序崩溃。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="onallerrors接口与onerror接口之间的行为差异">onAllErrors接口与onerror接口之间的行为差异<i class="anchor-icon anchor-icon-link" anchorid="onallerrors接口与onerror接口之间的行为差异" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>异常捕获范围</p>       <p>onAllErrors接口可以捕获Worker线程的onmessage回调、timer回调以及文件执行等流程中产生的全局异常。</p>       <p>onerror接口仅能捕获Worker线程的onmessage回调中同步方法产生的异常，无法捕获多线程回调和模块化相关异常。</p></li>      <li>       <p>异常捕获后的线程状态</p>       <p>onAllErrors接口捕获异常后，Worker线程仍然存活并可以继续使用。这使开发者可以在捕获异常后执行其他操作，无需担心线程终止。</p>       <p>onerror接口捕获异常后，Worker线程会进入销毁流程，无法继续使用。这意味着在onerror触发后，Worker线程将被终止，后续操作将无法进行。</p></li>      <li>       <p>适用场景</p>       <p>onAllErrors接口适用于捕获Worker线程中所有类型异常的场景，特别是确保异常发生后Worker线程仍能继续运行的复杂场景。</p>       <p>onerror接口适用于只需要捕获onmessage回调中同步异常的简单场景。由于捕获异常后线程会被销毁，适用于不需要继续使用Worker线程的情况。</p>       <p>推荐使用onAllErrors接口，因为它提供了更全面的异常捕获能力，并且不会导致线程终止。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="worker基本用法示例">Worker基本用法示例<i class="anchor-icon anchor-icon-link" anchorid="worker基本用法示例" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>DevEco Studio支持一键生成Worker，在对应的{moduleName}目录下任意位置，单击鼠标右键 &gt; New &gt; Worker，即可自动生成Worker的模板文件及配置信息。本文以创建“worker”为例。</p>       <p>支持手动创建Worker文件，具体方式和注意事项请参阅<a href="/consumer/cn/doc/harmonyos-guides/worker-introduction#创建worker的注意事项">创建Worker的注意事项</a>。</p></li>      <li>       <p>导入Worker模块。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span></li></ol></pre></div></div></li>      <li>       <p>在宿主线程中，通过调用ThreadWorker的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-worker#constructor9" target="_blank">constructor()</a>方法创建Worker对象，并注册回调函数。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">alignRules</span>({</li><li>          <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>          <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>        })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 创建Worker对象</span></li><li>          <span class="hljs-keyword">let</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/worker.ets'</span>);</li><li>
</li><li>          <span class="hljs-comment">// 注册onmessage回调，捕获宿主线程接收到来自其创建的Worker通过workerPort.postMessage接口发送的消息。该回调在宿主线程执行</span></li><li>          workerInstance.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = e.<span class="hljs-property">data</span>;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'workerInstance onmessage is: '</span>, data);</li><li>          }</li><li>
</li><li>          <span class="hljs-comment">// 注册onAllErrors回调，捕获Worker线程的onmessage回调、timer回调以及文件执行等流程产生的全局异常。该回调在宿主线程执行</span></li><li>          workerInstance.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'workerInstance onAllErrors message is: '</span> + err.<span class="hljs-property">message</span>);</li><li>          }</li><li>
</li><li>          <span class="hljs-comment">// 注册onmessageerror回调，当Worker对象接收到无法序列化的消息时被调用，在宿主线程执行</span></li><li>          workerInstance.<span class="hljs-property">onmessageerror</span> = <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'workerInstance onmessageerror'</span>);</li><li>          }</li><li>
</li><li>          <span class="hljs-comment">// 注册onexit回调，当Worker销毁时被调用，在宿主线程执行</span></li><li>          workerInstance.<span class="hljs-property">onexit</span> = <span class="hljs-function">(<span class="hljs-params">e: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// Worker正常退出时，code为0；异常退出时，code为1</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'workerInstance onexit code is: '</span>, e);</li><li>          }</li><li>
</li><li>          <span class="hljs-comment">// 发送消息给Worker线程</span></li><li>          workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'1'</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在Worker文件中注册回调函数。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li><span class="hljs-comment">// 注册onmessage回调，当Worker线程收到来自其宿主线程通过postMessage接口发送的消息时被调用，在Worker线程执行</span></li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-built_in">string</span> = e.<span class="hljs-property">data</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'workerPort onmessage is: '</span>, data);</li><li>
</li><li>  <span class="hljs-comment">// 向宿主线程发送消息</span></li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'2'</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 注册onmessageerror回调，当Worker对象接收到一条无法被序列化的消息时被调用，在Worker线程执行</span></li><li>workerPort.<span class="hljs-property">onmessageerror</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'workerPort onmessageerror'</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 注册onerror回调，捕获Worker在执行过程中发生的异常，在Worker线程执行</span></li><li>workerPort.<span class="hljs-property">onerror</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'workerPort onerror err is: '</span>, err.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="跨har包加载worker">跨har包加载Worker<i class="anchor-icon anchor-icon-link" anchorid="跨har包加载worker" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>创建HAR详情参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package">开发静态共享包</a>。</p></li>      <li>       <p>在HAR中创建Worker线程文件相关内容。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// worker.ets</span></li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'worker thread receive message: '</span>, e.<span class="hljs-property">data</span>);</li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'worker thread post message to main thread'</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在entry模块的oh-package.json5文件中配置HAR包的依赖。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在entry模块配置har包的依赖</span></li><li>{</li><li>  <span class="hljs-string">"name"</span>: <span class="hljs-string">"entry"</span>,</li><li>  <span class="hljs-string">"version"</span>: <span class="hljs-string">"1.0.0"</span>,</li><li>  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Please describe the basic information."</span>,</li><li>  <span class="hljs-string">"main"</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-string">"author"</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-string">"license"</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-string">"dependencies"</span>: {</li><li>    <span class="hljs-string">"har"</span>: <span class="hljs-string">"file:../har"</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在entry模块中加载HAR包中的Worker线程文件。</p>       <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">RelativeContainer</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        .<span class="hljs-title function_">alignRules</span>({</li><li>          <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>          <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>        })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 通过@标识路径加载形式，加载har中Worker线程文件</span></li><li>          <span class="hljs-keyword">let</span> workerInstance = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'@har/ets/workers/worker.ets'</span>);</li><li>          workerInstance.<span class="hljs-property">onmessage</span> = <span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'main thread onmessage'</span>);</li><li>          };</li><li>          workerInstance.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'hello world'</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="多级worker生命周期管理">多级Worker生命周期管理<i class="anchor-icon anchor-icon-link" anchorid="多级worker生命周期管理" tips="复制节点链接"></i></h2>          <p>支持创建多级Worker，即父Worker可以创建子Worker，形成层级线程关系。由于Worker线程的生命周期由开发者管理，因此需要正确管理多级Worker的生命周期。当销毁父Worker时未能终止其子Worker的运行，可能会导致不可预期的结果。所以需要确保子Worker的生命周期在父Worker生命周期范围内，销毁父Worker前，先销毁所有子Worker，以防止不可预期的结果。</p>    </div>    <div class="tiledSection">     <h3 id="推荐使用示例" class="firsth2">推荐使用示例<i class="anchor-icon anchor-icon-link" anchorid="推荐使用示例" tips="复制节点链接"></i></h3>          <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在宿主线程中创建Worker线程（父Worker），在worker线程中再次创建Worker线程（子Worker）</span></li><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 宿主线程中创建父worker对象</span></li><li><span class="hljs-keyword">const</span> parentWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ParentWorker.ets'</span>);</li><li>
</li><li>parentWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'宿主线程收到父worker线程信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父worker退出'</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'宿主线程接收到父worker报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'宿主线程发送消息给父worker-推荐示例'</span>);</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ParentWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建父Worker线程中与宿主线程通信的对象</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e : MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span> == <span class="hljs-string">'宿主线程发送消息给父worker-推荐示例'</span>) {</li><li>    <span class="hljs-keyword">let</span> childWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ChildWorker.ets'</span>);</li><li>
</li><li>    childWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker收到子Worker的信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>      <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span> == <span class="hljs-string">'子Worker向父Worker发送信息'</span>) {</li><li>        workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向宿主线程发送信息'</span>);</li><li>      }</li><li>    }</li><li>
</li><li>    childWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'子Worker退出'</span>);</li><li>      <span class="hljs-comment">// 子Worker退出后再销毁父Worker</span></li><li>      workerPort.<span class="hljs-title function_">close</span>();</li><li>    }</li><li>
</li><li>    childWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'子Worker发生报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>    }</li><li>
</li><li>    childWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向子Worker发送信息-推荐示例'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ChildWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建子Worker线程中与父Worker线程通信的对象</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (e.<span class="hljs-property">data</span> == <span class="hljs-string">'父Worker向子Worker发送信息-推荐示例'</span>) {</li><li>    <span class="hljs-comment">// 子Worker线程业务逻辑...</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'业务执行结束，然后子Worker销毁'</span>);</li><li>    workerPort.<span class="hljs-title function_">close</span>();</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="不推荐使用示例">不推荐使用示例<i class="anchor-icon anchor-icon-link" anchorid="不推荐使用示例" tips="复制节点链接"></i></h3>          <p>不建议在父Worker销毁后，子Worker继续向父Worker发送消息。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> parentWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ParentWorker.ets'</span>);</li><li>
</li><li>parentWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'宿主线程收到父Worker信息'</span> + e.<span class="hljs-property">data</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker退出'</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'宿主线程接收到父Worker报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'宿主线程发送消息给父Worker'</span>);</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ParentWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e : MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker收到宿主线程的信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>
</li><li>  <span class="hljs-keyword">let</span> childWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ChildWorker.ets'</span>)</li><li>
</li><li>  childWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker收到子Worker的信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'子Worker退出'</span>);</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向宿主线程发送信息'</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'子Worker发生报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向子Worker发送信息'</span>);</li><li>
</li><li>  <span class="hljs-comment">// 创建子Worker后，销毁父Worker</span></li><li>  workerPort.<span class="hljs-title function_">close</span>();</li><li>}</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ChildWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'子Worker收到信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>
</li><li>  <span class="hljs-comment">// 父Worker销毁后，子Worker向父Worker发送信息，行为不可预期</span></li><li>  workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'子Worker向父Worker发送信息'</span>);</li><li>  <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'子Worker向父Worker发送信息'</span>);</li><li>  }, <span class="hljs-number">1000</span>);</li><li>}</li></ol></pre></div></div>     <p>不建议在父Worker发起销毁操作的执行阶段创建子Worker。在创建子Worker线程之前，需确保父Worker线程始终处于存活状态，建议在确定父Worker未发起销毁操作的情况下创建子Worker。</p>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { worker, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ErrorEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> parentWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ParentWorker.ets'</span>);</li><li>
</li><li>parentWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'宿主线程收到父Worker信息'</span> + e.<span class="hljs-property">data</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker退出'</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'宿主线程接收到父Worker报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li>parentWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'宿主线程发送消息给父Worker'</span>);</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ParentWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e : MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker收到宿主线程的信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>
</li><li>  <span class="hljs-comment">// 父Worker销毁后创建子Worker，行为不可预期</span></li><li>  workerPort.<span class="hljs-title function_">close</span>();</li><li>  <span class="hljs-keyword">let</span> childWorker = <span class="hljs-keyword">new</span> worker.<span class="hljs-title class_">ThreadWorker</span>(<span class="hljs-string">'entry/ets/workers/ChildWorker.ets'</span>);</li><li>
</li><li>  <span class="hljs-comment">// 子Worker线程未确认创建成功前销毁父Worker，行为不可预期</span></li><li>  <span class="hljs-comment">// let childWorker = new worker.ThreadWorker('entry/ets/workers/ChildWorker.ets');</span></li><li>  <span class="hljs-comment">// workerPort.close();</span></li><li>
</li><li>  childWorker.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'父Worker收到子Worker的信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-property">onexit</span> = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'子Worker退出'</span>);</li><li>    workerPort.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向宿主线程发送信息'</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-property">onAllErrors</span> = <span class="hljs-function">(<span class="hljs-params">err: ErrorEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'子Worker发生报错 '</span> + err.<span class="hljs-property">message</span>);</li><li>  }</li><li>
</li><li>  childWorker.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'父Worker向子Worker发送信息'</span>);</li><li>}</li></ol></pre></div></div>     <div _ngcontent-rpq-c106="" class="highlight-div"><div _ngcontent-rpq-c106="" class="highlight-div-header"><div _ngcontent-rpq-c106="" class="highlight-div-header-left"><div _ngcontent-rpq-c106="" class="handle-button expand-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rpq-c106="" class="highlight-div-header-right"><div _ngcontent-rpq-c106="" class="handle-button ai-button"></div><div _ngcontent-rpq-c106="" class="handle-button line-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rpq-c106="" class="handle-button theme-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rpq-c106="" class="handle-button copy-button"><div _ngcontent-rpq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rpq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ChildWorker.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ErrorEvent</span>, <span class="hljs-title class_">MessageEvents</span>, <span class="hljs-title class_">ThreadWorkerGlobalScope</span>, worker } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">workerPort</span>: <span class="hljs-title class_">ThreadWorkerGlobalScope</span> = worker.<span class="hljs-property">workerPort</span>;</li><li>
</li><li>workerPort.<span class="hljs-property">onmessage</span> = <span class="hljs-function">(<span class="hljs-params">e: MessageEvents</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'子Worker收到信息 '</span> + e.<span class="hljs-property">data</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>