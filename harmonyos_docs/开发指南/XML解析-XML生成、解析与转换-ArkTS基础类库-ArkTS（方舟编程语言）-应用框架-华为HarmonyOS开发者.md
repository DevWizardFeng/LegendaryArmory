<h1 _ngcontent-jqh-c119="" class="doc-title ng-star-inserted" title="XML解析"> XML解析 </h1>

<div _ngcontent-jqh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对于以XML作为载体传递的数据，实际使用中需要对相关的元素进行解析，一般包括<a href="/consumer/cn/doc/harmonyos-guides/xml-parsing#解析xml标签和标签值">解析XML标签和标签值</a>、<a href="/consumer/cn/doc/harmonyos-guides/xml-parsing#解析xml属性和属性值">解析XML属性和属性值</a>、<a href="/consumer/cn/doc/harmonyos-guides/xml-parsing#解析xml事件类型和元素信息">解析XML事件类型和元素信息</a>三类操作。如在Web服务中，XML是SOAP（Simple Object Access Protocol）协议的基础，SOAP消息通常以XML格式封装，包含请求和响应参数，通过解析这些XML消息，Web服务可以处理来自客户端的请求并生成相应的响应。</p>    <p>XML模块提供XmlPullParser类用于解析XML文本，输入为包含XML数据的ArrayBuffer或DataView，输出为结构化的解析结果。</p>    <p><strong>表1</strong> XML解析选项，其详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-xml#parseoptions" target="_blank">ParseOptions</a>。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.5.1.1" valign="top" width="25%">名称</th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.5.1.2" valign="top" width="25%">类型</th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.5.1.3" valign="top" width="25%">必填</th>        <th align="left" class="cellrowborder" id="mcps1.3.4.1.5.1.4" valign="top" width="25%">说明</th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="25%">supportDoctype</td>        <td class="cellrowborder" valign="top" width="25%">boolean</td>        <td class="cellrowborder" valign="top" width="25%">否</td>        <td class="cellrowborder" valign="top" width="25%">是否解析文档类型，false表示不解析文档类型，true表示解析文档类型，默认false。</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%">ignoreNameSpace</td>        <td class="cellrowborder" valign="top" width="25%">boolean</td>        <td class="cellrowborder" valign="top" width="25%">否</td>        <td class="cellrowborder" valign="top" width="25%">是否忽略命名空间，忽略命名空间后，将不会对其进行解析。true表示忽略命名空间，false表示不忽略命名空间，默认false。</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%">tagValueCallbackFunction</td>        <td class="cellrowborder" valign="top" width="25%">(name: string, value: string) =&gt; boolean</td>        <td class="cellrowborder" valign="top" width="25%">否</td>        <td class="cellrowborder" valign="top" width="25%">获取tagValue回调函数，打印XML标签及标签值。默认为undefined，表示不解析XML标签和标签值。</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%">attributeValueCallbackFunction</td>        <td class="cellrowborder" valign="top" width="25%">(name: string, value: string) =&gt; boolean</td>        <td class="cellrowborder" valign="top" width="25%">否</td>        <td class="cellrowborder" valign="top" width="25%">获取attributeValue回调函数，打印XML属性及属性值。默认为undefined，表示不解析XML属性和属性值。</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%">tokenValueCallbackFunction</td>        <td class="cellrowborder" valign="top" width="25%">(eventType: EventType, value: ParseInfo) =&gt; boolean</td>        <td class="cellrowborder" valign="top" width="25%">否</td>        <td class="cellrowborder" valign="top" width="25%">获取tokenValue回调函数，打印XML事件类型及parseInfo对应属性。默认为undefined，表示不解析XML事件类型。</td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="注意事项">注意事项<i class="anchor-icon anchor-icon-link" anchorid="注意事项" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>确保传入的XML数据符合标准格式。</p></li>      <li>       <p>目前不支持解析指定节点的值。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="解析xml标签和标签值">解析XML标签和标签值<i class="anchor-icon anchor-icon-link" anchorid="解析xml标签和标签值" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>引入模块。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { xml, util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>; <span class="hljs-comment">// 需要使用util模块函数对文本编码</span></li></ol></pre></div></div></li>      <li>       <p>对XML文本编码后调用XmlPullParser。</p>       <p>可以基于ArrayBuffer创建XmlPullParser对象，也可以基于DataView创建XmlPullParser对象（两种创建方式返回结果无区别）。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strXml</span>: <span class="hljs-built_in">string</span> =</li><li><span class="hljs-string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;note importance="high" logged="true"&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;title&gt;Play&lt;/title&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;lens&gt;Work&lt;/lens&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;/note&gt;'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">textEncoder</span>: util.<span class="hljs-property">TextEncoder</span> = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrBuffer</span>: <span class="hljs-title class_">Uint8Array</span> = textEncoder.<span class="hljs-title function_">encodeInto</span>(strXml); <span class="hljs-comment">// 对数据进行编码，防止中文字符乱码</span></li><li><span class="hljs-comment">// 方式1：基于ArrayBuffer构造XmlPullParser对象</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">xmlParser</span>: xml.<span class="hljs-property">XmlPullParser</span> = <span class="hljs-keyword">new</span> xml.<span class="hljs-title class_">XmlPullParser</span>(arrBuffer.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, <span class="hljs-string">'UTF-8'</span>);</li><li>
</li><li><span class="hljs-comment">// 方式2：基于DataView构造XmlPullParser对象</span></li><li><span class="hljs-comment">// let dataView: DataView = new DataView(arrBuffer.buffer as object as ArrayBuffer);</span></li><li><span class="hljs-comment">// let xmlParser: xml.XmlPullParser = new xml.XmlPullParser(dataView, 'UTF-8');</span></li></ol></pre></div></div></li>      <li>       <p>自定义回调函数，本例直接打印出标签及标签值。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">if</span> (name == <span class="hljs-string">'note'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(name);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (value == <span class="hljs-string">'Play'</span> || value == <span class="hljs-string">'Work'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'    '</span> + value);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (name == <span class="hljs-string">'title'</span> || name == <span class="hljs-string">'lens'</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'  '</span> + name);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">//true:继续解析 false:停止解析</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>设置解析选项，调用parseXml函数。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: xml.<span class="hljs-property">ParseOptions</span> = {<span class="hljs-attr">supportDoctype</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">ignoreNameSpace</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">tagValueCallbackFunction</span>:func};</li><li>xmlParser.<span class="hljs-title function_">parseXml</span>(options);</li></ol></pre></div></div>       <p>输出结果如下所示：</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>note</li><li>  title</li><li>    Play</li><li>  title</li><li>  lens</li><li>    Work</li><li>  lens</li><li>note</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="解析xml属性和属性值">解析XML属性和属性值<i class="anchor-icon anchor-icon-link" anchorid="解析xml属性和属性值" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>引入模块。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { xml, util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>; <span class="hljs-comment">// 使用util模块对文本编码</span></li></ol></pre></div></div></li>      <li>       <p>对XML文本编码后调用XmlPullParser。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strXml</span>: <span class="hljs-built_in">string</span> =</li><li>  <span class="hljs-string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;note importance="high" logged="true"&gt;'</span> +</li><li>    <span class="hljs-string">'    &lt;title&gt;Play&lt;/title&gt;'</span> +</li><li>    <span class="hljs-string">'    &lt;title&gt;Happy&lt;/title&gt;'</span> +</li><li>    <span class="hljs-string">'    &lt;lens&gt;Work&lt;/lens&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;/note&gt;'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">textEncoder</span>: util.<span class="hljs-property">TextEncoder</span> = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrBuffer</span>: <span class="hljs-title class_">Uint8Array</span> = textEncoder.<span class="hljs-title function_">encodeInto</span>(strXml); <span class="hljs-comment">// 对数据进行编码，防止中文字符乱码</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">xmlParser</span>: xml.<span class="hljs-property">XmlPullParser</span> = <span class="hljs-keyword">new</span> xml.<span class="hljs-title class_">XmlPullParser</span>(arrBuffer.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, <span class="hljs-string">'UTF-8'</span>);</li></ol></pre></div></div></li>      <li>       <p>自定义回调函数，示例直接打印出属性及属性值。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  str += name + <span class="hljs-string">' '</span> + value + <span class="hljs-string">' '</span>;</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// true:继续解析 false:停止解析</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>设置解析选项，调用parseXml函数。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: xml.<span class="hljs-property">ParseOptions</span> = {<span class="hljs-attr">supportDoctype</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">ignoreNameSpace</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">attributeValueCallbackFunction</span>:func};</li><li>xmlParser.<span class="hljs-title function_">parseXml</span>(options);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(str); <span class="hljs-comment">// 打印所有属性及其值</span></li></ol></pre></div></div>       <p>输出结果如下所示：</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>importance high logged true // note节点的属性及属性值</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="解析xml事件类型和元素信息">解析XML事件类型和元素信息<i class="anchor-icon anchor-icon-link" anchorid="解析xml事件类型和元素信息" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>引入模块。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { xml, util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>; <span class="hljs-comment">// 使用util模块函数对文本编码</span></li></ol></pre></div></div></li>      <li>       <p>对XML文本编码后调用XmlPullParser。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strXml</span>: <span class="hljs-built_in">string</span> =</li><li>  <span class="hljs-string">'&lt;?xml version="1.0" encoding="utf-8"?&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;note importance="high" logged="true"&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;title&gt;Play&lt;/title&gt;'</span> +</li><li>  <span class="hljs-string">'&lt;/note&gt;'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">textEncoder</span>: util.<span class="hljs-property">TextEncoder</span> = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrBuffer</span>: <span class="hljs-title class_">Uint8Array</span> = textEncoder.<span class="hljs-title function_">encodeInto</span>(strXml); <span class="hljs-comment">// 对数据进行编码，防止中文字符乱码</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">xmlParser</span>: xml.<span class="hljs-property">XmlPullParser</span> = <span class="hljs-keyword">new</span> xml.<span class="hljs-title class_">XmlPullParser</span>(arrBuffer.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, <span class="hljs-string">'UTF-8'</span>);</li></ol></pre></div></div></li>      <li>       <p>自定义回调函数，示例直接打印元素事件类型及元素深度。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">func</span>(<span class="hljs-params">name: xml.EventType, value: xml.ParseInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>  str = name + <span class="hljs-string">' '</span> + value.<span class="hljs-title function_">getDepth</span>(); <span class="hljs-comment">// getDepth 获取元素在XML文档中的当前深度</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(str);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// true:继续解析 false:停止解析</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>设置解析选项，调用parseXml函数。</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: xml.<span class="hljs-property">ParseOptions</span> = {<span class="hljs-attr">supportDoctype</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">ignoreNameSpace</span>:<span class="hljs-literal">true</span>, <span class="hljs-attr">tokenValueCallbackFunction</span>:func};</li><li>xmlParser.<span class="hljs-title function_">parseXml</span>(options);</li></ol></pre></div></div>       <p>输出结果如下所示：</p>       <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li> 0 0 // 0：&lt;?xml version="1.0" encoding="utf-8"?&gt; 对应事件类型START_DOCUMENT值为0  0：起始深度为0</li><li> 2 1 // 2：&lt;note importance="high" logged="true"&gt; 对应事件类型START_TAG值为2  1：深度为1</li><li> 2 2 // 2：&lt;title&gt;对应事件类型START_TAG值为2  2：深度为2</li><li> 4 2 // 4：Play对应事件类型TEXT值为4  2：深度为2</li><li> 3 2 // 3：&lt;/title&gt;对应事件类型END_TAG值为3  2：深度为2</li><li> 3 1 // 3：&lt;/note&gt;对应事件类型END_TAG值为3  1：深度为1（与&lt;note对应&gt;）</li><li> 1 0 // 1：对应事件类型END_DOCUMENT值为1  0：深度为0</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="场景示例">场景示例<i class="anchor-icon anchor-icon-link" anchorid="场景示例" tips="复制节点链接"></i></h2>          <p>此处以调用所有解析选项为例，提供解析XML标签、属性和事件类型的开发示例。</p>     <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { xml, util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strXml</span>: <span class="hljs-built_in">string</span> =</li><li>  <span class="hljs-string">'&lt;?xml version="1.0" encoding="UTF-8"?&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;book category="COOKING"&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;title lang="en"&gt;Everyday&lt;/title&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;author&gt;Giana&lt;/author&gt;'</span> +</li><li>    <span class="hljs-string">'&lt;/book&gt;'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">textEncoder</span>: util.<span class="hljs-property">TextEncoder</span> = <span class="hljs-keyword">new</span> util.<span class="hljs-title class_">TextEncoder</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">arrBuffer</span>: <span class="hljs-title class_">Uint8Array</span> = textEncoder.<span class="hljs-title function_">encodeInto</span>(strXml);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">xmlParser</span>: xml.<span class="hljs-property">XmlPullParser</span> = <span class="hljs-keyword">new</span> xml.<span class="hljs-title class_">XmlPullParser</span>(arrBuffer.<span class="hljs-property">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">object</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>, <span class="hljs-string">'UTF-8'</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">tagFunc</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  str = name + value;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'tag-'</span> + str);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">attFunc</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, value: <span class="hljs-built_in">string</span></span>): <span class="hljs-built_in">boolean</span> {</li><li>  str = name + <span class="hljs-string">' '</span> + value;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'attri-'</span> + str);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">tokenFunc</span>(<span class="hljs-params">name: xml.EventType, value: xml.ParseInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>  str = name + <span class="hljs-string">' '</span> + value.<span class="hljs-title function_">getDepth</span>();</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'token-'</span> + str);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: xml.<span class="hljs-property">ParseOptions</span> = {</li><li>  <span class="hljs-attr">supportDoctype</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">ignoreNameSpace</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">tagValueCallbackFunction</span>: tagFunc,</li><li>  <span class="hljs-attr">attributeValueCallbackFunction</span>: attFunc,</li><li>  <span class="hljs-attr">tokenValueCallbackFunction</span>: tokenFunc</li><li>};</li><li>xmlParser.<span class="hljs-title function_">parseXml</span>(options);</li></ol></pre></div></div>     <p>输出结果如下所示：</p>     <div _ngcontent-jqh-c106="" class="highlight-div"><div _ngcontent-jqh-c106="" class="highlight-div-header"><div _ngcontent-jqh-c106="" class="highlight-div-header-left"><div _ngcontent-jqh-c106="" class="handle-button expand-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jqh-c106="" class="highlight-div-header-right"><div _ngcontent-jqh-c106="" class="handle-button ai-button"></div><div _ngcontent-jqh-c106="" class="handle-button line-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jqh-c106="" class="handle-button theme-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jqh-c106="" class="handle-button copy-button"><div _ngcontent-jqh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jqh-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>tag-</li><li>token-0 0</li><li>tag-book</li><li>token-2 1</li><li>attri-category COOKING</li><li>tag-title</li><li>token-2 2</li><li>attri-lang en</li><li>tag-Everyday</li><li>token-4 2</li><li>tag-title</li><li>token-3 2</li><li>tag-author</li><li>token-2 2</li><li>tag-Giana</li><li>token-4 2</li><li>tag-author</li><li>token-3 2</li><li>tag-book</li><li>token-3 1</li><li>tag-</li><li>token-1 0</li></ol></pre></div></div>    </div>   </div>   <div></div></div>