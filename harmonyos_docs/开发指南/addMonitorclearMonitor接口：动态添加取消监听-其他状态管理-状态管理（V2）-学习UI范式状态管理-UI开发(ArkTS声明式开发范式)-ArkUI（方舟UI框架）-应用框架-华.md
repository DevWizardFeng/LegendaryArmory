<h1 _ngcontent-suq-c119="" class="doc-title ng-star-inserted" title="addMonitor/clearMonitor接口：动态添加/取消监听"> addMonitor/clearMonitor接口：动态添加/取消监听 </h1>

<div _ngcontent-suq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了动态添加或删除状态管理V2的状态变量的监听函数，开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#addmonitor20" target="_blank">addMonitor</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#clearmonitor20" target="_blank">clearMonitor</a>。</p>    <p>在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2/@Trace</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 20开始，开发者可以使用UIUtils中的addMonitor/clearMonitor接口动态给状态管理V2的状态变量添加或删除监听函数。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>装饰器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a>如果声明在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-componentv2">@ComponentV2</a>中，会使得开发者构造出的所有的@ObservedV2和@ComponentV2的实例，都默认有同样的@Monitor的监听回调，且无法取消或删除对应的监听回调。</p>     <p>如果开发者希望动态给@ObservedV2和@ComponentV2实例添加或者删除监听函数，则可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#addmonitor20" target="_blank">addMonitor</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#clearmonitor20" target="_blank">clearMonitor</a>接口。</p>     <ul>      <li>       <p>使用addMonitor/clearMonitor接口需要导入UIUtils工具。</p>       <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li></ol></pre></div></div></li>      <li>       <p>仅支持监听状态管理V2的状态变量的变化。</p></li>      <li>       <p>clearMonitor仅可以删除addMonitor添加的监听函数，无法删除@Monitor的监听函数。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用规则">使用规则<i class="anchor-icon anchor-icon-link" anchorid="使用规则" tips="复制节点链接"></i></h2>          <ul>      <li>addMonitor/clearMonitor可以传入数组一次性给多个状态变量添加或删除回调函数。</li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Jack'</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange1: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'age'</span>, <span class="hljs-string">'name'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User name <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 改变name，回调onChange1监听函数</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// age自增，回调onChange1监听函数</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear name and age monitor fun'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 删除age和name的onChange1监听函数</span></li><li>          <span class="hljs-comment">// 再次点击Text组件改变name和age，无监听函数回调</span></li><li>          <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, [<span class="hljs-string">'age'</span>, <span class="hljs-string">'name'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">onChange1</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>addMonitor可以给path对应的状态变量添加多个监听函数，但是需要注意，如果开发者添加同名的监听函数，则会添加失败，打印错误日志。</li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange1: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onChange2</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange2: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 正确用法，给age注册监听函数onChange1</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>    <span class="hljs-comment">// 正确用法，给age注册监听函数onChange2</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange2</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange1 in View: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 错误用法，已经给age注册过方法名为onChange1的函数，无法重复注册相同函数名的监听函数</span></li><li>    <span class="hljs-comment">// 打印错误日志提示添加失败：FIX THIS APPLICATION ERROR: AddMonitor onChange1 failed when adding path age because duplicate key</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// age自增，回调User中的onChange1和onChange2方法</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>addMonitor设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#monitoroptions20" target="_blank">isSynchronous</a>仅第一次有效，即其不能被更改，如果开发者更改isSynchronous，则会打印错误日志。</li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange1: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 正确用法，给a注册监听函数onChange1，没有设置options默认为异步监听回调</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>    <span class="hljs-comment">// 错误用法，不能改变this.onChange1的监听回调的方式</span></li><li>    <span class="hljs-comment">// 打印错误日志提示： FIX THIS APPLICATION ERROR: addMonitor failed, current function onChange1 has already register as async, cannot change to sync anymore</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>, { <span class="hljs-attr">isSynchronous</span>: <span class="hljs-literal">true</span> });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// age自增，回调onChange1，回调方式为异步回调</span></li><li>          <span class="hljs-comment">// 监听回调的日志：onChange1: User property age change from 0 to 2</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <ul>      <li>       <p>clearMonitor可以删除path对应的状态变量的监听函数，开发者可以通过传入监听回调函数来指定删除具体的监听函数，也可以不指定具体的监听函数，删除当前path对应状态变量的所有监听回调函数。</p>       <p>需要注意：当调用clearMonitor时，如果发现当前回调函数没有在path对应的状态变量上注册过，或者当前状态变量没有任何监听函数，都会打印告警日志提示开发者删除失败。</p>       <p>监听函数被删除后，状态变量的改变不会再回调对应的监听函数。</p></li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Jack'</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange1: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onChange2</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange2: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onChange3</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange3: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange2</span>);</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange3</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// step1：点击age，回调onChange1，onChange2，onChange3</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear age onChange1'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// step2：第一次点击该Button。删除onChange1，删除成功。此时点击User age，仅会回调onChange2，onChange3</span></li><li>        <span class="hljs-comment">// step3：再次点击该Button。再次删除onChange1，onChange1已经被删除，此次删除失败</span></li><li>        <span class="hljs-comment">// 打印错误日志：FIX THIS APPLICATION ERROR: cannot clear path age for onChange1 because it was never registered with addMonitor</span></li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">onChange1</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear age monitors'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// step4：删除age所有添加的监听函数。再次点击User age，无监听函数回调</span></li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, <span class="hljs-string">'age'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'clear name monitors'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// step5：删除name添加的监听方法。因为name无任何监听回调，删除失败</span></li><li>        <span class="hljs-comment">// 打印错误日志：FIX THIS APPLICATION ERROR: cannot clear path name for current target User because no Monitor function for this path was registered</span></li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>, <span class="hljs-string">'name'</span>);</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>addMonitor/clearMonitor仅支持对@ComponentV2和@ObservedV2装饰（至少有一个@Trace装饰的变量）的实例添加/取消回调，否则会有运行时报错，错误码为130000。</p>       <p>下面为addMonitor的例子，clearMonitor同理。</p>       <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`A property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 正确用法</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`B property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 目标对象非法入参，当前this为@Observed装饰的对象</span></li><li>    <span class="hljs-comment">// Error code: 130000</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'b'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">C</span> {</li><li>  <span class="hljs-meta">@Track</span> <span class="hljs-attr">c</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`C property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 错误用法：目标对象非法入参，当前this为普通class</span></li><li>    <span class="hljs-comment">// Error code: 130000</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'c'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    <span class="hljs-comment">// 错误用法：目标对象非法入参undefined</span></li><li>    <span class="hljs-comment">// Error code: 130000</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-literal">undefined</span>, <span class="hljs-string">'c'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: A = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">b</span>: B = <span class="hljs-keyword">new</span> <span class="hljs-title function_">B</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">c</span>: C = <span class="hljs-keyword">new</span> <span class="hljs-title function_">C</span>();</li></ol></pre></div></div>       <p></p></li>      <li>       <p>addMonitor/clearMonitor观察路径必须为string或者为数组，如果开发者传入不支持的类型，则会有运行时报错，错误码为130001。</p>       <p>下面为addMonitor的例子，clearMonitor同理。</p>       <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">invalidPath</span>: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`A property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to   <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 正确用法</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    <span class="hljs-comment">// 正确用法</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    <span class="hljs-comment">// 错误用法，path必须为string或数组，会发生运行时校验，错误码为130001</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">invalidPath</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    <span class="hljs-comment">// 错误用法，path必须为string或数组，会发生运行时校验，错误码为130001</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-literal">undefined</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: A = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();</li></ol></pre></div></div>       <p></p></li>      <li>       <p>addMonitor的回调函数必须存在，类型必须为方法类型，且不能为匿名函数，如果开发者传入不支持的类型，则会有运行时报错，错误码为130002。</p>       <p>clearMonitor开发者可以不设置回调函数，如果设置了，其类型必须为function类型，且不能为匿名函数。</p>       <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">invalidFunc</span>: <span class="hljs-title class_">Function</span> | <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange1</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`A property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to   <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onChange2</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`A property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to   <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 正确用法，给变量a添加函数onChange1</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>    <span class="hljs-comment">// 正确用法，给变量a添加函数onChange2</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange2</span>);</li><li>    <span class="hljs-comment">// 正确用法，给变量b添加函数onChange1</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'b'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange1</span>);</li><li>    <span class="hljs-comment">// 错误用法。传入的回调函数为非function类型，错误码130002</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-literal">undefined</span>);</li><li>    <span class="hljs-comment">// 错误用法，传入的回调函数为匿名函数，错误码130002</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-function">(<span class="hljs-params">mon: IMonitor</span>) =&gt;</span> {});</li><li>    <span class="hljs-comment">// 错误用法，绕过编译器检查，传入的回调函数为非Function类型，错误码130002</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'a'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">invalidFunc</span> <span class="hljs-keyword">as</span> (<span class="hljs-attr">mon</span>: <span class="hljs-title class_">IMonitor</span>) =&gt; <span class="hljs-built_in">void</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">a</span>: A = <span class="hljs-keyword">new</span> <span class="hljs-title function_">A</span>();</li><li><span class="hljs-comment">// 正确用法，删除a注册的监听函数onChange1</span></li><li><span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(a, <span class="hljs-string">'a'</span>, a.<span class="hljs-property">onChange1</span>);</li><li><span class="hljs-comment">// 正确用法，删除a所有的监听函数</span></li><li><span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(a, <span class="hljs-string">'a'</span>);</li><li><span class="hljs-comment">// 正确用法。等于不传参数，删除b所有的监听函数</span></li><li><span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(a, <span class="hljs-string">'a'</span>, <span class="hljs-literal">undefined</span>);</li><li><span class="hljs-comment">// 错误用法，传入的回调函数为匿名函数，错误码130002</span></li><li><span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(a, <span class="hljs-string">'a'</span>, <span class="hljs-function">(<span class="hljs-params">mon: IMonitor</span>) =&gt;</span> {});</li></ol></pre></div></div>       <p></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="addmonitor监听变化的规则">addMonitor监听变化的规则<i class="anchor-icon anchor-icon-link" anchorid="addmonitor监听变化的规则" tips="复制节点链接"></i></h2>          <p>addMonitor和装饰器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor">@Monitor</a>监听变化的主要规则大体保持一致，对比如下表：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.1" valign="top" width="33.33333333333333%">场景</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.2" valign="top" width="33.33333333333333%">addMonitor</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.3.1.4.1.3" valign="top" width="33.33333333333333%">@Monitor</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听observedv2类中trace修饰属性和componentv2组件中状态变量的变化">监听@ObservedV2类中@Trace修饰属性的变化</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听observedv2类中trace修饰属性和componentv2组件中状态变量的变化">监听@ComponentV2组件中状态变量的变化</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听数组类型状态变量的下标和length的变化">监听数组类型状态变量的下标和length的变化</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">监听Map、Set、Date类型状态变量变化</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#独立监听path">独立监听path变化</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听变量从可访问到不访问和从不可访问到可访问">监听变量从可访问到不访问和从不可访问到可访问</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#配置同步监听函数">配置同步监听函数</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#监听构造函数中同步修改的状态变量的变化">监听构造函数中同步修改的状态变量的变化</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/arkts-new-addmonitor-clearmonitor#动态取消observedv2componentv2实例的监听">动态取消@ObservedV2/@ComponentV2实例的监听</a></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">支持</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不支持</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="监听observedv2类中trace修饰属性和componentv2组件中状态变量的变化" class="firsth2">监听@ObservedV2类中@Trace修饰属性和@ComponentV2组件中状态变量的变化<i class="anchor-icon anchor-icon-link" anchorid="监听observedv2类中trace修饰属性和componentv2组件中状态变量的变化" tips="复制节点链接"></i></h3>          <p>在下面的例子中：</p>     <ul>      <li>在User的构造函数中添加对age和name的监听函数onChange。</li>      <li>在自定义组件Page的aboutToAppear的生命周期中，添加对user的监听函数onChangeInView。</li>      <li>点击Text(`User name ${this.user.name}`)，改变name的值，触发onChange方法。</li>      <li>点击Text(`User age ${this.user.age}`)，改变age的值，触发onChange方法。</li>      <li>点击Text(`reset User`)，对user整体赋值，触发onChangeInView方法。</li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Jack'</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'age'</span>, <span class="hljs-string">'name'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">onChangeInView</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange in View: View property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(mon.value(path)?.before)}</span> to <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(mon.value(path)?.now)}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'user'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChangeInView</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User name <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.name}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 改变name，回调onChange监听函数</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">name</span> += <span class="hljs-string">'!'</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// age自增，回调onChange监听函数</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`reset User`</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// user整体赋值，回调onChangeInView监听函数</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听数组类型状态变量的下标和length的变化">监听数组类型状态变量的下标和length的变化<i class="anchor-icon anchor-icon-link" anchorid="监听数组类型状态变量的下标和length的变化" tips="复制节点链接"></i></h3>          <p>下面的例子展示了对Array数组下标和length的监听。</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">string</span>[] = [<span class="hljs-string">'a'</span>, <span class="hljs-string">'b'</span>, <span class="hljs-string">'c'</span>]</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: View property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(mon.value(path)?.before)}</span> to <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(mon.value(path)?.now)}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 添加对数组index为0,1,2和数组length的监听回调onChange</span></li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'arr.0'</span>, <span class="hljs-string">'arr.1'</span>, <span class="hljs-string">'arr.2'</span>, <span class="hljs-string">'arr.length'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`len <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr.length}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">0</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 改变数组index为0的数组项</span></li><li>        <span class="hljs-comment">// onChange回调：onChange: View property arr.0 change from "a" to "az"</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">0</span>] += <span class="hljs-string">'z'</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">1</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 改变数组index为1的数组项</span></li><li>        <span class="hljs-comment">// onChange回调：onChange: View property arr.1 change from "b" to "bz"</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">1</span>] += <span class="hljs-string">'z'</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.arr[<span class="hljs-number">2</span>]}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 改变数组index为2的数组项</span></li><li>        <span class="hljs-comment">// onChange回调：onChange: View property arr.2 change from "c" to "cz"</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>[<span class="hljs-number">2</span>] += <span class="hljs-string">'z'</span>;</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`push`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 在数组末尾push新数组项'd'，其index为4，index为4没有被监听</span></li><li>        <span class="hljs-comment">// 数组长度改变，length被监听</span></li><li>        <span class="hljs-comment">// onChange回调：onChange: View property arr.length change from 3 to 4</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">'d'</span>);</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`shift`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 删除数组第一个元素</span></li><li>        <span class="hljs-comment">// 0: az -&gt; bz</span></li><li>        <span class="hljs-comment">// 1: bz -&gt; cz</span></li><li>        <span class="hljs-comment">// 2: cz -&gt; d</span></li><li>        <span class="hljs-comment">// length: 4 -&gt; 3</span></li><li>        <span class="hljs-comment">// onChange回调：</span></li><li>        <span class="hljs-comment">// onChange: View property arr.0 change from "az" to "bz"</span></li><li>        <span class="hljs-comment">// onChange: View property arr.1 change from "bz" to "cz"</span></li><li>        <span class="hljs-comment">// onChange: View property arr.2 change from "cz" to "d"</span></li><li>        <span class="hljs-comment">// onChange: View property arr.length change from 4 to 3</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">shift</span>();</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="独立监听path">独立监听Path<i class="anchor-icon anchor-icon-link" anchorid="独立监听path" tips="复制节点链接"></i></h3>          <p>@Monitor没有对path独立监听，所以需要依赖开发者正确传入@Monitor入参，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor#正确设置monitor入参">传入非状态变量时会造成被连带监听的情况</a>。</p>     <p>对于addMonitor，对不同path采取了独立监听的机制，如下面的例子，点击Button('change age&amp;name')，会输出以下日志：</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">property</span> <span class="hljs-variable">path</span>:<span class="hljs-title class_">age</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-number">24</span> <span class="hljs-title class_">to</span> <span class="hljs-number">25</span></li></ol></pre></div></div>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'John'</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>
</li><li>  <span class="hljs-title function_">onPropertyChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    monitor.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`property path:<span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${monitor.value(path)?.before}</span> to <span class="hljs-subst">${monitor.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'age'</span>, <span class="hljs-string">'name'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPropertyChange</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change age&amp;name'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">age</span> = <span class="hljs-number">25</span>; <span class="hljs-comment">// 同时改变状态变量age和非状态变量name</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">'Johny'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听变量从可访问到不访问和从不可访问到可访问">监听变量从可访问到不访问和从不可访问到可访问<i class="anchor-icon anchor-icon-link" anchorid="监听变量从可访问到不访问和从不可访问到可访问" tips="复制节点链接"></i></h3>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor#无法监听变量从可访问变为不可访问和从不可访问变为可访问">@Monitor</a>不会记录状态变量不可访问时的状态，所以其无法监听变量从可访问到不访问和从不可访问到可访问。</p>     <p>addMonitor会记录变量不可访问的状态，所以可以监听变量从可访问到不访问和从不可访问到可访问。例子如下。</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> | <span class="hljs-literal">undefined</span> | <span class="hljs-literal">null</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, [<span class="hljs-string">'user.age'</span>], <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user?.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to undefined'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// age可访问-&gt;不可访问</span></li><li>          <span class="hljs-comment">// 触发onChange监听回调：onChange: User property user.age change from 10 to undefined</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">undefined</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to User'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// age不可访问-&gt;可访问</span></li><li>        <span class="hljs-comment">// 触发onChange监听回调：onChange: User property user.age change from undefined to 10</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'set user to null'</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// age可访问-&gt;不可访问</span></li><li>        <span class="hljs-comment">// 触发onChange监听回调：onChange: User property user.age change from 10 to undefined</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-literal">null</span>;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="配置同步监听函数">配置同步监听函数<i class="anchor-icon anchor-icon-link" anchorid="配置同步监听函数" tips="复制节点链接"></i></h3>          <p>和@Monitor仅支持异步监听不同，addMonitor可支持配置成同步监听函数，在下面的例子中，点击Text(`User age ${this.user.age}`)，触发两次age的自增，回调两次onChange函数，日志打印如下：</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">onChange</span>: <span class="hljs-title class_">User</span> <span class="hljs-title class_">property</span> <span class="hljs-title class_">user</span>.<span class="hljs-title class_">age</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-number">10</span> <span class="hljs-title class_">to</span> <span class="hljs-number">11</span></li><li><span class="hljs-variable">onChange</span>: <span class="hljs-title class_">User</span> <span class="hljs-title class_">property</span> <span class="hljs-title class_">user</span>.<span class="hljs-title class_">age</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-number">11</span> <span class="hljs-title class_">to</span> <span class="hljs-number">12</span></li></ol></pre></div></div>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'user.age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>, { <span class="hljs-attr">isSynchronous</span>: <span class="hljs-literal">true</span> })</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>如果将上面的例子改成@Monitor，仅会打印一次回调，日志如下：</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">onChange</span>: <span class="hljs-title class_">User</span> <span class="hljs-title class_">property</span> <span class="hljs-title class_">user</span>.<span class="hljs-title class_">age</span> <span class="hljs-title class_">change</span> <span class="hljs-keyword">from</span> <span class="hljs-number">10</span> <span class="hljs-title class_">to</span> <span class="hljs-number">12</span></li></ol></pre></div></div>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();</li><li>
</li><li>  <span class="hljs-meta">@Monitor</span>(<span class="hljs-string">'user.age'</span>)</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`User age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">age</span>++;</li><li>      })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="监听构造函数中同步修改的状态变量的变化">监听构造函数中同步修改的状态变量的变化<i class="anchor-icon anchor-icon-link" anchorid="监听构造函数中同步修改的状态变量的变化" tips="复制节点链接"></i></h3>          <p>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-monitor#类中monitor对变量监听的生效及失效时间">@Monitor异步构造</a>不同，addMonitor是同步构造的，所以在开发者调用完UIUtils.addMonitor(this, 'message', this.onMessageChange);后就完成了对message添加监听函数this.onMessageChange。在下面的例子中：</p>     <ul>      <li>拉起页面，构造Info的实例，回调onMessageChange监听函数。</li>      <li>       <p>点击Button('change message')，回调onMessageChange监听函数。</p>       <p>日志输出如下：</p></li>     </ul>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>message change <span class="hljs-selector-tag">from</span> not initialized <span class="hljs-selector-tag">to</span> initialized</li><li>message change <span class="hljs-selector-tag">from</span> initialized <span class="hljs-selector-tag">to</span> Index aboutToAppear</li><li>message change <span class="hljs-selector-tag">from</span> Index aboutToAppear <span class="hljs-selector-tag">to</span> Index click <span class="hljs-selector-tag">to</span> change message</li></ol></pre></div></div>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'not initialized'</span>;</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'message'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMessageChange</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'initialized'</span>;</li><li>  }</li><li>  <span class="hljs-title function_">onMessageChange</span>(<span class="hljs-params">monitor: IMonitor</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`message change from <span class="hljs-subst">${monitor.value()?.before}</span> to <span class="hljs-subst">${monitor.value()?.now}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Index aboutToAppear'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'change message'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Index click to change message'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="动态取消observedv2componentv2实例的监听">动态取消@ObservedV2/@ComponentV2实例的监听<i class="anchor-icon anchor-icon-link" anchorid="动态取消observedv2componentv2实例的监听" tips="复制节点链接"></i></h3>          <p>和@Monitor不同，addMonitor/clearMonitor可以对不同的@ObservedV2/@ComponentV2实例动态添加监听函数。例子如下。</p>     <div _ngcontent-suq-c106="" class="highlight-div"><div _ngcontent-suq-c106="" class="highlight-div-header"><div _ngcontent-suq-c106="" class="highlight-div-header-left"><div _ngcontent-suq-c106="" class="handle-button expand-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-suq-c106="" class="highlight-div-header-right"><div _ngcontent-suq-c106="" class="handle-button ai-button"></div><div _ngcontent-suq-c106="" class="handle-button line-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-suq-c106="" class="handle-button theme-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-suq-c106="" class="handle-button copy-button"><div _ngcontent-suq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-suq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`onChange: User property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">needMonitor: <span class="hljs-built_in">boolean</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (needMonitor) {</li><li>      <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user1</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">user2</span>: <span class="hljs-title class_">User</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>(<span class="hljs-literal">false</span>);</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`user1 age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user1.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 有Monitor回调</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user1</span>.<span class="hljs-property">age</span>++;</li><li>      })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`user2 age <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.user2.age}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-comment">// 无Monitor回调</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">user2</span>.<span class="hljs-property">age</span>++;</li><li>      })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`remove user1 monitor`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">clearMonitor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">user1</span>, <span class="hljs-string">'age'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">user1</span>.<span class="hljs-property">onChange</span>);</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`change count`</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span>++;</li><li>      })</li><li>
</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">needMonitor</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> })</li><li>      <span class="hljs-title class_">Child</span>({ <span class="hljs-attr">needMonitor</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">count</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">count</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Child</span> {</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">needMonitor</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@Param</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">onChange</span>(<span class="hljs-params">mon: IMonitor</span>) {</li><li>    mon.<span class="hljs-property">dirty</span>.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">path: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`Child needMonitor <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.needMonitor}</span> onChange: property <span class="hljs-subst">${path}</span> change from <span class="hljs-subst">${mon.value(path)?.before}</span> to <span class="hljs-subst">${mon.value(path)?.now}</span>`</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">needMonitor</span>) {</li><li>      <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">addMonitor</span>(<span class="hljs-variable language_">this</span>, <span class="hljs-string">'count'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onChange</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count}</span>`</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>