<h1 _ngcontent-bie-c119="" class="doc-title ng-star-inserted" title="assert"> assert </h1>

<div _ngcontent-bie-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section29723mcpsimp">函数功能<i class="anchor-icon anchor-icon-link" anchorid="section29723mcpsimp" tips="复制节点链接"></i></h2><p>基于算子工程开发的算子，可以使用该接口实现CPU/NPU域assert断言功能。算子执行中，如果assert内部条件判断不为真，则输出assert条件并将输入的信息格式化打印在屏幕上。</p> <p>在算子kernel侧实现代码中需要增加断言的地方使用assert检查代码，并格式化输出一些调测信息。示例如下。</p> <div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int</span> assertFlag = <span class="hljs-number">10</span>; </li><li> </li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>); </li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>, <span class="hljs-string">"The assertFlag value is 10.\n"</span>); </li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>, <span class="hljs-string">"The assertFlag value is %d.\n"</span>, assertFlag);</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>assert接口打印功能会对算子实际运行的性能带来一定影响（每一条assert，系统会额外增加一条逻辑判断，具体性能影响取决于代码中assert的使用数量），通常在调测阶段使用。开发者可以按需通过如下方式关闭打印功能。</p> <p>自定义算子工程：</p> <p>修改算子工程op_kernel目录下的CMakeLists.txt文件，首行增加编译选项-DASCENDC_DUMP=0，关闭ASCENDC_DUMP开关，示例如下。</p> <div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 关闭所有算子的printf打印功能 </span></li><li><span class="hljs-built_in">add_ops_compile_options</span>(ALL OPTIONS -DASCENDC_DUMP=<span class="hljs-number">0</span>)</li></ol></pre></div></div> </div></div></div> <p>在assert条件被触发时，在断言信息前面会自动打印CANN_VERSION_STR值与CANN_TIMESTAMP值。其中，CANN_VERSION_STR与CANN_TIMESTAMP为宏定义，CANN_VERSION_STR代表CANN软件包的版本号信息，形式为字符串，CANN_TIMESTAMP为CANN软件包发布时的时间戳，形式为数值(uint64_t)。开发者也可在代码中直接使用这两个宏。assert打印信息示例如下。</p> <div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>[<span class="hljs-variable">ASSERT</span>][<span class="hljs-variable">CANN_VERSION</span> : <span class="hljs-title class_">XXX</span>.<span class="hljs-title class_">XX</span>][<span class="hljs-variable">TimeStamp</span> : <span class="hljs-number">20240807140556417</span>] /<span class="hljs-variable">home</span>/.../<span class="hljs-variable">add_custom</span>.<span class="hljs-variable">cpp</span>:<span class="hljs-number">44</span>: <span class="hljs-title class_">Assertion</span> `<span class="hljs-title class_">assertFlag</span> != <span class="hljs-number">10</span><span class="hljs-string">' The assertFlag value is 10.</span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29746mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section29746mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">assert</span>(expr) </li><li><span class="hljs-built_in">assert</span>(expr, __gm__ <span class="hljs-type">const</span> <span class="hljs-type">char</span> *fmt, Args&amp;&amp;... args)</li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29749mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section29749mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="16%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="72%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="16%"><p>expr</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>assert断言是否终止程序的条件。为true则程序继续执行，为false则终止程序。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>fmt</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>格式控制字符串，包含两种类型的对象：普通字符和转换说明。</p> <ul><li>普通字符将原样不动地打印输出。</li><li>转换说明并不直接输出而是用于控制printf中参数的转换和打印。每个转换说明都由一个百分号字符（%）开始，以转换说明结束，从而说明输出数据的类型 。<ul><li>支持的转换类型包括：</li><li>%d / %i：输出十进制数</li><li>%f：输出实数</li><li>%x：输出十六进制整数</li><li>%s：输出字符串</li><li>%u：输出unsigned类型数据</li><li>%p：输出指针地址</li></ul> <p>当前支持的数据类型为uint8_t/int8_t/int16_t/uint16_t/int32_t/uint32_t/int64_t/uint64_t/float/half。</p> </li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>args</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>附加参数，个数和类型可变的输出列表：根据不同的fmt字符串，函数可能需要一系列的附加参数，每个参数包含了一个要被插入的值，替换了fmt参数中指定的每个%标签。参数的个数应与%标签的个数相同。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section29798mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section29798mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section29801mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section29801mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section29806mcpsimp">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section29806mcpsimp" tips="复制节点链接"></i></h2><ul><li><strong>该功能仅在如下场景支持：</strong><p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-overview-of-engineering-operator">工程化算子开发</a>方式调用算子。</p> </li><li>kernel开发不要包含系统的assert.h，会导致宏定义冲突。</li><li>assert接口调用形式与C语言一致，不需要使用AscendC命名空间。</li><li>本接口不支持打印除换行符之外的其他转义字符。</li><li>程序中调用assert接口使用空间+调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-printf">printf</a>接口使用的空间+调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumptensor">DumpTensor</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumpaccch">DumpAccChkPoint</a>接口使用的空间+框架dump功能所使用的空间，每个核上不可超过1M。请开发者自行控制待打印的内容数据量，超出则不会打印。</li><li>程序中只调用assert接口，assert接口使用空间每个核上不可超过1k。请开发者自行控制待打印的内容数据量，超出则不会打印。</li></ul> </div> <div class="tiledSection"><h2 id="section29830mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section29830mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int</span> assertFlag = <span class="hljs-number">10</span>; </li><li> </li><li><span class="hljs-comment">// 断言条件 </span></li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>); </li><li> </li><li><span class="hljs-comment">// 打印消息 </span></li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>, <span class="hljs-string">"The assertFlag value is 10.\n"</span>); </li><li> </li><li><span class="hljs-comment">// 格式化打印 </span></li><li><span class="hljs-built_in">assert</span>(assertFlag == <span class="hljs-number">10</span>, <span class="hljs-string">"The assertFlag value is %d.\n"</span>, assertFlag); </li><li><span class="hljs-built_in">assert</span>(assertFlag != <span class="hljs-number">10</span>, <span class="hljs-string">"The assertFlag value is %d.\n"</span>, assertFlag);</li></ol></pre></div></div> <p>程序运行时会触发assert，打印效果如下。</p> <div _ngcontent-bie-c106="" class="highlight-div"><div _ngcontent-bie-c106="" class="highlight-div-header"><div _ngcontent-bie-c106="" class="highlight-div-header-left"><div _ngcontent-bie-c106="" class="handle-button expand-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bie-c106="" class="highlight-div-header-right"><div _ngcontent-bie-c106="" class="handle-button ai-button"></div><div _ngcontent-bie-c106="" class="handle-button line-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bie-c106="" class="handle-button theme-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bie-c106="" class="handle-button copy-button"><div _ngcontent-bie-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bie-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>[<span class="hljs-variable">ASSERT</span>][<span class="hljs-variable">CANN_VERSION</span> : <span class="hljs-title class_">XXX</span>.<span class="hljs-title class_">XX</span>][<span class="hljs-variable">TimeStamp</span> : <span class="hljs-number">20240807140556417</span>] /<span class="hljs-variable">home</span>/.../<span class="hljs-variable">add_custom</span>.<span class="hljs-variable">cpp</span>:<span class="hljs-number">44</span>: <span class="hljs-title class_">Assertion</span> `<span class="hljs-title class_">assertFlag</span> != <span class="hljs-number">10</span><span class="hljs-string">' The assertFlag value is 10.</span></li></ol></pre></div></div> </div> </div> <div></div></div>