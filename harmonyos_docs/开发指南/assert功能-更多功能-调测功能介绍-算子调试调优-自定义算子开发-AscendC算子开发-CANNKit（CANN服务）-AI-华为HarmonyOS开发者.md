<h1 _ngcontent-ixi-c119="" class="doc-title ng-star-inserted" title="assert功能"> assert功能 </h1>

<div _ngcontent-ixi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section3042mcpsimp">功能介绍<i class="anchor-icon anchor-icon-link" anchorid="section3042mcpsimp" tips="复制节点链接"></i></h2><p>使用工具进行算子调测时，支持断言功能。当核函数代码中条件判断为false时，则立即中断运行流程并打印相关信息，方便快速定位错误。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>固定为每个核分配的打印数据的最大可使用空间为1M，目前该大小不支持修改，若打印超过1M，打印内容不再显示，请开发者控制待打印的数据量。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section3051mcpsimp">使用方法（命令行）<i class="anchor-icon anchor-icon-link" anchorid="section3051mcpsimp" tips="复制节点链接"></i></h2><ol><li><span>在核函数代码中根据需要，在目标位置调用assert接口，接口说明参见表1，样例如下。</span><p></p><div _ngcontent-ixi-c106="" class="highlight-div"><div _ngcontent-ixi-c106="" class="highlight-div-header"><div _ngcontent-ixi-c106="" class="highlight-div-header-left"><div _ngcontent-ixi-c106="" class="handle-button expand-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ixi-c106="" class="highlight-div-header-right"><div _ngcontent-ixi-c106="" class="handle-button ai-button"></div><div _ngcontent-ixi-c106="" class="handle-button line-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ixi-c106="" class="handle-button theme-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ixi-c106="" class="handle-button copy-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ixi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">int32_t</span> x = <span class="hljs-number">31</span>;  </li><li><span class="hljs-built_in">assert</span>(x &lt; <span class="hljs-number">0</span>, <span class="hljs-string">"Invalid input_num: %d\n"</span>, x);</li></ol></pre></div></div> <p></p></li><li><span>simulator调测场景执行如下命令，使能Dump开关。</span><p></p><div _ngcontent-ixi-c106="" class="highlight-div"><div _ngcontent-ixi-c106="" class="highlight-div-header"><div _ngcontent-ixi-c106="" class="highlight-div-header-left"><div _ngcontent-ixi-c106="" class="handle-button expand-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ixi-c106="" class="highlight-div-header-right"><div _ngcontent-ixi-c106="" class="handle-button ai-button"></div><div _ngcontent-ixi-c106="" class="handle-button line-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ixi-c106="" class="handle-button theme-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ixi-c106="" class="handle-button copy-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ixi-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>ascendebug kernel<strong> --backend</strong> simulator<strong> --dump-mode</strong> normal ... {其他simulator调测参数}</li></ol></pre></div></div> <p>--dump-mode取normal，开启通用打印Scalar模式，其他参数参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-cli-parameters#section1351011652416">NPU调测参数</a>根据需要进行配置。</p> <p></p></li><li><span>查看断言结果。</span><p></p><p>若调用时传入的判断条件为false，会中断程序并在屏幕上显示断言内容（带文件名、行号），结果示例如下。</p> <div _ngcontent-ixi-c106="" class="highlight-div"><div _ngcontent-ixi-c106="" class="highlight-div-header"><div _ngcontent-ixi-c106="" class="highlight-div-header-left"><div _ngcontent-ixi-c106="" class="handle-button expand-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ixi-c106="" class="highlight-div-header-right"><div _ngcontent-ixi-c106="" class="handle-button ai-button"></div><div _ngcontent-ixi-c106="" class="handle-button line-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ixi-c106="" class="handle-button theme-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ixi-c106="" class="handle-button copy-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ixi-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>[ASSERT] /home/.../add_custom.cpp:94: Assertion `x &lt; 0' Invalid input_num: 31</li></ol></pre></div></div> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section3067mcpsimp">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section3067mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>assert接口说明表</caption><tbody><tr><th class="firstcol" id="mcps1.3.3.2.2.4.1.1" valign="top"><p>函数原型</p> </th> <td class="cellrowborder" colspan="2" valign="top"><p>__aicore__ inline void assert(bool assertFlag, __gm__ const char* fmt, Args&amp;&amp;... args);</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.2.1" valign="top"><p>函数功能</p> </th> <td class="cellrowborder" colspan="2" valign="top"><p>用于程序调试。在程序运行时检查一个条件是否为真，若条件为假，立即中断程序并打印信息。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.3.1" rowspan="3" valign="top" width="23%"><p>参数(IN)</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>assertFlag</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>判断是否要中断程序打印断言语句的条件。</p> <ul><li>false：程序中断退出，在屏幕上显示assert传入的打印内容。</li><li>true： 程序不会在assert中断，无打印。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>fmt</p> </td> <td class="cellrowborder" valign="top"><p>开发者输入常量字符串，作为打印的前缀修饰。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>args</p> </td> <td class="cellrowborder" valign="top"><p>开发者需要打印的变量名。</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.6.1" valign="top" width="23%"><p>参数(OUT)</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.7.1" valign="top" width="23%"><p>返回值</p> </th> <td class="cellrowborder" valign="top" width="16%"><p>NA</p> </td> <td class="cellrowborder" valign="top" width="61%"><p>-</p> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.8.1" valign="top"><p>使用约束</p> </th> <td class="cellrowborder" colspan="2" valign="top"><ul><li>不支持转义字符打印。</li><li>当前支持的上板打印类型同<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-function-printf">printf/PRINTF功能</a>。</li></ul> </td> </tr> <tr><th class="firstcol" id="mcps1.3.3.2.2.4.9.1" valign="top"><p>调用示例</p> </th> <td class="cellrowborder" colspan="2" valign="top"><div _ngcontent-ixi-c106="" class="highlight-div"><div _ngcontent-ixi-c106="" class="highlight-div-header"><div _ngcontent-ixi-c106="" class="highlight-div-header-left"><div _ngcontent-ixi-c106="" class="handle-button expand-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ixi-c106="" class="highlight-div-header-right"><div _ngcontent-ixi-c106="" class="handle-button ai-button"></div><div _ngcontent-ixi-c106="" class="handle-button line-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ixi-c106="" class="handle-button theme-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ixi-c106="" class="handle-button copy-button"><div _ngcontent-ixi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ixi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">assert</span>(input_num &gt; <span class="hljs-number">0</span>, <span class="hljs-string">"Invalid input_num: %d "</span>, input_num);</li></ol></pre></div></div> <ul><li>若input_num==0，程序中断，打印内容为“[ASSERT] /path_to/add_custom_test.cpp:25 Invalid input_num: 0”。</li><li>若input_num&gt;0，程序不会在assert处中断。</li></ul> </td> </tr>  </tbody></table></div> </div> </div> </div> <div></div></div>