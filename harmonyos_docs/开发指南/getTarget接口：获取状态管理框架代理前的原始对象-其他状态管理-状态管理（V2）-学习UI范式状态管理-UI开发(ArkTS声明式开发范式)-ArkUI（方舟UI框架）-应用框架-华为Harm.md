<h1 _ngcontent-fvf-c119="" class="doc-title ng-star-inserted" title="getTarget接口：获取状态管理框架代理前的原始对象"> getTarget接口：获取状态管理框架代理前的原始对象 </h1>

<div _ngcontent-fvf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>为了获取状态管理框架代理前的原始对象，开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-statemanagement#gettarget" target="_blank">getTarget接口</a>。</p>    <p>在阅读本文档前，建议提前阅读：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-observed-and-objectlink">@Observed</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@ObservedV2</a>。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>从API version 12开始，开发者可以使用UIUtils中的getTarget接口获取状态管理框架代理前的原始对象。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="概述">概述<i class="anchor-icon anchor-icon-link" anchorid="概述" tips="复制节点链接"></i></h2>          <p>状态管理框架会对class、Date、Map、Set、Array类型的原始对象添加代理，用于观测属性变化与API调用。这一层代理会使得变量类型改变，在类型判断、NAPI调用等场景，会由于类型并非原始对象的类型产生预料之外的结果。</p>     <ul>      <li>       <p>使用getTarget接口需要导入UIUtils工具。</p>       <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li></ol></pre></div></div></li>      <li>       <p>状态管理V1中，会给@Observed装饰的类对象以及使用状态变量装饰器如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state">@State</a>装饰的class、Date、Map、Set、Array添加一层代理用于观测一层属性或API调用产生的变化。</p></li>      <li>       <p>状态管理V2中，会给使用状态变量装饰器如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-observedv2-and-trace">@Trace</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-new-local">@Local</a>装饰的Date、Map、Set、Array添加一层代理用于观测API调用产生的变化。</p></li>     </ul>     <p>使用getTarget接口可以获取这些代理对象的原始对象。</p>    </div>    <div class="tiledSection">     <h2 id="限制条件">限制条件<i class="anchor-icon anchor-icon-link" anchorid="限制条件" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>getTarget仅支持对象类型传参。</p>       <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">let</span> res = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">getTarget</span>(<span class="hljs-number">2</span>); <span class="hljs-comment">// 非对象类型入参，直接返回传入值</span></li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rawInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">getTarget</span>(info); <span class="hljs-comment">// 正确用法</span></li></ol></pre></div></div></li>      <li>       <p>更改getTarget获取的原始对象中的属性不会被观察到变化，也不会触发UI刷新。</p>       <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>();</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`info.name: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.info.name}</span>`</span>)</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`更改代理对象的属性`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>.<span class="hljs-property">name</span> = <span class="hljs-string">"Alice"</span>; <span class="hljs-comment">// Text组件能够刷新</span></li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">`更改原始对象的属性`</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">rawInfo</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-title class_">UIUtils</span>.<span class="hljs-title function_">getTarget</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">info</span>);</li><li>          rawInfo.<span class="hljs-property">name</span> = <span class="hljs-string">"Bob"</span>; <span class="hljs-comment">// Text组件不能刷新</span></li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="获取状态管理v1代理前的原始对象" class="firsth2">获取状态管理V1代理前的原始对象<i class="anchor-icon anchor-icon-link" anchorid="获取状态管理v1代理前的原始对象" tips="复制节点链接"></i></h3>          <p>状态管理V1有两种场景会给对象增加代理：</p>     <p>【1】@Observed装饰的类实例。在创建@Observed装饰的类实例时，会给该实例添加代理。该过程发生在new对象的过程中，以下示例中，没有被@Observed装饰的类是不被代理的。</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NonObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>(); <span class="hljs-comment">// 被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">nonObservedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>(); <span class="hljs-comment">// 不被代理</span></li></ol></pre></div></div>     <p>【2】状态变量装饰器装饰的复杂类型对象。使用@State、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-prop">@Prop</a>等状态变量装饰器装饰class、Map、Set、Date、Array时，会添加代理。若该对象已经是代理对象，则不会重复创建代理。</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NonObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>(); <span class="hljs-comment">// 被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">nonObservedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedObject</span>: <span class="hljs-title class_">ObservedClass</span> = observedClass; <span class="hljs-comment">// 已被代理数据不会重复创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">nonObservedObject</span>: <span class="hljs-title class_">NonObservedClass</span> = nonObservedClass; <span class="hljs-comment">// 创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">numberList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// Array类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">"a"</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">"c"</span>]]); <span class="hljs-comment">// Map类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// Set类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// Date类型创建代理</span></li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.observedObject === observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedObject === observedClass}</span>`</span>) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.nonObservedObject === nonObservedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.nonObservedObject === nonObservedClass}</span>`</span>) <span class="hljs-comment">// false</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用UIUtils.getTarget接口可以获取代理前的原始对象。</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-meta">@Observed</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NonObservedClass</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">observedClass</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>(); <span class="hljs-comment">// 被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">nonObservedClass</span>: <span class="hljs-title class_">NonObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NonObservedClass</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalNumberList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">"a"</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">"c"</span>]]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">observedObject</span>: <span class="hljs-title class_">ObservedClass</span> = observedClass; <span class="hljs-comment">// 已被代理数据不会重复创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">nonObservedObject</span>: <span class="hljs-title class_">NonObservedClass</span> = nonObservedClass; <span class="hljs-comment">// 创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">numberList</span>: <span class="hljs-built_in">number</span>[] = globalNumberList; <span class="hljs-comment">// Array类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = globalSampleMap; <span class="hljs-comment">// Map类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = globalSampleSet; <span class="hljs-comment">// Set类型创建代理</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">sampleDate</span>: <span class="hljs-title class_">Date</span> = globalSampleDate; <span class="hljs-comment">// Date类型创建代理</span></li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.observedObject === observedClass: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedObject ===</span></span></li><li><span class="hljs-string">           observedClass}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.nonObservedObject) === nonObservedClass: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.nonObservedObject) ===</span></span></li><li><span class="hljs-string">           nonObservedClass}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.numberList) === globalNumberList: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.numberList) ===</span></span></li><li><span class="hljs-string">           globalNumberList}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleMap) === globalSampleMap: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleMap) ===</span></span></li><li><span class="hljs-string">           globalSampleMap}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleSet) === globalSampleSet: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleSet) ===</span></span></li><li><span class="hljs-string">           globalSampleSet}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleDate) === globalSampleDate: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleDate) ===</span></span></li><li><span class="hljs-string">           globalSampleDate}</span>`) <span class="hljs-comment">// true</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="获取状态管理v2代理前的原始对象">获取状态管理V2代理前的原始对象<i class="anchor-icon anchor-icon-link" anchorid="获取状态管理v2代理前的原始对象" tips="复制节点链接"></i></h3>          <p>状态管理V2会给状态变量装饰器如@Trace、@Local装饰的Map、Set、Date、Array添加一层代理。和V1不同的是，状态管理V2不会对类对象实例进行代理。</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalObservedObject</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalNumberList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">"a"</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">"c"</span>]]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedObject</span>: <span class="hljs-title class_">ObservedClass</span> = globalObservedObject; <span class="hljs-comment">// V2中对象不被代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">numberList</span>: <span class="hljs-built_in">number</span>[] = globalNumberList; <span class="hljs-comment">// Array类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = globalSampleMap; <span class="hljs-comment">// Map类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = globalSampleSet; <span class="hljs-comment">// Set类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleDate</span>: <span class="hljs-title class_">Date</span> = globalSampleDate; <span class="hljs-comment">// Date类型创建代理</span></li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.observedObject === globalObservedObject <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedObject === globalObservedObject}</span>`</span>) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.numberList === globalNumberList <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.numberList === globalNumberList}</span>`</span>) <span class="hljs-comment">// false</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>使用UIUtils.getTarget接口可以获取代理前的原始对象。</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ObservedClass</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalObservedObject</span>: <span class="hljs-title class_">ObservedClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObservedClass</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalNumberList</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]; <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>([[<span class="hljs-number">0</span>, <span class="hljs-string">"a"</span>], [<span class="hljs-number">1</span>, <span class="hljs-string">"b"</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">"c"</span>]]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>([<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">globalSampleDate</span>: <span class="hljs-title class_">Date</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(); <span class="hljs-comment">// 不被代理</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@ComponentV2</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">observedObject</span>: <span class="hljs-title class_">ObservedClass</span> = globalObservedObject; <span class="hljs-comment">// V2中对象不被代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">numberList</span>: <span class="hljs-built_in">number</span>[] = globalNumberList; <span class="hljs-comment">// Array类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleMap</span>: <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">number</span>, <span class="hljs-built_in">string</span>&gt; = globalSampleMap; <span class="hljs-comment">// Map类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleSet</span>: <span class="hljs-title class_">Set</span>&lt;<span class="hljs-built_in">number</span>&gt; = globalSampleSet; <span class="hljs-comment">// Set类型创建代理</span></li><li>  <span class="hljs-meta">@Local</span> <span class="hljs-attr">sampleDate</span>: <span class="hljs-title class_">Date</span> = globalSampleDate; <span class="hljs-comment">// Date类型创建代理</span></li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`this.observedObject === globalObservedObject <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.observedObject ===</span></span></li><li><span class="hljs-string">           globalObservedObject}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.numberList) === globalNumberList: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.numberList) ===</span></span></li><li><span class="hljs-string">           globalNumberList}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleMap) === globalSampleMap: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleMap) ===</span></span></li><li><span class="hljs-string">           globalSampleMap}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleSet) === globalSampleSet: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleSet) ===</span></span></li><li><span class="hljs-string">           globalSampleSet}</span>`) <span class="hljs-comment">// true</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`UIUtils.getTarget(this.sampleDate) === globalSampleDate: <span class="hljs-subst">${UIUtils.getTarget(<span class="hljs-variable language_">this</span>.sampleDate) ===</span></span></li><li><span class="hljs-string">           globalSampleDate}</span>`) <span class="hljs-comment">// true</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>状态管理V2装饰器会为装饰的变量生成getter和setter方法，同时为原有变量名添加"__ob_"的前缀。出于性能考虑，getTarget接口不会对V2装饰器生成的前缀进行处理，因此向getTarget接口传入@ObservedV2装饰的类对象实例时，返回的对象依旧为对象本身，且被@Trace装饰的属性名仍有"__ob_"前缀。</p>     <p>该前缀会导致某些NAPI接口无法按预期处理对象的属性，以下面的对象为例，目前已知影响的NAPI接口如下：</p>     <div _ngcontent-fvf-c106="" class="highlight-div"><div _ngcontent-fvf-c106="" class="highlight-div-header"><div _ngcontent-fvf-c106="" class="highlight-div-header-left"><div _ngcontent-fvf-c106="" class="handle-button expand-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fvf-c106="" class="highlight-div-header-right"><div _ngcontent-fvf-c106="" class="handle-button ai-button"></div><div _ngcontent-fvf-c106="" class="handle-button line-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fvf-c106="" class="handle-button theme-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fvf-c106="" class="handle-button copy-button"><div _ngcontent-fvf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fvf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ObservedV2装饰的类</span></li><li><span class="hljs-meta">@ObservedV2</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Info</span> {</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Tom"</span>;</li><li>  <span class="hljs-meta">@Trace</span> <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">24</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">info</span>: <span class="hljs-title class_">Info</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Info</span>(); <span class="hljs-comment">// NAPI接口传入info实例</span></li></ol></pre></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.1" valign="top" width="50%">影响接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.9.1.3.1.2" valign="top" width="50%">影响结果</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">napi_get_property_names</td>         <td class="cellrowborder" valign="top" width="50%">返回值为"__ob_name"，"__ob_age"。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_set_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均能赋值成功。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_get_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均能获取到值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_has_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均返回true。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_delete_property</td>         <td class="cellrowborder" valign="top" width="50%">删除属性时需要加上"__ob_"前缀才能删除成功。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_has_own_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均返回true。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_set_named_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均能赋值成功。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_get_named_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均能获取到值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">napi_has_named_property</td>         <td class="cellrowborder" valign="top" width="50%">使用"name"，"__ob_name"均返回true。</td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>