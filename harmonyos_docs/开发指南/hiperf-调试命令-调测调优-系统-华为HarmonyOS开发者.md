<h1 _ngcontent-yja-c119="" class="doc-title ng-star-inserted" title="hiperf"> hiperf </h1>

<div _ngcontent-yja-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>hiperf是一款集成多种性能分析功能的命令行工具，可用于分析系统性能瓶颈、定位软件热点及优化代码效率，支持采集和统计程序运行时的性能数据。</p> <p>开发者可优先使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-insight-session-time" target="_blank">Deveco Studio</a>或<a href="https://gitcode.com/openharmony/developtools_smartperf_host/blob/master/smartperf_host/ide/src/doc/md/quickstart_hiperf.md" target="_blank">SmartPerf</a>等图形前端工具采集函数的调用栈，获取调用栈上各层函数的执行时间，通过泳道图等方式查看调用链信息进而进行性能分析。若需要指定采集的事件、采样周期、采集时长、CPU核数等选项，可以单独使用 hiperf 命令行工具。采样数据 perf.data 文件可以使用SmartPerf工具打开并以可视化的火焰图进行展示。</p> <p>本文档详细说明了hiperf命令行工具的使用方法，帮助开发者借助该工具进行详细的性能分析。</p>  <div class="tiledSection"><h2 id="环境要求">环境要求<i class="anchor-icon anchor-icon-link" anchorid="环境要求" tips="复制节点链接"></i></h2><ul><li><p>根据hdc命令行工具指导，完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc#环境准备">环境准备</a>。</p>  </li><li><p>确保设备已连接，然后执行hdc shell。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="命令行说明">命令行说明<i class="anchor-icon anchor-icon-link" anchorid="命令行说明" tips="复制节点链接"></i></h2><p>使用hiperf --help可以列出hiperf所有的命令，包括dump、list、record、report、stat等。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiperf --<span class="hljs-built_in">help</span></span></li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.1" valign="top" width="50%">命令</th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.2" valign="top" width="50%">命令说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">--hilog</td> <td class="cellrowborder" valign="top" width="50%">设置该选项后，程序运行过程中产生的日志会被记录到hilog中。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--logpath</td> <td class="cellrowborder" valign="top" width="50%">设置日志文件的保存路径，现支持用户将输出文件路径设定为"/data/local/tmp/"目录，并允许用户自定义文件名称。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--logtag</td> <td class="cellrowborder" valign="top" width="50%">开启指定功能的日志。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--debug</td> <td class="cellrowborder" valign="top" width="50%">记录debug级别的日志。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--verbose</td> <td class="cellrowborder" valign="top" width="50%">记录verbose级别的日志。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--much</td> <td class="cellrowborder" valign="top" width="50%">记录much级别的日志。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--nodebug</td> <td class="cellrowborder" valign="top" width="50%">关闭所有日志的记录。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--mixlog</td> <td class="cellrowborder" valign="top" width="50%">日志输出到命令行界面。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="/consumer/cn/doc/harmonyos-guides/hiperf#dump命令">dump</a></td> <td class="cellrowborder" valign="top" width="50%">将性能数据文件（如perf.data）转换为内容可读的格式。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="/consumer/cn/doc/harmonyos-guides/hiperf#list命令">list</a></td> <td class="cellrowborder" valign="top" width="50%">展示当前系统支持的性能事件类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="/consumer/cn/doc/harmonyos-guides/hiperf#record命令">record</a></td> <td class="cellrowborder" valign="top" width="50%">收集性能数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="/consumer/cn/doc/harmonyos-guides/hiperf#report命令">report</a></td> <td class="cellrowborder" valign="top" width="50%">将性能数据进行可视化转换。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="/consumer/cn/doc/harmonyos-guides/hiperf#stat命令">stat</a></td> <td class="cellrowborder" valign="top" width="50%">统计性能数据。</td> </tr>  </tbody></table></div> </div> <p><strong>使用样例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiperf --<span class="hljs-built_in">help</span></span></li><li>Usage: hiperf [options] command [args for command]</li><li>options:</li><li>        --debug                 show debug log, usage format: --debug [command] [args]</li><li>        --help                  show help</li><li>        --hilog                 use hilog not file to record log</li><li>        --logpath               log file name full path, usage format: --logpath [filepath] [command] [args]</li><li>        --logtag                enable log level for HILOG_TAG, usage format: --logtag &lt;tag&gt;[:level][,&lt;tag&gt;[:level]] [command] [args]</li><li>                                tag: Dump, Report, Record, Stat... level: D, V, M...</li><li>                                example: hiperf --verbose --logtag Record:D [command] [args]</li><li>        --mixlog                mix the log in output, usage format: --mixlog [command] [args]</li><li>        --much                  show extremely much debug log, usage format: --much [command] [args]</li><li>        --nodebug               disable debug log, usage format: --nodebug [command] [args]</li><li>        --verbose               show debug log, usage format: --verbose [command] [args]</li><li>        -h                      show help</li><li>command:</li><li>        dump:   Dump content of a perf data file, like perf.data</li><li>        help:   Show more help information for hiperf</li><li>        list:   List the supported event types.</li><li>        record: Collect performance sample information</li><li>        report: report sampling information from perf.data format file</li><li>        stat:   Collect performance counter information</li><li>
</li><li>See 'hiperf help [command]' for more information on a specific command.</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="常用命令">常用命令<i class="anchor-icon anchor-icon-link" anchorid="常用命令" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="性能数据采样记录" class="firsth2">性能数据采样记录<i class="anchor-icon anchor-icon-link" anchorid="性能数据采样记录" tips="复制节点链接"></i></h3><ol><li><p>对进程ID为1234的进程采样10秒，设置回栈方式为fp（栈指针），采样频率1000次/秒，事件类型为hw-cpu-cycles和hw-instructions，采样文件保存至/data/local/tmp/perf.data。</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiperf record -p 1234 -s fp -f 1000 -d 10 -e hw-cpu-cycles,hw-instructions -o /data/local/tmp/perf.data</span></li><li>Profiling duration is 10.000 seconds.</li><li>Start Profiling...</li><li>Timeout exit (total 10335 ms)</li><li>Process and Saving data...</li><li>Hiperf is not running as root mode. Do not need load kernel syms</li><li>[ hiperf record: Captured 3.014 MB perf data. ]</li><li>[ Sample records: 1293, Non sample records: 855 ]</li><li>[ Sample lost: 0, Non sample lost: 0 ]</li></ol></pre></div></div>  <p> 采集的数据将保存为二进制格式的perf.data文件，包含性能分析所需的采样数据、进程信息、符号表及函数调用等内容。利用火焰图脚本可将采样数据转换为可视化火焰图，以此分析系统性能瓶颈、定位软件热点并优化代码效率。</p>  </li><li><p>对应用com.example.insight_test_stage进行采样，采样时长为10s，回栈方式设置为dwarf（调试信息表），采样周期为1000，事件类型为hw-cpu-cycles和hw-instructions，使用默认保存路径。</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiperf record --app com.example.insight_test_stage -d 10 -s dwarf --period 1000 -e hw-cpu-cycles,hw-instructions</span></li><li>Profiling duration is 10.000 seconds.</li><li>Start Profiling...</li><li>Timeout exit (total 10000 ms)</li><li>Process and Saving data...</li><li>Hiperf is not running as root mode. Do not need load kernel syms</li><li>[ hiperf record: Captured 0.296 MB perf data. ]</li><li>[ Sample records: 0, Non sample records: 2640 ]</li><li>[ Sample lost: 0, Non sample lost: 0 ]</li></ol></pre></div></div>  <p> 采集的数据会被保存至默认路径/data/local/tmp/perf.data中。</p>  </li></ol> </div>  <div class="tiledSection"><h3 id="性能数据统计">性能数据统计<i class="anchor-icon anchor-icon-link" anchorid="性能数据统计" tips="复制节点链接"></i></h3><ol><li><p>对进程ID为1745，1910的进程进行计数，计数时长为10s。</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>$ hiperf <span class="hljs-built_in">stat</span> -d 10 -p 1745,1910</li><li>Profiling duration is 10.000 seconds.</li><li>Start Profiling...</li><li>Timeout <span class="hljs-built_in">exit</span> (total 10000 ms)</li><li>                    count  name                           | comment                          | coverage</li><li>                  148,450  hw-branch-instructions         | 26.404 M/sec                     | (100%)</li><li>                  49,833  hw-branch-misses               | 33.568878 miss rate              | (100%)</li><li>                8,986,523  hw-cpu-cycles                  | 1.598409 GHz                     | (100%)</li><li>                1,283,596  hw-instructions                | 7.001053 cycles per instruction  | (100%)</li><li>                      63  sw-context-switches            | 11.206 K/sec                     | (100%)</li><li>                        0  sw-page-faults                 | 0.000 /sec                       | (100%)</li><li>                5,622,169  sw-task-clock                  | 0.000562 cpus used               | (100%)</li></ol></pre></div></div>  </li><li><p>对进程ID为1745和1910的进程进行计数，计数时长为10秒，事件类型为hw-cpu-cycles、hw-instructions、sw-task-clock，指定打印信息的时间间隔为3000ms。</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-sql" data-highlighted="yes"><ol class="linenums"><li>$ hiperf stat <span class="hljs-operator">-</span>d <span class="hljs-number">10</span> <span class="hljs-operator">-</span>p <span class="hljs-number">1745</span>,<span class="hljs-number">1910</span> <span class="hljs-operator">-</span>e hw<span class="hljs-operator">-</span>cpu<span class="hljs-operator">-</span>cycles,hw<span class="hljs-operator">-</span>instructions,sw<span class="hljs-operator">-</span>task<span class="hljs-operator">-</span>clock <span class="hljs-operator">-</span>i <span class="hljs-number">3000</span></li><li>Profiling duration <span class="hljs-keyword">is</span> <span class="hljs-number">10.000</span> seconds.</li><li><span class="hljs-keyword">Start</span> Profiling...</li><li>Report <span class="hljs-keyword">at</span> <span class="hljs-number">3000</span> ms (<span class="hljs-number">6999</span> ms <span class="hljs-keyword">left</span>):</li><li>                    count  name                           <span class="hljs-operator">|</span> comment                          <span class="hljs-operator">|</span> coverage</li><li>                <span class="hljs-number">2</span>,<span class="hljs-number">534</span>,<span class="hljs-number">675</span>  hw<span class="hljs-operator">-</span>cpu<span class="hljs-operator">-</span>cycles                  <span class="hljs-operator">|</span> <span class="hljs-number">1.717114</span> GHz                     <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                  <span class="hljs-number">324</span>,<span class="hljs-number">279</span>  hw<span class="hljs-operator">-</span>instructions                <span class="hljs-operator">|</span> <span class="hljs-number">7.816340</span> cycles <span class="hljs-keyword">per</span> instruction  <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                <span class="hljs-number">1</span>,<span class="hljs-number">476</span>,<span class="hljs-number">125</span>  sw<span class="hljs-operator">-</span>task<span class="hljs-operator">-</span>clock                  <span class="hljs-operator">|</span> <span class="hljs-number">0.000492</span> cpus used               <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>Report <span class="hljs-keyword">at</span> <span class="hljs-number">6000</span> ms (<span class="hljs-number">3999</span> ms <span class="hljs-keyword">left</span>):</li><li>                    count  name                           <span class="hljs-operator">|</span> comment                          <span class="hljs-operator">|</span> coverage</li><li>                <span class="hljs-number">5</span>,<span class="hljs-number">112</span>,<span class="hljs-number">570</span>  hw<span class="hljs-operator">-</span>cpu<span class="hljs-operator">-</span>cycles                  <span class="hljs-operator">|</span> <span class="hljs-number">1.724259</span> GHz                     <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                  <span class="hljs-number">648</span>,<span class="hljs-number">303</span>  hw<span class="hljs-operator">-</span>instructions                <span class="hljs-operator">|</span> <span class="hljs-number">7.886081</span> cycles <span class="hljs-keyword">per</span> instruction  <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                <span class="hljs-number">2</span>,<span class="hljs-number">965</span>,<span class="hljs-number">083</span>  sw<span class="hljs-operator">-</span>task<span class="hljs-operator">-</span>clock                  <span class="hljs-operator">|</span> <span class="hljs-number">0.000494</span> cpus used               <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>Report <span class="hljs-keyword">at</span> <span class="hljs-number">9000</span> ms (<span class="hljs-number">999</span> ms <span class="hljs-keyword">left</span>):</li><li>                    count  name                           <span class="hljs-operator">|</span> comment                          <span class="hljs-operator">|</span> coverage</li><li>                <span class="hljs-number">7</span>,<span class="hljs-number">870</span>,<span class="hljs-number">422</span>  hw<span class="hljs-operator">-</span>cpu<span class="hljs-operator">-</span>cycles                  <span class="hljs-operator">|</span> <span class="hljs-number">1.724897</span> GHz                     <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                  <span class="hljs-number">994</span>,<span class="hljs-number">407</span>  hw<span class="hljs-operator">-</span>instructions                <span class="hljs-operator">|</span> <span class="hljs-number">7.914689</span> cycles <span class="hljs-keyword">per</span> instruction  <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>                <span class="hljs-number">4</span>,<span class="hljs-number">562</span>,<span class="hljs-number">835</span>  sw<span class="hljs-operator">-</span>task<span class="hljs-operator">-</span>clock                  <span class="hljs-operator">|</span> <span class="hljs-number">0.000507</span> cpus used               <span class="hljs-operator">|</span> (<span class="hljs-number">100</span><span class="hljs-operator">%</span>)</li><li>Timeout exit (total <span class="hljs-number">10000</span> ms)</li></ol></pre></div></div>  </li><li><p>对进程ID为1910的进程进行计数，计数时长为3s，事件类型为hw-cpu-cycles，hw-instructions，并打印详细的信息。</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>$ <span class="hljs-variable">hiperf</span> <span class="hljs-variable">stat</span> -<span class="hljs-variable">d</span> <span class="hljs-number">3</span> -<span class="hljs-variable">p</span> <span class="hljs-number">1910</span> -<span class="hljs-variable">e</span> <span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span>,<span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span> --<span class="hljs-variable">verbose</span></li><li><span class="hljs-variable">Profiling</span> <span class="hljs-variable">duration</span> <span class="hljs-keyword">is</span> <span class="hljs-number">3.000</span> <span class="hljs-variable">seconds</span>.</li><li><span class="hljs-variable">Start</span> <span class="hljs-variable">Profiling</span>...</li><li><span class="hljs-variable">Timeout</span> <span class="hljs-variable">exit</span> (<span class="hljs-variable">total</span> <span class="hljs-number">3000</span> <span class="hljs-variable">ms</span>)</li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1342</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1910</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">133583</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">133583</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">255740</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1343</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1988</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">0</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1344</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1989</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">0</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1345</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1990</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">187833</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">187833</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">331425</span></li><li>...</li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1375</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1910</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">133583</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">133583</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">36485</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1376</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1988</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">0</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1377</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1989</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">0</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">0</span></li><li><span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span> <span class="hljs-variable">id</span>:<span class="hljs-number">1378</span>(<span class="hljs-variable">c</span>-<span class="hljs-number">1</span>:<span class="hljs-title class_">p1990</span>) <span class="hljs-title class_">timeEnabled</span>:<span class="hljs-number">187833</span> <span class="hljs-title class_">timeRunning</span>:<span class="hljs-number">187833</span> <span class="hljs-title class_">value</span>:<span class="hljs-number">47816</span></li><li>...</li><li>                    <span class="hljs-variable">count</span>  <span class="hljs-variable">name</span>                           | <span class="hljs-variable">comment</span>                          | <span class="hljs-variable">coverage</span></li><li>                  <span class="hljs-number">669</span>,<span class="hljs-number">850</span>  <span class="hljs-variable">hw</span>-<span class="hljs-variable">cpu</span>-<span class="hljs-variable">cycles</span>                  |                                  | (<span class="hljs-number">100</span>%)</li><li>                  <span class="hljs-number">94</span>,<span class="hljs-number">903</span>  <span class="hljs-variable">hw</span>-<span class="hljs-variable">instructions</span>                | <span class="hljs-number">7.058259</span> <span class="hljs-variable">cycles</span> <span class="hljs-variable">per</span> <span class="hljs-variable">instruction</span>  | (<span class="hljs-number">100</span>%)</li></ol></pre></div></div>  </li></ol> </div>  <div class="tiledSection"><h2 id="debug应用">debug应用<i class="anchor-icon anchor-icon-link" anchorid="debug应用" tips="复制节点链接"></i></h2><div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">  <p>hiperf record/stat -p [pid] 命令采集的进程应为“使用调试证书签名的应用”。</p>  <p>确认命令指定的应用是否为可调试应用，可执行hdc shell "bm dump -n bundlename | grep appProvisionType"查询，预期返回信息为"appProvisionType": "debug"。</p>  <p>以包名com.example.myapplication为例，可执行如下命令查询：</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>hdc shell "bm dump -n com.example.myapplication | grep appProvisionType"</li></ol></pre></div></div>  <p>如包名对应的应用是可调试应用，预期返回信息如下：</p>  <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>"appProvisionType": "debug",</li></ol></pre></div></div>  <p>构建可调试应用需要使用调试证书进行签名，申请调试证书及签名可参考：<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-add-debugcert-0000001914263178" target="_blank">申请调试证书</a>。</p>  </div></div></div> </div>  <div class="tiledSection"><h2 id="list命令">list命令<i class="anchor-icon anchor-icon-link" anchorid="list命令" tips="复制节点链接"></i></h2><p>展示当前系统支持的性能事件类型，事件类型可用于record和stat命令-e选项的参数。</p> <p><strong>参数</strong>：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.1" valign="top" width="50%">参数名</th> <th align="left" class="cellrowborder" id="mcps1.3.10.4.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">hw</td> <td class="cellrowborder" valign="top" width="50%"><p>硬件事件。</p> <p>当前支持事件：</p> <p>- hw-cpu-cycles</p> <p>- hw-instructions</p> <p>- hw-cache-references</p> <p>- hw-cache-misses</p> <p>- hw-branch-instructions</p> <p>- hw-branch-misses</p> <p>- hw-bus-cycles</p> <p>- hw-stalled-cycles-frontend</p> <p>- hw-stalled-cycles-backend</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">sw</td> <td class="cellrowborder" valign="top" width="50%">软件事件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">tp</td> <td class="cellrowborder" valign="top" width="50%">tracepoint事件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">cache</td> <td class="cellrowborder" valign="top" width="50%">硬件缓存事件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">raw</td> <td class="cellrowborder" valign="top" width="50%">原始性能监测单元（PMU）事件。</td> </tr>  </tbody></table></div> </div> <p><strong>命令行示例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Usage</span>: <span class="hljs-title class_">hiperf</span> <span class="hljs-title class_">list</span> [<span class="hljs-title class_">event</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">name</span>]</li></ol></pre></div></div> <p>查询支持的硬件事件类型。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li>$ hiperf list hw</li><li><span class="hljs-keyword">event</span> <span class="hljs-keyword">not</span> support hw-<span class="hljs-keyword">ref</span>-cpu-cycles</li><li>
</li><li>Supported events <span class="hljs-keyword">for</span> hardware:</li><li>        hw-cpu-cycles</li><li>        hw-instructions</li><li>        hw-cache-references</li><li>        hw-cache-misses</li><li>        hw-branch-instructions</li><li>        hw-branch-misses</li><li>        hw-bus-cycles</li><li>        hw-stalled-cycles-frontend</li><li>        hw-stalled-cycles-backend</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="record命令">record命令<i class="anchor-icon anchor-icon-link" anchorid="record命令" tips="复制节点链接"></i></h2><p>采集指定进程或指定应用的性能数据，包括CPU周期、指令数、函数调用等信息，并且将采样数据保存到指定的文件中（默认路径以设备上运行 hiperf record -h/--help 时显示的 -o 参数说明为准）。</p> <p><strong>record命令参数说明</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.4.1.3.1.1" valign="top" width="50%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.11.4.1.3.1.2" valign="top" width="50%">参数说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-c</td> <td class="cellrowborder" valign="top" width="50%">设置采集的CPU id，只采集对应的CPU数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--cpu-limit</td> <td class="cellrowborder" valign="top" width="50%">设置采集时CPU最大占比，取值范围：1 - 100，默认25。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-d</td> <td class="cellrowborder" valign="top" width="50%">采集时长，单位为s。该参数不能和--control一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-f</td> <td class="cellrowborder" valign="top" width="50%">采集频率，默认4000次/s。该参数不能和--period一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--period</td> <td class="cellrowborder" valign="top" width="50%">设置采集事件周期，多少事件采集一次。该参数不能和-f一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-e</td> <td class="cellrowborder" valign="top" width="50%">采集事件，支持对多种事件进行采集，多个事件之间以逗号隔开。可通过list命令获取当前支持的事件类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-g</td> <td class="cellrowborder" valign="top" width="50%">采集事件群组，以逗号隔开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--no-inherit</td> <td class="cellrowborder" valign="top" width="50%">不采集子进程数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-p</td> <td class="cellrowborder" valign="top" width="50%">采集进程id，支持对多个进程进行采样，多个进程号之间以逗号隔开。采集的进程应为“<a href="/consumer/cn/doc/harmonyos-guides/hiperf#debug应用">使用调试证书签名的应用</a>”。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-t</td> <td class="cellrowborder" valign="top" width="50%">采集线程id，支持对多个线程进行采样，多个线程号之间以逗号隔开。采集的线程应为“<a href="/consumer/cn/doc/harmonyos-guides/hiperf#debug应用">使用调试证书签名的应用</a>”。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--exclude-tid</td> <td class="cellrowborder" valign="top" width="50%">不采集线程id，通过线程id排除特定线程的采样。多个线程号之间以逗号隔开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--exclude-thread</td> <td class="cellrowborder" valign="top" width="50%">不采集线程名，通过线程名排除特定线程的采样。多个线程名之间以逗号隔开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--offcpu</td> <td class="cellrowborder" valign="top" width="50%">跟踪线程何时脱离CPU调度。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-j</td> <td class="cellrowborder" valign="top" width="50%">分支堆栈采样，过滤器支持any、any_call、any_ret、ind_call、ind_jmp、cond、call。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-s/--callstack</td> <td class="cellrowborder" valign="top" width="50%">设置回栈模式，可设置为fp(栈指针)、dwarf(调试信息表)两种模式中的一种，默认是fp模式。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--kernel-callchain</td> <td class="cellrowborder" valign="top" width="50%">采集内核态堆栈，该参数必须和-s参数一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--callchain-useronly</td> <td class="cellrowborder" valign="top" width="50%">仅收集用户态堆栈。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--delay-unwind</td> <td class="cellrowborder" valign="top" width="50%">回栈模式被设置为dwarf时，设置此选项后调用栈会在录制后展开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--disable-unwind</td> <td class="cellrowborder" valign="top" width="50%">回栈模式被设置为dwarf时，设置此选项后调用栈将不会在录制后展开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--disable-callstack-expand</td> <td class="cellrowborder" valign="top" width="50%">回栈模式被设置为dwarf时，设置此选项后会用缓存的线程栈来对调用栈进行合并。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--enable-debuginfo-symbolic</td> <td class="cellrowborder" valign="top" width="50%">-s fp/dwarf被设置时，elf在.gnu_debugdata段的符号会被解析，默认不解析。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--clockid</td> <td class="cellrowborder" valign="top" width="50%">设置采集时钟类型，支持monotonic和monotonic_raw，部分事件支持boottime、realtime和clock_tai时钟类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--symbol-dir</td> <td class="cellrowborder" valign="top" width="50%">符号表文件路径，用于采集过程中进行符号化操作。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-m</td> <td class="cellrowborder" valign="top" width="50%">mmap页数量，取值范围：2 - 1024，默认1024。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--app</td> <td class="cellrowborder" valign="top" width="50%">采集的应用程序名，以逗号隔开。应用程序必须是启动状态，应用程序未启动时会等待20s，20s内应用程序未启动，命令会自动结束。采集的应用应为“<a href="/consumer/cn/doc/harmonyos-guides/hiperf#debug应用">使用调试证书签名的应用</a>”。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--chkms</td> <td class="cellrowborder" valign="top" width="50%">设置查询的间隔时间，单位为ms。取值范围：1 - 200，默认10。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--data-limit</td> <td class="cellrowborder" valign="top" width="50%">输出数据达到指定大小停止采集，默认无限制。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-o</td> <td class="cellrowborder" valign="top" width="50%">设置输出文件路径，并允许用户自定义文件名称。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-z</td> <td class="cellrowborder" valign="top" width="50%">以.gz的压缩文件形式输出。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--restart</td> <td class="cellrowborder" valign="top" width="50%">收集应用启动的性能指标信息，如果进程在30秒内未启动，采集操作将结束。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--verbose</td> <td class="cellrowborder" valign="top" width="50%">输出更详细的报告。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--control [command]</td> <td class="cellrowborder" valign="top" width="50%">采集操作启停控制参数。命令包括prepare/start/pause/resume/output/stop。该参数不能和-d一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--dedup_stack</td> <td class="cellrowborder" valign="top" width="50%">删除记录中的重复堆栈。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--cmdline-size</td> <td class="cellrowborder" valign="top" width="50%">设置/sys/kernel/tracing/saved_cmdlines_size节点的值，单位byte，取值范围：512 - 4096。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--report</td> <td class="cellrowborder" valign="top" width="50%">采集后回栈报告。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--backtrack</td> <td class="cellrowborder" valign="top" width="50%">采集之前一段时间的数据，该参数必须和--control prepare一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--backtrack-sec</td> <td class="cellrowborder" valign="top" width="50%">采集之前数据的时长，单位为秒。取值范围：5 - 30，默认10。该参数必须和--backtrack一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--dumpoptions</td> <td class="cellrowborder" valign="top" width="50%">展示采集参数的详细信息。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--pipe_input</td> <td class="cellrowborder" valign="top" width="50%">在设备开发中，该参数用于客户端进程调用hiperf时建立命令输入通道，开发者可参考<a href="https://gitcode.com/openharmony/docs/blob/master/zh-cn/device-dev/subsystems/subsys-toolchain-hiperf.md" target="_blank">hiperf_client接口</a>使用该能力。在应用开发中，无需使用该参数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--pipe_output</td> <td class="cellrowborder" valign="top" width="50%">在设备开发中，该参数用于客户端进程调用hiperf时建立响应输出通道，开发者可参考<a href="https://gitcode.com/openharmony/docs/blob/master/zh-cn/device-dev/subsystems/subsys-toolchain-hiperf.md" target="_blank">hiperf_client接口</a>使用该能力。在应用开发中，无需使用该参数。</td> </tr>  </tbody></table></div> </div> <p><strong>命令行示例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Usage</span>: <span class="hljs-title class_">hiperf</span> <span class="hljs-title class_">record</span> [<span class="hljs-title class_">options</span>] [<span class="hljs-variable">command</span> [<span class="hljs-variable">command</span>-<span class="hljs-variable">args</span>]]</li></ol></pre></div></div> <p>对指定的pid为267的进程采样10秒，并使用dwarf回栈。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ruby" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">$ </span>hiperf record -p <span class="hljs-number">267</span> -d <span class="hljs-number">10</span> -s dwarf</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="stat命令">stat命令<i class="anchor-icon anchor-icon-link" anchorid="stat命令" tips="复制节点链接"></i></h2><p>监听用户指定的目标程序，周期性打印性能计数器的值。</p> <p><strong>stat命令参数说明</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.4.1.3.1.1" valign="top" width="50%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.3.1.2" valign="top" width="50%">参数说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-c</td> <td class="cellrowborder" valign="top" width="50%">设置采集的CPU ID，只采集对应的CPU数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-d</td> <td class="cellrowborder" valign="top" width="50%">采集时长，单位为s。该参数不能和--control一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-i</td> <td class="cellrowborder" valign="top" width="50%">设置打印stat信息的间隔时长，单位ms。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-e</td> <td class="cellrowborder" valign="top" width="50%">采集事件，支持采集多种事件，多个事件之间以逗号隔开。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-g</td> <td class="cellrowborder" valign="top" width="50%">采集事件群组，以逗号隔开。可通过list命令获取当前支持的事件类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--no-inherit</td> <td class="cellrowborder" valign="top" width="50%">不采集子进程数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-p</td> <td class="cellrowborder" valign="top" width="50%">采集进程ID，支持对多个进程进行采样，多个进程号之间以逗号隔开。该参数不能和-a一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-t</td> <td class="cellrowborder" valign="top" width="50%">采集线程ID，支持对多个线程进行采样，多个线程号之间以逗号隔开。该参数不能和-a一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--app</td> <td class="cellrowborder" valign="top" width="50%">采集的应用程序名，以逗号隔开。应用程序必须是启动状态，应用程序未启动时会等待20s，20s内应用程序未启动，命令会自动结束。该参数不能和-a一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--chkms</td> <td class="cellrowborder" valign="top" width="50%">设置查询的间隔时间，单位为毫秒，取值范围：1 - 200，默认10。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--per-core</td> <td class="cellrowborder" valign="top" width="50%">每个CPU核的打印计数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--pre-thread</td> <td class="cellrowborder" valign="top" width="50%">每个线程的打印计数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--restart</td> <td class="cellrowborder" valign="top" width="50%">收集应用启动的性能指标信息，如果进程在30秒内未启动，记录将退出。该参数必须和--app一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--verbose</td> <td class="cellrowborder" valign="top" width="50%">输出详细的信息。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--dumpoptions</td> <td class="cellrowborder" valign="top" width="50%">展示当前列表里所有选项的详细信息。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--control [command]</td> <td class="cellrowborder" valign="top" width="50%"><p>采集操作启停控制参数。命令包括prepare/start/stop。该参数不能和-d一起使用。</p> <p><strong>说明</strong>：从API version 20开始，支持该参数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-o</td> <td class="cellrowborder" valign="top" width="50%"><p>设置输出文件路径，并允许用户自定义文件名称。</p> <p>默认路径以设备上运行 hiperf stat -h/--help 时显示的 -o 参数说明为准。</p> <p>该参数必须和--control prepare一起使用，不能和--control一起使用。</p> <p><strong>说明</strong>：从API version 20开始，支持该参数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-a</td> <td class="cellrowborder" valign="top" width="50%">统计整机的性能数据。</td> </tr>  </tbody></table></div> </div> <p><strong>命令行示例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li>hiperf <span class="hljs-built_in">stat</span> [options] [<span class="hljs-built_in">command</span> [command-args]]</li></ol></pre></div></div> <p>使用stat命令监听进程号为2349的进程在CPU 0上运行3秒的性能数据。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiperf <span class="hljs-built_in">stat</span> -p 1745 -d 3 -c 0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="dump命令">dump命令<i class="anchor-icon anchor-icon-link" anchorid="dump命令" tips="复制节点链接"></i></h2><p>此命令用于将不同格式的性能数据文件（如perf.data）转换为内容易读的明文，便于开发和测试人员核对其中原始采样数据的正确性。</p> <p><strong>dump命令参数说明</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.4.1.3.1.1" valign="top" width="50%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.3.1.2" valign="top" width="50%">参数说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--head</td> <td class="cellrowborder" valign="top" width="50%">仅输出数据头和属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-d</td> <td class="cellrowborder" valign="top" width="50%">仅输出数据段。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-f</td> <td class="cellrowborder" valign="top" width="50%">仅输出附加功能。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--sympath</td> <td class="cellrowborder" valign="top" width="50%">符号表文件路径。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-i</td> <td class="cellrowborder" valign="top" width="50%">采样文件的路径。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-o</td> <td class="cellrowborder" valign="top" width="50%">设置输出文件路径，现支持用户将输出文件路径设定为"/data/local/tmp/"目录，并允许用户自定义文件名称。若未设置该参数，数据将会输出到命令行界面。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--elf</td> <td class="cellrowborder" valign="top" width="50%">将elf格式的文件转换成内容可读的明文。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--proto</td> <td class="cellrowborder" valign="top" width="50%">将proto格式的文件转换成内容可读的明文。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--export</td> <td class="cellrowborder" valign="top" width="50%">将用户栈数据分割成多个文件。</td> </tr>  </tbody></table></div> </div> <p><strong>命令行示例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Usage</span>: <span class="hljs-title class_">hiperf</span> <span class="hljs-title class_">dump</span> [<span class="hljs-title class_">option</span>] \&lt;<span class="hljs-title class_">filename</span>\&gt;</li></ol></pre></div></div> <p>使用dump命令将/data/local/tmp/perf.data文件读取出来，并输出到/data/local/tmp/perf.dump文件中。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-lua" data-highlighted="yes"><ol class="linenums"><li>$ hiperf <span class="hljs-built_in">dump</span> -i /data/<span class="hljs-keyword">local</span>/tmp/perf.data -o /data/<span class="hljs-keyword">local</span>/tmp/perf.<span class="hljs-built_in">dump</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="report命令">report命令<i class="anchor-icon anchor-icon-link" anchorid="report命令" tips="复制节点链接"></i></h2><p>此命令主要用于将采样数据（perf.data）转换为用户指定的格式（例如Json或者ProtoBuf)，并可以将属于相同进程、线程、函数的样本分组到同一样本条目中，根据样本条目的事件计数对样本条目进行排序，并以报告的形式进行展示。</p> <p><strong>report命令参数说明</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.4.1.3.1.1" valign="top" width="50%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.3.1.2" valign="top" width="50%">参数说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-h/--help</td> <td class="cellrowborder" valign="top" width="50%">帮助命令。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--symbol-dir</td> <td class="cellrowborder" valign="top" width="50%">符号表文件路径。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--limit-percent</td> <td class="cellrowborder" valign="top" width="50%">筛选性能占比不低于指定百分比（取值范围 1 - 100）的性能数据，仅在报告中保留并展示符合该阈值条件的数据条目。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-s</td> <td class="cellrowborder" valign="top" width="50%">显示回栈模式。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--call-stack-limit-percent</td> <td class="cellrowborder" valign="top" width="50%">展示指定比例的堆栈内容，取值范围：1 - 100。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-i</td> <td class="cellrowborder" valign="top" width="50%">资源文件路径，默认perf.data。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-o</td> <td class="cellrowborder" valign="top" width="50%">设置输出文件路径，现支持用户将输出文件路径设定为"/data/local/tmp/"目录，并允许用户自定义文件名称。若未设置该参数，数据将会输出到命令行界面。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--proto</td> <td class="cellrowborder" valign="top" width="50%">输出protobuf格式数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--json</td> <td class="cellrowborder" valign="top" width="50%">输出json格式数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--diff</td> <td class="cellrowborder" valign="top" width="50%">显示源文件与转换后文件的差别。不能与--proto、--json、-s参数一起使用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--branch</td> <td class="cellrowborder" valign="top" width="50%">根据函数地址显示分支。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--&lt;keys&gt; &lt;keyname1&gt;[,keyname2][,...]</td> <td class="cellrowborder" valign="top" width="50%">可选关键字：comms、pids、tids、dsos、funcs、from_dsos、from_funcs，例如： --comms hiperf。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--sort [key1],[key2],[...]</td> <td class="cellrowborder" valign="top" width="50%">按关键字排序。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--hide_count</td> <td class="cellrowborder" valign="top" width="50%">报告中不显示数值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">--dumpoptions</td> <td class="cellrowborder" valign="top" width="50%">展示当前列表里所有选项的详细信息。</td> </tr>  </tbody></table></div> </div> <p><strong>命令行示例</strong>：</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">Usage</span>: <span class="hljs-title class_">hiperf</span> <span class="hljs-title class_">report</span> [<span class="hljs-title class_">option</span>] \&lt;<span class="hljs-title class_">filename</span>\&gt;</li></ol></pre></div></div> <p>从采样文件（perf.data）中提取对性能影响较大（占比≥1%）的关键数据，并以报告的形式进行展示。</p> <div _ngcontent-yja-c106="" class="highlight-div"><div _ngcontent-yja-c106="" class="highlight-div-header"><div _ngcontent-yja-c106="" class="highlight-div-header-left"><div _ngcontent-yja-c106="" class="handle-button expand-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yja-c106="" class="highlight-div-header-right"><div _ngcontent-yja-c106="" class="handle-button ai-button"></div><div _ngcontent-yja-c106="" class="handle-button line-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yja-c106="" class="handle-button theme-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yja-c106="" class="handle-button copy-button"><div _ngcontent-yja-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yja-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li>$ hiperf report -i /<span class="hljs-keyword">data</span>/local/tmp/perf.<span class="hljs-keyword">data</span> --limit-percent <span class="hljs-number">1</span></li></ol></pre></div></div> </div> </div> <div></div></div>