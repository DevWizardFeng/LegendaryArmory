<h1 _ngcontent-owc-c119="" class="doc-title ng-star-inserted" title="hiprofiler"> hiprofiler </h1>

<div _ngcontent-owc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="hiprofiler简介">Hiprofiler简介<i class="anchor-icon anchor-icon-link" anchorid="hiprofiler简介" tips="复制节点链接"></i></h2><p>HiProfiler调优组件旨在为开发者提供一系列调优能力，可以用来帮助分析内存、性能等问题。</p> <p>整体架构包括PC端和设备端。主体部分是PC端的数据展示页面和设备端的性能调优服务。PC端和设备端服务采用C/S模型，PC端的调优数据在<a href="https://cbg.huawei.com/#/group/ipd/DevEcoToolsList" target="_blank">DevEco Studio</a>和<a href="https://gitcode.com/openharmony/developtools_smartperf_host" target="_blank">Smartperf</a>网页中展示。设备端程序运行在系统环境中，包含多个部分，其中hiprofilerd进程负责与DevEco通信，作为调优服务。设备端还包括命令行工具hiprofiler_cmd和数据采集进程hiprofiler_plugins。调优服务控制数据采集进程获取调优数据，数据最终流向DevEco Studio，整个过程可抽象为生产者-消费者模型。目前已完成多个插件，包括nativehook、CPU、ftrace、GPU、hiperf、xpower和memory数据采集，实现了CPU、GPU、内存和能耗等多维度调优。</p> <p>Hiprofiler工具对标业界调优工具，并提供更多能力，比如<a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#插件参数说明">跨语言回栈、能耗数据获取、长时间堆内存抓栈功能</a>等。</p> </div>  <div class="tiledSection"><h2 id="环境要求">环境要求<i class="anchor-icon anchor-icon-link" anchorid="环境要求" tips="复制节点链接"></i></h2><ul><li><p>根据hdc命令行工具指导，完成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc#环境准备">环境准备</a>。</p>  </li><li><p>确保设备已正常连接，并执行hdc shell。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="架构简介">架构简介<i class="anchor-icon anchor-icon-link" anchorid="架构简介" tips="复制节点链接"></i></h2><ol><li><p>PC端通过DevEco或Smartperf调用hiprofiler_cmd命令行工具；</p>  </li><li><p>hiprofiler_cmd进程启动hiprofilerd调优服务和hiprofiler_plugins插件进程；</p>  </li><li><p>hiprofiler_plugins开启对应插件，将获取到的调优数据汇总至hiprofilerd进程；</p>  </li><li><p>hiprofilerd进程将调优数据以proto格式存储到文件，或者实时返回给PC端；</p>  </li><li><p>PC端解析数据，生成泳道，展示获取到的调优数据。</p>  </li></ol> <p><span><img originheight="394" originwidth="341" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115024.13874313629376214893614165030950:50001231000000:2800:580C1DDCF749CDD8ABD17D7E60F69B23C80098A67AF053901AC30AE731803FA0.png" width="341" height="394"></span></p> </div>  <div class="tiledSection"><h2 id="命令行说明">命令行说明<i class="anchor-icon anchor-icon-link" anchorid="命令行说明" tips="复制节点链接"></i></h2><p>使用hiprofiler_cmd命令行工具可以调用不同插件并输入不同参数，以满足不同的调优需求。示范命令如下：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li> request_id: 1</li><li> session_config {</li><li>  buffers {</li><li>   pages: 16384</li><li>  }</li><li> }</li><li> plugin_configs {</li><li>  plugin_name: "ftrace-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>   hitrace_categories: "binder"</li><li>   buffer_size_kb: 204800</li><li>   flush_interval_ms: 1000</li><li>   flush_threshold_kb: 4096</li><li>   trace_period_ms: 200</li><li>  }</li><li> }</li><li>CONFIG</li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.4.1.3.1.1" valign="top" width="50%">命令</th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.3.1.2" valign="top" width="50%">命令说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">-c</td> <td class="cellrowborder" valign="top" width="50%">设置该选项后，需要将配置文件放入/data/local/tmp目录下，将路径作为参数输入。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-o</td> <td class="cellrowborder" valign="top" width="50%">自定义文件保存路径（需要以/data/local/tmp开头）。若不设置路径，则调优数据自动保存至/data/local/tmp/hiprofiler_data.htrace。重复调优会覆盖原来路径的文件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-k</td> <td class="cellrowborder" valign="top" width="50%">杀掉已存在的调优服务进程。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-s</td> <td class="cellrowborder" valign="top" width="50%">拉起调优服务进程。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">-t</td> <td class="cellrowborder" valign="top" width="50%">设置调优持续时间，单位：s。</td> </tr>  </tbody></table></div> </div> <p>输入完hiprofiler_cmd参数后，需要输入插件配置信息，以&lt;&lt;CONFIG开头，CONFIG结尾，中间内容以json格式输入。</p> <p>以下是session config字段介绍：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.7.1.3.1.1" valign="top" width="50%">字段</th> <th align="left" class="cellrowborder" id="mcps1.3.4.7.1.3.1.2" valign="top" width="50%">字段说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">buffers</td> <td class="cellrowborder" valign="top" width="50%">共享内存页的数量。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">split_file</td> <td class="cellrowborder" valign="top" width="50%">是否拆分文件。true代表拆分文件；false代表不拆分文件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">split_file_max_size_mb</td> <td class="cellrowborder" valign="top" width="50%">设置split_file为true的情况下，定义每个拆分文件的最大大小。</td> </tr>  </tbody></table></div> </div> <p>plugin_configs字段介绍：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.9.1.3.1.1" valign="top" width="50%">字段</th> <th align="left" class="cellrowborder" id="mcps1.3.4.9.1.3.1.2" valign="top" width="50%">字段说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">plugin_name</td> <td class="cellrowborder" valign="top" width="50%">开启插件的名字。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">sample_interval</td> <td class="cellrowborder" valign="top" width="50%">插件获取调优数据的间隔，单位：ms。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">config_data</td> <td class="cellrowborder" valign="top" width="50%"><p>插件具体参数。每个插件需要的参数不同，参考各插件proto定义。</p> <p>（代码路径：developtools/profiler/protos）。</p> </td> </tr>  </tbody></table></div> </div> <p>生成的trace文件通过hdc file recv命令导到本地，然后上传到smartperf网站或者DevEco Studio进行解析。</p> </div>  <div class="tiledSection"><h2 id="支持插件列表">支持插件列表<i class="anchor-icon anchor-icon-link" anchorid="支持插件列表" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.1" valign="top" width="33.33333333333333%">插件名字</th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.2" valign="top" width="33.33333333333333%">简介</th> <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.4.1.3" valign="top" width="33.33333333333333%">规格说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#native-hook插件">native hook</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取堆内存分配的调用栈信息。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">采集的进程仅支持<a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#使用调试证书签名的应用">使用调试证书签名的应用</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#ftrace-plugin插件">ftrace plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取内核打点的trace事件，以及hitrace打点的数据。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#cpu-plugin插件">cpu plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程CPU使用率信息，包括进程级和线程级的使用率。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#gpu-plugin插件">gpu plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程GPU使用率信息。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#xpower-plugin插件">xpower plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程能耗使用情况的数据。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#memory-plugin插件">memory plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程内存占用情况，主要是获取进程smaps节点的数据。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#diskio-plugin插件">diskio plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程磁盘空间占用情况。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">network profiler</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">通过进程内打点，获取进程HTTP请求的详细信息。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">采集的进程仅支持<a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#使用调试证书签名的应用">使用调试证书签名的应用</a>。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#network-plugin插件">network plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">获取进程网络流量统计信息。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#hisysevent-plugin插件">hisysevent plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">通过hisysevent命令，获取hisysevent的事件记录数据。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#hidump-plugin插件">hidump plugin</a></td> <td class="cellrowborder" valign="top" width="33.33333333333333%">通过SP_daemon命令获取相关数据。</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用调试证书签名的应用">使用调试证书签名的应用<i class="anchor-icon anchor-icon-link" anchorid="使用调试证书签名的应用" tips="复制节点链接"></i></h2><div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"> <p>确认命令指定的应用是否为可调试应用，可执行hdc shell "bm dump -n bundlename | grep appProvisionType"查询，预期返回信息为"appProvisionType": "debug"。</p>  </div></div></div> <p>以包名com.example.myapplication为例，可执行如下命令查询：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>hdc shell "bm dump -n com.example.myapplication | grep appProvisionType"</li></ol></pre></div></div> <p>如果包名对应的应用是可调试应用，预期返回信息如下：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>"appProvisionType": "debug",</li></ol></pre></div></div> <p>构建可调试应用需要使用调试证书进行签名，申请调试证书及签名可参考：<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-add-debugcert-0000001914263178" target="_blank">申请调试证书</a>。</p> </div>  <div class="tiledSection"><h2 id="插件参数说明">插件参数说明<i class="anchor-icon anchor-icon-link" anchorid="插件参数说明" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="native-hook插件" class="firsth2">native hook插件<i class="anchor-icon anchor-icon-link" anchorid="native-hook插件" tips="复制节点链接"></i></h3><p>获取堆内存分配的调用栈信息（通过malloc、mmap、calloc或realloc等基础库函数分配堆内存的调用栈），包括跨语言堆内存分配信息（如在ArkTS语言中调用napi分配native堆内存），还能展示内存泄漏未释放堆内存调用栈信息。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.8.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">fp_unwind</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%"><p>true表示使用fp回栈方式进行回栈；</p> <p>false表示使用dwarf回栈方式进行回栈。</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>fp回栈是利用了x29寄存器保存的fp指针，函数的fp指针始终指向父函数（调用方）的fp指针，调优服务根据这一特点进行回栈，根据ip计算相对PC，然后查找maps对应区间来进行符号化。</p> <p>由于现在编译期越来越优化，出现寄存器重用或者编译禁用fp，会导致fp方式回不出相应的栈；混合栈情况下，fp不会记录多重混合，于是便需要dwarf回栈方式做更精确的回栈。</p> <p>dwarf回栈是根据pc寄存器在map表中查找对应的map信息，由于dwarf是逐级解析调用栈，所以其性能会比fp有劣化。</p> <p>注意：fp回栈暂不支持调优非aarch64架构的设备。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">statistics_interval</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">统计间隔，表示将一个统计周期内的栈进行汇总，单位：s。</td> <td class="cellrowborder" valign="top" width="25%">为实现长时间轻量化采集，提供统计模式抓栈。如果更关注调优时的性能，只需要知道每个调用栈出现的次数和总大小，不需要知道每一次具体时间，可以使用统计模式。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">startup_mode</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否抓取进程启动阶段内存。默认不抓取启动阶段内存。</td> <td class="cellrowborder" valign="top" width="25%">记录进程从被appspawn拉起到调优结束这个期间内堆内存分配的信息。如果抓的是一个sa服务，需要在sa对应的cfg文件中找到拉起sa的进程名（如sa_main），将之加到此参数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">js_stack_report</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%"><p>是否开启跨语言回栈。</p> <p>0：不抓取js栈。</p> <p>1：开启抓取js栈。</p> </td> <td class="cellrowborder" valign="top" width="25%">为方舟环境提供跨语言回栈功能。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">malloc_free_matching_interval</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">匹配间隔，单位：s，指在相应时间间隔内，将malloc和free进行匹配。匹配到的就不进行落盘。</td> <td class="cellrowborder" valign="top" width="25%">在匹配间隔内，分配并释放了的调用栈不被记录，减少了抓栈服务进程的开销。此参数设置的值大于0时，就不能将statistics_interval参数设置为true。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">offline_symbolization</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%"><p>是否开启离线符号化。</p> <p>true：使用离线符号化。</p> <p>false：使用在线符号化。</p> </td> <td class="cellrowborder" valign="top" width="25%">使用离线符号化时，根据IP匹配符号的操作在网页端（smartperf）完成，优化了native daemon的性能，减少了调优时的进程卡顿。但离线符号化会将符号表写入trace文件，导致文件大小比在线符号化时更大。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">sample_interval</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">采样大小。</td> <td class="cellrowborder" valign="top" width="25%">设置此参数时开启采样模式。采样模式下对于malloc size小于采样大小进行概率性统计。调用栈分配内存大小越大，出现次数越高，被统计的几率越大。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">restrace_tag</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">需要抓取的GPU图形内存的类型</td> <td class="cellrowborder" valign="top" width="25%"><p>可重复添加。当前仅支持设置为"RES_GPU_VK"、"RES_GPU_GLES_BUFFER"、"RES_GPU_GLES_IMAGE"、"RES_GPU_CL_BUFFER"和"RES_GPU_CL_IMAGE"，用于指定抓取vulkan、OpenGLES、OpenCL、image和buffer类型的GPU内存分配栈。</p> <p><strong>说明</strong>：从API version 21开始，支持该参数。</p> </td> </tr>  </tbody></table></div> </div> <p><strong>结果分析</strong></p> <p>开启fp回栈+跨语言回栈（其中绿色部分为js栈）：</p> <p><span><img originheight="356" originwidth="1305" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115024.38101854209627845003854263469450:50001231000000:2800:3D4958745B250502A50B6E61AC965300EAC0DFC321ACF0FD9DA7D1A6591A1AAE.png" width="920" height="250.97318007662832"></span></p> <p>开启dwarf回栈和跨语言回栈（可以展示出native -&gt; js -&gt;native的栈）：</p> <p><span><img originheight="339" originwidth="1561" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.09112189710858397737057971940174:50001231000000:2800:3C2A521E44D317B91A9720E0892BC5BEEAF11BC252415F5756C9F41A961A7074.png" width="920" height="199.79500320307497"></span></p> <p>开启统计模式，在此模式下，栈数据会周期性展示：</p> <p><span><img originheight="570" originwidth="1671" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.12782601061208738298600592452683:50001231000000:2800:33E376DD7989A22E3C37512CA9D9CFB5FFF340B0C8370CE147DF7B984961D2E2.png" width="920" height="313.8240574506284"></span></p> <p>开启非统计模式，在此模式下，栈数据不会周期性展示：</p> <p><span><img originheight="797" originwidth="1733" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.79626481486116757567960152808325:50001231000000:2800:880D81828B9F21BDC77A8188B350088BB62439DD953AFA59DE75C5D2B10A8A72.png" width="920" height="423.1044431621466"></span></p> </div>  <div class="tiledSection"><h3 id="ftrace-plugin插件">ftrace plugin插件<i class="anchor-icon anchor-icon-link" anchorid="ftrace-plugin插件" tips="复制节点链接"></i></h3><p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.3.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">ftrace_events</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">抓取的trace event。</td> <td class="cellrowborder" valign="top" width="25%">记录内核打点的trace event。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">hitrace_categories</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">抓取的hitrace打点信息。</td> <td class="cellrowborder" valign="top" width="25%">调用hitrace能力，获取数据以proto格式写入文件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">hitrace_apps</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">抓取的hitrace信息的进程。</td> <td class="cellrowborder" valign="top" width="25%">设置此参数时，只有对应进程的trace信息会被记录。添加此参数时， hitrace_categories不支持添加binder，否则会导致trace数据解析异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">buffer_size_kb</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">buffer缓存大小，单位：kB。</td> <td class="cellrowborder" valign="top" width="25%">hiprofiler_plugins进程读取内核事件所需要的缓存大小。推荐使用默认数值：204800。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">flush_interval_ms</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">采集数据频率，单位：ms。</td> <td class="cellrowborder" valign="top" width="25%">推荐使用默认数值：1000。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">flush_threshold_kb</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">刷新数据大小。</td> <td class="cellrowborder" valign="top" width="25%">超过threshold刷新一次数据至文件。用smartperf默认数值即可。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">parse_ksyms</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否获取内核数据。</td> <td class="cellrowborder" valign="top" width="25%">true：获取内核数据；false：不获取内核数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">trace_period_ms</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">读取内核数据的频率。</td> <td class="cellrowborder" valign="top" width="25%">用smartperf默认数值即可。</td> </tr>  </tbody></table></div> </div> <p><strong>结果分析</strong></p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 10 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "ftrace-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>  ftrace_events: "binder/binder_transaction"</li><li>  ftrace_events: "binder/binder_transaction_received"</li><li>  buffer_size_kb: 204800</li><li>  flush_interval_ms: 1000</li><li>  flush_threshold_kb: 4096</li><li>  parse_ksyms: true</li><li>  clock: "boot"</li><li>  trace_period_ms: 200</li><li>  debug_on: false</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令读取的内核binder_transaction和binder_transaction_received数据，这两个字段同时使用，才能完整展示binder两端数据。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace命令将文件导出到当前目录，然后用smartperf将该文件打开并解析。结果示例如下图：</p> <p>点击binder transaction右边的箭头，可以跳转到binder对端的进程或线程。</p> <p><span><img originheight="563" originwidth="588" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.04853775543450436550954778408499:50001231000000:2800:BD9B4389CE233033C85914C6F266FD74AB36C9181971463F7E6DF399B9648224.png" width="588" height="563"></span></p> </div>  <div class="tiledSection"><h3 id="memory-plugin插件">memory plugin插件<i class="anchor-icon anchor-icon-link" anchorid="memory-plugin插件" tips="复制节点链接"></i></h3><p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.10.3.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">report_sysmem_vmem_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否读取虚拟内存数据。</td> <td class="cellrowborder" valign="top" width="25%">从/proc/vmstat节点读取内存数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">report_process_mem_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否获取进程详细内存数据，如rss_shmem，rss_file，vm_swap等。</td> <td class="cellrowborder" valign="top" width="25%">从/proc/${pid}/stat节点读取内存数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">report_smaps_mem_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否获取进程smaps内存信息。</td> <td class="cellrowborder" valign="top" width="25%">从/proc/${pid}/smaps节点获取进程smaps内存数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">report_gpu_mem_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否获取进程GPU使用情况。</td> <td class="cellrowborder" valign="top" width="25%">读取/proc/gpu_memory节点数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">parse_smaps_rollup</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否从smaps_rollup节点读取smaps统计数据。</td> <td class="cellrowborder" valign="top" width="25%">读取/proc/{pid}/smaps_rollup节点的smaps统计数据，相比使用report_smaps_mem_info参数调优服务性能会更好（如CPU，内存使用优化）。</td> </tr>  </tbody></table></div> </div> <p>内存信息包含如下：</p> <ul><li>MemTotal：总内存大小。</li><li>MemFree：空闲内存大小。</li><li>Buffers：文件的缓冲大小。</li><li>Cached：缓存的大小。</li><li>Shmem：已被分配的共享内存大小。</li><li>Slab：内核数据缓存大小。</li><li>SUnreclaim：不可回收的Slab大小。</li><li>SwapTotal：交换空间的总大小。</li><li>SwapFree：未被使用交换空间的大小。</li><li>Mapped：设备和文件等映射的大小。</li><li>VmallocUsed：已被使用的虚拟内存大小。</li><li>PageTables：管理内存分页的索引表大小。</li><li>KernelStack：Kernel消耗的内存。</li><li>Active： 在经常使用中的缓冲或高速缓冲存储器页面文件的大小。</li><li>Inactive：在不经常使用中的缓冲或高速缓冲存储器页面文件的大小。</li><li>Unevictable：不能被释放的内存页。</li><li>VmallocTotal：vmalloc虚拟内存总大小。</li><li>CmaTotal：总的连续可用内存。</li><li>CmaFree：空闲的可用内存。</li><li>Zram：Zram的使用大小。</li><li>ZramTotal：Zram的总大小。</li></ul> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"> <p>Active和Inactive的区别在于内存空间中是否包含最近被使用过的数据。当物理内存不足，需要释放正在使用的内存空间时，会优先释放Inactive的内存空间。</p>  </div></div></div> <p><strong>结果分析</strong></p> <p>通过hiprofiler_cmd 命令获取memory数据。</p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "memory-plugin"</li><li>  sample_interval: 5000</li><li>  config_data {</li><li>  report_process_tree: true</li><li>  report_sysmem_mem_info: true</li><li>  sys_meminfo_counters: PMEM_MEM_TOTAL</li><li>  sys_meminfo_counters: PMEM_MEM_FREE</li><li>  sys_meminfo_counters: PMEM_BUFFERS</li><li>  sys_meminfo_counters: PMEM_CACHED</li><li>  sys_meminfo_counters: PMEM_SHMEM</li><li>  sys_meminfo_counters: PMEM_SLAB</li><li>  sys_meminfo_counters: PMEM_SWAP_TOTAL</li><li>  sys_meminfo_counters: PMEM_SWAP_FREE</li><li>  sys_meminfo_counters: PMEM_MAPPED</li><li>  sys_meminfo_counters: PMEM_VMALLOC_USED</li><li>  sys_meminfo_counters: PMEM_PAGE_TABLES</li><li>  sys_meminfo_counters: PMEM_KERNEL_STACK</li><li>  sys_meminfo_counters: PMEM_ACTIVE</li><li>  sys_meminfo_counters: PMEM_INACTIVE</li><li>  sys_meminfo_counters: PMEM_UNEVICTABLE</li><li>  sys_meminfo_counters: PMEM_VMALLOC_TOTAL</li><li>  sys_meminfo_counters: PMEM_SLAB_UNRECLAIMABLE</li><li>  sys_meminfo_counters: PMEM_CMA_TOTAL</li><li>  sys_meminfo_counters: PMEM_CMA_FREE</li><li>  sys_meminfo_counters: PMEM_KERNEL_RECLAIMABLE</li><li>  sys_meminfo_counters: PMEM_ACTIVE_PURG</li><li>  sys_meminfo_counters: PMEM_INACTIVE_PURG</li><li>  sys_meminfo_counters: PMEM_PINED_PURG</li><li>  report_sysmem_vmem_info: true</li><li>  report_process_mem_info: true</li><li>  report_app_mem_info: false</li><li>  report_app_mem_by_memory_service: false</li><li>  report_purgeable_ashmem_info: true</li><li>  report_dma_mem_info: true</li><li>  report_gpu_mem_info: true</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令读取系统的内存的基本统计信息。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace命令将文件导出到当前目录，然后通过smartperf打开并解析。结果示例如下图：</p> <p><span><img originheight="561" originwidth="1666" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.58388449312817912825898559561300:50001231000000:2800:228B5811BECA3EE601EBA84E3CFE5DDAECC008D0E4AFA581EC204DEE485B3CCC.png" width="920" height="309.7959183673469"></span></p> <p>通过DevEco Studio 的工具获得内存的数据：</p> <p><span><img originheight="817" originwidth="1448" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.56459060048994575143121497217107:50001231000000:2800:C28D0FAB22F2863D788C89944F0448E8A192066F2D3DF003B3176ADF55395FE2.png" width="920" height="519.0883977900553"></span></p> <p>通过DevEco-&gt;profiler-&gt;Allocation工具，选择Memory泳道，可以使用profiler的memory plugin功能。上图展示了框选时间段的进程smaps内存信息。</p> </div>  <div class="tiledSection"><h3 id="xpower-plugin插件">xpower plugin插件<i class="anchor-icon anchor-icon-link" anchorid="xpower-plugin插件" tips="复制节点链接"></i></h3><p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.3.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">bundle_name</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">需要进行能耗调优的进程名。</td> <td class="cellrowborder" valign="top" width="25%">和/proc/节点下的进程名一致。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">message_type</td> <td class="cellrowborder" valign="top" width="25%">XpowerMessageType</td> <td class="cellrowborder" valign="top" width="25%">需要获取能耗数据的类型。</td> <td class="cellrowborder" valign="top" width="25%">数据类型包括：REAL_BATTERY、APP_STATISTIC、APP_DETAIL、COMPONENT_TOP、ABNORMAL_EVENTS和THERMAL_REPORT。</td> </tr>  </tbody></table></div> </div> <p><strong>结果分析</strong></p> <p><span><img originheight="335" originwidth="1587" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.93212008678487161452276322142852:50001231000000:2800:8DFFBAD89387D7F9A4F9139BAF5D53F78A21E0CC05A127003BD83D22F6C312BE.png" width="920" height="194.20289855072465"></span></p> <p>通过DevEco-&gt;profiler-&gt;real time monitor工具，可以获取相关进程能耗数据。</p> </div>  <div class="tiledSection"><h3 id="gpu-plugin插件">GPU plugin插件<i class="anchor-icon anchor-icon-link" anchorid="gpu-plugin插件" tips="复制节点链接"></i></h3><p>获取GPU使用率相关信息的数据。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.12.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.12.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">pid</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">需要进行调优的进程ID，与/proc/节点下的进程ID一致。</td> <td class="cellrowborder" valign="top" width="25%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">report_gpu_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否展示指定进程的GPU使用率信息。</td> <td class="cellrowborder" valign="top" width="25%">true: 展示指定进程的GPU数据，需要设置pid。false: 不展示指定进程的GPU数据。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="cpu-plugin插件">CPU plugin插件<i class="anchor-icon anchor-icon-link" anchorid="cpu-plugin插件" tips="复制节点链接"></i></h3><p>获取CPU使用率的相关信息。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.13.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">pid</td> <td class="cellrowborder" valign="top" width="25%">int</td> <td class="cellrowborder" valign="top" width="25%">需要进行调优的进程ID。</td> <td class="cellrowborder" valign="top" width="25%">和/proc/节点下的进程ID一致。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">report_process_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否展示指定进程的CPU使用率信息。</td> <td class="cellrowborder" valign="top" width="25%"><p>true：展示指定进程的数据，需要设置pid参数；</p> <p>false：不展示指定进程的数据，仅展示系统级CPU使用率数据。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">skip_thread_cpu_info</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否跳过线程CPU使用率数据。</td> <td class="cellrowborder" valign="top" width="25%"><p>true：不展示每个线程CPU使用率的信息，开启此参数时可以降低调优服务的开销；</p> <p>false：展示每个线程CPU使用率的信息。</p> </td> </tr>  </tbody></table></div> </div> <p>CPU 基本信息包含如下：</p> <ul><li>Start Time：采集时间的时间戳。</li><li>Duration：前一次采集到本次采集的时间差。</li><li>TotalLoad%：总的CPU使用率。</li><li>UserLoad%：CPU在用户态空间运行的使用率。</li><li>SystemLoad%：CPU在内核空间运行的使用率。</li><li>Process：进程号。</li></ul> <p><strong>结果分析</strong></p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "cpu-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>  report_process_info: true</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令读取cpu的基本统计信息。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace命令将文件导出到当前目录，然后通过smartperf打开并解析。结果示例如下图：</p> <p><span><img originheight="582" originwidth="1670" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.65121022009799641612662346954095:50001231000000:2800:B992169CB2CAE95AE0780A9B765B28070F576CC149E0D1C1004DA8B592C4B4CE.png" width="920" height="320.622754491018"></span></p> </div>  <div class="tiledSection"><h3 id="diskio-plugin插件">diskio plugin插件<i class="anchor-icon anchor-icon-link" anchorid="diskio-plugin插件" tips="复制节点链接"></i></h3><p>获取整机磁盘I/O使用率的相关信息。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.14.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.14.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">report_io_stats</td> <td class="cellrowborder" valign="top" width="25%">IoReportType</td> <td class="cellrowborder" valign="top" width="25%">磁盘I/O统计类型。</td> <td class="cellrowborder" valign="top" width="25%">该类型为枚举类型，目前支持：IO_REPORT。</td> </tr>  </tbody></table></div> </div> <p>当设置成IO_REPORT时，会获得如下磁盘IO信息：</p> <ul><li>Data Read：从磁盘读取到内存的总字节数。</li><li>Data Read/sec：每秒从磁盘读取到内存的字节数。</li><li>Data Write：从内存写入磁盘的总字节数。</li><li>Data Write/sec：每秒从内存写入磁盘的字节数。</li><li>Reads In：读入的字节数。</li><li>Reads In/sec：每秒读取的字节数。</li><li>Write Out：写入的字节数。</li><li>Write Out/sec：每秒写入的字节数。</li></ul> <p><strong>结果分析</strong></p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "diskio-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>  report_io_stats: IO_REPORT</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令读取disk io的基本统计信息。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace将文件导出到当前目录，然后通过smartperf打开并解析。结果示例如下图：</p> <p><span><img originheight="765" originwidth="1621" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.36999313825713858210897072114317:50001231000000:2800:417E15A260730F3039E2042704B7D7E14FE03638FA76363F2BBC26E335E84D3C.png" width="920" height="434.1764342998149"></span></p> </div>  <div class="tiledSection"><h3 id="hidump-plugin插件">hidump plugin插件<i class="anchor-icon anchor-icon-link" anchorid="hidump-plugin插件" tips="复制节点链接"></i></h3><p>获取应用进程的fps帧率的数据。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.15.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.15.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.15.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.15.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">report_fps</td> <td class="cellrowborder" valign="top" width="25%">bool</td> <td class="cellrowborder" valign="top" width="25%">是否报告帧率数据。</td> <td class="cellrowborder" valign="top" width="25%"><p>true：报告应用进程的帧率数据；</p> <p>false：不报告帧率数据。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">sections</td> <td class="cellrowborder" valign="top" width="25%">uint32</td> <td class="cellrowborder" valign="top" width="25%">每1秒上报多少次帧率数据。</td> <td class="cellrowborder" valign="top" width="25%">默认值为10，即每隔100毫秒上报一次帧率数据。</td> </tr>  </tbody></table></div> </div> <p><strong>结果分析</strong></p> <p>该插件暂时不支持smartperf工具方式的trace数据解析，只支持DevEco Studio模式下的trace数据解析。如下图所示：</p> <p><span><img originheight="591" originwidth="1865" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.36348496687207426252152489475408:50001231000000:2800:502674CC279D7DD4CDFF34750363CC7CE1200C890202440E9E6C091B8179E0E4.png" width="920" height="291.5388739946381"></span></p> </div>  <div class="tiledSection"><h3 id="hisysevent-plugin插件">hisysevent plugin插件<i class="anchor-icon anchor-icon-link" anchorid="hisysevent-plugin插件" tips="复制节点链接"></i></h3><p>获取系统事件记录的数据。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.1" valign="top" width="25%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.2" valign="top" width="25%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.3" valign="top" width="25%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.16.4.1.5.1.4" valign="top" width="25%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%">msg</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">自定义的字符串。</td> <td class="cellrowborder" valign="top" width="25%">该字符串作为保留字段，并未实际使用。使用时可传入空字符串</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">subscribe_domain</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">订阅的domain。</td> <td class="cellrowborder" valign="top" width="25%">该字段用来订阅具体的domain下的所有事件。如果为空串，则订阅所有domain下的所有事件。</td> </tr> <tr><td class="cellrowborder" valign="top" width="25%">subscribe_event</td> <td class="cellrowborder" valign="top" width="25%">string</td> <td class="cellrowborder" valign="top" width="25%">订阅的event。</td> <td class="cellrowborder" valign="top" width="25%">该字段用来订阅具体的event。如果为空串，则订阅所有event。</td> </tr>  </tbody></table></div> </div> <p><strong>结果分析</strong></p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "hisysevent-plugin"</li><li>  config_data {</li><li>  msg: "hisysevent-plugin"</li><li>  subscribe_domain: ""</li><li>  subscribe_event: ""</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令示例抓取所有hisystem event订阅事件信息。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace将文件导出到当前目录，然后通过smartperf打开并解析。结果示例如下图：</p> <p><span><img originheight="693" originwidth="1618" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.74734812480610840962576187762525:50001231000000:2800:CB24008F0A8398B2A01C0575C6AF337F6CE813C9D4CF7B0800DBF26B47D063D8.png" width="920" height="394.04202719406675"></span></p> </div>  <div class="tiledSection"><h3 id="network-plugin插件">network plugin插件<i class="anchor-icon anchor-icon-link" anchorid="network-plugin插件" tips="复制节点链接"></i></h3><p>获取网络上行下载相关的数据。</p> <p><strong>参数介绍</strong></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.17.4.1.6.1.1" valign="top" width="20%">参数名字</th> <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.6.1.2" valign="top" width="20%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.6.1.3" valign="top" width="20%">参数含义</th> <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.6.1.4" valign="top" width="20%">必选</th> <th align="left" class="cellrowborder" id="mcps1.3.17.4.1.6.1.5" valign="top" width="20%">详细介绍</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20%">pid</td> <td class="cellrowborder" valign="top" width="20%">int32</td> <td class="cellrowborder" valign="top" width="20%">进程ID。</td> <td class="cellrowborder" valign="top" width="20%">否</td> <td class="cellrowborder" valign="top" width="20%">获取指定进程的网络数据。可以传入多个参数。参数缺省时，则抓取整机的网络数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="20%">startup_process_name</td> <td class="cellrowborder" valign="top" width="20%">string</td> <td class="cellrowborder" valign="top" width="20%">启动的进程名。</td> <td class="cellrowborder" valign="top" width="20%">否</td> <td class="cellrowborder" valign="top" width="20%">如果需要抓取指定进程启动的网络数据，则需要指定此参数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="20%">restart_process_name</td> <td class="cellrowborder" valign="top" width="20%">string</td> <td class="cellrowborder" valign="top" width="20%">重启的进程名。</td> <td class="cellrowborder" valign="top" width="20%">否</td> <td class="cellrowborder" valign="top" width="20%">如果需要抓取指定进程重启的网络数据，则需要指定此参数。</td> </tr>  </tbody></table></div> </div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"> <p>startup_process_name和restart_process_name不能同时为空。</p>  </div></div></div> <p>网络信息数据包含如下：</p> <ul><li>StartTime：采集时间的时间戳。</li><li>Duration：前一次采集到本次采集的时间差。</li><li>Data Received：接收的网络数据总字节数。</li><li>Data Received/sec：每秒接收的网络数据字节数。</li><li>Data Send：发送的网络数据总字节数。</li><li>Data Send/sec：每秒发送的网络数据字节数。</li><li>Packets In：接收的网络总数据包数。</li><li>Packets In/sec：每秒接收的网络数据包数。</li><li>Packets Out：发送的网络总数据包数。</li><li>Packets Out/sec：每秒发送的网络数据包数。</li></ul> <p><strong>结果分析</strong></p> <p>示例命令：</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "network-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>此命令示例抓取整机网络数据信息。执行命令后，通过hdc file recv /data/local/tmp/hiprofiler_data.htrace将文件导出到当前模板，然后通过smartperf打开并解析。结果示例如下图：</p> <p><span><img originheight="724" originwidth="1623" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115025.91561261909159244440701176700167:50001231000000:2800:8D8CD15EE0DECBB2F49161C8C0C01BE1BBD3071DC09C43A8400B0A1ECF790072.png" width="920" height="410.40049291435616"></span></p> </div>  <div class="tiledSection"><h2 id="常用命令">常用命令<i class="anchor-icon anchor-icon-link" anchorid="常用命令" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="堆内存分配调用栈数据采样记录" class="firsth2">堆内存分配调用栈数据采样记录<i class="anchor-icon anchor-icon-link" anchorid="堆内存分配调用栈数据采样记录" tips="复制节点链接"></i></h3><p>对com.example.insight_test_stage进程的堆内存分配操作进行抓栈，并开启fp回栈、离线符号化和统计模式。</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "nativehook"</li><li>  sample_interval: 5000</li><li>  config_data {</li><li>  save_file: false</li><li>  smb_pages: 16384</li><li>  max_stack_depth: 20</li><li>  process_name: "com.example.insight_test_stage"</li><li>  string_compressed: true</li><li>  fp_unwind: true</li><li>  blocked: true</li><li>  callframe_compress: true</li><li>  record_accurately: true</li><li>  offline_symbolization: true</li><li>  startup_mode: false</li><li>  statistics_interval: 10</li><li>  sample_interval: 256</li><li>  js_stack_report: 1</li><li>  max_js_stack_depth: 10</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>采集的数据会被保存至/data/local/tmp/hiprofiler_data.htrace文件中，该文件包含了内存泄漏分析所需的函数调用信息、线程和动态库维度内存分配情况，以及调用栈次数和分配大小聚类信息。开启离线符号化，fp回栈，统计模式均可以提升调优服务处理数据速率。</p> <p>抓取指定进程CPU使用率。</p> <p>对进程号为1234的进程采集CPU数据，采集时长为30s，采样周期为1000ms，调优数据传输的共享内存大小是16384个内存页，采集的数据会被保存至/data/local/tmp/hiprofiler_data.htrace文件中。</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -o /data/local/tmp/hiprofiler_data.htrace \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li> request_id: 1</li><li> session_config {</li><li>  buffers {</li><li>   pages: 16384</li><li>  }</li><li> }</li><li> plugin_configs {</li><li>  plugin_name: "cpu-plugin"</li><li>  sample_interval: 1000</li><li>  config_data {</li><li>   pid: 1234</li><li>   report_process_info: true</li><li>  }</li><li> }</li><li>CONFIG</li></ol></pre></div></div> <p>抓取指定进程的GPU图形内存调用栈（需要使用最新smartperf release版本解析文件，下载链接：<a href="https://gitcode.com/openharmony/developtools_smartperf_host/releases" target="_blank">smartperf</a>)。</p> <div _ngcontent-owc-c106="" class="highlight-div"><div _ngcontent-owc-c106="" class="highlight-div-header"><div _ngcontent-owc-c106="" class="highlight-div-header-left"><div _ngcontent-owc-c106="" class="handle-button expand-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owc-c106="" class="highlight-div-header-right"><div _ngcontent-owc-c106="" class="handle-button ai-button"></div><div _ngcontent-owc-c106="" class="handle-button line-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owc-c106="" class="handle-button theme-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owc-c106="" class="handle-button copy-button"><div _ngcontent-owc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owc-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hiprofiler_cmd \</span></li><li><span class="language-bash">  -c - \</span></li><li><span class="language-bash">  -t 30 \</span></li><li><span class="language-bash">  -s \</span></li><li><span class="language-bash">  -k \</span></li><li><span class="language-bash">&lt;&lt;<span class="hljs-string">CONFIG</span></span></li><li>request_id: 1</li><li>session_config {</li><li>  buffers {</li><li>  pages: 16384</li><li>  }</li><li>}</li><li>plugin_configs {</li><li>  plugin_name: "nativehook"</li><li>  sample_interval: 5000</li><li>  config_data {</li><li>  save_file: false</li><li>  smb_pages: 16384</li><li>  max_stack_depth: 20</li><li>  pid: 11237</li><li>  string_compressed: true</li><li>  fp_unwind: true</li><li>  blocked: true</li><li>  callframe_compress: true</li><li>  record_accurately: true</li><li>  offline_symbolization: true</li><li>  startup_mode: false</li><li>  statistics_interval: 10</li><li>  malloc_disable: true</li><li>  memtrace_enable: true</li><li>  restrace_tag: "RES_GPU_VK"</li><li>  restrace_tag: "RES_GPU_GLES_BUFFER"</li><li>  restrace_tag: "RES_GPU_GLES_IMAGE"</li><li>  restrace_tag: "RES_GPU_CL_BUFFER"</li><li>  js_stack_report: 1</li><li>  max_js_stack_depth: 10</li><li>  }</li><li>}</li><li>CONFIG</li></ol></pre></div></div> <p>命令中使用了malloc_disable参数用于过滤nativeheap抓栈的数据；添加的restrace_tag参数中没有"RES_GPU_CL_IMAGE", 则不抓取OpenCL image类型的GPU内存分配栈。</p> </div>  <div class="tiledSection"><h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="调优出现异常" class="firsth2">调优出现异常<i class="anchor-icon anchor-icon-link" anchorid="调优出现异常" tips="复制节点链接"></i></h3><p><strong>现象描述</strong></p> <p>使用hiprofiler_cmd命令时，显示Service not started。</p> <p><span><img originheight="216" originwidth="680" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115026.09217557808425817017596046158110:50001231000000:2800:0D6F78A6521726F6B30D17642B37BE9689615D3C6C39B3FF6E0FDF365304BD9F.png" width="680" height="216"></span></p> <p><strong>可能原因&amp;解决方法</strong></p> <p>调优服务未能开启，说明正在使用DevEco Studio调优或者上次调优异常退出，需要执行hiprofiler_cmd -k之后再重新执行调优命令。</p> </div>  <div class="tiledSection"><h3 id="抓取到的trace文件为空">抓取到的trace文件为空<i class="anchor-icon anchor-icon-link" anchorid="抓取到的trace文件为空" tips="复制节点链接"></i></h3><p><strong>现象描述</strong></p> <p>抓取到的trace文件是空的</p> <p><strong>可能原因&amp;解决方法</strong></p> <p>需要检查生成文件的路径是否在/data/local/tmp/目录下。如果目标路径是/data/local/tmp下的一个文件夹，则尝试对文件夹执行chmod 777操作。如果是user版本使用nativehook或者network profiler插件抓取的应用不是<a href="/consumer/cn/doc/harmonyos-guides/hiprofiler#使用调试证书签名的应用">使用调试证书签名的应用</a>，也抓不到数据。</p> </div>  <div class="tiledSection"><h3 id="调优数据疑似不准确">调优数据疑似不准确<i class="anchor-icon anchor-icon-link" anchorid="调优数据疑似不准确" tips="复制节点链接"></i></h3><p><strong>现象描述</strong></p> <p>hiprofiler抓取到的native heap和hidumper查看的native heap有差异。</p> <p><strong>可能原因&amp;解决方法</strong></p> <p>hidumper抓取的是进程维度内存使用情况，hiprofiler抓取到的是进程用户态通过基础库函数（malloc，mmap，realloc等，operator new也是调用的malloc）分配堆内存的数据。两者之间会有差异，差异存在于线程的内存缓存，堆内存延迟释放，加载器使用内存等。</p> </div>  <div class="tiledSection"><h3 id="调优时目标进程卡顿">调优时目标进程卡顿<i class="anchor-icon anchor-icon-link" anchorid="调优时目标进程卡顿" tips="复制节点链接"></i></h3><p><strong>现象描述</strong></p> <p>使用hiprofiler_cmd命令抓取应用进程的内存trace，采用FP回栈或者dwarf回栈时，出现应用进程卡顿。</p> <p><strong>可能原因&amp;解决方法</strong></p> <p>可以通过hiprofiler_cmd命令中config参数配置来进行调整。</p> <p>hiprofiler_cmd命令中config参数的调整方法如下：</p> <ul><li>适当减小max_stack_depth和max_js_stack_depth参数的值，减少回栈深度，减少调用栈信息的采集。</li><li>适当增大smb_pages参数的值，增大调优数据传输的共享内存大小。默认值为16384个页大小，即：16384*4096=67108864字节（64M）。可以调整到128M。</li><li>适当增加sample_interval参数的值，增大采样线程栈的大小。默认值为256，可以调整到512。</li></ul> </div> </div> <div></div></div>