<h1 _ngcontent-qnm-c119="" class="doc-title ng-star-inserted" title="printf"> printf </h1>

<div _ngcontent-qnm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section29605mcpsimp">函数功能<i class="anchor-icon anchor-icon-link" anchorid="section29605mcpsimp" tips="复制节点链接"></i></h2><p>基于算子工程开发的算子，可以使用该接口实现CPU侧/NPU侧调试场景下的格式化输出功能。</p> <p>在算子kernel侧实现代码中需要输出日志信息的地方调用printf接口打印相关内容。样例如下。</p> <div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel_operator.h"</span> </span></li><li>AscendC::<span class="hljs-built_in">printf</span>(<span class="hljs-string">"fmt string %d\n"</span>, <span class="hljs-number">0x123</span>); </li><li>AscendC::<span class="hljs-built_in">PRINTF</span>(<span class="hljs-string">"fmt string %d\n"</span>, <span class="hljs-number">0x123</span>);</li></ol></pre></div></div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>printf(PRINTF)接口打印功能会对算子实际运行的性能带来一定影响，通常在调测阶段使用。开发者可以按需通过如下方式关闭打印功能。</p> <p>自定义算子工程：</p> <p>修改算子工程op_kernel目录下的CMakeLists.txt文件，首行增加编译选项-DASCENDC_DUMP=0，关闭ASCENDC_DUMP开关，示例如下。</p> <div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 关闭所有算子的printf打印功能 </span></li><li><span class="hljs-built_in">add_ops_compile_options</span>(ALL OPTIONS -DASCENDC_DUMP=<span class="hljs-number">0</span>)</li></ol></pre></div></div> </div></div></div> <p><strong>需要注意的是，关闭CPU侧的打印开关时，只对PRINTF接口生效，对printf不生效。</strong></p> <p>printf打印结果示例如下。</p> <div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">fmt</span> string 291 </li><li><span class="hljs-built_in">fmt</span> string 291</li></ol></pre></div></div> <p>根据算子执行方式的不同，printf的打印结果输出方式不同。动态图或者单算子直调场景下，待输出内容会被解析并打印在屏幕上。静态图场景下，整图算子需要全下沉到NPU侧执行，无法直接调用接口打印出单个算子的信息，因此需要在模型执行完毕后，将待输出内容落盘在dump文件中，dump文件需要通过工具解析为可读内容。</p> </div> <div class="tiledSection"><h2 id="section29653mcpsimp">函数原型<i class="anchor-icon anchor-icon-link" anchorid="section29653mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">printf</span><span class="hljs-params">(__gm__ <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fmt, Args&amp;&amp;... args)</span> </span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PRINTF</span><span class="hljs-params">(__gm__ <span class="hljs-type">const</span> <span class="hljs-type">char</span>* fmt, Args&amp;&amp;... args)</span></span></li></ol></pre></div></div> </div> <div class="tiledSection"><h2 id="section29656mcpsimp">参数说明<i class="anchor-icon anchor-icon-link" anchorid="section29656mcpsimp" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="16%"><p>参数名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="12%"><p>输入/输出</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="72%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="16%"><p>fmt</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>格式控制字符串，包含两种类型的对象：普通字符和转换说明。</p> <ul><li>普通字符将原样不动地打印输出。</li><li>转换说明并不直接输出而是用于控制printf中参数的转换和打印。每个转换说明都由一个百分号字符（%）开始，以转换说明结束，从而说明输出数据的类型 。<p>支持的转换类型包括：</p> <ul><li>%d / %i：输出十进制数，支持打印的数据类型：bool/int8_t/int16_t/int32_t/int64_t</li><li>%f：输出实数，支持打印的数据类型：float/half/bfloat16_t</li><li>%x：输出十六进制整数，支持打印的数据类型：int8_t/int16_t/int32_t/int64_t/uint8_t/uint16_t/uint32_t/uint64_t</li><li>%s：输出字符串</li><li>%u：输出unsigned类型数据，支持打印的数据类型：bool/uint8_t/uint16_t/uint32_t/uint64_t</li><li>%p：输出指针地址</li></ul> </li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="16%"><p>args</p> </td> <td class="cellrowborder" valign="top" width="12%"><p>输入</p> </td> <td class="cellrowborder" valign="top" width="72%"><p>附加参数，个数和类型可变的输出列表：根据不同的fmt字符串，函数可能需要一系列的附加参数，每个参数包含了一个要被插入的值，替换了fmt参数中指定的每个%标签。参数的个数应与%标签的个数相同。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section29697mcpsimp">返回值<i class="anchor-icon anchor-icon-link" anchorid="section29697mcpsimp" tips="复制节点链接"></i></h2><p>无</p> </div> <div class="tiledSection"><h2 id="section29700mcpsimp">支持的型号<i class="anchor-icon anchor-icon-link" anchorid="section29700mcpsimp" tips="复制节点链接"></i></h2><p>Kirin9020系列处理器</p> <p>KirinX90系列处理器</p> </div> <div class="tiledSection"><h2 id="section29705mcpsimp">注意事项<i class="anchor-icon anchor-icon-link" anchorid="section29705mcpsimp" tips="复制节点链接"></i></h2><ul><li>本接口不支持打印除换行符之外的其他转义字符。</li><li>如果开发者需要包含标准库头文件stdio.h和cstdio，请在kernel_operator.h头文件之前包含，避免printf符号冲突。</li><li>程序中调用printf/PRINTF接口使用的空间+调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumptensor">DumpTensor</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-dumpaccch">DumpAccChkPoint</a>接口使用的空间+<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-commissioning-interfaces-assert">assert</a>接口使用的空间+框架dump功能所使用的空间，每个核上不可超过1M。请开发者自行控制待打印的内容数据量，超出则不会打印。</li></ul> </div> <div class="tiledSection"><h2 id="section29717mcpsimp">调用示例<i class="anchor-icon anchor-icon-link" anchorid="section29717mcpsimp" tips="复制节点链接"></i></h2><div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"kernel_operator.h"</span> </span></li><li> </li><li><span class="hljs-comment">// 整型打印： </span></li><li>AscendC::<span class="hljs-built_in">printf</span>(<span class="hljs-string">"fmt string %d\n"</span>, <span class="hljs-number">0x123</span>); </li><li>AscendC::<span class="hljs-built_in">PRINTF</span>(<span class="hljs-string">"fmt string %d\n"</span>, <span class="hljs-number">0x123</span>); </li><li> </li><li><span class="hljs-comment">// 浮点型打印： </span></li><li><span class="hljs-type">float</span> a = <span class="hljs-number">3.14</span>; </li><li>AscendC::<span class="hljs-built_in">printf</span>(<span class="hljs-string">"fmt string %f\n"</span>, a); </li><li>AscendC::<span class="hljs-built_in">PRINTF</span>(<span class="hljs-string">"fmt string %f\n"</span>, a); </li><li> </li><li><span class="hljs-comment">// 指针打印： </span></li><li><span class="hljs-type">int</span> *a; </li><li>AscendC::<span class="hljs-built_in">printf</span>(<span class="hljs-string">"TEST %p\n"</span>, a); </li><li>AscendC::<span class="hljs-built_in">PRINTF</span>(<span class="hljs-string">"TEST %p\n"</span>, a);</li></ol></pre></div></div> <p>程序运行时打印效果如下。</p> <div _ngcontent-qnm-c106="" class="highlight-div"><div _ngcontent-qnm-c106="" class="highlight-div-header"><div _ngcontent-qnm-c106="" class="highlight-div-header-left"><div _ngcontent-qnm-c106="" class="handle-button expand-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnm-c106="" class="highlight-div-header-right"><div _ngcontent-qnm-c106="" class="handle-button ai-button"></div><div _ngcontent-qnm-c106="" class="handle-button line-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnm-c106="" class="handle-button theme-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnm-c106="" class="handle-button copy-button"><div _ngcontent-qnm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnm-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">fmt</span> string 291 </li><li><span class="hljs-built_in">fmt</span> string 291 </li><li>TEST 0x12c08001a000 </li><li>TEST 0x12c08001a000</li></ol></pre></div></div> </div> </div> <div></div></div>