<h1 _ngcontent-cho-c119="" class="doc-title ng-star-inserted" title="三方库源码调试"> 三方库源码调试 </h1>

<div _ngcontent-cho-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div id="body0000001771296574">    <p id="ZH-CN_TOPIC_0000002510174335__p1249854141211">三方共享包分为静态共享包HAR和动态共享包HSP，两种共享包的源码调试方式有所区别，具体请查看以下指导。</p>    <div class="tiledSection">     <h2 id="section116814441806">区分字节码HAR和源码HAR<i class="anchor-icon anchor-icon-link" anchorid="section116814441806" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174335__p204044336530">HAR包分为字节码HAR和源码HAR，同时满足以下两个条件的是字节码HAR，否则是源码HAR，更多关于如何构建源码HAR和字节码HAR的指导请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-har">构建HAR</a>。</p>     <ol id="ZH-CN_TOPIC_0000002510174335__ol18861536484">      <li id="li387153615820">查看HAR包的ets目录下存在.abc文件。</li>      <li id="li198716366815">查看HAR包的oh-package.json5文件，存在byteCodeHar字段并且值为true。       <p id="ZH-CN_TOPIC_0000002510174335__p57602021093"><span><img originheight="357" originwidth="305" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.54450452487858215213694311660517:50001231000000:2800:7657ED1DD30F768C250C8E7C44F06E831A2BC8C56215D86C92C453C46423F59C.png" width="305" height="357"></span></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section14425489164">字节码HAR调试<i class="anchor-icon anchor-icon-link" anchorid="section14425489164" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section177418333199" class="firsth2">C++代码调试<i class="anchor-icon anchor-icon-link" anchorid="section177418333199" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002510174335__p13625113542511">如果HAP/HSP引用字节码HAR包，同时HAR包中包含C++代码，参考以下步骤对该HAR包进行调试。</p>     <ol id="ZH-CN_TOPIC_0000002510174335__ol1477553311918">      <li id="li10726192613518">点击<strong>Run &gt; Edit Configurations &gt; Debugger</strong><strong> &gt; </strong><strong>Symbol Directories</strong>页签，点击<strong>+</strong>，添加带调试信息的so文件，so文件在{ProjectPath}/{ModuleName}/build/{product}/intermediates/libs/default/arm64-v8a路径下。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002510174335__p11786113384013">在工程级或模块级build-profile.json5中添加strip字段并设置为false，可以生成带调试信息的so文件，具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-cpp#section2182144382320">配置CPP</a>。</p>        </div></div></div>       <p id="ZH-CN_TOPIC_0000002510174335__p104601298402"><span><img originheight="204" originwidth="521" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.03083029654095865102730155289151:50001231000000:2800:1233CCD3541977D05F43D9972EAF5B5B4C0D011D5C2BD95D9598028479DD6684.png" width="521" height="204"></span></p></li>      <li id="li132117454508">DevEco Studio调试应用时会优先加载配置的so文件，本地so文件包含调试信息时，可以正常调试源码。由于so的源码文件信息为编译时的文件路径，若与本地的源码文件路径不一致时，需要关联源码文件，有两种方式：       <ul id="ZH-CN_TOPIC_0000002510174335__ul1727545545020">        <li id="li1627515511509">方式一：可以在<strong>LLDB Startup Commands</strong>页签中添加命令做映射，示例如下。         <div _ngcontent-cho-c106="" class="highlight-div"><div _ngcontent-cho-c106="" class="highlight-div-header"><div _ngcontent-cho-c106="" class="highlight-div-header-left"><div _ngcontent-cho-c106="" class="handle-button expand-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cho-c106="" class="highlight-div-header-right"><div _ngcontent-cho-c106="" class="handle-button ai-button"></div><div _ngcontent-cho-c106="" class="handle-button line-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cho-c106="" class="handle-button theme-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cho-c106="" class="handle-button copy-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cho-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" id="ZH-CN_TOPIC_0000002510174335__screen1775933181912" data-highlighted="yes"><ol class="linenums"><li>settings set -- target.source-map {old-path} {<span class="hljs-keyword">new</span>-path}</li></ol></pre></div></div>         <ul id="ZH-CN_TOPIC_0000002510174335__ul1877563391913">          <li id="li1777517335198">old-path：编译时的文件路径。</li>          <li id="li12775633141914">new-path：本地的源码文件路径。</li>         </ul>         <p id="ZH-CN_TOPIC_0000002510174335__p1477533351914"><span><img originheight="253" originwidth="660" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.62614896630675408635431078239917:50001231000000:2800:E6FAF864C5F73EF3CB3539F61954062DABE0BF875EAB1AF1C75265F9D349D04C.png" width="660" height="253"></span></p></li>        <li id="li1646271575110">方式二：当Step Into进入汇编代码后，会弹出源码关联的提示，请点击<strong>Select file</strong>，选择本地对应C++源码进行关联。         <p id="ZH-CN_TOPIC_0000002510174335__p1845015212525"><span><img originheight="591" originwidth="1080" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.87699558767435425761942502189856:50001231000000:2800:B8BCBC76DE5581FB75D21F4C1CEB2412BD11560EB449AB6D7CE9319435E5FE70.png" width="920" height="503.44444444444446"></span></p></li>       </ul></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1035165781918">ArkTS代码调试<i class="anchor-icon anchor-icon-link" anchorid="section1035165781918" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002510174335__p5357571190">假如在工程A（HAR包工程）中以debug模式编译得到字节码HAR包，工程B（主工程）中引用该字节码HAR包，并且本地有HAR包的源码，要调试该字节码HAR，有两种方式：在主工程中调试或在HAR包工程中调试。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p id="ZH-CN_TOPIC_0000002510174335__p12269111616251">release模式编译的字节码HAR不支持调试。</p>      </div></div></div>     <ul id="ZH-CN_TOPIC_0000002510174335__ul1335185718195">      <li id="li17359570194"><strong>方式一：在主工程中调试。</strong>       <ol id="ZH-CN_TOPIC_0000002510174335__ol103535721913">        <li id="li141001635914">在主工程中导入字节码HAR对应的模块，确保模块的层级目录与HAR包工程的保持一致，例如HAR模块都在工程根目录下。         <p id="ZH-CN_TOPIC_0000002510174335__p173515578194"><span><img originheight="380" originwidth="668" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.06963231500646158890526727140814:50001231000000:2800:2CDC8C2CDCB66B7D53D0CDA4B1C61FD0E2561EAF927BF1E2B0B6B845BE9A72A1.png" width="668" height="380"></span></p></li>        <li id="li9351457201919">导入成功后，由于debug模式编译的字节码HAR中包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-exception-stack-parsing-principle">sourceMap</a>，调试时默认会关联当前工程的源码，此时可以在HAR模块上直接添加断点。</li>       </ol></li>      <li id="li153575771920"><strong>方式二：在HAR包工程中调试，</strong><strong>通过修改前缀配置进行attach调试。</strong>       <ol id="ZH-CN_TOPIC_0000002510174335__ol211318461208">        <li id="li91111946102014">在HAR包工程新建一个entry类型的demo主模块，如果主模块已存在则跳过本步骤。</li>        <li id="li101121246122015">在demo主模块的oh-package.json5中配置对字节码HAR包的依赖。         <div _ngcontent-cho-c106="" class="highlight-div"><div _ngcontent-cho-c106="" class="highlight-div-header"><div _ngcontent-cho-c106="" class="highlight-div-header-left"><div _ngcontent-cho-c106="" class="handle-button expand-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cho-c106="" class="highlight-div-header-right"><div _ngcontent-cho-c106="" class="handle-button ai-button"></div><div _ngcontent-cho-c106="" class="handle-button line-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cho-c106="" class="handle-button theme-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cho-c106="" class="handle-button copy-button"><div _ngcontent-cho-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cho-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" id="ZH-CN_TOPIC_0000002510174335__screen1174755810818" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// demo主模块的oh-package.json5</span></li><li><span class=""><span class="hljs-string">"dependencies"</span></span>: {</li><li>  <span class=""><span class="hljs-string">"@ohos/test_stage_ets_library"</span></span>: <span class=""><span class="hljs-string">"file:./lib/test_stage_ets_library.har"</span></span>,</li><li>}</li></ol></pre></div></div>         <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">           <p id="ZH-CN_TOPIC_0000002510174335__p6289403159">如果在demo主模块的oh-package.json5中，配置对字节码HAR模块的依赖，如file:../test_stage_ets_library，调试时可能导致断点无效。</p>          </div></div></div></li>        <li id="li61125469205">在HAR包工程主模块中调用HAR模块的接口，确保编译后主模块的sourceMap文件中包含HAR模块的相关信息。</li>        <li id="li311254610203">构建HAR包工程，打开主模块的sourceMap，根据HAR的oh-package.json5中的name进行查找，将Index文件的前缀路径记录为localUrl，例如以下的demo|test_stage_ets_library|1.0.0。         <p id="ZH-CN_TOPIC_0000002510174335__p171125462202"><span><img originheight="561" originwidth="994" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.97981725998624383334222554581053:50001231000000:2800:605B220CD8AC081075AD69DA8C2E8F44895D28E40BE91EE5839DCFB09AAF54A9.png" width="920" height="519.2354124748491"></span></p></li>        <li id="li111217467203">主工程应用在设备上运行起来后，在HAR包工程中通过attach方式对该应用进行调试，在Debug窗口获取程序加载时的前缀，记录为remoteUrl，例如以下的entry|@ohos/test_stage_ets_library|1.0.0。         <p id="ZH-CN_TOPIC_0000002510174335__p1011294662018"><span><img originheight="162" originwidth="957" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104839.29913667815724120373574282979818:50001231000000:2800:DA51486EA88979EB58E350C23FB82292A69BD3CE95F95204473C372526C07F15.png" width="920" height="155.73667711598745"></span></p></li>        <li id="li4112174682013">点击<strong>Run &gt; Edit Configurations &gt; Debugger</strong><strong> &gt; Ets Source Pairs</strong>，点击<strong>+</strong>，填写前两个步骤获取到的<strong>remoteUrl</strong>和<strong>localUrl</strong>。         <ul id="ZH-CN_TOPIC_0000002510174335__ul41124461206">          <li id="li16112184618206">remoteUrl：应用程序加载HAR包的前缀路径。</li>          <li id="li91121462202">localUrl：本地生成sourceMap中HAR的前缀路径。</li>         </ul>         <p id="ZH-CN_TOPIC_0000002510174335__p153515202282"><span><img originheight="210" originwidth="650" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104840.35554091357201870728422006121699:50001231000000:2800:8455FAAF46A850133B598A53A73F8017EDDE66596B3D11505DDD4AA683E3F059.png" width="650" height="210"></span></p></li>        <li id="li111133465207">在HAR包工程中重新通过attach方式对主工程应用进行调试，此时可以在HAR模块上添加断点进行调试。         <p id="ZH-CN_TOPIC_0000002510174335__p13113174652020"><span><img originheight="379" originwidth="945" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104840.07723932272242462583268616095837:50001231000000:2800:0A0C1732E7F6AE97F7582F320E803E2038031717B1D85B006B853123793581E0.png" width="920" height="368.97354497354496"></span></p></li>       </ol>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002510174335__p1775916349218">如果在HAR包工程中同时配置<a href="/consumer/cn/doc/harmonyos-guides/ide-source-code-debugging#section177418333199">Symbol Directories</a>和Ets Source Pairs，可同时attach调试ArkTS和C++断点。</p>        </div></div></div></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section17717111015324">源码HAR调试<i class="anchor-icon anchor-icon-link" anchorid="section17717111015324" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1626205613612" class="firsth2">C++代码调试<i class="anchor-icon anchor-icon-link" anchorid="section1626205613612" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002510174335__p102655611620">如果HAP/HSP引用源码HAR包，同时HAR包中包含C++代码，可参考<a href="/consumer/cn/doc/harmonyos-guides/ide-source-code-debugging#section177418333199">字节码HAR</a>进行调试。</p>    </div>    <div class="tiledSection">     <h3 id="section497284633916">ArkTS代码调试<i class="anchor-icon anchor-icon-link" anchorid="section497284633916" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002510174335__p2054445104117">工程中引用源码HAR包，对该HAR包进行调试，根据本地是否有源码，调试方式分别如下：</p>     <ul id="ZH-CN_TOPIC_0000002510174335__ul971861014328">      <li id="li8718210143214">如果HAR包在本地没有对应源码，此时应用构建打包时引用的源码来源是工程级oh_modules目录下的源码，只能针对oh_modules下的源码进行调试。       <p id="ZH-CN_TOPIC_0000002510174335__p171831013213"><span><img originheight="241" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104840.91005475083765395046005775741153:50001231000000:2800:9D7A9BC81FC77890EF432576964E5B1160236FF8D992248F50D5ECF316F8C8AC.png" width="320" height="241"></span></p></li>      <li id="li971811020321">如果HAR包在本地有对应源码，调试时可关联本地源码以实现对源码的调试，有两种方式。       <ul id="ZH-CN_TOPIC_0000002510174335__ul1771820106328">        <li id="li135661212193314">方式一：参考<a href="/consumer/cn/doc/harmonyos-guides/ide-source-code-debugging#section1035165781918">字节码HAR调试</a>。</li>        <li id="li7719131018326">方式二：当Step Into进入oh_modules中的ets代码后，会弹出源码关联的提示时，请点击<strong>Choose Sources</strong>，选择本地对应ets源码进行关联。         <p id="ZH-CN_TOPIC_0000002510174335__p137195108328"><span><img originheight="620" originwidth="1078" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104840.27641410022899983706318231810841:50001231000000:2800:441C58431DA8DC73D905056336D56C29ACC2F261353DB73E11B75589925799C8.png" width="920" height="529.1280148423006"></span></p></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section0367759491">HSP源码调试<i class="anchor-icon anchor-icon-link" anchorid="section0367759491" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002510174335__p036813591895">如果要调试HSP源码，需要将源码置于本地工程模块下，参考<a href="/consumer/cn/doc/harmonyos-guides/ide-source-code-debugging#li17359570194">字节码HAR的方式一</a>进行调试。</p>    </div>   </div>   <div></div></div>