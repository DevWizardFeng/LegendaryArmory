<h1 _ngcontent-tjt-c119="" class="doc-title ng-star-inserted" title="下车步行导航流转"> 下车步行导航流转 </h1>

<div _ngcontent-tjt-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>支持将车机指定的地图应用的步行导航数据流转至手机。</p>    <div class="tiledSection">     <h2 id="section35911271952">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section35911271952" tips="复制节点链接"></i></h2>          <p>下车步行导航流转：用户下车前，车机地图应用导航还未结束, 下车后可将车机上的导航数据流转至手机，发起步行导航。</p>    </div>    <p><span><img height="159.92319" originheight="279" originwidth="1373" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115048.10542506438352952089931272836419:50001231000000:2800:9E932FC5DD0D3F108C7B8A9420E5DF9DBC22191C78085EC41EBDA09848753E3C.png" title="点击放大" width="787.0275"></span></p>    <div class="tiledSection">     <h2 id="section158627391761">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section158627391761" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/car-navigationinfomgr#section66695411419" target="_blank">registerSystemNavigationListener</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>注册监听系统导航信息和指令。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/car-navigationinfomgr#section1567066181615" target="_blank">unregisterSystemNavigationListener</a></p></td>         <td class="cellrowborder" valign="top" width="50%">          <p>取消注册监听系统导航信息和指令。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section131961548115211">开发流程<i class="anchor-icon anchor-icon-link" anchorid="section131961548115211" tips="复制节点链接"></i></h2>          <p><span><img height="480.39506900000003" originheight="569" originwidth="905" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211115048.41637460635186711460850673605953:50001231000000:2800:FA357AC99BF6163548D964F7C06677CBE321AE0EBD607DB201FD7AA14A71EBA1.png" title="点击放大" width="764.085"></span></p>    </div>    <div class="tiledSection">     <h2 id="section31591952072">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section31591952072" tips="复制节点链接"></i></h2>          <ol>      <li>能力配置。       <p>请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/car-preparations#section239110365269">能力配置</a>进行配置。下车步行导航流转场景下，metadata的name取值为carHopCapability，value取值应为<strong>getOffCarNavi</strong>。示例代码如下所示：</p>       <div _ngcontent-tjt-c106="" class="highlight-div"><div _ngcontent-tjt-c106="" class="highlight-div-header"><div _ngcontent-tjt-c106="" class="highlight-div-header-left"><div _ngcontent-tjt-c106="" class="handle-button expand-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tjt-c106="" class="highlight-div-header-right"><div _ngcontent-tjt-c106="" class="handle-button ai-button"></div><div _ngcontent-tjt-c106="" class="handle-button line-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tjt-c106="" class="handle-button theme-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tjt-c106="" class="handle-button copy-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"metadata"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"carHopCapability"</span>,</li><li>    <span class="hljs-string">"value"</span>: <span class="hljs-string">"getOffCarNavi"</span></li><li>  }</li><li>]</li></ol></pre></div></div></li>      <li>导入Car Kit相关模块。       <div _ngcontent-tjt-c106="" class="highlight-div"><div _ngcontent-tjt-c106="" class="highlight-div-header"><div _ngcontent-tjt-c106="" class="highlight-div-header-left"><div _ngcontent-tjt-c106="" class="handle-button expand-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tjt-c106="" class="highlight-div-header-right"><div _ngcontent-tjt-c106="" class="handle-button ai-button"></div><div _ngcontent-tjt-c106="" class="handle-button line-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tjt-c106="" class="handle-button theme-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tjt-c106="" class="handle-button copy-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { navigationInfoMgr } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CarKit'</span>;</li></ol></pre></div></div></li>      <li>监听系统导航信息和指令。       <div class="p">        地图应用需要注册监听系统导航信息和指令，方便地图应用接收系统指令。用户下车后，系统会给地图应用发送START_NAVIGATION指令，地图应用在收到指令后即可开启步行导航任务。        <div _ngcontent-tjt-c106="" class="highlight-div"><div _ngcontent-tjt-c106="" class="highlight-div-header"><div _ngcontent-tjt-c106="" class="highlight-div-header-left"><div _ngcontent-tjt-c106="" class="handle-button expand-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tjt-c106="" class="highlight-div-header-right"><div _ngcontent-tjt-c106="" class="handle-button ai-button"></div><div _ngcontent-tjt-c106="" class="handle-button line-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tjt-c106="" class="handle-button theme-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tjt-c106="" class="handle-button copy-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">hilog</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 实现SystemNavigationListener接口</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Listener</span> <span class="hljs-variable">implements</span> <span class="hljs-variable">navigationInfoMgr</span>.<span class="hljs-variable">SystemNavigationListener</span> {</li><li>  <span class="hljs-comment">// 实现onQueryNavigationInfo方法</span></li><li>  <span class="hljs-title function_">onQueryNavigationInfo</span>(<span class="hljs-variable">query</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">QueryType</span>, <span class="hljs-variable">args</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">ResultData</span>&gt; {</li><li>    <span class="hljs-comment">// 返回导航信息给系统</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Promise</span>(<span class="hljs-variable">resolve</span> =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">ResultData</span> = {</li><li>        <span class="hljs-variable">code</span>: <span class="hljs-number">1001</span>,</li><li>        <span class="hljs-variable">message</span>: <span class="hljs-string">'message test1'</span>,</li><li>        <span class="hljs-variable">data</span>: <span class="hljs-title class_">args</span></li><li>      }</li><li>      <span class="hljs-title function_">resolve</span>(<span class="hljs-variable">ret</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 实现onReceiveNavigationCmd方法</span></li><li>  <span class="hljs-title function_">onReceiveNavigationCmd</span>(<span class="hljs-variable">command</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">CommandType</span>, <span class="hljs-variable">args</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-title class_">string</span>, <span class="hljs-title class_">Object</span>&gt;): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">ResultData</span>&gt; {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">command</span> == <span class="hljs-variable">navigationInfoMgr</span>.<span class="hljs-variable">CommandType</span>.<span class="hljs-variable">START_NAVIGATION</span>) {</li><li>      <span class="hljs-comment">// 地图应用处理下车后自动开启步行导航的逻辑</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable">args</span> !== <span class="hljs-variable">undefined</span> &amp;&amp; <span class="hljs-variable">args</span> !== <span class="hljs-variable">null</span>) {</li><li>        <span class="hljs-comment">// 获取导航类型</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">naviType</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">NaviType</span> = <span class="hljs-variable">args</span>[<span class="hljs-string">'naviType'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">navigationInfoMgr</span>.<span class="hljs-variable">NaviType</span>;</li><li>        <span class="hljs-comment">// 如果是步行导航</span></li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">naviType</span> === <span class="hljs-variable">navigationInfoMgr</span>.<span class="hljs-variable">NaviType</span>.<span class="hljs-variable">WALKING</span>) {</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">destPoi</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">args</span>[<span class="hljs-string">'destPoi'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">string</span>;</li><li>          <span class="hljs-comment">// 获取目的地名</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">destLocationName</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">args</span>[<span class="hljs-string">'destName'</span>] <span class="hljs-keyword">as</span> <span class="hljs-variable">string</span>;</li><li>          <span class="hljs-comment">// 获取目的地纬度</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">destLatitude</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">destPoi</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">0</span>].<span class="hljs-title function_">toString</span>();</li><li>          <span class="hljs-comment">// 获取目的地经度</span></li><li>          <span class="hljs-keyword">let</span> <span class="hljs-variable">destLongitude</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">destPoi</span>?.<span class="hljs-title function_">split</span>(<span class="hljs-string">','</span>)[<span class="hljs-number">1</span>].<span class="hljs-title function_">toString</span>();</li><li>          <span class="hljs-comment">// 发起步行导航</span></li><li>          <span class="hljs-comment">// ...</span></li><li>        }</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">new</span> <span class="hljs-title function_">Promise</span>(<span class="hljs-variable">resolve</span> =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">ret</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">ResultData</span> = {</li><li>        <span class="hljs-variable">code</span>: <span class="hljs-number">1002</span>,</li><li>        <span class="hljs-variable">message</span>: <span class="hljs-string">'message test2'</span>,</li><li>        <span class="hljs-variable">data</span>: <span class="hljs-title class_">args</span></li><li>      }</li><li>      <span class="hljs-title function_">resolve</span>(<span class="hljs-variable">ret</span>);</li><li>    })</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 获取NavigationController实例</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">navInfoController</span>: <span class="hljs-title class_">navigationInfoMgr</span>.<span class="hljs-title class_">NavigationController</span> = <span class="hljs-variable">navigationInfoMgr</span>.<span class="hljs-title function_">getNavigationController</span>();</li><li>  <span class="hljs-comment">// 注册监听系统导航信息和指令</span></li><li>  <span class="hljs-variable">navInfoController</span>.<span class="hljs-title function_">registerSystemNavigationListener</span>(<span class="hljs-variable">new</span> <span class="hljs-title function_">Listener</span>());</li><li>} <span class="hljs-keyword">catch</span> (<span class="hljs-variable">e</span>) {</li><li>  <span class="hljs-comment">// 捕获接口调用异常时的错误码并做相应处理</span></li><li>  <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, `<span class="hljs-variable">register</span> <span class="hljs-variable">system</span> <span class="hljs-variable">navigation</span> <span class="hljs-variable">listener</span>, <span class="hljs-variable">error</span> <span class="hljs-variable">code</span>: ${<span class="hljs-variable">e</span>?.<span class="hljs-variable">code</span>}`);</li><li>}</li></ol></pre></div></div>       </div></li>      <li>取消监听。       <p>在地图应用退出时，需要取消之前注册的监听，减少手机系统不必要的资源消耗。</p>       <div _ngcontent-tjt-c106="" class="highlight-div"><div _ngcontent-tjt-c106="" class="highlight-div-header"><div _ngcontent-tjt-c106="" class="highlight-div-header-left"><div _ngcontent-tjt-c106="" class="handle-button expand-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tjt-c106="" class="highlight-div-header-right"><div _ngcontent-tjt-c106="" class="handle-button ai-button"></div><div _ngcontent-tjt-c106="" class="handle-button line-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tjt-c106="" class="handle-button theme-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tjt-c106="" class="handle-button copy-button"><div _ngcontent-tjt-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tjt-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 获取NavigationController实例</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">navInfoController</span>: navigationInfoMgr.<span class="hljs-property">NavigationController</span> = navigationInfoMgr.<span class="hljs-title function_">getNavigationController</span>();</li><li>  <span class="hljs-comment">// 取消注册监听系统导航信息和指令</span></li><li>  navInfoController.<span class="hljs-title function_">unregisterSystemNavigationListener</span>();</li><li>} <span class="hljs-keyword">catch</span> (e) {</li><li>  <span class="hljs-comment">// 捕获接口调用异常时的错误码并做相应处理</span></li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`unregister system navigation listener error, error code: <span class="hljs-subst">${e?.code}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>