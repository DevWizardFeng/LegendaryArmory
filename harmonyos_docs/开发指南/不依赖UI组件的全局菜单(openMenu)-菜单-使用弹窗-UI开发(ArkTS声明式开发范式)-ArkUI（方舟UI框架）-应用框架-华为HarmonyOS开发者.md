<h1 _ngcontent-xii-c119="" class="doc-title ng-star-inserted" title="不依赖UI组件的全局菜单 (openMenu)"> 不依赖UI组件的全局菜单 (openMenu) </h1>

<div _ngcontent-xii-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-popup-and-menu-components-menu">菜单控制 (Menu)</a>在使用时依赖绑定UI组件，否则无法使用。从API version 18开始，可以通过使用全局接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#openmenu18" target="_blank">openMenu</a>的方式，在无UI组件的场景下直接或封装使用，例如在事件回调中使用或封装后对外提供能力。</p>    <div class="tiledSection">     <h2 id="弹出菜单">弹出菜单<i class="anchor-icon anchor-icon-link" anchorid="弹出菜单" tips="复制节点链接"></i></h2>          <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#openmenu18" target="_blank">openMenu</a>可以弹出菜单。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>promptAction.<span class="hljs-title function_">openMenu</span>(contentNode, { <span class="hljs-attr">id</span>: targetId }, {</li><li>  <span class="hljs-attr">enableArrow</span>: <span class="hljs-literal">true</span></li><li>})</li><li>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'openMenu success'</span>);</li><li>  })</li><li>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'openMenu error: '</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' '</span> + err.<span class="hljs-property">message</span>);</li><li>  })</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="创建componentcontent" class="firsth2">创建ComponentContent<i class="anchor-icon anchor-icon-link" anchorid="创建componentcontent" tips="复制节点链接"></i></h3>          <p>通过调用openMenu接口弹出菜单，需要提供用于定义自定义弹出框的内容<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-componentcontent" target="_blank">ComponentContent</a>。其中，wrapBuilder(buildText)封装自定义组件，new Params(this.message)是自定义组件的入参，可以缺省，也可以传入基础数据类型。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">contentNode</span>: <span class="hljs-title class_">ComponentContent</span>&lt;<span class="hljs-title class_">Object</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentContent</span>(uiContext, <span class="hljs-title function_">wrapBuilder</span>(buildText), <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>);</li></ol></pre></div></div>     <p>如果在wrapBuilder中包含其他组件（例如：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-arkui-advanced-popup" target="_blank">Popup</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-arkui-advanced-chip" target="_blank">Chip</a>组件），则<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-arkui-componentcontent#componentcontent-1" target="_blank">ComponentContent</a>应采用带有四个参数的构造函数constructor，其中options参数应传递{ nestingBuilderSupported: true }。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">buildText</span>(<span class="hljs-params">params: Params</span>) {</li><li>  <span class="hljs-title class_">Popup</span>({</li><li>    <span class="hljs-comment">// 类型设置图标内容</span></li><li>    <span class="hljs-attr">icon</span>: {</li><li>      <span class="hljs-attr">image</span>: $r(<span class="hljs-string">'app.media.app_icon'</span>),</li><li>      <span class="hljs-attr">width</span>: <span class="hljs-number">32</span>,</li><li>      <span class="hljs-attr">height</span>: <span class="hljs-number">32</span>,</li><li>      <span class="hljs-attr">fillColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>,</li><li>      <span class="hljs-attr">borderRadius</span>: <span class="hljs-number">10</span></li><li>    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">PopupIconOptions</span>,</li><li>    <span class="hljs-comment">// 设置文字内容</span></li><li>    <span class="hljs-attr">title</span>: {</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">`This is a Popup title 1`</span>,</li><li>      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">20</span>,</li><li>      <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>,</li><li>      <span class="hljs-attr">fontWeight</span>: <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span></li><li>    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">PopupTextOptions</span>,</li><li>    <span class="hljs-comment">// 设置文字内容</span></li><li>    <span class="hljs-attr">message</span>: {</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">`This is a Popup message 1`</span>,</li><li>      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>,</li><li>      <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span></li><li>    } <span class="hljs-keyword">as</span> <span class="hljs-title class_">PopupTextOptions</span>,</li><li>    <span class="hljs-comment">// 设置按钮内容</span></li><li>    <span class="hljs-attr">buttons</span>: [{</li><li>      <span class="hljs-attr">text</span>: <span class="hljs-string">'confirm'</span>,</li><li>      <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'confirm button click'</span>);</li><li>      },</li><li>      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>,</li><li>      <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>,</li><li>    },</li><li>      {</li><li>        <span class="hljs-attr">text</span>: <span class="hljs-string">'cancel'</span>,</li><li>        <span class="hljs-attr">action</span>: <span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cancel button click'</span>);</li><li>        },</li><li>        <span class="hljs-attr">fontSize</span>: <span class="hljs-number">15</span>,</li><li>        <span class="hljs-attr">fontColor</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span></li><li>      },] <span class="hljs-keyword">as</span> [<span class="hljs-title class_">PopupButtonOptions</span>?, <span class="hljs-title class_">PopupButtonOptions</span>?]</li><li>  })</li><li>}</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">contentNode</span>: <span class="hljs-title class_">ComponentContent</span>&lt;<span class="hljs-title class_">Object</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ComponentContent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>, <span class="hljs-title function_">wrapBuilder</span>(buildText), <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>, { <span class="hljs-attr">nestingBuilderSupported</span>: <span class="hljs-literal">true</span> });</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="绑定组件信息">绑定组件信息<i class="anchor-icon anchor-icon-link" anchorid="绑定组件信息" tips="复制节点链接"></i></h3>          <p>通过调用openMenu接口弹出菜单，需要提供绑定组件的信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-i#targetinfo18" target="_blank">TargetInfo</a>。若未传入有效的target，则无法弹出菜单。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">frameNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">ctx</span>.<span class="hljs-title function_">getFrameNodeByUniqueId</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUniqueId</span>());</li><li><span class="hljs-keyword">let</span> targetId = frameNode?.<span class="hljs-title function_">getChild</span>(<span class="hljs-number">0</span>)?.<span class="hljs-title function_">getUniqueId</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置弹出菜单样式">设置弹出菜单样式<i class="anchor-icon anchor-icon-link" anchorid="设置弹出菜单样式" tips="复制节点链接"></i></h3>          <p>通过调用openMenu接口弹出菜单，可以设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-menu#menuoptions10" target="_blank">MenuOptions</a>中的属性调整菜单样式。title属性不生效。preview参数仅支持设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-menu#menupreviewmode11" target="_blank">MenuPreviewMode</a>类型。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">MenuOptions</span> = { <span class="hljs-attr">enableArrow</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">placement</span>: <span class="hljs-title class_">Placement</span>.<span class="hljs-property">Bottom</span> };</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="更新菜单样式">更新菜单样式<i class="anchor-icon anchor-icon-link" anchorid="更新菜单样式" tips="复制节点链接"></i></h2>          <p>从API version 18开始，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#updatemenu18" target="_blank">updateMenu</a>可以更新菜单的样式。支持全量更新和增量更新其菜单样式，不支持更新showInSubWindow、preview、previewAnimationOptions、transition、onAppear、aboutToAppear、onDisappear、aboutToDisappear、onWillAppear、onDidAppear、onWillDisappear和onDidDisappear。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>promptAction.<span class="hljs-title function_">updateMenu</span>(contentNode, {</li><li>  <span class="hljs-attr">enableArrow</span>: <span class="hljs-literal">false</span></li><li>}, <span class="hljs-literal">true</span>)</li><li>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'updateMenu success'</span>);</li><li>  })</li><li>  .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'updateMenu error: '</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' '</span> + err.<span class="hljs-property">message</span>);</li><li>  })</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="关闭菜单">关闭菜单<i class="anchor-icon anchor-icon-link" anchorid="关闭菜单" tips="复制节点链接"></i></h2>          <p>从API version 18开始，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#closemenu18" target="_blank">closeMenu</a>可以关闭菜单。</p>     <div _ngcontent-xii-c106="" class="highlight-div"><div _ngcontent-xii-c106="" class="highlight-div-header"><div _ngcontent-xii-c106="" class="highlight-div-header-left"><div _ngcontent-xii-c106="" class="handle-button expand-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xii-c106="" class="highlight-div-header-right"><div _ngcontent-xii-c106="" class="handle-button ai-button"></div><div _ngcontent-xii-c106="" class="handle-button line-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xii-c106="" class="handle-button theme-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xii-c106="" class="handle-button copy-button"><div _ngcontent-xii-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xii-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>promptAction.<span class="hljs-title function_">closeMenu</span>(contentNode)</li><li>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'closeMenu success'</span>);</li><li>  })</li><li> .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>   <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'closeMenu error: '</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">' '</span> + err.<span class="hljs-property">message</span>);</li><li> })</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>由于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#updatemenu18" target="_blank">updateMenu</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-promptaction#closemenu18" target="_blank">closeMenu</a>依赖content来更新或者关闭指定的菜单，开发者需自行维护传入的content。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="在har包中使用全局菜单">在HAR包中使用全局菜单<i class="anchor-icon anchor-icon-link" anchorid="在har包中使用全局菜单" tips="复制节点链接"></i></h2>          <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/har-package">HAR</a>包封装一个Menu，从而对外提供菜单的弹出、更新和关闭能力。</p>     <p>具体调用方式参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-popup-and-menu-components-uicontext-popup#在har包中使用全局气泡提示">在HAR包中使用全局气泡提示</a>。</p>    </div>   </div>   <div></div></div>