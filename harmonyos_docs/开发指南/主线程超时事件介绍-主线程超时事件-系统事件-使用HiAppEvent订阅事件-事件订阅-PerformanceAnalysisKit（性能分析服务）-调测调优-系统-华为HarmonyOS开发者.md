<h1 _ngcontent-cax-c119="" class="doc-title ng-star-inserted" title="主线程超时事件介绍"> 主线程超时事件介绍 </h1>

<div _ngcontent-cax-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2>          <p>当应用的主线程执行耗时任务时，开发者会感知到应用卡顿，但卡顿时间未达到系统设定的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines">应用冻屏</a>时间限制，因此不会生成故障日志。为了更好地定位和分析问题，开发者可以利用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines#检测原理">主线程超时事件检测原理</a>，根据生成的采样<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines#日志规格">主线程超时事件日志规格</a>，主动分析主线程任务的执行情况。</p>    </div>    <div class="tiledSection">     <h2 id="检测原理">检测原理<i class="anchor-icon anchor-icon-link" anchorid="检测原理" tips="复制节点链接"></i></h2>          <p>详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/apptask-timeout-guidelines#检测原理">主线程超时检测原理</a></p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>开发者可以通过HiAppEvent提供接口订阅主线程超时事件“hiAppEvent.event.MAIN_THREAD_JANK”，系统检测到主线程超时后，会抓取维测信息通过HiAppEvent将主线程超时回调给应用进程。</p>     <ul>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-mainthreadjank-events-arkts">订阅主线程超时事件（ArkTS）</a></p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hiappevent-watcher-mainthreadjank-events-ndk">订阅主线程超时事件（C/C++）</a></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="自定义参数">自定义参数<i class="anchor-icon anchor-icon-link" anchorid="自定义参数" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="seteventconfig接口说明" class="firsth2">setEventConfig接口说明<i class="anchor-icon anchor-icon-link" anchorid="seteventconfig接口说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-hiappevent#hiappeventseteventconfig15" target="_blank">setEventConfig(name: string, config: Record&lt;string, ParamType&gt;): Promise&lt;void&gt;</a></td>         <td class="cellrowborder" valign="top" width="50%">设置主线程采样栈参数接口。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="seteventconfig参数设置说明">setEventConfig参数设置说明<i class="anchor-icon anchor-icon-link" anchorid="seteventconfig参数设置说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">name</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">主线程超时事件名称，此处应为常量hiappevent.event.MAIN_THREAD_JANK。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">config</td>         <td class="cellrowborder" valign="top" width="25%">Record&lt;string, ParamType&gt;</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">主线程超时采样栈配置参数。</td>        </tr>             </tbody></table></div>     </div>     <p>主线程超时采样栈配置参数的定义。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>log_type参数为必选项。</p>       <p>log_type=0或2时，不设置其他参数。</p>       <p>log_type=1时，所有参数均需设置。</p>      </div></div></div>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.5.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">log_type</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">          <p>采集MAIN_THREAD_JANK事件日志类型。</p>          <p>log_type=0：默认值，主线程连续两次超时150ms~450ms，采集调用栈；主线程超时450ms，采集trace。</p>          <p>log_type=1：仅采集调用栈。</p>          <p>log_type=2：仅采集trace。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">sample_interval</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>主线程超时检测间隔和采样间隔。</p>          <p>单位为ms，默认值：150，取值范围为[50, 500]。</p>          <p>系统根据开发者设置的sample_interval进行超时检测判断，并使用该sample_interval作为周期性任务检测的间隔。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ignore_startup_time</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>忽略启动时间内的主线程超时检测。单位为s，最小值：3，默认值：10。</p>          <p>线程启动一定时间内，不进行超时检测。一些进程启动时间较长，此时抓全的超时采样栈，分析意义不大。因此，在开发者定义启动时间间隔内，不进行超时检测。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">sample_count</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>主线程超时采样次数。系统检测到当前主线程执行任务时长达到可采样阈值时，开始周期性采集堆栈，每个间隔采集一次堆栈，共采集sample_count次。</p>          <p>默认值：10次。</p>          <p>最小值：1次，最大值需要结合自定义的sample_interval进行动态计算，计算公式：sample_count &lt;= (2500 / sample_interval - 4)。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">report_times_per_app</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>同一个应用的PID一个生命周期内，主线程超时采样上报次数。一个生命周期内只能设置一次。</p>          <p>默认值：1次，单位：次。</p>          <p>开发者选项打开，每小时范围：[1, 3]。</p>          <p>开发者选项关闭，每天上报次数范围：[1, 3]。</p></td>        </tr>             </tbody></table></div>     </div>     <ol>      <li>       <p>sample_count说明：</p>       <p>（1）2500的含义：根据系统规定，主线程超时事件从检测到上报的时间不可以超过2.5s（即：2500ms）。因此sample_count的设置值不能超过系统按计算公式得出的最大值。</p>       <p>（2）4的含义：第一次超时间隔检测时间 + 第二次超时间隔（系统提供两次再次发生超时事件的检测机会）时间 + 收集并上报堆栈信息的时间。</p>       <p>（3）开发者要结合需求场景，进行合理的设置。</p></li>      <li>       <p>参数设置示例</p>       <p>以下示例用于模拟配置MAIN_THREAD_JANK事件的门限触发条件，以log_type的三种类型为例：</p>       <p>（1）log_type=0，用于采样栈或采样trace。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog, hiAppEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, hiAppEvent.<span class="hljs-property">ParamType</span>&gt; = {</li><li>  <span class="hljs-string">"log_type"</span>: <span class="hljs-string">"0"</span></li><li>};</li><li>hiAppEvent.<span class="hljs-title function_">setEventConfig</span>(hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">MAIN_THREAD_JANK</span>, params).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Setting default value successfully.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Failed to set default value. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>       <p>（2）log_type=1，仅用于采集调用栈。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog, hiAppEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, hiAppEvent.<span class="hljs-property">ParamType</span>&gt; = {</li><li>  <span class="hljs-string">"log_type"</span>: <span class="hljs-string">"1"</span>,</li><li>  <span class="hljs-string">"sample_interval"</span>: <span class="hljs-string">"100"</span>,</li><li>  <span class="hljs-string">"ignore_startup_time"</span>: <span class="hljs-string">"11"</span>,</li><li>  <span class="hljs-string">"sample_count"</span>: <span class="hljs-string">"21"</span>,</li><li>  <span class="hljs-string">"report_times_per_app"</span>: <span class="hljs-string">"3"</span></li><li>};</li><li>hiAppEvent.<span class="hljs-title function_">setEventConfig</span>(hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">MAIN_THREAD_JANK</span>, params).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Successfully set sampling stack parameters.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Failed to set sample stack value. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>       <p>（3）log_type=2，仅用于采集trace。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog, hiAppEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">params</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, hiAppEvent.<span class="hljs-property">ParamType</span>&gt; = {</li><li>  <span class="hljs-string">"log_type"</span>: <span class="hljs-string">"2"</span></li><li>};</li><li>hiAppEvent.<span class="hljs-title function_">setEventConfig</span>(hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">MAIN_THREAD_JANK</span>, params).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Set to only collect trace successfully.`</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'hiAppEvent'</span>, <span class="hljs-string">`Failed to set only collect trace. code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="oh_hiappevent_seteventconfig接口说明">OH_HiAppEvent_SetEventConfig接口说明<i class="anchor-icon anchor-icon-link" anchorid="oh_hiappevent_seteventconfig接口说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-hiappevent-h#oh_hiappevent_seteventconfig" target="_blank">int OH_HiAppEvent_SetEventConfig(const char* name, HiAppEvent_Config* config)</a></td>         <td class="cellrowborder" valign="top" width="50%">设置主线程采样栈参数接口。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="oh_hiappevent_seteventconfig接口参数设置说明">OH_HiAppEvent_SetEventConfig接口参数设置说明<i class="anchor-icon anchor-icon-link" anchorid="oh_hiappevent_seteventconfig接口参数设置说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.1" valign="top" width="25%">参数名</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.2.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">name</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">主线程超时事件名称，此处为预定义的宏EVENT_MAIN_THREAD_JANK</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">config</td>         <td class="cellrowborder" valign="top" width="25%">HiAppEvent_Config*</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">主线程超时采样栈配置参数，可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-hiappevent-h#oh_hiappevent_setconfigitem" target="_blank">OH_HiAppEvent_SetConfigItem</a>函数设置config参数的配置项。</td>        </tr>             </tbody></table></div>     </div>     <p>接口不提供主线程超时结束自动停止采样栈的功能，config参数作如下配置。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>配置项名称为相关字符串。</p>       <p>log_type为必选配置项。</p>       <p>log_type为"0"或"2"时，无其他配置项。</p>       <p>log_type为"1"时，所有配置项均需设置。</p>       <p>配置项的值均为可转换为整型的字符串字面量或字符指针。</p>      </div></div></div>     <p>下文中值的取值范围说明均按转换后的变量类型进行阐述。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.1" valign="top" width="25%">配置项名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.3" valign="top" width="25%">必须配置</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">log_type</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">是</td>         <td class="cellrowborder" valign="top" width="25%">          <p>采集日志的类型。</p>          <p>值为"0"：默认值，主线程连续两次超时150ms~450ms，采集调用栈；主线程超时450ms，采集trace。</p>          <p>值为"1"：仅采集调用栈。</p>          <p>值为"2"：仅采集trace。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">sample_interval</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>主线程超时检测间隔和采样间隔。</p>          <p>单位为ms，默认值：150，取值范围为[50, 500]。</p>          <p>系统根据开发者设置的sample_interval的值进行超时检测判断，并使用该值作为周期性任务检测的间隔。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ignore_startup_time</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>忽略启动时间内的主线程超时检测。</p>          <p>单位为s，最小值：3，默认值：10。</p>          <p>线程启动一定时间内，不进行超时检测。一些进程启动时间较长，此时抓全的超时采样栈，分析意义不大。因此，在开发者定义启动时间间隔内，不进行超时检测。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">sample_count</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>主线程超时采样次数。系统检测到当前主线程执行任务时长达到可采样阈值时，开始周期性采集堆栈，每个间隔采集一次堆栈，共采集sample_count次。</p>          <p>默认值：10次。</p>          <p>最小值：1次，最大值需要结合自定义的sample_interval进行动态计算，计算公式：sample_count &lt;= (2500 / sample_interval - 4)。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">report_times_per_app</td>         <td class="cellrowborder" valign="top" width="25%">const char*</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">          <p>同一个应用的PID一个生命周期内，主线程超时采样上报次数。一个生命周期内只能设置一次。</p>          <p>默认值：1次，单位：次。</p>          <p>开发者选项打开，每小时范围：[1, 3]。</p>          <p>开发者选项关闭，每天上报次数范围：[1, 3]。</p></td>        </tr>             </tbody></table></div>     </div>     <ol>      <li>       <p>sample_count说明：</p>       <p>（1）2500的含义：根据系统规定，主线程超时事件从检测到上报的时间不可以超过2.5s（即：2500ms）。因此sample_count的设置值不能超过系统按计算公式得出的最大值。</p>       <p>（2）4的含义：第一次超时间隔检测时间 + 第二次超时间隔（系统提供两次再次发生超时事件的检测机会）时间 + 收集并上报堆栈信息的时间。</p>       <p>（3）开发者要结合需求场景，进行合理的设置。</p></li>      <li>       <p>参数设置示例</p>       <p>展示OH_HiAppEvent_SetEventConfig接口中config参数的配置项log_type分别为"0"，"1"，"2"三种类型：</p>       <p>（1）log_type为"0"时，用于采样栈或采样trace。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hiappevent/hiappevent.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"testTag"</span></span></li><li>
</li><li>HiAppEvent_Config* config = <span class="hljs-built_in">OH_HiAppEvent_CreateConfig</span>();</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"log_type"</span>, <span class="hljs-string">"0"</span>);</li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_HiAppEvent_SetEventConfig</span>(EVENT_MAIN_THREAD_JANK, config);</li><li><span class="hljs-keyword">if</span> (ret == HIAPPEVENT_SUCCESS) {</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"Setting default value successfully."</span>);</li><li>}</li><li><span class="hljs-built_in">OH_HiAppEvent_DestroyConfig</span>(config);</li></ol></pre></div></div>       <p>（2）log_type为"1"时，仅用于采集调用栈。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hiappevent/hiappevent.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"testTag"</span></span></li><li>
</li><li>HiAppEvent_Config* config = <span class="hljs-built_in">OH_HiAppEvent_CreateConfig</span>();</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"log_type"</span>, <span class="hljs-string">"1"</span>);</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"sample_interval"</span>, <span class="hljs-string">"100"</span>);</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"ignore_startup_time"</span>, <span class="hljs-string">"11"</span>);</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"sample_count"</span>, <span class="hljs-string">"21"</span>);</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"report_times_per_app"</span>, <span class="hljs-string">"3"</span>);</li><li>
</li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_HiAppEvent_SetEventConfig</span>(EVENT_MAIN_THREAD_JANK, config);</li><li><span class="hljs-keyword">if</span> (ret == HIAPPEVENT_SUCCESS) {</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"Successfully set sampling stack parameters."</span>);</li><li>}</li><li><span class="hljs-built_in">OH_HiAppEvent_DestroyConfig</span>(config);</li></ol></pre></div></div>       <p>（3）log_type为"2"时，仅用于采集trace。</p>       <div _ngcontent-cax-c106="" class="highlight-div"><div _ngcontent-cax-c106="" class="highlight-div-header"><div _ngcontent-cax-c106="" class="highlight-div-header-left"><div _ngcontent-cax-c106="" class="handle-button expand-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cax-c106="" class="highlight-div-header-right"><div _ngcontent-cax-c106="" class="handle-button ai-button"></div><div _ngcontent-cax-c106="" class="handle-button line-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cax-c106="" class="handle-button theme-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cax-c106="" class="handle-button copy-button"><div _ngcontent-cax-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cax-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hiappevent/hiappevent.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">undef</span> LOG_TAG</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"testTag"</span></span></li><li>
</li><li>HiAppEvent_Config* config = <span class="hljs-built_in">OH_HiAppEvent_CreateConfig</span>();</li><li><span class="hljs-built_in">OH_HiAppEvent_SetConfigItem</span>(config, <span class="hljs-string">"log_type"</span>, <span class="hljs-string">"2"</span>);</li><li>
</li><li><span class="hljs-type">int</span> ret = <span class="hljs-built_in">OH_HiAppEvent_SetEventConfig</span>(EVENT_MAIN_THREAD_JANK, config);</li><li><span class="hljs-keyword">if</span> (ret == HIAPPEVENT_SUCCESS) {</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LogType::LOG_APP, <span class="hljs-string">"Set to only collect trace successfully"</span>);</li><li>}</li><li><span class="hljs-built_in">OH_HiAppEvent_DestroyConfig</span>(config);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="事件字段说明">事件字段说明<i class="anchor-icon anchor-icon-link" anchorid="事件字段说明" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.4.1.1" valign="top" width="33.33333333333333%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.4.1.2" valign="top" width="33.33333333333333%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.4.1.3" valign="top" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">time</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">事件触发时间，单位为ms。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">bundle_version</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用版本。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">bundle_name</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用名称。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">pid</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用的进程id。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">uid</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">应用的用户id。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">begin_time</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程任务开始时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">end_time</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程任务结束时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">external_log</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string[]</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">主线程超时日志文件路径。<strong>为避免目录空间超限（参考log_over_limit），导致新生成的日志文件写入失败，日志文件处理完后请及时删除。</strong></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">log_over_limit</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">boolean</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">生成的主线程超时日志文件与已存在的日志文件总大小是否超过10M上限。true表示超过上限，日志写入失败；false表示未超过上限。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">app_start_jiffies_time</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">number</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开发者可以获取主线程超时事件时，任务执行的开始时间。<strong>触发采样栈，打印开始时间信息。</strong></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">heaviest_stack</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">生成的主线程超时日志文件中，打印多次的调用栈。<strong>触发采样栈，打印多次的调用栈信息。</strong></td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>