<h1 _ngcontent-pil-c119="" class="doc-title ng-star-inserted" title="产品特性按需分发(ArkTS)"> 产品特性按需分发(ArkTS) </h1>

<div _ngcontent-pil-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section15372484511">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section15372484511" tips="复制节点链接"></i></h2>          <p>随着HarmonyOS应用的持续发展，应用的功能将越来越丰富，实际上80%的用户使用时长都会集中在20%的特性上，其余的功能可能也仅仅是面向部分用户。为了避免用户首次下载应用耗时过长，及过多占用用户空间，应用市场服务提供按需分发的能力，支持用户按需动态下载自己所需的增强特性。</p>    </div>    <div class="tiledSection">     <h2 id="section12051840143913">基本概念<i class="anchor-icon anchor-icon-link" anchorid="section12051840143913" tips="复制节点链接"></i></h2>          <p>按需分发：一个应用程序被打包成多个安装包，安装包包含了所有的应用程序代码和静态资源。用户从应用市场下载的应用只包含基本功能的安装包，当用户需要使用增强功能时，相应安装包将会从服务器下载到设备上（应用发布请参考<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-release-app-0000002271695230" target="_blank">发布HarmonyOS应用</a>）。</p>    </div>    <div class="tiledSection">     <h2 id="section456211159286">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section456211159286" tips="复制节点链接"></i></h2>          <p><span><img height="452.68944" originheight="588" originwidth="1008" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114528.95422909859257288658701172226518:50001231000000:2800:0D751B66A1E3C8A058DBD4262F5ADE7093D82D85EA8BA6E46A84D43931CE339E.png" title="点击放大" width="776.0550000000001"></span></p>     <ol>      <li>用户下载A应用的基础包。</li>      <li>用户使用增强功能。</li>      <li>应用通过API下载动态安装包。</li>      <li>动态安装包下载完成。</li>      <li>通过on接口告知用户下载结果。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section2933193284216">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2933193284216" tips="复制节点链接"></i></h2>          <ul>      <li>应用需要上架应用市场。</li>      <li>产品特性按需分发功能支持Phone、Tablet、PC/2in1设备。并且从5.1.1(19)版本开始，新增支持TV设备。</li>      <li>产品特性按需分发接入调试功能支持ARM版本、X86版本的模拟器。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section3584151102912">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section3584151102912" tips="复制节点链接"></i></h2>          <p>产品特性按需分发场景提供以下ArkTS接口，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="49.95%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50.05%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section9621184365412" target="_blank">getInstalledModule</a>(moduleName: string): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1518175355911" target="_blank">InstalledModule</a></p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>查询模块安装信息接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section0529646101115" target="_blank">createModuleInstallRequest</a>(context: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">common.UIAbilityContext</a> | <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">common.ExtensionContext</a>): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section5451648162618" target="_blank">ModuleInstallRequest</a></p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>创建按需加载请求对象。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section84452138473" target="_blank">addModule</a>(moduleName: string): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311" target="_blank">ReturnCode</a></p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>添加要按需加载的模块名。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1375123411137" target="_blank">fetchModules</a>(moduleInstallRequest: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section5451648162618" target="_blank">ModuleInstallRequest</a>): Promise&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136" target="_blank">ModuleInstallSessionState</a>&gt;</p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>按需加载请求接口，异步返回结果。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section48442523152" target="_blank">cancelTask</a>(taskId: string): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311" target="_blank">ReturnCode</a></p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>取消下载任务接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section104451223191616" target="_blank">showCellularDataConfirmation</a>(context: <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">common.UIAbilityContext</a> | <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">common.ExtensionContext</a>, taskId: string): <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section44479181311" target="_blank">ReturnCode</a></p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>流量提醒弹窗接口。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section18484105013164" target="_blank">on</a>(type: 'moduleInstallStatus', callback: Callback&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136" target="_blank">ModuleInstallSessionState</a>&gt;, timeout: number): void</p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>监听当前应用下载任务的进度。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.95%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section721141416172" target="_blank">off</a>(type: 'moduleInstallStatus', callback?: Callback&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1535385414136" target="_blank">ModuleInstallSessionState</a>&gt;): void</p></td>         <td class="cellrowborder" valign="top" width="50.05%">          <p>取消监听当前应用下载任务的进度。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section2413123319454">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section2413123319454" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section15434613312" class="firsth2">获取模块安装信息<i class="anchor-icon anchor-icon-link" anchorid="section15434613312" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入moduleInstallManager模块及相关公共模块。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//LoadInstallService.ets</span></li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>构造参数。</span>       <p></p>       <div class="p">        入参为需要查询的模块名称。        <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">moduleName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'AModule'</span>;</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section9621184365412" target="_blank">getInstalledModule</a>方法，将步骤2中构造的参数传入模块中的getInstalledModule方法。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">moduleInfo</span>: moduleInstallManager.<span class="hljs-property">InstalledModule</span> = moduleInstallManager.<span class="hljs-title function_">getInstalledModule</span>(moduleName);</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section205574623317">创建按需加载的请求实例<i class="anchor-icon anchor-icon-link" anchorid="section205574623317" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入moduleInstallManager模块及相关公共模块。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//LoadInstallService.ets</span></li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>构造参数。</span>       <p></p>       <div class="p">        入参为当前应用的上下文context，只支持<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext" target="_blank">UIAbilityContext</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-extensioncontext" target="_blank">ExtensionContext</a>类型的上下文，其中UIAbilityContext类型的上下文是要校验当前应用是否在前台，如果不在前台，则会被拒绝调用。        <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> | common.<span class="hljs-property">ExtensionContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section0529646101115" target="_blank">createModuleInstallRequest</a>方法，将步骤2中构造的参数依次传入模块中的createModuleInstallRequest方法。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> = <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span> = myModuleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section1256946193314">请求按需加载模块<i class="anchor-icon anchor-icon-link" anchorid="section1256946193314" tips="复制节点链接"></i></h3>          <ol>      <li><span>导入moduleInstallManager模块及相关公共模块。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//LoadInstallService.ets</span></li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>构造参数。</span>       <p></p>       <div class="p">        入参为当前要按需加载的模块名。        <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-attr">moduleNameA</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'AModule'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">moduleNameB</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'BModule'</span>;</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section5451648162618" target="_blank">ModuleInstallRequest</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section84452138473" target="_blank">addModule</a>方法，将步骤2中构造的参数依次传入模块中的addModule方法。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">myModuleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">myModuleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> = <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> | common.<span class="hljs-property">ExtensionContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  myModuleInstallRequest = myModuleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">aResult</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> = myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(moduleNameA);</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">bResult</span>: moduleInstallManager.<span class="hljs-property">ReturnCode</span> = myModuleInstallRequest.<span class="hljs-title function_">addModule</span>(moduleNameB);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'aResult:'</span> + aResult + <span class="hljs-string">' bResult:'</span> + bResult);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`addModule onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li><li>
</li></ol></pre></div></div>       <p></p></li>      <li><span>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1375123411137" target="_blank">fetchModules</a>方法，将步骤3中的myModuleInstallRequest传入模块中的fetchModules方法。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  moduleInstallManager.<span class="hljs-title function_">fetchModules</span>(myModuleInstallRequest)</li><li>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'Succeeded in fetching Modules data.'</span>);</li><li>    })</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`fetching Modules onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="section112161336173714">使用动态模块<i class="anchor-icon anchor-icon-link" anchorid="section112161336173714" tips="复制节点链接"></i></h3>          <p>假如应用A由entry.hap、AModulelib.hsp两个包组成，其中entry是基础包，AModulelib扩展是功能包（创建方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-package-dev" target="_blank">应用程序包开发与使用</a>）。通过应用市场下载安装只会下载安装entry包，在entry包里面可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/store-moduleinstallmanager#section1375123411137" target="_blank">fetchModules</a>接口动态下载AModulelib包，并使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-dynamic-import" target="_blank">动态import</a>技术调用AModulelib里的方法和组件。</p>     <p>AModulelib中主要实现如下：</p>     <ul>      <li>在动态模块AModulelib的module.json5中设置deliveryWithInstall为false，来标识当前AModulelib在用户主动安装应用A的时候不会一起下载安装。       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span>: {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"AModulelib"</span>,</li><li>    <span class="hljs-string">"deliveryWithInstall"</span>: <span class="hljs-literal">false</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>     <ul>      <li>在动态模块AModulelib中定义add方法和DateComponent组件。其中add方法用于计算加法，DateComponent用于显示文本。       <p>Calc.ets定义如下：</p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">add</span>(<span class="hljs-params">a:<span class="hljs-built_in">number</span>, b:<span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">return</span> a + b;</li><li>}</li></ol></pre></div></div>       <div class="p">        DateComponent.ets定义如下：        <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DateComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'我是AModulelib中的组件'</span>)</li><li>        .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>);</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">showDateComponent</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">DateComponent</span>()</li><li>}</li></ol></pre></div></div>       </div></li>     </ul>     <ul>      <li>在AModulelib的AModulelib/Index.ets中导出add方法和showDateComponent方法。       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> { add } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/utils/Calc'</span>;</li><li><span class="hljs-keyword">export</span> { showDateComponent } <span class="hljs-keyword">from</span> <span class="hljs-string">'./src/main/ets/components/DateComponent'</span>;</li></ol></pre></div></div></li>     </ul>     <p></p>     <p>entry中主要实现如下：</p>     <ul>      <li>在entry基础模块中，增加动态依赖配置。entry的oh-package.json5中使用dynamicDependencies来动态依赖AModulelib模块。       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"dynamicDependencies"</span>: {</li><li>    <span class="hljs-string">"AModulelib"</span>: <span class="hljs-string">"file:../AModulelib"</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>在entry中使用动态模块AModulelib模块里面的方法和组件。在调用AModulelib中的功能前需要判断AModulelib是否已经加载，未加载时请参考<a href="/consumer/cn/doc/harmonyos-guides/store-moduleinstall_arkts#section1256946193314">请求按需加载的接口</a>完成加载。       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { moduleInstallManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AppGalleryKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, <span class="hljs-title class_">Callback</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@BuilderParam</span> <span class="hljs-title class_">AModulelibComponent</span>: <span class="hljs-title class_">Function</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">countTotal</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isShow</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">`调用增量模块中的add功能:3+6`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAModulelib</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">import</span>(<span class="hljs-string">'AModulelib'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">ns: ESObject</span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">countTotal</span> = ns.<span class="hljs-title function_">add</span>(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>);</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`add onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              })</li><li>            })</li><li>          });</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'计算结果：'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">countTotal</span>)</li><li>          .<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>);</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">`调用增量模块中的showDateComponent功能`</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">initAModulelib</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-keyword">import</span>(<span class="hljs-string">'AModulelib'</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">ns: ESObject</span>) =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">AModulelibComponent</span> = ns.<span class="hljs-property">showDateComponent</span>;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">isShow</span> = <span class="hljs-literal">true</span>;</li><li>              }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`showDateComponent onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>              })</li><li>            })</li><li>          }).<span class="hljs-title function_">margin</span>({</li><li>          <span class="hljs-attr">top</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">10</span></li><li>        });</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isShow</span>) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">AModulelibComponent</span>()</li><li>        }</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">showToastInfo</span>(<span class="hljs-params">msg: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({</li><li>      <span class="hljs-attr">message</span>: msg,</li><li>      <span class="hljs-attr">duration</span>: <span class="hljs-number">2000</span></li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 检查是否已加载AModulelib包</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> successCallBack 回调</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">initAModulelib</span>(<span class="hljs-attr">successCallBack</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">void</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">result</span>: moduleInstallManager.<span class="hljs-property">InstalledModule</span> = moduleInstallManager.<span class="hljs-title function_">getInstalledModule</span>(<span class="hljs-string">'AModulelib'</span>);</li><li>      <span class="hljs-keyword">if</span> (result?.<span class="hljs-property">installStatus</span> === moduleInstallManager.<span class="hljs-property">InstallStatus</span>.<span class="hljs-property">INSTALLED</span>) {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'AModulelib installed'</span>);</li><li>        successCallBack &amp;&amp; <span class="hljs-title function_">successCallBack</span>();</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// AModulelib模块未安装, 需要调用fetchModules下载AModulelib模块。</span></li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'AModulelib not installed'</span>);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">fetchModule</span>(<span class="hljs-string">'AModulelib'</span>, successCallBack)</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`getInstalledModule onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 添加监听事件</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> successCallBack 回调</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onListenEvents</span>(<span class="hljs-attr">successCallBack</span>: <span class="hljs-title class_">Callback</span>&lt;<span class="hljs-built_in">void</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">const</span> timeout = <span class="hljs-number">3</span> * <span class="hljs-number">60</span>; <span class="hljs-comment">//单位秒， 默认最大监听时间为30min（即30*60秒）</span></li><li>    moduleInstallManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'moduleInstallStatus'</span>, <span class="hljs-function">(<span class="hljs-params">data: moduleInstallManager.ModuleInstallSessionState</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 返回成功</span></li><li>      <span class="hljs-keyword">if</span> (data.<span class="hljs-property">taskStatus</span> === moduleInstallManager.<span class="hljs-property">TaskStatus</span>.<span class="hljs-property">INSTALL_SUCCESSFUL</span>) {</li><li>        successCallBack &amp;&amp; <span class="hljs-title function_">successCallBack</span>();</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">showToastInfo</span>(<span class="hljs-string">'install success'</span>);</li><li>      }</li><li>    }, timeout)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 加载指定包</span></li><li><span class="hljs-comment">   *</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> moduleName 需要加载的安装包名称</span></li><li><span class="hljs-comment">   * <span class="hljs-doctag">@param</span> successCallBack 回调</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">fetchModule</span>(<span class="hljs-params">moduleName: <span class="hljs-built_in">string</span>, successCallBack: Callback&lt;<span class="hljs-built_in">void</span>&gt;</span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'handleFetchModules start'</span>);</li><li>      <span class="hljs-keyword">const</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">moduleInstallProvider</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallProvider</span> =</li><li>        <span class="hljs-keyword">new</span> moduleInstallManager.<span class="hljs-title class_">ModuleInstallProvider</span>();</li><li>      <span class="hljs-keyword">const</span> <span class="hljs-attr">moduleInstallRequest</span>: moduleInstallManager.<span class="hljs-property">ModuleInstallRequest</span> =</li><li>        moduleInstallProvider.<span class="hljs-title function_">createModuleInstallRequest</span>(context);</li><li>      <span class="hljs-keyword">if</span> (!moduleInstallRequest) {</li><li>        hilog.<span class="hljs-title function_">warn</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'moduleInstallRequest is empty'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      moduleInstallRequest.<span class="hljs-title function_">addModule</span>(moduleName);</li><li>      moduleInstallManager.<span class="hljs-title function_">fetchModules</span>(moduleInstallRequest)</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: moduleInstallManager.ModuleInstallSessionState</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'Succeeded in fetching Modules result.'</span>);</li><li>          <span class="hljs-keyword">if</span> (data.<span class="hljs-property">code</span> === moduleInstallManager.<span class="hljs-property">RequestErrorCode</span>.<span class="hljs-property">SUCCESS</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onListenEvents</span>(successCallBack)</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">'fetchModules failure'</span>);</li><li>          }</li><li>        })</li><li>        .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>          hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`fetchModules onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        })</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0</span>, <span class="hljs-string">'TAG'</span>, <span class="hljs-string">`handleFetchModules onError.code is <span class="hljs-subst">${error.code}</span>, message is <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ul>     <p>运行结果效果图：</p>     <p><span><img height="468.11877000000004" originheight="1080" originwidth="504" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114528.83120146086015727102933171339321:50001231000000:2800:29C29C0535D9C1A736B2823DA8D46B2FF1643BF8EE0AC13D4CEB75369075E8F8.gif" title="点击放大" width="218.45250000000001"></span></p>    </div>    <div class="tiledSection">     <h3 id="section68545351873">接入调试功能<i class="anchor-icon anchor-icon-link" anchorid="section68545351873" tips="复制节点链接"></i></h3>          <p>产品特性按需分发为开发者提供接入调试功能，支持开发者在接入过程中进行调试，应用无需上架应用市场。假如应用A由entry.hap、AModulelib.hsp两个包组成，其中entry是基础包，AModulelib是扩展功能包（创建方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hap-package" target="_blank">应用程序包开发与使用</a>）。</p>     <ol>      <li><span>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing" target="_blank">调试证书签名</a>应用/服务，本地编译构建出entry.hap、AModulelib.hsp，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/hdc#hdc命令列表" target="_blank">HDC命令安装</a>或DevEco Studio直接安装基础包。</span>       <p></p>       <div _ngcontent-pil-c106="" class="highlight-div"><div _ngcontent-pil-c106="" class="highlight-div-header"><div _ngcontent-pil-c106="" class="highlight-div-header-left"><div _ngcontent-pil-c106="" class="handle-button expand-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pil-c106="" class="highlight-div-header-right"><div _ngcontent-pil-c106="" class="handle-button ai-button"></div><div _ngcontent-pil-c106="" class="handle-button line-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pil-c106="" class="handle-button theme-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pil-c106="" class="handle-button copy-button"><div _ngcontent-pil-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pil-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li>hdc install entry.<span class="hljs-property">hap</span></li></ol></pre></div></div>       <p></p></li>      <li><span>打开<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-developer-mode#section530763213432" target="_blank">开发者调试模式</a>：进入设置 -&gt; 机型 -&gt; 关于手机，连续点击软件版本7次，弹出“开启“开发者模式””，点击“确认开启”。</span>       <p></p>       <p><span><img height="551.8557822095601" originheight="892" originwidth="1487" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114528.53403025383104735867080089528642:50001231000000:2800:1311DDEE858A63BBFF63CE07D35F4DA43C5E70CB2B54910538F277C6EA2D28EC.png" title="点击放大" width="920"></span></p>       <p></p></li>      <li><span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-device-file-explorer#section48216711204" target="_blank">访问设备沙箱路径</a>，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory#应用沙箱路径和真实物理路径的对应关系" target="_blank">应用el2级别加密数据目录</a>下，创建cache/moduleinstall/&lt;ModuleName&gt;目录（这里&lt;ModuleName&gt;是AModulelib），将模块调试包AModulelib.hsp上传至对应模块目录下。</span>       <p></p>       <p><span><img originheight="411" originwidth="889" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114528.39107903086607572784326020864559:50001231000000:2800:16DB3446B25D1FE8013A2ECD0CEBDC8D95DCC0BE4A533E3DD1FE455774EE7DD7.png" width="889" height="411"></span></p>       <p></p></li>      <li><span>按照<a href="/consumer/cn/doc/harmonyos-guides/store-moduleinstall_arkts#section205574623317">创建按需加载的请求实例</a>、<a href="/consumer/cn/doc/harmonyos-guides/store-moduleinstall_arkts#section1256946193314">请求按需加载的接口</a>或<a href="/consumer/cn/doc/harmonyos-guides/store-moduleinstall_arkts#section112161336173714">使用动态模块</a>，无需改动参数即可安装好模块调试包。监听到安装成功后，对应模块目录下的文件会被自动删除。</span></li>     </ol>    </div>   </div>   <div></div></div>