<h1 _ngcontent-jcb-c119="" class="doc-title ng-star-inserted" title="人脸活体检测"> 人脸活体检测 </h1>

<div _ngcontent-jcb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section157109333309">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section157109333309" tips="复制节点链接"></i></h2>          <p>人脸活体检测支持动作活体检测模式。</p>     <div class="p">      动作活体检测支持实时捕捉人脸，需要用户配合做指定动作就可以判断是真实活体，还是非活体攻击（比如：打印图片、人脸翻拍视频以及人脸面具等）。      <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">        <p>活体检测是一项纯端侧算法、试用期免费的系统基础服务，推荐开发者使用在考勤打卡、辅助登录和实名认证等低危业务场景中。</p>        <p>端侧算法在HarmonyOS NEXT/5.0.x已完成权威机构（CFCA）检测认证。鉴于支付和金融应用的高风险性，建议开发者基于现有的安全性，针对不同的功能场景进行风险评估和风控策略评估，并采取必要的安全措施。</p>       </div></div></div>     </div>    </div>    <div class="fignone">     <span class="figcap"><b>图1 </b>权威认证<strong>增强级</strong>检测报告</span>     <br><span><img height="665.3325" originheight="1179" originwidth="927" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114225.17969516782806897546121763778148:50001231000000:2800:891D9318AB3E87A81ED4819970082F538493F523D53268B680F412641B6FC5C3.png" title="点击放大" width="523.6875"></span>    </div>    <div class="fignone">     <span class="figcap"><b>图2 </b>活体检测示意图</span>     <br><span><img height="547.253504" originheight="665" originwidth="320" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114225.67670078509870520766098002406044:50001231000000:2800:52632B013FB20F3D28BC4064FD1441EA6AE7F3FBC6B239550663030B0AF4E790.png" title="点击放大" width="263.34000000000003"></span>    </div>    <div class="tiledSection">     <h2 id="section2020122517405">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section2020122517405" tips="复制节点链接"></i></h2>          <ul>      <li>平板仅支持竖屏检测，大折叠屏仅支持折叠时使用，小折叠屏仅支持展开时使用。</li>      <li>支持的文本语种类型：简体中文、繁体中文、英文、维吾尔文、藏文。</li>      <li>支持的播报语种类型：简体中文、英文。</li>      <li>人脸活体检测服务暂不支持横屏、分屏进行检测。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1070612236242">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1070612236242" tips="复制节点链接"></i></h2>          <p>以下仅列出demo中调用的部分主要接口，具体API说明详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness" target="_blank">API参考</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.1" valign="top" width="49.87%">          <p>接口名</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.5.3.1.3.1.2" valign="top" width="50.129999999999995%">          <p>描述</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness#section68501963545" target="_blank">startLivenessDetection</a>(config: InteractiveLivenessConfig): Promise&lt;boolean&gt;;</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>跳转到人脸活体检测页面的入口</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="49.87%">          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness#section19136935154313" target="_blank">getInteractiveLivenessResult</a>(): Promise&lt;InteractiveLivenessResult&gt;</p></td>         <td class="cellrowborder" valign="top" width="50.129999999999995%">          <p>获取人脸活体检测的结果。使用Promise异步回调</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1418318341804">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1418318341804" tips="复制节点链接"></i></h2>          <ol>      <li><span>将实现人脸活体检测相关的类添加至工程。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, abilityAccessCtrl, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { interactiveLiveness } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li></ol></pre></div></div>       <p></p></li>      <li><span>在module.json5文件中添加CAMERA权限，其中reason，abilities标签必填，配置方式参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#在配置文件中声明权限" target="_blank">requestPermissions标签说明</a>。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"requestPermissions"</span>:[</li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.CAMERA"</span>,</li><li>    <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:camera_desc"</span>,</li><li>    <span class="hljs-string">"usedScene"</span>: {<span class="hljs-string">"abilities"</span>: []}</li><li>  }</li><li>]</li></ol></pre></div></div>       <p></p></li>      <li><span>简单配置页面的布局，选择人脸活体检测验证完后的跳转模式。如果使用back跳转模式，表示人脸活体检测完成后返回到上一页。如果使用replace跳转模式，表示人脸活体检测完跳转到成功或失败页面。默认选择的是replace跳转模式。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"验证完的跳转模式："</span>)</li><li>    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"25%"</span>)</li><li>  <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">"replace"</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">"routeMode"</span> }).<span class="hljs-title function_">checked</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">isChecked: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> = <span class="hljs-string">"replace"</span></li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"replace"</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">15</span> })</li><li>
</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">"back"</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">"routeMode"</span> }).<span class="hljs-title function_">checked</span>(<span class="hljs-literal">false</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">isChecked: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> = <span class="hljs-string">"back"</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"back"</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>    }</li><li>  }</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">"75%"</span>)</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>如果选择动作活体模式，可填写验证的动作个数。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>  <span class="hljs-title class_">Text</span>(<span class="hljs-string">"动作数量："</span>)</li><li>    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"25%"</span>)</li><li>  <span class="hljs-title class_">TextInput</span>({</li><li>    <span class="hljs-attr">placeholder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span> != <span class="hljs-number">0</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span>.<span class="hljs-title function_">toString</span>() : <span class="hljs-string">"动作数量为3或4个"</span></li><li>  })</li><li>    .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">InputType</span>.<span class="hljs-property">Number</span>)</li><li>    .<span class="hljs-title function_">placeholderFont</span>({</li><li>      <span class="hljs-attr">size</span>: <span class="hljs-number">18</span>,</li><li>      <span class="hljs-attr">weight</span>: <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>,</li><li>      <span class="hljs-attr">family</span>: <span class="hljs-string">"HarmonyHeiTi"</span>,</li><li>      <span class="hljs-attr">style</span>: <span class="hljs-title class_">FontStyle</span>.<span class="hljs-property">Normal</span></li><li>    })</li><li>    .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>    .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>    .<span class="hljs-title function_">fontFamily</span>(<span class="hljs-string">"HarmonyHeiTi"</span>)</li><li>    .<span class="hljs-title function_">fontStyle</span>(<span class="hljs-title class_">FontStyle</span>.<span class="hljs-property">Normal</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">"65%"</span>)</li><li>    .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span> = <span class="hljs-title class_">Number</span>(value) <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">ActionsNumber</span>;</li><li>    })</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>点击“开始检测“按钮，触发点击事件。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Button</span>(<span class="hljs-string">"开始检测"</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>, <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span> })</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-number">192</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x317aff</span>)</li><li>  .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>  .<span class="hljs-title function_">margin</span>({</li><li>    <span class="hljs-attr">bottom</span>: <span class="hljs-number">56</span></li><li>  })</li><li>  .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startDetection</span>();</li><li>  })</li></ol></pre></div></div>       <p></p></li>      <li><span>触发CAMERA权限校验。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">array</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">"ohos.permission.CAMERA"</span>];</li><li><span class="hljs-comment">// 校验CAMERA权限</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">startDetection</span>(<span class="hljs-params"></span>) {</li><li>  abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>().<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">array</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; res.<span class="hljs-property">permissions</span>.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">if</span> (res.<span class="hljs-property">permissions</span>[i] === <span class="hljs-string">"ohos.permission.CAMERA"</span> &amp;&amp; res.<span class="hljs-property">authResults</span>[i] === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routerLibrary</span>();</li><li>      }</li><li>    }</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  })</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>配置人脸活体检测控件的配置项<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness#section16532153115517" target="_blank">InteractiveLivenessConfig</a>，用于跳转到人脸活体检测控件。</span>       <p></p>       <div class="p">        配置中具体的参数可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness" target="_blank">API文档</a>。        <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">routerOptions</span>: interactiveLiveness.<span class="hljs-property">InteractiveLivenessConfig</span> = {</li><li>  <span class="hljs-attr">isSilentMode</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSilentMode</span> <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">DetectionMode</span>,</li><li>  <span class="hljs-attr">routeMode</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">RouteRedirectionMode</span>,</li><li>  <span class="hljs-attr">actionsNum</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span></li><li>};</li></ol></pre></div></div>       </div>       <p></p></li>      <li><span>调用interactiveLiveness的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness#section68501963545" target="_blank">startLivenessDetection</a>接口，判断跳转到人脸活体检测控件是否成功。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 跳转到人脸活体检测控件</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">routerLibrary</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.AI.Component.LivenessDetect"</span>)) {</li><li>    interactiveLiveness.<span class="hljs-title function_">startLivenessDetection</span>(routerOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">DetectState: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Succeeded in jumping.`</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Failed to jump. Code：<span class="hljs-subst">${err.code}</span>，message：<span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">'this api is not supported on this device'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>      <li><span>检测结束后回到当前界面，可调用interactiveLiveness的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/vision-interactive-liveness#section19136935154313" target="_blank">getInteractiveLivenessResult</a>接口，验证人脸活体检测的结果。</span>       <p></p>       <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取验证结果</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">getDetectionResultInfo</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// getInteractiveLivenessResult接口调用完会释放资源</span></li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.AI.Component.LivenessDetect"</span>)) {</li><li>    <span class="hljs-keyword">let</span> resultInfo = interactiveLiveness.<span class="hljs-title function_">getInteractiveLivenessResult</span>();</li><li>    resultInfo.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span> = data;</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span> = {</li><li>        <span class="hljs-string">"code"</span>: err.<span class="hljs-property">code</span>,</li><li>        <span class="hljs-string">"message"</span>: err.<span class="hljs-property">message</span></li><li>      }</li><li>    })</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">'this api is not supported on this device'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>       <p></p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="section22701210512">开发实例<i class="anchor-icon anchor-icon-link" anchorid="section22701210512" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="section1747357173112" class="firsth2">Index.ets<i class="anchor-icon anchor-icon-link" anchorid="section1747357173112" tips="复制节点链接"></i></h3>          <div _ngcontent-jcb-c106="" class="highlight-div"><div _ngcontent-jcb-c106="" class="highlight-div-header"><div _ngcontent-jcb-c106="" class="highlight-div-header-left"><div _ngcontent-jcb-c106="" class="handle-button expand-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jcb-c106="" class="highlight-div-header-right"><div _ngcontent-jcb-c106="" class="handle-button ai-button"></div><div _ngcontent-jcb-c106="" class="handle-button line-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jcb-c106="" class="handle-button theme-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jcb-c106="" class="handle-button copy-button"><div _ngcontent-jcb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jcb-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common, abilityAccessCtrl, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { interactiveLiveness } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.VisionKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">LivenessCollectionIndex</span>{</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">array</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">Permissions</span>&gt; = [<span class="hljs-string">"ohos.permission.CAMERA"</span>];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">actionsNum</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isSilentMode</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"INTERACTIVE_MODE"</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">routeMode</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"replace"</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">resultInfo</span>: interactiveLiveness.<span class="hljs-property">InteractiveLivenessResult</span> = {</li><li>    <span class="hljs-attr">livenessType</span>: <span class="hljs-number">0</span></li><li>  };</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">failResult</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>&gt; = {</li><li>    <span class="hljs-string">"code"</span>: <span class="hljs-number">1008302000</span>,</li><li>    <span class="hljs-string">"message"</span>: <span class="hljs-string">""</span></li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Stack</span>({</li><li>      <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Top</span></li><li>    }) {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"验证完的跳转模式："</span>)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>              .<span class="hljs-title function_">width</span>(<span class="hljs-string">"25%"</span>)</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">"replace"</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">"routeMode"</span> }).<span class="hljs-title function_">checked</span>(<span class="hljs-literal">true</span>)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>                  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> = <span class="hljs-string">"replace"</span></li><li>                  })</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"replace"</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              }</li><li>              .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">15</span> })</li><li>
</li><li>              <span class="hljs-title class_">Row</span>() {</li><li>                <span class="hljs-title class_">Radio</span>({ <span class="hljs-attr">value</span>: <span class="hljs-string">"back"</span>, <span class="hljs-attr">group</span>: <span class="hljs-string">"routeMode"</span> }).<span class="hljs-title function_">checked</span>(<span class="hljs-literal">false</span>)</li><li>                  .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>                  .<span class="hljs-title function_">width</span>(<span class="hljs-number">24</span>)</li><li>                  .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> = <span class="hljs-string">"back"</span>;</li><li>                  })</li><li>                <span class="hljs-title class_">Text</span>(<span class="hljs-string">"back"</span>)</li><li>                  .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>              }</li><li>            }</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">"75%"</span>)</li><li>          }</li><li>        }</li><li>        .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">30</span> })</li><li>
</li><li>          <span class="hljs-title class_">Row</span>() {</li><li>            <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Row</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Start</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>              <span class="hljs-title class_">Text</span>(<span class="hljs-string">"动作数量："</span>)</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">"25%"</span>)</li><li>              <span class="hljs-title class_">TextInput</span>({</li><li>                <span class="hljs-attr">placeholder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span> != <span class="hljs-number">0</span> ? <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span>.<span class="hljs-title function_">toString</span>() : <span class="hljs-string">"动作数量为3或4个"</span></li><li>              })</li><li>                .<span class="hljs-title function_">type</span>(<span class="hljs-title class_">InputType</span>.<span class="hljs-property">Number</span>)</li><li>                .<span class="hljs-title function_">placeholderFont</span>({</li><li>                  <span class="hljs-attr">size</span>: <span class="hljs-number">18</span>,</li><li>                  <span class="hljs-attr">weight</span>: <span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Normal</span>,</li><li>                  <span class="hljs-attr">family</span>: <span class="hljs-string">"HarmonyHeiTi"</span>,</li><li>                  <span class="hljs-attr">style</span>: <span class="hljs-title class_">FontStyle</span>.<span class="hljs-property">Normal</span></li><li>                })</li><li>                .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>                .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>                .<span class="hljs-title function_">fontFamily</span>(<span class="hljs-string">"HarmonyHeiTi"</span>)</li><li>                .<span class="hljs-title function_">fontStyle</span>(<span class="hljs-title class_">FontStyle</span>.<span class="hljs-property">Normal</span>)</li><li>                .<span class="hljs-title function_">width</span>(<span class="hljs-string">"65%"</span>)</li><li>                .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span> = <span class="hljs-title class_">Number</span>(value) <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">ActionsNumber</span>;</li><li>                })</li><li>            }</li><li>          }</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">left</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">80</span> })</li><li>      .<span class="hljs-title function_">zIndex</span>(<span class="hljs-number">1</span>)</li><li>
</li><li>      <span class="hljs-title class_">Stack</span>({</li><li>        <span class="hljs-attr">alignContent</span>: <span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span></li><li>      }) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span>?.<span class="hljs-property">mPixelMap</span>) {</li><li>          <span class="hljs-title class_">Image</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span>?.<span class="hljs-property">mPixelMap</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">260</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">260</span>)</li><li>            .<span class="hljs-title function_">align</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">260</span> })</li><li>          <span class="hljs-title class_">Circle</span>()</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>            .<span class="hljs-title function_">fillOpacity</span>(<span class="hljs-number">0</span>)</li><li>            .<span class="hljs-title function_">strokeWidth</span>(<span class="hljs-number">60</span>)</li><li>            .<span class="hljs-title function_">stroke</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">250</span>, <span class="hljs-attr">left</span>: <span class="hljs-number">0</span> })</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span>.<span class="hljs-property">mPixelMap</span> ?</li><li>          <span class="hljs-string">"检测成功"</span> :</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span>.<span class="hljs-property">code</span> != <span class="hljs-number">1008302000</span> ?</li><li>            <span class="hljs-string">"检测失败"</span> :</li><li>            <span class="hljs-string">""</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">26</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">"#000000"</span>)</li><li>          .<span class="hljs-title function_">fontFamily</span>(<span class="hljs-string">"HarmonyHeiTi"</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">50</span> })</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-string">"Medium"</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">240</span> })</li><li>
</li><li>        <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span>.<span class="hljs-property">code</span> != <span class="hljs-number">1008302000</span>) {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span>.<span class="hljs-property">message</span> <span class="hljs-keyword">as</span> <span class="hljs-built_in">string</span>)</li><li>            .<span class="hljs-title function_">width</span>(<span class="hljs-string">"100%"</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">26</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>            .<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Gray</span>)</li><li>            .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>            .<span class="hljs-title function_">fontFamily</span>(<span class="hljs-string">"HarmonyHeiTi"</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-string">"Medium"</span>)</li><li>            .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">200</span> })</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"开始检测"</span>, { <span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Normal</span>, <span class="hljs-attr">stateEffect</span>: <span class="hljs-literal">true</span> })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-number">192</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0x317aff</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">margin</span>({</li><li>            <span class="hljs-attr">bottom</span>: <span class="hljs-number">56</span></li><li>          })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">startDetection</span>();</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">"100%"</span>)</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onPageShow</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">resultRelease</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getDetectionResultInfo</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 跳转到人脸活体检测控件</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">routerLibrary</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">routerOptions</span>: interactiveLiveness.<span class="hljs-property">InteractiveLivenessConfig</span> = {</li><li>      <span class="hljs-attr">isSilentMode</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">isSilentMode</span> <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">DetectionMode</span>,</li><li>      <span class="hljs-attr">routeMode</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">routeMode</span> <span class="hljs-keyword">as</span> interactiveLiveness.<span class="hljs-property">RouteRedirectionMode</span>,</li><li>      <span class="hljs-attr">actionsNum</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">actionsNum</span></li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.AI.Component.LivenessDetect"</span>)) {</li><li>      interactiveLiveness.<span class="hljs-title function_">startLivenessDetection</span>(routerOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">DetectState: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Succeeded in jumping.`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Failed to jump. Code：<span class="hljs-subst">${err.code}</span>，message：<span class="hljs-subst">${err.message}</span>`</span>);</li><li>      })</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">'this api is not supported on this device'</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 校验CAMERA权限</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">startDetection</span>(<span class="hljs-params"></span>) {</li><li>    abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>().<span class="hljs-title function_">requestPermissionsFromUser</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">array</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">res</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; res.<span class="hljs-property">permissions</span>.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-keyword">if</span> (res.<span class="hljs-property">permissions</span>[i] === <span class="hljs-string">"ohos.permission.CAMERA"</span> &amp;&amp; res.<span class="hljs-property">authResults</span>[i] === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">routerLibrary</span>();</li><li>      }</li><li>     }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">`Failed to request permissions from user. Code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    })</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 获取验证结果</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">getDetectionResultInfo</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// getInteractiveLivenessResult接口调用完会释放资源</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">canIUse</span>(<span class="hljs-string">"SystemCapability.AI.Component.LivenessDetect"</span>)) {</li><li>      interactiveLiveness.<span class="hljs-title function_">getInteractiveLivenessResult</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span> = data;</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span> = {</li><li>          <span class="hljs-string">"code"</span>: err.<span class="hljs-property">code</span>,</li><li>          <span class="hljs-string">"message"</span>: err.<span class="hljs-property">message</span></li><li>        }</li><li>      })</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0001</span>, <span class="hljs-string">"LivenessCollectionIndex"</span>, <span class="hljs-string">'this api is not supported on this device'</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// result release</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">resultRelease</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultInfo</span> = {</li><li>      <span class="hljs-attr">livenessType</span>: <span class="hljs-number">0</span></li><li>    }</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">failResult</span> = {</li><li>      <span class="hljs-string">"code"</span>: <span class="hljs-number">1008302000</span>,</li><li>      <span class="hljs-string">"message"</span>: <span class="hljs-string">""</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>