<h1 _ngcontent-otj-c119="" class="doc-title ng-star-inserted" title="优先响应系统功能键开发指导"> 优先响应系统功能键开发指导 </h1>

<div _ngcontent-otj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>每个系统功能键均具有默认功能，由系统固定实现，比如音量键是用来调节设备音量，但是部分应用在特定场景下期望定制这部分按键的功能，本篇指导用于支撑这部分应用的诉求达成。</p>     <p>常见使用场景：阅读类型应用期望通过音量键翻页，相机应用期望通过音量键拍照等应用响应系统功能键做其他业务的场景。</p>     <p>支持功能键列表：从API version 16开始支持音量加按键和音量减按键。从API version 21开始支持多媒体播放/暂停、多媒体下一首和多媒体上一首按键。</p>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>应用只有处于焦点时，优先响应才生效。</li>      <li>应用选择高于系统优先响应指定的系统功能键后，功能键的默认行为将失效，所以应用需要确保只有在确定响应时才激活该功能。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>按键按下事件常用接口如下表所示，接口详细介绍请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputconsumer" target="_blank">ohos.multimodalInput.inputConsumer文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">on(type: "keyPressed", options: KeyPressedConfig, callback: Callback&lt;KeyEvent&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">订阅指定按键按下事件，拦截系统默认响应。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">off(type: "keyPressed", callback?: Callback&lt;KeyEvent&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">取消按键事件订阅，恢复系统默认响应。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>应用开启时调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputconsumer#inputconsumeronkeypressed16" target="_blank">on</a>方法订阅按键按下事件，应用关闭时再用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputconsumer#inputconsumeroffkeypressed16" target="_blank">off</a>方法取消订阅按键按下事件。</p>    </div>    <div class="tiledSection">     <h3 id="音量键翻页和应用内拍照" class="firsth2">音量键翻页和应用内拍照<i class="anchor-icon anchor-icon-link" anchorid="音量键翻页和应用内拍照" tips="复制节点链接"></i></h3>          <p>在电子书或新闻阅读应用中，用户希望通过音量键控制翻页（例如：音量加键向下翻页，音量减键向上翻页）；在相机或扫码类应用中，用户按音量键可直接拍照，而不跳转系统相机应用。</p>     <div _ngcontent-otj-c106="" class="highlight-div"><div _ngcontent-otj-c106="" class="highlight-div-header"><div _ngcontent-otj-c106="" class="highlight-div-header-left"><div _ngcontent-otj-c106="" class="handle-button expand-button"><div _ngcontent-otj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-otj-c106="" class="highlight-div-header-right"><div _ngcontent-otj-c106="" class="handle-button ai-button"></div><div _ngcontent-otj-c106="" class="handle-button line-button"><div _ngcontent-otj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-otj-c106="" class="handle-button theme-button"><div _ngcontent-otj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-otj-c106="" class="handle-button copy-button"><div _ngcontent-otj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-otj-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inputConsumer, <span class="hljs-title class_">KeyEvent</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.InputKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">KeyCode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.InputKit'</span>;</li><li>
</li><li>@<span class="hljs-title class_">Entry</span></li><li>@<span class="hljs-title class_">Component</span></li><li>struct <span class="hljs-title class_">TestDemo14</span> {</li><li>  private <span class="hljs-attr">volumeUpCallBackFunc</span>: <span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> <span class="hljs-keyword">void</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  }</li><li>  private <span class="hljs-attr">volumeDownCallBackFunc</span>: <span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> <span class="hljs-keyword">void</span> = <span class="hljs-function">() =&gt;</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-keyword">void</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">options1</span>: inputConsumer.<span class="hljs-property">KeyPressedConfig</span> = {</li><li>        <span class="hljs-attr">key</span>: <span class="hljs-title class_">KeyCode</span>.<span class="hljs-property">KEYCODE_VOLUME_UP</span>,</li><li>        <span class="hljs-attr">action</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 按下按键的行为</span></li><li>        <span class="hljs-attr">isRepeat</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 优先消费掉按键事件，不上报</span></li><li>      }</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">options2</span>: inputConsumer.<span class="hljs-property">KeyPressedConfig</span> = {</li><li>        <span class="hljs-attr">key</span>: <span class="hljs-title class_">KeyCode</span>.<span class="hljs-property">KEYCODE_VOLUME_DOWN</span>,</li><li>        <span class="hljs-attr">action</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 按下按键的行为</span></li><li>        <span class="hljs-attr">isRepeat</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 优先消费掉按键事件，不上报</span></li><li>      }</li><li>
</li><li>      <span class="hljs-comment">// 点击了音量按键上事件回调</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeUpCallBackFunc</span> = <span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'点击了音量按键上'</span> })</li><li>        <span class="hljs-comment">// do something</span></li><li>      }</li><li>
</li><li>      <span class="hljs-comment">// 点击了音量按键下事件回调</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeDownCallBackFunc</span> = <span class="hljs-function">(<span class="hljs-params">event: KeyEvent</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'点击了音量按键下'</span> })</li><li>        <span class="hljs-comment">// do something</span></li><li>      }</li><li>      <span class="hljs-comment">// 注册监听事件</span></li><li>      inputConsumer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyPressed'</span>, options1, <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeUpCallBackFunc</span>);</li><li>      inputConsumer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'keyPressed'</span>, options2, <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeDownCallBackFunc</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Subscribe execute failed, error: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error, [<span class="hljs-string">"code"</span>, <span class="hljs-string">"message"</span>])}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'取消监听音量按键上的监听'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-comment">// 取消指定回调函数</span></li><li>              inputConsumer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'keyPressed'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeUpCallBackFunc</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'取消监听音量按键上的监听事件成功！'</span> })</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Unsubscribe execute failed, error: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error, [<span class="hljs-string">"code"</span>, <span class="hljs-string">"message"</span>])}</span>`</span>);</li><li>            }</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">50</span> })</li><li>
</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'取消监听音量按键下的监听'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-comment">// 取消指定回调函数</span></li><li>              inputConsumer.<span class="hljs-title function_">off</span>(<span class="hljs-string">'keyPressed'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">volumeDownCallBackFunc</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getPromptAction</span>().<span class="hljs-title function_">showToast</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'取消监听音量按键下的监听事件成功！'</span> })</li><li>            } <span class="hljs-keyword">catch</span> (error) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Unsubscribe execute failed, error: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error, [<span class="hljs-string">"code"</span>, <span class="hljs-string">"message"</span>])}</span>`</span>);</li><li>            }</li><li>          })</li><li>      }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">50</span> })</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'已默认添加监听音量按键上和下的监听'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    }.<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>