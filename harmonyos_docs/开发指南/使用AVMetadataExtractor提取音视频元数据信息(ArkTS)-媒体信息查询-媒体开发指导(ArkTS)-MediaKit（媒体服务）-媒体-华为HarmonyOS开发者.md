<h1 _ngcontent-cyx-c119="" class="doc-title ng-star-inserted" title="使用AVMetadataExtractor提取音视频元数据信息(ArkTS)"> 使用AVMetadataExtractor提取音视频元数据信息(ArkTS) </h1>

<div _ngcontent-cyx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#avmetadataextractor">AVMetadataExtractor</a>可以实现从原始媒体资源中获取元数据。本指南将以获取一个媒体资源的元数据作为示例，向开发者讲解AVMetadataExtractor元数据相关功能。</p>    <p>获取音视频资源的元数据的全流程包含：创建AVMetadataExtractor、设置资源、获取元数据、获取音频资源的专辑封面或获取视频缩略图、销毁资源。</p>    <div class="tiledSection">     <h2 id="开发步骤及注意事项">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avmetadataextractor" target="_blank">AVMetadataExtractor API参考</a>。</p>     <ol>      <li>       <p>使用createAVMetadataExtractor()创建实例。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li><span class="hljs-comment">// 创建AVMetadataExtractor对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">avMetadataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li></ol></pre></div></div></li>      <li>       <p>设置资源：用户可以根据需要选择设置属性fdSrc（表示文件描述符）和属性dataSrc（表示dataSource描述符）或者调用setUrlSource设置在线媒体链接。</p>       <p>开发者需根据实际情况，确认资源有效性并设置（只能设置其中一种）：</p>       <ul>        <li>         <p>如果设置fdSrc，可以使用ResourceManager.getRawFd打开HAP资源文件描述符，使用方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getrawfd9" target="_blank">ResourceManager API参考</a>。也可以通过应用沙箱路径访问对应资源（必须确保资源可用），参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a>。应用沙箱的介绍及如何向应用沙箱推送文件，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory">文件管理</a>。</p>         <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建AVMetadataExtractor对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">avMetadataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li><li><span class="hljs-comment">// 获取rawfile目录下资源文件描述符，设置fdSrc属性。</span></li><li><span class="hljs-comment">// 获取当前组件所在Ability的Context，并通过Context获取应用文件路径。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-comment">// 设置fdSrc，test.mp3为rawfile目录下的预置资源，需要开发者根据实际情况进行替换。</span></li><li>avMetadataExtractor.<span class="hljs-property">fdSrc</span> = <span class="hljs-keyword">await</span> context.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFd</span>(<span class="hljs-string">'test.mp3'</span>);</li></ol></pre></div></div></li>        <li>         <p>如果设置dataSrc，必须正确设置dataSrc中的callback属性，确保callback被调用时能正确读取到对应资源，使用应用沙箱路径访问对应资源，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a>。应用沙箱的介绍及如何向应用沙箱推送文件，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory">文件管理</a>。</p>         <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs, <span class="hljs-title class_">ReadOptions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'MetadataDemo'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建AVMetadataExtractor对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">avMetadataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rootPath</span>: <span class="hljs-built_in">string</span> = context.<span class="hljs-property">filesDir</span>; <span class="hljs-comment">// 应用文件目录。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">testFilename</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'/test.mp3'</span>; <span class="hljs-comment">// test.mp3为应用文件目录下的预置资源，需要开发者根据实际情况进行替换。</span></li><li><span class="hljs-comment">// 使用fs文件系统打开沙箱地址获取媒体文件地址，设置dataSrc属性。</span></li><li><span class="hljs-comment">// 通过UIAbilityContext获取沙箱地址filesDir（以Stage模型为例）。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">fd</span>: <span class="hljs-built_in">number</span> = fs.<span class="hljs-title function_">openSync</span>(rootPath + testFilename).<span class="hljs-property">fd</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">fileSize</span>: <span class="hljs-built_in">number</span> = fs.<span class="hljs-title function_">statSync</span>(rootPath + testFilename).<span class="hljs-property">size</span>;</li><li><span class="hljs-comment">// 设置dataSrc描述符，通过callback从文件中获取资源，写入buffer中。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">dataSrc</span>: media.<span class="hljs-property">AVDataSrcDescriptor</span> = {</li><li>  <span class="hljs-attr">fileSize</span>: fileSize,</li><li>  <span class="hljs-attr">callback</span>: <span class="hljs-function">(<span class="hljs-params">buffer, len, pos</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (buffer == <span class="hljs-literal">undefined</span> || len == <span class="hljs-literal">undefined</span> || pos == <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`dataSrc callback param invalid`</span>);</li><li>      <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">ReadOptions</span> = {</li><li>      <span class="hljs-attr">offset</span>: pos,</li><li>      <span class="hljs-attr">length</span>: len</li><li>    };</li><li>    <span class="hljs-keyword">let</span> num = fs.<span class="hljs-title function_">readSync</span>(fd, buffer, options);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'readAt end, num: '</span> + num);</li><li>    <span class="hljs-keyword">if</span> (num &gt; <span class="hljs-number">0</span> &amp;&amp; fileSize &gt;= pos) {</li><li>      <span class="hljs-keyword">return</span> num;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;</li><li>  }</li><li>};</li><li><span class="hljs-comment">// 设置dataSrc。</span></li><li>avMetadataExtractor.<span class="hljs-property">dataSrc</span> = dataSrc;</li></ol></pre></div></div></li>        <li>         <p>如果设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avmetadataextractor#seturlsource20" target="_blank">setUrlSource</a>，必须正确设置setUrlSource中的url和headers属性，确保正确访问url。</p>         <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建AVMetadataExtractor对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">avMetadataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li><li><span class="hljs-comment">// 调用setUrlSource设置网络点播媒体资源URL，用来获取在线音视频元数据和在线视频缩略图。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'http://xx.mp4'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">headers</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>&gt; = {</li><li>  <span class="hljs-string">"User-Agent"</span> : <span class="hljs-string">"User-Agent-Value"</span></li><li>};</li><li>avMetadataExtractor.<span class="hljs-title function_">setUrlSource</span>(url, headers);</li></ol></pre></div></div></li>        <li>         <p>不同AVMetadataExtractor或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avimagegenerator" target="_blank">AVImageGenerator</a>实例，如果需要操作同一资源，需要多次打开文件描述符，不要共用同一文件描述符。</p>         <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建AVMetadataExtractor对象。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">avMetadataExtractor</span>: media.<span class="hljs-property">AVMetadataExtractor</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVMetadataExtractor</span>();</li><li><span class="hljs-comment">// 使用fs文件系统打开沙箱地址获取媒体文件地址，设置fdSrc属性。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rootPath</span>: <span class="hljs-built_in">string</span> = context.<span class="hljs-property">filesDir</span>; <span class="hljs-comment">// 应用文件目录。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">testFilename</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'/test.mp3'</span>; <span class="hljs-comment">// test.mp3为应用文件目录下的预置资源，需要开发者根据实际情况进行替换。</span></li><li>avMetadataExtractor.<span class="hljs-property">fdSrc</span> = fs.<span class="hljs-title function_">openSync</span>(rootPath + testFilename); <span class="hljs-comment">// 设置fdSrc属性。</span></li></ol></pre></div></div></li>       </ul></li>      <li>       <p>获取元数据：调用fetchMetadata()，可以获取到一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-i#avmetadata11" target="_blank">AVMetadata</a>对象，通过访问该对象的各个属性，可以获取到元数据。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取元数据（callback模式）。</span></li><li>avMetadataExtractor.<span class="hljs-title function_">fetchMetadata</span>(<span class="hljs-function">(<span class="hljs-params">error, metadata</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`fetchMetadata callback failed, err = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>})</li><li>
</li><li><span class="hljs-comment">// 获取元数据（promise模式）。</span></li><li><span class="hljs-keyword">let</span> metadata = <span class="hljs-keyword">await</span> avMetadataExtractor.<span class="hljs-title function_">fetchMetadata</span>();</li></ol></pre></div></div></li>      <li>       <p>对于视频资源：可以通过fetchMetadata获取的AVMetadata对象metadata拿到视频资源的宽、高等数据。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 获取视频资源的宽和高。</span></li><li><span class="hljs-keyword">let</span> metadata = <span class="hljs-keyword">await</span> avMetadataExtractor.<span class="hljs-title function_">fetchMetadata</span>();</li><li><span class="hljs-keyword">let</span> width = metadata.<span class="hljs-property">videoWidth</span>;</li><li><span class="hljs-keyword">let</span> height = metadata.<span class="hljs-property">videoHeight</span>;</li></ol></pre></div></div></li>      <li>       <p>对于音频资源而言，除了可以通过AVMetadata对象来获取音频资源的标题、时长等元数据外，还可以获取专辑封面（例如，调用fetchAlbumCover()，可以获取到专辑封面）。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-comment">// pixelMap对象声明，用于图片显示。</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-comment">//获取专辑封面（callback模式）。</span></li><li>avMetadataExtractor.<span class="hljs-title function_">fetchAlbumCover</span>(<span class="hljs-function">(<span class="hljs-params">err, pixelMap</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`fetchAlbumCover callback failed, err = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = pixelMap;</li><li>})</li><li>
</li><li><span class="hljs-comment">// 获取专辑封面（promise模式）。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = <span class="hljs-keyword">await</span> avMetadataExtractor.<span class="hljs-title function_">fetchAlbumCover</span>();</li></ol></pre></div></div></li>      <li>       <p>（可选）获取视频缩略图：调用fetchFrameByTime，可以获取到视频缩略图。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-comment">// pixelMap对象声明，用于图片显示。</span></li><li><span class="hljs-meta">@State</span> <span class="hljs-attr">pixelMap</span>: image.<span class="hljs-property">PixelMap</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-comment">// 接口入参声明。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">timeUs</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">queryOption</span>: media.<span class="hljs-property">AVImageQueryOptions</span> = media.<span class="hljs-property">AVImageQueryOptions</span>.<span class="hljs-property">AV_IMAGE_QUERY_PREVIOUS_SYNC</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">param</span>: media.<span class="hljs-property">PixelMapParams</span> = {</li><li>  width : <span class="hljs-number">300</span>,</li><li>  height : <span class="hljs-number">300</span></li><li>}</li><li><span class="hljs-comment">// 获取视频缩略图（promise模式）。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pixelMap</span> = <span class="hljs-keyword">await</span> avMetadataExtractor.<span class="hljs-title function_">fetchFrameByTime</span>(timeUs, queryOption, param);</li></ol></pre></div></div></li>      <li>       <p>释放资源：调用release()销毁实例，释放资源。</p>       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放资源（callback模式）。</span></li><li>avMetadataExtractor.<span class="hljs-title function_">release</span>(<span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`release failed, err = <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(error)}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`release success.`</span>);</li><li>})</li><li>
</li><li><span class="hljs-comment">// 释放资源（promise模式）。</span></li><li>avMetadataExtractor.<span class="hljs-title function_">release</span>();</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="运行示例工程">运行示例工程<i class="anchor-icon anchor-icon-link" anchorid="运行示例工程" tips="复制节点链接"></i></h2>          <p>参考以下示例，获取一个音频的元数据和专辑封面。</p>     <ol>      <li>新建工程，下载<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/Media/AVMetadataExtractor/AVMetadataExtractorArkTS" target="_blank">完整示例工程</a>，并将示例工程的资源复制到对应目录。       <div _ngcontent-cyx-c106="" class="highlight-div"><div _ngcontent-cyx-c106="" class="highlight-div-header"><div _ngcontent-cyx-c106="" class="highlight-div-header-left"><div _ngcontent-cyx-c106="" class="handle-button expand-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cyx-c106="" class="highlight-div-header-right"><div _ngcontent-cyx-c106="" class="handle-button ai-button"></div><div _ngcontent-cyx-c106="" class="handle-button line-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cyx-c106="" class="handle-button theme-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cyx-c106="" class="handle-button copy-button"><div _ngcontent-cyx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cyx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>AVMetadataExtractorArkTS</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/ets/</li><li>└── pages</li><li>    └── Index<span class="hljs-selector-class">.ets</span> (获取元数据界面)</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/resources/</li><li>├── base</li><li>│   ├── element</li><li>│   │   ├── <span class="hljs-attribute">color</span><span class="hljs-selector-class">.json</span></li><li>│   │   ├── <span class="hljs-attribute">float</span><span class="hljs-selector-class">.json</span></li><li>│   │   └── string<span class="hljs-selector-class">.json</span></li><li>│   └── media</li><li>│</li><li>└── rawfile</li><li>    └── test<span class="hljs-selector-class">.mp3</span> (音频资源)</li></ol></pre></div></div></li>      <li>编译新建工程并运行。</li>     </ol>    </div>   </div>   <div></div></div>