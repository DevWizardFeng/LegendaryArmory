<h1 _ngcontent-tub-c119="" class="doc-title ng-star-inserted" title="使用AVPlayer播放音频(ArkTS)"> 使用AVPlayer播放音频(ArkTS) </h1>

<div _ngcontent-tub-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#avplayer">AVPlayer</a>可以实现端到端播放原始媒体资源，本开发指导将以完整地播放一首音乐作为示例，向开发者讲解AVPlayer音频播放相关功能。如需播放PCM音频数据，请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-audiorenderer-for-playback">AudioRenderer</a>。</p>    <p>播放的全流程包含：创建AVPlayer，设置播放资源，设置播放参数（音量/倍速/焦点模式），播放控制（播放/暂停/跳转/停止），重置，销毁资源。</p>    <p>在应用开发的过程中，开发者可以通过AVPlayer的state属性主动获取当前状态，或使用on('stateChange')方法监听状态变化。如果应用在音频播放器处于错误状态时执行操作，系统可能会抛出异常或产生其他未定义的行为。</p>    <p><strong>图1</strong> 播放状态变化示意图</p>    <p><span><img originheight="1010" originwidth="1465" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114444.32035299045445715275930991357107:50001231000000:2800:E47180D146B6AA51412102CCBAE6D088C91598DE5478404D9A0921FEA92E9791.png" width="920" height="634.2662116040956"></span></p>    <p>状态的详细说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-t#avplayerstate9" target="_blank">AVPlayerState</a>。当播放处于prepared / playing / paused / completed状态时，播放引擎处于工作状态，这需要占用系统大量的运行内存。当客户端暂时不使用播放器时，调用reset()或release()回收内存资源，做好资源利用。</p>    <div class="tiledSection">     <h2 id="开发建议">开发建议<i class="anchor-icon anchor-icon-link" anchorid="开发建议" tips="复制节点链接"></i></h2>          <p>当前指导仅介绍如何实现媒体资源播放，在应用开发过程中，涉及后台播放、播放冲突等情况时，请根据实际需要参考以下说明。</p>     <ul>      <li>若要实现后台播放或熄屏播放，需要接入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avsession-access-scene">AVSession（媒体会话）</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/continuous-task">申请长时任务</a>，避免播放被系统强制中断。</li>      <li>应用在播放过程中，若播放的媒体数据涉及音频，根据系统音频管理策略（参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">处理音频焦点事件</a>），可能会被其他应用打断，建议应用主动监听音频打断事件，根据内容提示做出相应处理，避免出现应用状态与预期效果不一致的问题。</li>      <li>面对设备同时连接多个音频输出设备的情况，应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer#onaudiooutputdevicechangewithinfo11" target="_blank">on('audioOutputDeviceChangeWithInfo')</a>监听音频输出设备的变化，做出相应处理。</li>      <li>若要访问在线媒体资源，需要申请 ohos.permission.INTERNET 权限。</li>      <li>若要切换听筒/扬声器，应用可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-output-device-switcher">音频输出设备路由切换</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发步骤及注意事项">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-avplayer" target="_blank">AVPlayer API参考</a>。</p>     <ol>      <li>       <p>创建实例createAVPlayer()，AVPlayer初始化idle状态。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建avPlayer实例对象。</span></li><li><span class="hljs-keyword">let</span> avPlayer = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createAVPlayer</span>();</li></ol></pre></div></div></li>      <li>       <p>设置业务需要的监听事件，搭配全流程场景使用。支持的监听事件包括：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.8.3.2.2.1.3.1.1" valign="top" width="50%">事件类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.8.3.2.2.1.3.1.2" valign="top" width="50%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">stateChange</td>           <td class="cellrowborder" valign="top" width="50%">            <p>必要事件，监听播放器的state属性改变。</p>            <p>需要播放器在idle状态下、未调用设置资源接口前完成设置监听，若在调用设置资源接口后再设置监听，可能导致无法收到资源设置过程中上报的stateChange事件。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">error</td>           <td class="cellrowborder" valign="top" width="50%">            <p>必要事件，监听播放器的错误信息。</p>            <p>需要播放器在idle状态下、未调用设置资源接口前完成设置监听，若在调用设置资源接口后再设置监听，可能导致无法收到资源设置过程中上报的error事件。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">durationUpdate</td>           <td class="cellrowborder" valign="top" width="50%">用于进度条，监听进度条长度，刷新资源时长。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">timeUpdate</td>           <td class="cellrowborder" valign="top" width="50%">用于进度条，监听进度条当前位置，刷新当前时间。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">seekDone</td>           <td class="cellrowborder" valign="top" width="50%">            <p>响应API调用，监听seek()请求完成情况。</p>            <p>当使用seek()跳转到指定播放位置后，如果seek操作成功，将上报该事件。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">speedDone</td>           <td class="cellrowborder" valign="top" width="50%">            <p>响应API调用，监听setSpeed()请求完成情况。</p>            <p>当使用setSpeed()设置播放倍速后，如果setSpeed操作成功，将上报该事件。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">volumeChange</td>           <td class="cellrowborder" valign="top" width="50%">            <p>响应API调用，监听setVolume()请求完成情况。</p>            <p>当使用setVolume()调节播放音量后，如果setVolume操作成功，将上报该事件。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">bufferingUpdate</td>           <td class="cellrowborder" valign="top" width="50%">用于网络播放，监听网络播放缓冲信息，用于上报缓冲百分比以及缓存播放进度。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">audioInterrupt</td>           <td class="cellrowborder" valign="top" width="50%">            <p>监听音频焦点切换信息，搭配属性audioInterruptMode使用。</p>            <p>如果当前设备存在多个音频正在播放，音频焦点被切换（即播放其他媒体如通话等）时将上报该事件，应用可以及时处理。</p></td>          </tr>                 </tbody></table></div>       </div>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 此处仅为示例，开发者根据需要设置合适的监听事件。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stateChange'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">state</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">reason</span>: media.<span class="hljs-property">StateChangeReason</span>) =&gt; {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'durationUpdate'</span>, <span class="hljs-function">(<span class="hljs-params">duration: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'timeUpdate'</span>, <span class="hljs-function">(<span class="hljs-params">time:<span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'seekDone'</span>, <span class="hljs-function">(<span class="hljs-params">seekDoneTime:<span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'speedDone'</span>, <span class="hljs-function">(<span class="hljs-params">speed:<span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'volumeChange'</span>, <span class="hljs-function">(<span class="hljs-params">vol: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'bufferingUpdate'</span>, <span class="hljs-function">(<span class="hljs-params">infoType: media.BufferingInfoType, value: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li><li>avPlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioInterrupt'</span>, <span class="hljs-function">(<span class="hljs-params">info: audio.InterruptEvent</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 开发者根据需要写入业务逻辑。</span></li><li>});</li></ol></pre></div></div></li>      <li>       <p>设置资源：设置属性url，AVPlayer进入initialized状态。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>下面代码示例中的url仅作示意使用，开发者需根据实际情况，确认资源有效性并设置：</p>         <ul>          <li>           <p>如果使用本地资源播放，必须确认资源文件可用，并使用应用沙箱路径访问对应资源，参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a>。应用沙箱的介绍及如何向应用沙箱推送文件，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory">文件管理</a>。</p></li>          <li>           <p>如果使用网络播放路径，需<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions">声明权限</a>：ohos.permission.INTERNET。</p></li>          <li>           <p>如果使用ResourceManager.getRawFd打开HAP资源文件描述符，使用方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getrawfd9" target="_blank">ResourceManager API参考</a>。</p></li>          <li>           <p>需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#支持的格式与协议">支持的播放格式与协议</a>。</p></li>         </ul>        </div></div></div>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> url = <span class="hljs-string">'https://xxx.xxx.xxx.mp3'</span>;</li><li><span class="hljs-keyword">if</span> (avPlayer == <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>avPlayer.<span class="hljs-property">url</span> = url;</li></ol></pre></div></div></li>      <li>       <p>（可选）设置音频渲染：只允许在initialized状态下，第一次调用prepare()之前设置，以便音频渲染器信息在之后生效。若媒体源包含视频，则usage默认值为STREAM_USAGE_MOVIE，否则usage默认值为STREAM_USAGE_MUSIC。rendererFlags默认值为0。</p>       <p>为了确保音频行为符合使用预期，建议根据具体业务场景和实际需求，主动配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#audiorendererinfo8" target="_blank">audio.AudioRendererInfo</a>，为音频选择恰当的流类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-right-streamusage-and-sourcetype">usage</a>。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>avPlayer.<span class="hljs-property">audioRendererInfo</span> = {</li><li>    <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MOVIE</span>,</li><li>    <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>准备播放：调用 prepare()方法进入准备播放阶段，AVPlayer 将切换至 prepared 状态，此时可获取视频时长（duration）并调整音量参数。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>avPlayer.<span class="hljs-title function_">prepare</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to prepare,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in preparing'</span>);</li><li>    }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>音频播控：播放play()、暂停pause()、跳转seek()、停止stop() 等操作。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 播放操作。</span></li><li>avPlayer.<span class="hljs-title function_">play</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in playing'</span>);</li><li>}, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to play,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>});</li><li><span class="hljs-comment">// 暂停操作。</span></li><li>avPlayer.<span class="hljs-title function_">pause</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to pause,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in pausing'</span>);</li><li>    }</li><li>});</li><li><span class="hljs-comment">// 跳转操作。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">seekTime</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1000</span>;</li><li>avPlayer.<span class="hljs-title function_">seek</span>(seekTime, media.<span class="hljs-property">SeekMode</span>.<span class="hljs-property">SEEK_PREV_SYNC</span>);</li><li><span class="hljs-comment">// 停止操作。</span></li><li>avPlayer.<span class="hljs-title function_">stop</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to stop,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in stopping'</span>);</li><li>    }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>（可选）更换资源：调用reset()方法重置播放资源，AVPlayer重新进入idle状态，此时可重新设置资源url。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>avPlayer.<span class="hljs-title function_">reset</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    avPlayer.<span class="hljs-property">url</span> = url;</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to reset,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in resetting'</span>);</li><li>    }</li><li>});</li><li><span class="hljs-comment">// 更换url。</span></li><li><span class="hljs-keyword">let</span> url = <span class="hljs-string">'https://xxx.xxx.xxx.mp3'</span>;</li><li><span class="hljs-keyword">if</span> (avPlayer == <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>}</li><li>avPlayer.<span class="hljs-property">url</span> = url;</li></ol></pre></div></div></li>      <li>       <p>退出播放：调用release()销毁实例，AVPlayer进入released状态，退出播放。</p>       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>avPlayer.<span class="hljs-title function_">release</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to release,error message is :'</span> + err.<span class="hljs-property">message</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in releasing'</span>);</li><li>    }</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="运行完整示例">运行完整示例<i class="anchor-icon anchor-icon-link" anchorid="运行完整示例" tips="复制节点链接"></i></h2>          <p>参考以下示例，完整地播放一首音乐，实现起播后3s暂停，暂停3s重新播放的效果。</p>     <ol>      <li>新建工程，下载<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/Media/AVPlayer/AVPlayerArkTSAudio" target="_blank">示例工程</a>，并将示例工程的以下资源复制到对应目录。       <div _ngcontent-tub-c106="" class="highlight-div"><div _ngcontent-tub-c106="" class="highlight-div-header"><div _ngcontent-tub-c106="" class="highlight-div-header-left"><div _ngcontent-tub-c106="" class="handle-button expand-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-tub-c106="" class="highlight-div-header-right"><div _ngcontent-tub-c106="" class="handle-button ai-button"></div><div _ngcontent-tub-c106="" class="handle-button line-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-tub-c106="" class="handle-button theme-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-tub-c106="" class="handle-button copy-button"><div _ngcontent-tub-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-tub-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>AVPlayerArkTSAudio</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/ets/</li><li>└── pages</li><li>    └── Index<span class="hljs-selector-class">.ets</span> (播放界面)</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/resources/</li><li>├── base</li><li>│   ├── element</li><li>│   │   ├── <span class="hljs-attribute">color</span><span class="hljs-selector-class">.json</span></li><li>│   │   ├── <span class="hljs-attribute">float</span><span class="hljs-selector-class">.json</span></li><li>│   │   └── string<span class="hljs-selector-class">.json</span></li><li>│   └── media</li><li>│       ├── ic_video_play<span class="hljs-selector-class">.svg</span>  (播放键图片资源)</li><li>│       └── ic_video_pause<span class="hljs-selector-class">.svg</span> (暂停键图片资源)</li><li>└── rawfile</li><li>    └── test_01<span class="hljs-selector-class">.mp3</span> （音频资源）</li></ol></pre></div></div></li>      <li>编译新建工程并运行。</li>     </ol>    </div>   </div>   <div></div></div>