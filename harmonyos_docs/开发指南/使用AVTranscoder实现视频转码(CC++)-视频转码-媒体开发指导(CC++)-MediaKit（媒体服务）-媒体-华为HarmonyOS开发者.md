<h1 _ngcontent-ojh-c119="" class="doc-title ng-star-inserted" title="使用AVTranscoder实现视频转码(C/C++)"> 使用AVTranscoder实现视频转码(C/C++) </h1>

<div _ngcontent-ojh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 20开始支持使用NDK接口（C/C++）实现视频转码。</p>    <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#avtranscoder">AVTranscoder</a>可以实现视频转码功能，从API 12开始，转码功能可在手机、平板、2in1设备上作为系统提供的基础能力使用。可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/init#caniuse" target="_blank">canIUse</a>接口来判断当前设备是否支持AVTranscoder。当canIUse("SystemCapability.Multimedia.Media.AVTranscoder")返回值为true时，表示可以使用转码能力。</p>    <p>本开发指导将以“开始转码-暂停转码-恢复转码-完成转码”的一次完整流程为示例，向开发者讲解AVTranscoder视频转码相关功能。</p>    <p><strong>图1</strong> 转码状态变化示意图</p>    <p><span><img originheight="467" originwidth="837" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114445.04205118246169970747432964629322:50001231000000:2800:1DFE30CCCA84A0F1C4A2F84C59EF3B81E9BBDE557443D320FF72E81CAFD00774.png" width="837" height="467"></span></p>    <p>状态的详细说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avtranscoder-base-h#oh_avtranscoder_state" target="_blank">OH_AVTranscoder_State</a>。</p>    <div class="tiledSection">     <h2 id="开发步骤及注意事项">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h2>          <p>在CMake脚本中链接动态库。</p>     <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libavtranscoder.so libace_napi.z.so)</li></ol></pre></div></div>     <p>开发者使用系统日志能力时，需引入如下头文件：</p>     <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div>     <p>并需要在CMake脚本中链接如下动态库:</p>     <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libhilog_ndk.z.so)</li></ol></pre></div></div>     <p>开发者通过引入avtranscoder.h和avtranscoder_base.h头文件，使用转码相关API。</p>     <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avtranscoder" target="_blank">AVTranscoder</a>。</p>     <ol>      <li>       <p>创建转码实例：调用OH_AVTranscoder_Create()。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_AVTranscoder *transcoder = OH_AVTranscoder_Create();</li></ol></pre></div></div></li>      <li>       <p>设置回调事件函数：使用OH_AVTranscoder_SetStateCallback()、OH_AVTranscoder_SetErrorCallback()和OH_AVTranscoder_SetProgressUpdateCallback()接口设置回调转码状态、转码错误事件和转码进度更新回调函数，搭配全流程场景使用。支持的回调事件包括：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.7.10.2.2.1.3.1.1" valign="top" width="50%">事件类型</th>           <th align="left" class="cellrowborder" id="mcps1.3.7.10.2.2.1.3.1.2" valign="top" width="50%">说明</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">OH_AVTranscoder_OnStateChange</td>           <td class="cellrowborder" valign="top" width="50%">可选事件，回调转码过程中状态。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">OH_AVTranscoder_OnError</td>           <td class="cellrowborder" valign="top" width="50%">可选事件，回调转码错误事件。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">OH_AVTranscoder_OnProgressUpdate</td>           <td class="cellrowborder" valign="top" width="50%">可选事件，回调转码进度更新事件。</td>          </tr>                 </tbody></table></div>       </div>       <p>应用使用OH_AVTranscoder_SetStateCallback()、OH_AVTranscoder_SetErrorCallback()和OH_AVTranscoder_SetProgressUpdateCallback()接口设置回调转码状态、转码错误事件和转码进度更新回调函数，可以获取更多信息，还可以通过设置userData自定义数据。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">typedef</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">NdkAVTransCoderUser</span> {</li><li>   <span class="hljs-variable">using</span> <span class="hljs-variable">StateChangeFunc</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">function</span>&lt;<span class="hljs-title class_">void</span>()&gt;;</li><li>   <span class="hljs-title function_">NdkAVTransCoderUser</span>();</li><li>   <span class="hljs-title function_">NdkAVTransCoderUser</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">NdkAVTransCoderUser</span> &amp;<span class="hljs-title class_">other</span>) = <span class="hljs-variable">delete</span>;</li><li>   <span class="hljs-variable">NdkAVTransCoderUser</span> &amp;<span class="hljs-keyword">operator</span>=(<span class="hljs-keyword">const</span> <span class="hljs-variable">NdkAVTransCoderUser</span> &amp;<span class="hljs-title class_">other</span>) = <span class="hljs-variable">delete</span>;</li><li>   ~<span class="hljs-title function_">NdkAVTransCoderUser</span>();</li><li>
</li><li>   <span class="hljs-variable">void</span> <span class="hljs-title function_">OnStateChangeCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">OH_AVTranscoder_State</span> <span class="hljs-variable">state</span>);</li><li>   <span class="hljs-variable">void</span> <span class="hljs-title function_">OnErrorCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">int32_t</span> <span class="hljs-variable">errorCode</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">char</span>  *<span class="hljs-variable">errorMsg</span>);</li><li>   <span class="hljs-variable">void</span> <span class="hljs-title function_">OnProgressUpdateCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">int</span> <span class="hljs-variable">progress</span>);</li><li>   <span class="hljs-variable">std</span>::<span class="hljs-title class_">map</span>&lt;<span class="hljs-title class_">uint32_t</span>, <span class="hljs-title class_">StateChangeFunc</span>&gt; <span class="hljs-title class_">stateChangeFuncs_</span>;</li><li>
</li><li>   <span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span> = <span class="hljs-variable">nullptr</span>;</li><li>   <span class="hljs-variable">int32_t</span> <span class="hljs-variable">errorCode</span> = <span class="hljs-variable">AV_ERR_OK</span>;</li><li>   <span class="hljs-variable">OH_AVTranscoder_State</span> <span class="hljs-variable">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_PREPARED</span>;</li><li>   <span class="hljs-variable">int</span> <span class="hljs-variable">avTranscoderProgress</span> = <span class="hljs-number">0</span>;</li><li>   <span class="hljs-variable">int</span> <span class="hljs-variable">inStartStateCount</span> = <span class="hljs-number">0</span>;</li><li>} <span class="hljs-variable">NdkAVTransCoderUser</span>;</li><li>
</li><li><span class="hljs-variable">void</span> <span class="hljs-variable">NdkAVTransCoderUser</span>::<span class="hljs-title class_">OnProgressUpdateCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> <span class="hljs-variable">*transcoder</span>, <span class="hljs-title class_">int</span>  <span class="hljs-title class_">progress</span>)</li><li>{</li><li>   <span class="hljs-title function_">LOG</span>(<span class="hljs-string">"NdkAVTransCoderUser OnProgressUpdateCb progress: %{public}d"</span>, <span class="hljs-variable">progress</span>);</li><li>   <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">avTranscoderProgress</span> = <span class="hljs-variable">progress</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">void</span> <span class="hljs-variable">NdkAVTransCoderUser</span>::<span class="hljs-title class_">OnErrorCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> <span class="hljs-variable">*transcoder</span>, <span class="hljs-title class_">int32_t</span>  <span class="hljs-title class_">errorCode</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">char</span> <span class="hljs-variable">*errorMsg</span>)</li><li>{</li><li>   <span class="hljs-title function_">LOG</span>(<span class="hljs-string">"NdkAVTransCoderUser OnErrorCb errorCode: %{public}d ,errorMsg: %{public} s"</span>, <span class="hljs-variable">errorCode</span>,</li><li>      <span class="hljs-variable">errorMsg</span> == <span class="hljs-variable">nullptr</span> ? <span class="hljs-string">"unknown"</span> : <span class="hljs-title class_">errorMsg</span>);</li><li>   <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-variable">errorCode</span>;</li><li>}</li><li>
</li><li><span class="hljs-variable">void</span> <span class="hljs-variable">NdkAVTransCoderUser</span>::<span class="hljs-title class_">OnStateChangeCb</span>(<span class="hljs-variable">OH_AVTranscoder</span> <span class="hljs-variable">*transcoder</span>,  <span class="hljs-title class_">OH_AVTranscoder_State</span> <span class="hljs-title class_">state</span>)</li><li>{</li><li>   <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">state</span>;</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">transcoder</span> == <span class="hljs-variable">nullptr</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-variable">int32_t</span> <span class="hljs-variable">ret</span> = -<span class="hljs-number">1</span>;</li><li>   <span class="hljs-variable">switch</span> (<span class="hljs-variable">state</span>) {</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-variable">AVTRANSCODER_PREPARED</span>: {</li><li>            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_PREPARED</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>.<span class="hljs-title class_">count</span>(<span class="hljs-title class_">AVTRANSCODER_PREPARED</span>) &gt; <span class="hljs-number">0</span>) {</li><li>               <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>[<span class="hljs-title class_">AVTRANSCODER_PREPARED</span>]();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-variable">AVTRANSCODER_STARTED</span>: {</li><li>            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_STARTED</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>.<span class="hljs-title class_">count</span>(<span class="hljs-title class_">AVTRANSCODER_STARTED</span>) &gt; <span class="hljs-number">0</span>) {</li><li>               <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>[<span class="hljs-title class_">AVTRANSCODER_STARTED</span>]();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-variable">AVTRANSCODER_PAUSED</span>: {</li><li>            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_PAUSED</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>.<span class="hljs-title class_">count</span>(<span class="hljs-title class_">AVTRANSCODER_PAUSED</span>) &gt; <span class="hljs-number">0</span>) {</li><li>               <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>[<span class="hljs-title class_">AVTRANSCODER_PAUSED</span>]();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-variable">AVTRANSCODER_CANCELLED</span>: {</li><li>            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_CANCELLED</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>.<span class="hljs-title class_">count</span>(<span class="hljs-title class_">AVTRANSCODER_CANCELLED</span>) &gt; <span class="hljs-number">0</span>) {</li><li>               <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>[<span class="hljs-title class_">AVTRANSCODER_CANCELLED</span>]();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-variable">AVTRANSCODER_COMPLETED</span>: {</li><li>            <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">transCoderState</span> = <span class="hljs-variable">AVTRANSCODER_COMPLETED</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>.<span class="hljs-title class_">count</span>(<span class="hljs-title class_">AVTRANSCODER_COMPLETED</span>) &gt; <span class="hljs-number">0</span>) {</li><li>               <span class="hljs-keyword">this</span>-&gt;<span class="hljs-title class_">stateChangeFuncs_</span>[<span class="hljs-title class_">AVTRANSCODER_COMPLETED</span>]();</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>      }</li><li>      <span class="hljs-variable">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>   }</li><li>}</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">AvTranscoderStateChangeCbImpl</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>,  <span class="hljs-variable">OH_AVTranscoder_State</span> <span class="hljs-variable">state</span>, <span class="hljs-variable">void</span> *<span class="hljs-variable">userData</span>)</li><li>{</li><li>   <span class="hljs-title function_">LOG</span>(<span class="hljs-string">"AvTranscoderStateChangeCbImpl state: %{public}d"</span>, <span class="hljs-variable">state</span>);</li><li>   <span class="hljs-variable">NdkAVTransCoderUser</span> *<span class="hljs-variable">ndkAVTransCoderUser</span> =  <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">NdkAVTransCoderUser</span> *&gt;(<span class="hljs-variable">userData</span>);</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">ndkAVTransCoderUser</span> == <span class="hljs-variable">nullptr</span> || <span class="hljs-variable">transcoder</span> == <span class="hljs-variable">nullptr</span>) {</li><li>      <span class="hljs-title function_">LOGE</span>(<span class="hljs-string">"AvTranscoderStateChangeCbImpl ndkAVTransCoderUser or transcoder is  nullptr"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-variable">ndkAVTransCoderUser</span>-&gt;<span class="hljs-title class_">OnStateChangeCb</span>(<span class="hljs-title class_">transcoder</span>, <span class="hljs-title class_">state</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">AvTranscoderErrorCbImpl</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">int32_t</span>  <span class="hljs-variable">errorCode</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">char</span> *<span class="hljs-variable">errorMsg</span>,</li><li>                                    <span class="hljs-variable">void</span> *<span class="hljs-variable">userData</span>)</li><li>{</li><li>   <span class="hljs-title function_">LOG</span>(<span class="hljs-string">"AvTranscoderErrorCbImpl errorCode: %{public}d, errorMsg: %{public}s"</span>,  <span class="hljs-variable">errorCode</span>,</li><li>      <span class="hljs-variable">errorMsg</span> == <span class="hljs-variable">nullptr</span> ? <span class="hljs-string">"unknown"</span> : <span class="hljs-title class_">errorMsg</span>);</li><li>   <span class="hljs-variable">NdkAVTransCoderUser</span> *<span class="hljs-variable">ndkAVTransCoderUser</span> =  <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">NdkAVTransCoderUser</span> *&gt;(<span class="hljs-variable">userData</span>);</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">ndkAVTransCoderUser</span> == <span class="hljs-variable">nullptr</span> || <span class="hljs-variable">transcoder</span> == <span class="hljs-variable">nullptr</span>) {</li><li>      <span class="hljs-title function_">LOGE</span>(<span class="hljs-string">"AvTranscoderErrorCbImpl ndkAVTransCoderUser or transcoder is  nullptr"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-variable">ndkAVTransCoderUser</span>-&gt;<span class="hljs-title class_">OnErrorCb</span>(<span class="hljs-title class_">transcoder</span>, <span class="hljs-title class_">errorCode</span>, <span class="hljs-title class_">errorMsg</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">AvTranscoderProgressUpdateCbImpl</span>(<span class="hljs-variable">OH_AVTranscoder</span> *<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">int</span>  <span class="hljs-variable">progress</span>, <span class="hljs-variable">void</span> *<span class="hljs-variable">userData</span>)</li><li>{</li><li>   <span class="hljs-title function_">LOG</span>(<span class="hljs-string">"AvTranscoderProgressUpdateCbImpl progress: %{public}d"</span>, <span class="hljs-variable">progress</span>);</li><li>   <span class="hljs-variable">NdkAVTransCoderUser</span> *<span class="hljs-variable">ndkAVTransCoderUser</span> =  <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">NdkAVTransCoderUser</span> *&gt;(<span class="hljs-variable">userData</span>);</li><li>   <span class="hljs-keyword">if</span> (<span class="hljs-variable">ndkAVTransCoderUser</span> == <span class="hljs-variable">nullptr</span> || <span class="hljs-variable">transcoder</span> == <span class="hljs-variable">nullptr</span>) {</li><li>      <span class="hljs-title function_">LOGE</span>(<span class="hljs-string">"AvTranscoderProgressUpdateCbImpl ndkAVTransCoderUser or transcoder is  nullptr"</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>   }</li><li>   <span class="hljs-variable">ndkAVTransCoderUser</span>-&gt;<span class="hljs-title class_">OnProgressUpdateCb</span>(<span class="hljs-title class_">transcoder</span>, <span class="hljs-title class_">progress</span>);</li><li>}</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">OHAvTranscoderNdkPlay</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_callback_info</span> <span class="hljs-variable">info</span>)</li><li>{</li><li>   <span class="hljs-title function_">OH_AVTranscoder_SetStateCallback</span>(<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">AvTranscoderStateChangeCbImpl</span>,  <span class="hljs-variable">transcoderUser</span>); <span class="hljs-comment">// 设置状态回调</span></li><li>   <span class="hljs-title function_">OH_AVTranscoder_SetErrorCallback</span>(<span class="hljs-variable">transcoder</span>, <span class="hljs-variable">AvTranscoderErrorCbImpl</span>,  <span class="hljs-variable">transcoderUser</span>); <span class="hljs-comment">// 设置错误码回调</span></li><li>   <span class="hljs-title function_">OH_AVTranscoder_SetProgressUpdateCallback</span>(<span class="hljs-variable">transcoder</span>,  <span class="hljs-variable">AvTranscoderProgressUpdateCbImpl</span>, <span class="hljs-variable">transcoderUser</span>); <span class="hljs-comment">// 设置进度值回调</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用OH_AVTranscoderConfig_Create()创建转码配置实例。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-lua" data-highlighted="yes"><ol class="linenums"><li>OH_AVTranscoder_Config *<span class="hljs-built_in">config</span> = OH_AVTranscoderConfig_Create();</li></ol></pre></div></div></li>      <li>       <p>设置转码源视频的文件描述符：调用OH_AVTranscoderConfig_SetSrcFD()设置源视频文件信息。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVTranscoderConfig_SetSrcFD</span>(config, srcFd, srcOffset, length); <span class="hljs-comment">// 设置转码源视频FD</span></li></ol></pre></div></div></li>      <li>       <p>设置转码输出视频的文件描述符：调用OH_AVTranscoderConfig_SetDstFD()设置目标视频文件描述符。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVTranscoderConfig_SetDstFD</span>(config, dstFd); <span class="hljs-comment">// 设置转码的目标文件属dstFd。</span></li></ol></pre></div></div></li>      <li>       <p>（可选）设置转码输出视频的编码格式：调用OH_AVTranscoderConfig_SetDstVideoType()设置输出视频的编码格式。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVTranscoderConfig_SetDstVideoType</span>(config, "video/avc"); <span class="hljs-comment">// 视频编码格式，可选。</span></li></ol></pre></div></div></li>      <li>       <p>（可选）设置转码输出音频的编码格式：调用OH_AVTranscoderConfig_SetDstAudioType()设置输出音频的编码格式。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVTranscoderConfig_SetDstAudioType</span>(config, "audio/mp4a-latm"); <span class="hljs-comment">// 音频编码格式，可选。</span></li></ol></pre></div></div></li>      <li>       <p>设置转码输出视频文件的封装格式：调用OH_AVTranscoderConfig_SetDstFileType()设置输出视频文件的封装格式。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AVTranscoderConfig_SetDstFileType</span>(config, AV_OUTPUT_FORMAT_MPEG_4); <span class="hljs-comment">// 封装格式。</span></li></ol></pre></div></div></li>      <li>       <p>（可选）设置转码输出音频的码率：调用OH_AVTranscoderConfig_SetDstAudioBitrate()设置输出音频的码率。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">AUDIO_BITRATE</span> = <span class="hljs-number">200000</span>;</li><li><span class="hljs-title function_">OH_AVTranscoderConfig_SetDstAudioBitrate</span>(<span class="hljs-variable">config</span>, <span class="hljs-variable">AUDIO_BITRATE</span>); <span class="hljs-comment">// 音频比特率，可选。</span></li></ol></pre></div></div></li>      <li>       <p>（可选）设置转码输出视频的码率：调用OH_AVTranscoderConfig_SetDstVideoBitrate()设置输出视频的码率。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">VIDEO_BITRATE</span> = <span class="hljs-number">3000000</span>;</li><li><span class="hljs-title function_">OH_AVTranscoderConfig_SetDstVideoBitrate</span>(<span class="hljs-variable">config</span>, <span class="hljs-variable">VIDEO_BITRATE</span>); <span class="hljs-comment">// 视频比特率，可选。</span></li></ol></pre></div></div></li>      <li>       <p>（可选）设置转码输出视频的分辨率：调用OH_AVTranscoderConfig_SetDstVideoResolution()设置输出视频的分辨率。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">VIDEO_WIDTH</span> = <span class="hljs-number">1280</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">VIDEO_HEIGHT</span> = <span class="hljs-number">720</span>;</li><li><span class="hljs-title function_">OH_AVTranscoderConfig_SetDstVideoResolution</span>(<span class="hljs-variable">config</span>, <span class="hljs-variable">VIDEO_WIDTH</span>, <span class="hljs-variable">VIDEO_HEIGHT</span>);</li></ol></pre></div></div></li>      <li>       <p>准备转码：调用OH_AVTranscoder_Prepare()成功之后进入AVTRANSCODER_PREPARED状态。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Prepare(transcoder, config); <span class="hljs-comment">// 准备转码</span></li></ol></pre></div></div></li>      <li>       <p>开始转码：调用OH_AVTranscoder_Start()成功之后进入AVTRANSCODER_STARTED状态。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Start(transcoder); <span class="hljs-comment">// 开始转码</span></li></ol></pre></div></div></li>      <li>       <p>（可选）暂停转码：调用OH_AVTranscoder_Pause()成功之后进入AVTRANSCODER_PAUSED状态。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Pause(transcoder); <span class="hljs-comment">// 暂停转码</span></li></ol></pre></div></div></li>      <li>       <p>（可选）恢复转码：调用OH_AVTranscoder_Resume()成功之后重新进入AVTRANSCODER_STARTED状态。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Resume(transcoder); <span class="hljs-comment">// 恢复转码</span></li></ol></pre></div></div></li>      <li>       <p>（可选）取消转码：调用OH_AVTranscoder_Cancel()成功之后进入AVTRANSCODER_CANCELLED状态。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Cancel(transcoder); <span class="hljs-comment">// 取消转码</span></li></ol></pre></div></div></li>      <li>       <p>释放转码配置参数：调用OH_AVTranscoderConfig_Release()销毁实例，释放资源。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoderConfig_Release(config); <span class="hljs-comment">// 释放转码配置实例</span></li></ol></pre></div></div></li>      <li>       <p>释放转码资源：调用OH_AVTranscoder_Release()销毁实例，释放资源。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_AVErrCode</span> <span class="hljs-variable">errCode</span> <span class="hljs-operator">=</span> AV_ERR_OK;</li><li>errCode = OH_AVTranscoder_Release(transcoder); <span class="hljs-comment">// 释放转码实例</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="运行完整示例">运行完整示例<i class="anchor-icon anchor-icon-link" anchorid="运行完整示例" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>新建工程，下载<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/Media/AVTranscoder/AVTranscoderNDK" target="_blank">示例工程</a>，并将示例工程的以下资源复制到对应目录。</p>       <div _ngcontent-ojh-c106="" class="highlight-div"><div _ngcontent-ojh-c106="" class="highlight-div-header"><div _ngcontent-ojh-c106="" class="highlight-div-header-left"><div _ngcontent-ojh-c106="" class="handle-button expand-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ojh-c106="" class="highlight-div-header-right"><div _ngcontent-ojh-c106="" class="handle-button ai-button"></div><div _ngcontent-ojh-c106="" class="handle-button line-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ojh-c106="" class="handle-button theme-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ojh-c106="" class="handle-button copy-button"><div _ngcontent-ojh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ojh-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>AVTranscoderNDK</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/ets/</li><li>└── pages</li><li>    └── Index<span class="hljs-selector-class">.ets</span>（转码界面）</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/</li><li>├── cpp</li><li>│   ├── types</li><li>│   │   └── libentry</li><li>│   │       └── Index<span class="hljs-selector-class">.d</span><span class="hljs-selector-class">.ts</span>（NDK函数对应的js映射）</li><li>│   ├── CMakeLists<span class="hljs-selector-class">.txt</span>（CMake脚本）</li><li>│   └── napi_init<span class="hljs-selector-class">.cpp</span>（NDK函数）</li><li>└── resources</li><li>    ├── base</li><li>    │   └── element</li><li>    │       ├── <span class="hljs-attribute">color</span><span class="hljs-selector-class">.json</span></li><li>    │       ├── <span class="hljs-attribute">float</span><span class="hljs-selector-class">.json</span></li><li>    │       └── string<span class="hljs-selector-class">.json</span></li><li>    └── rawfile</li><li>        └── <span class="hljs-attribute">src</span><span class="hljs-selector-class">.mp4</span>（视频资源）</li></ol></pre></div></div></li>      <li>       <p>编译新建工程并运行。</p></li>     </ol>    </div>   </div>   <div></div></div>