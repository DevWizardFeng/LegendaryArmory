<h1 _ngcontent-cdq-c119="" class="doc-title ng-star-inserted" title="使用AudioRenderer开发音频播放功能"> 使用AudioRenderer开发音频播放功能 </h1>

<div _ngcontent-cdq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>AudioRenderer是音频渲染器，用于播放PCM（Pulse Code Modulation）音频数据，相比<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-avplayer-for-playback">AVPlayer</a>而言，可以在输入前添加数据预处理，更适合有音频开发经验的开发者，以实现更灵活的播放功能。</p>    <div class="tiledSection">     <h2 id="开发指导">开发指导<i class="anchor-icon anchor-icon-link" anchorid="开发指导" tips="复制节点链接"></i></h2>          <p>使用AudioRenderer播放音频涉及到AudioRenderer实例的创建、音频渲染参数的配置、渲染的开始与停止、资源的释放等。本开发指导将以一次渲染音频数据的过程为例，向开发者讲解如何使用AudioRenderer进行音频渲染，建议搭配<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer" target="_blank">AudioRenderer的API说明</a>阅读。</p>     <p>下图展示了AudioRenderer的状态变化，在创建实例后，调用对应的方法可以进入指定的状态实现对应的行为。需要注意的是在确定的状态执行不合适的方法可能导致AudioRenderer发生错误，建议开发者在调用状态转换的方法前进行状态检查，避免程序运行产生预期以外的结果。</p>     <p>为保证UI线程不被阻塞，大部分AudioRenderer调用都是异步的。对于每个API均提供了callback函数和Promise函数，以下示例均采用callback函数。</p>     <p><strong>图1</strong> AudioRenderer状态变化示意图</p>     <p><span><img originheight="939" originwidth="1329" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114423.10488248720669542696502274560287:50001231000000:2800:1D6E26FA6299ADAB97441460A5646BDFB7555FE7FE3D445D49AC45780F9B4E4F.png" width="920" height="650.0225733634312"></span></p>     <p>在进行应用开发的过程中，建议开发者通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#onstatechange8" target="_blank">on('stateChange')</a>方法订阅AudioRenderer的状态变更。因为针对AudioRenderer的某些操作，仅在音频播放器在固定状态时才能执行。如果应用在音频播放器处于错误状态时执行操作，系统可能会抛出异常或生成其他未定义的行为。</p>     <ul>      <li>       <p>prepared状态： 通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-f#audiocreateaudiorenderer8" target="_blank">createAudioRenderer()</a>方法进入到该状态。</p></li>      <li>       <p>running状态： 正在进行音频数据播放，可以在prepared状态通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#start8" target="_blank">start()</a>方法进入此状态，也可以在paused状态和stopped状态通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#start8" target="_blank">start()</a>方法进入此状态。</p></li>      <li>       <p>paused状态： 在running状态可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#pause8" target="_blank">pause()</a>方法暂停音频数据的播放并进入paused状态，暂停播放之后可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#start8" target="_blank">start()</a>方法继续音频数据播放。</p></li>      <li>       <p>stopped状态： 在paused/running状态可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#stop8" target="_blank">stop()</a>方法停止音频数据的播放。</p></li>      <li>       <p>released状态： 在prepared、paused、stopped等状态，用户均可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiorenderer#release8" target="_blank">release()</a>方法释放掉所有占用的硬件和软件资源，并且不会再进入到其他的任何一种状态了。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="开发步骤及注意事项" class="firsth2">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>配置音频渲染参数并创建AudioRenderer实例，音频渲染参数的详细信息可以查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#audiorendereroptions8" target="_blank">AudioRendererOptions</a>。</p>       <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioStreamInfo</span>: audio.<span class="hljs-property">AudioStreamInfo</span> = {</li><li>  <span class="hljs-attr">samplingRate</span>: audio.<span class="hljs-property">AudioSamplingRate</span>.<span class="hljs-property">SAMPLE_RATE_48000</span>, <span class="hljs-comment">// 采样率。</span></li><li>  <span class="hljs-attr">channels</span>: audio.<span class="hljs-property">AudioChannel</span>.<span class="hljs-property">CHANNEL_2</span>, <span class="hljs-comment">// 通道。</span></li><li>  <span class="hljs-attr">sampleFormat</span>: audio.<span class="hljs-property">AudioSampleFormat</span>.<span class="hljs-property">SAMPLE_FORMAT_S16LE</span>, <span class="hljs-comment">// 采样格式。</span></li><li>  <span class="hljs-attr">encodingType</span>: audio.<span class="hljs-property">AudioEncodingType</span>.<span class="hljs-property">ENCODING_TYPE_RAW</span> <span class="hljs-comment">// 编码格式。</span></li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>  <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>  <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererOptions</span>: audio.<span class="hljs-property">AudioRendererOptions</span> = {</li><li>  <span class="hljs-attr">streamInfo</span>: audioStreamInfo,</li><li>  <span class="hljs-attr">rendererInfo</span>: audioRendererInfo</li><li>};</li><li>
</li><li>audio.<span class="hljs-title function_">createAudioRenderer</span>(audioRendererOptions, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Invoke createAudioRenderer failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Invoke createAudioRenderer succeeded.'</span>);</li><li>    <span class="hljs-keyword">let</span> audioRenderer = data;</li><li>  }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用on('writeData')方法，订阅监听音频数据写入回调，推荐使用API version 12支持返回回调结果的方式。</p>       <ul>        <li>         <p>API version 12开始该方法支持返回回调结果，系统可以根据开发者返回的值来决定此次回调中的数据是否播放。</p>         <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">           <ul>            <li>             <p>能填满回调所需长度数据的情况下，返回audio.AudioDataCallbackResult.VALID，系统会取用完整长度的数据缓冲进行播放。请不要在未填满数据的情况下返回audio.AudioDataCallbackResult.VALID，否则会导致杂音、卡顿等现象。</p></li>            <li>             <p>在无法填满回调所需长度数据的情况下，建议开发者返回audio.AudioDataCallbackResult.INVALID，系统不会处理该段音频数据，然后会再次向应用请求数据，确认数据填满后返回audio.AudioDataCallbackResult.VALID。</p></li>            <li>             <p>回调函数结束后，音频服务会把缓冲中数据放入队列里等待播放，因此请勿在回调外再次更改缓冲中的数据。对于最后一帧，如果数据不够填满缓冲长度，开发者需要使用剩余数据拼接空数据的方式，将缓冲填满，避免缓冲内的历史脏数据对播放效果产生不良的影响。</p></li>           </ul>          </div></div></div>         <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Options</span> {</li><li>  offset?: <span class="hljs-built_in">number</span>;</li><li>  length?: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">bufferSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext。</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> path = context.<span class="hljs-property">cacheDir</span>;</li><li><span class="hljs-comment">// 此处仅作示例，实际使用时需要将文件替换为应用要播放的PCM文件。</span></li><li><span class="hljs-keyword">let</span> filePath = path + <span class="hljs-string">'/StarWars10s-2C-48000-4SW.pcm'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">writeDataCallback</span> = (<span class="hljs-params">buffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {</li><li>    <span class="hljs-attr">offset</span>: bufferSize,</li><li>    <span class="hljs-attr">length</span>: buffer.<span class="hljs-property">byteLength</span></li><li>  };</li><li>
</li><li>  <span class="hljs-keyword">try</span> {</li><li>    fs.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, buffer, options);</li><li>    bufferSize += buffer.<span class="hljs-property">byteLength</span>;</li><li>    <span class="hljs-comment">// 系统会判定buffer有效，正常播放。</span></li><li>    <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">VALID</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error reading file:'</span>, error);</li><li>    <span class="hljs-comment">// 系统会判定buffer无效，不播放。</span></li><li>    <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">INVALID</span>;</li><li>  }</li><li>};</li><li>
</li><li>audioRenderer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'writeData'</span>, writeDataCallback);</li></ol></pre></div></div></li>        <li>         <p>API version 11该方法不支持返回回调结果，系统默认回调中的数据均为有效数据。</p>         <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">           <ul>            <li>             <p>请确保填满回调所需长度数据，否则会导致杂音、卡顿等现象。</p></li>            <li>             <p>在无法填满回调所需长度数据的情况下，建议开发者选择暂时停止写入数据（不暂停音频流），阻塞回调函数，等待数据充足时，再继续写入数据，确保数据填满。在阻塞回调函数后，如需调用AudioRenderer相关接口，需先解阻塞。</p></li>            <li>             <p>开发者如果不希望播放本次回调中的音频数据，可以主动将回调中的数据块置空（置空后，也会被系统统计到已写入的数据，播放静音帧）。</p></li>            <li>             <p>回调函数结束后，音频服务会把缓冲中数据放入队列里等待播放，因此请勿在回调外再次更改缓冲中的数据。对于最后一帧，如果数据不够填满缓冲长度，开发者需要使用剩余数据拼接空数据的方式，将缓冲填满，避免缓冲内的历史脏数据对播放效果产生不良的影响。</p></li>           </ul>          </div></div></div>         <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Options</span> {</li><li>  offset?: <span class="hljs-built_in">number</span>;</li><li>  length?: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">bufferSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回结果为UIAbilityContext。</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> path = context.<span class="hljs-property">cacheDir</span>;</li><li><span class="hljs-comment">// 此处仅作示例，实际使用时需要将文件替换为应用要播放的PCM文件。</span></li><li><span class="hljs-keyword">let</span> filePath = path + <span class="hljs-string">'/StarWars10s-2C-48000-4SW.pcm'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">writeDataCallback</span> = (<span class="hljs-params">buffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt; {</li><li>  <span class="hljs-comment">// 如果开发者不希望播放某段buffer，可在此处添加判断并对buffer进行置空处理。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {</li><li>    <span class="hljs-attr">offset</span>: bufferSize,</li><li>    <span class="hljs-attr">length</span>: buffer.<span class="hljs-property">byteLength</span></li><li>  };</li><li>  fs.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, buffer, options);</li><li>  bufferSize += buffer.<span class="hljs-property">byteLength</span>;</li><li>};</li><li>
</li><li>audioRenderer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'writeData'</span>, writeDataCallback);</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>调用start()方法进入running状态，开始渲染音频。</p>       <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>audioRenderer.<span class="hljs-title function_">start</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Renderer start failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer start success.'</span>);</li><li>  }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用stop()方法停止渲染。</p>       <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>audioRenderer.<span class="hljs-title function_">stop</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Renderer stop failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer stopped.'</span>);</li><li>  }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用release()方法销毁实例，释放资源。</p>       <p>应用需根据实际业务需求合理使用AudioRenderer实例，按需创建并及时释放，避免占用过多音频资源导致异常。</p>       <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>audioRenderer.<span class="hljs-title function_">release</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Renderer release failed, code is <span class="hljs-subst">${err.code}</span>, message is <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer released.'</span>);</li><li>  }</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="选择正确的streamusage">选择正确的StreamUsage<i class="anchor-icon anchor-icon-link" anchorid="选择正确的streamusage" tips="复制节点链接"></i></h3>          <p>创建播放器时候，开发者需要根据应用场景指定播放器的StreamUsage，选择正确的StreamUsage可以避免用户遇到不符合预期的行为。</p>     <p>在音频API文档<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#streamusage" target="_blank">StreamUsage</a>介绍中，列举了每一种类型推荐的应用场景。例如音乐场景推荐使用STREAM_USAGE_MUSIC，电影或者视频场景推荐使用STREAM_USAGE_MOVIE，游戏场景推荐使用STREAM_USAGE_GAME，等等。</p>     <p>如果开发者配置了不正确的StreamUsage，可能带来一些不符合预期的行为。例如以下场景。</p>     <ul>      <li>游戏场景错误使用STREAM_USAGE_MUSIC类型，游戏应用将无法和其他音乐应用并发播放，而游戏场景通常可以与其他音乐应用并发播放。</li>      <li>导航场景错误使用STREAM_USAGE_MUSIC类型，导航应用播报时候会导致正在播放的音乐停止播放，而导航场景我们通常期望正在播放的音乐仅仅降低音量播放。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="配置合适的音频采样率">配置合适的音频采样率<i class="anchor-icon anchor-icon-link" anchorid="配置合适的音频采样率" tips="复制节点链接"></i></h3>          <p>采样率：指音频每秒单个声道样点数，单位为Hz。</p>     <p>重采样：根据输入输出音频采样率的差异，进行上采样（通过插值增加样点数）或下采样（通过抽取减少样点数）。</p>     <p>AudioRenderer支持枚举类型AudioSamplingRate中定义的所有采样率。</p>     <p>若通过AudioRenderer设置的输入音频采样率与设备输出采样率不一致，系统会将输入音频重采样为设备输出采样率。</p>     <p>若为减少重采样功耗，可使用采样率与输出设备采样率一致的输入音频。推荐使用48k采样率。</p>    </div>    <div class="tiledSection">     <h3 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h3>          <p>下面展示了使用AudioRenderer渲染音频文件的示例代码。</p>     <div _ngcontent-cdq-c106="" class="highlight-div"><div _ngcontent-cdq-c106="" class="highlight-div-header"><div _ngcontent-cdq-c106="" class="highlight-div-header-left"><div _ngcontent-cdq-c106="" class="handle-button expand-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cdq-c106="" class="highlight-div-header-right"><div _ngcontent-cdq-c106="" class="handle-button ai-button"></div><div _ngcontent-cdq-c106="" class="handle-button line-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cdq-c106="" class="handle-button theme-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cdq-c106="" class="handle-button copy-button"><div _ngcontent-cdq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cdq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'AudioRendererDemo'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Options</span> {</li><li>  offset?: <span class="hljs-built_in">number</span>;</li><li>  length?: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRenderer</span>: audio.<span class="hljs-property">AudioRenderer</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioStreamInfo</span>: audio.<span class="hljs-property">AudioStreamInfo</span> = {</li><li>  <span class="hljs-attr">samplingRate</span>: audio.<span class="hljs-property">AudioSamplingRate</span>.<span class="hljs-property">SAMPLE_RATE_48000</span>, <span class="hljs-comment">// 采样率。</span></li><li>  <span class="hljs-attr">channels</span>: audio.<span class="hljs-property">AudioChannel</span>.<span class="hljs-property">CHANNEL_2</span>, <span class="hljs-comment">// 通道。</span></li><li>  <span class="hljs-attr">sampleFormat</span>: audio.<span class="hljs-property">AudioSampleFormat</span>.<span class="hljs-property">SAMPLE_FORMAT_S16LE</span>, <span class="hljs-comment">// 采样格式。</span></li><li>  <span class="hljs-attr">encodingType</span>: audio.<span class="hljs-property">AudioEncodingType</span>.<span class="hljs-property">ENCODING_TYPE_RAW</span> <span class="hljs-comment">// 编码格式。</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>  <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>  <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">0</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererOptions</span>: audio.<span class="hljs-property">AudioRendererOptions</span> = {</li><li>  <span class="hljs-attr">streamInfo</span>: audioStreamInfo,</li><li>  <span class="hljs-attr">rendererInfo</span>: audioRendererInfo</li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">writeDataCallback</span>: audio.<span class="hljs-property">AudioRendererWriteDataCallback</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initArguments</span>(<span class="hljs-params">context: common.UIAbilityContext</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">bufferSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> path = context.<span class="hljs-property">cacheDir</span>;</li><li>  <span class="hljs-comment">// 此处仅作示例，实际使用时需要将文件替换为应用要播放的PCM文件。</span></li><li>  <span class="hljs-keyword">let</span> filePath = path + <span class="hljs-string">'/StarWars10s-2C-48000-4SW.pcm'</span>;</li><li>  file = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>  writeDataCallback = <span class="hljs-function">(<span class="hljs-params">buffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: <span class="hljs-title class_">Options</span> = {</li><li>      <span class="hljs-attr">offset</span>: bufferSize,</li><li>      <span class="hljs-attr">length</span>: buffer.<span class="hljs-property">byteLength</span></li><li>    };</li><li>
</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> bufferLength = fs.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, buffer, options);</li><li>      bufferSize += buffer.<span class="hljs-property">byteLength</span>;</li><li>      <span class="hljs-comment">// 如果当前回调传入的数据不足一帧，空白区域需要使用静音数据填充，否则会导致播放出现杂音。</span></li><li>      <span class="hljs-keyword">if</span> (bufferLength &lt; buffer.<span class="hljs-property">byteLength</span>) {</li><li>        <span class="hljs-keyword">let</span> view = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);</li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = bufferLength; i &lt; buffer.<span class="hljs-property">byteLength</span>; i++) {</li><li>          <span class="hljs-comment">// 空白区域填充静音数据。当使用音频采样格式为SAMPLE_FORMAT_U8时0x7F为静音数据，使用其他采样格式时0为静音数据。</span></li><li>          view.<span class="hljs-title function_">setUint8</span>(i, <span class="hljs-number">0</span>);</li><li>        }</li><li>      }</li><li>      <span class="hljs-comment">// API version 11不支持返回回调结果，从API version 12开始支持返回回调结果。</span></li><li>      <span class="hljs-comment">// 如果开发者不希望播放某段buffer，返回audio.AudioDataCallbackResult.INVALID即可。</span></li><li>      <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">VALID</span>;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error reading file:'</span>, error);</li><li>      <span class="hljs-comment">// API version 11不支持返回回调结果，从API version 12开始支持返回回调结果。</span></li><li>      <span class="hljs-keyword">return</span> audio.<span class="hljs-property">AudioDataCallbackResult</span>.<span class="hljs-property">INVALID</span>;</li><li>    }</li><li>  };</li><li>}</li><li>
</li><li><span class="hljs-comment">// 初始化，创建实例，设置监听事件。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">init</span>(<span class="hljs-params"></span>) {</li><li>  audio.<span class="hljs-title function_">createAudioRenderer</span>(audioRendererOptions, <span class="hljs-function">(<span class="hljs-params">err, renderer</span>) =&gt;</span> { <span class="hljs-comment">// 创建AudioRenderer实例。</span></li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TAG}</span>: creating AudioRenderer success`</span>);</li><li>      audioRenderer = renderer;</li><li>      <span class="hljs-keyword">if</span> (audioRenderer !== <span class="hljs-literal">undefined</span>) {</li><li>        audioRenderer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'writeData'</span>, writeDataCallback);</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${TAG}</span>: creating AudioRenderer failed, error: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-comment">// 开始一次音频渲染。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">start</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (audioRenderer !== <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">let</span> stateGroup = [audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_PREPARED</span>, audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_PAUSED</span>, audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_STOPPED</span>];</li><li>    <span class="hljs-keyword">if</span> (stateGroup.<span class="hljs-title function_">indexOf</span>(audioRenderer.<span class="hljs-property">state</span>.<span class="hljs-title function_">valueOf</span>()) === -<span class="hljs-number">1</span>) { <span class="hljs-comment">// 当且仅当状态为prepared、paused和stopped之一时才能启动渲染。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable constant_">TAG</span> + <span class="hljs-string">'start failed'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 启动渲染。</span></li><li>    audioRenderer.<span class="hljs-title function_">start</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Renderer start failed.'</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer start success.'</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 暂停渲染。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">pause</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (audioRenderer !== <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-comment">// 只有渲染器状态为running的时候才能暂停。</span></li><li>    <span class="hljs-keyword">if</span> (audioRenderer.<span class="hljs-property">state</span>.<span class="hljs-title function_">valueOf</span>() !== audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RUNNING</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer is not running'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 暂停渲染。</span></li><li>    audioRenderer.<span class="hljs-title function_">pause</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Renderer pause failed.'</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer pause success.'</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 停止渲染。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">stop</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (audioRenderer !== <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-comment">// 只有渲染器状态为running或paused的时候才可以停止。</span></li><li>    <span class="hljs-keyword">if</span> (audioRenderer.<span class="hljs-property">state</span>.<span class="hljs-title function_">valueOf</span>() !== audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RUNNING</span> &amp;&amp; audioRenderer.<span class="hljs-property">state</span>.<span class="hljs-title function_">valueOf</span>() !== audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_PAUSED</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer is not running or paused.'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 停止渲染。</span></li><li>    audioRenderer.<span class="hljs-title function_">stop</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Renderer stop failed.'</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer stop success.'</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 销毁实例，释放资源。</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">release</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (audioRenderer !== <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-comment">// 渲染器状态不是released状态，才能release。</span></li><li>    <span class="hljs-keyword">if</span> (audioRenderer.<span class="hljs-property">state</span>.<span class="hljs-title function_">valueOf</span>() === audio.<span class="hljs-property">AudioState</span>.<span class="hljs-property">STATE_RELEASED</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer already released'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 释放资源。</span></li><li>    audioRenderer.<span class="hljs-title function_">release</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Renderer release failed.'</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Renderer release success.'</span>);</li><li>      }</li><li>    });</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Scroll</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'初始化'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> });</li><li>          }</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>            <span class="hljs-title function_">initArguments</span>(context);</li><li>            <span class="hljs-title function_">init</span>();</li><li>          });</li><li>
</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'开始播放'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> });</li><li>          }</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-title function_">start</span>();</li><li>          });</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'暂停播放'</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> });</li><li>          }</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'audio_effect_manager_card'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-title function_">pause</span>();</li><li>          });</li><li>
</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'停止播放'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> });</li><li>          }</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-title function_">stop</span>();</li><li>          });</li><li>        }</li><li>
</li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">Column</span>() {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">'释放资源'</span>).<span class="hljs-title function_">fontColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Black</span>).<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">16</span>).<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">12</span> });</li><li>          }</li><li>          .<span class="hljs-title function_">id</span>(<span class="hljs-string">'audio_volume_card'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">30</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'45%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">right</span>: <span class="hljs-number">12</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-title function_">release</span>();</li><li>          });</li><li>        }</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">12</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F1F3F5'</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>当同优先级或高优先级音频流要使用输出设备时，当前音频流会被中断，应用可以自行响应中断事件并做出处理。具体的音频并发处理方式可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">处理音频焦点事件</a>。</p>    </div>   </div>   <div></div></div>