<h1 _ngcontent-daj-c119="" class="doc-title ng-star-inserted" title="使用AudioSession管理应用音频焦点(ArkTS)"> 使用AudioSession管理应用音频焦点(ArkTS) </h1>

<div _ngcontent-daj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对于涉及多个音频流并发播放的场景，系统已预设了默认的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#音频焦点策略">音频焦点策略</a>，该策略将对所有音频流（包括播放和录制）实施统一的焦点管理。</p>    <p>应用可利用音频会话管理（AudioSessionManager）提供的接口，通过AudioSession主动管理应用内音频流的焦点，自定义本应用音频流的焦点策略，调整本应用音频流释放音频焦点的时机，从而贴合应用特定的使用需求。</p>    <p>本文档主要介绍AudioSession相关ArkTS API的使用方法和注意事项，更多音频焦点及音频会话的信息，可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">音频焦点和音频会话介绍</a>。</p>    <div class="tiledSection">     <h2 id="获取音频会话管理器">获取音频会话管理器<i class="anchor-icon anchor-icon-link" anchorid="获取音频会话管理器" tips="复制节点链接"></i></h2>          <p>创建AudioSessionManager实例。在使用AudioSessionManager的API前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiomanager#getsessionmanager12" target="_blank">getSessionManager</a>创建实例。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioSessionManager</span>: audio.<span class="hljs-property">AudioSessionManager</span> = audioManager.<span class="hljs-title function_">getSessionManager</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="激活音频会话">激活音频会话<i class="anchor-icon anchor-icon-link" anchorid="激活音频会话" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#activateaudiosession12" target="_blank">AudioSessionManager.activateAudioSession</a>接口激活当前应用的音频会话。</p>     <p>应用在激活AudioSession时，需指定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#音频会话策略audiosessionstrategy">音频会话策略（AudioSessionStrategy）</a>。策略中包含参数concurrencyMode，其类型为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#audioconcurrencymode12" target="_blank">AudioConcurrencyMode</a>，用于声明音频并发策略。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>  <span class="hljs-attr">concurrencyMode</span>: audio.<span class="hljs-property">AudioConcurrencyMode</span>.<span class="hljs-property">CONCURRENCY_MIX_WITH_OTHERS</span></li><li>};</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in doing activateAudioSession.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to activateAudioSession. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查询音频会话是否已激活">查询音频会话是否已激活<i class="anchor-icon anchor-icon-link" anchorid="查询音频会话是否已激活" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#isaudiosessionactivated12" target="_blank">isAudioSessionActivated</a>接口检查当前应用的音频会话是否已激活。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> isActivated = audioSessionManager.<span class="hljs-title function_">isAudioSessionActivated</span>();</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="停用音频会话">停用音频会话<i class="anchor-icon anchor-icon-link" anchorid="停用音频会话" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#deactivateaudiosession12" target="_blank">deactivateAudioSession</a>接口停用当前应用的音频会话。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">deactivateAudioSession</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in doing deactivateAudioSession.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to deactivateAudioSession. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听音频会话停用事件">监听音频会话停用事件<i class="anchor-icon anchor-icon-link" anchorid="监听音频会话停用事件" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#onaudiosessiondeactivated12" target="_blank">on('audioSessionDeactivated')</a>接口监听<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#audiosessiondeactivatedevent12" target="_blank">音频会话停用事件（AudioSessionDeactivatedEvent）</a>。</p>     <p>当AudioSession被停用（非主动停用）时，应用会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#audiosessiondeactivatedevent12" target="_blank">音频会话停用事件（AudioSessionDeactivatedEvent）</a>，其中包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-e#audiosessiondeactivatedreason12" target="_blank">音频会话停用原因（AudioSessionDeactivatedReason）</a>。</p>     <p>在收到AudioSessionDeactivatedEvent时，应用可根据自身业务需求，做相应的处理，例如释放相应资源、重新激活AudioSession等。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioSessionDeactivated'</span>, <span class="hljs-function">(<span class="hljs-params">audioSessionDeactivatedEvent: audio.AudioSessionDeactivatedEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`reason of audioSessionDeactivated: <span class="hljs-subst">${audioSessionDeactivatedEvent.reason}</span> `</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="取消监听音频会话停用事件">取消监听音频会话停用事件<i class="anchor-icon anchor-icon-link" anchorid="取消监听音频会话停用事件" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#offaudiosessiondeactivated12" target="_blank">off('audioSessionDeactivated')</a>接口取消监听音频会话停用事件。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>audioSessionManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'audioSessionDeactivated'</span>);</li></ol></pre></div></div>     <p><strong>音频会话从创建到激活并监听的完整示例：</strong></p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-comment">// 创建音频会话管理器。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioSessionManager</span>: audio.<span class="hljs-property">AudioSessionManager</span> = audioManager.<span class="hljs-title function_">getSessionManager</span>();</li><li><span class="hljs-comment">// 设置音频并发模式。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>  <span class="hljs-attr">concurrencyMode</span>: audio.<span class="hljs-property">AudioConcurrencyMode</span>.<span class="hljs-property">CONCURRENCY_MIX_WITH_OTHERS</span></li><li>};</li><li>
</li><li><span class="hljs-comment">// 激活音频会话。</span></li><li>audioSessionManager.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in doing activateAudioSession.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to activateAudioSession. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 查询音频会话是否已激活。</span></li><li><span class="hljs-keyword">let</span> isActivated = audioSessionManager.<span class="hljs-title function_">isAudioSessionActivated</span>();</li><li>
</li><li><span class="hljs-comment">// 监听音频会话停用事件。</span></li><li>audioSessionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioSessionDeactivated'</span>, <span class="hljs-function">(<span class="hljs-params">audioSessionDeactivatedEvent: audio.AudioSessionDeactivatedEvent</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`reason of audioSessionDeactivated: <span class="hljs-subst">${audioSessionDeactivatedEvent.reason}</span> `</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 音频会话激活后，应用在此处正常执行音频播放、暂停、停止、释放等操作即可。</span></li><li>
</li><li><span class="hljs-comment">// 停用音频会话。</span></li><li>audioSessionManager.<span class="hljs-title function_">deactivateAudioSession</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in doing deactivateAudioSession.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to deactivateAudioSession. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 取消监听音频会话停用事件。</span></li><li>audioSessionManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'audioSessionDeactivated'</span>);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过设置audiosession场景参数申请焦点">通过设置AudioSession场景参数申请焦点<i class="anchor-icon anchor-icon-link" anchorid="通过设置audiosession场景参数申请焦点" tips="复制节点链接"></i></h2>          <p>应用通过AudioSession申请焦点。首先要调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#setaudiosessionscene20" target="_blank">setAudioSessionScene</a>设置场景参数，然后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-audiosessionmanager#activateaudiosession12" target="_blank">activateAudioSession</a>接口激活AudioSession。</p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">setAudioSessionScene</span>(audio.<span class="hljs-property">AudioSessionScene</span>.<span class="hljs-property">AUDIO_SESSION_SCENE_MEDIA</span>);</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>  <span class="hljs-attr">concurrencyMode</span>: audio.<span class="hljs-property">AudioConcurrencyMode</span>.<span class="hljs-property">CONCURRENCY_MIX_WITH_OTHERS</span></li><li>};</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'activateAudioSession SUCCESS'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ERROR: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听audiosession焦点状态变化事件">监听AudioSession焦点状态变化事件<i class="anchor-icon anchor-icon-link" anchorid="监听audiosession焦点状态变化事件" tips="复制节点链接"></i></h2>          <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-audio-i#audiosessionstatechangedevent20" target="_blank">AudioSession焦点状态事件（AudioSessionStateChangedEvent）</a>监听音频会话焦点状态的变化。</p>     <p><strong>AudioSession申请焦点以及监听焦点变化事件的完整示例：</strong></p>     <div _ngcontent-daj-c106="" class="highlight-div"><div _ngcontent-daj-c106="" class="highlight-div-header"><div _ngcontent-daj-c106="" class="highlight-div-header-left"><div _ngcontent-daj-c106="" class="handle-button expand-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-daj-c106="" class="highlight-div-header-right"><div _ngcontent-daj-c106="" class="handle-button ai-button"></div><div _ngcontent-daj-c106="" class="handle-button line-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-daj-c106="" class="handle-button theme-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-daj-c106="" class="handle-button copy-button"><div _ngcontent-daj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-daj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;  <span class="hljs-comment">// 导入audio模块。</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>; <span class="hljs-comment">// 导入BusinessError。</span></li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">audioSessionStateChangedCallback</span> = (<span class="hljs-params">audioSessionStateChangedEvent: audio.AudioSessionStateChangedEvent</span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`hint of audioSessionStateChanged: <span class="hljs-subst">${audioSessionStateChangedEvent.stateChangeHint}</span> `</span>);</li><li>
</li><li>  <span class="hljs-keyword">switch</span> (audioSessionStateChangedEvent.<span class="hljs-property">stateChangeHint</span>) {</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_PAUSE</span>:</li><li>    <span class="hljs-comment">// 此分支表示系统已将音频流暂停，应用需切换至音频暂停状态。</span></li><li>    <span class="hljs-comment">// 临时失去焦点：其他音频流释放音频焦点后，本音频流会收到resume事件，可继续播放。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_RESUME</span>:</li><li>    <span class="hljs-comment">// 此分支表示系统解除AudioSession焦点的暂停操作。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_STOP</span>:</li><li>    <span class="hljs-comment">// 此分支表示系统已将音频流停止（永久失去焦点），为保持状态一致，应用需切换至音频暂停状态。</span></li><li>    <span class="hljs-comment">// 永久失去焦点：后续不会再收到音频焦点事件，恢复播放需用户主动触发。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_TIME_OUT_STOP</span>:</li><li>    <span class="hljs-comment">// 此分支表示由于长时间无音频流播放，系统已将AudioSession停止（永久失去焦点），应用需切换至音频暂停状态。</span></li><li>    <span class="hljs-comment">// 永久失去焦点：后续不会再收到音频焦点事件，恢复播放需用户主动触发。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_DUCK</span>:</li><li>    <span class="hljs-comment">// 此分支表示系统已将音频音量降低（默认降到正常音量的20%）。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-keyword">case</span> audio.<span class="hljs-property">AudioSessionStateChangeHint</span>.<span class="hljs-property">AUDIO_SESSION_STATE_CHANGE_HINT_UNDUCK</span>:</li><li>    <span class="hljs-comment">// 此分支表示系统已将音频音量恢复正常。</span></li><li>    <span class="hljs-keyword">break</span>;</li><li>  <span class="hljs-attr">default</span>:</li><li>    <span class="hljs-keyword">break</span>;</li><li>  }</li><li>};</li><li>
</li><li><span class="hljs-keyword">let</span> audioManager = audio.<span class="hljs-title function_">getAudioManager</span>();</li><li><span class="hljs-keyword">let</span> audioSessionManager = audioManager.<span class="hljs-title function_">getSessionManager</span>();</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'audioSessionStateChanged'</span>, audioSessionStateChangedCallback);</li><li>
</li><li><span class="hljs-comment">// 示例中选择了AUDIO_SESSION_SCENE_MEDIA会话场景，实际情况请根据具体场景修改该参数。</span></li><li>audioSessionManager.<span class="hljs-title function_">setAudioSessionScene</span>(audio.<span class="hljs-property">AudioSessionScene</span>.<span class="hljs-property">AUDIO_SESSION_SCENE_MEDIA</span>);</li><li>
</li><li><span class="hljs-comment">// 示例中选择了CONCURRENCY_MIX_WITH_OTHERS策略，请根据具体场景修改该参数。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">strategy</span>: audio.<span class="hljs-property">AudioSessionStrategy</span> = {</li><li>  <span class="hljs-attr">concurrencyMode</span>: audio.<span class="hljs-property">AudioConcurrencyMode</span>.<span class="hljs-property">CONCURRENCY_MIX_WITH_OTHERS</span></li><li>};</li><li>
</li><li><span class="hljs-comment">// 激活AudioSession，即抢占焦点</span></li><li>audioSessionManager.<span class="hljs-title function_">activateAudioSession</span>(strategy).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'activateAudioSession SUCCESS'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ERROR: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 根据实际业务，可以启动多个AudioRenderer等音频播放。</span></li><li>
</li><li><span class="hljs-comment">// 结束AudioSession，即释放焦点</span></li><li>audioSessionManager.<span class="hljs-title function_">deactivateAudioSession</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'deactivateAudioSession SUCCESS'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ERROR: <span class="hljs-subst">${err}</span>`</span>);</li><li>});</li><li>
</li><li>audioSessionManager.<span class="hljs-title function_">off</span>(<span class="hljs-string">'audioSessionStateChanged'</span>, audioSessionStateChangedCallback);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>