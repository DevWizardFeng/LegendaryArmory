<h1 _ngcontent-ooj-c119="" class="doc-title ng-star-inserted" title="使用AudioSession管理应用音频焦点(C/C++)"> 使用AudioSession管理应用音频焦点(C/C++) </h1>

<div _ngcontent-ooj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对于涉及多个音频流并发播放的场景，系统已预设了默认的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#音频焦点策略">音频焦点策略</a>，该策略将对所有音频流（包括播放和录制）实施统一的焦点管理。</p>    <p>应用可利用音频会话管理（AudioSessionManager）提供的接口，通过AudioSession主动管理应用内音频流的焦点，自定义本应用音频流的焦点策略，调整本应用音频流释放音频焦点的时机，从而贴合应用特定的使用需求。</p>    <p>本文档主要介绍AudioSession相关C API的使用方法和注意事项，更多音频焦点及音频会话的信息，可参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">音频焦点和音频会话介绍</a>。</p>    <div class="tiledSection">     <h2 id="使用入门">使用入门<i class="anchor-icon anchor-icon-link" anchorid="使用入门" tips="复制节点链接"></i></h2>          <p>应用要使用OHAudio提供的音频会话管理（AudioSessionManager）能力，需要添加对应的头文件。</p>    </div>    <div class="tiledSection">     <h3 id="在-cmake-脚本中链接动态库" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在-cmake-脚本中链接动态库" tips="复制节点链接"></i></h3>          <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libohaudio.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加头文件">添加头文件<i class="anchor-icon anchor-icon-link" anchorid="添加头文件" tips="复制节点链接"></i></h3>          <p>应用通过引入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h" target="_blank">native_audio_session_manager.h</a>头文件，使用音频播放相关API。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;ohaudio/native_audio_session_manager.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="获取音频会话管理器">获取音频会话管理器<i class="anchor-icon anchor-icon-link" anchorid="获取音频会话管理器" tips="复制节点链接"></i></h2>          <p>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ohaudio-oh-audiosessionmanager" target="_blank">OH_AudioSessionManager</a>实例。在使用音频会话管理功能前，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiomanager_getaudiosessionmanager" target="_blank">OH_AudioManager_GetAudioSessionManager</a>创建音频会话管理实例。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioSessionManager *audioSessionManager;</li><li><span class="hljs-built_in">OH_AudioManager_GetAudioSessionManager</span>(&amp;audioSessionManager);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="激活音频会话">激活音频会话<i class="anchor-icon anchor-icon-link" anchorid="激活音频会话" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_activateaudiosession" target="_blank">OH_AudioSessionManager_ActivateAudioSession</a>接口激活当前应用的音频会话。</p>     <p>应用在<a href="/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-session#激活音频会话">激活音频会话</a>时，需指定<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ohaudio-oh-audiosession-strategy" target="_blank">音频会话策略（OH_AudioSession_Strategy）</a>，其中包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosession_concurrencymode" target="_blank">音频并发模式（OH_AudioSession_ConcurrencyMode）</a>参数，用于声明不同的音频并发策略。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioSession_Strategy strategy = {CONCURRENCY_MIX_WITH_OTHERS};</li><li>
</li><li><span class="hljs-built_in">OH_AudioSessionManager_ActivateAudioSession</span>(audioSessionManager, &amp;strategy);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="查询音频会话是否已激活">查询音频会话是否已激活<i class="anchor-icon anchor-icon-link" anchorid="查询音频会话是否已激活" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_isaudiosessionactivated" target="_blank">OH_AudioSessionManager_IsAudioSessionActivated</a>接口检查当前应用的音频会话是否已激活。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">bool</span> isActivated = <span class="hljs-built_in">OH_AudioSessionManager_IsAudioSessionActivated</span>(audioSessionManager);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="停用音频会话">停用音频会话<i class="anchor-icon anchor-icon-link" anchorid="停用音频会话" tips="复制节点链接"></i></h2>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_deactivateaudiosession" target="_blank">OH_AudioSessionManager_DeactivateAudioSession</a>接口停用当前应用的音频会话。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioSessionManager_DeactivateAudioSession</span>(audioSessionManager);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听音频会话停用事件">监听音频会话停用事件<i class="anchor-icon anchor-icon-link" anchorid="监听音频会话停用事件" tips="复制节点链接"></i></h2>          <p>在使用AudioSession功能的过程中，推荐应用监听<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ohaudio-oh-audiosession-deactivatedevent" target="_blank">音频会话停用事件（OH_AudioSession_DeactivatedEvent）</a>。</p>     <p>当AudioSession被停用（非主动停用）时，应用会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ohaudio-oh-audiosession-deactivatedevent" target="_blank">音频会话停用事件（OH_AudioSession_DeactivatedEvent）</a>，其中包含<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosession_deactivatedreason" target="_blank">音频会话停用原因（OH_AudioSession_DeactivatedReason）</a>。</p>     <p>在收到AudioSessionDeactivatedEvent时，应用可根据自身业务需求，做相应的处理，例如释放相应资源、重新激活AudioSession等。</p>    </div>    <div class="tiledSection">     <h3 id="定义回调函数" class="firsth2">定义回调函数<i class="anchor-icon anchor-icon-link" anchorid="定义回调函数" tips="复制节点链接"></i></h3>          <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyAudioSessionDeactivatedCallback</span><span class="hljs-params">(OH_AudioSession_DeactivatedEvent event)</span></span></li><li><span class="hljs-function"></span>{</li><li>  <span class="hljs-keyword">switch</span>(event.reason) {</li><li>    <span class="hljs-keyword">case</span> DEACTIVATED_LOWER_PRIORITY:</li><li>      <span class="hljs-comment">// 应用焦点被抢占。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">case</span> DEACTIVATED_TIMEOUT:</li><li>      <span class="hljs-comment">// 超时。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="注册音频会话停用事件回调">注册音频会话停用事件回调<i class="anchor-icon anchor-icon-link" anchorid="注册音频会话停用事件回调" tips="复制节点链接"></i></h3>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_registersessiondeactivatedcallback" target="_blank">OH_AudioSessionManager_RegisterSessionDeactivatedCallback</a>接口监听音频会话停用事件。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioSessionManager_RegisterSessionDeactivatedCallback</span>(audioSessionManager, MyAudioSessionDeactivatedCallback);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="取消注册音频会话停用事件回调">取消注册音频会话停用事件回调<i class="anchor-icon anchor-icon-link" anchorid="取消注册音频会话停用事件回调" tips="复制节点链接"></i></h3>          <p>应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_unregistersessiondeactivatedcallback" target="_blank">OH_AudioSessionManager_UnregisterSessionDeactivatedCallback</a>接口取消监听音频会话停用事件。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioSessionManager_UnregisterSessionDeactivatedCallback</span>(audioSessionManager, MyAudioSessionDeactivatedCallback);</li></ol></pre></div></div>     <p><strong>音频会话从创建到激活并监听的完整示例：</strong></p>     <p>参考以下示例，完成音频会话从创建到激活并监听的过程。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdint&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohaudio/native_audio_session_manager.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">int32_t</span> <span class="hljs-title">MyAudioSessionDeactivatedCallback</span><span class="hljs-params">(OH_AudioSession_DeactivatedEvent event)</span></span></li><li><span class="hljs-function"></span>{</li><li>  <span class="hljs-keyword">switch</span>(event.reason) {</li><li>    <span class="hljs-keyword">case</span> DEACTIVATED_LOWER_PRIORITY:</li><li>      <span class="hljs-comment">// 应用焦点被抢占。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">case</span> DEACTIVATED_TIMEOUT:</li><li>      <span class="hljs-comment">// 超时。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>  }</li><li>}</li><li>
</li><li>OH_AudioSessionManager *audioSessionManager;</li><li>
</li><li><span class="hljs-comment">// 创建音频会话管理器。</span></li><li>OH_AudioCommon_Result resultManager = <span class="hljs-built_in">OH_AudioManager_GetAudioSessionManager</span>(&amp;audioSessionManager);</li><li>
</li><li>OH_AudioSession_Strategy strategy = {CONCURRENCY_MIX_WITH_OTHERS};</li><li>
</li><li><span class="hljs-comment">// 设置音频并发模式并激活音频会话。</span></li><li>OH_AudioCommon_Result resultActivate = <span class="hljs-built_in">OH_AudioSessionManager_ActivateAudioSession</span>(audioSessionManager, &amp;strategy);</li><li>
</li><li><span class="hljs-comment">// 查询音频会话是否已激活。</span></li><li><span class="hljs-type">bool</span> isActivated = <span class="hljs-built_in">OH_AudioSessionManager_IsAudioSessionActivated</span>(audioSessionManager);</li><li>
</li><li><span class="hljs-comment">// 监听音频会话停用事件。</span></li><li>OH_AudioCommon_Result resultRegister = <span class="hljs-built_in">OH_AudioSessionManager_RegisterSessionDeactivatedCallback</span>(audioSessionManager, MyAudioSessionDeactivatedCallback);</li><li>
</li><li><span class="hljs-comment">// 音频会话激活后应用在此处正常执行音频播放、暂停、停止、释放等操作即可。</span></li><li>
</li><li><span class="hljs-comment">// 取消监听音频会话停用事件。</span></li><li>OH_AudioCommon_Result resultUnregister = <span class="hljs-built_in">OH_AudioSessionManager_UnregisterSessionDeactivatedCallback</span>(audioSessionManager, MyAudioSessionDeactivatedCallback);</li><li>
</li><li><span class="hljs-comment">// 停用音频会话。</span></li><li>OH_AudioCommon_Result resultDeactivate = <span class="hljs-built_in">OH_AudioSessionManager_DeactivateAudioSession</span>(audioSessionManager);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="通过设置audiosession场景参数申请焦点">通过设置AudioSession场景参数申请焦点<i class="anchor-icon anchor-icon-link" anchorid="通过设置audiosession场景参数申请焦点" tips="复制节点链接"></i></h2>          <p>应用通过AudioSession申请焦点。首先要调用接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_setscene" target="_blank">OH_AudioSessionManager_SetScene</a>设置场景参数，然后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-audio-session-manager-h#oh_audiosessionmanager_activateaudiosession" target="_blank">OH_AudioSessionManager_ActivateAudioSession</a>接口激活AudioSession。</p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_AudioSessionManager_SetScene</span>(audioSessionManager, AUDIO_SESSION_SCENE_MEDIA);</li><li>
</li><li>OH_AudioSession_Strategy strategy = {CONCURRENCY_MIX_WITH_OTHERS};</li><li>
</li><li><span class="hljs-built_in">OH_AudioSessionManager_ActivateAudioSession</span>(audioSessionManager, &amp;strategy);</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听audiosession焦点状态变化事件">监听AudioSession焦点状态变化事件<i class="anchor-icon anchor-icon-link" anchorid="监听audiosession焦点状态变化事件" tips="复制节点链接"></i></h2>          <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ohaudio-oh-audiosession-statechangedevent" target="_blank">AudioSession焦点状态事件（OH_AudioSession_StateChangedEvent）</a>监听音频会话焦点状态的变化。</p>     <p><strong>AudioSession申请焦点以及监听焦点变化事件的完整示例：</strong></p>     <div _ngcontent-ooj-c106="" class="highlight-div"><div _ngcontent-ooj-c106="" class="highlight-div-header"><div _ngcontent-ooj-c106="" class="highlight-div-header-left"><div _ngcontent-ooj-c106="" class="handle-button expand-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ooj-c106="" class="highlight-div-header-right"><div _ngcontent-ooj-c106="" class="handle-button ai-button"></div><div _ngcontent-ooj-c106="" class="handle-button line-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ooj-c106="" class="handle-button theme-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ooj-c106="" class="handle-button copy-button"><div _ngcontent-ooj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ooj-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>OH_AudioSessionManager *audioSessionManager;</li><li>
</li><li><span class="hljs-comment">// 创建音频会话管理器。</span></li><li>OH_AudioCommon_Result resultManager = <span class="hljs-built_in">OH_AudioManager_GetAudioSessionManager</span>(&amp;audioSessionManager);</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">AudioSessionStateChangedCallback</span><span class="hljs-params">(OH_AudioSession_StateChangedEvent event)</span></span></li><li><span class="hljs-function"></span>{</li><li>  <span class="hljs-keyword">switch</span>(event.stateChangeHint) {</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_PAUSE:</li><li>      <span class="hljs-comment">// 此分支表示系统已将音频流暂停（临时失去焦点），为保持状态一致，应用需切换至音频暂停状态。</span></li><li>      <span class="hljs-comment">// 临时失去焦点：其他音频流释放音频焦点后，本音频流会收到resume事件，可继续播放。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_RESUME:</li><li>      <span class="hljs-comment">// 此分支表示系统解除对AudioSession焦点的暂停操作。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_STOP:</li><li>      <span class="hljs-comment">// 此分支表示系统已将音频流停止（永久失去焦点），为保持状态一致，应用需切换至音频暂停状态。</span></li><li>      <span class="hljs-comment">// 永久失去焦点：后续不会再收到任何音频焦点事件，若想恢复播放，需要用户主动触发。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_TIME_OUT_STOP:</li><li>      <span class="hljs-comment">// 此分支表示由于长时间没有音频流播放，为防止系统资源被长时间无效占用，系统已将AudioSession停止（永久失去焦点），为保持状态一致，应用需切换至音频暂停状态。</span></li><li>      <span class="hljs-comment">// 永久失去焦点：后续不会再收到任何音频焦点事件，若想恢复播放，需要用户主动触发。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_DUCK:</li><li>      <span class="hljs-comment">// 此分支表示系统已将音频音量降低（默认降到正常音量的20%）。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> AUDIO_SESSION_STATE_CHANGE_HINT_UNDUCK:</li><li>      <span class="hljs-comment">// 此分支表示系统已将音频音量恢复正常。</span></li><li>      <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">default</span>:</li><li>      <span class="hljs-keyword">break</span>;</li><li>  }</li><li>}</li><li>
</li><li>OH_AudioCommon_Result result = <span class="hljs-built_in">OH_AudioSessionManager_RegisterStateChangeCallback</span>(audioSessionManager, AudioSessionStateChangedCallback);</li><li>
</li><li><span class="hljs-comment">// AUDIO_SESSION_SCENE_MEDIA 仅为示例，实际使用时请根据具体情况进行修改。</span></li><li><span class="hljs-built_in">OH_AudioSessionManager_SetScene</span>(audioSessionManager, AUDIO_SESSION_SCENE_MEDIA);</li><li>
</li><li><span class="hljs-comment">// CONCURRENCY_MIX_WITH_OTHERS 是示例，实际使用时请根据情况修改</span></li><li>OH_AudioSession_Strategy strategy = {CONCURRENCY_MIX_WITH_OTHERS};</li><li>
</li><li>result = <span class="hljs-built_in">OH_AudioSessionManager_ActivateAudioSession</span>(audioSessionManager, &amp;strategy);</li><li>
</li><li><span class="hljs-comment">// 根据实际业务，可以启动多个AudioRenderer等音频播放</span></li><li>
</li><li>result = <span class="hljs-built_in">OH_AudioSessionManager_DeactivateAudioSession</span>(audioSessionManager);</li><li>
</li><li>result = <span class="hljs-built_in">OH_AudioSessionManager_UnregisterStateChangeCallback</span>(audioSessionManager, AudioSessionStateChangedCallback);</li></ol></pre></div></div>    </div>   </div>   <div></div></div>