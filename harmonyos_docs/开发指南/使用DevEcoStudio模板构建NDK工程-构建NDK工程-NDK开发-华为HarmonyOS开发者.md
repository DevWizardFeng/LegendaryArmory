<h1 _ngcontent-bnk-c119="" class="doc-title ng-star-inserted" title="使用DevEco Studio模板构建NDK工程"> 使用DevEco Studio模板构建NDK工程 </h1>

<div _ngcontent-bnk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>NDK通过CMake和Ninja编译应用的C/C++代码，编译过程如下图所示。</p> <p><span><img originheight="254" originwidth="1674" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.88286106785607447908199139478225:50001231000000:2800:81A51ECC0801635318536BB71E944BB9E01950263A25E9D0EEF1DC9CA6D76567.png" width="920" height="139.59378733572282"></span></p> <p>核心编译过程如下：</p> <ol><li><p>根据CMake配置脚本以及build-profile.json5中配置的externalNativeOptions构建参数，与缓存中的配置比对后，生成CMake命令并执行CMake。</p>  </li><li><p>执行Ninja，按照Makefile执行编译和链接，将生成的.so以及运行时依赖的.so同步到输出目录，完成构建过程。</p>  </li></ol> <p>通过DevEco Studio提供的应用模板，可以快速生成CMake构建脚本模板，并在build-profile.json5中指定相关编译构建参数。</p>  <div class="tiledSection"><h2 id="cmakeliststxt">CMakeLists.txt<i class="anchor-icon anchor-icon-link" anchorid="cmakeliststxt" tips="复制节点链接"></i></h2><p>通过DevEco Studio模板工程创建的NDK工程中，包含默认生成的CMakeLists.txt脚本，如下所示：</p> <div _ngcontent-bnk-c106="" class="highlight-div"><div _ngcontent-bnk-c106="" class="highlight-div-header"><div _ngcontent-bnk-c106="" class="highlight-div-header-left"><div _ngcontent-bnk-c106="" class="handle-button expand-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bnk-c106="" class="highlight-div-header-right"><div _ngcontent-bnk-c106="" class="handle-button ai-button"></div><div _ngcontent-bnk-c106="" class="handle-button line-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bnk-c106="" class="handle-button theme-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bnk-c106="" class="handle-button copy-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bnk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># the minimum version of CMake.</span></li><li>cmake_minimum_required(VERSION 3.4.1)</li><li>project(MyApplication)</li><li>
</li><li><span class="hljs-comment"># 定义一个变量，并赋值为当前模块cpp目录</span></li><li><span class="hljs-built_in">set</span>(NATIVERENDER_ROOT_PATH <span class="hljs-variable">${CMAKE_CURRENT_SOURCE_DIR}</span>)</li><li>
</li><li><span class="hljs-comment"># 添加头文件.h目录，包括cpp，cpp/include，告诉cmake去这里找到代码引入的头文件</span></li><li>include_directories(<span class="hljs-variable">${NATIVERENDER_ROOT_PATH}</span></li><li>                    <span class="hljs-variable">${NATIVERENDER_ROOT_PATH}</span>/include)</li><li>
</li><li><span class="hljs-comment"># 声明一个产物libentry.so，SHARED表示产物为动态库，hello.cpp为产物的源代码</span></li><li>add_library(entry SHARED hello.cpp)</li><li>
</li><li><span class="hljs-comment"># 声明产物entry链接时需要的三方库libace_napi.z.so</span></li><li><span class="hljs-comment"># 这里直接写三方库的名称是因为它是在ndk中，已在链接寻址路径中，无需额外声明</span></li><li>target_link_libraries(entry PUBLIC libace_napi.z.so)</li></ol></pre></div></div> <p>默认的CMakeLists.txt脚本中添加了编译所需的源代码、头文件以及三方库，开发者可根据实际工程添加自定义编译参数、函数声明、简单的逻辑控制等。</p> </div>  <div class="tiledSection"><h2 id="externalnativeoptions">externalNativeOptions<i class="anchor-icon anchor-icon-link" anchorid="externalnativeoptions" tips="复制节点链接"></i></h2><p>模块级build-profile.json5中externalNativeOptions参数是NDK工程C/C++文件编译配置的入口，可以通过path指定CMake脚本路径、arguments配置CMake参数、cppFlags配置C++编译器参数、abiFilters配置编译架构等。</p> <div _ngcontent-bnk-c106="" class="highlight-div"><div _ngcontent-bnk-c106="" class="highlight-div-header"><div _ngcontent-bnk-c106="" class="highlight-div-header-left"><div _ngcontent-bnk-c106="" class="handle-button expand-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-bnk-c106="" class="highlight-div-header-right"><div _ngcontent-bnk-c106="" class="handle-button ai-button"></div><div _ngcontent-bnk-c106="" class="handle-button line-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-bnk-c106="" class="handle-button theme-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-bnk-c106="" class="handle-button copy-button"><div _ngcontent-bnk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-bnk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"apiType"</span>: <span class="hljs-string">"stageMode"</span>,</li><li><span class="hljs-string">"buildOption"</span>: {</li><li>  <span class="hljs-string">"arkOptions"</span>: {</li><li>   },</li><li>  <span class="hljs-string">"externalNativeOptions"</span>: {</li><li>    <span class="hljs-string">"path"</span>: <span class="hljs-string">"./src/main/cpp/CMakeLists.txt"</span>,</li><li>    <span class="hljs-string">"arguments"</span>: <span class="hljs-string">""</span>,</li><li>    <span class="hljs-string">"cppFlags"</span>: <span class="hljs-string">""</span>,</li><li>    <span class="hljs-string">"abiFilters"</span>: [</li><li>       <span class="hljs-string">"arm64-v8a"</span>,</li><li>       <span class="hljs-string">"x86_64"</span></li><li>    ],</li><li>  }</li><li>}</li></ol></pre></div></div> <p>externalNativeOptions具体参数说明如下表所示。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.1" valign="top" width="33.33333333333333%">配置项</th> <th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.2" valign="top" width="33.33333333333333%">类型</th> <th align="left" class="cellrowborder" id="mcps1.3.7.5.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">path</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">CMake构建脚本地址，即CMakeLists.txt文件地址。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">abiFilters</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">array</td> <td class="cellrowborder" valign="top" width="33.33333333333333%"><p>本机的ABI编译环境，包括：</p> <p>- arm64-v8a</p> <p>- x86_64</p> <p>如不配置该参数，编译时默认编译出arm64-v8a架构相关so。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">arguments</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">CMake编译参数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">cppFlags</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">C++编译器参数。</td> </tr>  </tbody></table></div> </div> <p>更多关于build-profile.json5中参数的说明，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-build-profile" target="_blank">build-profile.json5</a>。</p> </div> </div> <div></div></div>