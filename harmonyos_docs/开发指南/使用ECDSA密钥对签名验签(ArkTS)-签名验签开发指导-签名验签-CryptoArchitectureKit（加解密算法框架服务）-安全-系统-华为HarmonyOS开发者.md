<h1 _ngcontent-wvb-c119="" class="doc-title ng-star-inserted" title="使用ECDSA密钥对签名验签(ArkTS)"> 使用ECDSA密钥对签名验签(ArkTS) </h1>

<div _ngcontent-wvb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-sign-sig-verify-overview#ecdsa">签名验签算法规格：ECDSA</a>。</p>    <p><strong>签名</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygenerator" target="_blank">cryptoFramework.createAsyKeyGenerator</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypair-1" target="_blank">AsyKeyGenerator.generateKeyPair</a>，生成非对称密钥算法为ECC、密钥长度为256的密钥对（KeyPair）。</p>      <p>如何生成ECC非对称密钥，开发者可参考下文示例，并结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#ecc">非对称密钥生成和转换规格：ECC</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-asym-key-pair-randomly">随机生成非对称密钥对</a>理解，参考文档与当前示例可能存在入参差异，请在阅读时注意区分。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatesign" target="_blank">cryptoFramework.createSign</a>，指定字符串参数'ECC256|SHA256'，创建非对称密钥类型为ECC256、摘要算法为SHA256的Sign实例，用于完成签名操作。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-3" target="_blank">Sign.init</a>，使用私钥（PriKey）初始化Sign实例。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-3" target="_blank">Sign.update</a>，传入待签名的数据。当前单次update长度没有限制，开发者可以根据数据量判断如何调用update。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#sign-1" target="_blank">Sign.sign</a>，生成数据签名。</p></li>    </ol>    <p><strong>验签</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateverify" target="_blank">cryptoFramework.createVerify</a>，指定字符串参数'ECC256|SHA256'，创建非对称密钥类型为ECC256、摘要算法为SHA256的Verify实例，用于完成验签操作。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-5" target="_blank">Verify.init</a>，使用公钥（PubKey）初始化Verify实例。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-5" target="_blank">Verify.update</a>，传入待验证的数据。当前单次update长度没有限制，开发者可以根据数据量判断如何调用update。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#verify-1" target="_blank">Verify.verify</a>，对数据进行验签。</p></li>    </ol>    <ul>     <li>      <p>异步方法示例：</p>      <div _ngcontent-wvb-c106="" class="highlight-div"><div _ngcontent-wvb-c106="" class="highlight-div-header"><div _ngcontent-wvb-c106="" class="highlight-div-header-left"><div _ngcontent-wvb-c106="" class="handle-button expand-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wvb-c106="" class="highlight-div-header-right"><div _ngcontent-wvb-c106="" class="handle-button ai-button"></div><div _ngcontent-wvb-c106="" class="handle-button line-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wvb-c106="" class="handle-button theme-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wvb-c106="" class="handle-button copy-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wvb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 完整的明文被拆分为input1和input2。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">input1</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"This is Sign test plan1"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">input2</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"This is Sign test plan2"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">signMessagePromise</span>(<span class="hljs-params">priKey: cryptoFramework.PriKey</span>) {</li><li>  <span class="hljs-keyword">let</span> signAlg = <span class="hljs-string">"ECC256|SHA256"</span>;</li><li>  <span class="hljs-keyword">let</span> signer = cryptoFramework.<span class="hljs-title function_">createSign</span>(signAlg);</li><li>  <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">init</span>(priKey);</li><li>  <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">update</span>(input1); <span class="hljs-comment">// 如果明文较短，可以直接调用sign接口一次性传入。</span></li><li>  <span class="hljs-keyword">let</span> signData = <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">sign</span>(input2);</li><li>  <span class="hljs-keyword">return</span> signData;</li><li>}</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyMessagePromise</span>(<span class="hljs-params">signMessageBlob: cryptoFramework.DataBlob, pubKey: cryptoFramework.PubKey</span>) {</li><li>  <span class="hljs-keyword">let</span> verifyAlg = <span class="hljs-string">"ECC256|SHA256"</span>;</li><li>  <span class="hljs-keyword">let</span> verifier = cryptoFramework.<span class="hljs-title function_">createVerify</span>(verifyAlg);</li><li>  <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">init</span>(pubKey);</li><li>  <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">update</span>(input1); <span class="hljs-comment">// 如果明文较短，可以直接调用verify接口一次性传入。</span></li><li>  <span class="hljs-keyword">let</span> res = <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">verify</span>(input2, signMessageBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"verify result is "</span> + res);</li><li>  <span class="hljs-keyword">return</span> res;</li><li>}</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> keyGenAlg = <span class="hljs-string">"ECC256"</span>;</li><li>  <span class="hljs-keyword">let</span> generator = cryptoFramework.<span class="hljs-title function_">createAsyKeyGenerator</span>(keyGenAlg);</li><li>  <span class="hljs-keyword">let</span> keyPair = <span class="hljs-keyword">await</span> generator.<span class="hljs-title function_">generateKeyPair</span>();</li><li>  <span class="hljs-keyword">let</span> signData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">signMessagePromise</span>(keyPair.<span class="hljs-property">priKey</span>);</li><li>  <span class="hljs-keyword">let</span> verifyResult = <span class="hljs-keyword">await</span> <span class="hljs-title function_">verifyMessagePromise</span>(signData, keyPair.<span class="hljs-property">pubKey</span>);</li><li>  <span class="hljs-keyword">if</span> (verifyResult === <span class="hljs-literal">true</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'verify success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'verify failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>同步方法示例：</p>      <div _ngcontent-wvb-c106="" class="highlight-div"><div _ngcontent-wvb-c106="" class="highlight-div-header"><div _ngcontent-wvb-c106="" class="highlight-div-header-left"><div _ngcontent-wvb-c106="" class="handle-button expand-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wvb-c106="" class="highlight-div-header-right"><div _ngcontent-wvb-c106="" class="handle-button ai-button"></div><div _ngcontent-wvb-c106="" class="handle-button line-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wvb-c106="" class="handle-button theme-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wvb-c106="" class="handle-button copy-button"><div _ngcontent-wvb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wvb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 完整的明文被拆分为input1和input2。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">input1</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"This is Sign test plan1"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">input2</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"This is Sign test plan2"</span>, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">signMessagePromise</span>(<span class="hljs-params">priKey: cryptoFramework.PriKey</span>) {</li><li>  <span class="hljs-keyword">let</span> signAlg = <span class="hljs-string">"ECC256|SHA256"</span>;</li><li>  <span class="hljs-keyword">let</span> signer = cryptoFramework.<span class="hljs-title function_">createSign</span>(signAlg);</li><li>  signer.<span class="hljs-title function_">initSync</span>(priKey);</li><li>  signer.<span class="hljs-title function_">updateSync</span>(input1); <span class="hljs-comment">// 如果明文较短，可以直接调用sign接口一次性传入。</span></li><li>  <span class="hljs-keyword">let</span> signData = signer.<span class="hljs-title function_">signSync</span>(input2);</li><li>  <span class="hljs-keyword">return</span> signData;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyMessagePromise</span>(<span class="hljs-params">signMessageBlob: cryptoFramework.DataBlob, pubKey: cryptoFramework.PubKey</span>) {</li><li>  <span class="hljs-keyword">let</span> verifyAlg = <span class="hljs-string">"ECC256|SHA256"</span>;</li><li>  <span class="hljs-keyword">let</span> verifier = cryptoFramework.<span class="hljs-title function_">createVerify</span>(verifyAlg);</li><li>  verifier.<span class="hljs-title function_">initSync</span>(pubKey);</li><li>  verifier.<span class="hljs-title function_">updateSync</span>(input1); <span class="hljs-comment">// 如果明文较短，可以直接调用verify接口一次性传入。</span></li><li>  <span class="hljs-keyword">let</span> res = verifier.<span class="hljs-title function_">verifySync</span>(input2, signMessageBlob);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"verify result is "</span> + res);</li><li>  <span class="hljs-keyword">return</span> res;</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> keyGenAlg = <span class="hljs-string">"ECC256"</span>;</li><li>  <span class="hljs-keyword">let</span> generator = cryptoFramework.<span class="hljs-title function_">createAsyKeyGenerator</span>(keyGenAlg);</li><li>  <span class="hljs-keyword">let</span> keyPair = generator.<span class="hljs-title function_">generateKeyPairSync</span>();</li><li>  <span class="hljs-keyword">let</span> signData = <span class="hljs-title function_">signMessagePromise</span>(keyPair.<span class="hljs-property">priKey</span>);</li><li>  <span class="hljs-keyword">let</span> verifyResult = <span class="hljs-title function_">verifyMessagePromise</span>(signData, keyPair.<span class="hljs-property">pubKey</span>);</li><li>  <span class="hljs-keyword">if</span> (verifyResult === <span class="hljs-literal">true</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'verify success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'verify failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>    </ul>   </div>   <div></div></div>