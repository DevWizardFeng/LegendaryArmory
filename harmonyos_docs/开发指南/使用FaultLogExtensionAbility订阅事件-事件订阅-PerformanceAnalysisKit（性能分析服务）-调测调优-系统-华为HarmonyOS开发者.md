<h1 _ngcontent-umn-c119="" class="doc-title ng-star-inserted" title="使用FaultLogExtensionAbility订阅事件"> 使用FaultLogExtensionAbility订阅事件 </h1>

<div _ngcontent-umn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 21开始，FaultLogExtensionAbility提供了事件订阅接口，用于应用故障事件（包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cppcrash-guidelines">崩溃</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/appfreeze-guidelines">冻屏</a>事件）的延迟通知。当应用无法启动或长时间未启动，可以不依赖应用启动而实现故障的hiAppEvent订阅上报。</p>    <p>FaultLogExtensionAbility仅在应用发生崩溃或冻屏事件，并且应用长时间未被重新启动的情况下，用于补充处理故障事件，不能替代<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/process-model-stage#基本进程类型">主进程</a>正常启动时进行故障事件处理。</p>    <p>应用发生崩溃或者冻屏事件30分钟后拉起FaultLogExtensionAbility进程，实际拉起时间可能会因为系统调度有所延迟。该30分钟是设备非休眠状态下累积的时间。测试时需要保持测试设备屏幕常亮，防止设备休眠。灭屏状态下设备可能会休眠，导致实际接收到回调的时间延长。</p>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>FaultLogExtensionAbility被拉起后只有很短的时间完成故障处理，建议处理时间不要超过10秒。超时没有处理完成可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability#ondisconnect" target="_blank">onDisconnect</a>中保存状态。</p></li>      <li>       <p>从开机或上次拉起FaultLogExtensionAbility后，应用首次触发崩溃或冻屏开始计时。在拉起FaultLogExtensionAbility前反复触发崩溃或冻屏事件均不会重新计时。计时30分钟后拉起FaultLogExtensionAbility进程。</p></li>      <li>       <p>FaultLogExtensionAbility自身崩溃时，不会再次被系统服务拉起。</p></li>      <li>       <p>FaultLogExtensionAbility调用限制的API名单见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability#附录" target="_blank">附录</a>。</p></li>      <li>       <p>FaultLogExtensionAbility进程中订阅的事件需要在主进程中使用hiAppEvent进行订阅。否则，会出现在<a href="/consumer/cn/doc/harmonyos-guides/fault-log-extension-app-events-arkts#faultlogextensionability进程没有接收到回调事件">FaultLogExtensionAbility进程没有接收到回调事件</a>的问题。</p></li>      <li>       <p>FaultLogExtensionAbility进程中仅订阅崩溃、应用冻屏事件，不订阅除这两类外的系统事件。否则，会发生<a href="/consumer/cn/doc/harmonyos-guides/fault-log-extension-app-events-arkts#系统事件重复上报">系统事件重复上报</a>的问题。</p></li>      <li>       <p>FaultLogExtensionAbility进程和主进程定义的watcher名字不能重复。否则，会发生<a href="/consumer/cn/doc/harmonyos-guides/fault-log-extension-app-events-arkts#部分事件丢失">部分事件丢失</a>的问题。</p></li>      <li>       <p>接入FaultLogExtensionAbility能力后，若应用故障发生后设备重启，重启后不会拉起FaultLogExtensionAbility进程。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>API接口使用说明，包括参数使用限制和具体取值范围。请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability" target="_blank">@ohos.hiviewdfx.FaultLogExtensionAbility (故障延迟通知)</a>。</p>     <p>仅适用于Stage模型。</p>     <p><strong>订阅接口功能介绍</strong>：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.5.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability#onconnect" target="_blank">onConnect(): void</a></td>         <td class="cellrowborder" valign="top" width="50%">生命周期回调函数，系统连接FaultLogExtensionAbility时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability#ondisconnect" target="_blank">onDisconnect(): void</a></td>         <td class="cellrowborder" valign="top" width="50%">生命周期回调函数，系统断开FaultLogExtensionAbility时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-hiviewdfx-faultlogextensionability#onfaultreportready" target="_blank">onFaultReportReady(): void</a></td>         <td class="cellrowborder" valign="top" width="50%">生命周期回调函数，系统准备好故障信息后，回调该函数通知ability进行处理。回调函数中的业务逻辑建议不超过10s。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="事件订阅开发指导">事件订阅开发指导<i class="anchor-icon anchor-icon-link" anchorid="事件订阅开发指导" tips="复制节点链接"></i></h2>          <p>以订阅appfreeze事件为例，说明开发步骤。</p>     <ol>      <li>       <p>新建一个ArkTS应用工程。编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; pages &gt; Index.ets”文件。构造appfreeze故障的代码示例如下：</p>       <div _ngcontent-umn-c106="" class="highlight-div"><div _ngcontent-umn-c106="" class="highlight-div-header"><div _ngcontent-umn-c106="" class="highlight-div-header-left"><div _ngcontent-umn-c106="" class="handle-button expand-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umn-c106="" class="highlight-div-header-right"><div _ngcontent-umn-c106="" class="handle-button ai-button"></div><div _ngcontent-umn-c106="" class="handle-button line-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umn-c106="" class="handle-button theme-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umn-c106="" class="handle-button copy-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">"AppInput"</span>).</li><li>    .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> t = <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>();</li><li>      <span class="hljs-keyword">while</span> (<span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>() - t &lt;= <span class="hljs-number">15000</span>) {}</li><li>    })</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>编辑工程中的“entry &gt; src &gt; main &gt; ets &gt; entryability &gt; EntryAbility.ets”文件，示例代码如下：</p>       <div _ngcontent-umn-c106="" class="highlight-div"><div _ngcontent-umn-c106="" class="highlight-div-header"><div _ngcontent-umn-c106="" class="highlight-div-header-left"><div _ngcontent-umn-c106="" class="handle-button expand-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umn-c106="" class="highlight-div-header-right"><div _ngcontent-umn-c106="" class="handle-button ai-button"></div><div _ngcontent-umn-c106="" class="handle-button line-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umn-c106="" class="handle-button theme-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umn-c106="" class="handle-button copy-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入hiAppEvent依赖模块</span></li><li><span class="hljs-keyword">import</span> { hiAppEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-comment">// 略去的代码...</span></li><li>  <span class="hljs-comment">// 在onCreate函数中添加系统事件的订阅</span></li><li>  hiAppEvent.<span class="hljs-property">addWatcher</span> ({</li><li>   <span class="hljs-comment">// 开发者可以自定义观察者名称，系统会使用名称来标识不同的观察者</span></li><li>   <span class="hljs-attr">name</span>: <span class="hljs-string">"EntryAbilityWatcher"</span>,</li><li>   <span class="hljs-comment">// 开发者可以订阅感兴趣的系统事件，此处是订阅了应用冻屏事件</span></li><li>   <span class="hljs-attr">appEventFilters</span>: [</li><li>     {</li><li>       <span class="hljs-attr">domain</span>: hiAppEvent.<span class="hljs-property">domain</span>.<span class="hljs-property">OS</span>,</li><li>       <span class="hljs-attr">names</span>: [hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">APP_FREEZE</span>]</li><li>     }</li><li>   ]</li><li> });</li><li><span class="hljs-comment">// 略去的代码...</span></li></ol></pre></div></div></li>      <li>       <p>在“entry &gt; src &gt; main &gt; ets” 路径下，新建faultlogextension/MyFaultLogExtensionAbility.ets文件。新建类MyFaultLogExtensionAbility继承FaultLogExtensionAbility，重写订阅功能相关的三个接口函数，代码示例如下：</p>       <div _ngcontent-umn-c106="" class="highlight-div"><div _ngcontent-umn-c106="" class="highlight-div-header"><div _ngcontent-umn-c106="" class="highlight-div-header-left"><div _ngcontent-umn-c106="" class="handle-button expand-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umn-c106="" class="highlight-div-header-right"><div _ngcontent-umn-c106="" class="handle-button ai-button"></div><div _ngcontent-umn-c106="" class="handle-button line-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umn-c106="" class="handle-button theme-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umn-c106="" class="handle-button copy-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入需要继承的类FaultLogExtensionAbility</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">FaultLogExtensionAbility</span>, hilog, hiAppEvent } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyFaultLogExtensionAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">FaultLogExtensionAbility</span> {</li><li> <span class="hljs-comment">// 重写onConnect函数</span></li><li> <span class="hljs-title function_">onConnect</span>(<span class="hljs-params"></span>) {</li><li>   hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`FaultLogExtensionAbility onConnect`</span>);</li><li> }</li><li>
</li><li> <span class="hljs-comment">// 重写onDisconnect函数</span></li><li> <span class="hljs-title function_">onDisconnect</span>(<span class="hljs-params"></span>) {</li><li>   hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`FaultLogExtensionAbility onDisconnect`</span>);</li><li> }</li><li>
</li><li> <span class="hljs-comment">// 重写onFaultReportReady函数</span></li><li> <span class="hljs-title function_">onFaultReportReady</span>(<span class="hljs-params"></span>) {</li><li>   hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`FaultLogExtensionAbility onFaultReportReady`</span>);</li><li>   hiAppEvent.<span class="hljs-title function_">addWatcher</span>({</li><li>     <span class="hljs-comment">// 开发者可以自定义观察者名称，系统会使用名称来标识不同的观察者</span></li><li>     <span class="hljs-attr">name</span>: <span class="hljs-string">"FaultLogExtensionAbilityWatcher"</span>,</li><li>     <span class="hljs-comment">// 开发者可以订阅感兴趣的系统事件，此处是订阅了应用冻屏事件</span></li><li>     <span class="hljs-attr">appEventFilters</span>: [</li><li>       {</li><li>         <span class="hljs-attr">domain</span>: hiAppEvent.<span class="hljs-property">domain</span>.<span class="hljs-property">OS</span>,</li><li>         <span class="hljs-attr">names</span>: [hiAppEvent.<span class="hljs-property">event</span>.<span class="hljs-property">APP_FREEZE</span>]</li><li>       }</li><li>     ],</li><li>     <span class="hljs-comment">// 开发者可以自行实现订阅回调函数，以便对订阅获取到的事件数据进行自定义处理</span></li><li>     <span class="hljs-attr">onReceive</span>: <span class="hljs-function">(<span class="hljs-params">domain: <span class="hljs-built_in">string</span>, appEventGroups: <span class="hljs-built_in">Array</span>&lt;hiAppEvent.AppEventGroup&gt;</span>) =&gt;</span> {</li><li>       hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent onReceive: domain=<span class="hljs-subst">${domain}</span>`</span>);</li><li>       <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventGroup <span class="hljs-keyword">of</span> appEventGroups) {</li><li>         <span class="hljs-comment">// 开发者可以根据事件集合中的事件名称区分不同的系统事件</span></li><li>         hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventName=<span class="hljs-subst">${eventGroup.name}</span>`</span>);</li><li>         <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> eventInfo <span class="hljs-keyword">of</span> eventGroup.<span class="hljs-property">appEventInfos</span>) {</li><li>           <span class="hljs-comment">// 开发者可以对事件集合中的事件数据进行自定义处理，此处是将事件数据打印在日志中</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.domain=<span class="hljs-subst">${eventInfo.domain}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.name=<span class="hljs-subst">${eventInfo.name}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.eventType=<span class="hljs-subst">${eventInfo.eventType}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生的时间戳</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.time=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'time'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时应用的前后台状态</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.foreground=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'foreground'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时应用的版本信息</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.bundle_version=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'bundle_version'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时应用的包名</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.bundle_name=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'bundle_name'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时应用的进程名称</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.process_name=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'process_name'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时应用的进程id</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.pid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'pid'</span>]}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.uid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'uid'</span>]}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.uuid=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'uuid'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生的异常类型、异常原因</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.exception=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo.params[<span class="hljs-string">'exception'</span>])}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时日志信息</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.hilog.size=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'hilog'</span>].length}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时主线程未处理消息</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.event_handler=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'event_handler'</span>]}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.event_handler_size_3s=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'event_handler_size_3s'</span>]}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.event_handler_size_6s=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'event_handler_size_6s'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时同步binder调用信息</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.peer_binder=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'peer_binder'</span>]}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时全量线程调用栈</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.threads.size=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'threads'</span>].length}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时内存信息</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.memory=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo.params[<span class="hljs-string">'memory'</span>])}</span>`</span>);</li><li>           <span class="hljs-comment">// 开发者可以获取到应用冻屏事件发生时的故障日志文件</span></li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.external_log=<span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(eventInfo.params[<span class="hljs-string">'external_log'</span>])}</span>`</span>);</li><li>           hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`HiAppEvent eventInfo.params.log_over_limit=<span class="hljs-subst">${eventInfo.params[<span class="hljs-string">'log_over_limit'</span>]}</span>`</span>);</li><li>         }</li><li>       }</li><li>     }</li><li>   });</li><li> }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>编辑工程中的“entry &gt; src &gt; main &gt; module.json5” 文件，新增相关的extensionAbility信息，文件新增修改的部分示例如下：</p>       <div _ngcontent-umn-c106="" class="highlight-div"><div _ngcontent-umn-c106="" class="highlight-div-header"><div _ngcontent-umn-c106="" class="highlight-div-header-left"><div _ngcontent-umn-c106="" class="handle-button expand-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umn-c106="" class="highlight-div-header-right"><div _ngcontent-umn-c106="" class="handle-button ai-button"></div><div _ngcontent-umn-c106="" class="handle-button line-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umn-c106="" class="handle-button theme-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umn-c106="" class="handle-button copy-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"extensionAbilities"</span>: [</li><li>  {</li><li>    <span class="hljs-string">"name"</span> : <span class="hljs-string">"MyFaultLogExtensionAbility"</span>,</li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/faultlogextension/MyFaultLogExtensionAbility.ets"</span>,</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"faultLog"</span></li><li>  }</li><li>]</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="调测验证">调测验证<i class="anchor-icon anchor-icon-link" anchorid="调测验证" tips="复制节点链接"></i></h2>          <p>点击DevEco Studio界面的运行按钮，启动应用工程。在应用界面点击“AppInput”按钮，触发冻屏事件。应用退出后，设备不得重启，等待30分钟左右。</p>     <p>在HiLog窗口搜索“testTag”关键字，查看FaultLogExtensionAbility执行回调函数的结果：</p>     <div _ngcontent-umn-c106="" class="highlight-div"><div _ngcontent-umn-c106="" class="highlight-div-header"><div _ngcontent-umn-c106="" class="highlight-div-header-left"><div _ngcontent-umn-c106="" class="handle-button expand-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-umn-c106="" class="highlight-div-header-right"><div _ngcontent-umn-c106="" class="handle-button ai-button"></div><div _ngcontent-umn-c106="" class="handle-button line-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-umn-c106="" class="handle-button theme-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-umn-c106="" class="handle-button copy-button"><div _ngcontent-umn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-umn-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>FaultLogExtensionAbility onConnect</li><li>FaultLogExtensionAbility onFaultReportReady</li><li>HiAppEvent onReceive: domain=OS</li><li>HiAppEvent eventName=APP_FREEZE</li><li>HiAppEvent eventInfo.domain=OS</li><li>HiAppEvent eventInfo.name=APP_FREEZE</li><li>HiAppEvent eventInfo.eventType=1</li><li>......</li><li>FaultLogExtensionAbility onDisconnect</li></ol></pre></div></div>     <p>表示FaultLogExtensionAbility依次执行连接、处理和断开。</p>    </div>    <div class="tiledSection">     <h2 id="faultlogextensionability常见问题">FaultLogExtensionAbility常见问题<i class="anchor-icon anchor-icon-link" anchorid="faultlogextensionability常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="faultlogextensionability进程没有接收到回调事件" class="firsth2">FaultLogExtensionAbility进程没有接收到回调事件<i class="anchor-icon anchor-icon-link" anchorid="faultlogextensionability进程没有接收到回调事件" tips="复制节点链接"></i></h3>          <p>FaultLogExtensionAbility进程启动后，没有收到hiAppEvent订阅的回调。可能是以下原因导致：</p>     <ul>      <li>在FaultLogExtensionAbility进程启动前，主进程已经订阅并处理了事件。</li>      <li>在FaultLogExtensionAbility进程中的订阅是应用安装后的首次订阅。hiAppEvent不感知在订阅操作前发生的事件，需要主进程中正常订阅相关事件，发生故障后hiAppEvent才会记录相关事件，在拉起FaultLogExtensionAbility后进行回调。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="系统事件重复上报">系统事件重复上报<i class="anchor-icon anchor-icon-link" anchorid="系统事件重复上报" tips="复制节点链接"></i></h3>          <p>系统事件将通过hiAppEvent回调通知所有订阅了该事件的事件观察者。当FaultLogExtensionAbility进程与主进程同时存在，并且均订阅了同一个系统事件时，触发该系统事件后，两个进程皆将接收到相应的事件回调。</p>    </div>    <div class="tiledSection">     <h3 id="部分事件丢失">部分事件丢失<i class="anchor-icon anchor-icon-link" anchorid="部分事件丢失" tips="复制节点链接"></i></h3>          <p>在应用启动之后，事件观察者注册之前发生的事件丢失。检查是否注册了多个同名的事件观察者。</p>     <p>hiAppEvent为了保障事件不丢失，hiAppEvent在应用启动后，事件观察者注册前会先扫描应用上次退出前未移除的事件观察者的订阅过滤条件，并据此对事件进行订阅保存。 重复注册相同名称的事件观察者，后一次注册的事件观察者信息会覆盖前一次的事件观察者信息，导致订阅过滤条件被覆盖，事件丢失。</p>    </div>   </div>   <div></div></div>