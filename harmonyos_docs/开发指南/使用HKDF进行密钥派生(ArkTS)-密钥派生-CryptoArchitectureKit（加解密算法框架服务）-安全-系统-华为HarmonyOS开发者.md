<h1 _ngcontent-qnk-c119="" class="doc-title ng-star-inserted" title="使用HKDF进行密钥派生(ArkTS)"> 使用HKDF进行密钥派生(ArkTS) </h1>

<div _ngcontent-qnk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对应算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-key-derivation-overview#hkdf算法">密钥派生算法规格：HKDF</a>。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>构造<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#hkdfspec12" target="_blank">HKDFSpec</a>对象，作为密钥派生参数进行密钥派生。</p>       <p>HKDFSpec是<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#kdfspec11" target="_blank">KdfSpec</a>的子类，需要指定：</p>       <ul>        <li>algName：指定算法'HKDF'。</li>        <li>         <p>key：原始密钥材料。</p>         <p>如果使用string类型，需要直接传入用于密钥派生的数据，而不是HexString、base64等字符串类型。同时需要确保该字符串为utf-8编码，否则派生结果会有差异。</p></li>        <li>salt：盐值。</li>        <li>info：可选的上下文与应用相关信息， 可为空，用于拓展短密钥。</li>        <li>keySize：目标密钥的字节长度，需要为正整数。</li>       </ul></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatekdf11" target="_blank">cryptoFramework.createKdf</a>，指定字符串参数'HKDF|SHA256|EXTRACT_AND_EXPAND'，创建密钥派生算法为HKDF、HMAC函数摘要算法为SHA256、模式为提取和拓展的密钥派生函数对象（Kdf）。</p></li>      <li>       <p>输入HKDFSpec对象，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatesecret11" target="_blank">Kdf.generateSecret</a>进行密钥派生。</p>       <p>Kdf.generateSecret的多种调用形式如表所示。</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.3.1.3.1.1" valign="top" width="50%">接口名</th>           <th align="left" class="cellrowborder" id="mcps1.3.2.2.3.3.1.3.1.2" valign="top" width="50%">返回方式</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">generateSecret(params: KdfSpec, callback: AsyncCallback&lt;DataBlob&gt;): void</td>           <td class="cellrowborder" valign="top" width="50%">callback异步生成。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">generateSecret(params: KdfSpec): Promise&lt;DataBlob&gt;</td>           <td class="cellrowborder" valign="top" width="50%">Promise异步生成。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">generateSecretSync(params: KdfSpec): DataBlob</td>           <td class="cellrowborder" valign="top" width="50%">同步生成。</td>          </tr>                 </tbody></table></div>       </div></li>     </ol>     <ul>      <li>       <p>通过await返回结果：</p>       <div _ngcontent-qnk-c106="" class="highlight-div"><div _ngcontent-qnk-c106="" class="highlight-div-header"><div _ngcontent-qnk-c106="" class="highlight-div-header-left"><div _ngcontent-qnk-c106="" class="handle-button expand-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnk-c106="" class="highlight-div-header-right"><div _ngcontent-qnk-c106="" class="handle-button ai-button"></div><div _ngcontent-qnk-c106="" class="handle-button line-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnk-c106="" class="handle-button theme-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnk-c106="" class="handle-button copy-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">kdfAwait</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"012345678901234567890123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> saltData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"0123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> infoData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"infostring"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">HKDFSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'HKDF'</span>,</li><li>    <span class="hljs-attr">key</span>: keyData,</li><li>    <span class="hljs-attr">salt</span>: saltData,</li><li>    <span class="hljs-attr">info</span>: infoData,</li><li>    <span class="hljs-attr">keySize</span>: <span class="hljs-number">32</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> kdf = cryptoFramework.<span class="hljs-title function_">createKdf</span>(<span class="hljs-string">'HKDF|SHA256|EXTRACT_AND_EXPAND'</span>);</li><li>  <span class="hljs-keyword">let</span> secret = <span class="hljs-keyword">await</span> kdf.<span class="hljs-title function_">generateSecret</span>(spec);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"key derivation output is "</span> + secret.<span class="hljs-property">data</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过Promise返回结果：</p>       <div _ngcontent-qnk-c106="" class="highlight-div"><div _ngcontent-qnk-c106="" class="highlight-div-header"><div _ngcontent-qnk-c106="" class="highlight-div-header-left"><div _ngcontent-qnk-c106="" class="handle-button expand-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnk-c106="" class="highlight-div-header-right"><div _ngcontent-qnk-c106="" class="handle-button ai-button"></div><div _ngcontent-qnk-c106="" class="handle-button line-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnk-c106="" class="handle-button theme-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnk-c106="" class="handle-button copy-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">kdfPromise</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"012345678901234567890123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> saltData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"0123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> infoData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"infostring"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">HKDFSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'HKDF'</span>,</li><li>    <span class="hljs-attr">key</span>: keyData,</li><li>    <span class="hljs-attr">salt</span>: saltData,</li><li>    <span class="hljs-attr">info</span>: infoData,</li><li>    <span class="hljs-attr">keySize</span>: <span class="hljs-number">32</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> kdf = cryptoFramework.<span class="hljs-title function_">createKdf</span>(<span class="hljs-string">'HKDF|SHA256|EXTRACT_AND_EXPAND'</span>);</li><li>  <span class="hljs-keyword">let</span> kdfPromise = kdf.<span class="hljs-title function_">generateSecret</span>(spec);</li><li>  kdfPromise.<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">secret</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"key derivation output is "</span> + secret.<span class="hljs-property">data</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"key derivation error."</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过同步方式返回结果：</p>       <div _ngcontent-qnk-c106="" class="highlight-div"><div _ngcontent-qnk-c106="" class="highlight-div-header"><div _ngcontent-qnk-c106="" class="highlight-div-header-left"><div _ngcontent-qnk-c106="" class="handle-button expand-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qnk-c106="" class="highlight-div-header-right"><div _ngcontent-qnk-c106="" class="handle-button ai-button"></div><div _ngcontent-qnk-c106="" class="handle-button line-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qnk-c106="" class="handle-button theme-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qnk-c106="" class="handle-button copy-button"><div _ngcontent-qnk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qnk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">kdfSync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> keyData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"012345678901234567890123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> saltData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"0123456789"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> infoData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(<span class="hljs-string">"infostring"</span>, <span class="hljs-string">"utf-8"</span>).<span class="hljs-property">buffer</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">spec</span>: cryptoFramework.<span class="hljs-property">HKDFSpec</span> = {</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">'HKDF'</span>,</li><li>    <span class="hljs-attr">key</span>: keyData,</li><li>    <span class="hljs-attr">salt</span>: saltData,</li><li>    <span class="hljs-attr">info</span>: infoData,</li><li>    <span class="hljs-attr">keySize</span>: <span class="hljs-number">32</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> kdf = cryptoFramework.<span class="hljs-title function_">createKdf</span>(<span class="hljs-string">'HKDF|SHA256|EXTRACT_AND_EXPAND'</span>);</li><li>  <span class="hljs-keyword">let</span> secret = kdf.<span class="hljs-title function_">generateSecretSync</span>(spec);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"[Sync]key derivation output is "</span> + secret.<span class="hljs-property">data</span>);</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>