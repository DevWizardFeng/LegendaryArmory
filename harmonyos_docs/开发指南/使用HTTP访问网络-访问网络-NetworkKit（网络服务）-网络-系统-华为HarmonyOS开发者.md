<h1 _ngcontent-asn-c119="" class="doc-title ng-star-inserted" title="使用HTTP访问网络"> 使用HTTP访问网络 </h1>

<div _ngcontent-asn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>应用通过HTTP发起一个数据请求，支持常见的GET、POST、OPTIONS、HEAD、PUT、DELETE、TRACE、CONNECT方法。当前提供了2种HTTP请求方式，若请求发送或接收的数据量较少，可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-http#request" target="_blank">HttpRequest.request</a>，若是大文件的上传或者下载，且关注数据发送和接收进度，可使用HTTP请求流式传输<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-http#requestinstream10" target="_blank">HttpRequest.requestInstream</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>HTTP模块提供了标准的HTTP网络服务能力，Remote Communication Kit（远场通信服务）提供了场景化的网络服务能力，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/remote-communication-introduction" target="_blank">Remote Communication Kit简介</a>，应用可根据自己的需要选择使用。</p>      </div></div></div>     <p>当前HTTP请求支持的场景如下，以下功能对应的选项可以在HTTP请求的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-http#httprequestoptions" target="_blank">HttpRequestOptions</a>中进行设置：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.1" valign="top" width="25%">功能分类</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.2" valign="top" width="25%">功能名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.3" valign="top" width="25%">功能描述</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.5.1.5.1.4" valign="top" width="25%">开始支持的版本</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置请求方式</td>         <td class="cellrowborder" valign="top" width="25%">支持GET、POST、HEAD、PUT、DELETE、TRACE、CONNECT、OPTIONS方法，默认为GET。</td>         <td class="cellrowborder" valign="top" width="25%">API version 6</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置请求额外数据</td>         <td class="cellrowborder" valign="top" width="25%">支持发送请求时同步携带额外数据，默认无此字段。</td>         <td class="cellrowborder" valign="top" width="25%">API version 6</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置读取超时时间</td>         <td class="cellrowborder" valign="top" width="25%">该参数设置的是从请求开始到请求结束的总时间，包括DNS解析、连接建立、传输等。单位为毫秒（ms），默认为60000ms。</td>         <td class="cellrowborder" valign="top" width="25%">API version 6</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置连接超时时间</td>         <td class="cellrowborder" valign="top" width="25%">该参数设置的是连接超时时间。单位为毫秒（ms），默认为60000ms。</td>         <td class="cellrowborder" valign="top" width="25%">API version 6</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置HTTP请求头</td>         <td class="cellrowborder" valign="top" width="25%">当请求方式为"POST" "PUT" "DELETE" 或者""时，默认{'content-Type': 'application/json'}， 否则默认{'content-Type': 'application/x-www-form-urlencoded'}。</td>         <td class="cellrowborder" valign="top" width="25%">API version 6</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置响应数据类型</td>         <td class="cellrowborder" valign="top" width="25%">可以指定HTTP响应数据的类型，默认无此字段。如果设置了此参数，系统将优先返回指定的类型。</td>         <td class="cellrowborder" valign="top" width="25%">API version 9</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置请求并发优先级</td>         <td class="cellrowborder" valign="top" width="25%">指定HTTP/HTTPS请求并发优先级，值越大优先级越高，范围[1,1000]，默认为1。</td>         <td class="cellrowborder" valign="top" width="25%">API version 9</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置是否使用缓存</td>         <td class="cellrowborder" valign="top" width="25%">可以指定是否使用缓存，默认为true，请求时优先读取缓存。 缓存跟随当前进程生效。新缓存会替换旧缓存，设置为false表示不使用缓存。</td>         <td class="cellrowborder" valign="top" width="25%">API version 9</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置使用协议类型</td>         <td class="cellrowborder" valign="top" width="25%">默认值由系统自动指定，用户可以指定为HTTP 1.1、HTTP 2、HTTP 3协议版本。</td>         <td class="cellrowborder" valign="top" width="25%">API version 9</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">代理设置</td>         <td class="cellrowborder" valign="top" width="25%">设置HTTP请求代理</td>         <td class="cellrowborder" valign="top" width="25%">设置HTTP代理，默认值为false，表示不使用代理，若设置为true，表示使用HTTP代理，且为系统默认代理，也可通过配置HttpProxy自定义网络代理。</td>         <td class="cellrowborder" valign="top" width="25%">API version 10</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置CA证书路径</td>         <td class="cellrowborder" valign="top" width="25%">如果设置了此参数，系统将使用用户指定路径的CA证书（开发者需保证该路径下CA证书的可访问性），否则将使用系统预设CA证书。</td>         <td class="cellrowborder" valign="top" width="25%">API version 10</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置支持传输客户端证书</td>         <td class="cellrowborder" valign="top" width="25%">支持传输客户端证书，包括证书路径、证书类型、证书密钥路径和密码信息。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置下载起始位置和结束位置</td>         <td class="cellrowborder" valign="top" width="25%">指定客户端要获取的数据范围，通常在下载文件时配置该参数。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置需要上传的数据字段表单列表</td>         <td class="cellrowborder" valign="top" width="25%">设置多部分表单数据，通常用于上传文件。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">DNS设置</td>         <td class="cellrowborder" valign="top" width="25%">设置使用HTTPS协议的服务器进行DNS解析</td>         <td class="cellrowborder" valign="top" width="25%">设置使用HTTPS协议的服务器进行DNS解析。参数必须根据以下格式进行URL编码:'https://host:port/path'。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">DNS设置</td>         <td class="cellrowborder" valign="top" width="25%">设置指定的DNS服务器进行DNS解析</td>         <td class="cellrowborder" valign="top" width="25%">设置指定的DNS服务器进行DNS解析。可以设置多个DNS解析服务器，最多3个服务器。如果有3个以上，只取前3个。服务器必须是IPV4或者IPV6地址形式。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">基础功能</td>         <td class="cellrowborder" valign="top" width="25%">设置响应消息的最大字节限制</td>         <td class="cellrowborder" valign="top" width="25%">响应消息的最大字节限制。以字节为单位，默认值为5*1024*1024，最大值为100*1024*1024。</td>         <td class="cellrowborder" valign="top" width="25%">API version 11</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置动态设置证书锁定配置</td>         <td class="cellrowborder" valign="top" width="25%">动态设置证书锁定配置，可以传入单个或多个证书PIN码。</td>         <td class="cellrowborder" valign="top" width="25%">API version 12</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置解析目标域名时限定地址类型</td>         <td class="cellrowborder" valign="top" width="25%">指定在解析目标域名时的地址类型，可以设置为：跟随系统网络配置、强制仅使用IPV4地址或者强制仅使用IPV6地址。</td>         <td class="cellrowborder" valign="top" width="25%">API version 15</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置跳过SSL证书校验</td>         <td class="cellrowborder" valign="top" width="25%">可以设置跳过SSL证书校验流程。</td>         <td class="cellrowborder" valign="top" width="25%">API version 18</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置证书校验的版本和加密套件</td>         <td class="cellrowborder" valign="top" width="25%">自定义证书校验版本和加密套件。</td>         <td class="cellrowborder" valign="top" width="25%">API version 18</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">证书验证</td>         <td class="cellrowborder" valign="top" width="25%">设置安全连接期间的服务器身份验证配置信息</td>         <td class="cellrowborder" valign="top" width="25%">设置安全连接期间的服务器身份验证配置。</td>         <td class="cellrowborder" valign="top" width="25%">API version 18</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="发起http数据请求">发起HTTP数据请求<i class="anchor-icon anchor-icon-link" anchorid="发起http数据请求" tips="复制节点链接"></i></h2>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>在本文档的示例中，通过this.context来获取UIAbilityContext，其中this代表继承自UIAbility的UIAbility实例。如需在页面中使用UIAbilityContext提供的能力，请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息">获取UIAbility的上下文信息</a>。</p>      </div></div></div>     <p>完整示例代码见：<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/NetWork_Kit/NetWorkKit_Datatransmission/HTTP_case" target="_blank">Http_case</a></p>     <ol>      <li>       <p>导入HTTP一般数据请求所需模块</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建HttpRequest对象</p>       <p>调用createHttp()方法，创建HttpRequest对象。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">UIAbilityContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-comment">// 每一个httpRequest对应一个HTTP请求任务，不可复用。</span></li><li><span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li></ol></pre></div></div></li>      <li>       <p>订阅HTTP响应头事件</p>       <p>调用该对象的on()方法，订阅HTTP响应头事件，此接口会比request请求先返回。可以根据业务需要订阅此消息。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 用于订阅HTTP响应头，此接口会比request请求先返回。可以根据业务需要订阅此消息。</span></li><li><span class="hljs-comment">// 从API 8开始，使用on('headersReceive', Callback)替代on('headerReceive', AsyncCallback)。</span></li><li>httpRequest.<span class="hljs-title function_">on</span>(<span class="hljs-string">'headersReceive'</span>, <span class="hljs-function">(<span class="hljs-params">header</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'header: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(header));</li><li>});</li></ol></pre></div></div></li>      <li>       <p>发起HTTP请求，解析服务器响应事件</p>       <p>调用该对象的request()方法，传入HTTP请求的url地址和可选参数，发起网络请求，按照实际业务需要，解析返回结果。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>httpRequest.<span class="hljs-title function_">request</span>(</li><li>  <span class="hljs-comment">// 填写HTTP请求的URL地址，可以带参数或不带参数。URL地址由开发者自定义。请求的参数可以在extraData中指定。</span></li><li>  <span class="hljs-string">"EXAMPLE_URL"</span>,</li><li>  {</li><li>    <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>, <span class="hljs-comment">// 可选，默认为http.RequestMethod.GET，用于从服务器获取数据，而POST方法用于向服务器上传数据。</span></li><li>    <span class="hljs-comment">// 开发者根据自身业务需要添加header字段。</span></li><li>    <span class="hljs-attr">header</span>: {</li><li>      <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span></li><li>    },</li><li>    <span class="hljs-comment">// 当使用POST请求时此字段用于传递请求体内容，具体格式与服务端协商确定。</span></li><li>    <span class="hljs-attr">extraData</span>: <span class="hljs-string">"data to send"</span>,</li><li>    <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>, <span class="hljs-comment">// 可选，指定返回数据的类型。</span></li><li>    <span class="hljs-attr">usingCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 可选，默认为true。</span></li><li>    <span class="hljs-attr">priority</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 可选，默认为1。</span></li><li>    <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 可选，默认为60000ms。</span></li><li>    <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 可选，默认为60000ms。</span></li><li>    <span class="hljs-attr">usingProtocol</span>: http.<span class="hljs-property">HttpProtocol</span>.<span class="hljs-property">HTTP1_1</span>, <span class="hljs-comment">// 可选，协议类型默认值由系统自动指定。</span></li><li>    <span class="hljs-attr">usingProxy</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 可选，默认不使用网络代理，自API 10开始支持该属性。</span></li><li>    <span class="hljs-attr">caPath</span>:<span class="hljs-string">'/path/to/cacert.pem'</span>, <span class="hljs-comment">// 可选，默认使用系统预制证书，自API 10开始支持该属性。</span></li><li>    <span class="hljs-attr">clientCert</span>: { <span class="hljs-comment">// 可选，默认不使用客户端证书，自API 11开始支持该属性。</span></li><li>      <span class="hljs-attr">certPath</span>: <span class="hljs-string">'/path/to/client.pem'</span>, <span class="hljs-comment">// 默认不使用客户端证书，自API 11开始支持该属性。</span></li><li>      <span class="hljs-attr">keyPath</span>: <span class="hljs-string">'/path/to/client.key'</span>, <span class="hljs-comment">// 若证书包含Key信息，传入空字符串，自API 11开始支持该属性。</span></li><li>      <span class="hljs-attr">certType</span>: http.<span class="hljs-property">CertType</span>.<span class="hljs-property">PEM</span>, <span class="hljs-comment">// 可选，默认使用PEM，自API 11开始支持该属性。</span></li><li>      <span class="hljs-attr">keyPassword</span>: <span class="hljs-string">"passwordToKey"</span> <span class="hljs-comment">// 可选，输入key文件的密码，自API 11开始支持该属性。</span></li><li>    },</li><li>    <span class="hljs-attr">multiFormDataList</span>: [ <span class="hljs-comment">// 可选，仅当Header中，'content-Type'为'multipart/form-data'时生效，自API 11开始支持该属性，该属性用于支持向服务器上传二进制数据，根据上传的具体数据类型进行选择。</span></li><li>      {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">"Part1"</span>, <span class="hljs-comment">// 数据名，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span>, <span class="hljs-comment">// 数据类型，自API 11开始支持该属性，上传的数据类型为普通文本文件。</span></li><li>        <span class="hljs-attr">data</span>: <span class="hljs-string">'Example data'</span>, <span class="hljs-comment">// 可选，数据内容，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'example.txt'</span> <span class="hljs-comment">// 可选，自API 11开始支持该属性。</span></li><li>      }, {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">"Part2"</span>, <span class="hljs-comment">// 数据名，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">'text/plain'</span>, <span class="hljs-comment">// 数据类型，自API 11开始支持该属性，上传的数据类型为普通文本文件。</span></li><li>        <span class="hljs-comment">// data/app/el2/100/base/com.example.myapplication/haps/entry/files/fileName.txt。</span></li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/fileName.txt`</span>, <span class="hljs-comment">// 可选，传入文件路径，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'fileName.txt'</span> <span class="hljs-comment">// 可选，自API 11开始支持该属性。</span></li><li>      }, {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">"Part3"</span>, <span class="hljs-comment">// 数据名，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">'image/png'</span>, <span class="hljs-comment">// 数据类型，自API 11开始支持该属性，上传的数据类型为png格式的图片。</span></li><li>        <span class="hljs-comment">// data/app/el2/100/base/com.example.myapplication/haps/entry/files/fileName.png。</span></li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/fileName.png`</span>, <span class="hljs-comment">// 可选，传入文件路径，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'fileName.png'</span> <span class="hljs-comment">// 可选，自API 11开始支持该属性。</span></li><li>      }, {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">"Part4"</span>, <span class="hljs-comment">// 数据名，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">'audio/mpeg'</span>, <span class="hljs-comment">// 数据类型，自API 11开始支持该属性，上传的数据类型为mpeg格式的音频。</span></li><li>        <span class="hljs-comment">// data/app/el2/100/base/com.example.myapplication/haps/entry/files/fileName.mpeg。</span></li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/fileName.mpeg`</span>, <span class="hljs-comment">// 可选，传入文件路径，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'fileName.mpeg'</span> <span class="hljs-comment">// 可选，自API 11开始支持该属性。</span></li><li>      }, {</li><li>        <span class="hljs-attr">name</span>: <span class="hljs-string">"Part5"</span>, <span class="hljs-comment">// 数据名，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">contentType</span>: <span class="hljs-string">'video/mp4'</span>, <span class="hljs-comment">// 数据类型，自API 11开始支持该属性，上传的数据类型为mp4格式的视频。</span></li><li>        <span class="hljs-comment">// data/app/el2/100/base/com.example.myapplication/haps/entry/files/fileName.mp4。</span></li><li>        <span class="hljs-attr">filePath</span>: <span class="hljs-string">`<span class="hljs-subst">${context.filesDir}</span>/fileName.mp4`</span>, <span class="hljs-comment">// 可选，传入文件路径，自API 11开始支持该属性。</span></li><li>        <span class="hljs-attr">remoteFileName</span>: <span class="hljs-string">'fileName.mp4'</span> <span class="hljs-comment">// 可选，自API 11开始支持该属性。</span></li><li>      }</li><li>    ]</li><li>  }, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: http.HttpResponse</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      <span class="hljs-comment">// data.result为HTTP响应内容，可根据业务需要进行解析。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Result:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">result</span>));</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'code:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">responseCode</span>));</li><li>      <span class="hljs-comment">// data.header为HTTP响应头，可根据业务需要进行解析。</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'header:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">header</span>));</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cookies:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data.<span class="hljs-property">cookies</span>)); <span class="hljs-comment">// 8+</span></li><li>      <span class="hljs-comment">// 当该请求使用完毕时，调用destroy方法主动销毁。</span></li><li>      httpRequest.<span class="hljs-title function_">destroy</span>();</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      <span class="hljs-comment">// 取消订阅HTTP响应头事件。</span></li><li>      httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'headersReceive'</span>);</li><li>      <span class="hljs-comment">// 当该请求使用完毕时，调用destroy方法主动销毁。</span></li><li>      httpRequest.<span class="hljs-title function_">destroy</span>();</li><li>    }</li><li>  }</li><li>);</li></ol></pre></div></div></li>      <li>       <p>取消订阅HTTP响应头事件</p>       <p>调用该对象的off()方法，取消订阅HTTP响应头事件。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在不需要该回调信息时，需要取消订阅HTTP响应头事件，该方法调用的时机，可以参考步骤4中的示例代码。</span></li><li>httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'headersReceive'</span>);</li></ol></pre></div></div></li>      <li>       <p>调用destroy()方法销毁</p>       <p>当该请求使用完毕时，调用destroy()方法销毁。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 当该请求使用完毕时，调用destroy方法主动销毁，该方法调用的时机，可以参考步骤4中的示例代码。</span></li><li>httpRequest.<span class="hljs-title function_">destroy</span>();</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="发起http流式传输请求">发起HTTP流式传输请求<i class="anchor-icon anchor-icon-link" anchorid="发起http流式传输请求" tips="复制节点链接"></i></h2>          <p>HTTP流式传输是指在处理HTTP响应时，可以一次只处理响应内容的一小部分，而不是一次性将整个响应加载到内存，这对于处理大文件、实时数据流等场景非常有用。</p>     <p>完整示例代码见：<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/NetWork_Kit/NetWorkKit_Datatransmission/HTTP_case" target="_blank">Http_case</a></p>     <ol>      <li>       <p>导入HTTP流式传输所需模块</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建HTTP流式传输HttpRequest对象</p>       <p>调用createHttp()方法，创建HttpRequest对象。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 每一个httpRequest对应一个HTTP请求任务，不可复用。</span></li><li><span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li></ol></pre></div></div></li>      <li>       <p>按需订阅HTTP流式响应事件</p>       <p>服务器响应的数据在dataReceive回调中返回，可通过订阅该信息获取服务器响应的数据，其他流式响应事件可按需进行订阅。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 用于订阅HTTP流式响应数据接收事件。</span></li><li><span class="hljs-keyword">let</span> res = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">0</span>);</li><li>httpRequest.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">const</span> newRes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(res.<span class="hljs-property">byteLength</span> + data.<span class="hljs-property">byteLength</span>);</li><li>  <span class="hljs-keyword">const</span> resView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(newRes);</li><li>  resView.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(res));</li><li>  resView.<span class="hljs-title function_">set</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(data), res.<span class="hljs-property">byteLength</span>);</li><li>  res = newRes;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'res length: '</span> + res.<span class="hljs-property">byteLength</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 用于订阅HTTP流式响应数据接收完毕事件。</span></li><li>httpRequest.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataEnd'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'No more data in response, data receive end'</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 订阅HTTP流式响应数据接收进度事件，下载服务器的数据时，可以通过该回调获取数据下载进度。</span></li><li>httpRequest.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceiveProgress'</span>, <span class="hljs-function">(<span class="hljs-params">data: http.DataReceiveProgressInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"dataReceiveProgress receiveSize:"</span> + data.<span class="hljs-property">receiveSize</span> + <span class="hljs-string">", totalSize:"</span> + data.<span class="hljs-property">totalSize</span>);</li><li>});</li><li>
</li><li><span class="hljs-comment">// 订阅HTTP流式响应数据发送进度事件，向服务器上传数据时，可以通过该回调获取数据上传进度。</span></li><li>httpRequest.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataSendProgress'</span>, <span class="hljs-function">(<span class="hljs-params">data: http.DataSendProgressInfo</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"dataSendProgress receiveSize:"</span> + data.<span class="hljs-property">sendSize</span> + <span class="hljs-string">", totalSize:"</span> + data.<span class="hljs-property">totalSize</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>发起HTTP流式请求，获取服务端数据</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">streamInfo</span>: http.<span class="hljs-property">HttpRequestOptions</span> = {</li><li>  <span class="hljs-attr">method</span>: http.<span class="hljs-property">RequestMethod</span>.<span class="hljs-property">POST</span>, <span class="hljs-comment">// 可选，默认为http.RequestMethod.GET，用于向服务器获取数据，而POST方法用于向服务器上传数据。</span></li><li>  <span class="hljs-comment">// 开发者根据自身业务需要添加header字段。</span></li><li>     <span class="hljs-attr">header</span>: {</li><li>    <span class="hljs-string">'Content-Type'</span>: <span class="hljs-string">'application/json'</span></li><li>     },</li><li>     <span class="hljs-comment">// 当使用POST请求时此字段用于传递请求体内容，具体格式与服务端协商确定。</span></li><li>  <span class="hljs-attr">extraData</span>: <span class="hljs-string">"data to send"</span>,</li><li>  <span class="hljs-attr">expectDataType</span>: http.<span class="hljs-property">HttpDataType</span>.<span class="hljs-property">STRING</span>,<span class="hljs-comment">// 可选，指定返回数据的类型。</span></li><li>  <span class="hljs-attr">usingCache</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// 可选，默认为true。</span></li><li>  <span class="hljs-attr">priority</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 可选，默认为1。</span></li><li>  <span class="hljs-attr">connectTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 可选，默认为60000ms。</span></li><li>  <span class="hljs-attr">readTimeout</span>: <span class="hljs-number">60000</span>, <span class="hljs-comment">// 可选，默认为60000ms。若传输的数据较大，需要较长的时间，建议增大该参数以保证数据传输正常终止。</span></li><li>  <span class="hljs-attr">usingProtocol</span>: http.<span class="hljs-property">HttpProtocol</span>.<span class="hljs-property">HTTP1_1</span>, <span class="hljs-comment">// 可选，协议类型默认值由系统自动指定。</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 填写HTTP请求的URL地址，可以带参数也可以不带参数。URL地址需要开发者自定义。请求的参数可以在extraData中指定。</span></li><li>httpRequest.<span class="hljs-title function_">requestInStream</span>(<span class="hljs-string">"EXAMPLE_URL"</span>, streamInfo).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"requestInStream OK!"</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'ResponseCode :'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  <span class="hljs-comment">// 取消订阅步骤3中订阅的事件，并调用destroy方法主动销毁。</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">destroyRequest</span>(httpRequest);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"requestInStream ERROR : err = "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  <span class="hljs-comment">// 取消订阅步骤3中订阅的事件，并调用destroy方法主动销毁。</span></li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">destroyRequest</span>(httpRequest);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>取消步骤3中订阅HTTP流式响应事件，并调用destroy()方法销毁流式HTTP请求</p>       <p>调用该对象的off()方法，取消订阅步骤3中的事件，并且当该请求使用完毕时，调用destroy()方法销毁，该方法调用的时机，可以参考步骤4中的示例代码。</p>       <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">public</span> <span class="hljs-title function_">destroyRequest</span>(<span class="hljs-params">httpRequest: http.HttpRequest</span>) {</li><li>  <span class="hljs-comment">// 取消订阅HTTP流式响应数据接收事件。</span></li><li>  httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>);</li><li>  <span class="hljs-comment">// 取消订阅HTTP流式响应数据发送进度事件。</span></li><li>  httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataSendProgress'</span>);</li><li>  <span class="hljs-comment">// 取消订阅HTTP流式响应数据接收进度事件。</span></li><li>  httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceiveProgress'</span>);</li><li>  <span class="hljs-comment">// 取消订阅HTTP流式响应数据接收完毕事件。</span></li><li>  httpRequest.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataEnd'</span>);</li><li>  <span class="hljs-comment">// 当该请求使用完毕时，调用destroy方法主动销毁。</span></li><li>  httpRequest.<span class="hljs-title function_">destroy</span>();</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="配置证书校验">配置证书校验<i class="anchor-icon anchor-icon-link" anchorid="配置证书校验" tips="复制节点链接"></i></h2>          <p>当应用使用HTTPS协议时，涉及证书相关配置。面向互联网用户提供服务的应用仅需信任系统预置的CA证书。当前HTTP模块已默认信任系统预置的CA证书，无需特别设置。如果应用需要锁定证书，只信任开发者特别指定的证书，或者需要跳过证书校验，可以参考以下说明进行配置。</p>    </div>    <div class="tiledSection">     <h3 id="证书锁定" class="firsth2">证书锁定<i class="anchor-icon anchor-icon-link" anchorid="证书锁定" tips="复制节点链接"></i></h3>          <p>可以通过预置应用级证书，或者预置证书公钥哈希值的方式来进行证书锁定，即只有开发者特别指定的证书才能正常建立HTTPS连接。</p>     <p>两种方式都是在配置文件中配置的，配置文件在APP中的路径是：src/main/resources/base/profile/network_config.json。在该配置中，可以为预置的证书与网络服务器建立对应关系。</p>     <p>如果不知道服务器域名的证书，可以通过以下方式访问该域名获取证书，注意把www.example.com改成想要获取域名证书的域名，www.example.com.pem改成想保存的证书文件名：</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li>openssl s_client -servername www.<span class="hljs-property">example</span>.<span class="hljs-property">com</span> -connect www.<span class="hljs-property">example</span>.<span class="hljs-property">com</span>:<span class="hljs-number">443</span> \</li><li>    &lt; <span class="hljs-regexp">/dev/</span><span class="hljs-literal">null</span> | sed -n <span class="hljs-string">"/-----BEGIN/,/-----END/p"</span> &gt; www.<span class="hljs-property">example</span>.<span class="hljs-property">com</span>.<span class="hljs-property">pem</span></li></ol></pre></div></div>     <p>如果你的环境是Windows系统，需要注意：</p>     <ul>      <li>将/dev/null替换成NUL。</li>      <li>和Linux的OpenSSL表现可能不同，OpenSSL可能会等待用户输入才会退出，按Enter键即可。</li>      <li>如果没有sed命令，将输出中从-----BEGIN CERTIFICATE-----到-----END CERTIFICATE-----之间的部分复制下来保存即可（复制部分包括这两行）。</li>     </ul>     <p><strong>预置应用级证书</strong></p>     <p>直接把证书原文件预置在APP中。目前支持crt和pem格式的证书文件。</p>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>当前ohos.net.http和Image组件的证书锁定，会匹配证书链上所有证书的哈希值，如果服务器更新了任意一本证书，都会导致校验失败。如果服务器出现了更新证书的情况，APP版本应当随之更新并推荐消费者尽快升级APP版本，否则可能导致联网失败。</p>      </div></div></div>     <p><strong>预置证书公钥哈希值</strong></p>     <p>通过在配置中指定域名证书公钥的哈希值，只允许使用公钥哈希值匹配的域名证书访问此域名。</p>     <p>域名证书的公钥哈希值可以用如下的命令计算。假设域名证书是通过上面的OpenSSL命令获得的，并保存在www.example.com.pem文件。#开头的行是注释，可以不用输入：</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-bash" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment"># 从证书中提取出公钥</span></li><li>openssl x509 -<span class="hljs-keyword">in</span> www.example.com.pem -pubkey -noout &gt; www.example.com.pubkey.pem</li><li><span class="hljs-comment"># 将pem格式的公钥转换成der格式</span></li><li>openssl asn1parse -noout -inform pem -<span class="hljs-keyword">in</span> www.example.com.pubkey.pem -out www.example.com.pubkey.der</li><li><span class="hljs-comment"># 计算公钥的SHA256并转换成base64编码</span></li><li>openssl dgst -sha256 -binary www.example.com.pubkey.der | openssl <span class="hljs-built_in">base64</span></li></ol></pre></div></div>     <p><strong>JSON配置文件示例</strong></p>     <p>预置应用级证书的配置例子如下（具体配置路径可参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-network-ca-security#section5454123841911" target="_blank">网络连接安全配置</a>）：</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"network-security-config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"base-config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"trust-anchors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>        <span class="hljs-punctuation">{</span></li><li>          <span class="hljs-attr">"certificates"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/etc/security/certificates"</span></li><li>        <span class="hljs-punctuation">}</span></li><li>      <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>    <span class="hljs-attr">"domain-config"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"domains"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"include-subdomains"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span><span class="hljs-punctuation">,</span></li><li>            <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"example.com"</span></li><li>          <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"trust-anchors"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"certificates"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"/data/storage/el1/bundle/entry/resources/resfile"</span></li><li>          <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>     <p>预置证书公钥哈希值的配置例子如下：</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    <span class="hljs-string">"domain-config"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"domains"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"include-subdomains"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"*.server.com"</span></li><li>          }</li><li>        ],</li><li>        <span class="hljs-string">"pin-set"</span>: {</li><li>          <span class="hljs-string">"expiration"</span>: <span class="hljs-string">"2024-11-08"</span>,</li><li>          <span class="hljs-string">"pin"</span>: [</li><li>            {</li><li>              <span class="hljs-string">"digest-algorithm"</span>: <span class="hljs-string">"sha256"</span>,</li><li>              <span class="hljs-string">"digest"</span>: <span class="hljs-string">"FEDCBA987654321"</span></li><li>            }</li><li>          ]</li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>证书锁定的配置例子如下:</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    <span class="hljs-string">"domain-config"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"domains"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"include-subdomains"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"*.server.com"</span></li><li>          }</li><li>        ],</li><li>        <span class="hljs-string">"pin-set"</span>: {</li><li>          <span class="hljs-string">"expiration"</span>: <span class="hljs-string">"2024-11-08"</span>,</li><li>          <span class="hljs-string">"pin"</span>: [</li><li>            {</li><li>              <span class="hljs-string">"digest-algorithm"</span>: <span class="hljs-string">"sha256"</span>,</li><li>              <span class="hljs-string">"digest"</span>: <span class="hljs-string">"FEDCBA987654321"</span></li><li>            }</li><li>          ]</li><li>        }</li><li>      }</li><li>    ]</li><li>  },</li><li>  <span class="hljs-string">"trust-global-user-ca"</span>: <span class="hljs-keyword">false</span>,</li><li>  <span class="hljs-string">"trust-current-user-ca"</span>: <span class="hljs-keyword">false</span>,</li><li>}</li></ol></pre></div></div>     <p><strong>各个字段含义:</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.23.1.4.1.1" valign="top" width="33.33333333333333%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.23.1.4.1.2" valign="top" width="33.33333333333333%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.23.1.4.1.3" valign="top" width="33.33333333333333%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">network-security-config</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">object</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">网络安全配置。可包含0或者1个base-config，必须包含1个domain-config。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">base-config</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">object</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示应用程序范围的安全配置。必须包含1个trust-anchors。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">domain-config</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">array</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示每个域的安全配置。可以包含任意个item。item必须包含1个domains，可以包含0或者1个trust-anchors，可以包含0个或者1个pin-set。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">trust-anchors</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">array</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">受信任的CA。可以包含任意个item。item必须包含1个certificates。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">certificates</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">CA证书路径。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">domains</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">array</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">域。可以包含任意个item。item必须包含1个name(string：指示域名)，可以包含0或者1个include-subdomains。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">include-subdomains</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">boolean</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示规则是否适用于子域。true：指示规则适用于子域；false：指示规则不适用于子域。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">pin-set</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">object</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">证书公钥哈希设置。必须包含1个pin，可以包含0或者1个expiration。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">expiration</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示证书公钥哈希的过期时间。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">pin</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">array</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">证书公钥哈希。可以包含任意个item。item必须包含1个digest-algorithm，item必须包含1个digest。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">digest-algorithm</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示用于生成哈希的摘要算法。目前只支持sha256。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">digest</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">string</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">指示公钥哈希。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="配置不信任用户安装的ca证书">配置不信任用户安装的CA证书<i class="anchor-icon anchor-icon-link" anchorid="配置不信任用户安装的ca证书" tips="复制节点链接"></i></h3>          <p>系统默认信任系统预置的CA证书和用户安装的CA证书，可配置不信任用户安装的CA证书提升安全性。配置不信任用安装的CA证书可以在src/main/resources/base/profile/network_config.json进行配置，更多网络连接安全相关的配置可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-network-ca-security#section5454123841911" target="_blank">网络连接安全配置</a>。</p>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    ... ...</li><li>  },</li><li>  <span class="hljs-string">"trust-global-user-ca"</span>: <span class="hljs-keyword">false</span>, <span class="hljs-comment">// 配置是否信任企业MDM系统或设备管理员用户手动安装的CA证书，默认为true</span></li><li>  <span class="hljs-string">"trust-current-user-ca"</span> : <span class="hljs-keyword">false</span> <span class="hljs-comment">// 配置是否信任当前用户安装的CA证书，默认为true</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="明文http访问权限配置说明">明文HTTP访问权限配置说明<i class="anchor-icon anchor-icon-link" anchorid="明文http访问权限配置说明" tips="复制节点链接"></i></h3>          <p>该配置用于控制HTTP请求是否允许以明文形式传输。以下为明文HTTP访问权限的配置示例（含应用、组件及域名级配置），以及各字段的详细含义说明。更多网络连接安全相关的配置可以参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-network-ca-security#section5454123841911" target="_blank">网络连接安全配置</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>配置优先级规则：组件配置（component-config）&gt; 域名配置（domain-config）&gt; 基础配置（base-config），优先级高的配置会覆盖优先级低的规则。</p>      </div></div></div>     <div _ngcontent-asn-c106="" class="highlight-div"><div _ngcontent-asn-c106="" class="highlight-div-header"><div _ngcontent-asn-c106="" class="highlight-div-header-left"><div _ngcontent-asn-c106="" class="handle-button expand-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-asn-c106="" class="highlight-div-header-right"><div _ngcontent-asn-c106="" class="handle-button ai-button"></div><div _ngcontent-asn-c106="" class="handle-button line-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-asn-c106="" class="handle-button theme-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-asn-c106="" class="handle-button copy-button"><div _ngcontent-asn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-asn-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// src/main/resources/base/profile/network_config.json</span></li><li>{</li><li>  <span class="hljs-string">"network-security-config"</span>: {</li><li>    <span class="hljs-string">"base-config"</span>: {</li><li>      <span class="hljs-string">"cleartextTrafficPermitted"</span>: <span class="hljs-keyword">true</span> <span class="hljs-comment">// 可选，自API 20开始支持该属性。</span></li><li>    },</li><li>    <span class="hljs-string">"domain-config"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"domains"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"include-subdomains"</span>: <span class="hljs-keyword">true</span>,</li><li>            <span class="hljs-string">"name"</span>: <span class="hljs-string">"example.com"</span></li><li>          }</li><li>        ],</li><li>        <span class="hljs-string">"cleartextTrafficPermitted"</span>: <span class="hljs-keyword">false</span> <span class="hljs-comment">// 可选，自API 20开始支持该属性。</span></li><li>      }</li><li>    ],</li><li>    <span class="hljs-string">"component-config"</span>: {</li><li>        <span class="hljs-string">"Network Kit"</span>: <span class="hljs-keyword">true</span>, <span class="hljs-comment">// 可选，自API 20开始支持该属性。</span></li><li>        <span class="hljs-string">"ArkWeb"</span>: <span class="hljs-keyword">false</span> <span class="hljs-comment">// 可选，自API 20开始支持该属性。</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><strong>各个字段含义:</strong></p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.1" valign="top" width="25%">字段</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.2" valign="top" width="25%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.3" valign="top" width="25%">必填</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.6.1.5.1.4" valign="top" width="25%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="25%">base-config</td>         <td class="cellrowborder" valign="top" width="25%">array</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">指示应用程序范围的明文配置。优先级最低。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">cleartextTrafficPermitted</td>         <td class="cellrowborder" valign="top" width="25%">boolean</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">明文HTTP是否允许。true表示允许，false表示不允许，默认为true。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">domain-config</td>         <td class="cellrowborder" valign="top" width="25%">array</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">指示每个域的明文配置。可以包含任意个item。每个item必须包含1个domains。若相同域存在规则冲突时，以匹配到的第一条为准。优先级次于component-config。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">include-subdomains</td>         <td class="cellrowborder" valign="top" width="25%">boolean</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">指示规则是否适用于子域。true表示规则适用于子域，false表示规则不适用于子域，默认为false。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">name</td>         <td class="cellrowborder" valign="top" width="25%">string</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">配置主域名。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">component-config</td>         <td class="cellrowborder" valign="top" width="25%">array</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">指示每个组件的明文配置。优先级最高。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">Network Kit</td>         <td class="cellrowborder" valign="top" width="25%">boolean</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">用于配置Network Kit组件是否支持禁止明文传输。true表示支持，false表示不支持，默认为true。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="25%">ArkWeb</td>         <td class="cellrowborder" valign="top" width="25%">boolean</td>         <td class="cellrowborder" valign="top" width="25%">否</td>         <td class="cellrowborder" valign="top" width="25%">用于配置ArkWeb组件是否支持禁止明文传输。true表示支持，false表示不支持，默认为false。</td>        </tr>             </tbody></table></div>     </div>    </div>   </div>   <div></div></div>