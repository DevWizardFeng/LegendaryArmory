<h1 _ngcontent-ynl-c119="" class="doc-title ng-star-inserted" title="使用ImagePacker完成多图对象编码"> 使用ImagePacker完成多图对象编码 </h1>

<div _ngcontent-ynl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>图片编码指将Picture多图对象编码成不同格式的图片文件（当前仅支持编码为JPEG 和 HEIF 格式），用于后续处理，如保存、传输等。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>图片编码相关API的详细介绍请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-imagepacker" target="_blank">图片编码接口说明</a>。</p>    </div>    <div class="tiledSection">     <h3 id="图片编码进文件流" class="firsth2">图片编码进文件流<i class="anchor-icon anchor-icon-link" anchorid="图片编码进文件流" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>创建图像编码ImagePacker对象。</p>       <div _ngcontent-ynl-c106="" class="highlight-div"><div _ngcontent-ynl-c106="" class="highlight-div-header"><div _ngcontent-ynl-c106="" class="highlight-div-header-left"><div _ngcontent-ynl-c106="" class="handle-button expand-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynl-c106="" class="highlight-div-header-right"><div _ngcontent-ynl-c106="" class="handle-button ai-button"></div><div _ngcontent-ynl-c106="" class="handle-button line-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynl-c106="" class="handle-button theme-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynl-c106="" class="handle-button copy-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入相关模块包。</span></li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> imagePackerApi = image.<span class="hljs-title function_">createImagePacker</span>();</li></ol></pre></div></div></li>      <li>       <p>设置编码输出流和编码参数。</p>       <p>format为图像的编码格式；quality为图像质量，范围从0-100，100为最佳质量</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>根据MIME标准，标准编码格式为image/jpeg。当使用image编码时，PackingOption.format设置为image/jpeg，image编码后的文件扩展名可设为.jpg或.jpeg，可在支持image/jpeg解码的平台上使用。</p>        </div></div></div>       <div _ngcontent-ynl-c106="" class="highlight-div"><div _ngcontent-ynl-c106="" class="highlight-div-header"><div _ngcontent-ynl-c106="" class="highlight-div-header-left"><div _ngcontent-ynl-c106="" class="handle-button expand-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynl-c106="" class="highlight-div-header-right"><div _ngcontent-ynl-c106="" class="handle-button ai-button"></div><div _ngcontent-ynl-c106="" class="handle-button line-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynl-c106="" class="handle-button theme-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynl-c106="" class="handle-button copy-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">packOpts</span>: image.<span class="hljs-property">PackingOption</span> = {</li><li>  <span class="hljs-attr">format</span>: <span class="hljs-string">"image/jpeg"</span>,</li><li>  <span class="hljs-attr">quality</span>: <span class="hljs-number">98</span>,</li><li>  <span class="hljs-attr">bufferSize</span>: <span class="hljs-number">10</span>,</li><li>  <span class="hljs-attr">desiredDynamicRange</span>: image.<span class="hljs-property">PackingDynamicRange</span>.<span class="hljs-property">AUTO</span>,</li><li>  <span class="hljs-attr">needsPackProperties</span>: <span class="hljs-literal">true</span></li><li>};</li></ol></pre></div></div></li>      <li>       <p>进行图片编码，并保存编码后的图片。在进行编码前，需要先通过解码获取picture，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-picture-decoding">使用ImageSource完成多图对象解码</a>。</p>       <div _ngcontent-ynl-c106="" class="highlight-div"><div _ngcontent-ynl-c106="" class="highlight-div-header"><div _ngcontent-ynl-c106="" class="highlight-div-header-left"><div _ngcontent-ynl-c106="" class="handle-button expand-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynl-c106="" class="highlight-div-header-right"><div _ngcontent-ynl-c106="" class="handle-button ai-button"></div><div _ngcontent-ynl-c106="" class="handle-button line-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynl-c106="" class="handle-button theme-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynl-c106="" class="handle-button copy-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">packing</span>(<span class="hljs-params">picture: image.Picture, packOpts: image.PackingOption</span>) {</li><li>  <span class="hljs-keyword">const</span> imagePackerApi = image.<span class="hljs-title function_">createImagePacker</span>();</li><li>  imagePackerApi.<span class="hljs-title function_">packing</span>(picture, packOpts).<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">data : <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in packing the image.'</span>+ data);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to pack the image, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  })</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="图片编码进文件">图片编码进文件<i class="anchor-icon anchor-icon-link" anchorid="图片编码进文件" tips="复制节点链接"></i></h3>          <p>在编码时，开发者可以传入对应的文件路径，编码后的内存数据将直接写入文件。在进行编码前，需要先通过解码获取picture，可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-picture-decoding">使用ImageSource完成多图对象解码</a>。</p>     <div _ngcontent-ynl-c106="" class="highlight-div"><div _ngcontent-ynl-c106="" class="highlight-div-header"><div _ngcontent-ynl-c106="" class="highlight-div-header-left"><div _ngcontent-ynl-c106="" class="handle-button expand-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ynl-c106="" class="highlight-div-header-right"><div _ngcontent-ynl-c106="" class="handle-button ai-button"></div><div _ngcontent-ynl-c106="" class="handle-button line-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ynl-c106="" class="handle-button theme-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ynl-c106="" class="handle-button copy-button"><div _ngcontent-ynl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ynl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">packToFile</span>(<span class="hljs-params">picture: image.Picture, packOpts: image.PackingOption, context: Context</span>) {</li><li><span class="hljs-keyword">const</span> path : <span class="hljs-built_in">string</span> = context.<span class="hljs-property">cacheDir</span> + <span class="hljs-string">"/picture.jpg"</span>;</li><li><span class="hljs-keyword">let</span> file = fileIo.<span class="hljs-title function_">openSync</span>(path, fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li><span class="hljs-keyword">const</span> imagePackerApi = image.<span class="hljs-title function_">createImagePacker</span>();</li><li>imagePackerApi.<span class="hljs-title function_">packToFile</span>(picture, file.<span class="hljs-property">fd</span>, packOpts).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Succeeded in packing the image to file.'</span>);</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error : BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to pack the image. And the error is: '</span> + error);</li><li>})</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>