<h1 _ngcontent-wsw-c119="" class="doc-title ng-star-inserted" title="使用ImageSource完成多图对象解码"> 使用ImageSource完成多图对象解码 </h1>

<div _ngcontent-wsw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>将所支持格式的图片文件解码成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-overview#基础概念">Picture</a>。当前支持的图片文件格式包括JPEG、HEIF。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>图片解码相关API的详细介绍请参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-imagesource" target="_blank">图片解码接口说明</a>。</p>     <ol>      <li>       <p>全局导入Image模块。</p>       <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>获取图片。</p>       <ul>        <li>         <p>方法一：通过沙箱路径直接获取。该方法仅适用于应用沙箱中的图片。更多细节请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/application-context-stage#获取应用文件路径">获取应用文件路径</a>。应用沙箱的介绍及如何向应用沙箱推送文件，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-sandbox-directory">文件管理</a>。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getFilePath</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-built_in">string</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = context.<span class="hljs-property">cacheDir</span> + <span class="hljs-string">'/test.jpg'</span>;</li><li>  <span class="hljs-keyword">return</span> filePath;</li><li>}</li></ol></pre></div></div></li>        <li>         <p>方法二：通过沙箱路径获取图片的文件描述符。具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs" target="_blank">file.fs API参考文档</a>。该方法需要导入@kit.CoreFileKit模块。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileFd</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">filePath</span>: <span class="hljs-built_in">string</span> = context.<span class="hljs-property">filesDir</span> + <span class="hljs-string">'/test.jpg'</span>;</li><li>  <span class="hljs-keyword">const</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>  <span class="hljs-keyword">if</span> (file != <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">fd</span>: <span class="hljs-built_in">number</span> = file.<span class="hljs-property">fd</span>;</li><li>    <span class="hljs-keyword">return</span> fd;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div></li>        <li>         <p>方法三：通过资源管理器获取资源文件的ArrayBuffer。具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getrawfilecontent9-1" target="_blank">资源管理器API参考文档</a>。该方法需要导入@kit.LocalizationKit模块。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getFileBuffer</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">ArrayBuffer</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = context.<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-comment">// 获取资源文件内容，返回Uint8Array。</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">fileData</span>: <span class="hljs-title class_">Uint8Array</span> = <span class="hljs-keyword">await</span> resourceMgr.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-string">'test.jpg'</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Successfully got RawFileContent'</span>);</li><li>    <span class="hljs-comment">// 转为ArrayBuffer并返回。</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span> = fileData.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>);</li><li>    <span class="hljs-keyword">return</span> buffer;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to get RawFileContent"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>        <li>         <p>方法四：通过资源管理器获取资源文件的RawFileDescriptor。具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-resource-manager#getrawfd9-1" target="_blank">资源管理器API参考文档</a>。该方法需要导入@kit.LocalizationKit模块。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { resourceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.LocalizationKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getRawFd</span>(<span class="hljs-params">context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;resourceManager.<span class="hljs-property">RawFileDescriptor</span> | <span class="hljs-literal">undefined</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">resourceMgr</span>: resourceManager.<span class="hljs-property">ResourceManager</span> = context.<span class="hljs-property">resourceManager</span>;</li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">rawFileDescriptor</span>: resourceManager.<span class="hljs-property">RawFileDescriptor</span> = <span class="hljs-keyword">await</span> resourceMgr.<span class="hljs-title function_">getRawFd</span>(<span class="hljs-string">'test.jpg'</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Successfully got RawFileDescriptor'</span>);</li><li>    <span class="hljs-keyword">return</span> rawFileDescriptor;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get RawFileDescriptor:'</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>}</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>创建ImageSource实例。</p>       <ul>        <li>         <p>方法一：通过沙箱路径创建ImageSource。沙箱路径可以通过步骤2的方法一获取。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// path为已获得的沙箱路径。</span></li><li><span class="hljs-keyword">const</span> imageSource : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(filePath);</li></ol></pre></div></div></li>        <li>         <p>方法二：通过文件描述符fd创建ImageSource。文件描述符可以通过步骤2的方法二获取。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// fd为已获得的文件描述符。</span></li><li><span class="hljs-keyword">const</span> imageSource : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fd);</li></ol></pre></div></div></li>        <li>         <p>方法三：通过缓冲区数组创建ImageSource。缓冲区数组可以通过步骤2的方法三获取。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> imageSource : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(buffer);</li></ol></pre></div></div></li>        <li>         <p>方法四：通过资源文件的RawFileDescriptor创建ImageSource。RawFileDescriptor可以通过步骤2的方法四获取。</p>         <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">const</span> imageSource : image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(rawFileDescriptor);</li></ol></pre></div></div></li>       </ul></li>      <li>       <p>设置解码参数DecodingOptions，解码获取picture多图对象。并对picture进行操作，如获取辅助图等。对于picture和辅助图的操作具体请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-picture" target="_blank">Image API参考文档</a>。</p>       <p>设置期望的format进行解码：</p>       <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建ImageSource，请选择3中合适的方法替换。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">fd</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">imageSource</span>: image.<span class="hljs-property">ImageSource</span> = image.<span class="hljs-title function_">createImageSource</span>(fd);</li><li><span class="hljs-comment">// 配置解码选项参数。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: image.<span class="hljs-property">DecodingOptionsForPicture</span> = {</li><li>  <span class="hljs-attr">desiredAuxiliaryPictures</span>: [image.<span class="hljs-property">AuxiliaryPictureType</span>.<span class="hljs-property">GAINMAP</span>] <span class="hljs-comment">// GAINMAP为需要解码的辅助图类型。</span></li><li>};</li><li><span class="hljs-comment">// 创建picture。</span></li><li>imageSource.<span class="hljs-title function_">createPicture</span>(options).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">picture: image.Picture</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Create picture succeeded."</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: image.<span class="hljs-property">AuxiliaryPictureType</span> = image.<span class="hljs-property">AuxiliaryPictureType</span>.<span class="hljs-property">GAINMAP</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">auxPicture</span>: image.<span class="hljs-property">AuxiliaryPicture</span> | <span class="hljs-literal">null</span> = picture.<span class="hljs-title function_">getAuxiliaryPicture</span>(<span class="hljs-keyword">type</span>);</li><li>  <span class="hljs-comment">// 获取辅助图信息。</span></li><li>  <span class="hljs-keyword">if</span> (auxPicture != <span class="hljs-literal">null</span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">auxInfo</span>: image.<span class="hljs-property">AuxiliaryPictureInfo</span> = auxPicture.<span class="hljs-title function_">getAuxiliaryPictureInfo</span>();</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'GetAuxiliaryPictureInfo Type: '</span> + auxInfo.<span class="hljs-property">auxiliaryPictureType</span> +</li><li>      <span class="hljs-string">' height: '</span> + auxInfo.<span class="hljs-property">size</span>.<span class="hljs-property">height</span> + <span class="hljs-string">' width: '</span> + auxInfo.<span class="hljs-property">size</span>.<span class="hljs-property">width</span> +</li><li>      <span class="hljs-string">' rowStride: '</span> + auxInfo.<span class="hljs-property">rowStride</span> + <span class="hljs-string">' pixelFormat: '</span> + auxInfo.<span class="hljs-property">pixelFormat</span> +</li><li>      <span class="hljs-string">' colorSpace: '</span> + auxInfo.<span class="hljs-property">colorSpace</span>);</li><li>    <span class="hljs-comment">// 将辅助图数据读到ArrayBuffer。</span></li><li>    auxPicture.<span class="hljs-title function_">readPixelsToBuffer</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelsBuffer: <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Read pixels to buffer success.'</span>);</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Read pixels to buffer failed, error.code: <span class="hljs-subst">${error.code}</span>, error.message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>    });</li><li>    auxPicture.<span class="hljs-title function_">release</span>();</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Create picture failed."</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>释放picture。</p>       <p>确认picture的异步方法已经执行完成，不再使用该变量后，可按需手动调用下面方法释放。</p>       <div _ngcontent-wsw-c106="" class="highlight-div"><div _ngcontent-wsw-c106="" class="highlight-div-header"><div _ngcontent-wsw-c106="" class="highlight-div-header-left"><div _ngcontent-wsw-c106="" class="handle-button expand-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-wsw-c106="" class="highlight-div-header-right"><div _ngcontent-wsw-c106="" class="handle-button ai-button"></div><div _ngcontent-wsw-c106="" class="handle-button line-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-wsw-c106="" class="handle-button theme-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-wsw-c106="" class="handle-button copy-button"><div _ngcontent-wsw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-wsw-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 请务必在确认picture不需要再使用时，再进行释放。</span></li><li><span class="hljs-comment">// picture.release();</span></li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>