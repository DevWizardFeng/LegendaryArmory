<h1 _ngcontent-dob-c119="" class="doc-title ng-star-inserted" title="使用Image_NativeModule完成多图对象编码"> 使用Image_NativeModule完成多图对象编码 </h1>

<div _ngcontent-dob-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>图像编码类，用于创建以及释放ImagePacker实例，并编码多图对象。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="添加链接库" class="firsth2">添加链接库<i class="anchor-icon anchor-icon-link" anchorid="添加链接库" tips="复制节点链接"></i></h3>          <p>在进行应用开发之前，开发者需要打开native工程的src/main/cpp/CMakeLists.txt，在target_link_libraries依赖中添加libimage_packer.so 以及日志依赖libhilog_ndk.z.so。</p>     <div _ngcontent-dob-c106="" class="highlight-div"><div _ngcontent-dob-c106="" class="highlight-div-header"><div _ngcontent-dob-c106="" class="highlight-div-header-left"><div _ngcontent-dob-c106="" class="handle-button expand-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dob-c106="" class="highlight-div-header-right"><div _ngcontent-dob-c106="" class="handle-button ai-button"></div><div _ngcontent-dob-c106="" class="handle-button line-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dob-c106="" class="handle-button theme-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dob-c106="" class="handle-button copy-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dob-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libhilog_ndk.z.so libimage_source.so libimage_packer.so libpixelmap.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="native接口调用">Native接口调用<i class="anchor-icon anchor-icon-link" anchorid="native接口调用" tips="复制节点链接"></i></h3>          <p>具体接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-image-nativemodule" target="_blank">API文档</a>。</p>     <p>在DevEco Studio新建Native C++应用，默认生成的项目中包含index.ets文件，在entry\src\main\cpp目录下会自动生成一个cpp文件（hello.cpp或napi_init.cpp，本示例以hello.cpp文件名为例）。在hello.cpp中实现C API接口调用逻辑，示例代码如下：</p>     <p><strong>编码接口使用示例</strong></p>     <p>在创建ImagePacker实例，指定编码参数后将Picture多图对象编码至文件或者缓冲区。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>根据MIME标准，标准编码格式为image/jpeg。当使用image编码时，编码参数中的编码格式image_MimeType设置为image/jpeg，image编码后的文件扩展名可设为.jpg或.jpeg，可在支持image/jpeg解码的平台上使用。</p>      </div></div></div>     <div _ngcontent-dob-c106="" class="highlight-div"><div _ngcontent-dob-c106="" class="highlight-div-header"><div _ngcontent-dob-c106="" class="highlight-div-header-left"><div _ngcontent-dob-c106="" class="handle-button expand-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dob-c106="" class="highlight-div-header-right"><div _ngcontent-dob-c106="" class="handle-button ai-button"></div><div _ngcontent-dob-c106="" class="handle-button line-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dob-c106="" class="handle-button theme-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dob-c106="" class="handle-button copy-button"><div _ngcontent-dob-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dob-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">hilog</span>/<span class="hljs-title class_">log</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">multimedia</span>/<span class="hljs-title class_">image_framework</span>/<span class="hljs-title class_">image</span>/<span class="hljs-title class_">image_native</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">multimedia</span>/<span class="hljs-title class_">image_framework</span>/<span class="hljs-title class_">image</span>/<span class="hljs-title class_">image_packer_native</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">multimedia</span>/<span class="hljs-title class_">image_framework</span>/<span class="hljs-title class_">image</span>/<span class="hljs-title class_">image_source_native</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">multimedia</span>/<span class="hljs-title class_">image_framework</span>/<span class="hljs-title class_">image</span>/<span class="hljs-title class_">picture_native</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">multimedia</span>/<span class="hljs-title class_">image_framework</span>/<span class="hljs-title class_">image</span>/<span class="hljs-title class_">pixelmap_native</span>.<span class="hljs-title class_">h</span>&gt;</li><li>
</li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">AUTO</span> <span class="hljs-number">0</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">SDR</span> <span class="hljs-number">1</span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImagePictureNative</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-variable">Image_ErrorCode</span> <span class="hljs-variable">errorCode</span> = <span class="hljs-variable">IMAGE_SUCCESS</span>;</li><li>    <span class="hljs-variable">OH_DecodingOptionsForPicture</span> *<span class="hljs-variable">options</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">OH_ImagePackerNative</span> *<span class="hljs-variable">imagePacker</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">OH_PackingOptions</span> *<span class="hljs-variable">packerOptions</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">OH_PictureNative</span> *<span class="hljs-variable">picture</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">OH_ImageSourceNative</span> *<span class="hljs-variable">source</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-title function_">ImagePictureNative</span>() {}</li><li>    ~<span class="hljs-title function_">ImagePictureNative</span>() {}</li><li>};</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">ImagePictureNative</span> *<span class="hljs-variable">thisPicture</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">ImagePictureNative</span>();</li><li>
</li><li><span class="hljs-comment">// 处理napi返回值。</span></li><li><span class="hljs-variable">napi_value</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">int</span> <span class="hljs-variable">result</span>) {</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">resultNapi</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-title function_">napi_create_int32</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">result</span>, &amp;<span class="hljs-title class_">resultNapi</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">resultNapi</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 释放ImageSource。</span></li><li><span class="hljs-variable">Image_ErrorCode</span> <span class="hljs-title function_">ReleaseImageSource</span>(<span class="hljs-variable">OH_ImageSourceNative</span> *&amp;<span class="hljs-title class_">source</span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">source</span> != <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_ImageSourceNative_Release</span>(<span class="hljs-variable">source</span>);</li><li>        <span class="hljs-variable">source</span> = <span class="hljs-variable">nullptr</span>;</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>;</li><li>    }</li><li><span class="hljs-title function_">OH_LOG_DEBUG</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"ReleaseImageSource source is null!"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">IMAGE_SUCCESS</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 设置编码参数。</span></li><li><span class="hljs-variable">void</span> <span class="hljs-title function_">SetPackOptions</span>(<span class="hljs-variable">OH_PackingOptions</span> *<span class="hljs-variable">packerOptions</span>, <span class="hljs-variable">Image_MimeType</span> <span class="hljs-variable">format</span>, <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">quality</span>, <span class="hljs-variable">bool</span> <span class="hljs-variable">needsPackProperties</span>,</li><li>                    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">desiredDynamicRange</span>) {</li><li>    <span class="hljs-title function_">OH_PackingOptions_SetMimeType</span>(<span class="hljs-variable">packerOptions</span>, &amp;<span class="hljs-title class_">format</span>);</li><li>    <span class="hljs-title function_">OH_PackingOptions_SetQuality</span>(<span class="hljs-variable">packerOptions</span>, <span class="hljs-variable">quality</span>);</li><li>    <span class="hljs-title function_">OH_PackingOptions_SetNeedsPackProperties</span>(<span class="hljs-variable">packerOptions</span>, <span class="hljs-variable">needsPackProperties</span>);</li><li>    <span class="hljs-title function_">OH_PackingOptions_SetDesiredDynamicRange</span>(<span class="hljs-variable">packerOptions</span>, <span class="hljs-variable">desiredDynamicRange</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 编码PackToData。</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">PackToDataFromPicture</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_callback_info</span> <span class="hljs-variable">info</span>) {</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">argc</span> = <span class="hljs-number">2</span>;</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">args</span>[<span class="hljs-number">2</span>] = {<span class="hljs-variable">nullptr</span>};</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_get_cb_info</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">info</span>, &amp;<span class="hljs-title class_">argc</span>, <span class="hljs-variable">args</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>        <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"napi_get_cb_info failed!"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>    }</li><li>    <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">fd</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-title function_">napi_get_value_uint32</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">args</span>[<span class="hljs-number">0</span>], &amp;<span class="hljs-title class_">fd</span>);</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">outDataSize</span> = <span class="hljs-number">10000</span> * <span class="hljs-number">10000</span>;</li><li>    <span class="hljs-variable">uint8_t</span> *<span class="hljs-variable">outData</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">uint8_t</span>[<span class="hljs-variable">outDataSize</span>];</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span> == <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_PackingOptions_Create</span>(&amp;<span class="hljs-title class_">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span> == <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_ImagePackerNative_Create</span>(&amp;<span class="hljs-title class_">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">strFormat</span>[<span class="hljs-number">20</span>];</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">strFormatSize</span>;</li><li>    <span class="hljs-title function_">napi_get_value_string_utf8</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">args</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">strFormat</span>, <span class="hljs-number">20</span>, &amp;<span class="hljs-title class_">strFormatSize</span>);</li><li>    <span class="hljs-title function_">OH_LOG_DEBUG</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"PackToDataFromPicture format: %{public}s"</span>, <span class="hljs-variable">strFormat</span>);</li><li>
</li><li>    <span class="hljs-variable">Image_MimeType</span> <span class="hljs-variable">format</span>;</li><li>    <span class="hljs-variable">format</span>.<span class="hljs-variable">size</span> = <span class="hljs-variable">strFormatSize</span>;</li><li>    <span class="hljs-variable">format</span>.<span class="hljs-variable">data</span> = <span class="hljs-title class_">const_cast</span>&lt;<span class="hljs-title class_">char</span> *&gt;(<span class="hljs-variable">strFormat</span>);</li><li>    <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">quality</span> = <span class="hljs-number">98</span>;</li><li>    <span class="hljs-variable">bool</span> <span class="hljs-variable">needsPackProperties</span> = <span class="hljs-keyword">true</span>;</li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">desiredDynamicRange</span> = <span class="hljs-variable">AUTO</span>;</li><li>    <span class="hljs-title function_">SetPackOptions</span>(<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>, <span class="hljs-variable">format</span>, <span class="hljs-variable">quality</span>, <span class="hljs-variable">needsPackProperties</span>, <span class="hljs-variable">desiredDynamicRange</span>);</li><li>
</li><li>    <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_ImagePackerNative_PackToDataFromPicture</span>(</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">picture</span>, <span class="hljs-variable">outData</span>, &amp;<span class="hljs-title class_">outDataSize</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> != <span class="hljs-variable">IMAGE_SUCCESS</span>) {</li><li>    <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"OH_ImagePackerNative_PackToDataFromPicture failed, errCode: %{public}d."</span>,</li><li>            <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>        <span class="hljs-variable">delete</span>[] <span class="hljs-variable">outData</span>;</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-title function_">ReleaseImageSource</span>(<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">source</span>);</li><li>        <span class="hljs-title function_">OH_ImageSourceNative_CreateFromData</span>(<span class="hljs-variable">outData</span>, <span class="hljs-variable">outDataSize</span>, &amp;<span class="hljs-title class_">thisPicture</span>-&gt;<span class="hljs-title class_">source</span>);</li><li>        <span class="hljs-title function_">OH_ImagePackerNative_PackToFileFromImageSource</span>(<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>,</li><li>                                                    <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">source</span>, <span class="hljs-variable">fd</span>);</li><li>        <span class="hljs-title function_">ReleaseImageSource</span>(<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">source</span>);</li><li>    <span class="hljs-title function_">OH_LOG_DEBUG</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"OH_ImagePackerNative_PackToDataFromPicture success !"</span>);</li><li>    }</li><li>    <span class="hljs-variable">delete</span>[] <span class="hljs-variable">outData</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>}</li><li>
</li><li><span class="hljs-comment">// 编码PackToFile。</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">PackToFileFromPicture</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_callback_info</span> <span class="hljs-variable">info</span>) {</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">argc</span> = <span class="hljs-number">2</span>;</li><li>    <span class="hljs-variable">napi_value</span> <span class="hljs-variable">args</span>[<span class="hljs-number">2</span>] = {<span class="hljs-variable">nullptr</span>};</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">napi_get_cb_info</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">info</span>, &amp;<span class="hljs-title class_">argc</span>, <span class="hljs-variable">args</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>) != <span class="hljs-variable">napi_ok</span>) {</li><li>    <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"napi_get_cb_info failed!"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>    }</li><li>    <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">fd</span> = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-title function_">napi_get_value_uint32</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">args</span>[<span class="hljs-number">0</span>], &amp;<span class="hljs-title class_">fd</span>);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span> == <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_PackingOptions_Create</span>(&amp;<span class="hljs-title class_">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span> == <span class="hljs-variable">nullptr</span>) {</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_ImagePackerNative_Create</span>(&amp;<span class="hljs-title class_">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">char</span> <span class="hljs-variable">strFormat</span>[<span class="hljs-number">20</span>];</li><li>    <span class="hljs-variable">size_t</span> <span class="hljs-variable">strFormatSize</span>;</li><li>    <span class="hljs-title function_">napi_get_value_string_utf8</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">args</span>[<span class="hljs-number">1</span>], <span class="hljs-variable">strFormat</span>, <span class="hljs-number">20</span>, &amp;<span class="hljs-title class_">strFormatSize</span>);</li><li><span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"PackToFileFromPicture format: %{public}s"</span>, <span class="hljs-variable">strFormat</span>);</li><li>
</li><li>    <span class="hljs-variable">Image_MimeType</span> <span class="hljs-variable">format</span>;</li><li>    <span class="hljs-variable">format</span>.<span class="hljs-variable">size</span> = <span class="hljs-variable">strFormatSize</span>;</li><li>    <span class="hljs-variable">format</span>.<span class="hljs-variable">data</span> = <span class="hljs-title class_">const_cast</span>&lt;<span class="hljs-title class_">char</span> *&gt;(<span class="hljs-variable">strFormat</span>);</li><li>    <span class="hljs-variable">uint32_t</span> <span class="hljs-variable">quality</span> = <span class="hljs-number">98</span>;</li><li>    <span class="hljs-variable">bool</span> <span class="hljs-variable">needsPackProperties</span> = <span class="hljs-keyword">false</span>;</li><li>    <span class="hljs-variable">int32_t</span> <span class="hljs-variable">desiredDynamicRange</span> = <span class="hljs-variable">SDR</span>;</li><li>    <span class="hljs-title function_">SetPackOptions</span>(<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>, <span class="hljs-variable">format</span>, <span class="hljs-variable">quality</span>, <span class="hljs-variable">needsPackProperties</span>, <span class="hljs-variable">desiredDynamicRange</span>);</li><li>
</li><li>    <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> = <span class="hljs-title function_">OH_ImagePackerNative_PackToFileFromPicture</span>(</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">imagePacker</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">packerOptions</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">picture</span>, <span class="hljs-variable">fd</span>);</li><li>
</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span> != <span class="hljs-variable">IMAGE_SUCCESS</span>) {</li><li>    <span class="hljs-title function_">OH_LOG_ERROR</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"OH_ImagePackerNative_PackToFileFromPicture failed, errCode: %{public}d."</span>,</li><li>        <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>
</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-title function_">OH_LOG_DEBUG</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"OH_ImagePackerNative_PackToFileFromPicture success !"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">getJsResult</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">thisPicture</span>-&gt;<span class="hljs-title class_">errorCode</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>