<h1 _ngcontent-ivi-c119="" class="doc-title ng-star-inserted" title="使用JSVM-API实现JS与C/C++语言交互开发流程"> 使用JSVM-API实现JS与C/C++语言交互开发流程 </h1>

<div _ngcontent-ivi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>使用JSVM-API实现跨语言交互，首先需按其机制注册和加载模块。</p> <ul><li><p>ArkTS/JS侧：实现C++方法的调用。代码比较简单，import一个对应的so库后，即可调用C++方法。</p>  </li><li><p>Native侧：.cpp文件，实现模块的注册。需要提供注册lib库的名称，并在注册回调方法中定义接口的映射关系，即Native方法及对应的JS/ArkTS接口名称等。</p>  </li></ul> <p>此处以在ArkTS/JS侧和Native侧实现RunJsVm()接口实现跨语言交互为例，展示使用JSVM-API进行跨语言交互的流程。</p>  <div class="tiledSection"><h2 id="创建native-c工程">创建Native C++工程<i class="anchor-icon anchor-icon-link" anchorid="创建native-c工程" tips="复制节点链接"></i></h2><p>具体见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/create-with-ndk">创建NDK工程</a></p> </div>  <div class="tiledSection"><h2 id="native侧方法的实现">Native侧方法的实现<i class="anchor-icon anchor-icon-link" anchorid="native侧方法的实现" tips="复制节点链接"></i></h2><p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process#native侧方法的实现">使用Node-API实现跨语言交互开发流程</a>，以下代码提供了“使用JSVM-API实现JS与C/C++语言交互开发流程”Native侧方法实现的一个demo。</p> <ul><li><p>在index.d.ts文件中，提供JS侧的接口方法。</p>  <div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/types/libentry/index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">runTest</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div>   </li><li><p>在oh-package.json5文件中将index.d.ts与cpp文件关联起来。</p>  <div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"libentry.so"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"types"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./index.d.ts"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"version"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">""</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"Please describe the basic information."</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在CMakeLists.txt文件中配置CMake打包参数。</p>  <div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li># entry/src/main/cpp/CMakeLists.txt</li><li>cmake_minimum_required(VERSION 3.4.1)</li><li>project(JSVMDemo)</li><li>
</li><li>set(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li># 日志打印配置</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>include_directories(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li># 添加名为entry的库</li><li>add_library(entry SHARED hello.cpp)</li><li># 构建此可执行文件需要链接的库</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libjsvm.so libhilog_ndk.z.so)</li></ol></pre></div></div>  </li><li><p>新建entry/src/main/cpp/hello.cpp，实现Native侧的runTest接口。具体代码如下：</p>  <div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_DOMAIN 0x3200</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> LOG_TAG <span class="hljs-string">"APP"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> g_aa = <span class="hljs-number">0</span>;</li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHECK_RET(theCall)                                                                                             \</span></li><li><span class="hljs-meta">    do {                                                                                                               \</span></li><li><span class="hljs-meta">        JSVM_Status cond = theCall;                                                                                    \</span></li><li><span class="hljs-meta">        <span class="hljs-keyword">if</span> ((cond) != JSVM_OK) {                                                                                       \</span></li><li><span class="hljs-meta">            const JSVM_ExtendedErrorInfo *info;                                                                        \</span></li><li><span class="hljs-meta">            OH_JSVM_GetLastErrorInfo(env, &amp;info);                                                                      \</span></li><li><span class="hljs-meta">            OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"jsvm fail file: %{public}s line: %{public}d ret = %{public}d message = %{public}s"</span>, \</span></li><li><span class="hljs-meta">                         __FILE__, __LINE__, cond, info != nullptr ? info-&gt;errorMessage : <span class="hljs-string">""</span>);                         \</span></li><li><span class="hljs-meta">            return -1;                                                                                                 \</span></li><li><span class="hljs-meta">        }                                                                                                              \</span></li><li><span class="hljs-meta">    } while (0)</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> CHECK(theCall)                                                                                                 \</span></li><li><span class="hljs-meta">    do {                                                                                                               \</span></li><li><span class="hljs-meta">        JSVM_Status cond = theCall;                                                                                    \</span></li><li><span class="hljs-meta">        <span class="hljs-keyword">if</span> ((cond) != JSVM_OK) {                                                                                       \</span></li><li><span class="hljs-meta">            OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"jsvm fail file: %{public}s line: %{public}d ret = %{public}d"</span>, __FILE__, __LINE__,  \</span></li><li><span class="hljs-meta">                         cond);                                                                                        \</span></li><li><span class="hljs-meta">            return -1;                                                                                                 \</span></li><li><span class="hljs-meta">        }                                                                                                              \</span></li><li><span class="hljs-meta">    } while (0)</span></li><li>
</li><li><span class="hljs-comment">// 用于调用theCall并检查其返回值是否为JSVM_OK。</span></li><li><span class="hljs-comment">// 如果不是，则调用OH_JSVM_GetLastErrorInfo处理错误并返回retVal。</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> JSVM_CALL_BASE(env, theCall, retVal)                                                                           \</span></li><li><span class="hljs-meta">    do {                                                                                                               \</span></li><li><span class="hljs-meta">        JSVM_Status cond = theCall;                                                                                    \</span></li><li><span class="hljs-meta">        <span class="hljs-keyword">if</span> (cond != JSVM_OK) {                                                                                         \</span></li><li><span class="hljs-meta">            const JSVM_ExtendedErrorInfo *info;                                                                        \</span></li><li><span class="hljs-meta">            OH_JSVM_GetLastErrorInfo(env, &amp;info);                                                                      \</span></li><li><span class="hljs-meta">            OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"jsvm fail file: %{public}s line: %{public}d ret = %{public}d message = %{public}s"</span>, \</span></li><li><span class="hljs-meta">                         __FILE__, __LINE__, cond, info != nullptr ? info-&gt;errorMessage : <span class="hljs-string">""</span>);                         \</span></li><li><span class="hljs-meta">            return retVal;                                                                                             \</span></li><li><span class="hljs-meta">        }                                                                                                              \</span></li><li><span class="hljs-meta">    } while (0)</span></li><li>
</li><li><span class="hljs-comment">// JSVM_CALL_BASE的简化版本，返回nullptr</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> JSVM_CALL(theCall) JSVM_CALL_BASE(env, theCall, nullptr)</span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_StrictEquals的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">IsStrictEquals</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 接受两个入参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>));</li><li>    <span class="hljs-comment">// 调用OH_JSVM_StrictEquals接口判断给定的两个JavaScript value是否严格相等</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_StrictEquals</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_StrictEquals: failed"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_StrictEquals: success: %{public}d"</span>, result);</li><li>    }</li><li>    JSVM_Value isStrictEqual;</li><li>    <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;isStrictEqual));</li><li>    <span class="hljs-keyword">return</span> isStrictEqual;</li><li>}</li><li><span class="hljs-comment">// IsStrictEquals注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = IsStrictEquals},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// IsStrictEquals方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"isStrictEquals"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(    let data = '123';</span></li><li><span class="hljs-string">    let value = 123;</span></li><li><span class="hljs-string">    isStrictEquals(data,value);)JS"</span>;</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int32_t</span> <span class="hljs-title">TestJSVM</span><span class="hljs-params">()</span> </span>{</li><li>    JSVM_InitOptions initOptions = {<span class="hljs-number">0</span>};</li><li>    JSVM_VM vm;</li><li>    JSVM_Env env = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_VMScope vmScope;</li><li>    JSVM_EnvScope envScope;</li><li>    JSVM_HandleScope handleScope;</li><li>    JSVM_Value result;</li><li>    <span class="hljs-comment">// 初始化JavaScript引擎实例</span></li><li>    <span class="hljs-keyword">if</span> (g_aa == <span class="hljs-number">0</span>) {</li><li>        g_aa++;</li><li>       <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_Init</span>(&amp;initOptions));</li><li>    }</li><li>    <span class="hljs-comment">// 创建JSVM环境</span></li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_CreateVM</span>(<span class="hljs-literal">nullptr</span>, &amp;vm));</li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_CreateEnv</span>(vm, <span class="hljs-built_in">sizeof</span>(descriptor) / <span class="hljs-built_in">sizeof</span>(descriptor[<span class="hljs-number">0</span>]), descriptor, &amp;env));</li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_OpenVMScope</span>(vm, &amp;vmScope));</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_OpenEnvScope</span>(env, &amp;envScope));</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_OpenHandleScope</span>(env, &amp;handleScope));</li><li>
</li><li>    <span class="hljs-comment">// 通过script调用测试函数</span></li><li>    JSVM_Script script;</li><li>    JSVM_Value jsSrc;</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, srcCallNative, JSVM_AUTO_LENGTH, &amp;jsSrc));</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_CompileScript</span>(env, jsSrc, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">nullptr</span>, &amp;script));</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_RunScript</span>(env, script, &amp;result));</li><li>
</li><li>    <span class="hljs-comment">// 销毁JSVM环境</span></li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_CloseHandleScope</span>(env, handleScope));</li><li>    <span class="hljs-built_in">CHECK_RET</span>(<span class="hljs-built_in">OH_JSVM_CloseEnvScope</span>(env, envScope));</li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_CloseVMScope</span>(vm, vmScope));</li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_DestroyEnv</span>(env));</li><li>    <span class="hljs-built_in">CHECK</span>(<span class="hljs-built_in">OH_JSVM_DestroyVM</span>(vm));</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RunTest</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">TestJSVM</span>();</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 模块初始化</span></li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    <span class="hljs-comment">// 实现ArkTS接口与C++接口的绑定和映射</span></li><li>    napi_property_descriptor desc[] = {</li><li>      {<span class="hljs-string">"runTest"</span>, <span class="hljs-literal">nullptr</span>, RunTest, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-comment">// 在exports对象上挂载RunJsVm的Native方法</span></li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span> *)<span class="hljs-number">0</span>),</li><li>    .reserved = {<span class="hljs-number">0</span>},</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{ <span class="hljs-built_in">napi_module_register</span>(&amp;demoModule); }</li></ol></pre></div></div>  </li></ul> </div>  <div class="tiledSection"><h2 id="arkts侧调用cc方法实现">ArkTS侧调用C/C++方法实现<i class="anchor-icon anchor-icon-link" anchorid="arkts侧调用cc方法实现" tips="复制节点链接"></i></h2><div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 通过import的方式，引入Native能力。</span></li><li><span class="hljs-keyword">import</span> napitest <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// runtest</span></li><li>            napitest.<span class="hljs-title function_">runTest</span>();</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> <p>预期输出结果</p> <div _ngcontent-ivi-c106="" class="highlight-div"><div _ngcontent-ivi-c106="" class="highlight-div-header"><div _ngcontent-ivi-c106="" class="highlight-div-header-left"><div _ngcontent-ivi-c106="" class="handle-button expand-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ivi-c106="" class="highlight-div-header-right"><div _ngcontent-ivi-c106="" class="handle-button ai-button"></div><div _ngcontent-ivi-c106="" class="handle-button line-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ivi-c106="" class="handle-button theme-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ivi-c106="" class="handle-button copy-button"><div _ngcontent-ivi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ivi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-attr">OH_JSVM_StrictEquals</span>: <span class="hljs-attr">success</span>: <span class="hljs-number">0</span></li></ol></pre></div></div> </div> </div> <div></div></div>