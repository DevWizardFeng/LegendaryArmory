<h1 _ngcontent-qpx-c119="" class="doc-title ng-star-inserted" title="使用JSVM-API接口创建和获取数值"> 使用JSVM-API接口创建和获取数值 </h1>

<div _ngcontent-qpx-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>在JavaScript中，整数类型是一种基本数据类型，用于表示没有小数部分的数值。Double类型用于表示有小数的数值。JavaScript的数值存储方式会导致在某些情况下无法准确表示非常大或非常小的数值，在这种情况下，需要使用BigInt对应的JSVM-API接口来处理更大范围的整数。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>当使用JSVM-API接口进行数值类型的创建和获取时，需要了解以下基本概念：</p> <ul><li><strong>数值类型</strong> 在使用JSVM-API接口时，可能需要从JSVM模块数值类型转换为JavaScript数值类型，或者从JavaScript数值类型转换为JSVM模块数值类型。在进行数据类型转换时，需要注意数据范围是否匹配，以及有无符号整数和双精度数值等区别。</li><li><strong>错误处理</strong> 在使用这些接口时，需要对可能发生的错误进行适当处理。例如，在创建整数值时可能发生内存分配错误或其他运行时错误，需要使用JSVM-API提供的错误处理机制来捕获并处理这些错误。</li><li><strong>JavaScript交互</strong> 在开发过程中，需要考虑如何将创建的数值类型值与JavaScript环境进行交互，包括传递参数、返回值等。</li></ul> </div>  <div class="tiledSection"><h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">功能说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetValueUint32</td> <td class="cellrowborder" valign="top" width="50%">获取给定JavaScript number的Uint32基础类型值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetValueInt32</td> <td class="cellrowborder" valign="top" width="50%">获取给定JavaScript number的Int32基础类型值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetValueInt64</td> <td class="cellrowborder" valign="top" width="50%">获取给定JavaScript number的Int64基础类型值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetValueDouble</td> <td class="cellrowborder" valign="top" width="50%">获取给定JavaScript number的Double基础类型值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateInt32</td> <td class="cellrowborder" valign="top" width="50%">根据Int32_t类型对象创建JavaScript number对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateUint32</td> <td class="cellrowborder" valign="top" width="50%">根据Uint32_t类型对象创建JavaScript number对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateInt64</td> <td class="cellrowborder" valign="top" width="50%">根据Int64_t类型对象创建JavaScript number对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateDouble</td> <td class="cellrowborder" valign="top" width="50%">根据Double类型对象创建JavaScript number对象。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>JSVM-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-jsvm-process">使用JSVM-API实现JS与C/C++语言交互开发流程</a>，本文仅对接口对应C++相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getvalueuint32" class="firsth2">OH_JSVM_GetValueUint32<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getvalueuint32" tips="复制节点链接"></i></h3><p>将JavaScript value转为JSVM模块中的uint32类型数据。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_GetValueUint32的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetValueUint32</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取传入的数字类型参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-comment">// 解析传入的参数</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">uint32_t</span> number = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 获取传入参数的值中的无符号32位整数</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetValueUint32</span>(env, argv[<span class="hljs-number">0</span>], &amp;number);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueUint32 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueUint32 success: %{public}u"</span>, number);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> argv[<span class="hljs-number">0</span>];</li><li>}</li><li>
</li><li><span class="hljs-comment">// GetValueUint32注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetValueUint32},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li>
</li><li><span class="hljs-comment">// GetValueUint32方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getValueUint32"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(getValueUint32(123))JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM GetValueUint32 success:</span> <span class="hljs-number">123</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getvalueint32">OH_JSVM_GetValueInt32<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getvalueint32" tips="复制节点链接"></i></h3><p>将JavaScript value转为JSVM模块中的Int32类型数据。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_GetValueInt32的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetValueInt32</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">int32_t</span> result32 = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 解析传递的参数</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将前端传过来的参数转为JSVM模块的int32类型</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">0</span>], &amp;result32);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueInt32 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueInt32 success: %{public}d"</span>, result32);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li>
</li><li><span class="hljs-comment">// GetValueInt32注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetValueInt32},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetValueInt32方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getValueInt32"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(getValueInt32(-123))JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM GetValueInt32 success:</span> <span class="hljs-number">-123</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getvalueint64">OH_JSVM_GetValueInt64<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getvalueint64" tips="复制节点链接"></i></h3><p>将JavaScript value转为JSVM模块中的Int64类型数据。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_GetValueInt64的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetValueInt64</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">int64_t</span> result64 = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 解析传递的值</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将前端传过来的参数分别转为JSVM模块的int64类型</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetValueInt64</span>(env, args[<span class="hljs-number">0</span>], &amp;result64);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueInt64 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetValueInt64 success: %{public}ld"</span>, result64);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li>
</li><li><span class="hljs-comment">// GetValueInt64注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetValueInt64},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetValueInt64方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getValueInt64"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(getValueInt64(-123))JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM GetValueInt64 success:</span> <span class="hljs-number">-123</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getvaluedouble">OH_JSVM_GetValueDouble<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getvaluedouble" tips="复制节点链接"></i></h3><p>将JavaScript value转为JSVM模块中的double类型数据。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_GetValueDouble的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetDouble</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">double</span> value = <span class="hljs-number">0</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetValueDouble</span>(env, args[<span class="hljs-number">0</span>], &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetDouble fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetDouble success: %{public}f"</span>, value);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li>
</li><li><span class="hljs-comment">// GetDouble注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetDouble},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetDouble方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getDouble"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(getDouble(-110.0456))JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM GetDouble success:</span> <span class="hljs-number">-110.045600</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createint32">OH_JSVM_CreateInt32<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createint32" tips="复制节点链接"></i></h3><p>根据int32_t数据创建JavaScript number对象。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_CreateInt32的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateInt32</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int32_t</span> value = <span class="hljs-number">-20</span>;</li><li>    <span class="hljs-comment">// 创建JavaScript中的int32数字</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateInt32 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-type">int32_t</span> number = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, result, &amp;number);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateInt32 success: %{public}d"</span>, number);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// CreateInt32注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateInt32},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateInt32方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createInt32"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(createInt32())JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM CreateInt32 success:</span> <span class="hljs-number">-20</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createuint32">OH_JSVM_CreateUint32<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createuint32" tips="复制节点链接"></i></h3><p>根据uint32_t数据创建JavaScript number对象。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_CreateUint32的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateUInt32</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 如果使用</span></li><li>    <span class="hljs-comment">// uint32_t类型来定义-26，会发生溢出，溢出时会对结果进行模运算，将负数的二进制补码转换为相应的正数。-26输出4294967270</span></li><li>    <span class="hljs-comment">// uint32_t是无符号的32位整数类型，只能表示非负整数。它的范围是从0到2 ^32 - 1，即0到4294967295</span></li><li>    <span class="hljs-comment">// 要表示的整数值</span></li><li>    <span class="hljs-type">uint32_t</span> value = <span class="hljs-number">26</span>;</li><li>    <span class="hljs-comment">// 创建JavaScript中的uint32数字</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateUint32</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateUInt32 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-type">uint32_t</span> number = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueUint32</span>(env, result, &amp;number);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateUInt32 success: %{public}u"</span>, number);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// CreateUInt32注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateUInt32},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateUInt32方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createUInt32"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(createUInt32())JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM CreateUInt32 success:</span> <span class="hljs-number">26</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createint64">OH_JSVM_CreateInt64<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createint64" tips="复制节点链接"></i></h3><p>根据int64_t数据创建JavaScript number对象。如果需要表示JS超大数，建议使用BigInt接口。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_CreateInt64的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateInt64</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int64_t</span> value = <span class="hljs-number">2147483648</span>;</li><li>    <span class="hljs-comment">// 创建JavaScript中的int64数字</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateInt64</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateInt64 fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-type">int64_t</span> number = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueInt64</span>(env, result, &amp;number);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateInt64 success: %{public}ld"</span>, number);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// CreateInt64注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateInt64},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateInt64方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createInt64"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(createInt64())JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM CreateInt64 success:</span> <span class="hljs-number">2147483648</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createdouble">OH_JSVM_CreateDouble<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createdouble" tips="复制节点链接"></i></h3><p>根据double数据创建JavaScript number对象。</p> <p>cpp部分代码：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// CreateDouble注册回调</span></li><li>
</li><li><span class="hljs-comment">// OH_JSVM_CreateDouble的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateDouble</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">double</span> value = <span class="hljs-number">1.234</span>;</li><li>    <span class="hljs-comment">// 创建JavaScript中的double数字</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateDouble</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDouble fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-type">double</span> number = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueDouble</span>(env, result, &amp;number);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDouble success: %{public}f"</span>, number);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateDouble},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateDouble方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createDouble"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* srcCallNative = <span class="hljs-string">R"JS(createDouble())JS"</span>;</li></ol></pre></div></div> <p>预期的输出结果：</p> <div _ngcontent-qpx-c106="" class="highlight-div"><div _ngcontent-qpx-c106="" class="highlight-div-header"><div _ngcontent-qpx-c106="" class="highlight-div-header-left"><div _ngcontent-qpx-c106="" class="handle-button expand-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qpx-c106="" class="highlight-div-header-right"><div _ngcontent-qpx-c106="" class="handle-button ai-button"></div><div _ngcontent-qpx-c106="" class="handle-button line-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qpx-c106="" class="handle-button theme-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qpx-c106="" class="handle-button copy-button"><div _ngcontent-qpx-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qpx-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM CreateDouble success:</span> <span class="hljs-number">1.234000</span></li></ol></pre></div></div> </div> </div> <div></div></div>