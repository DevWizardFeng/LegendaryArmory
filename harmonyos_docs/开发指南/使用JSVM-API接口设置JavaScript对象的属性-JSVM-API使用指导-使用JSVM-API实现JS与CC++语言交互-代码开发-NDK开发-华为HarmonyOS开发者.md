<h1 _ngcontent-qoc-c119="" class="doc-title ng-star-inserted" title="使用JSVM-API接口设置JavaScript对象的属性"> 使用JSVM-API接口设置JavaScript对象的属性 </h1>

<div _ngcontent-qoc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用JSVM-API接口获取和设置JavaScript对象的属性。通过合理使用这些函数，实现更复杂的功能和逻辑。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>在JavaScript对象属性的相关开发中，需要处理JavaScript对象属性，确保正确地访问、设置、删除属性，并了解属性的继承关系和枚举特性。以下是一些关键概念：</p> <ul><li><strong>对象（Object）</strong>：在JavaScript中，对象是一种复合数据类型，它允许存储多个不同类型的值作为一个单独的实体。对象是属性和方法的集合。属性是与对象相关联的值，而方法则是对象可以执行的操作。</li><li><strong>属性（Property）</strong>：在JavaScript中，属性是对象特征的键值对。每个属性都有一个名字（也称为键或标识符）和一个值。属性的值可以是任意数据类型，包括基本类型、对象和函数。</li><li><strong>可枚举属性（EnumerableProperty）</strong>：在JavaScript中，对象的属性分为可枚举和不可枚举之分，它们是由属性的enumerable值决定的，即内部 “可枚举” 标志设置为true或false。可枚举性决定了属性是否能被 for...in 遍历到。</li><li><strong>自有属性（OwnProperty）</strong>：自有属性是直接定义在对象上的属性，而不是从原型链继承的。</li></ul> </div>  <div class="tiledSection"><h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">功能说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetPropertyNames</td> <td class="cellrowborder" valign="top" width="50%">获取给定对象的所有可枚举属性名称，结果变量将存储一个包含所有可枚举属性名称的JavaScript数组</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_SetProperty</td> <td class="cellrowborder" valign="top" width="50%">为给定对象设置一个属性</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称，检索目标对象的属性</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_HasProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称，查询目标对象是否有此属性</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_DeleteProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称，删除目标对象属性</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_HasOwnProperty</td> <td class="cellrowborder" valign="top" width="50%">判断给定Object中是否有指定名称的own property。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_SetNamedProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称为目标对象设置属性，此方法等效于调用OH_JSVM_SetProperty， 其中，通过utf8Name传入的字符串用于创建JSVM_Value。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetNamedProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称，检索目标对象的属性，此方法等效于调用OH_JSVM_GetProperty， 其中，通过utf8Name传入的字符串用于创建JSVM_Value。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_HasNamedProperty</td> <td class="cellrowborder" valign="top" width="50%">用给定的属性的名称，查询目标对象是否有此属性，此方法等效于使用从作为utf8Name传入的字符串创建的JSVM_Value调用OH_JSVM_HasProperty。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_DefineProperties</td> <td class="cellrowborder" valign="top" width="50%">批量的向给定对象中定义属性</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetAllPropertyNames</td> <td class="cellrowborder" valign="top" width="50%">获取给定对象的所有可用属性名称，结果变量将存储一个包含所有可枚举属性名称的JavaScript数组</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-jsvm-process">使用JSVM-API实现JS与C/C++语言交互开发流程</a>，本文仅展示接口对应的C++代码。</p> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getpropertynames" class="firsth2">OH_JSVM_GetPropertyNames<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getpropertynames" tips="复制节点链接"></i></h3><p>以字符串数组的形式获取对象的可枚举属性的名称，如果接口调用成功则返回JSVM_OK。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_GetPropertyNames的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetPropertyNames</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 将obj作为参数传入</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 以字符串数组的形式获取对象的可枚举属性的名称，以result传出</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetPropertyNames</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to get propertynames"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_GetPropertyNames success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetPropertyNames注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetPropertyNames},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetPropertyNames方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getPropertyNames"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = '{ data: 0, message: "hello world"}';</span></li><li><span class="hljs-string">    let script = getPropertyNames(obj);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_GetPropertyNames success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_setproperty">OH_JSVM_SetProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_setproperty" tips="复制节点链接"></i></h3><p>将给定的属性与值设置入给定的Object。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_SetProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">SetProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收js侧传入的三个参数：第一个参数为想要设置的object，第二个参数为属性，第三个参数为属性对应的值</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">3</span>;</li><li>    JSVM_Value args[<span class="hljs-number">3</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_GetCbInfo fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 通过调用OH_JSVM_SetProperty接口将属性与值设置入object如果失败，直接抛出错误</span></li><li>    status = <span class="hljs-built_in">OH_JSVM_SetProperty</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[<span class="hljs-number">2</span>]);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_SetProperty fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_SetProperty success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 将设置成功后的object返回出去</span></li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li><span class="hljs-comment">// SetProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = SetProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// SetProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"setProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    setProperty(obj, "code", "hi")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_SetProperty success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getproperty">OH_JSVM_GetProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getproperty" tips="复制节点链接"></i></h3><p>获取给定Object的给定属性对应的值。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_GetProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个js传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 传入的第一个参数为要检测的object，第二个对象为要检测的属性，通过调用OH_JSVM_GetProperty接口获取对应的值</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetProperty</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_GetProperty fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_GetProperty success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    getProperty(obj, "message")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_GetProperty success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_hasproperty">OH_JSVM_HasProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_hasproperty" tips="复制节点链接"></i></h3><p>检查对象中是否存在指定的属性，可以避免访问不存在属性导致的异常或错误。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_HasProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">HasProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 从js侧传入两个参数：第一个参数为要检验的对象，第二个参数为要检测是否存在对象的属性</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将参数传入OH_JSVM_HasProperty方法中，若接口调用成功则将结果转化为JSVM_Value类型抛出，否则抛出错误</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_HasProperty</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_HasProperty fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_HasProperty success:%{public}d"</span>, result);</li><li>    }</li><li>    <span class="hljs-comment">// 若传入属性存在传入对象中，则输出true将结果转化为JSVM_Value类型抛出</span></li><li>    JSVM_Value returnResult = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;returnResult);</li><li>    <span class="hljs-keyword">return</span> returnResult;</li><li>}</li><li><span class="hljs-comment">// HasProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = HasProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// HasProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"hasProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    hasProperty(obj, "data")</span></li><li><span class="hljs-string">    hasProperty(obj, 0)</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hasProperty(obj, "data")输出</span></li><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_HasProperty <span class="hljs-attr">success</span>:<span class="hljs-number">1</span></li><li><span class="hljs-comment">// hasProperty(obj, 0)输出</span></li><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_HasProperty <span class="hljs-attr">success</span>:<span class="hljs-number">0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_deleteproperty">OH_JSVM_DeleteProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_deleteproperty" tips="复制节点链接"></i></h3><p>尝试从给定的Object中删除由key指定的属性，并返回操作的结果。</p> <p>如果对象是一个不可扩展的对象，或者属性是不可配置的，则可能无法删除该属性。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_DeleteProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">DeleteProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    JSVM_ValueType valueType;</li><li>    <span class="hljs-built_in">OH_JSVM_Typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueType);</li><li>    <span class="hljs-keyword">if</span> (valueType != JSVM_OBJECT) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Expects an object as argument."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 从传入的Object对象中删除指定属性，返回是否删除成功的bool结果值</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_DeleteProperty</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_DeleteProperty failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_DeleteProperty success:%{public}d"</span>, result);</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为JSVM_value并返回</span></li><li>    JSVM_Value ret;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;ret);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li><li><span class="hljs-comment">// DeleteProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = DeleteProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// DeleteProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"deleteProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    deleteProperty(obj, "message")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_DeleteProperty <span class="hljs-attr">success</span>:<span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_hasownproperty">OH_JSVM_HasOwnProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_hasownproperty" tips="复制节点链接"></i></h3><p>用于检查传入的Object是否具有自己的命名属性，不包括从原型链上继承的属性。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_HasOwnProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">HasOwnProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 检查第一个参数是否为对象</span></li><li>    JSVM_ValueType valueType1;</li><li>    <span class="hljs-built_in">OH_JSVM_Typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueType1);</li><li>    <span class="hljs-keyword">if</span> (valueType1 != JSVM_OBJECT) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"First argument must be an object."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 检查第二个参数是否为string</span></li><li>    JSVM_ValueType valuetype2;</li><li>    <span class="hljs-built_in">OH_JSVM_Typeof</span>(env, args[<span class="hljs-number">1</span>], &amp;valuetype2);</li><li>    <span class="hljs-keyword">if</span> (valuetype2 != JSVM_STRING ) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Second argument must be a string."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 检查对象是否具有指定属性，结果存储在hasProperty中</span></li><li>    <span class="hljs-type">bool</span> hasProperty = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_HasOwnProperty</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;hasProperty);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_HasOwnProperty failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_HasOwnProperty success:%{public}d"</span>, hasProperty);</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为JSVM_Value并返回</span></li><li>    JSVM_Value result;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, hasProperty, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// HasOwnProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = HasOwnProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// HasOwnProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"hasOwnProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    hasOwnProperty(obj, "message")</span></li><li><span class="hljs-string">    hasOwnProperty(obj, "__defineGetter__")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hasOwnProperty(obj, "message")输出</span></li><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_HasOwnProperty <span class="hljs-attr">success</span>:<span class="hljs-number">1</span></li><li><span class="hljs-comment">// hasOwnProperty(obj, "__defineGetter__")输出</span></li><li><span class="hljs-comment">// `__defineGetter__`为Object原型方法，非OwnProperty，预期返回0</span></li><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_HasOwnProperty <span class="hljs-attr">success</span>:<span class="hljs-number">0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_setnamedproperty">OH_JSVM_SetNamedProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_setnamedproperty" tips="复制节点链接"></i></h3><p>用于在传入的Javascript对象上设置一个命名属性。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_SetNamedProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">SetNamedProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的一个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value str;</li><li>    <span class="hljs-type">char</span> strKey[<span class="hljs-number">32</span>] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, &amp;str, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取传入参数字符串并存储在strKey中</span></li><li>    <span class="hljs-type">size_t</span> keyLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, str, strKey, <span class="hljs-number">32</span>, &amp;keyLength);</li><li>    <span class="hljs-comment">// 创建一个新对象</span></li><li>    JSVM_Value newObj;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateObject</span>(env, &amp;newObj);</li><li>    <span class="hljs-comment">// 设置整数值1234为属性值</span></li><li>    <span class="hljs-type">int32_t</span> value = <span class="hljs-number">1234</span>;</li><li>    JSVM_Value numValue;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, value, &amp;numValue);</li><li>    <span class="hljs-comment">// 将整数值与指定属性名关联</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_SetNamedProperty</span>(env, newObj, strKey, numValue);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_SetNamedProperty failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_SetNamedProperty success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 返回新创建并设置命名属性的对象</span></li><li>    <span class="hljs-keyword">return</span> newObj;</li><li>}</li><li><span class="hljs-comment">// SetNamedProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = SetNamedProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// SetNamedProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"setNamedProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    setNamedProperty("message")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_SetNamedProperty success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getnamedproperty">OH_JSVM_GetNamedProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getnamedproperty" tips="复制节点链接"></i></h3><p>用于从Javascript对象中获取命名属性的值。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_GetNamedProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetNamedProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">char</span> strKey[<span class="hljs-number">32</span>] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要获取的属性名</span></li><li>    <span class="hljs-type">size_t</span> keyLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, args[<span class="hljs-number">1</span>], strKey, <span class="hljs-number">32</span>, &amp;keyLength);</li><li>    <span class="hljs-comment">// 获取指定属性的值并存储在result中</span></li><li>    JSVM_Value result;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetNamedProperty</span>(env, args[<span class="hljs-number">0</span>], strKey, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_GetNamedProperty failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_GetNamedProperty success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetNamedProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetNamedProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetNamedProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getNamedProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    getNamedProperty(obj, "message")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_GetNamedProperty success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_hasnamedproperty">OH_JSVM_HasNamedProperty<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_hasnamedproperty" tips="复制节点链接"></i></h3><p>用于检查Javascript对象中是否包含指定的命名属性。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_HasNamedProperty的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">HasNamedProperty</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">char</span> strKey[<span class="hljs-number">32</span>] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要检查的属性名</span></li><li>    <span class="hljs-type">size_t</span> keyLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, args[<span class="hljs-number">1</span>], strKey, <span class="hljs-number">32</span>, &amp;keyLength);</li><li>    <span class="hljs-comment">// 检查对象是否具有指定命名的属性，并将结果存储在hasProperty中</span></li><li>    <span class="hljs-type">bool</span> hasProperty = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_HasNamedProperty</span>(env, args[<span class="hljs-number">0</span>], strKey, &amp;hasProperty);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM OH_JSVM_HasNamedProperty failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_HasNamedProperty success:%{public}d"</span>, hasProperty);</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为JSVM_Value并返回</span></li><li>    JSVM_Value result;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, hasProperty, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// HasNamedProperty注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = HasNamedProperty},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// HasNamedProperty方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"hasNamedProperty"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = { data: 0, message: "hello world", 50: 1};</span></li><li><span class="hljs-string">    hasNamedProperty(obj, "message")</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_HasNamedProperty <span class="hljs-attr">success</span>:<span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_defineproperties">OH_JSVM_DefineProperties<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_defineproperties" tips="复制节点链接"></i></h3><p>用于定义对象的自定义属性，可一次性为对象设置若干个属性。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fstream&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-comment">// 属性描述符列表中defineMethodPropertiesExample属性的回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">DefineMethodPropertiesExample</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">int32_t</span> propValue = <span class="hljs-number">26</span>;</li><li>    JSVM_Value returnValue;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, propValue, &amp;returnValue);</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li><li><span class="hljs-comment">// 属性描述符列表中getterCallback属性的回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetterCallback</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    JSVM_Value result;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str = <span class="hljs-string">"Hello world!"</span>;</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-built_in">strlen</span>(str);</li><li>    <span class="hljs-comment">// 创建属性的值</span></li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, str, length, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 执行JavaScript字符串的函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">RunScriptAndLogResult</span><span class="hljs-params">(JSVM_Env env, <span class="hljs-type">const</span> std::string &amp;srcCode)</span> </span>{</li><li>    JSVM_Value sourceCodeValue;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, srcCode.<span class="hljs-built_in">c_str</span>(), srcCode.<span class="hljs-built_in">size</span>(), &amp;sourceCodeValue);</li><li>    JSVM_Script script;</li><li>    <span class="hljs-comment">// 编译JavaScript代码字符串并返回编译后的脚本</span></li><li>    <span class="hljs-built_in">OH_JSVM_CompileScript</span>(env, sourceCodeValue, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">nullptr</span>, &amp;script);</li><li>    JSVM_Value jsVmResult;</li><li>    <span class="hljs-comment">// 执行JavaScript代码字符串</span></li><li>    <span class="hljs-built_in">OH_JSVM_RunScript</span>(env, script, &amp;jsVmResult);</li><li>    <span class="hljs-keyword">return</span> jsVmResult;</li><li>}</li><li>
</li><li><span class="hljs-comment">// OH_JSVM_DefineProperties的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">DefineProperties</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 接受一个JavaScript侧传入的空object</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 创建一个string类型的属性值</span></li><li>    JSVM_Value stringValue;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"Hello!"</span>, JSVM_AUTO_LENGTH, &amp;stringValue);</li><li>    <span class="hljs-comment">// 创建属性描述符对应的回调函数列表</span></li><li>    JSVM_CallbackStruct param[] = {</li><li>        {.data = <span class="hljs-literal">nullptr</span>, .callback = DefineMethodPropertiesExample},</li><li>        {.data = <span class="hljs-literal">nullptr</span>, .callback = GetterCallback},</li><li>
</li><li>    };</li><li>    <span class="hljs-comment">// 创建属性描述符列表，不同类型属性值添加位置参考JSVM_PropertyDescriptor定义</span></li><li>    JSVM_PropertyDescriptor descriptor[] = {</li><li>        <span class="hljs-comment">// 定义method类型的属性值</span></li><li>        {<span class="hljs-string">"defineMethodPropertiesExample"</span>, <span class="hljs-literal">nullptr</span>, &amp;param[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>        <span class="hljs-comment">// 定义string类型的属性值</span></li><li>        {<span class="hljs-string">"defineStringPropertiesExample"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, stringValue, JSVM_DEFAULT},</li><li>        <span class="hljs-comment">// 定义getter类型的属性值</span></li><li>        {<span class="hljs-string">"getterCallback"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;param[<span class="hljs-number">1</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>,JSVM_DEFAULT}};</li><li>    <span class="hljs-comment">// 根据属性描述符列表为obj对象创建属性</span></li><li>    JSVM_Status statusProperty;</li><li>    statusProperty = <span class="hljs-built_in">OH_JSVM_DefineProperties</span>(env, *argv, <span class="hljs-built_in">sizeof</span>(descriptor) / <span class="hljs-built_in">sizeof</span>(descriptor[<span class="hljs-number">0</span>]), descriptor);</li><li>    <span class="hljs-keyword">if</span> (statusProperty != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"JSVM DefineProperties fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 调用obj对象中添加的属性</span></li><li>    <span class="hljs-comment">// 运行obj.defineMethodPropertiesExample()并将结果返回给JavaScript</span></li><li>    <span class="hljs-type">static</span> std::string srcMethod;</li><li>    srcMethod = <span class="hljs-string">R"JS(obj.defineMethodPropertiesExample();)JS"</span>;</li><li>    JSVM_Value jsVmResult = <span class="hljs-built_in">RunScriptAndLogResult</span>(env, srcMethod);</li><li>    <span class="hljs-keyword">if</span> (jsVmResult != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-type">int32_t</span> number;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, jsVmResult, &amp;number);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM DefineMethodPropertiesExample success:%{public}d"</span>, number);</li><li>    }</li><li>    <span class="hljs-comment">// 运行obj.defineStringPropertiesExample()并将结果返回给JavaScript</span></li><li>    <span class="hljs-type">static</span> std::string srcString;</li><li>    srcString = <span class="hljs-string">R"JS(obj.defineStringPropertiesExample;)JS"</span>;</li><li>    JSVM_Value jsVmResult1 = <span class="hljs-built_in">RunScriptAndLogResult</span>(env, srcString);</li><li>    <span class="hljs-keyword">if</span> (jsVmResult1 != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, jsVmResult1, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>        <span class="hljs-type">char</span> *buf = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(length + <span class="hljs-number">1</span>);</li><li>        <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">nullptr</span>) {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"malloc failed"</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>        }</li><li>        <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, length + <span class="hljs-number">1</span>);</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, jsVmResult1, buf, length + <span class="hljs-number">1</span>, &amp;length);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM defineStringPropertiesExample success:%{public}s"</span>, buf);</li><li>        <span class="hljs-built_in">free</span>(buf);</li><li>    }</li><li>    <span class="hljs-comment">// 调用obj的getterCallback()并将结果字符串返回给JavaScript</span></li><li>    <span class="hljs-type">static</span> std::string srcGetter;</li><li>    srcGetter = <span class="hljs-string">R"JS(obj.getterCallback;)JS"</span>;</li><li>    JSVM_Value jsVmResult2 = <span class="hljs-built_in">RunScriptAndLogResult</span>(env, srcGetter);</li><li>    <span class="hljs-keyword">if</span> (jsVmResult2 != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, jsVmResult2, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>        <span class="hljs-type">char</span> *buf = (<span class="hljs-type">char</span> *)<span class="hljs-built_in">malloc</span>(length + <span class="hljs-number">1</span>);</li><li>        <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">nullptr</span>) {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"malloc failed"</span>);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>        }</li><li>        <span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, length + <span class="hljs-number">1</span>);</li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, jsVmResult2, buf, length + <span class="hljs-number">1</span>, &amp;length);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM getterCallback success:%{public}s"</span>, buf);</li><li>        <span class="hljs-built_in">free</span>(buf);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> jsVmResult;</li><li>}</li><li>
</li><li><span class="hljs-comment">// DefineProperties注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = DefineProperties},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// DefineProperties方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"defineProperties"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = {};</span></li><li><span class="hljs-string">    defineProperties(obj)</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-title class_">DefineMethodPropertiesExample</span> <span class="hljs-attr">success</span>:<span class="hljs-number">26</span></li><li><span class="hljs-variable constant_">JSVM</span> defineStringPropertiesExample <span class="hljs-attr">success</span>:<span class="hljs-title class_">Hello</span>!</li><li><span class="hljs-variable constant_">JSVM</span> getterCallback <span class="hljs-attr">success</span>:<span class="hljs-title class_">Hello</span> world!</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getallpropertynames">OH_JSVM_GetAllPropertyNames<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getallpropertynames" tips="复制节点链接"></i></h3><p>获取给定对象的所有可枚举属性名称，结果变量将存储一个包含这些属性名称的JavaScript数组。</p> <p>cpp部分代码：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// OH_JSVM_GetAllPropertyNames的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetAllPropertyNames</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的一个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>];</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取给定对象的所有属性名称(自有属性)</span></li><li>    JSVM_Value result;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetAllPropertyNames</span>(env, args[<span class="hljs-number">0</span>],</li><li>                                         JSVM_KeyCollectionMode::JSVM_KEY_OWN_ONLY,</li><li>                                         JSVM_KeyFilter::JSVM_KEY_WRITABLE,</li><li>                                         JSVM_KeyConversion::JSVM_KEY_NUMBERS_TO_STRINGS, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to get allpropertynames"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM OH_JSVM_GetAllPropertyNames success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetAllPropertyNames注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetAllPropertyNames},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetAllPropertyNames方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getAllPropertyNames"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">    let obj = '{ data: 0, message: "hello world", 50: 1}';</span></li><li><span class="hljs-string">    let script = getAllPropertyNames(obj);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-qoc-c106="" class="highlight-div"><div _ngcontent-qoc-c106="" class="highlight-div-header"><div _ngcontent-qoc-c106="" class="highlight-div-header-left"><div _ngcontent-qoc-c106="" class="handle-button expand-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qoc-c106="" class="highlight-div-header-right"><div _ngcontent-qoc-c106="" class="handle-button ai-button"></div><div _ngcontent-qoc-c106="" class="handle-button line-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qoc-c106="" class="handle-button theme-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qoc-c106="" class="handle-button copy-button"><div _ngcontent-qoc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qoc-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> OH_JSVM_GetAllPropertyNames success</li></ol></pre></div></div> </div> </div> <div></div></div>