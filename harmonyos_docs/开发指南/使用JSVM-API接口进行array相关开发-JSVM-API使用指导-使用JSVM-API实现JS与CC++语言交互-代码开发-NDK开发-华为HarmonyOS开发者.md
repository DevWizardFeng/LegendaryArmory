<h1 _ngcontent-ygw-c119="" class="doc-title ng-star-inserted" title="使用JSVM-API接口进行array相关开发"> 使用JSVM-API接口进行array相关开发 </h1>

<div _ngcontent-ygw-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用JSVM-API接口进行数组（array）相关开发时，在JSVM模块中可以调用相关接口直接操作和处理JavaScript中的数组。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>使用 JSVM-API 接口进行数组（array）相关开发时，涉及的基本概念主要包括数组的创建、访问、修改、遍历以及与数组相关的操作。这些概念对于理解在 JSVM 模块中与 JavaScript 数组交互非常重要。以下是一些关键概念：</p> <ul><li><strong>数组的创建</strong>：若在 JSVM 模块中需要创建新的 JavaScript 数组时，可以使用提供的 OH_JSVM_CreateArray 接口创建数组，将传递给 JavaScript 层。</li><li><strong>数组相关操作</strong>：在 JSVM 模块中通过对应的接口获取 JavaScript 数组的长度、检索指定索引处的元素、设置指定索引的元素值，从而实现 JSVM 模块与 JavaScript 数组的交互。</li><li><strong>TypedArray</strong>：JavaScript 中的 TypedArray 是一种类数组数据视图，用于描述二进制数据。它可以视为指定元素类型的类数组数据视图，TypedArray 没有直接构造器，但是可以通过其子类构造器构造创建。子类包括：Int8Array、Uint8Array、Uint8ClampedArray、Int16Array、Int32Array等。</li><li><strong>ArrayBuffer</strong>：ArrayBuffer 是固定长度的二进制数据缓冲区。</li><li><strong>DataView</strong>：DataView 是 JavaScript 中的一种视图，是可以从 ArrayBuffer 对象中读写多种数值类型的底层接口。</li></ul> </div>  <div class="tiledSection"><h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">功能说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateArray</td> <td class="cellrowborder" valign="top" width="50%">创建一个新的 JavaScript 数组对象</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateArrayWithLength</td> <td class="cellrowborder" valign="top" width="50%">创建一个指定长度的 JavaScript 数组对象</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateTypedarray</td> <td class="cellrowborder" valign="top" width="50%">在现有的ArrayBuffer上创建JavaScript TypedArray对象，TypedArray对象提供类似类数组的视图，每个元素具有相同的二进制标量数据类型。注意(length * size_of_element) + byte_offset 不得超过传入数组的大小（以字节为单位），否则会引发RangeError异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateDataview</td> <td class="cellrowborder" valign="top" width="50%">在现有的 ArrayBuffer 上创建一个 JavaScript DataView 对象，DataView 对象在底层数据缓冲区上提供类似数组的视图，该 ArrayBuffer 允许有不同大小和类型的元素。要求 byte_length + byte_offset 小于或等于传入数组的字节大小，否则会引发 RangeError 异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetArrayLength</td> <td class="cellrowborder" valign="top" width="50%">返回 Array 对象的长度</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetTypedarrayInfo</td> <td class="cellrowborder" valign="top" width="50%">获取 TypedArray（类型化数组）对象的信息</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetDataviewInfo</td> <td class="cellrowborder" valign="top" width="50%">获取 DataView 对象的信息</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_IsArray</td> <td class="cellrowborder" valign="top" width="50%">判断一个 JavaScript 对象是否为 Array 类型对象</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_SetElement</td> <td class="cellrowborder" valign="top" width="50%">在给定对象的指定索引处设置元素</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetElement</td> <td class="cellrowborder" valign="top" width="50%">获取给定对象指定索引处的元素</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_HasElement</td> <td class="cellrowborder" valign="top" width="50%">若给定对象的指定索引处拥有属性，获取该元素</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_DeleteElement</td> <td class="cellrowborder" valign="top" width="50%">尝试删除给定对象的指定索引处的元素</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_IsDataview</td> <td class="cellrowborder" valign="top" width="50%">判断一个 JavaScript 对象是否为 DataView 类型对象</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_IsTypedarray</td> <td class="cellrowborder" valign="top" width="50%">判断一个 JavaScript 对象是否为 TypedArray 类型对象</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>JSVM-API 接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-jsvm-process">使用 JSVM-API 实现 JS 与 C/C++ 语言交互开发流程</a>，本文仅对接口对应 C++ 相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createarray" class="firsth2">OH_JSVM_CreateArray<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createarray" tips="复制节点链接"></i></h3><p>创建一个新的 JavaScript 数组对象。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// CreateArray注册回调</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> DIFF_VALUE_FIVE = <span class="hljs-number">5</span>;</li><li><span class="hljs-comment">// OH_JSVM_CreateArray的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateArray</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建一个空数组</span></li><li>    JSVM_Value array = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateArray</span>(env, &amp;array);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateArray fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateArray success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 对创建的数组进行赋值</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; DIFF_VALUE_FIVE; i++) {</li><li>        JSVM_Value element;</li><li>        <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, i, &amp;element));</li><li>        <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_SetElement</span>(env, array, i, element));</li><li>    }</li><li>    <span class="hljs-keyword">return</span> array;</li><li>}</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateArray},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateArray方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createArray"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">  function testCreateArray() {</span></li><li><span class="hljs-string">    return createArray();</span></li><li><span class="hljs-string">  }</span></li><li><span class="hljs-string">  testCreateArray();</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>JSVM CreateArray success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createarraywithlength">OH_JSVM_CreateArrayWithLength<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createarraywithlength" tips="复制节点链接"></i></h3><p>创建一个指定长度的 JavaScript 数组对象。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_CreateArrayWithLength的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateArrayWithLength</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 解析传递的参数OH_JSVM_GetCbInfo</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取传递的数组长度</span></li><li>    <span class="hljs-type">int32_t</span> length = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, argv[<span class="hljs-number">0</span>], &amp;length);</li><li>    <span class="hljs-comment">// 使用OH_JSVM_CreateArrayWithLength创建传递固定长度的数组</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateArrayWithLength</span>(env, length, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-comment">// 给创建的数组设置值</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {</li><li>            JSVM_Value value;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, i, &amp;value));</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_SetElement</span>(env, result, i, value));</li><li>        }</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateArrayWithLength success"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateArrayWithLength fail"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// CreateArrayWithLength注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateArrayWithLength},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateArrayWithLength方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createArrayWithLength"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let num = 7;</span></li><li><span class="hljs-string">function testCreateArrayWithLength(num){</span></li><li><span class="hljs-string">    return createArrayWithLength(num);</span></li><li><span class="hljs-string">}</span></li><li><span class="hljs-string">testCreateArrayWithLength(num);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>JSVM CreateArrayWithLength success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createtypedarray">OH_JSVM_CreateTypedarray<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createtypedarray" tips="复制节点链接"></i></h3><p>在现有的 ArrayBuffer上 创建一个 JavaScript TypedArray 对象,TypedArray 对象在底层数据缓冲区上提供类似数组的视图，其中每个元素都具有相同的底层二进制标量数据类型。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_CreateTypedarray的样例方法</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> DIFF_VALUE_THREE = <span class="hljs-number">3</span>;</li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateTypedArray</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">int32_t</span> typeNum = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">0</span>], &amp;typeNum);</li><li>    JSVM_TypedarrayType arrayType;</li><li>    <span class="hljs-comment">// 用于存储每个元素的大小</span></li><li>    <span class="hljs-type">size_t</span> elementSize = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 转换为JSVM_TypedarrayType类型</span></li><li>    arrayType = <span class="hljs-built_in">static_cast</span>&lt;JSVM_TypedarrayType&gt;(typeNum);</li><li>    <span class="hljs-keyword">switch</span> (typeNum) {</li><li>        <span class="hljs-keyword">case</span> JSVM_INT8_ARRAY:</li><li>        <span class="hljs-keyword">case</span> JSVM_UINT8_ARRAY:</li><li>        <span class="hljs-keyword">case</span> JSVM_UINT8_CLAMPED_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int8_t</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> JSVM_INT16_ARRAY:</li><li>        <span class="hljs-keyword">case</span> JSVM_UINT16_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int16_t</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> JSVM_INT32_ARRAY:</li><li>        <span class="hljs-keyword">case</span> JSVM_UINT32_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int32_t</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> JSVM_FLOAT32_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> JSVM_FLOAT64_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">double</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> JSVM_BIGINT64_ARRAY:</li><li>        <span class="hljs-keyword">case</span> JSVM_BIGUINT64_ARRAY:</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int64_t</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-comment">// 默认创建JSVM_INT8_ARRAY类型</span></li><li>            arrayType = JSVM_INT8_ARRAY;</li><li>            elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int8_t</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-type">size_t</span> length = DIFF_VALUE_THREE;</li><li>    JSVM_Value arrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Value typedArray = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">void</span> *data;</li><li>    <span class="hljs-comment">// 创建一个ArrayBuffer</span></li><li>    <span class="hljs-built_in">OH_JSVM_CreateArraybuffer</span>(env, length * elementSize, (<span class="hljs-type">void</span> **)&amp;data, &amp;arrayBuffer);</li><li>    <span class="hljs-comment">// 根据给定类型创建TypedArray</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateTypedarray</span>(env, arrayType, length, arrayBuffer, <span class="hljs-number">0</span>, &amp;typedArray);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateTypedArray fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateTypedArray success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> typedArray;</li><li>}</li><li><span class="hljs-comment">// CreateTypedArray注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateTypedArray},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateTypedArray方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createTypedArray"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">const type = {</span></li><li><span class="hljs-string">    INT8_ARRAY: 0,</span></li><li><span class="hljs-string">    UINT8_ARRAY: 1,</span></li><li><span class="hljs-string">    UINT8_CLAMPED_ARRAY: 2,</span></li><li><span class="hljs-string">    INT16_ARRAY: 3,</span></li><li><span class="hljs-string">    UINT16_ARRAY: 4,</span></li><li><span class="hljs-string">    INT32_ARRAY: 5,</span></li><li><span class="hljs-string">    UINT32_ARRAY: 6,</span></li><li><span class="hljs-string">    FLOAT32_ARRAY: 7,</span></li><li><span class="hljs-string">    FLOAT64_ARRAY: 8,</span></li><li><span class="hljs-string">    BIGINT64_ARRAY: 9,</span></li><li><span class="hljs-string">    BIGUINT64_ARRAY: 10</span></li><li><span class="hljs-string">};</span></li><li><span class="hljs-string">createTypedArray(type.INT8_ARRAY);</span></li><li><span class="hljs-string">createTypedArray(type.INT32_ARRAY);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>JSVM CreateTypedArray success</li><li>JSVM CreateTypedArray success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createdataview">OH_JSVM_CreateDataview<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createdataview" tips="复制节点链接"></i></h3><p>在现有的 ArrayBuffer 上创建一个 JavaScript DataView 对象，DataView 对象在底层数据缓冲区上提供类似数组的视图。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> DIFF_VALUE_FOUR = <span class="hljs-number">4</span>;</li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> DIFF_VALUE_TWELVE = <span class="hljs-number">12</span>;</li><li><span class="hljs-comment">// OH_JSVM_CreateDataview的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">CreateDataView</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    JSVM_Value arrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// DataView的字节长度</span></li><li>    <span class="hljs-type">size_t</span> byteLength = DIFF_VALUE_TWELVE;</li><li>    <span class="hljs-comment">// 字节偏移量</span></li><li>    <span class="hljs-type">size_t</span> byteOffset = DIFF_VALUE_FOUR;</li><li>    <span class="hljs-comment">// 获取回调函数的参数信息</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将参数转换为对象类型</span></li><li>    <span class="hljs-built_in">OH_JSVM_CoerceToObject</span>(env, args[<span class="hljs-number">0</span>], &amp;arrayBuffer);</li><li>    <span class="hljs-comment">// 创建一个数据视图对象，并指定字节长度和字节偏移量</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateDataview</span>(env, byteLength, arrayBuffer, byteOffset, &amp;result);</li><li>    <span class="hljs-comment">// 获取DataView的指针和长度信息</span></li><li>    <span class="hljs-type">uint8_t</span> *data = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 为DataView赋值</span></li><li>    <span class="hljs-type">int32_t</span> infoType = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">1</span>], &amp;infoType);</li><li>    <span class="hljs-type">size_t</span> returnLength = <span class="hljs-number">0</span>;</li><li>    JSVM_Value returnArrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">size_t</span> returnOffset = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> { BYTE_LENGTH, ARRAY_BUFFER, BYTE_OFFSET };</li><li>    <span class="hljs-comment">// 获取dataview信息</span></li><li>    <span class="hljs-built_in">OH_JSVM_GetDataviewInfo</span>(env, result, &amp;returnLength, (<span class="hljs-type">void</span> **)&amp;data, &amp;returnArrayBuffer, &amp;returnOffset);</li><li>    JSVM_Value returnResult = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">switch</span> (infoType) {</li><li>        <span class="hljs-keyword">case</span> BYTE_LENGTH:</li><li>            JSVM_Value len;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, returnLength, &amp;len));</li><li>            returnResult = len;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView success, returnLength: %{public}d"</span>, returnLength);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> ARRAY_BUFFER:</li><li>            {</li><li>                <span class="hljs-type">bool</span> isArraybuffer = <span class="hljs-literal">false</span>;</li><li>                <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_IsArraybuffer</span>(env, returnArrayBuffer, &amp;isArraybuffer));</li><li>                JSVM_Value isArray;</li><li>                <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, isArraybuffer, &amp;isArray);</li><li>                returnResult = isArray;</li><li>                <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                    <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView fail"</span>);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView success, isArraybuffer: %{public}d"</span>, isArraybuffer);</li><li>                }</li><li>                <span class="hljs-keyword">break</span>;</li><li>            }</li><li>        <span class="hljs-keyword">case</span> BYTE_OFFSET:</li><li>            JSVM_Value offset;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, returnOffset, &amp;offset));</li><li>            returnResult = offset;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM CreateDataView success, returnOffset: %{public}d"</span>, returnOffset);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> returnResult;</li><li>}</li><li><span class="hljs-comment">// CreateDataView注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = CreateDataView},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// CreateDataView方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"createDataView"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string"> let BYTE_LENGTH = 0;</span></li><li><span class="hljs-string"> createDataView(new ArrayBuffer(16), BYTE_LENGTH);</span></li><li><span class="hljs-string"> let IS_ARRAYBUFFER = 1;</span></li><li><span class="hljs-string"> createDataView(new ArrayBuffer(16), IS_ARRAYBUFFER);</span></li><li><span class="hljs-string"> let BYTE_OFFSET = 2;</span></li><li><span class="hljs-string"> createDataView(new ArrayBuffer(16), BYTE_OFFSET);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">CreateDataView</span> <span class="hljs-string">success,</span> <span class="hljs-attr">returnLength:</span> <span class="hljs-number">12</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">CreateDataView</span> <span class="hljs-string">success,</span> <span class="hljs-attr">isArraybuffer:</span> <span class="hljs-number">1</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">CreateDataView</span> <span class="hljs-string">success,</span> <span class="hljs-attr">returnOffset:</span> <span class="hljs-number">4</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getarraylength">OH_JSVM_GetArrayLength<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getarraylength" tips="复制节点链接"></i></h3><p>返回 Array 对象的长度。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_GetArrayLength的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetArrayLength</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 这里要对length进行初始化</span></li><li>    <span class="hljs-type">uint32_t</span> length = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 检查参数是否为数组</span></li><li>    <span class="hljs-type">bool</span> isArray = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_IsArray</span>(env, args[<span class="hljs-number">0</span>], &amp;isArray);</li><li>    <span class="hljs-keyword">if</span> (!isArray) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM Argument must be an array"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">/*</span></li><li><span class="hljs-comment">     * 当成功获取数组长度时，length会被赋值成实际JSArray的长度，接口返回JSVM_OK状态码；</span></li><li><span class="hljs-comment">     * 当args[0]不是一个JSArray类型。例如，当args[0]是一个proxy对象时，无法获取长度。</span></li><li><span class="hljs-comment">     * 此时，length维持原值不变，接口返回JSVM_ARRAY_EXPECTED状态码。</span></li><li><span class="hljs-comment">     */</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetArrayLength</span>(env, args[<span class="hljs-number">0</span>], &amp;length);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-comment">// 创建返回值</span></li><li>        <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, length, &amp;result));</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM length: %{public}d"</span>, length);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetArrayLength注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetArrayLength},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetArrayLength方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getArrayLength"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let data = [0, 1, 2, 3, 4, 5];</span></li><li><span class="hljs-string">getArrayLength(data);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-perl" data-highlighted="yes"><ol class="linenums"><li>JSVM <span class="hljs-keyword">length</span>: <span class="hljs-number">6</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_gettypedarrayinfo">OH_JSVM_GetTypedarrayInfo<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_gettypedarrayinfo" tips="复制节点链接"></i></h3><p>获取 TypedArray（类型化数组）对象的信息。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_GetTypedarrayInfo的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetTypedArrayInfo</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析参数，第一个参数为需要获得的信息的TypedArray类型数据，第二个参数为需要获得的信息类型的枚举值</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 将第二个参数转为int32类型便于比较</span></li><li>    <span class="hljs-type">int32_t</span> infoTypeParam = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">1</span>], &amp;infoTypeParam);</li><li>    <span class="hljs-comment">// 定义枚举类型与ArkTS侧枚举类型infoType顺序含义一致</span></li><li>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> { INFO_TYPE, INFO_LENGTH, INFO_ARRAY_BUFFER, INFO_BYTE_OFFSET };</li><li>    <span class="hljs-type">void</span> *data;</li><li>    JSVM_TypedarrayType type;</li><li>    <span class="hljs-type">size_t</span> byteOffset = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>    JSVM_Value arrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 调用接口OH_JSVM_GetTypedarrayInfo获得TypedArray类型数据的信息</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetTypedarrayInfo</span>(env, args[<span class="hljs-number">0</span>], &amp;type, &amp;length, &amp;data, &amp;arrayBuffer, &amp;byteOffset);</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 根据属性名，返回TypedArray对应的属性值</span></li><li>    <span class="hljs-keyword">switch</span> (infoTypeParam) {</li><li>        <span class="hljs-keyword">case</span> INFO_TYPE:</li><li>            <span class="hljs-comment">// 如果传入的参数是int8类型的TypedArray数据，它的类型（type）为JSVM_INT8_ARRAY</span></li><li>            JSVM_Value int8_type;</li><li>            <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, type == JSVM_INT8_ARRAY, &amp;int8_type);</li><li>            result = int8_type;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(</li><li>                    LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo success, JSVM_INT8_ARRAY: %{public}d"</span>, type == JSVM_INT8_ARRAY);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> INFO_LENGTH:</li><li>            <span class="hljs-comment">// TypedArray中的元素数</span></li><li>            JSVM_Value jsvmLength;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, length, &amp;jsvmLength));</li><li>            result = jsvmLength;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo success, length: %{public}d"</span>, length);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> INFO_BYTE_OFFSET:</li><li>            <span class="hljs-comment">// TypedArray数组的第一个元素所在的基础原生数组中的字节偏移量</span></li><li>            JSVM_Value jsvmOffset;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, byteOffset, &amp;jsvmOffset));</li><li>            result = jsvmOffset;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo success, byteOffset: %{public}d"</span>, byteOffset);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> INFO_ARRAY_BUFFER:</li><li>            {</li><li>                <span class="hljs-comment">// TypedArray下的ArrayBuffer</span></li><li>                <span class="hljs-type">bool</span> isArrayBuffer = <span class="hljs-literal">false</span>;</li><li>                <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_IsArraybuffer</span>(env, arrayBuffer, &amp;isArrayBuffer));</li><li>                JSVM_Value isArray;</li><li>                <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, isArrayBuffer, &amp;isArray);</li><li>                result = isArray;</li><li>                <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                    <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo fail"</span>);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetTypedArrayInfo success, isArrayBuffer: %{public}d"</span>, isArrayBuffer);</li><li>                }</li><li>                <span class="hljs-keyword">break</span>;</li><li>            }</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetTypedArrayInfo注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetTypedArrayInfo},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetTypedArrayInfo方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getTypedArrayInfo"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">// is JSVM_INT8_ARRAY</span></li><li><span class="hljs-string">getTypedArrayInfo(new Int8Array(3), 0);</span></li><li><span class="hljs-string">// length</span></li><li><span class="hljs-string">getTypedArrayInfo(new Int8Array(5), 1);</span></li><li><span class="hljs-string">// is_arraybuffer</span></li><li><span class="hljs-string">getTypedArrayInfo(new Int8Array(5), 2);</span></li><li><span class="hljs-string">// byteoffset</span></li><li><span class="hljs-string">getTypedArrayInfo(new Int8Array(1), 3);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetTypedArrayInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">JSVM_INT8_ARRAY:</span> <span class="hljs-number">1</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetTypedArrayInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">length:</span> <span class="hljs-number">5</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetTypedArrayInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">isArrayBuffer:</span> <span class="hljs-number">1</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetTypedArrayInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">byteOffset:</span> <span class="hljs-number">0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getdataviewinfo">OH_JSVM_GetDataviewInfo<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getdataviewinfo" tips="复制节点链接"></i></h3><p>获取 Dataview 对象的信息。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_GetDataviewInfo的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetDataViewInfo</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析参数，第一个参数为需要获得的信息的DataView类型数据，第二个参数为需要获得的信息类型的枚举值</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将第二个参数转为int32类型的数字</span></li><li>    <span class="hljs-type">int32_t</span> infoType = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">1</span>], &amp;infoType);</li><li>    <span class="hljs-type">size_t</span> byteLength = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">void</span> *data;</li><li>    JSVM_Value arrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">size_t</span> byteOffset = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 定义枚举类型与ArkTS侧枚举类型infoType顺序含义一致</span></li><li>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">infoTypeEnum</span> { BYTE_LENGTH, ARRAY_BUFFER, BYTE_OFFSET };</li><li>    <span class="hljs-comment">// 获取dataview信息</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetDataviewInfo</span>(env, args[<span class="hljs-number">0</span>], &amp;byteLength, &amp;data, &amp;arrayBuffer, &amp;byteOffset);</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">switch</span> (infoType) {</li><li>        <span class="hljs-keyword">case</span> BYTE_LENGTH:</li><li>            <span class="hljs-comment">// 返回查询DataView的长度</span></li><li>            JSVM_Value len;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, byteLength, &amp;len));</li><li>            result = len;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo success, byteLength: %{public}d"</span>, byteLength);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> ARRAY_BUFFER:</li><li>            {</li><li>                <span class="hljs-comment">// 判断DataView的Info里的arraybuffer是否为arraybuffer</span></li><li>                <span class="hljs-type">bool</span> isArrayBuffer = <span class="hljs-literal">false</span>;</li><li>                <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_IsArraybuffer</span>(env, arrayBuffer, &amp;isArrayBuffer));</li><li>                JSVM_Value isArray;</li><li>                <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, isArrayBuffer, &amp;isArray);</li><li>                result = isArray;</li><li>                <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                    <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo fail"</span>);</li><li>                } <span class="hljs-keyword">else</span> {</li><li>                    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo success, isArrayBuffer: %{public}d"</span>, isArrayBuffer);</li><li>                }</li><li>                <span class="hljs-keyword">break</span>;</li><li>            }</li><li>        <span class="hljs-keyword">case</span> BYTE_OFFSET:</li><li>            <span class="hljs-comment">// 返回查询DataView的偏移量</span></li><li>            JSVM_Value offset;</li><li>            <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, byteOffset, &amp;offset));</li><li>            result = offset;</li><li>            <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>                <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo fail"</span>);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetDataViewInfo success, byteOffset: %{public}d"</span>, byteOffset);</li><li>            }</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetDataViewInfo注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetDataViewInfo},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetDataViewInfo方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getDataViewInfo"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">// bytelength</span></li><li><span class="hljs-string">getDataViewInfo(new DataView(new Int8Array([2,5]).buffer), 0);</span></li><li><span class="hljs-string">// is arraybuffer</span></li><li><span class="hljs-string">let data = 'a';</span></li><li><span class="hljs-string">let isarraybuffer = 1;</span></li><li><span class="hljs-string">getDataViewInfo(data, isarraybuffer);</span></li><li><span class="hljs-string">// is arraybuffer</span></li><li><span class="hljs-string">data = new DataView(new Int8Array([2,5,3]).buffer);</span></li><li><span class="hljs-string">isarraybuffer = 1;</span></li><li><span class="hljs-string">getDataViewInfo(data, isarraybuffer);</span></li><li><span class="hljs-string">// byte_offset</span></li><li><span class="hljs-string">data = new DataView(new Int8Array([2,5,3]).buffer);</span></li><li><span class="hljs-string">isarraybuffer = 2;</span></li><li><span class="hljs-string">getDataViewInfo(data, isarraybuffer);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetDataViewInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">byteLength:</span> <span class="hljs-number">2</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetDataViewInfo</span> <span class="hljs-string">fail</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetDataViewInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">isArrayBuffer:</span> <span class="hljs-number">1</span></li><li><span class="hljs-string">JSVM</span> <span class="hljs-string">GetDataViewInfo</span> <span class="hljs-string">success,</span> <span class="hljs-attr">byteOffset:</span> <span class="hljs-number">0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_isarray">OH_JSVM_IsArray<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_isarray" tips="复制节点链接"></i></h3><p>判断一个 JavaScript 对象是否为 Array 类型对象。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_IsArray的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">IsArray</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_IsArray</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    JSVM_Value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;returnValue));</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM IsArray fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM IsArray success, IsArray: %{public}d"</span>, result);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li><li><span class="hljs-comment">// IsArray注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = IsArray},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// IsArray方法别名，TS侧调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"isArray"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let data = [1, 2, 3, 4, 5];</span></li><li><span class="hljs-string">isArray(data);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">JSVM</span> <span class="hljs-string">IsArray</span> <span class="hljs-string">success,</span> <span class="hljs-attr">IsArray:</span> <span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_setelement">OH_JSVM_SetElement<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_setelement" tips="复制节点链接"></i></h3><p>在给定对象的指定索引处设置元素。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_SetElement的样例方法</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> DIFF_VALUE_THREE = <span class="hljs-number">3</span>;</li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">SetElement</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = DIFF_VALUE_THREE;</li><li>    JSVM_Value args[<span class="hljs-number">3</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">int32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_SetElement</span>(env, args[<span class="hljs-number">0</span>], index, args[<span class="hljs-number">2</span>]);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM SetElement fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM SetElement success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li><span class="hljs-comment">// SetElement注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = SetElement},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// SetElement方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"setElement"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let data = [1, 2, 3, 4, 5];</span></li><li><span class="hljs-string">setElement(data, 3, undefined);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>JSVM SetElement success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getelement">OH_JSVM_GetElement<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getelement" tips="复制节点链接"></i></h3><p>获取给定对象指定索引处的元素。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_GetElement的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">GetElement</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取请求元素的索引值</span></li><li>    <span class="hljs-type">uint32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueUint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 获取请求索引位置的元素值并存储在result中</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetElement</span>(env, args[<span class="hljs-number">0</span>], index, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM GetElement fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM GetElement success"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// GetElement注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = GetElement},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// GetElement方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"getElement"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let arr = [10, 'hello', null, true];</span></li><li><span class="hljs-string">getElement(arr, 3);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>JSVM GetElement success</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_haselement">OH_JSVM_HasElement<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_haselement" tips="复制节点链接"></i></h3><p>若给定对象的指定索引处拥有属性，获取元素。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_HasElement的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">HasElement</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要判断的元素的索引</span></li><li>    <span class="hljs-type">uint32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueUint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 判断指定索引位置的元素是否存在</span></li><li>    <span class="hljs-type">bool</span> hasElement = <span class="hljs-literal">true</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_HasElement</span>(env, args[<span class="hljs-number">0</span>], index, &amp;hasElement);</li><li>    <span class="hljs-comment">// 将boolean结果转换为JSVM_Value并返回</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM hasElement fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, hasElement, &amp;result);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM hasElement: %{public}d"</span>, hasElement);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// HasElement注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = HasElement},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// HasElement方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"hasElement"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let arr = [10, 'hello', null, true];</span></li><li><span class="hljs-string">hasElement(arr, 0);</span></li><li><span class="hljs-string">hasElement(arr, 4);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM hasElement:</span> <span class="hljs-number">1</span></li><li><span class="hljs-attr">JSVM hasElement:</span> <span class="hljs-number">0</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_deleteelement">OH_JSVM_DeleteElement<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_deleteelement" tips="复制节点链接"></i></h3><p>尝试删除给定对象的指定索引处的元素。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_DeleteElement的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">DeleteElement</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 获取js侧传入的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>));</li><li>    <span class="hljs-comment">// 获取要删除的元素的索引</span></li><li>    <span class="hljs-type">uint32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">JSVM_CALL</span>(<span class="hljs-built_in">OH_JSVM_GetValueUint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index));</li><li>    <span class="hljs-comment">// 尝试删除请求索引位置的元素</span></li><li>    <span class="hljs-type">bool</span> deleted = <span class="hljs-literal">true</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_DeleteElement</span>(env, args[<span class="hljs-number">0</span>], index, &amp;deleted);</li><li>    <span class="hljs-comment">// 将boolean结果转换为JSVM_Value并返回</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM DeleteElement fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, deleted, &amp;result);</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM DeleteElement: %{public}d"</span>, deleted);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// DeleteElement注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = DeleteElement},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// DeleteElement方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"deleteElement"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let arr = [10, 'hello', null, true];</span></li><li><span class="hljs-string">deleteElement(arr, 0);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM DeleteElement:</span> <span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_isdataview">OH_JSVM_IsDataview<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_isdataview" tips="复制节点链接"></i></h3><p>判断一个 JavaScript 对象是否为 Dataview 类型对象。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_IsDataview的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">IsDataView</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用OH_JSVM_IsDataview接口判断给定入参是否为DataView数据。</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_IsDataview</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    JSVM_Value isDataView = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;isDataView);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM IsDataView fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM IsDataView: %{public}d"</span>, result);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> isDataView;</li><li>}</li><li><span class="hljs-comment">// IsDataView注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = IsDataView},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// IsDataView方法别名，TS侧调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"isDataView"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">let buffer = new ArrayBuffer(16);</span></li><li><span class="hljs-string">let dataView = new DataView(buffer);</span></li><li><span class="hljs-string">isDataView(dataView);</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM IsDataView:</span> <span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_istypedarray">OH_JSVM_IsTypedarray<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_istypedarray" tips="复制节点链接"></i></h3><p>判断一个 JavaScript 对象是否为 TypedArray 类型对象。</p> <p>cpp 部分代码：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ark_runtime/jsvm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-comment">// OH_JSVM_IsTypedarray的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">IsTypedarray</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_IsTypedarray</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    JSVM_Value isTypedArray = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;isTypedArray);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"JSVM IsTypedarray fail"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM IsTypedarray: %{public}d"</span>, result);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> isTypedArray;</li><li>}</li><li><span class="hljs-comment">// IsTypedarray注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = IsTypedarray},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// IsTypedarray方法别名，TS侧调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"isTypedarray"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(</span></li><li><span class="hljs-string">isTypedarray(new Uint16Array([1, 2, 3, 4]));</span></li><li><span class="hljs-string">)JS"</span>;</li></ol></pre></div></div> <p>预计的输出结果：</p> <div _ngcontent-ygw-c106="" class="highlight-div"><div _ngcontent-ygw-c106="" class="highlight-div-header"><div _ngcontent-ygw-c106="" class="highlight-div-header-left"><div _ngcontent-ygw-c106="" class="handle-button expand-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ygw-c106="" class="highlight-div-header-right"><div _ngcontent-ygw-c106="" class="handle-button ai-button"></div><div _ngcontent-ygw-c106="" class="handle-button line-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ygw-c106="" class="handle-button theme-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ygw-c106="" class="handle-button copy-button"><div _ngcontent-ygw-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ygw-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-yaml" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">JSVM IsTypedarray:</span> <span class="hljs-number">1</span></li></ol></pre></div></div> </div> </div> <div></div></div>