<h1 _ngcontent-xur-c119="" class="doc-title ng-star-inserted" title="使用JSVM-API接口进行错误处理开发"> 使用JSVM-API接口进行错误处理开发 </h1>

<div _ngcontent-xur-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用JSVM-API接口进行错误处理，可以更好地管理和响应错误情况。合理使用这些函数，可以提高模块的稳定性和可靠性。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>在JavaScript编程中，异常和错误是常见的概念。异常表示发生了某种意外情况，而错误则指示程序无法正确执行某些操作。JSVM-API提供了一系列方法来帮助开发者在模块中处理JavaScript中的异常和错误。下面是一些基本概念：</p> <ul><li><strong>异常（Exception）</strong>：在程序执行过程中可能会出现的意外情况，可以是语法错误、运行时错误或逻辑错误，例如除以零或对未定义变量的操作。</li><li><strong>错误（Error）</strong>：表示程序无法顺利执行某些操作，可以是由底层系统、API函数或开发者自定义的。</li><li><strong>类型错误（TypeError）</strong>：表示操作或值的类型不符合预期的情况，通常是由于错误的数据类型导致的。</li><li><strong>范围错误（RangeError）</strong>：表示一个值不在预期的范围内，例如对数组长度之外的索引进行访问。</li><li><strong>语法错误（SyntaxError）</strong>：表示一段代码的语法错误。</li></ul> <p>这些基本概念在异常和错误处理中非常重要，开发者需要通过适当的方法来捕获、处理或向用户报告这些异常和错误，以确保程序的稳定性和正确性。JSVM-API提供的方法可以帮助开发者在模块开发中处理JavaScript中的异常和错误。</p> </div>  <div class="tiledSection"><h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">功能说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_CreateError、OH_JSVM_CreateTypeError、OH_JSVM_CreateRangeError、OH_JSVM_CreateSyntaxError</td> <td class="cellrowborder" valign="top" width="50%">在C/C++中需要创建一个错误对象时，可以使用这些函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_Throw</td> <td class="cellrowborder" valign="top" width="50%">当在C/C++中出现了错误或异常情况时，通过使用OH_JSVM_CreateError或OH_JSVM_GetLastErrorInfo方法创建或获取JavaScript Error对象，使用该方法抛出已有的JavaScript Error对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_ThrowError、OH_JSVM_ThrowTypeError、OH_JSVM_ThrowRangeError、OH_JSVM_ThrowSyntaxError</td> <td class="cellrowborder" valign="top" width="50%">当在C/C++中出现了错误或异常情况时，可以使用这些函数来抛出JavaScript中的异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_IsError</td> <td class="cellrowborder" valign="top" width="50%">查询JSVM_Value以检查它是否表示错误对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetAndClearLastException</td> <td class="cellrowborder" valign="top" width="50%">清理并返回最后一个JS异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_IsExceptionPending</td> <td class="cellrowborder" valign="top" width="50%">判断当前是否有异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">OH_JSVM_GetLastErrorInfo</td> <td class="cellrowborder" valign="top" width="50%">获取最后一次发生的错误信息。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>JSVM-API接口开发流程可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-jsvm-process">使用JSVM-API实现JS与C/C++语言交互开发流程</a>，本文仅展示接口对应的C++相关代码。</p> </div>  <div class="tiledSection"><h3 id="oh_jsvm_throw" class="firsth2">OH_JSVM_Throw<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_throw" tips="复制节点链接"></i></h3><p>用于抛出JavaScript Error对象。当在本机代码中发生错误或检测到不符合预期的情况时，可以使用此接口来抛出JavaScript Error，使其能够被捕获并处理。示例参考OH_JSVM_CreateError。</p> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createerror">OH_JSVM_CreateError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript Error。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// 捕获清除并打印错误,该函数作为公共函数，在本文档后续样例中不再声明和定义</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">GetLastErrorAndClean</span><span class="hljs-params">(JSVM_Env env)</span> </span>{</li><li>    <span class="hljs-comment">// 调用OH_JSVM_GetAndClearLastException接口获取并清除最后一个未处理的异常。即使存在挂起的JavaScript异常，也可以调用此API</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetAndClearLastException</span>(env, &amp;result);</li><li>    <span class="hljs-comment">// 打印错误信息</span></li><li>    JSVM_Value message = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetNamedProperty</span>((env), result, <span class="hljs-string">"message"</span>, &amp;message);</li><li>    <span class="hljs-built_in">OH_JSVM_GetNamedProperty</span>((env), result, <span class="hljs-string">"code"</span>, &amp;errorCode);</li><li>    <span class="hljs-type">char</span> messageStr[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-type">char</span> codeStr[<span class="hljs-number">256</span>];</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, message, messageStr, <span class="hljs-number">256</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, errorCode, codeStr, <span class="hljs-number">256</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM error message: %{public}s, error code: %{public}s"</span>, messageStr, codeStr);</li><li>}</li><li>
</li><li><span class="hljs-comment">// OH_JSVM_CreateError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmCreateThrowError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorCode变量中</span></li><li>    JSVM_Value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"-1"</span>, JSVM_AUTO_LENGTH, &amp;errorCode);</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorMessage变量中</span></li><li>    JSVM_Value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"HasError"</span>, JSVM_AUTO_LENGTH, &amp;errorMessage);</li><li>    <span class="hljs-comment">// 创建一个JavaScript对象error</span></li><li>    JSVM_Value error = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateError</span>(env, errorCode, errorMessage, &amp;error);</li><li>    <span class="hljs-comment">// 通过OH_JSVM_Throw接口将对象抛出</span></li><li>    <span class="hljs-built_in">OH_JSVM_Throw</span>(env, error);</li><li>    <span class="hljs-built_in">GetLastErrorAndClean</span>(env);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// JsVmThrow注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmCreateThrowError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmCreateThrowError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmCreateThrowError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmCreateThrowError();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: <span class="hljs-title class_">HasError</span>, error <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_throwerror">OH_JSVM_ThrowError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_throwerror" tips="复制节点链接"></i></h3><p>用于抛出一个带文本信息的JS Error。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_ThrowError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmThrowError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 如果没有传递参数，直接抛出错误</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-string">"-1"</span>, <span class="hljs-string">"has Error"</span>);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-comment">// 通过入参获取到javaScript侧传入的字符串长度。</span></li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, argv[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>        <span class="hljs-type">char</span> *buffer = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[length + <span class="hljs-number">1</span>];</li><li>        <span class="hljs-comment">// 获取入参的字符串内容。</span></li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, argv[<span class="hljs-number">0</span>], buffer, length + <span class="hljs-number">1</span>, <span class="hljs-literal">nullptr</span>);</li><li>        <span class="hljs-comment">// 作为error信息填入到OH_JSVM_ThrowError接口中。</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-string">"self defined error code"</span>, buffer);</li><li>        <span class="hljs-keyword">delete</span>[] buffer;</li><li>    }</li><li>    <span class="hljs-built_in">GetLastErrorAndClean</span>(env);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// JsVmThrowError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmThrowError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmThrowError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmThrowError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmThrowError();jsVmThrowError("self defined error message");)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: has <span class="hljs-title class_">Error</span>, error <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span></li><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: self defined error message, error <span class="hljs-attr">code</span>: self defined error code</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_throwtypeerror">OH_JSVM_ThrowTypeError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_throwtypeerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript TypeError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_ThrowTypeError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmThrowTypeError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 如果没有传递参数，直接抛出错误</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowTypeError</span>(env, <span class="hljs-string">"-1"</span>, <span class="hljs-string">"throwing type error"</span>);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>) {</li><li>        <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>        <span class="hljs-comment">// 通过入参获取到javaScript侧传入的字符串长度</span></li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, argv[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>        <span class="hljs-type">char</span> *buffer = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[length + <span class="hljs-number">1</span>];</li><li>        <span class="hljs-comment">// 获取入参的字符串内容</span></li><li>        <span class="hljs-built_in">OH_JSVM_GetValueStringUtf8</span>(env, argv[<span class="hljs-number">0</span>], buffer, length + <span class="hljs-number">1</span>, <span class="hljs-literal">nullptr</span>);</li><li>        <span class="hljs-comment">// 作为error信息填入到OH_JSVM_ThrowTypeError接口中</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowTypeError</span>(env, <span class="hljs-string">"self defined error code"</span>, buffer);</li><li>        <span class="hljs-keyword">delete</span>[] buffer;</li><li>    }</li><li>    <span class="hljs-built_in">GetLastErrorAndClean</span>(env);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// JsVmThrowTypeError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmThrowTypeError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmThrowTypeError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmThrowTypeError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmThrowTypeError();jsVmThrowTypeError("self defined error message");)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: throwing <span class="hljs-keyword">type</span> error, error <span class="hljs-attr">code</span>: -<span class="hljs-number">1</span></li><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: self defined error message, error <span class="hljs-attr">code</span>: self defined error code</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_throwrangeerror">OH_JSVM_ThrowRangeError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_throwrangeerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript RangeError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_ThrowRangeError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmThrowRangeError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// js侧传入两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 如果传入参数个数不为2</span></li><li>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) {</li><li>        <span class="hljs-comment">// 这里抛出一个RangeError</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowRangeError</span>(env, <span class="hljs-string">"OH_JSVM_ThrowRangeError"</span>, <span class="hljs-string">"Expected two numbers as arguments"</span>);</li><li>        <span class="hljs-built_in">GetLastErrorAndClean</span>(env);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, <span class="hljs-literal">true</span>, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmThrowRangeError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmThrowRangeError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmThrowRangeError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmThrowRangeError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmThrowRangeError(1);)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: <span class="hljs-title class_">Expected</span> two numbers <span class="hljs-keyword">as</span> <span class="hljs-variable language_">arguments</span>, error <span class="hljs-attr">code</span>: OH_JSVM_ThrowRangeError</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_throwsyntaxerror">OH_JSVM_ThrowSyntaxError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_throwsyntaxerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript SyntaxError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_ThrowSyntaxError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmThrowSyntaxError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// JS侧传入运行的JS代码</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    JSVM_Script script = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 通过OH_JSVM_CompileScript接口编译JS代码</span></li><li>    <span class="hljs-built_in">OH_JSVM_CompileScript</span>(env, argv[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">true</span>, <span class="hljs-literal">nullptr</span>, &amp;script);</li><li>    JSVM_Value scriptResult = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 通过OH_JSVM_RunScript接口运行JS代码</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_RunScript</span>(env, script, &amp;scriptResult);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-comment">// 如果JSVM_RunScript接口返回状态不为JSVM_OK，则抛出一个SyntaxError</span></li><li>        <span class="hljs-built_in">OH_JSVM_ThrowSyntaxError</span>(env, <span class="hljs-string">"JsVmThrowSyntaxError"</span>, <span class="hljs-string">"throw syntax error"</span>);</li><li>        <span class="hljs-built_in">GetLastErrorAndClean</span>(env);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, <span class="hljs-literal">true</span>, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmThrowSyntaxError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmThrowSyntaxError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmThrowSyntaxError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmThrowSyntaxError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmThrowSyntaxError();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> error <span class="hljs-attr">message</span>: <span class="hljs-keyword">throw</span> syntax error, error <span class="hljs-attr">code</span>: <span class="hljs-title class_">JsVmThrowSyntaxError</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_iserror">OH_JSVM_IsError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_iserror" tips="复制节点链接"></i></h3><p>用于判断给定的JSVM_Value是否表示一个Error对象。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_IsError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmIsError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用接口OH_JSVM_IsError判断入参是否为一个error对象</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 如果JSVM_Value为一个error对象，则设置result为true的布尔值，否则设置为false</span></li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_IsError</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API call OH_JSVM_IsError success, result is %{public}d"</span>, result);</li><li>    }<span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API call OH_JSVM_IsError failed"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 取出result通过OH_JSVM_GetBoolean接口将取出的bool值转换为JSVM_Value类型的值返回出去</span></li><li>    JSVM_Value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetBoolean</span>(env, result, &amp;returnValue);</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li><li><span class="hljs-comment">// JsVmIsError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmIsError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmIsError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmIsError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmIsError(Error()))JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> call OH_JSVM_IsError success, result is <span class="hljs-number">1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createtypeerror">OH_JSVM_CreateTypeError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createtypeerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript TypeError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_CreateTypeError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmCreateTypeError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorCode变量中</span></li><li>    JSVM_Value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"-1"</span>, JSVM_AUTO_LENGTH, &amp;errorCode);</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorMessage变量中</span></li><li>    JSVM_Value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"HasError"</span>, JSVM_AUTO_LENGTH, &amp;errorMessage);</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateTypeError</span>(env, errorCode, errorMessage, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API Create TypeError SUCCESS"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API Create TypeError FAILED"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmCreateTypeError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmCreateTypeError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmCreateTypeError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmCreateTypeError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmCreateTypeError();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> <span class="hljs-title class_">Create</span> <span class="hljs-title class_">TypeError</span> <span class="hljs-variable constant_">SUCCESS</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createrangeerror">OH_JSVM_CreateRangeError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createrangeerror" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的JavaScript RangeError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_CreateRangeError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmCreateRangeError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorCode变量中</span></li><li>    JSVM_Value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"-1"</span>, JSVM_AUTO_LENGTH, &amp;errorCode);</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorMessage变量中</span></li><li>    JSVM_Value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"HasError"</span>, JSVM_AUTO_LENGTH, &amp;errorMessage);</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_CreateRangeError</span>(env, errorCode, errorMessage, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API CreateRangeError SUCCESS"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API CreateRangeError FAILED"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmCreateRangeError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmCreateRangeError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmCreateRangeError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmCreateRangeError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmCreateRangeError();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> <span class="hljs-title class_">CreateRangeError</span> <span class="hljs-variable constant_">SUCCESS</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_createsyntaxerror">OH_JSVM_CreateSyntaxError<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_createsyntaxerror" tips="复制节点链接"></i></h3><p>用于创建并获取一个带文本信息的JavaScript SyntaxError。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_CreateSyntaxError的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmCreateSyntaxError</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorCode变量中</span></li><li>    JSVM_Value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"-1"</span>, JSVM_AUTO_LENGTH, &amp;errorCode);</li><li>    <span class="hljs-comment">// 在JSVM环境中创建一个字符串，并将其存储在errorMessage变量中</span></li><li>    JSVM_Value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_CreateStringUtf8</span>(env, <span class="hljs-string">"HasError"</span>, JSVM_AUTO_LENGTH, &amp;errorMessage);</li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status =  <span class="hljs-built_in">OH_JSVM_CreateSyntaxError</span>(env, errorCode, errorMessage, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status == JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API CreateSyntaxError SUCCESS"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API CreateSyntaxError FAILED"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmCreateSyntaxError注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmCreateSyntaxError},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmCreateSyntaxError方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmCreateSyntaxError"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmCreateSyntaxError();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> <span class="hljs-title class_">CreateSyntaxError</span> <span class="hljs-variable constant_">SUCCESS</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getandclearlastexception">OH_JSVM_GetAndClearLastException<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getandclearlastexception" tips="复制节点链接"></i></h3><p>用于获取并清除最近一次出现的异常。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_GetAndClearLastException的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmGetAndClearLastException</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 抛出异常，创造异常情况</span></li><li>    <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-string">"OH_JSVM_ThrowError errorCode"</span>, <span class="hljs-string">"OH_JSVM_ThrowError errorMessage"</span>);</li><li>    <span class="hljs-comment">// 调用OH_JSVM_GetAndClearLastException接口获取并清除最后一个未处理的异常。即使存在挂起的JavaScript异常，也可以调用此API</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    JSVM_Status status = <span class="hljs-built_in">OH_JSVM_GetAndClearLastException</span>(env, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API OH_JSVM_GetAndClearLastException FAILED"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API OH_JSVM_GetAndClearLastException SUCCESS"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmGetAndClearLastException注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmGetAndClearLastException},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmGetAndClearLastException方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmGetAndClearLastException"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmGetAndClearLastException();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> OH_JSVM_GetAndClearLastException <span class="hljs-variable constant_">SUCCESS</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_isexceptionpending">OH_JSVM_IsExceptionPending<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_isexceptionpending" tips="复制节点链接"></i></h3><p>用于判断是否出现了异常。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_IsExceptionPending的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmIsExceptionPending</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    JSVM_Status status;</li><li>    <span class="hljs-type">bool</span> isExceptionPending = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 在执行一些可能引发异常的操作后</span></li><li>    <span class="hljs-built_in">OH_JSVM_ThrowError</span>(env, <span class="hljs-string">"OH_JSVM_ThrowError errorCode"</span>, <span class="hljs-string">"OH_JSVM_ThrowError errorMessage"</span>);</li><li>    <span class="hljs-comment">// 检查当前环境中是否有异常挂起</span></li><li>    status = <span class="hljs-built_in">OH_JSVM_IsExceptionPending</span>(env, &amp;isExceptionPending);</li><li>    <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isExceptionPending) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API OH_JSVM_IsExceptionPending: SUCCESS"</span>);</li><li>        <span class="hljs-comment">// 处理异常挂起的情况</span></li><li>        JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>        status = <span class="hljs-built_in">OH_JSVM_GetAndClearLastException</span>(env, &amp;result);</li><li>        <span class="hljs-keyword">if</span> (status != JSVM_OK) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 将处理的异常返回出去</span></li><li>        <span class="hljs-keyword">return</span> result;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"JSVM API OH_JSVM_IsExceptionPending: FAILED"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// JsVmIsExceptionPending注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmIsExceptionPending},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmIsExceptionPending方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmIsExceptionPending"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmIsExceptionPending();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> <span class="hljs-attr">OH_JSVM_IsExceptionPending</span>: <span class="hljs-variable constant_">SUCCESS</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="oh_jsvm_getlasterrorinfo">OH_JSVM_GetLastErrorInfo<i class="anchor-icon anchor-icon-link" anchorid="oh_jsvm_getlasterrorinfo" tips="复制节点链接"></i></h3><p>用于获取调用JSVM接口最后一次发生的错误信息（接口返回值不为JSVM_OK），包括错误码、错误消息以及错误堆栈信息，即使存在挂起的JavaScript异常，也可以调用此API。</p> <p>注意: 通过OH_JSVM_ThrowError等接口主动触发的Error不会被该接口获取，除非调用接口时返回值不为JSVM_OK。</p> <p>cpp部分代码：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// hello.cpp</span></li><li><span class="hljs-comment">// OH_JSVM_GetLastErrorInfo的样例方法</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> JSVM_Value <span class="hljs-title">JsVmGetLastErrorInfo</span><span class="hljs-params">(JSVM_Env env, JSVM_CallbackInfo info)</span> </span>{</li><li>    <span class="hljs-comment">// 获取输入参数（这里以字符串message作为参数传入）</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    JSVM_Value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">OH_JSVM_GetCbInfo</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的字符串参数以OH_JSVM_GetValueInt32取出，主动制造错误</span></li><li>    <span class="hljs-type">int32_t</span> value = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetValueInt32</span>(env, args[<span class="hljs-number">0</span>], &amp;value);</li><li>    <span class="hljs-comment">// 调用接口OH_JSVM_GetLastErrorInfo获取最后一次错误信息</span></li><li>    <span class="hljs-type">const</span> JSVM_ExtendedErrorInfo *errorInfo;</li><li>    <span class="hljs-built_in">OH_JSVM_GetLastErrorInfo</span>(env, &amp;errorInfo);</li><li>
</li><li>    <span class="hljs-comment">// 取出错误消息作为返回值带出去打印</span></li><li>    JSVM_Value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP,</li><li>                <span class="hljs-string">"JSVM API OH_JSVM_GetLastErrorInfo: SUCCESS, error message is %{public}s, error code is %{public}d"</span>,</li><li>                errorInfo-&gt;errorMessage, errorInfo-&gt;errorCode);</li><li>    <span class="hljs-comment">// 对异常进行处理，防止程序由于抛异常而退出</span></li><li>    JSVM_Value result1 = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">OH_JSVM_GetAndClearLastException</span>(env, &amp;result1);</li><li>    <span class="hljs-built_in">OH_JSVM_CreateInt32</span>(env, errorInfo-&gt;errorCode, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// JsVmGetLastErrorInfo注册回调</span></li><li><span class="hljs-type">static</span> JSVM_CallbackStruct param[] = {</li><li>    {.data = <span class="hljs-literal">nullptr</span>, .callback = JsVmGetLastErrorInfo},</li><li>};</li><li><span class="hljs-type">static</span> JSVM_CallbackStruct *method = param;</li><li><span class="hljs-comment">// JsVmGetLastErrorInfo方法别名，供JS调用</span></li><li><span class="hljs-type">static</span> JSVM_PropertyDescriptor descriptor[] = {</li><li>    {<span class="hljs-string">"jsVmGetLastErrorInfo"</span>, <span class="hljs-literal">nullptr</span>, method++, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, JSVM_DEFAULT},</li><li>};</li><li><span class="hljs-comment">// 样例测试js</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span> *srcCallNative = <span class="hljs-string">R"JS(jsVmGetLastErrorInfo();)JS"</span>;</li></ol></pre></div></div> <p>预期输出结果：</p> <div _ngcontent-xur-c106="" class="highlight-div"><div _ngcontent-xur-c106="" class="highlight-div-header"><div _ngcontent-xur-c106="" class="highlight-div-header-left"><div _ngcontent-xur-c106="" class="handle-button expand-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xur-c106="" class="highlight-div-header-right"><div _ngcontent-xur-c106="" class="handle-button ai-button"></div><div _ngcontent-xur-c106="" class="handle-button line-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xur-c106="" class="handle-button theme-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xur-c106="" class="handle-button copy-button"><div _ngcontent-xur-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xur-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable constant_">JSVM</span> <span class="hljs-variable constant_">API</span> <span class="hljs-attr">OH_JSVM_GetLastErrorInfo</span>: <span class="hljs-variable constant_">SUCCESS</span>, error message is A <span class="hljs-built_in">number</span> was expected, error code is <span class="hljs-number">6</span></li></ol></pre></div></div> </div> </div> <div></div></div>