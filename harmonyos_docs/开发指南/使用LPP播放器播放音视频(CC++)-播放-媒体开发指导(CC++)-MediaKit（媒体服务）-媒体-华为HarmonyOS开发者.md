<h1 _ngcontent-avg-c119="" class="doc-title ng-star-inserted" title="使用LPP播放器播放音视频 (C/C++)"> 使用LPP播放器播放音视频 (C/C++) </h1>

<div _ngcontent-avg-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 20开始，使用LPP（low power player）播放器可以实现从媒体源到渲染的音视频通路能力。本指南通过播放本地视频的示例，讲解如何使用LowPowerPlayer播放音视频。</p>    <p>播放流程包含：创建解封装器、创建播放器、设置回调监听函数、配置播放参数、播放控制（播放/暂停/继续/倍速/音量/停止/重置）、销毁播放器实例。</p>    <p><strong>图1</strong> 播放状态变化示意图</p>    <p><span><img originheight="1327" originwidth="1506" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114450.37353082906664532719616383798466:50001231000000:2800:5CA4635F996573F5B03734E96903848FB8B7C99A8482828739846117C8ECEBC2.png" width="920" height="810.6507304116866"></span></p>    <p>当播放处于ready/decoding/rendering/paused/stopped状态时，播放引擎此时处于工作状态会占用较多的系统资源。当暂停使用播放器时，可调用reset或destroy回收资源。</p>    <div class="tiledSection">     <h2 id="开发建议">开发建议<i class="anchor-icon anchor-icon-link" anchorid="开发建议" tips="复制节点链接"></i></h2>          <p>当前指导仅介绍如何实现媒体资源播放，在应用开发过程中可能会涉及后台播放、播放冲突等情况，请根据实际需要参考以下说明。</p>     <ul>      <li>       <p>由于硬件差异，LPP播放器能力仅在部分手机上支持。从API version 21开始，建议通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-avsink-base-h#oh_lowpoweravsink_getcapability" target="_blank">OH_LowPowerAVSink_GetCapability</a>查询LPP播放器能力是否支持。如果不支持，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/avcodec-kit-intro">AVCodec</a>能力实现播放。</p></li>      <li>       <p>当应用在播放过程中时，播放的媒体数据涉及音频，根据系统音频管理策略（参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency#处理音频焦点变化">处理音频焦点变化</a>事件）可知这会被其他应用打断，建议通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_setinterruptlistener" target="_blank">OH_LowPowerAudioSinkCallback_SetInterruptListener</a>主动监听音频打断事件，根据其回调参数提示做出相应的处理，避免出现应用状态与预期效果不一致的问题。</p></li>      <li>       <p>当设备同时连接多个音频输出设备时，建议通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_setdevicechangelistener" target="_blank">OH_LowPowerAudioSinkCallback_SetDeviceChangeListener</a>主动监听音频输出设备改变事件，并做出相应处理。</p></li>      <li>       <p>当应用在执行过程中，可能出现系统内部异常。如网络异常、内存不足、媒体服务死亡不可用等，建议通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_seterrorlistener" target="_blank">OH_LowPowerAudioSinkCallback_SetErrorListener</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_seterrorlistener" target="_blank">OH_LowPowerVideoSinkCallback_SetErrorListener</a>对应接口设置错误监听回调函数，根据不同错误类型和错误信息，做出相应处理，避免出现播放异常。</p></li>      <li>       <p>在播放过程中，播放器需要的数据要通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avdemuxer-h#oh_avdemuxer_readsamplebuffer" target="_blank">OH_AVDemuxer_ReadSampleBuffer</a>接口获取指定轨道的buffer，并通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-avsink-base-h#oh_avsamplesbuffer_appendonebuffer" target="_blank">OH_AVSamplesBuffer_AppendOneBuffer</a>进行多个buffer的封装，然后再通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_returnsamples" target="_blank">OH_LowPowerAudioSink_ReturnSamples</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_returnsamples" target="_blank">OH_LowPowerVideoSink_ReturnSamples</a>通知播放器进行消费，当播放器需要数据时，会触发通过 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_setdataneededlistener" target="_blank">OH_LowPowerAudioSinkCallback_SetDataNeededListener</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_setdataneededlistener" target="_blank">OH_LowPowerVideoSinkCallback_SetDataNeededListener</a>接口注册的回调函数。</p></li>      <li>       <p>需要注意函数的调用时机。根据状态示意图和详细的接口文档进行合理调用。在程序执行完成后，调用OH_***_Create方法的同时必须调用对应的OH_***_Destroy方法，进行资源释放。</p></li>      <li>       <p>用户在注册回调函数时，可在最后一个参数void *userData中来配置自定义数据，以便在回调函数中执行某些设置（如状态改变等）。</p>       <p>其他回调函数：</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_setpositionupdatelistener" target="_blank">OH_LowPowerAudioSinkCallback_SetPositionUpdateListener</a>：可获取播放进度。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_seteoslistener" target="_blank">OH_LowPowerAudioSinkCallback_SetEosListener</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_seteoslistener" target="_blank">OH_LowPowerVideoSinkCallback_SetEosListener</a>：播放结束触发。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_setrenderstartlistener" target="_blank">OH_LowPowerVideoSinkCallback_SetRenderStartListener</a>：视频开始渲染。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_settargetstartframe" target="_blank">OH_LowPowerVideoSink_SetTargetStartFrame</a>：到达目标帧。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_setstreamchangedlistener" target="_blank">OH_LowPowerVideoSinkCallback_SetStreamChangedListener</a>：视频流切换。</p>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_setfirstframedecodedlistener" target="_blank">OH_LowPowerVideoSinkCallback_SetFirstFrameDecodedListener</a>：首帧视频渲染完毕。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="开发步骤及注意事项">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h2>          <p>在CMake脚本中链接动态库。</p>     <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC liblowpower_avsink.so)</li></ol></pre></div></div>     <p>头文件引入。</p>     <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimedia/player_framework/lowpower_audio_sink_base.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimedia/player_framework/lowpower_audio_sink.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimedia/player_framework/lowpower_video_sink.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimedia/player_framework/lowpower_video_sink_base.h"</span></span></li></ol></pre></div></div>     <p>开发者使用系统日志能力时，需引入如下头文件：</p>     <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div>     <p>并需要在CMake脚本中链接如下动态库：</p>     <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libhilog_ndk.z.so)</li></ol></pre></div></div>     <p>使用该模块时，需要链接的库如下所示：解封装、基础解码、显示渲染等能力。</p>     <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">set</span>(BASE_LIBRARY</li><li>    libnative_media_codecbase.so libnative_media_core.so libnative_media_vdec.so libnative_window.so</li><li>    libnative_media_venc.so libnative_media_acodec.so libnative_media_avdemuxer.so libnative_media_avsource.so</li><li>    libohaudio.so</li><li>)</li><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC ${BASE_LIBRARY})</li></ol></pre></div></div>     <p>开发者通过引入<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-base-h" target="_blank">lowpower_audio_sink_base.h</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h" target="_blank">lowpower_audio_sink.h</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h" target="_blank">lowpower_video_sink.h</a>、 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-base-h" target="_blank">lowpower_video_sink_base.h</a> 头文件，使用音视频播放相关API。</p>     <ol>      <li>       <p>创建播放器。</p>       <p>根据实际情况，应用可使用自研解封装或可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithdatasource" target="_blank">OH_AVSource_CreateWithDataSource()</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithfd" target="_blank">OH_AVSource_CreateWithFD()</a>/<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avsource-h#oh_avsource_createwithuri" target="_blank">OH_AVSource_CreateWithURI()</a>来创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-avsource-oh-avsource" target="_blank">OH_AVSource</a> ，通过OH_AVSource调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-avdemuxer-h#oh_avdemuxer_createwithsource" target="_blank">OH_AVDemuxer_CreateWithSource()</a>，创建解封装器，获取视频的元信息。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-makefile" data-highlighted="yes"><ol class="linenums"><li>source_ = OH_AVSource_CreateWithFD(info.inputFd, info.inputFileOffset, info.inputFileSize);</li><li>demuxer_ = OH_AVDemuxer_CreateWithSource(source_);</li><li>int32_t ret = GetTrackInfo(sourceFormat, info);</li></ol></pre></div></div></li>      <li>       <p>根据视频元信息，调用 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_createbymime" target="_blank">OH_LowPowerAudioSink_CreateByMime</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_createbymime" target="_blank">OH_LowPowerVideoSink_CreateByMime</a>来创建播放器。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-ini" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">lppVideoStreamer_</span> = OH_LowPowerVideoSink_CreateByMime(codecMime.c_str())<span class="hljs-comment">;</span></li><li><span class="hljs-attr">lppAudioStreamer_</span> = OH_LowPowerAudioSink_CreateByMime(codecMime.c_str())<span class="hljs-comment">;</span></li></ol></pre></div></div></li>      <li>       <p>设置回调监听函数。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosinkcallback_create" target="_blank">OH_LowPowerAudioSinkCallback_Create</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosinkcallback_create" target="_blank">OH_LowPowerVideoSinkCallback_Create</a>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/api-lowpoweraudiosink-oh-lowpoweraudiosinkcallback" target="_blank">OH_LowPowerAudioSinkCallback</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/api-lowpowervideosink-oh-lowpowervideosinkcallback" target="_blank">OH_LowPowerVideoSinkCallback</a>的回调函数的整合，通过setListener函数向该结构体添加对应的回调函数，完成registerCallback的一次性注册。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">lppAudioStreamerCallback_</span> = <span class="hljs-title function_">OH_LowPowerAudioSinkCallback_Create</span>();</li><li><span class="hljs-title function_">OH_LowPowerAudioSinkCallback_SetDataNeededListener</span>(<span class="hljs-variable">lppAudioStreamerCallback_</span>, <span class="hljs-variable">LppCallback</span>::<span class="hljs-title class_">OnDataNeeded</span>, <span class="hljs-variable">lppUserData</span>);</li><li><span class="hljs-title function_">OH_LowPowerAudioSinkCallback_SetPositionUpdateListener</span>(<span class="hljs-variable">lppAudioStreamerCallback_</span>, <span class="hljs-variable">LppCallback</span>::<span class="hljs-title class_">OnPositionUpdated</span>, <span class="hljs-variable">lppUserData</span>);</li><li><span class="hljs-variable">ret</span> = <span class="hljs-title function_">OH_LowPowerAudioSink_RegisterCallback</span>(<span class="hljs-variable">lppAudioStreamer_</span>, <span class="hljs-variable">lppAudioStreamerCallback_</span>);</li></ol></pre></div></div></li>      <li>       <p>配置播放器。</p>       <p>根据之前通过解封装获得的元信息，创建并配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-core-oh-avformat" target="_blank">OH_AVFormat</a>。通过configure接口 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_configure" target="_blank">OH_LowPowerAudioSink_Configure</a> / <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_configure" target="_blank">OH_LowPowerVideoSink_Configure</a>进行播放器的配置，详细参数可参考示例代码。视频流需要使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_setvideosurface" target="_blank">OH_LowPowerVideoSink_SetVideoSurface</a>接口来设置显示窗口。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-perl" data-highlighted="yes"><ol class="linenums"><li>OH_AVFormat *<span class="hljs-keyword">format</span> = OH_AVFormat_Create();</li><li> </li><li>OH_AVFormat_SetIntValue(<span class="hljs-keyword">format</span>, OH_MD_KEY_WIDTH, sampleInfo.videoWidth);</li><li>OH_AVFormat_SetIntValue(<span class="hljs-keyword">format</span>, OH_MD_KEY_HEIGHT, sampleInfo.videoHeight);</li><li>OH_AVFormat_SetDoubleValue(<span class="hljs-keyword">format</span>, OH_MD_KEY_FRAME_RATE, sampleInfo.frameRate);</li><li>OH_AVFormat_SetIntValue(<span class="hljs-keyword">format</span>, OH_MD_KEY_PIXEL_FORMAT, sampleInfo.pixelFormat);</li><li>OH_AVFormat_SetIntValue(<span class="hljs-keyword">format</span>, OH_MD_KEY_ROTATION, sampleInfo.rotation);</li><li> </li><li><span class="hljs-keyword">int</span> ret = OH_LowPowerVideoSink_Configure(lppVideoStreamer<span class="hljs-number">_</span>, <span class="hljs-keyword">format</span>);</li></ol></pre></div></div></li>      <li>       <p>准备播放。</p>       <p>准备播放前，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_setsyncaudiosink" target="_blank">OH_LowPowerVideoSink_SetSyncAudioSink</a>设置音画同步绑定。然后调用prepare方法，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_prepare" target="_blank">OH_LowPowerAudioSink_Prepare</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_prepare" target="_blank">OH_LowPowerVideoSink_Prepare</a>进入'准备'阶段。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_LowPowerVideoSink_Prepare</span>(lppVideoStreamer_);</li></ol></pre></div></div></li>      <li>       <p>开始播放。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_start" target="_blank">OH_LowPowerAudioSink_Start</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_startrenderer" target="_blank">OH_LowPowerVideoSink_StartRenderer</a>开始渲染。视频流需要在渲染开始前调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_startdecoder" target="_blank">OH_LowPowerVideoSink_StartDecoder</a>开始解码或调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_renderfirstframe" target="_blank"> OH_LowPowerVideoSink_RenderFirstFrame</a>开始解码并送显首帧'接口'进入解码。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">OH_LowPowerVideoSink_StartDecoder</span>(lppVideoStreamer_);</li><li><span class="hljs-built_in">OH_LowPowerVideoSink_StartRenderer</span>(lppVideoStreamer_);</li></ol></pre></div></div></li>      <li>       <p>播放控制（可选）。</p>       <p>暂停：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_pause" target="_blank">OH_LowPowerAudioSink_Pause</a>或 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_pause" target="_blank">OH_LowPowerVideoSink_Pause</a></p>       <p>恢复播放：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_resume" target="_blank">OH_LowPowerAudioSink_Resume</a>或 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_resume" target="_blank">OH_LowPowerVideoSink_Resume</a></p>       <p>停止：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_stop" target="_blank">OH_LowPowerAudioSink_Stop</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_stop" target="_blank">OH_LowPowerVideoSink_Stop</a></p>       <p>设置声音：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_setvolume" target="_blank">OH_LowPowerAudioSink_SetVolume</a></p>       <p>设置播放速度：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_setplaybackspeed" target="_blank">OH_LowPowerAudioSink_SetPlaybackSpeed</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_setplaybackspeed" target="_blank">OH_LowPowerVideoSink_SetPlaybackSpeed</a></p>       <p>清空缓存数据，可用于seek操作：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_flush" target="_blank">OH_LowPowerAudioSink_Flush</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_flush" target="_blank">OH_LowPowerVideoSink_Flush</a></p></li>      <li>       <p>更换资源（可选）。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_reset" target="_blank">OH_LowPowerAudioSink_Reset</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_reset" target="_blank">OH_LowPowerVideoSink_Reset</a>重置资源，允许更换资源，重新配置播放器。</p></li>      <li>       <p>退出播放。</p>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-audio-sink-h#oh_lowpoweraudiosink_destroy" target="_blank">OH_LowPowerAudioSink_Destroy</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-lowpower-video-sink-h#oh_lowpowervideosink_destroy" target="_blank">OH_LowPowerVideoSink_Destroy</a>销毁实例，AVPlayer进入'RELEASED'状态，退出播放。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="运行完整示例">运行完整示例<i class="anchor-icon anchor-icon-link" anchorid="运行完整示例" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>新建工程。下载<a href="https://gitcode.com/HarmonyOS_Samples/guide-snippets/tree/master/MediaKit/LowPowerAVSInk/lowPowerAVSinkSample" target="_blank">示例工程</a>，并将示例工程的以下资源复制到对应目录。</p>       <div _ngcontent-avg-c106="" class="highlight-div"><div _ngcontent-avg-c106="" class="highlight-div-header"><div _ngcontent-avg-c106="" class="highlight-div-header-left"><div _ngcontent-avg-c106="" class="handle-button expand-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-avg-c106="" class="highlight-div-header-right"><div _ngcontent-avg-c106="" class="handle-button ai-button"></div><div _ngcontent-avg-c106="" class="handle-button line-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-avg-c106="" class="handle-button theme-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-avg-c106="" class="handle-button copy-button"><div _ngcontent-avg-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-avg-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-makefile" data-highlighted="yes"><ol class="linenums"><li>lpp_demo-sample/entry/src/main/</li><li>├── cpp                                <span class="hljs-comment"># Native层</span></li><li>│   ├── capbilities                    <span class="hljs-comment"># 能力接口和实现</span></li><li>│   │   ├── <span class="hljs-keyword">include</span>                    <span class="hljs-comment"># 能力接口</span></li><li>│   │   ├── demuxer.cpp                <span class="hljs-comment"># 解封装实现</span></li><li>│   │   ├── lpp_audio_streamer.cpp     <span class="hljs-comment"># 低功耗音频流实现</span></li><li>│   │   └── lpp_video_streamer.cpp     <span class="hljs-comment"># 低功耗视频流实现</span></li><li>│   ├── common                         <span class="hljs-comment"># 公共模块</span></li><li>│   │   ├── dfx                        <span class="hljs-comment"># 日志</span></li><li>│   │   ├── lpp_callback.cpp           <span class="hljs-comment"># 低功耗音视频回调实现</span></li><li>│   │   ├── lpp_callback.h             <span class="hljs-comment"># 低功耗音视频回调接口</span></li><li>│   │   └── sample_info.h              <span class="hljs-comment"># 功能实现公共类</span></li><li>│   ├── render                         <span class="hljs-comment"># 送显模块接口和实现 * window player设置</span></li><li>│   │   ├── <span class="hljs-keyword">include</span>                    <span class="hljs-comment"># 送显模块接口</span></li><li>│   │   ├── egl_core.cpp               <span class="hljs-comment"># 送显参数设置</span></li><li>│   │   ├── plugin_manager.cpp         <span class="hljs-comment"># 送显模块管理实现</span></li><li>│   │   └── plugin_render.cpp          <span class="hljs-comment"># 送显逻辑实现</span></li><li>│   ├── sample                         <span class="hljs-comment"># Native层</span></li><li>│   │   ├── player                     <span class="hljs-comment"># Native层播放接口和实现</span></li><li>│   │   │   ├── Player.cpp             <span class="hljs-comment"># Native层播放功能调用逻辑的实现</span></li><li>│   │   │   ├── Player.h               <span class="hljs-comment"># Native层播放功能调用逻辑的接口</span></li><li>│   │   │   ├── PlayerNative.cpp       <span class="hljs-comment"># Native层播放的入口</span></li><li>│   │   │   └── PlayerNative.h         <span class="hljs-comment"># Native层暴露上来的接口</span></li><li>│   ├── types                          <span class="hljs-comment">#</span></li><li>│   │   └── libplayer                  <span class="hljs-comment"># 播放模块暴露给UI层的接口</span></li><li>│   └── CMakeLists.txt                 <span class="hljs-comment"># 编译入口</span></li><li>├── ets                                <span class="hljs-comment"># UI层</span></li><li>│   ├── common                         <span class="hljs-comment"># 公共模块</span></li><li>│   │   ├── utils                      <span class="hljs-comment"># 共用的工具类</span></li><li>│   │   │   ├── DateTimeUtils.ets      <span class="hljs-comment"># 获取当前时间</span></li><li>│   │   │   └── Logger.ts              <span class="hljs-comment"># 日志工具</span></li><li>│   |   └───CommonConstants.ets        <span class="hljs-comment"># 参数常量</span></li><li>│   ├── entryability                   <span class="hljs-comment"># 应用的入口</span></li><li>│   │   └── EntryAbility.ts            <span class="hljs-comment"># 申请权限弹窗实现</span></li><li>│   ├── pages                          <span class="hljs-comment"># EntryAbility包含的页面</span></li><li>│   │   └── Index.ets                  <span class="hljs-comment"># 首页/播放页面</span></li><li>├── resources                          <span class="hljs-comment"># 用于存放应用所用到的资源文件</span></li><li>│   ├── base                           <span class="hljs-comment"># 该目录下的资源文件会被赋予唯一的ID</span></li><li>│   │   ├── element                    <span class="hljs-comment"># 用于存放字体和颜色</span></li><li>│   │   ├── media                      <span class="hljs-comment"># 用于存放图片</span></li><li>│   │   └── profile                    <span class="hljs-comment"># 应用入口首页</span></li><li>│   ├── en_US                          <span class="hljs-comment"># 设备语言是美式英文时，优先匹配此目录下资源</span></li><li>│   └── zh_CN                          <span class="hljs-comment"># 设备语言是简体中文时，优先匹配此目录下资源</span></li><li>└── module.json5                       <span class="hljs-comment"># 模块配置信息</span></li></ol></pre></div></div></li>      <li>       <p>编译新建工程并运行。</p></li>     </ol>    </div>   </div>   <div></div></div>