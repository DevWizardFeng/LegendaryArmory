<h1 _ngcontent-ath-c119="" class="doc-title ng-star-inserted" title="使用MindSpore Lite实现图像分类（ArkTS）"> 使用MindSpore Lite实现图像分类（ArkTS） </h1>

<div _ngcontent-ath-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景说明">场景说明<i class="anchor-icon anchor-icon-link" anchorid="场景说明" tips="复制节点链接"></i></h2>          <p>开发者可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-mindsporelite" target="_blank">@ohos.ai.mindSporeLite</a>，在UI代码中集成MindSpore Lite能力，快速部署AI算法，进行AI模型推理，实现图像分类的应用。</p>     <p>图像分类可实现对图像中物体的识别，在医学影像分析、自动驾驶、电子商务、人脸识别等领域有广泛的应用。</p>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <p>在进行开发前，请先了解以下概念。</p>     <p><strong>张量</strong>：它与数组和矩阵非常相似，是MindSpore Lite网络运算中的基本数据结构。</p>     <p><strong>Float16推理模式</strong>： Float16又称半精度，它使用16比特表示一个数。Float16推理模式表示推理的时候用半精度进行推理。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>这里给出MindSpore Lite推理的通用开发流程中涉及的一些接口，具体请见下列表格。更多接口及详细内容，请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-mindsporelite" target="_blank">@ohos.ai.mindSporeLite (推理能力)</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">loadModelFromFile(model: string, context?: Context): Promise&lt;Model&gt;</td>         <td class="cellrowborder" valign="top" width="50%">从路径加载模型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getInputs(): MSTensor[]</td>         <td class="cellrowborder" valign="top" width="50%">获取模型的输入。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">predict(inputs: MSTensor[]): Promise&lt;MSTensor[]&gt;</td>         <td class="cellrowborder" valign="top" width="50%">推理模型。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getData(): ArrayBuffer</td>         <td class="cellrowborder" valign="top" width="50%">获取张量的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setData(inputArray: ArrayBuffer): void</td>         <td class="cellrowborder" valign="top" width="50%">设置张量的数据。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发流程">开发流程<i class="anchor-icon anchor-icon-link" anchorid="开发流程" tips="复制节点链接"></i></h2>          <ol>      <li>选择图像分类模型。</li>      <li>在端侧使用MindSpore Lite推理模型，实现对选择的图片进行分类。</li>     </ol>    </div>    <div class="tiledSection">     <h2 id="环境准备">环境准备<i class="anchor-icon anchor-icon-link" anchorid="环境准备" tips="复制节点链接"></i></h2>          <p>安装DevEco Studio，要求版本 &gt;= 4.1，并更新SDK到API 11或以上。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>本文以对相册的一张图片进行推理为例，提供使用MindSpore Lite实现图像分类的开发指导。</p>    </div>    <div class="tiledSection">     <h3 id="选择模型" class="firsth2">选择模型<i class="anchor-icon anchor-icon-link" anchorid="选择模型" tips="复制节点链接"></i></h3>          <p>本示例程序中使用的图像分类模型文件为<a href="https://download.mindspore.cn/model_zoo/official/lite/mobilenetv2_openimage_lite/1.5/mobilenetv2.ms" target="_blank">mobilenetv2.ms</a>，放置在entry/src/main/resources/rawfile工程目录下。</p>     <p>如果开发者有其他图像分类的预训练模型，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/mindspore-lite-converter-guidelines">MindSpore Lite 模型转换</a>介绍，将原始模型转换成.ms格式。</p>    </div>    <div class="tiledSection">     <h3 id="编写推理代码">编写推理代码<i class="anchor-icon anchor-icon-link" anchorid="编写推理代码" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>工程默认设备定义的能力集可能不包含MindSporeLite。需在DevEco Studio工程的entry/src/main目录下，手动创建syscap.json文件，内容如下：</p>       <div _ngcontent-ath-c106="" class="highlight-div"><div _ngcontent-ath-c106="" class="highlight-div-header"><div _ngcontent-ath-c106="" class="highlight-div-header-left"><div _ngcontent-ath-c106="" class="handle-button expand-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ath-c106="" class="highlight-div-header-right"><div _ngcontent-ath-c106="" class="handle-button ai-button"></div><div _ngcontent-ath-c106="" class="handle-button line-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ath-c106="" class="handle-button theme-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ath-c106="" class="handle-button copy-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ath-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"devices"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"general"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-comment">// 需跟module.json5中deviceTypes保持一致。</span></li><li>      <span class="hljs-string">"default"</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-attr">"development"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"addedSysCaps"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-string">"SystemCapability.AI.MindSporeLite"</span></li><li>    <span class="hljs-punctuation">]</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-mindsporelite" target="_blank">@ohos.ai.mindSporeLite</a>实现端侧推理。具体开发过程及细节如下：</p>       <ol>        <li>创建上下文，设置线程数、设备类型等参数。本样例模型，不支持使用NNRt推理。</li>        <li>加载模型。本文从内存加载模型。</li>        <li>加载数据。模型执行之前需要先获取输入，再向输入的张量中填充数据。</li>        <li>执行推理。使用predict接口进行模型推理。</li>       </ol>       <div _ngcontent-ath-c106="" class="highlight-div"><div _ngcontent-ath-c106="" class="highlight-div-header"><div _ngcontent-ath-c106="" class="highlight-div-header-left"><div _ngcontent-ath-c106="" class="handle-button expand-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ath-c106="" class="highlight-div-header-right"><div _ngcontent-ath-c106="" class="handle-button ai-button"></div><div _ngcontent-ath-c106="" class="handle-button line-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ath-c106="" class="handle-button theme-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ath-c106="" class="handle-button copy-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ath-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// model.ets</span></li><li><span class="hljs-keyword">import</span> { mindSporeLite } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MindSporeLiteKit'</span></li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">modelPredict</span>(<span class="hljs-params"></span></li><li><span class="hljs-params">  modelBuffer: <span class="hljs-built_in">ArrayBuffer</span>, inputsBuffer: <span class="hljs-built_in">ArrayBuffer</span>[]</span>): <span class="hljs-title class_">Promise</span>&lt;mindSporeLite.<span class="hljs-property">MSTensor</span>[]&gt; {</li><li>
</li><li>  <span class="hljs-comment">// 1.创建上下文，设置线程数、设备类型等参数。本样例模型，不支持配置context.target = ["nnrt"]。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: mindSporeLite.<span class="hljs-property">Context</span> = {};</li><li>  context.<span class="hljs-property">target</span> = [<span class="hljs-string">'cpu'</span>];</li><li>  context.<span class="hljs-property">cpu</span> = {}</li><li>  context.<span class="hljs-property">cpu</span>.<span class="hljs-property">threadNum</span> = <span class="hljs-number">2</span>;</li><li>  context.<span class="hljs-property">cpu</span>.<span class="hljs-property">threadAffinityMode</span> = <span class="hljs-number">1</span>;</li><li>  context.<span class="hljs-property">cpu</span>.<span class="hljs-property">precisionMode</span> = <span class="hljs-string">'enforce_fp32'</span>;</li><li>
</li><li>  <span class="hljs-comment">// 2.从内存加载模型。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">msLiteModel</span>: mindSporeLite.<span class="hljs-property">Model</span> = <span class="hljs-keyword">await</span> mindSporeLite.<span class="hljs-title function_">loadModelFromBuffer</span>(modelBuffer, context);</li><li>
</li><li>  <span class="hljs-comment">// 3.设置输入数据。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">modelInputs</span>: mindSporeLite.<span class="hljs-property">MSTensor</span>[] = msLiteModel.<span class="hljs-title function_">getInputs</span>();</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; inputsBuffer.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-keyword">let</span> inputBuffer = inputsBuffer[i];</li><li>    <span class="hljs-keyword">if</span> (inputBuffer != <span class="hljs-literal">null</span>) {</li><li>      modelInputs[i].<span class="hljs-title function_">setData</span>(inputBuffer <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 4.执行推理。</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`=========MS_LITE_LOG: MS_LITE predict start=====`</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">modelOutputs</span>: mindSporeLite.<span class="hljs-property">MSTensor</span>[] = <span class="hljs-keyword">await</span> msLiteModel.<span class="hljs-title function_">predict</span>(modelInputs);</li><li>  <span class="hljs-keyword">return</span> modelOutputs;</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="实现图形输入和预处理并执行推理">实现图形输入和预处理，并执行推理<i class="anchor-icon anchor-icon-link" anchorid="实现图形输入和预处理并执行推理" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>此处以获取相册图片为例，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-picker" target="_blank">@ohos.file.picker</a> 实现相册图片文件的选择。</p></li>      <li>       <p>根据模型的输入尺寸，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image" target="_blank">@ohos.multimedia.image</a> （实现图片处理）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs" target="_blank">@ohos.file.fs</a> （实现基础文件操作） API对选择图片进行裁剪、获取图片buffer数据，并进行标准化处理。</p></li>      <li>       <p>加载模型文件，调用推理函数，对相册选择的图片进行推理，并对推理结果进行处理。</p>       <div _ngcontent-ath-c106="" class="highlight-div"><div _ngcontent-ath-c106="" class="highlight-div-header"><div _ngcontent-ath-c106="" class="highlight-div-header-left"><div _ngcontent-ath-c106="" class="handle-button expand-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ath-c106="" class="highlight-div-header-right"><div _ngcontent-ath-c106="" class="handle-button ai-button"></div><div _ngcontent-ath-c106="" class="handle-button line-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ath-c106="" class="handle-button theme-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ath-c106="" class="handle-button copy-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ath-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> modelPredict <span class="hljs-keyword">from</span> <span class="hljs-string">'./model'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { abilityAccessCtrl, <span class="hljs-title class_">Permissions</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">PERMISSIONS</span>: <span class="hljs-title class_">Permissions</span>[] = [<span class="hljs-string">'ohos.permission.READ_IMAGEVIDEO'</span>];</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modelPredict</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'MindSporeLite ArkTS Demo'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modelName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'mobilenetv2.ms'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modelInputHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">224</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">modelInputWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">224</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">uris</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">max</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">maxIndex</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">maxArray</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">maxIndexArray</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modelPredict</span>)</li><li>        <span class="hljs-title class_">Button</span>() {</li><li>          <span class="hljs-title class_">Text</span>(<span class="hljs-string">'photo'</span>)</li><li>            .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">30</span>)</li><li>            .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>        }</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> resMgr = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>()?.<span class="hljs-title function_">getApplicationContext</span>().<span class="hljs-property">resourceManager</span>;</li><li>          <span class="hljs-keyword">if</span> (resMgr === <span class="hljs-literal">null</span> || resMgr === <span class="hljs-literal">undefined</span>){</li><li>            hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`MS_LITE_ERR: get resMgr failed.`</span>);</li><li>            <span class="hljs-keyword">return</span></li><li>          }</li><li>          resMgr?.<span class="hljs-title function_">getRawFileContent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modelName</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">modelBuffer</span> =&gt;</span> {</li><li>
</li><li>            <span class="hljs-comment">// 获取相册图片</span></li><li>            <span class="hljs-comment">// 1.创建图片文件选择实例</span></li><li>            <span class="hljs-keyword">let</span> photoSelectOptions = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoSelectOptions</span>();</li><li>
</li><li>            <span class="hljs-comment">// 2.设置选择媒体文件类型为IMAGE，设置选择媒体文件的最大数目</span></li><li>            photoSelectOptions.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_TYPE</span>; <span class="hljs-comment">// 过滤选择媒体文件类型为IMAGE</span></li><li>            photoSelectOptions.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">1</span>; <span class="hljs-comment">// 选择媒体文件的最大数目</span></li><li>
</li><li>            <span class="hljs-comment">// 3.创建图库选择器实例，调用select()接口拉起图库界面进行文件选择。文件选择成功后，返回photoSelectResult结果集。</span></li><li>            <span class="hljs-keyword">let</span> photoPicker = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">PhotoViewPicker</span>();</li><li>            photoPicker.<span class="hljs-title function_">select</span>(photoSelectOptions, <span class="hljs-keyword">async</span> (</li><li>              <span class="hljs-attr">err</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">photoSelectResult</span>: photoAccessHelper.<span class="hljs-property">PhotoSelectResult</span>) =&gt; {</li><li>              <span class="hljs-keyword">if</span> (err) {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                  <span class="hljs-string">`MS_LITE_ERR: PhotoViewPicker.select failed with err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(err)}</span>`</span>);</li><li>                <span class="hljs-keyword">return</span>;</li><li>              }</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                <span class="hljs-string">`MS_LITE_LOG: PhotoViewPicker.select successfully, uri: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(photoSelectResult)}</span>`</span>);</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">uris</span> = photoSelectResult.<span class="hljs-property">photoUris</span>;</li><li>              hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`MS_LITE_LOG: uri: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.uris}</span>`</span>);</li><li>
</li><li>              <span class="hljs-comment">// 预处理图片数据</span></li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-comment">// 1.使用fileIo.openSync接口，通过uri打开这个文件得到fd</span></li><li>                <span class="hljs-keyword">let</span> file = fileIo.<span class="hljs-title function_">openSync</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uris</span>[<span class="hljs-number">0</span>], fileIo.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_ONLY</span>);</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`MS_LITE_LOG: file fd: <span class="hljs-subst">${file.fd}</span>`</span>);</li><li>
</li><li>                <span class="hljs-comment">// 2.通过fd使用fileIo.readSync接口读取这个文件内的数据</span></li><li>                <span class="hljs-keyword">let</span> inputBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">4096000</span>);</li><li>                <span class="hljs-keyword">let</span> readLen = fileIo.<span class="hljs-title function_">readSync</span>(file.<span class="hljs-property">fd</span>, inputBuffer);</li><li>                hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                  <span class="hljs-string">`MS_LITE_LOG: readSync data to file succeed and inputBuffer size is: <span class="hljs-subst">${readLen}</span>`</span>);</li><li>
</li><li>                <span class="hljs-comment">// 3.通过PixelMap预处理</span></li><li>                <span class="hljs-keyword">let</span> imageSource = image.<span class="hljs-title function_">createImageSource</span>(file.<span class="hljs-property">fd</span>);</li><li>                <span class="hljs-keyword">if</span> (imageSource === <span class="hljs-literal">undefined</span>) {</li><li>                  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`MS_LITE_ERR: createImageSource failed.`</span>);</li><li>                  <span class="hljs-keyword">return</span></li><li>                }</li><li>                imageSource.<span class="hljs-title function_">createPixelMap</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">pixelMap</span>) =&gt;</span> {</li><li>                  pixelMap.<span class="hljs-title function_">getImageInfo</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">info</span>) =&gt;</span> {</li><li>                    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                      <span class="hljs-string">`MS_LITE_LOG: info.width = <span class="hljs-subst">${info.size.width}</span>`</span>);</li><li>                    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                      <span class="hljs-string">`MS_LITE_LOG: info.height = <span class="hljs-subst">${info.size.height}</span>`</span>);</li><li>
</li><li>                    <span class="hljs-comment">// 4.根据模型输入的尺寸，将图片裁剪为对应的size，获取图片buffer数据readBuffer</span></li><li>                    pixelMap.<span class="hljs-title function_">scale</span>(<span class="hljs-number">256.0</span> / info.<span class="hljs-property">size</span>.<span class="hljs-property">width</span>, <span class="hljs-number">256.0</span> / info.<span class="hljs-property">size</span>.<span class="hljs-property">height</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                      pixelMap.<span class="hljs-title function_">crop</span>(</li><li>                        { <span class="hljs-attr">x</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">16</span>, <span class="hljs-attr">size</span>: { <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputHeight</span>, <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputWidth</span> } }</li><li>                      ).<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>                        <span class="hljs-keyword">let</span> info = <span class="hljs-keyword">await</span> pixelMap.<span class="hljs-title function_">getImageInfo</span>();</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: crop info.width = <span class="hljs-subst">${info.size.width}</span>`</span>);</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: crop info.height = <span class="hljs-subst">${info.size.height}</span>`</span>);</li><li>
</li><li>                        <span class="hljs-comment">// 需要创建的像素buffer大小</span></li><li>                        <span class="hljs-keyword">let</span> readBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputHeight</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputWidth</span> * <span class="hljs-number">4</span>);</li><li>                        <span class="hljs-keyword">await</span> pixelMap.<span class="hljs-title function_">readPixelsToBuffer</span>(readBuffer);</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: Succeeded in reading image pixel data, buffer: <span class="hljs-subst">${readBuffer.byteLength}</span>`</span>);</li><li>                        <span class="hljs-comment">// 处理readBuffer，转换成float32格式，并进行标准化处理</span></li><li>                        <span class="hljs-keyword">const</span> imageArr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(</li><li>                          readBuffer.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputHeight</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputWidth</span> * <span class="hljs-number">4</span>));</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: imageArr length: <span class="hljs-subst">${imageArr.length}</span>`</span>);</li><li>
</li><li>                        <span class="hljs-keyword">let</span> means = [<span class="hljs-number">0.485</span>, <span class="hljs-number">0.456</span>, <span class="hljs-number">0.406</span>];</li><li>                        <span class="hljs-keyword">let</span> stds = [<span class="hljs-number">0.229</span>, <span class="hljs-number">0.224</span>, <span class="hljs-number">0.225</span>];</li><li>                        <span class="hljs-keyword">let</span> float32View = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputHeight</span> * <span class="hljs-variable language_">this</span>.<span class="hljs-property">modelInputWidth</span> * <span class="hljs-number">3</span>);</li><li>                        <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;</li><li>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; imageArr.<span class="hljs-property">length</span>; i++) {</li><li>                          <span class="hljs-keyword">if</span> ((i + <span class="hljs-number">1</span>) % <span class="hljs-number">4</span> === <span class="hljs-number">0</span>) {</li><li>                            float32View[index] = (imageArr[i - <span class="hljs-number">3</span>] / <span class="hljs-number">255.0</span> - means[<span class="hljs-number">0</span>]) / stds[<span class="hljs-number">0</span>]; <span class="hljs-comment">// B</span></li><li>                            float32View[index+<span class="hljs-number">1</span>] = (imageArr[i - <span class="hljs-number">2</span>] / <span class="hljs-number">255.0</span> - means[<span class="hljs-number">1</span>]) / stds[<span class="hljs-number">1</span>]; <span class="hljs-comment">// G</span></li><li>                            float32View[index+<span class="hljs-number">2</span>] = (imageArr[i - <span class="hljs-number">1</span>] / <span class="hljs-number">255.0</span> - means[<span class="hljs-number">2</span>]) / stds[<span class="hljs-number">2</span>]; <span class="hljs-comment">// R</span></li><li>                            index += <span class="hljs-number">3</span>;</li><li>                          }</li><li>                        }</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: float32View length: <span class="hljs-subst">${float32View.length}</span>`</span>);</li><li>                        <span class="hljs-keyword">let</span> printStr = <span class="hljs-string">'float32View data:'</span>;</li><li>                        <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">20</span>; i++) {</li><li>                          printStr += <span class="hljs-string">' '</span> + float32View[i];</li><li>                        }</li><li>                        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_LOG: float32View data: <span class="hljs-subst">${printStr}</span>`</span>);</li><li>
</li><li>                        <span class="hljs-keyword">let</span> <span class="hljs-attr">inputs</span>: <span class="hljs-title class_">ArrayBuffer</span>[] = [float32View.<span class="hljs-property">buffer</span>];</li><li>
</li><li>                        <span class="hljs-comment">// predict</span></li><li>                        <span class="hljs-title function_">modelPredict</span>(modelBuffer.<span class="hljs-property">buffer</span>.<span class="hljs-title function_">slice</span>(<span class="hljs-number">0</span>), inputs).<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">outputs</span> =&gt;</span> {</li><li>                          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                            <span class="hljs-string">`=========MS_LITE_LOG: MS_LITE predict success=====`</span>);</li><li>
</li><li>                          <span class="hljs-comment">// 结果打印</span></li><li>                          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; outputs.<span class="hljs-property">length</span>; i++) {</li><li>                            <span class="hljs-keyword">let</span> out = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Float32Array</span>(outputs[i].<span class="hljs-title function_">getData</span>());</li><li>
</li><li>                            <span class="hljs-keyword">let</span> printStr = outputs[i].<span class="hljs-property">name</span> + <span class="hljs-string">':'</span>;</li><li>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; out.<span class="hljs-property">length</span>; j++) {</li><li>                              printStr += out[j].<span class="hljs-title function_">toString</span>() + <span class="hljs-string">','</span>;</li><li>                            }</li><li>                            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>, <span class="hljs-string">`MS_LITE_LOG: <span class="hljs-subst">${printStr}</span>`</span>);</li><li>
</li><li>                            <span class="hljs-comment">// 取分类占比的最大值top5</span></li><li>                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> = <span class="hljs-number">0</span>;</li><li>                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndex</span> = <span class="hljs-number">0</span>;</li><li>                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxArray</span> = [];</li><li>                            <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndexArray</span> = [];</li><li>                            <span class="hljs-keyword">let</span> newArray = out.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>)</li><li>                            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> n = <span class="hljs-number">0</span>; n &lt; <span class="hljs-number">5</span>; n++) {</li><li>                              <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> = out[<span class="hljs-number">0</span>];</li><li>                              <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndex</span> = <span class="hljs-number">0</span>;</li><li>                              <span class="hljs-comment">// 取最大值</span></li><li>                              <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> m = <span class="hljs-number">0</span>; m &lt; newArray.<span class="hljs-property">length</span>; m++) {</li><li>                                <span class="hljs-keyword">if</span> (newArray[m] &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>) {</li><li>                                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> = newArray[m];</li><li>                                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndex</span> = m;</li><li>                                }</li><li>                              }</li><li>                              <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">round</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span> * <span class="hljs-number">10000</span>));</li><li>                              <span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndexArray</span>.<span class="hljs-title function_">push</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">maxIndex</span>);</li><li>                              <span class="hljs-comment">// filter数组过滤函数</span></li><li>                              newArray = newArray.<span class="hljs-title function_">filter</span>(<span class="hljs-function"><span class="hljs-params">value</span> =&gt;</span> value !== <span class="hljs-variable language_">this</span>.<span class="hljs-property">max</span>)</li><li>                            }</li><li>                            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                              <span class="hljs-string">`MS_LITE_LOG: max: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.maxArray}</span>`</span>);</li><li>                            hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                              <span class="hljs-string">`MS_LITE_LOG: maxIndex: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.maxIndexArray}</span>`</span>);</li><li>                          }</li><li>                          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                            <span class="hljs-string">`=========MS_LITE_LOG END=========`</span>);</li><li>                        })</li><li>                      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>                        hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                          <span class="hljs-string">`MS_LITE_ERR: getRawFileContent promise error is: <span class="hljs-subst">${error}</span>`</span>);</li><li>                      })</li><li>                    })</li><li>                  })</li><li>                })</li><li>
</li><li>                <span class="hljs-comment">// 5.关闭文件</span></li><li>                fileIo.<span class="hljs-title function_">closeSync</span>(file);</li><li>              } <span class="hljs-keyword">catch</span> (err) {</li><li>                hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'MindSporeLiteArkTSDemo'</span>, <span class="hljs-string">'%{public}s'</span>,</li><li>                  <span class="hljs-string">`MS_LITE_ERR: uri: open file fd failed. <span class="hljs-subst">${err}</span>`</span>);</li><li>              }</li><li>            })</li><li>          })</li><li>        })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="调测验证">调测验证<i class="anchor-icon anchor-icon-link" anchorid="调测验证" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>在DevEco Studio中连接设备，点击Run entry，编译Hap，有如下显示：</p>       <div _ngcontent-ath-c106="" class="highlight-div"><div _ngcontent-ath-c106="" class="highlight-div-header"><div _ngcontent-ath-c106="" class="highlight-div-header-left"><div _ngcontent-ath-c106="" class="handle-button expand-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ath-c106="" class="highlight-div-header-right"><div _ngcontent-ath-c106="" class="handle-button ai-button"></div><div _ngcontent-ath-c106="" class="handle-button line-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ath-c106="" class="handle-button theme-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ath-c106="" class="handle-button copy-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ath-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li>Launching com.samples.mindsporelitearktsdemo</li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc shell aa force-stop com.samples.mindsporelitearktsdemo</span></li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc shell <span class="hljs-built_in">mkdir</span> data/local/tmp/xxx</span></li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc file send C:\Users\xxx\MindSporeLiteArkTSDemo\entry\build\default\outputs\default\entry-default-signed.hap <span class="hljs-string">"data/local/tmp/xxx"</span></span></li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc shell bm install -p data/local/tmp/xxx</span></li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc shell <span class="hljs-built_in">rm</span> -rf data/local/tmp/xxx</span></li><li><span class="hljs-meta prompt_">$ </span><span class="language-bash">hdc shell aa start -a EntryAbility -b com.samples.mindsporelitearktsdemo</span></li></ol></pre></div></div></li>      <li>       <p>在设备屏幕点击photo按钮，选择图片，点击确定。设备屏幕显示所选图片的分类结果，在日志打印结果中，过滤关键字”MS_LITE“，可得到如下结果：</p>       <div _ngcontent-ath-c106="" class="highlight-div"><div _ngcontent-ath-c106="" class="highlight-div-header"><div _ngcontent-ath-c106="" class="highlight-div-header-left"><div _ngcontent-ath-c106="" class="handle-button expand-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ath-c106="" class="highlight-div-header-right"><div _ngcontent-ath-c106="" class="handle-button ai-button"></div><div _ngcontent-ath-c106="" class="handle-button line-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ath-c106="" class="handle-button theme-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ath-c106="" class="handle-button copy-button"><div _ngcontent-ath-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ath-c106="" class="highlight-scroll-div"><pre class="verilog prettyprint linenums hljs language-cangjie" hw-language="verilog" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">33.743</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">PhotoViewPicker</span>.<span class="hljs-title class_">select</span> <span class="hljs-title class_">successfully</span>, <span class="hljs-variable">photoSelectResult</span> <span class="hljs-variable">uri</span>: {<span class="hljs-string">"photoUris"</span>:[<span class="hljs-string">"file://media/Photo/13/IMG_1501955351_012/plant.jpg"</span>]}</li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">33.795</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">readSync</span> <span class="hljs-title class_">data</span> <span class="hljs-title class_">to</span> <span class="hljs-title class_">file</span> <span class="hljs-title class_">succeed</span> <span class="hljs-title class_">and</span> <span class="hljs-title class_">inputBuffer</span> <span class="hljs-title class_">size</span> <span class="hljs-keyword">is</span>:<span class="hljs-number">32824</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">34.147</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">crop</span> <span class="hljs-title class_">info</span>.<span class="hljs-title class_">width</span> = <span class="hljs-number">224</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">34.147</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">crop</span> <span class="hljs-title class_">info</span>.<span class="hljs-title class_">height</span> = <span class="hljs-number">224</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">34.160</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">Succeeded</span> <span class="hljs-keyword">in</span> <span class="hljs-title class_">reading</span> <span class="hljs-title class_">image</span> <span class="hljs-title class_">pixel</span> <span class="hljs-title class_">data</span>, <span class="hljs-variable">buffer</span>: <span class="hljs-number">200704</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">34.970</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     =========<span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">MS_LITE</span> <span class="hljs-title class_">predict</span> <span class="hljs-title class_">start</span>=====</li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.432</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     =========<span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">MS_LITE</span> <span class="hljs-title class_">predict</span> <span class="hljs-title class_">success</span>=====</li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.447</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">Default</span>/<span class="hljs-variable">head</span>-<span class="hljs-variable">MobileNetV2Head</span>/<span class="hljs-variable">Sigmoid</span>-<span class="hljs-variable">op466</span>:<span class="hljs-number">0.0000034338463592575863</span>,<span class="hljs-number">0.000014028532859811094</span>,<span class="hljs-number">9.119685273617506e-7</span>,<span class="hljs-number">0.000049100715841632336</span>,<span class="hljs-number">9.502661555416125e-7</span>,<span class="hljs-number">3.945370394831116e-7</span>,<span class="hljs-number">0.04346757382154465</span>,<span class="hljs-number">0.00003971960904891603</span>...</li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.499</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">max</span>:<span class="hljs-number">9497</span>,<span class="hljs-number">7756</span>,<span class="hljs-number">1970</span>,<span class="hljs-number">435</span>,<span class="hljs-number">46</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.499</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     <span class="hljs-variable">MS_LITE_LOG</span>: <span class="hljs-title class_">maxIndex</span>:<span class="hljs-number">323</span>,<span class="hljs-number">46</span>,<span class="hljs-number">13</span>,<span class="hljs-number">6</span>,<span class="hljs-number">349</span></li><li><span class="hljs-number">08</span>-<span class="hljs-number">06</span> <span class="hljs-number">03</span>:<span class="hljs-number">24</span>:<span class="hljs-number">35.499</span>   <span class="hljs-number">22547</span>-<span class="hljs-number">22547</span>  <span class="hljs-title class_">A03d00</span>/<span class="hljs-variable">JSAPP</span>                   <span class="hljs-variable">com</span>.<span class="hljs-variable">sampl</span>...<span class="hljs-variable">liteark</span>+  <span class="hljs-variable">I</span>     =========<span class="hljs-variable">MS_LITE_LOG</span> <span class="hljs-variable">END</span>=========</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="效果示意">效果示意<i class="anchor-icon anchor-icon-link" anchorid="效果示意" tips="复制节点链接"></i></h3>          <p>在设备上，点击photo按钮，选择相册中的一张图片，点击确定。在图片下方显示此图片占比前4的分类信息。</p>     <p><span><img originheight="624" originwidth="370" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114226.69942538724388070553199289215109:50001231000000:2800:746E12DF63D6E4F454B8EB288FA20B0F6CF0C90144F423DC6C9B47D20EAE083F.png" width="370" height="624"></span> <span><img originheight="669" originwidth="391" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114226.91794216755783248857713127522897:50001231000000:2800:723034584DFF67ECFCE2C43340470383C89CE3130769F9C1BD68324F3BE5BD1B.png" width="391" height="669"></span></p>     <p><span><img originheight="619" originwidth="395" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114226.38374845146347313074518520822574:50001231000000:2800:88872A331EAFF17CAAB2F5317649DE3092573DB751C2AE32DBE446AC63892C9E.png" width="395" height="619"></span> <span><img originheight="663" originwidth="353" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114226.34987302655853225010564957314780:50001231000000:2800:98E997E09497486390213AF818B2988FAAD7BE3EF63EB0746EA96404C98416A2.png" width="353" height="663"></span></p>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/HarmonyOS_Samples/MindSporeLiteArkTS" target="_blank">基于MindSporeLite接口实现图像分类</a></li>     </ul>    </div>   </div>   <div></div></div>