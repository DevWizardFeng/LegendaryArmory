<h1 _ngcontent-ikb-c119="" class="doc-title ng-star-inserted" title="使用Node-API其他实用接口"> 使用Node-API其他实用接口 </h1>

<div _ngcontent-ikb-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>Node-API接口提供了一些实用接口，可以帮助开发者更好地进行Node-API相关开发。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><ul><li><strong>模块加载：</strong> 在Node-API模块中，模块是指包含特定功能的ArkTS文件，通过import导入lib共享库中的模块。了解Node-API模块中的加载机制以及模块之间的依赖关系对于理解node_api_get_module_file_name接口的使用很有帮助。</li><li><strong>文件路径和URL：</strong> node_api_get_module_file_name返回的是加载项的绝对路径的URL。</li><li><strong>比较ArkTS值严格相等：</strong> 比较两个ArkTS值是否严格相等。严格相等比较不会进行类型转换，它要求两个值的类型和值完全相同才会返回true。</li><li><strong>处理异步操作：</strong> 通过Libuv可以实现异步操作，避免阻塞主线程，使得程序可以同时执行多个任务而不会出现阻塞现象。</li><li><strong>实现事件循环：</strong> Libuv提供了事件循环机制，可以处理事件、触发回调函数，并管理事件队列，使得Node-API模块能够实现事件驱动的编程模型。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">node_api_get_module_file_name</td> <td class="cellrowborder" valign="top" width="50%">获取加载项加载位置的绝对路径。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_strict_equals</td> <td class="cellrowborder" valign="top" width="50%">在某些情况下，希望确保两个值不仅具有相同的值，还具有相同的类型。例如，如果正在处理一些需要特定类型的数据结构或算法，使用napi_strict_equals可以确保数据的一致性。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="node_api_get_module_file_name" class="firsth2">node_api_get_module_file_name<i class="anchor-icon anchor-icon-link" anchorid="node_api_get_module_file_name" tips="复制节点链接"></i></h3><p>用于获取加载项的绝对路径。</p> <p>cpp部分代码</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetModuleFileName</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 声明一个const char类型的指针变量file，用于存储模块绝对路径</span></li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *file = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value value = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 获取当前模块的绝对路径，并将结果存储在file变量中</span></li><li>    napi_status status = <span class="hljs-built_in">node_api_get_module_file_name</span>(env, &amp;file);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to get module file name"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 创建一个包含绝对路径的napi_value类型的字符串</span></li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, file, NAPI_AUTO_LENGTH, &amp;value);</li><li>    <span class="hljs-keyword">return</span> value;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getModuleFileName</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> filename = testNapi.<span class="hljs-title function_">getModuleFileName</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API node_api_get_module_file_name:%{public}s'</span>, filename);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_strict_equals">napi_strict_equals<i class="anchor-icon anchor-icon-link" anchorid="napi_strict_equals" tips="复制节点链接"></i></h3><p>判断给定的两个ArkTS value是否严格相等。</p> <p>cpp部分代码</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">StrictEquals</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接受两个入参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用napi_strict_equals接口判断给定的两个ArkTS value是否严格相等</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">true</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_strict_equals</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_strict_equals fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回</span></li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">strictEquals</span>: <span class="hljs-function">(<span class="hljs-params">lhs: <span class="hljs-built_in">string</span>, rhs: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> lhs = <span class="hljs-string">"123"</span>;</li><li>  <span class="hljs-keyword">let</span> rhs = <span class="hljs-string">"123"</span>;</li><li>  <span class="hljs-keyword">let</span> str = <span class="hljs-string">"456"</span>;</li><li>  <span class="hljs-keyword">let</span> num = <span class="hljs-number">123</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_strict_equals: %{public}s'</span>, testNapi.<span class="hljs-title function_">strictEquals</span>(lhs, rhs));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_strict_equals: %{public}s'</span>, testNapi.<span class="hljs-title function_">strictEquals</span>(lhs, str));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_strict_equals: %{public}s'</span>, testNapi.<span class="hljs-title function_">strictEquals</span>(lhs, num));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_strict_equals error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-ikb-c106="" class="highlight-div"><div _ngcontent-ikb-c106="" class="highlight-div-header"><div _ngcontent-ikb-c106="" class="highlight-div-header-left"><div _ngcontent-ikb-c106="" class="handle-button expand-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ikb-c106="" class="highlight-div-header-right"><div _ngcontent-ikb-c106="" class="handle-button ai-button"></div><div _ngcontent-ikb-c106="" class="handle-button line-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ikb-c106="" class="handle-button theme-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ikb-c106="" class="handle-button copy-button"><div _ngcontent-ikb-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ikb-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>