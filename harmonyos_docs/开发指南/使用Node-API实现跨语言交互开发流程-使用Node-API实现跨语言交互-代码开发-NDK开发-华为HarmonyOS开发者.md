<h1 _ngcontent-idc-c119="" class="doc-title ng-star-inserted" title="使用Node-API实现跨语言交互开发流程"> 使用Node-API实现跨语言交互开发流程 </h1>

<div _ngcontent-idc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>使用Node-API实现跨语言交互，首先需要按照Node-API的机制实现模块的注册和加载等相关动作。</p> <ul><li><p><strong>ArkTS/JS侧</strong>：实现C++方法的调用，通过import所需的so库后，可以调用C++方法。</p>  </li><li><p><strong>Native侧</strong>：.cpp文件，实现模块的注册。需要提供注册lib库的名称，并在注册回调方法中定义接口的映射关系，即Native方法及对应的JS/ArkTS接口名称等。</p>  </li></ul> <p>此处以在ArkTS/JS侧实现callNative()接口、在Native侧实现加法操作的CallNative()接口，从而实现跨语言交互为例，呈现使用Node-API进行跨语言交互的流程。</p>  <div class="tiledSection"><h2 id="创建native-c工程">创建Native C++工程<i class="anchor-icon anchor-icon-link" anchorid="创建native-c工程" tips="复制节点链接"></i></h2><ul><li><p>在DevEco Studio中<strong>New &gt; Create Project</strong>，选择<strong>Native C++<strong>模板，点击</strong>Next</strong>，选择API版本，设置好工程名称，点击<strong>Finish</strong>，创建得到新工程。</p>  </li><li><p>创建工程后工程结构可以分两部分，cpp部分和ets部分，工程结构具体介绍可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-project-structure" target="_blank">C++工程目录结构</a>。</p>  </li></ul> </div>  <div class="tiledSection"><h2 id="native侧方法的实现">Native侧方法的实现<i class="anchor-icon anchor-icon-link" anchorid="native侧方法的实现" tips="复制节点链接"></i></h2><ul><li><p>设置模块注册信息</p>  <p>ArkTS侧import native模块时，会加载其对应的so。加载so时，首先会调用napi_module_register方法，将模块注册到系统中，并调用模块初始化函数。</p>  <p>napi_module有两个关键属性：一个是.nm_register_func，定义模块初始化函数；另一个是.nm_modname，定义模块的名称，也就是ArkTS侧引入的so库的名称，模块系统会根据此名称来区分不同的so。</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/napi_init.cpp</span></li><li>
</li><li><span class="hljs-comment">// 准备模块加载相关信息，将上述Init函数与本模块名等信息记录下来。</span></li><li><span class="hljs-keyword">static</span> napi_module demoModule = {</li><li>    .<span class="hljs-property">nm_version</span> = <span class="hljs-number">1</span>,</li><li>    .<span class="hljs-property">nm_flags</span> = <span class="hljs-number">0</span>,</li><li>    .<span class="hljs-property">nm_filename</span> = nullptr,</li><li>    .<span class="hljs-property">nm_register_func</span> = <span class="hljs-title class_">Init</span>,</li><li>    .<span class="hljs-property">nm_modname</span> = <span class="hljs-string">"entry"</span>,</li><li>    .<span class="hljs-property">nm_priv</span> = ((<span class="hljs-built_in">void</span>*)<span class="hljs-number">0</span>),</li><li>    .<span class="hljs-property">reserved</span> = {<span class="hljs-number">0</span>},</li><li>};</li><li>
</li><li><span class="hljs-comment">// 加载so时，该函数会自动被调用，将上述demoModule模块注册到系统中。</span></li><li>extern <span class="hljs-string">"C"</span> <span class="hljs-title function_">__attribute__</span>((constructor)) <span class="hljs-built_in">void</span> <span class="hljs-title class_">RegisterDemoModule</span>() {</li><li>    <span class="hljs-title function_">napi_module_register</span>(&amp;demoModule);</li><li>}</li></ol></pre></div></div>  </li></ul> <p>注：以上代码无须复制，创建Native C++工程以后在napi_init.cpp代码中已配置好。</p> <ul><li><p>模块初始化</p>  <p>实现ArkTS接口与C++接口的绑定和映射。</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/napi_init.cpp</span></li><li>EXTERN_C_START</li><li><span class="hljs-comment">// 模块初始化</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    <span class="hljs-comment">// ArkTS接口与C++接口的绑定和映射</span></li><li>    napi_property_descriptor desc[] = {</li><li>        <span class="hljs-comment">// 注：仅需复制以下两行代码，Init在完成创建Native C++工程以后在napi_init.cpp中已配置好。</span></li><li>        {<span class="hljs-string">"callNative"</span>, <span class="hljs-literal">nullptr</span>, CallNative, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"nativeCallArkTS"</span>, <span class="hljs-literal">nullptr</span>, NativeCallArkTS, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-comment">// 在exports对象上挂载CallNative/NativeCallArkTS两个Native方法</span></li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div>  </li><li><p>在index.d.ts文件中，提供JS侧的接口方法。</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/types/libentry/index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">callNative</span>: <span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span>, b: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">nativeCallArkTS</span>: <span class="hljs-function">(<span class="hljs-params">cb: (a: <span class="hljs-built_in">number</span>) =&gt; <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>  </li><li><p>在oh-package.json5文件中将index.d.ts与cpp文件关联起来。</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="JSON5 prettyprint linenums hljs language-cangjie" hw-language="JSON5" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/types/libentry/oh-package.json5</span></li><li>{</li><li>  <span class="hljs-string">"name"</span>: <span class="hljs-string">"libentry.so"</span>,</li><li>  <span class="hljs-string">"types"</span>: <span class="hljs-string">"./index.d.ts"</span>,</li><li>  <span class="hljs-string">"version"</span>: <span class="hljs-string">""</span>,</li><li>  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Please describe the basic information."</span></li><li>}</li></ol></pre></div></div>  </li><li><p>在CMakeLists.txt文件中配置CMake打包参数。</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li># entry/src/main/cpp/CMakeLists.txt</li><li>cmake_minimum_required(VERSION 3.4.1)</li><li>project(MyApplication2)</li><li>
</li><li>set(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li>
</li><li>include_directories(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li># 添加名为entry的库</li><li>add_library(entry SHARED napi_init.cpp)</li><li># 构建此可执行文件需要链接的库</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so)</li></ol></pre></div></div>  </li><li><p>实现Native侧的CallNative以及NativeCallArkTS接口。具体代码如下：</p>  <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/cpp/napi_init.cpp</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CallNative</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    <span class="hljs-comment">// 声明参数数组</span></li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    <span class="hljs-comment">// 获取传入的参数并依次放入参数数组中</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 依次获取参数</span></li><li>    <span class="hljs-type">double</span> value0;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">0</span>], &amp;value0);</li><li>    <span class="hljs-type">double</span> value1;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">1</span>], &amp;value1);</li><li>
</li><li>    <span class="hljs-comment">// 返回两数相加的结果</span></li><li>    napi_value sum;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, value0 + value1, &amp;sum);</li><li>    <span class="hljs-keyword">return</span> sum;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NativeCallArkTS</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    <span class="hljs-comment">// 声明参数数组</span></li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    <span class="hljs-comment">// 获取传入的参数并依次放入参数数组中</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 创建一个int，作为ArkTS的入参</span></li><li>    napi_value argv = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, <span class="hljs-number">2</span>, &amp;argv );</li><li>
</li><li>    <span class="hljs-comment">// 调用传入的callback，并将其结果返回</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_call_function</span>(env, <span class="hljs-literal">nullptr</span>, args[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, &amp;argv, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ul> </div>  <div class="tiledSection"><h2 id="arkts侧调用cc方法实现">ArkTS侧调用C/C++方法实现<i class="anchor-icon anchor-icon-link" anchorid="arkts侧调用cc方法实现" tips="复制节点链接"></i></h2><p>ArkTS侧通过import引入Native侧包含处理逻辑的so来使用C/C++的方法。</p> <div _ngcontent-idc-c106="" class="highlight-div"><div _ngcontent-idc-c106="" class="highlight-div-header"><div _ngcontent-idc-c106="" class="highlight-div-header-left"><div _ngcontent-idc-c106="" class="handle-button expand-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-idc-c106="" class="highlight-div-header-right"><div _ngcontent-idc-c106="" class="handle-button ai-button"></div><div _ngcontent-idc-c106="" class="handle-button line-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-idc-c106="" class="handle-button theme-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-idc-c106="" class="handle-button copy-button"><div _ngcontent-idc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-idc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/pages/Index.ets</span></li><li><span class="hljs-comment">// 通过import的方式，引入Native能力。</span></li><li><span class="hljs-keyword">import</span> nativeModule <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Test Node-API callNative result: '</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message2</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Test Node-API nativeCallArkTS result: '</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-comment">// 第一个按钮，调用callNative方法，对应到Native侧的CallNative方法，进行两数相加。</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> += nativeModule.<span class="hljs-title function_">callNative</span>(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>);</li><li>            })</li><li>        <span class="hljs-comment">// 第二个按钮，调用nativeCallArkTS方法，对应到Native的NativeCallArkTS，在Native调用ArkTS function。</span></li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message2</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">message2</span> += nativeModule.<span class="hljs-title function_">nativeCallArkTS</span>(<span class="hljs-function">(<span class="hljs-params">a: <span class="hljs-built_in">number</span></span>)=&gt;</span> {</li><li>                <span class="hljs-keyword">return</span> a * <span class="hljs-number">2</span>;</li><li>            });</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="node-api的约束限制">Node-API的约束限制<i class="anchor-icon anchor-icon-link" anchorid="node-api的约束限制" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="so命名规则" class="firsth2">SO命名规则<i class="anchor-icon anchor-icon-link" anchorid="so命名规则" tips="复制节点链接"></i></h3><p>导入使用的模块名和注册时的模块名大小写保持一致，如模块名为entry，则so的名字为libentry.so，napi_module中nm_modname字段应为entry，ArkTS侧使用时写作：import xxx from 'libentry.so'。</p> </div>  <div class="tiledSection"><h3 id="注册建议">注册建议<i class="anchor-icon anchor-icon-link" anchorid="注册建议" tips="复制节点链接"></i></h3><ul><li><p>nm_register_func对应的函数（如上述Init函数）需要加上static，防止与其他so里的符号冲突。</p>  </li><li><p>模块注册的入口，即使用__attribute__((constructor))修饰的函数的函数名（如上述RegisterDemoModule函数）需要确保不与其它模块重复。</p>  </li></ul> </div>  <div class="tiledSection"><h3 id="多线程限制">多线程限制<i class="anchor-icon anchor-icon-link" anchorid="多线程限制" tips="复制节点链接"></i></h3><p>每个引擎实例对应一个JS线程，实例上的对象不能跨线程操作，否则会引起应用crash。使用时需要遵循如下原则：</p> <ul><li>Node-API接口只能在JS线程使用。</li><li>Native接口入参env与特定JS线程绑定只能在创建时的线程使用。</li><li>使用Node-API接口创建的数据需在env完全销毁前进行释放，避免内存泄漏。此外，在napi_env销毁后访问/使用这些数据，可能会导致进程崩溃。</li></ul> </div>  <div class="tiledSection"><h3 id="代码调试设备选择">代码调试设备选择<i class="anchor-icon anchor-icon-link" anchorid="代码调试设备选择" tips="复制节点链接"></i></h3><p>强烈建议开发者使用真机而非预览器进行代码调试。预览器的主要功能是调试界面组块，若用于功能调试可能会出现如下报错：</p> <ul><li>TypeError: undefined is not callable</li></ul> <p>部分常见错误用法已增加维测手段覆盖，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-crash">使用Node-API接口产生的异常日志/崩溃分析</a>。</p> </div> </div> <div></div></div>