<h1 _ngcontent-cim-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口创建和获取string值"> 使用Node-API接口创建和获取string值 </h1>

<div _ngcontent-cim-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用Node-API的六个关于string的接口，可以实现Node-API模块与ArkTS字符串的交互。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>字符串是编程中常用的数据类型，用于存储和操作文本数据。它可以表示和处理字符序列，构建用户界面元素（如标签、按钮和文本框），处理用户输入，验证和格式化数据。不同编码支持的字符集和语言不同，以下是一些主要编码方案及其区别：</p> <ul><li><strong>ASCII</strong>：ASCII是最早的字符编码方案之一，使用7位编码，只能表示英文字母、数字和一些基本符号。它是许多其他编码方案的基础。</li><li><strong>UTF-8</strong>：UTF-8是一种变长编码方案，可以表示全球范围的字符集。它使用8位编码，根据字符的不同范围使用不同长度的字节序列。UTF-8是互联网上广泛使用的编码方案。</li><li><strong>UTF-16</strong>：UTF-16是一种定长或变长编码方案，使用16位编码。它可以表示全球范围的字符集，并且适用于较大的字符集。</li><li><strong>ISO-8859-1（Latin-1）</strong>：ISO-8859-1是一种单字节编码方案，使用8位编码。它主要用于表示拉丁字母字符集，包括欧洲大部分语言。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下Node-API接口主要用于string值的创建和获取，使用场景如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_utf8</td> <td class="cellrowborder" valign="top" width="50%">需要将ArkTS的字符类型的数据转换为utf8编码的字符时使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_utf8</td> <td class="cellrowborder" valign="top" width="50%">需要通过UTF8编码的C字符串创建ArkTS string值时使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_utf16</td> <td class="cellrowborder" valign="top" width="50%">需要将ArkTS的字符类型的数据转换为utf16编码的字符时使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_utf16</td> <td class="cellrowborder" valign="top" width="50%">需要通过UTF16编码的C字符串创建ArkTS string值时使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_latin1</td> <td class="cellrowborder" valign="top" width="50%">需要将ArkTS的字符类型的数据转换为ISO-8859-1编码的字符时使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_latin1</td> <td class="cellrowborder" valign="top" width="50%">需要通过ISO-8859-1编码的字符串创建ArkTS string值时使用这个函数。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="napi_get_value_string_utf8" class="firsth2">napi_get_value_string_utf8<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_string_utf8" tips="复制节点链接"></i></h3><p>将ArkTS的字符类型的数据转换为UTF-8编码的字符。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueStringUtf8</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取字符串的长度</span></li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>    <span class="hljs-comment">// 传入一个非字符串 napi_get_value_string_utf8接口会返回napi_string_expected</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_value_string_utf8 failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-type">char</span>* buf = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[length + <span class="hljs-number">1</span>];</li><li>    std::<span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, length + <span class="hljs-number">1</span>);</li><li>    status = <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">0</span>], buf, length + <span class="hljs-number">1</span>, &amp;length);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">if</span> (buf) {</li><li>            <span class="hljs-keyword">delete</span>[] buf;</li><li>        }</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_value_string_utf8 failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_create_string_utf8</span>(env, buf, length, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (buf) {</li><li>        <span class="hljs-keyword">delete</span>[] buf;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_create_string_utf8 failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueStringUtf8</span>: <span class="hljs-function">(<span class="hljs-params">param: <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 分别传入字符和非字符检测接口，传入字符串类型的数据将返回原字符串，传入其他类型返回undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_value_string_utf8_string %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueStringUtf8</span>(<span class="hljs-string">'aaBC+-$%^你好123'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_value_string_utf8_not_string %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueStringUtf8</span>(<span class="hljs-number">50</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_string_utf8">napi_create_string_utf8<i class="anchor-icon anchor-icon-link" anchorid="napi_create_string_utf8" tips="复制节点链接"></i></h3><p>用于创建一个UTF-8编码的ArkTS字符串。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateStringUtf8</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str = <span class="hljs-string">u8"你好, World!, successes to create UTF-8 string! 111"</span>;</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-built_in">strlen</span>(str);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_string_utf8</span>(env, str, length, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create UTF-8 string"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createStringUtf8</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_string_utf8:%{public}s'</span>, testNapi.<span class="hljs-title function_">createStringUtf8</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_string_utf16">napi_get_value_string_utf16<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_string_utf16" tips="复制节点链接"></i></h3><p>将ArkTS的字符类型的数据转换为UTF-16编码的字符。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 定义字符串缓冲区的最大长度</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> MAX_BUFFER_SIZE = <span class="hljs-number">128</span>;</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueStringUtf16</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>];</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 字符串的缓冲区</span></li><li>    <span class="hljs-type">char16_t</span> buffer[MAX_BUFFER_SIZE];</li><li>    <span class="hljs-comment">// 字符串的缓冲区大小</span></li><li>    <span class="hljs-type">size_t</span> bufferSize = MAX_BUFFER_SIZE;</li><li>    <span class="hljs-comment">// 字符串的长度</span></li><li>    <span class="hljs-type">size_t</span> stringLen;</li><li>    <span class="hljs-comment">// 获取字符串的数据和长度</span></li><li>    <span class="hljs-built_in">napi_get_value_string_utf16</span>(env, args[<span class="hljs-number">0</span>], buffer, bufferSize, &amp;stringLen);</li><li>    <span class="hljs-comment">// 获取字符串返回结果</span></li><li>    <span class="hljs-built_in">napi_create_string_utf16</span>(env, buffer, stringLen, &amp;result);</li><li>    <span class="hljs-comment">// 返回结果</span></li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueStringUtf16</span>: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> result = testNapi.<span class="hljs-title function_">getValueStringUtf16</span>(<span class="hljs-string">'hello,'</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>,<span class="hljs-string">'testTag'</span>,<span class="hljs-string">'Node-API napi_get_value_string_utf16:%{public}s'</span>, result);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_string_utf16">napi_create_string_utf16<i class="anchor-icon anchor-icon-link" anchorid="napi_create_string_utf16" tips="复制节点链接"></i></h3><p>创建一个UTF-16编码的ArkTS字符串。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateStringUtf16</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char16_t</span>  *str = <span class="hljs-string">u"你好, World!, successes to create UTF-16 string! 111"</span>;</li><li>    <span class="hljs-type">size_t</span> length = NAPI_AUTO_LENGTH;</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_string_utf16</span>(env, str, length, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create UTF-16 string"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createStringUtf16</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_string_utf16:%{public}s '</span>, testNapi.<span class="hljs-title function_">createStringUtf16</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_string_latin1">napi_get_value_string_latin1<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_string_latin1" tips="复制节点链接"></i></h3><p>将ArkTS的字符类型数据转换为ISO-8859-1编码。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-type">const</span> <span class="hljs-type">int</span> MAX_BUFFER_SIZE = <span class="hljs-number">128</span>;</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueStringLatin1</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">char</span> buf[MAX_BUFFER_SIZE];</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>    napi_value napi_Res = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_string_latin1</span>(env, args[<span class="hljs-number">0</span>], buf, MAX_BUFFER_SIZE, &amp;length);</li><li>    <span class="hljs-comment">// 当输入的值不是字符串时，接口会返回napi_string_expected</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-built_in">napi_create_string_latin1</span>(env, buf, length, &amp;napi_Res);</li><li>    <span class="hljs-keyword">return</span> napi_Res;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueStringLatin1</span>: <span class="hljs-function">(<span class="hljs-params">param: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 传入非字符型数据，函数返回undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_value_string_latin1_not_string %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueStringLatin1</span>(<span class="hljs-number">10</span>));</li><li><span class="hljs-comment">// ISO-8859-1编码不支持中文，传入中文字符会乱码</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_value_string_latin1_string_chinese %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueStringLatin1</span>(<span class="hljs-string">'中文'</span>));</li><li><span class="hljs-comment">// 传入其他字符，不会乱码</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_value_string_latin1_string %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueStringLatin1</span>(<span class="hljs-string">'abo ABP=-&amp;*/'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_string_latin1">napi_create_string_latin1<i class="anchor-icon anchor-icon-link" anchorid="napi_create_string_latin1" tips="复制节点链接"></i></h3><p>创建一个Latin1编码的ArkTS字符串。</p> <p>cpp部分代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateStringLatin1</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str = <span class="hljs-string">"Hello, World! éçñ, successes to create Latin1 string! 111"</span>;</li><li>    <span class="hljs-type">size_t</span> length = NAPI_AUTO_LENGTH;</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_string_latin1</span>(env, str, length, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 处理错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create Latin1 string"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createStringLatin1</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API  napi_create_string_latin1:%{public}s'</span>, testNapi.<span class="hljs-title function_">createStringLatin1</span>());</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-cim-c106="" class="highlight-div"><div _ngcontent-cim-c106="" class="highlight-div-header"><div _ngcontent-cim-c106="" class="highlight-div-header-left"><div _ngcontent-cim-c106="" class="handle-button expand-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cim-c106="" class="highlight-div-header-right"><div _ngcontent-cim-c106="" class="handle-button ai-button"></div><div _ngcontent-cim-c106="" class="handle-button line-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cim-c106="" class="handle-button theme-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cim-c106="" class="handle-button copy-button"><div _ngcontent-cim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cim-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>