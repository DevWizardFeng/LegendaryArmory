<h1 _ngcontent-dot-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口创建基本数据类型"> 使用Node-API接口创建基本数据类型 </h1>

<div _ngcontent-dot-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>ArkTS的Number类型是一个双精度64位二进制格式IEEE 754值。只有在-2^53+1到2^53-1范围内（闭区间）的整数才能在不丢失精度的情况下被表示，在超过该取值范围的情况下，需要使用BigInt对应的Node-API接口来处理更大范围的整数。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>当使用Node-API接口进行数值类型的创建和获取时，有一些基本概念需要了解：</p> <ul><li><strong>数值类型</strong> 在使用Node-API接口时，可能需要从Node-API模块数值类型转换为ArkTS数值类型值，或者从ArkTS数据类型值转换为Node-API模块数值类型。在进行数据类型转换时，需要注意数据范围是否匹配，以及有无符号整数和双精度数值等区别。</li><li><strong>错误处理</strong> 在使用这些接口时，需要对可能发生的错误进行适当处理。比如，在创建整数值时可能发生内存分配错误或其他运行时错误，需要使用Node-API提供的错误处理机制来捕获并处理这些错误。</li><li><strong>ArkTS交互</strong> 在开发过程中，需要考虑如何将创建的数值类型值与ArkTS环境进行交互，包括传递参数、返回值等。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下Node-API函数通常在开发ArkTS的Node-API模块时使用，以便处理数值类型值，帮助开发人员在Node-API模块中和ArkTS数值进行交互：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_uint32</td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中number类型数据转为Node-API模块中的uint32_t类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_int32</td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的number类型数据转为Node-API模块中的int32_t类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_int64</td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的number类型数据转为Node-API模块中的int64_t类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_double</td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的number类型数据转为Node-API模块中的double类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-primitive#napi_get_value_bool" target="_blank">napi_get_value_bool</a></td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的boolean类型数据转为Node-API模块中的bool类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_get_value_string_utf8" target="_blank">napi_get_value_string_utf8</a></td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的string类型数据转为Node-API模块中的utf8编码的字符类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_get_value_string_utf16" target="_blank">napi_get_value_string_utf16</a></td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的string类型数据转为Node-API模块中的utf16编码的字符类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_get_value_string_latin1" target="_blank">napi_get_value_string_latin1</a></td> <td class="cellrowborder" valign="top" width="50%">将ArkTS环境中获取的string类型数据转为Node-API模块中的ISO-8859-1编码的字符类型数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_int32</td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的int32_t类型转换为ArkTS环境中number类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_uint32</td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的uint32_t类型转换为ArkTS环境中number类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_int64</td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的int64_t类型转换为ArkTS环境中number类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_double</td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的double类型转换为ArkTS环境中number类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-primitive#napi_get_boolean" target="_blank">napi_get_boolean</a></td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的bool类型转换为ArkTS环境中boolean类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_create_string_utf8" target="_blank">napi_create_string_utf8</a></td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的utf8编码的字符串类型转换为ArkTS环境中string类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_create_string_utf16" target="_blank">napi_create_string_utf16</a></td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的utf16编码的字符串类型转换为ArkTS环境中string类型。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-about-string#napi_create_string_latin1" target="_blank">napi_create_string_latin1</a></td> <td class="cellrowborder" valign="top" width="50%">将Node-API模块中的ISO-8859-1编码的字符串类型转换为ArkTS环境中string类型。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="napi_get_value_uint32" class="firsth2">napi_get_value_uint32<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_uint32" tips="复制节点链接"></i></h3><p>用于从ArkTS环境中获取32位无符号整数值。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueUint32</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取传入的数字类型参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-comment">// 解析传入的参数</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-type">uint32_t</span> number = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 获取传入参数的值中的无符号32位整数</span></li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_uint32</span>(env, argv[<span class="hljs-number">0</span>], &amp;number);</li><li>    <span class="hljs-comment">// 如果传递的参数不是数字,将会返回napi_number_expected，设置函数返回nullptr</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 创建传入参数无符号32位整数，并传出</span></li><li>    <span class="hljs-built_in">napi_create_uint32</span>(env, number, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueUint32</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">getValueUint32</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">111111111111</span>);</li><li><span class="hljs-keyword">let</span> data = testNapi.<span class="hljs-property">getValueUint32</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">"sssss"</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_uint32_number %{public}d'</span>, value);</li><li><span class="hljs-comment">// 传入非数字"sssss"时函数返回undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_uint32_number %{public}s'</span>, data);</li><li><span class="hljs-comment">// 传入uint32范围内的数字100时函数返回原数字</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_uint32_number %{public}d'</span>, testNapi.<span class="hljs-property">getValueUint32</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">100</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_int32">napi_get_value_int32<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_int32" tips="复制节点链接"></i></h3><p>将ArkTS value转为Node-API模块中的int32类型数据。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueInt32</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">int32_t</span> result32 = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 解析传递的参数</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将前端传过来的参数转为Node-API模块的int32类型</span></li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;result32);</li><li>    <span class="hljs-comment">// 如果传递的参数不是数字napi_get_value_int32接口将会返回napi_number_expected，设置函数返回nullptr</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 调用napi_create_int32接口将int32类型的数据转为napi_value返回</span></li><li>    napi_value napiResult32 = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, result32, &amp;napiResult32);</li><li>    <span class="hljs-keyword">return</span> napiResult32;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueInt32</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 传入非数字“ss”时函数返回undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_not_number %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(<span class="hljs-string">'ss'</span>));</li><li><span class="hljs-comment">// 传入int32范围内的数字100时函数返回原数字</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_number %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(<span class="hljs-number">100</span>));</li><li><span class="hljs-comment">// 传入68719476735，此数字的二进制为111111111111111111111111111111111111，在int32类型中此二进制代表数字-1</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_oversize %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(<span class="hljs-number">68719476735</span>));</li><li><span class="hljs-comment">// 大于2的31次-1的数字且不是二进制为111111111111111111111111111111111111这样的在int32中有特殊含义的数字也会溢出，导致数值发生改变，返回值按后32位二进制编码解码</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_oversize %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(<span class="hljs-number">687194767355</span>));</li><li><span class="hljs-comment">// 传入NAN（not a number）、+Infinity（正无穷）或-Infinity（负无穷），会返回数字0</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_number_NAN %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(<span class="hljs-title class_">NaN</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_number_+Infinity %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(+<span class="hljs-title class_">Infinity</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int32_number_-Infinity %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt32</span>(-<span class="hljs-title class_">Infinity</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_int64">napi_get_value_int64<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_int64" tips="复制节点链接"></i></h3><p>将ArkTS value转为Node-API模块中的int64类型数据。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueInt64</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-type">int64_t</span> result64 = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 解析传递的值</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将前端传过来的参数转为Node-API模块的int64类型</span></li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_int64</span>(env, args[<span class="hljs-number">0</span>], &amp;result64);</li><li>    <span class="hljs-comment">// 如果传递的参数不是数字, 返回napi_number_expected.</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 调用napi_create_int64接口将int64类型的数据转为napi_value返回前端</span></li><li>    napi_value napiResult64 = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_int64</span>(env, result64, &amp;napiResult64);</li><li>    <span class="hljs-keyword">return</span> napiResult64;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueInt64</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 输入不超过int64表示范围的数字，会返回该数字</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_number %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(<span class="hljs-number">80</span>));</li><li><span class="hljs-comment">// 传入非数字“ss”，获得函数返回的值应为undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_not_number %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(<span class="hljs-string">'sAs'</span>));</li><li><span class="hljs-comment">// 输入超过int64表示范围的数字会溢出，失去精度，导致输入数字与返回数字不相等</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_number_oversize %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(<span class="hljs-number">9223372036854775809</span>));</li><li><span class="hljs-comment">// 传入NAN（not a number）、+Infinity（正无穷）或-Infinity（负无穷）接口返回数字0</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_number_NAN %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(<span class="hljs-title class_">NaN</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_number_+Infinity %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(+<span class="hljs-title class_">Infinity</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_int64_number_-Infinity %{public}d'</span>, testNapi.<span class="hljs-title function_">getValueInt64</span>(-<span class="hljs-title class_">Infinity</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_double">napi_get_value_double<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_double" tips="复制节点链接"></i></h3><p>将ArkTS value转为Node-API模块中的double类型数据。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetDouble</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">double</span> value = <span class="hljs-number">0</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">0</span>], &amp;value);</li><li>    <span class="hljs-comment">// 传入非数字接口返回napi_number_expected</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getDouble</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 输入数字，返回该数字</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_double_number %{public}d'</span>, testNapi.<span class="hljs-title function_">getDouble</span>(<span class="hljs-number">80.885</span>));</li><li><span class="hljs-comment">// 传入非数字，获得函数返回的值应为undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_double_not_number %{public}s'</span>, testNapi.<span class="hljs-title function_">getDouble</span>(<span class="hljs-string">'sAs'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_int32">napi_create_int32<i class="anchor-icon anchor-icon-link" anchorid="napi_create_int32" tips="复制节点链接"></i></h3><p>用于创建一个ArkTS数字（int32类型）的值。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> INT_NUM_NEG_26 = <span class="hljs-number">-26</span>;   <span class="hljs-comment">// int类型数值-26</span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateInt32</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// int32_t是有符号的32位整数类型，表示带有符号的整数，它的范围是从-2^31到2^31 - 1，也就是-2147483648到2147483647</span></li><li>    <span class="hljs-comment">// 要表示的整数值</span></li><li>    <span class="hljs-type">int32_t</span> value = INT_NUM_NEG_26;</li><li>    <span class="hljs-comment">// 创建ArkTS中的int32数字</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_int32</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 处理错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create int32 value"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createInt32</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,<span class="hljs-string">'Test Node-API napi_create_int32：'</span> + testNapi.<span class="hljs-title function_">createInt32</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_uint32">napi_create_uint32<i class="anchor-icon anchor-icon-link" anchorid="napi_create_uint32" tips="复制节点链接"></i></h3><p>用于创建一个ArkTS数字（uint32类型）的值。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> INT_NUM_26 = <span class="hljs-number">26</span>;   <span class="hljs-comment">// int类型数值26</span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateUInt32</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 如果使用 uint32_t类型来定义-26，会发生溢出，溢出时会对结果进行模运算，将负数的二进制补码转换为相应的正数。-26输出4294967270</span></li><li>    <span class="hljs-comment">// uint32_t是无符号的32位整数类型，只能表示非负整数。它的范围是从0到2 ^32 - 1，即0到4294967295</span></li><li>    <span class="hljs-comment">// 要表示的整数值</span></li><li>    <span class="hljs-type">uint32_t</span> value = INT_NUM_26;</li><li>    <span class="hljs-comment">// 创建ArkTS中的uint32数字</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_uint32</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 处理错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create uint32 value"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createUInt32</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,<span class="hljs-string">'Test Node-API napi_create_uint32: '</span> + testNapi.<span class="hljs-title function_">createUInt32</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_int64">napi_create_int64<i class="anchor-icon anchor-icon-link" anchorid="napi_create_int64" tips="复制节点链接"></i></h3><p>用于创建一个ArkTS数字（int64类型）的值。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateInt64</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 要表示的整数值</span></li><li>    <span class="hljs-type">int64_t</span> value = <span class="hljs-number">2147483648</span>;</li><li>    <span class="hljs-comment">// 使用给定数值创建一个ArkTS number，仅能准确表示范围从-2^53 + 1到2^53 - 1（闭区间）的整数</span></li><li>    <span class="hljs-comment">// 如果想表示的数值超过了2^53，请使用napi_create_bigint64接口</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_int64</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 处理错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create int64 value"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createInt64</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,<span class="hljs-string">'Test Node-API napi_create_int64: '</span> + testNapi.<span class="hljs-title function_">createInt64</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_double">napi_create_double<i class="anchor-icon anchor-icon-link" anchorid="napi_create_double" tips="复制节点链接"></i></h3><p>用于创建一个ArkTS数字（double类型）的值。</p> <p>cpp部分代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateDouble</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">double</span> value = <span class="hljs-number">1.234</span>;</li><li>    <span class="hljs-comment">// 创建ArkTS中的double数字</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_create_double</span>(env, value, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 处理错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create double value"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createDouble</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>,<span class="hljs-string">'Test Node-API napi_create_double: '</span> + testNapi.<span class="hljs-title function_">createDouble</span>());</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-dot-c106="" class="highlight-div"><div _ngcontent-dot-c106="" class="highlight-div-header"><div _ngcontent-dot-c106="" class="highlight-div-header-left"><div _ngcontent-dot-c106="" class="handle-button expand-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dot-c106="" class="highlight-div-header-right"><div _ngcontent-dot-c106="" class="handle-button ai-button"></div><div _ngcontent-dot-c106="" class="handle-button line-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dot-c106="" class="handle-button theme-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dot-c106="" class="handle-button copy-button"><div _ngcontent-dot-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dot-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>