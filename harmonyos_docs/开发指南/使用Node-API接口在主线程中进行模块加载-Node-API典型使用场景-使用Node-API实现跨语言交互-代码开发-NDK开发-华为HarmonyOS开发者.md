<h1 _ngcontent-xsr-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口在主线程中进行模块加载"> 使用Node-API接口在主线程中进行模块加载 </h1>

<div _ngcontent-xsr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2><p>Node-API中的napi_load_module接口的功能是在主线程中进行模块的加载，当模块加载出来之后，可以使用函数napi_get_property获取模块导出的变量，也可以使用napi_get_named_property获取模块导出的函数。</p> </div>  <div class="tiledSection"><h2 id="函数说明">函数说明<i class="anchor-icon anchor-icon-link" anchorid="函数说明" tips="复制节点链接"></i></h2><div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">napi_status <span class="hljs-title">napi_load_module</span><span class="hljs-params">(napi_env env, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* path, napi_value* result)</span></span>;</li></ol></pre></div></div>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">参数</th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">env</td> <td class="cellrowborder" valign="top" width="50%">当前的虚拟机环境</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">path</td> <td class="cellrowborder" valign="top" width="50%">加载的文件路径或者模块名</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">result</td> <td class="cellrowborder" valign="top" width="50%">加载的模块</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用限制">使用限制<i class="anchor-icon anchor-icon-link" anchorid="使用限制" tips="复制节点链接"></i></h2><ul><li>禁止在非主线程当中使用该接口。</li><li>禁止在Init函数中使用该接口。</li><li>禁止在线程安全函数的回调函数当中进行文件路径的加载。</li></ul> <p>建议使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-load-module-with-info">napi_load_module_with_info</a>来进行模块加载，该接口支持了更多的场景。</p> </div>  <div class="tiledSection"><h2 id="napi_load_module支持的场景">napi_load_module支持的场景<i class="anchor-icon anchor-icon-link" anchorid="napi_load_module支持的场景" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.1" valign="top" width="33.33333333333333%">场景</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.2" valign="top" width="33.33333333333333%">详细分类</th> <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.4.1.3" valign="top" width="33.33333333333333%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="33.33333333333333%">系统模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载@ohos.或 @system.</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">本地工程模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载ets目录下文件中的模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">要求路径以ets开头</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">本地工程模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载模块内文件路径</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">要求路径以moduleName开头</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">本地工程模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载HAR模块名</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">本地工程模块</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载HSP模块名</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">远程包</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载远程HAR模块名</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">远程包</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载ohpm包名</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr> <tr><td class="cellrowborder" valign="top" width="33.33333333333333%">模块Native库</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">加载libNativeLibrary.so</td> <td class="cellrowborder" valign="top" width="33.33333333333333%">-</td> </tr>  </tbody></table></div> </div> <ul><li><p><strong>加载系统模块</strong></p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载模块@ohos.hilog</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"@ohos.hilog"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取info函数</span></li><li>    napi_value infoFn;</li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"info"</span>, &amp;infoFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    </li><li>    napi_value tag;</li><li>    std::string formatStr = <span class="hljs-string">"test"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, formatStr.<span class="hljs-built_in">c_str</span>(), formatStr.<span class="hljs-built_in">size</span>(), &amp;tag);</li><li>    </li><li>    napi_value outputString;</li><li>    std::string str = <span class="hljs-string">"Hello HarmonyOS"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, str.<span class="hljs-built_in">c_str</span>(), str.<span class="hljs-built_in">size</span>(), &amp;outputString);</li><li>    </li><li>    napi_value flag;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, <span class="hljs-number">0</span>, &amp;flag);</li><li>
</li><li>    napi_value args[<span class="hljs-number">3</span>] = {flag, tag, outputString};</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用info函数</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, infoFn, <span class="hljs-number">3</span>, args, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>     </li><li><p><strong>加载ets目录下文件中的模块</strong></p>  <p>  当加载文件中的模块时，如以下ArkTS代码：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//./src/main/ets/Test.ets</span></li><li><span class="hljs-keyword">let</span> value = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Hello HarmonyOS"</span>);</li><li>}</li><li><span class="hljs-keyword">export</span> {value, test};</li></ol></pre></div></div>    </li></ul> <ol><li><p>需要在模块的build-profile.json5文件中进行以下配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"./src/main/ets/Test.ets"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>    </li><li><p>使用napi_load_module加载Test文件，调用函数test以及获取变量value：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载Test文件中的模块</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"ets/Test"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value testFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取test函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"test"</span>, &amp;testFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数test</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, testFn, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value value;</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"value"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 4. 使用napi_get_property获取变量value</span></li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>   </li></ol> <ul><li><p><strong>加载模块内文件路径</strong></p>  <p>  当加载文件中的模块时，如以下ArkTS代码：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//./src/main/ets/Test.ets</span></li><li><span class="hljs-keyword">let</span> value = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Hello HarmonyOS"</span>);</li><li>}</li><li><span class="hljs-keyword">export</span> {value, test};</li></ol></pre></div></div>  </li></ul> <ol><li><p>需要当前模块的build-profile.json5文件中进行以下配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"./src/main/ets/Test.ets"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>使用napi_load_module加载Test文件，调用函数test以及获取变量value：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载Test文件中的模块</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"entry/src/main/ets/Test"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value testFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取test函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"test"</span>, &amp;testFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数test</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, testFn, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value value;</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"value"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 4. 使用napi_get_property获取变量value</span></li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><p><strong>加载HAR模块名</strong></p>  <p>  HAR包Index.ets文件如下：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//library Index.ets</span></li><li><span class="hljs-keyword">let</span> value = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Hello HarmonyOS"</span>);</li><li>}</li><li><span class="hljs-keyword">export</span> {value, test};</li></ol></pre></div></div>  </li></ul> <ol><li><p>在当前模块下的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"library"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../library"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在使用library的模块中，对build-profile.json5进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"library"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>用napi_load_module加载library，调用函数test以及获取变量value：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载library</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"library"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value testFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取test函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"test"</span>, &amp;testFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数test</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, testFn, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value value;</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"value"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 4. 使用napi_get_property获取变量value</span></li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><p><strong>加载HSP模块名</strong></p>  <p>  HSP包Index.ets文件如下：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//sharedlibrary Index.ets</span></li><li><span class="hljs-keyword">let</span> value = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Hello HarmonyOS"</span>);</li><li>}</li><li><span class="hljs-keyword">export</span> {value, test};</li></ol></pre></div></div>  </li></ul> <ol><li><p>在当前模块下的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"sharedlibrary"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../sharedlibrary"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在使用library的模块中，对build-profile.json5进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"sharedlibrary"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>用napi_load_module加载sharedlibrary，调用函数test以及获取变量value：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载sharedlibrary</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"sharedlibrary"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value testFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取test函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"test"</span>, &amp;testFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数test</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, testFn, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value value;</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"value"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 4. 使用napi_get_property获取变量value</span></li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><strong>加载远程HAR模块名</strong></li></ul> <ol><li><p>在当前模块下的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"@ohos/hypium"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"1.0.16"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在使用@ohos/hypium的模块中，对build-profile.json5进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"@ohos/hypium"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>用napi_load_module加载@ohos/hypium，获取DEFAULT变量：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载@ohos/hypium</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"@ohos/hypium"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"DEFAULT"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 2. 使用napi_get_property获取DEFAULT变量</span></li><li>    napi_value defaultValue;</li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;defaultValue);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><strong>加载ohpm包名</strong></li></ul> <ol><li><p>在当前模块下的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"@ohos/axios"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"2.2.4"</span><span class="hljs-punctuation">,</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在使用@ohos/axios的模块中，对build-profile.json5进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"@ohos/axios"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>用napi_load_module加载@ohos/axios，获取VERSION变量：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载@ohos/axios</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"@ohos/axios"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"VERSION"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 2. 使用napi_get_property获取VERSION</span></li><li>    napi_value defaultValue;</li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;defaultValue);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><p><strong>加载Native库</strong></p>  <p>  libentry.so的index.d.ts文件如下：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">add</span>: <span class="hljs-function">(<span class="hljs-params">a: number, b: number</span>) =&gt;</span> number;</li></ol></pre></div></div>  </li></ul> <ol><li><p>在当前模块下的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"libentry.so"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../src/main/cpp/types/libentry"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在使用libentry.so的模块中，对build-profile.json5进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"libentry.so"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>用napi_load_module加载libentry.so，调用函数add：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载libentry.so</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"libentry.so"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value addFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取add函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"add"</span>, &amp;addFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    </li><li>    napi_value a;</li><li>    napi_value b;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, <span class="hljs-number">2</span>, &amp;a);</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, <span class="hljs-number">3</span>, &amp;b);</li><li>    napi_value args[<span class="hljs-number">2</span>] = {a, b};</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数add</span></li><li>    napi_value returnValue;</li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, addFn, <span class="hljs-number">2</span>, args, &amp;returnValue);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> <ul><li><p><strong>HAR加载HAR模块名</strong></p>  <p>  场景为har1加载har2，har2中的Index.ets文件如下：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="javascript prettyprint linenums hljs language-javascript" hw-language="javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//har2 Index.ets</span></li><li><span class="hljs-keyword">let</span> value = <span class="hljs-number">123</span>;</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">test</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Hello HarmonyOS"</span>);</li><li>}</li><li><span class="hljs-keyword">export</span> {value, test};</li></ol></pre></div></div>  </li></ul> <ol><li><p>在har1中的oh-package.json5文件中配置dependencies项：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"dependencies"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"har2"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"file:../har2"</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在har1的build-profile.json5文件中进行配置：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"packages"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>          <span class="hljs-string">"har2"</span></li><li>        <span class="hljs-punctuation">]</span></li><li>      <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li><li><p>在har1中用napi_load_module加载har2，调用函数test以及获取变量value：</p>  <div _ngcontent-xsr-c106="" class="highlight-div"><div _ngcontent-xsr-c106="" class="highlight-div-header"><div _ngcontent-xsr-c106="" class="highlight-div-header-left"><div _ngcontent-xsr-c106="" class="handle-button expand-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsr-c106="" class="highlight-div-header-right"><div _ngcontent-xsr-c106="" class="handle-button ai-button"></div><div _ngcontent-xsr-c106="" class="handle-button line-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsr-c106="" class="handle-button theme-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsr-c106="" class="handle-button copy-button"><div _ngcontent-xsr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsr-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">loadModule</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    napi_value result;</li><li>    <span class="hljs-comment">// 1. 使用napi_load_module加载har2</span></li><li>    napi_status status = <span class="hljs-built_in">napi_load_module</span>(env, <span class="hljs-string">"har2"</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    </li><li>    napi_value testFn;</li><li>    <span class="hljs-comment">// 2. 使用napi_get_named_property获取test函数</span></li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, result, <span class="hljs-string">"test"</span>, &amp;testFn);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 3. 使用napi_call_function调用函数test</span></li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, result, testFn, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value value;</li><li>    napi_value key;</li><li>    std::string keyStr = <span class="hljs-string">"value"</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, keyStr.<span class="hljs-built_in">c_str</span>(), keyStr.<span class="hljs-built_in">size</span>(), &amp;key);</li><li>    <span class="hljs-comment">// 4. 使用napi_get_property获取变量value</span></li><li>    status = <span class="hljs-built_in">napi_get_property</span>(env, result, key, &amp;value);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div>  </li></ol> </div> </div> <div></div></div>