<h1 _ngcontent-oyl-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口设置ArkTS对象的属性"> 使用Node-API接口设置ArkTS对象的属性 </h1>

<div _ngcontent-oyl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用Node-API接口获取和设置ArkTS对象的属性，实现更复杂的功能和逻辑。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>处理ArkTS对象属性，确保正确访问、设置、删除属性，并了解属性的继承关系和枚举特性。以下是一些关键概念：</p> <ul><li><strong>对象（Object）</strong>：在ArkTS中，对象是一种复合数据类型，它允许存储多个不同类型的值作为一个单独的实体。对象是属性和方法的集合。属性是与对象相关联的值，而方法则是对象可以执行的操作。</li><li><strong>属性（Property）</strong>：在ArkTS中，属性是对象特征的键值对。每个属性都有一个名字（也称为键或标识符）和一个值。属性的值可以是任意数据类型，包括基本类型、对象和函数。</li><li><strong>可枚举属性（EnumerableProperty）</strong>：在ArkTS中，对象的属性分为可枚举和不可枚举，它们是由属性的enumerable值决定的，即内部 “可枚举” 标志设置为true或false。可枚举性决定了这个属性能否被 for...in 查找遍历到。</li><li><strong>自有属性（OwnProperty）</strong>：自有属性是直接定义在对象上的属性，而不是从原型链上继承来的属性。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下Node-API接口提供了对ArkTS对象属性的操作，包括设置、获取、删除和检查属性是否存在。使用场景如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_get_property_names</td> <td class="cellrowborder" valign="top" width="50%">在进行对象操作或调试时，有时需要获取对象的属性和属性名。此接口可以提取对象的属性名，用于动态获取对象的属性信息。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_property</td> <td class="cellrowborder" valign="top" width="50%">此接口可以动态地向对象添加属性。也可修改对象的属性值，满足动态属性值变更的需求。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_property</td> <td class="cellrowborder" valign="top" width="50%">在调用Node-API模块的函数或方法时，可能需要将ArkTS对象的属性值作为参数传递。此接口可以获取属性值，并将其传递给其他函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_property</td> <td class="cellrowborder" valign="top" width="50%">在进行属性访问之前，通常需要先检查对象中是否存在指定的属性。此接口可以检查对象中是否存在指定的属性，避免访问不存在属性导致的异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_property</td> <td class="cellrowborder" valign="top" width="50%">此函数用于删除ArkTS对象上的属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_own_property</td> <td class="cellrowborder" valign="top" width="50%">此函数用于检查ArkTS对象是否直接拥有（而不是从其原型链上继承）某个属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_named_property</td> <td class="cellrowborder" valign="top" width="50%">此函数用于将值赋给ArkTS对象的命名属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_named_property</td> <td class="cellrowborder" valign="top" width="50%">此函数用于获取ArkTS对象的命名属性值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_named_property</td> <td class="cellrowborder" valign="top" width="50%">此函数用于检查ArkTS对象是否包含某个命名属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_define_properties</td> <td class="cellrowborder" valign="top" width="50%">此函数可以在指定的Object中自定义属性，从ArkTS访问和操作这些属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_all_property_names</td> <td class="cellrowborder" valign="top" width="50%">此接口可以获取对象的所有属性名称，检查是否包含特定属性名。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文展示接口对应C++及ArkTS代码。</p> </div>  <div class="tiledSection"><h3 id="napi_get_property_names" class="firsth2">napi_get_property_names<i class="anchor-icon anchor-icon-link" anchorid="napi_get_property_names" tips="复制节点链接"></i></h3><p>以字符串数组的形式获取对象的可枚举属性的名称。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetPropertyNames</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 解析ArkTS的传参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 以字符串数组的形式获取对象的可枚举属性的名称，以result传出</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_property_names</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_get_property_names fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getPropertyNames</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span> };</li><li>  <span class="hljs-keyword">let</span> propertyNames = testNapi.<span class="hljs-title function_">getPropertyNames</span>(obj);</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">isArray</span>(propertyNames) &amp;&amp; propertyNames.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_property_names: %{public}s'</span>, propertyNames[<span class="hljs-number">0</span>]);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_property_names: %{public}s'</span>, propertyNames[<span class="hljs-number">1</span>]);</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_property_names error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_set_property">napi_set_property<i class="anchor-icon anchor-icon-link" anchorid="napi_set_property" tips="复制节点链接"></i></h3><p>将给定的属性与值设置入给定的Object。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> INT_ARG_2 = <span class="hljs-number">2</span>; <span class="hljs-comment">// 入参索引</span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">SetProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收ArkTS侧传入的三个参数：第一个参数为想要设置的object，第二个参数为属性，第三个参数为属性对应的值</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">3</span>;</li><li>    napi_value args[<span class="hljs-number">3</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    napi_status status = <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_get_cb_info fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 通过调用napi_set_property接口将属性与值设置入object，如果失败，直接抛出错误</span></li><li>    status = <span class="hljs-built_in">napi_set_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], args[INT_ARG_2]);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_set_property fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 返回设置成功的object对象</span></li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">setProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key: <span class="hljs-built_in">String</span>, value: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">Object</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span> };</li><li>  <span class="hljs-keyword">let</span> result = testNapi.<span class="hljs-title function_">setProperty</span>(obj, <span class="hljs-string">"code"</span>, <span class="hljs-string">"hi"</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_property: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_property error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_property">napi_get_property<i class="anchor-icon anchor-icon-link" anchorid="napi_get_property" tips="复制节点链接"></i></h3><p>获取object指定的属性的值。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 传入的第一个参数为要检测的object，第二个对象为要检测的属性，通过调用napi_get_property接口获取对应的值</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_get_property fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span> };</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_property: %{public}s'</span>, testNapi.<span class="hljs-title function_">getProperty</span>(obj, <span class="hljs-string">"message"</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_property error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_has_property">napi_has_property<i class="anchor-icon anchor-icon-link" anchorid="napi_has_property" tips="复制节点链接"></i></h3><p>检查对象中是否存在指定的属性，避免访问不存在属性导致的异常。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">HasProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 从ArkTS侧传入两个参数：第一个参数为要检验的对象，第二个参数为要检测是否存在对象的属性</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 将参数传入napi_has_property方法中，若接口调用成功则将结果转化为napi_value类型抛出，否则抛出错误</span></li><li>    <span class="hljs-type">bool</span> result;</li><li>    napi_status status = <span class="hljs-built_in">napi_has_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_has_property fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 若传入属性存在传入对象中，则输出true将结果转化为napi_value类型抛出</span></li><li>    napi_value returnResult;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnResult);</li><li>    <span class="hljs-keyword">return</span> returnResult;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">hasProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key: <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span> };</li><li>  <span class="hljs-keyword">let</span> resultFalse = testNapi.<span class="hljs-title function_">hasProperty</span>(obj, <span class="hljs-number">0</span>);</li><li>  <span class="hljs-keyword">let</span> resultTrue = testNapi.<span class="hljs-title function_">hasProperty</span>(obj, <span class="hljs-string">"data"</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_property: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(resultFalse));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_property: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(resultTrue));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_property error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_delete_property">napi_delete_property<i class="anchor-icon anchor-icon-link" anchorid="napi_delete_property" tips="复制节点链接"></i></h3><p>尝试从给定的Object中删除由key指定的属性，并返回操作的结果。</p> <p>如果对象不可扩展或属性不可配置，则可能无法删除该属性。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 从传入的Object对象中删除指定属性，返回是否删除成功的bool结果值</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">DeleteProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    napi_valuetype valueType;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueType);</li><li>    <span class="hljs-keyword">if</span> (valueType != napi_object) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Expects an object as argument."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 删除指定属性，结果存储在result中</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_delete_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_delete_property failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value ret;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;ret);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">deleteProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key:<span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">first</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">first</span>: <span class="hljs-number">1</span> };</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_delete_property first: %{public}s'</span>, testNapi.<span class="hljs-title function_">deleteProperty</span>(obj, <span class="hljs-string">'first'</span>));</li><li><span class="hljs-comment">// 设置新的属性为不可配置</span></li><li><span class="hljs-comment">// 这里的Object.defineProperty方法在DevEco Studio 4.1.0.400及其以上版本不支持，需在ts使用</span></li><li><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">defineProperty</span>(obj, <span class="hljs-string">'config'</span>, {</li><li>  <span class="hljs-attr">configurable</span>: <span class="hljs-literal">false</span>,</li><li>  <span class="hljs-attr">value</span>: <span class="hljs-string">"value"</span></li><li>})</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_delete_property config: %{public}s'</span>, testNapi.<span class="hljs-title function_">deleteProperty</span>(obj, <span class="hljs-string">'config'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_has_own_property">napi_has_own_property<i class="anchor-icon anchor-icon-link" anchorid="napi_has_own_property" tips="复制节点链接"></i></h3><p>用于检查传入的Object是否包含自己的命名属性，不包括从原型链上继承的属性。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiHasOwnProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 检查第一个参数是否为对象</span></li><li>    napi_valuetype valueTypeObj;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueTypeObj);</li><li>    <span class="hljs-keyword">if</span> (valueTypeObj != napi_object) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"First argument must be an object."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 检查第二个参数是否为string</span></li><li>    napi_valuetype valuetypeStr;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">1</span>], &amp;valuetypeStr);</li><li>    <span class="hljs-keyword">if</span> (valuetypeStr != napi_string) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Second argument must be a string."</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 检查对象是否具有指定属性，结果存储在hasProperty中</span></li><li>    <span class="hljs-type">bool</span> hasProperty;</li><li>    napi_status status = <span class="hljs-built_in">napi_has_own_property</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;hasProperty);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_has_own_property failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, hasProperty, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiHasOwnProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key:<span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> myObj = { <span class="hljs-string">'myProperty'</span>: <span class="hljs-number">1</span> };</li><li><span class="hljs-keyword">let</span> inheritedObj = { <span class="hljs-string">'inheritedProperty'</span>: <span class="hljs-number">2</span> };</li><li><span class="hljs-comment">// 这里的Object.setPrototypeOf方法在DevEco Studio 4.1.0.400及其以上版本不支持，需在ts使用</span></li><li><span class="hljs-title class_">Object</span>.<span class="hljs-title function_">setPrototypeOf</span>(myObj, inheritedObj);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_own_property my: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiHasOwnProperty</span>(myObj, <span class="hljs-string">'myProperty'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_own_property inherited: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiHasOwnProperty</span>(myObj, <span class="hljs-string">'inheritedProperty'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_set_named_property">napi_set_named_property<i class="anchor-icon anchor-icon-link" anchorid="napi_set_named_property" tips="复制节点链接"></i></h3><p>在传入的ArkTS对象上添加一个命名属性。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiSetNamedProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收一个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value str;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">int32_t</span> strLength = <span class="hljs-number">32</span>;</li><li>    <span class="hljs-type">char</span> strKey[strLength] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, &amp;str, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取传入参数字符串并存储在strKey中</span></li><li>    <span class="hljs-type">size_t</span> keyLength;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, str, strKey, strLength, &amp;keyLength);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_value_string_utf8 failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 创建一个新对象</span></li><li>    napi_value newObj;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;newObj);</li><li>    <span class="hljs-comment">// 设置整数值1234为属性值</span></li><li>    <span class="hljs-type">int32_t</span> value = <span class="hljs-number">1234</span>;</li><li>    napi_value numValue;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, value, &amp;numValue);</li><li>    <span class="hljs-comment">// 将整数值与指定属性名关联</span></li><li>    status = <span class="hljs-built_in">napi_set_named_property</span>(env, newObj, strKey, numValue);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_set_named_property failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 返回设置了命名属性的对象newObj</span></li><li>    <span class="hljs-keyword">return</span> newObj;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiSetNamedProperty</span>: <span class="hljs-function">(<span class="hljs-params">key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">Object</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> obj = testNapi.<span class="hljs-title function_">napiSetNamedProperty</span>(<span class="hljs-string">'myProperty'</span>);</li><li><span class="hljs-keyword">let</span> objAsString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(obj);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_named_property: %{public}s'</span>, objAsString);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_named_property">napi_get_named_property<i class="anchor-icon anchor-icon-link" anchorid="napi_get_named_property" tips="复制节点链接"></i></h3><p>从ArkTS对象中获取命名属性的值。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiGetNamedProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">int32_t</span> strLength = <span class="hljs-number">32</span>;</li><li>    <span class="hljs-type">char</span> strKey[strLength] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要获取的属性名</span></li><li>    <span class="hljs-type">size_t</span> keyLength;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">1</span>], strKey, strLength, &amp;keyLength);</li><li>    <span class="hljs-comment">// 获取指定属性的值并存储在result中</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_named_property</span>(env, args[<span class="hljs-number">0</span>], strKey, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_get_named_property failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 返回result</span></li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiGetNamedProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Object</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">NestedObj</span> {</li><li>  <span class="hljs-attr">nestedStr</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">nestedNum</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">bol</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-attr">nestedObj</span>: <span class="hljs-title class_">NestedObj</span> = { <span class="hljs-attr">nestedStr</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">nestedNum</span>: <span class="hljs-number">0</span> };</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = {<span class="hljs-attr">str</span>: <span class="hljs-string">"bar"</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">bol</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">nestedObj</span>: { <span class="hljs-attr">nestedStr</span>: <span class="hljs-string">"nestedValue"</span>, <span class="hljs-attr">nestedNum</span>: <span class="hljs-number">123</span> }};</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiGetNamedProperty</span>(obj, <span class="hljs-string">'str'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_named_property : %{public}d'</span>, testNapi.<span class="hljs-title function_">napiGetNamedProperty</span>(obj, <span class="hljs-string">'num'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiGetNamedProperty</span>(obj, <span class="hljs-string">'bol'</span>));</li><li><span class="hljs-keyword">let</span> nestedObj = testNapi.<span class="hljs-title function_">napiGetNamedProperty</span>(obj, <span class="hljs-string">'nestedObj'</span>);</li><li><span class="hljs-keyword">let</span> objAsString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(nestedObj);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_named_property : %{public}s'</span>, objAsString);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiGetNamedProperty</span>(obj, <span class="hljs-string">'null'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_has_named_property">napi_has_named_property<i class="anchor-icon anchor-icon-link" anchorid="napi_has_named_property" tips="复制节点链接"></i></h3><p>检查ArkTS对象中是否具有指定的命名属性。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiHasNamedProperty</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收两个ArkTS传来的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">int32_t</span> strLength = <span class="hljs-number">32</span>;</li><li>    <span class="hljs-type">char</span> strKey[strLength] = <span class="hljs-string">""</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要检查的属性名</span></li><li>    <span class="hljs-type">size_t</span> keyLength;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, args[<span class="hljs-number">1</span>], strKey, strLength, &amp;keyLength);</li><li>    <span class="hljs-comment">// 检查对象是否具有指定命名的属性，并将结果存储在hasProperty中</span></li><li>    <span class="hljs-type">bool</span> hasProperty = <span class="hljs-literal">false</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_has_named_property</span>(env, args[<span class="hljs-number">0</span>], strKey, &amp;hasProperty);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_has_named_property failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, hasProperty, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiHasNamedProperty</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, key:<span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">NestedObj</span> {</li><li>  <span class="hljs-attr">nestedStr</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">nestedNum</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">str</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">bol</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-attr">nestedObj</span>: <span class="hljs-title class_">NestedObj</span> = { <span class="hljs-attr">nestedStr</span>: <span class="hljs-string">""</span>, <span class="hljs-attr">nestedNum</span>: <span class="hljs-number">0</span> };</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = {<span class="hljs-attr">str</span>: <span class="hljs-string">"bar"</span>, <span class="hljs-attr">num</span>: <span class="hljs-number">42</span>, <span class="hljs-attr">bol</span>: <span class="hljs-literal">true</span>,</li><li>  <span class="hljs-attr">nestedObj</span>: { <span class="hljs-attr">nestedStr</span>: <span class="hljs-string">"nestedValue"</span>, <span class="hljs-attr">nestedNum</span>: <span class="hljs-number">123</span> }};</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiHasNamedProperty</span>(obj, <span class="hljs-string">'str'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiHasNamedProperty</span>(obj, <span class="hljs-string">'nestedStr'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_named_property : %{public}s'</span>, testNapi.<span class="hljs-title function_">napiHasNamedProperty</span>(obj, <span class="hljs-string">'bol'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_define_properties">napi_define_properties<i class="anchor-icon anchor-icon-link" anchorid="napi_define_properties" tips="复制节点链接"></i></h3><p>设置对象的属性。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">DefineMethodPropertiesExample</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建一个int32类型的属性值</span></li><li>    <span class="hljs-type">int32_t</span> propValue = <span class="hljs-number">26</span>;</li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, propValue, &amp;returnValue);</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li><li><span class="hljs-comment">// Getter回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetterCallback</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value result;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *str = <span class="hljs-string">u8"World!"</span>;</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-built_in">strlen</span>(str);</li><li>    <span class="hljs-comment">// 创建属性的值</span></li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, str, length, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// Setter回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">SetterCallback</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取传递给setter的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, argv[<span class="hljs-number">0</span>], <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, &amp;length);</li><li>    <span class="hljs-type">char</span>* buf = <span class="hljs-keyword">new</span> <span class="hljs-type">char</span>[length + <span class="hljs-number">1</span>];</li><li>    std::<span class="hljs-built_in">memset</span>(buf, <span class="hljs-number">0</span>, length + <span class="hljs-number">1</span>);</li><li>    <span class="hljs-built_in">napi_get_value_string_utf8</span>(env, argv[<span class="hljs-number">0</span>], buf, length + <span class="hljs-number">1</span>, &amp;length);</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, buf, length, &amp;result);</li><li>    <span class="hljs-keyword">delete</span>[] buf;</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">DefineMethodProperties</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value obj;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;obj);</li><li>    <span class="hljs-comment">// 在obj对象上定义了一个函数defineMethodPropertiesExample，在函数defineMethodPropertiesExample中定义了一个变量并返回，在调用obj的这个对象时可以调用这个函数</span></li><li>    napi_property_descriptor descriptor[] = {</li><li>        {<span class="hljs-string">"defineMethodPropertiesExample"</span>, <span class="hljs-literal">nullptr</span>, DefineMethodPropertiesExample, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}};</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, obj, <span class="hljs-built_in">sizeof</span>(descriptor) / <span class="hljs-built_in">sizeof</span>(descriptor[<span class="hljs-number">0</span>]), descriptor);</li><li>    <span class="hljs-keyword">return</span> obj;</li><li>}</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">DefineStringProperties</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value obj;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;obj);</li><li>    <span class="hljs-comment">// 创建一个string类型的属性值</span></li><li>    napi_value string_value;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Hello!"</span>, NAPI_AUTO_LENGTH, &amp;string_value);</li><li>    napi_property_descriptor descriptor[] = {</li><li>        {<span class="hljs-string">"defineStringPropertiesExample"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, string_value, napi_default, <span class="hljs-literal">nullptr</span>}};</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, obj, <span class="hljs-built_in">sizeof</span>(descriptor) / <span class="hljs-built_in">sizeof</span>(descriptor[<span class="hljs-number">0</span>]), descriptor);</li><li>    <span class="hljs-keyword">return</span> obj;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateStringWithGetterSetter</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value obj;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;obj);</li><li>    <span class="hljs-comment">// 定义getter函数</span></li><li>    napi_value getterFn;</li><li>    <span class="hljs-built_in">napi_create_function</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, GetterCallback, <span class="hljs-literal">nullptr</span>, &amp;getterFn);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, obj, <span class="hljs-string">"getterCallback"</span>, getterFn);</li><li>    <span class="hljs-comment">// 定义setter函数</span></li><li>    napi_value setterFn;</li><li>    <span class="hljs-built_in">napi_create_function</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, SetterCallback, <span class="hljs-literal">nullptr</span>, &amp;setterFn);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, obj, <span class="hljs-string">"setterCallback"</span>, setterFn);</li><li>    <span class="hljs-comment">// 定义带有getter和setter的属性</span></li><li>    napi_property_descriptor desc = {<span class="hljs-string">"defineGetterSetter"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, GetterCallback, SetterCallback, <span class="hljs-literal">nullptr</span>, napi_enumerable, <span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, obj, <span class="hljs-number">1</span>, &amp;desc);</li><li>    <span class="hljs-keyword">return</span> obj;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefineMethodObj</span> {</li><li>  <span class="hljs-attr">defineMethodPropertiesExample</span>: <span class="hljs-title class_">Function</span>;</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefineStringObj</span> {</li><li>  <span class="hljs-attr">defineStringPropertiesExample</span>: <span class="hljs-built_in">string</span>;</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DefineGetterSetterObj</span> {</li><li>  <span class="hljs-attr">getterCallback</span>: <span class="hljs-title class_">Function</span>;</li><li>  <span class="hljs-attr">setterCallback</span>: <span class="hljs-title class_">Function</span>;</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">defineMethodProperties</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">DefineMethodObj</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">defineStringProperties</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">DefineStringObj</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createStringWithGetterSetter</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">DefineGetterSetterObj</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 定义method类型的属性</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API define_method_properties:%{public}d'</span>, testNapi.<span class="hljs-title function_">defineMethodProperties</span>()</li><li>  .<span class="hljs-title function_">defineMethodPropertiesExample</span>());</li><li><span class="hljs-comment">// 定义string类型的属性</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API define_string_properties::%{public}s '</span>, testNapi.<span class="hljs-title function_">defineStringProperties</span>()</li><li>  .<span class="hljs-property">defineStringPropertiesExample</span>);</li><li><span class="hljs-comment">// getter和setter</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get::%{public}s '</span>, testNapi.<span class="hljs-title function_">createStringWithGetterSetter</span>()</li><li>  .<span class="hljs-title function_">getterCallback</span>());</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API setter::%{public}s '</span>, testNapi.<span class="hljs-title function_">createStringWithGetterSetter</span>()</li><li>  .<span class="hljs-title function_">setterCallback</span>(<span class="hljs-string">'set data'</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_all_property_names">napi_get_all_property_names<i class="anchor-icon anchor-icon-link" anchorid="napi_get_all_property_names" tips="复制节点链接"></i></h3><p>获取传入的ArkTS对象的所有属性名。</p> <p>cpp部分代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetAllPropertyNames</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 传入一个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 获取给定对象的所有属性名称</span></li><li>    napi_value result;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_all_property_names</span>(env, args[<span class="hljs-number">0</span>], napi_key_own_only, napi_key_writable,</li><li>                                                     napi_key_numbers_to_strings, &amp;result);</li><li>    <span class="hljs-comment">// 如果获取属性名失败，抛出一个错误</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_get_all_property_names fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> getAllPropertyNames : <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span> };</li><li>  <span class="hljs-keyword">let</span> propertyNames = testNapi.<span class="hljs-title function_">getAllPropertyNames</span>(obj);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_all_property_names: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(propertyNames));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_all_property_names error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-oyl-c106="" class="highlight-div"><div _ngcontent-oyl-c106="" class="highlight-div-header"><div _ngcontent-oyl-c106="" class="highlight-div-header-left"><div _ngcontent-oyl-c106="" class="handle-button expand-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-oyl-c106="" class="highlight-div-header-right"><div _ngcontent-oyl-c106="" class="handle-button ai-button"></div><div _ngcontent-oyl-c106="" class="handle-button line-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-oyl-c106="" class="handle-button theme-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-oyl-c106="" class="handle-button copy-button"><div _ngcontent-oyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-oyl-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>