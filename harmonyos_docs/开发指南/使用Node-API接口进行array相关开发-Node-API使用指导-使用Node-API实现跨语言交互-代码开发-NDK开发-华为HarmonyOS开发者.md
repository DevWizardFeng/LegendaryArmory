<h1 _ngcontent-mbh-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口进行array相关开发"> 使用Node-API接口进行array相关开发 </h1>

<div _ngcontent-mbh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用Node-API接口进行array相关开发时，调用相关接口可以在Node-API模块中直接操作和处理ArkTS中的数组。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>使用Node-API接口进行数组（array）相关开发时，涉及的基本概念主要包括数组的创建、访问、修改、遍历以及与数组相关的操作。这些概念对于理解如何在Node-API模块中与ArkTS数组交互非常重要。以下是一些关键概念：</p> <ul><li><strong>数组的创建</strong>：在Node-API模块中需要创建一个新的ArkTS数组。可以使用napi_create_array接口创建数组，并将数组传递给ArkTS层。</li><li><strong>数组相关操作</strong>在Node-API模块中通过对应的接口获取ArkTS数组的长度，检索指定索引处的元素以及设置指定索引处的元素值。这样可以实现Node-API模块与ArkTS数组的交互。</li><li><strong>TypedArray</strong>：ArkTS 中的 TypedArray 是一种描述二进制数据的类数组数据视图，可以理解为指定元素类型的数组。TypedArray 没有直接构造器，但可以通过其子类构造器创建。TypedArray 的子类包括：Int8Array、Uint8Array、Uint8ClampedArray、Int16Array、Int32Array 等。</li><li><strong>DataView</strong>：DataView是ArkTS中的一种灵活的二进制数据访问视图。它提供了从ArrayBuffer读取和写入多种数值类型的方法。与TypedArray不同，DataView不要求数据必须按特定字节对齐，因此可以处理任意字节偏移的数据结构。DataView支持以下方法（均有对应的get和set版本）：Int8、Uint8、Int16、Uint16、Int32、Uint32、Float32、Float64等。</li><li><strong>ArrayBuffer</strong>：ArrayBuffer 是固定长度的二进制数据缓冲区。它不能直接读写，但可以通过 TypedArray 或 DataView 来操作其内容。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>使用Node-API接口进行数组相关开发时，可以处理各种涉及ArkTS数组的操作和交互场景。以下是几个具体的使用场景介绍：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_create_array" target="_blank">napi_create_array</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中向ArkTS层创建一个ArkTS数组对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_create_array_with_length" target="_blank">napi_create_array_with_length</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中向ArkTS层创建指定长度的ArkTS数组时。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_get_array_length" target="_blank">napi_get_array_length</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中获取ArkTS数组对象的长度。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_is_array" target="_blank">napi_is_array</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中判断一个napi_value值是否为数组。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_set_element" target="_blank">napi_set_element</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中对ArkTS数组对象的特定索引处设置一个值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_get_element" target="_blank">napi_get_element</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中从ArkTS数组对象的特定索引处获取一个值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_has_element" target="_blank">napi_has_element</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中判断ArkTS数组对象请求索引处是否包含元素。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_delete_element" target="_blank">napi_delete_element</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中从ArkTS数组对象中删除请求索引对应的元素。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_create_typedarray" target="_blank">napi_create_typedarray</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中创建指定类型的TypedArray，例如Uint8Array、Int32Array等，通常用于将Node-API模块中的数据转换为ArkTS中的TypedArray，以便进行高性能的数据处理操作。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_is_typedarray" target="_blank">napi_is_typedarray</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中判断一个给定的napi_value是否为TypedArray对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_get_typedarray_info" target="_blank">napi_get_typedarray_info</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中获得某个TypedArray的各种属性。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_create_dataview" target="_blank">napi_create_dataview</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中创建一个DataView对象，可以访问和操作二进制数据。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_is_dataview" target="_blank">napi_is_dataview</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中判断给定的napi_value是否为ArkTS中的DataView对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><a href="https://nodejs.org/docs/latest-v18.x/api/n-api.html#napi_get_dataview_info" target="_blank">napi_get_dataview_info</a></td> <td class="cellrowborder" valign="top" width="50%">用于在Node-API模块中获得某个DataView的各种属性。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。具体使用见示例。</p> </div>  <div class="tiledSection"><h3 id="napi_create_array" class="firsth2">napi_create_array<i class="anchor-icon anchor-icon-link" anchorid="napi_create_array" tips="复制节点链接"></i></h3><p>用于在Node-API模块中创建一个ArkTS数组。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> INT_NUM_5 = <span class="hljs-number">5</span>; <span class="hljs-comment">// 数组长度</span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateArray</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建一个空数组</span></li><li>    napi_value jsArray = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_array</span>(env, &amp;jsArray);</li><li>    <span class="hljs-comment">// 将创建好的数组进行赋值</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i = <span class="hljs-number">0</span>; i &lt; INT_NUM_5; i++) {</li><li>        napi_value element;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, i, &amp;element);</li><li>        <span class="hljs-built_in">napi_set_element</span>(env, jsArray, i, element);</li><li>    }</li><li>    <span class="hljs-comment">// 返回已创建好的数组</span></li><li>    <span class="hljs-keyword">return</span> jsArray;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createArray</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>[];</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_array:%{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testNapi.<span class="hljs-title function_">createArray</span>()));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_array_with_length">napi_create_array_with_length<i class="anchor-icon anchor-icon-link" anchorid="napi_create_array_with_length" tips="复制节点链接"></i></h3><p>用于在Node-API模块中创建一个具有指定长度的ArkTS数组。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateArrayWithLength</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    napi_value jsArray = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取传递的数组长度</span></li><li>    <span class="hljs-type">int32_t</span> length = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, argv[<span class="hljs-number">0</span>], &amp;length);</li><li>    <span class="hljs-comment">// 使用napi_create_array_with_length创建指定长度的数组</span></li><li>    <span class="hljs-built_in">napi_create_array_with_length</span>(env, length, &amp;jsArray);</li><li>    <span class="hljs-comment">// 返回数组</span></li><li>    <span class="hljs-keyword">return</span> jsArray;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createArrayWithLength</span>: <span class="hljs-function">(<span class="hljs-params">length: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>[];</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> array = testNapi.<span class="hljs-title function_">createArrayWithLength</span>(<span class="hljs-number">6</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_array_with_length:%{public}d'</span>, array.<span class="hljs-property">length</span>);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_array_length">napi_get_array_length<i class="anchor-icon anchor-icon-link" anchorid="napi_get_array_length" tips="复制节点链接"></i></h3><p>获取给定array的长度。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetArrayLength</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    napi_value result;</li><li>    <span class="hljs-type">uint32_t</span> length;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 检查参数是否为数组</span></li><li>    <span class="hljs-type">bool</span> is_array;</li><li>    <span class="hljs-built_in">napi_is_array</span>(env, args[<span class="hljs-number">0</span>], &amp;is_array);</li><li>    <span class="hljs-keyword">if</span> (!is_array) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Argument must be an array"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-built_in">napi_get_array_length</span>(env, args[<span class="hljs-number">0</span>], &amp;length);</li><li>    <span class="hljs-comment">// 创建返回值</span></li><li>    <span class="hljs-built_in">napi_create_uint32</span>(env, length, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getArrayLength</span>: <span class="hljs-function">(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">any</span>&gt;</span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API get_array_length:%{public}d'</span>, testNapi.<span class="hljs-title function_">getArrayLength</span>(arr));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_is_array">napi_is_array<i class="anchor-icon anchor-icon-link" anchorid="napi_is_array" tips="复制节点链接"></i></h3><p>判断给定ArkTS值是否为数组。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsArray</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用napi_is_array接口判断给定入参是否为array数组</span></li><li>    <span class="hljs-type">bool</span> result;</li><li>    napi_status status;</li><li>    status = <span class="hljs-built_in">napi_is_array</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_is_array fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回</span></li><li>    napi_value returnValue;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>
</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isArray</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">Array</span>&lt;T&gt; | T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> value = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">1</span>);</li><li>  <span class="hljs-keyword">let</span> data = <span class="hljs-string">"123"</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_array: %{public}s'</span>, testNapi.<span class="hljs-property">isArray</span>&lt;<span class="hljs-built_in">number</span>&gt;(value));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_array: %{public}s'</span>, testNapi.<span class="hljs-property">isArray</span>&lt;<span class="hljs-built_in">string</span>&gt;(data));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_array error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_set_element">napi_set_element<i class="anchor-icon anchor-icon-link" anchorid="napi_set_element" tips="复制节点链接"></i></h3><p>用于在ArkTS数组中设置指定索引位置的元素。</p> <p>对于以索引值为键的object，可以使用napi_set_element来设置属性值。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-keyword">constexpr</span> <span class="hljs-type">int</span> INT_ARG_2 = <span class="hljs-number">2</span>; <span class="hljs-comment">// 入参索引</span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiSetElement</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">3</span>;</li><li>    napi_value args[<span class="hljs-number">3</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 检查第一个参数是否为数组</span></li><li>    <span class="hljs-type">bool</span> isArr = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-built_in">napi_is_array</span>(env, args[<span class="hljs-number">0</span>], &amp;isArr);</li><li>    <span class="hljs-keyword">if</span> (!isArr) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Argument should be an object of type array"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 获取要设置的元素索引</span></li><li>    <span class="hljs-type">double</span> index = <span class="hljs-number">0</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok || index &lt; <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"The index should be a non-negative number"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将传入的值设置到数组指定索引位置</span></li><li>    <span class="hljs-built_in">napi_set_element</span>(env, args[<span class="hljs-number">0</span>], <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint32_t</span>&gt;(index), args[INT_ARG_2]);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiSetElement</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;T&gt;, index: <span class="hljs-built_in">number</span>, value: T</span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> arr = [<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>];</li><li>  testNapi.<span class="hljs-property">napiSetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>&gt;(arr, <span class="hljs-number">1</span>, <span class="hljs-string">'newElement'</span>);</li><li>  testNapi.<span class="hljs-property">napiSetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span>&gt;(arr, <span class="hljs-number">2</span>, <span class="hljs-number">50</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_element arr: %{public}s'</span>, arr.<span class="hljs-title function_">toString</span>());</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_element arr[3]: %{public}s'</span>, arr[<span class="hljs-number">3</span>]);</li><li>  <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyObject</span> {</li><li>    <span class="hljs-attr">first</span>: <span class="hljs-built_in">number</span>;</li><li>    <span class="hljs-attr">second</span>: <span class="hljs-built_in">number</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">MyObject</span> = {</li><li>    <span class="hljs-attr">first</span>: <span class="hljs-number">1</span>,</li><li>    <span class="hljs-attr">second</span>: <span class="hljs-number">2</span></li><li>  };</li><li>  testNapi.<span class="hljs-property">napiSetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">4</span>, obj);</li><li>  <span class="hljs-keyword">let</span> objAsString = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(arr[<span class="hljs-number">4</span>]);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_element arr[4]: %{public}s'</span>, objAsString);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_set_element error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_element">napi_get_element<i class="anchor-icon anchor-icon-link" anchorid="napi_get_element" tips="复制节点链接"></i></h3><p>用于从ArkTS数组中获取请求索引位置的元素值。请求索引值应在数组的有效范围内，如果索引超出数组长度，函数会返回undefined。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiGetElement</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取请求元素的索引值</span></li><li>    <span class="hljs-type">uint32_t</span> index;</li><li>    <span class="hljs-built_in">napi_get_value_uint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 获取请求索引位置的元素值并存储在result中</span></li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_element</span>(env, args[<span class="hljs-number">0</span>], index, &amp;result);</li><li>
</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiGetElement</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;T&gt;, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-title class_">Object</span> | <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyObject</span> {</li><li>  <span class="hljs-attr">first</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">second</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">MyObject</span> = {</li><li>  <span class="hljs-attr">first</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-attr">second</span>: <span class="hljs-number">2</span></li><li>};</li><li><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">10</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-literal">null</span>, obj];</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[0]: %{public}d'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[1]: %{public}s'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">1</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[2]: %{public}s'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">2</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[3]: %{public}s'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">3</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[4]: %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testNapi.<span class="hljs-title function_">napiGetElement</span>(arr, <span class="hljs-number">4</span>)));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[null]: %{public}s'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span> | <span class="hljs-title class_">Object</span>&gt;(arr, <span class="hljs-number">5</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_has_element">napi_has_element<i class="anchor-icon anchor-icon-link" anchorid="napi_has_element" tips="复制节点链接"></i></h3><p>用于判断ArkTS数组是否具有指定索引的元素。如果索引超出了对象的有效范围，函数返回false，表示没有元素。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiHasElement</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要判断的元素的索引</span></li><li>    <span class="hljs-type">uint32_t</span> index;</li><li>    <span class="hljs-built_in">napi_get_value_uint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 判断指定索引位置的元素是否存在</span></li><li>    <span class="hljs-type">bool</span> hasElement = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-built_in">napi_has_element</span>(env, args[<span class="hljs-number">0</span>], index, &amp;hasElement);</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, hasElement, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiHasElement</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;T&gt;, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">10</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'world'</span>];</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_element arr[0]: %{public}s'</span>, testNapi.<span class="hljs-property">napiHasElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_element arr[7]: %{public}s'</span>, testNapi.<span class="hljs-property">napiHasElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">7</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_delete_element">napi_delete_element<i class="anchor-icon anchor-icon-link" anchorid="napi_delete_element" tips="复制节点链接"></i></h3><p>用于从ArkTS数组对象中删除请求索引的元素。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiDeleteElement</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取要删除的元素的索引</span></li><li>    <span class="hljs-type">uint32_t</span> index;</li><li>    <span class="hljs-built_in">napi_get_value_uint32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 尝试删除请求索引位置的元素</span></li><li>    <span class="hljs-type">bool</span> deleted = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-built_in">napi_delete_element</span>(env, args[<span class="hljs-number">0</span>], index, &amp;deleted);</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value result;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, deleted, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiDeleteElement</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;T&gt;, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 需要同时导入前文示例代码中的napiHasElement、napiGetElement接口</span></li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> arr = [<span class="hljs-number">10</span>, <span class="hljs-string">'hello'</span>, <span class="hljs-literal">null</span>, <span class="hljs-string">'world'</span>];</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_element arr[0]: %{public}s'</span>, testNapi.<span class="hljs-property">napiHasElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_delete_element arr[0]: %{public}s'</span>, testNapi.<span class="hljs-property">napiDeleteElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_has_element deleted arr[0]: %{public}s'</span>, testNapi.<span class="hljs-property">napiHasElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_element arr[0]: %{public}d'</span>, testNapi.<span class="hljs-property">napiGetElement</span>&lt;<span class="hljs-built_in">number</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">null</span>&gt;(arr, <span class="hljs-number">0</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_typedarray">napi_create_typedarray<i class="anchor-icon anchor-icon-link" anchorid="napi_create_typedarray" tips="复制节点链接"></i></h3><p>用于在Node-API模块中通过现有的ArrayBuffer创建指定类型的ArkTS TypedArray。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateTypedArray</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">int32_t</span> typeNum = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;typeNum);</li><li>    napi_typedarray_type arrayType;</li><li>    <span class="hljs-comment">// 用于存储每个元素的大小</span></li><li>    <span class="hljs-type">size_t</span> elementSize = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-comment">// 根据传递的类型值选择创建对应的类型数组</span></li><li>    arrayType = <span class="hljs-built_in">static_cast</span>&lt;napi_typedarray_type&gt;(typeNum);</li><li>    <span class="hljs-keyword">switch</span> (arrayType) {</li><li>    <span class="hljs-keyword">case</span> napi_int8_array:</li><li>    <span class="hljs-keyword">case</span> napi_uint8_array:</li><li>    <span class="hljs-keyword">case</span> napi_uint8_clamped_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int8_t</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_int16_array:</li><li>    <span class="hljs-keyword">case</span> napi_uint16_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int16_t</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_int32_array:</li><li>    <span class="hljs-keyword">case</span> napi_uint32_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int32_t</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_float32_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">float</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_float64_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">double</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_bigint64_array:</li><li>    <span class="hljs-keyword">case</span> napi_biguint64_array:</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int64_t</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">default</span>:</li><li>    <span class="hljs-comment">// 默认创建napi_int8_array类型</span></li><li>        arrayType = napi_int8_array;</li><li>        elementSize = <span class="hljs-built_in">sizeof</span>(<span class="hljs-type">int8_t</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">3</span>;</li><li>    napi_value arrayBuffer = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value typedArray = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">void</span> *data;</li><li>    <span class="hljs-comment">// 创建一个ArrayBuffer</span></li><li>    <span class="hljs-built_in">napi_create_arraybuffer</span>(env, length * elementSize, (<span class="hljs-type">void</span> **)&amp;data, &amp;arrayBuffer);</li><li>    <span class="hljs-comment">// 根据给定类型创建TypedArray</span></li><li>    <span class="hljs-built_in">napi_create_typedarray</span>(env, arrayType, length, arrayBuffer, <span class="hljs-number">0</span>, &amp;typedArray);</li><li>    <span class="hljs-keyword">return</span> typedArray;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-keyword">enum</span> <span class="hljs-title class_">TypedArrayTypes</span> {</li><li>  <span class="hljs-title class_">INT8</span>_ARRAY = <span class="hljs-number">0</span>,</li><li>  <span class="hljs-title class_">UINT8</span>_ARRAY,</li><li>  <span class="hljs-title class_">UINT8</span>_CLAMPED_ARRAY,</li><li>  <span class="hljs-title class_">INT16</span>_ARRAY,</li><li>  <span class="hljs-title class_">UINT16</span>_ARRAY,</li><li>  <span class="hljs-title class_">INT32</span>_ARRAY,</li><li>  <span class="hljs-title class_">UINT32</span>_ARRAY,</li><li>  <span class="hljs-title class_">FLOAT32</span>_ARRAY,</li><li>  <span class="hljs-title class_">FLOAT64</span>_ARRAY,</li><li>  <span class="hljs-title class_">BIGINT64</span>_ARRAY,</li><li>  <span class="hljs-title class_">BIGUINT64</span>_ARRAY,</li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createTypedArray</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params"><span class="hljs-keyword">type</span>: TypedArrayTypes</span>) =&gt;</span> T;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 传递要创建的类型值</span></li><li><span class="hljs-keyword">let</span> typedArray = testNapi.<span class="hljs-property">createTypedArray</span>&lt;<span class="hljs-title class_">Int8Array</span>&gt;(testNapi.<span class="hljs-property">TypedArrayTypes</span>[<span class="hljs-string">"INT8_ARRAY"</span>]);</li><li><span class="hljs-keyword">if</span> (typedArray <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Int8Array</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">' Node-API napi_create_typedarray: Int8Array'</span>);</li><li>}</li><li><span class="hljs-keyword">let</span> uint8Array = testNapi.<span class="hljs-property">createTypedArray</span>&lt;<span class="hljs-title class_">Uint8Array</span>&gt;(testNapi.<span class="hljs-property">TypedArrayTypes</span>[<span class="hljs-string">"UINT8_ARRAY"</span>]);</li><li><span class="hljs-keyword">if</span> (uint8Array <span class="hljs-keyword">instanceof</span> <span class="hljs-title class_">Uint8Array</span>) {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">' Node-API napi_create_typedarray: Uint8Array'</span>);</li><li>}</li></ol></pre></div></div> <p>需要对use-napi-process.md中的模块初始化部分进行修改，具体见如下：</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 定义的TypedArray类型供ArkTS侧使用，用于存放typedArrayTypes类型，使用示例见ArkTS侧的createTypedArray函数</span></li><li>    napi_value typedArrayTypes;</li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;typedArrayTypes);</li><li>    napi_value typeIndex;</li><li>    std::string typeKeys[] = {</li><li>        <span class="hljs-string">"INT8_ARRAY"</span>,   <span class="hljs-string">"UINT8_ARRAY"</span>,   <span class="hljs-string">"UINT8_CLAMPED_ARRAY"</span>, <span class="hljs-string">"INT16_ARRAY"</span>,      <span class="hljs-string">"UINT16_ARRAY"</span>,    <span class="hljs-string">"INT32_ARRAY"</span>,</li><li>        <span class="hljs-string">"UINT32_ARRAY"</span>, <span class="hljs-string">"FLOAT32_ARRAY"</span>, <span class="hljs-string">"FLOAT64_ARRAY"</span>,       <span class="hljs-string">"BIGINT64_ARRAY"</span>, <span class="hljs-string">"BIGUINT64_ARRAY"</span>,</li><li>    };</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int32_t</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-built_in">sizeof</span>(typeKeys) / <span class="hljs-built_in">sizeof</span>(typeKeys[<span class="hljs-number">0</span>]); i++) {</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, i, &amp;typeIndex);</li><li>        <span class="hljs-built_in">napi_set_named_property</span>(env, typedArrayTypes, typeKeys[i].<span class="hljs-built_in">c_str</span>(), typeIndex);</li><li>    }</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"createTypedArray"</span>, <span class="hljs-literal">nullptr</span>, CreateTypedArray, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"TypedArrayTypes"</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, typedArrayTypes, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_is_typedarray">napi_is_typedarray<i class="anchor-icon anchor-icon-link" anchorid="napi_is_typedarray" tips="复制节点链接"></i></h3><p>用于在Node-API模块中判断ArkTS侧给定的napi_value是否为TypedArray对象。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsTypedarray</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用napi_is_typedarray接口判断给定入参类型是否为TypedArray。</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>        napi_status status;</li><li>    status = <span class="hljs-built_in">napi_is_typedarray</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_is_typedarray fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回。</span></li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>
</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isTypedarray</span>: <span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> value = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]);</li><li>  <span class="hljs-keyword">let</span> data = <span class="hljs-string">"123"</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_typedarray: %{public}s'</span>, testNapi.<span class="hljs-title function_">isTypedarray</span>(value));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_typedarray: %{public}s'</span>, testNapi.<span class="hljs-title function_">isTypedarray</span>(data));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_typedarray error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_typedarray_info">napi_get_typedarray_info<i class="anchor-icon anchor-icon-link" anchorid="napi_get_typedarray_info" tips="复制节点链接"></i></h3><p>获取给定TypedArray的各种属性。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetTypedarrayInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数，第一个参数为需要获得的信息的TypedArray类型数据，第二个参数为需要获得的信息类型的枚举值</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将第二个参数转为int32类型便于比较</span></li><li>    <span class="hljs-type">int32_t</span> infoTypeParam;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">1</span>], &amp;infoTypeParam);</li><li>    <span class="hljs-comment">// 定义枚举类型与ArkTS侧枚举类型InfoType顺序含义一致</span></li><li>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> { INFO_TYPE = <span class="hljs-number">1</span>, INFO_LENGTH, INFO_ARRAY_BUFFER, INFO_BYTE_OFFSET };</li><li>    <span class="hljs-type">void</span> *data;</li><li>    napi_typedarray_type type;</li><li>    <span class="hljs-type">size_t</span> byteOffset, length;</li><li>    napi_value arraybuffer;</li><li>    <span class="hljs-comment">// 调用接口napi_get_typedarray_info获得TypedArray类型数据的信息</span></li><li>    <span class="hljs-built_in">napi_get_typedarray_info</span>(env, args[<span class="hljs-number">0</span>], &amp;type, &amp;length, &amp;data, &amp;arraybuffer, &amp;byteOffset);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 根据属性名，返回TypedArray对应的属性值</span></li><li>    <span class="hljs-keyword">switch</span> (infoTypeParam) {</li><li>    <span class="hljs-keyword">case</span> INFO_TYPE:</li><li>        <span class="hljs-comment">// 如果传入的参数是int8类型的TypedArray数据，它的类型（type）为napi_int8_array</span></li><li>        napi_value int8_type;</li><li>        <span class="hljs-built_in">napi_get_boolean</span>(env, type == napi_int8_array, &amp;int8_type);</li><li>        result = int8_type;</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> INFO_LENGTH:</li><li>        <span class="hljs-comment">// TypedArray中元素的字节长度</span></li><li>        napi_value napiLength;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, length, &amp;napiLength);</li><li>        result = napiLength;</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> INFO_BYTE_OFFSET:</li><li>        <span class="hljs-comment">// TypedArray数组的第一个元素所在的基础原生数组中的字节偏移量</span></li><li>        napi_value napiByteOffset;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, byteOffset, &amp;napiByteOffset);</li><li>        result = napiByteOffset;</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> INFO_ARRAY_BUFFER:</li><li>        <span class="hljs-comment">// TypedArray下的ArrayBuffer</span></li><li>        result = arraybuffer;</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">default</span>:</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"infoType is not the InfoType"</span>);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getTypedarrayInfo</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">typeArray: T, infoType: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">ArrayBuffer</span> | <span class="hljs-built_in">number</span> | <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 传入TypedArray类型数据。TypedArray是一种用来描述二进制数据的类数组数据视图，没有直接构造器，可以用其子类构造类数组</span></li><li><span class="hljs-comment">// TypedArray的子类有: Int8Array Uint8Array Uint8ClampedArray Int16Array Int32Array等</span></li><li><span class="hljs-keyword">let</span> int8Array = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>([<span class="hljs-number">15</span>, <span class="hljs-number">7</span>]);</li><li><span class="hljs-comment">// 定义枚举类型 这些都是TypedArray的属性</span></li><li><span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> {</li><li>    <span class="hljs-variable constant_">TYPE</span> = <span class="hljs-number">1</span>, <span class="hljs-comment">// 传入的TypedArray的类型</span></li><li>    <span class="hljs-variable constant_">LENGTH</span> = <span class="hljs-number">2</span>, <span class="hljs-comment">// 传入的TypedArray的长度</span></li><li>    <span class="hljs-variable constant_">ARRAY_BUFFER</span> = <span class="hljs-number">3</span>, <span class="hljs-comment">// TypedArray下的ArrayBuffer</span></li><li>    <span class="hljs-variable constant_">BYTE_OFFSET</span> = <span class="hljs-number">4</span> <span class="hljs-comment">// 数组的第一个元素所在的基础原生数组中的字节偏移量</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> arrBuffer = testNapi.<span class="hljs-title function_">getTypedarrayInfo</span>(int8Array, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">ARRAY_BUFFER</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>;</li><li>  <span class="hljs-comment">// 将arraybuffer转为数组</span></li><li>  <span class="hljs-keyword">let</span> arr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(arrBuffer));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_typedarray_info_arraybuffer: %{public}s'</span>, arr.<span class="hljs-title function_">toString</span>());</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_typedarray_info_isIn8Array: %{public}s'</span>, testNapi.<span class="hljs-title function_">getTypedarrayInfo</span>(int8Array, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">TYPE</span>).<span class="hljs-title function_">toString</span>());</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_typedarray_info_length: %{public}d'</span>, testNapi.<span class="hljs-title function_">getTypedarrayInfo</span>(int8Array, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">LENGTH</span>));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_typedarray_info_byte_offset: %{public}d'</span>, testNapi.<span class="hljs-title function_">getTypedarrayInfo</span>(int8Array, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">BYTE_OFFSET</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_typedarray_info error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_dataview">napi_create_dataview<i class="anchor-icon anchor-icon-link" anchorid="napi_create_dataview" tips="复制节点链接"></i></h3><p>创建dataview对象，便于访问和操作二进制数据，需要提供一个指向二进制数据的缓冲区，并指定要包含的字节数。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateDataView</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    napi_value arraybuffer = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// DataView的字节长度</span></li><li>    <span class="hljs-type">size_t</span> byteLength = <span class="hljs-number">12</span>;</li><li>    <span class="hljs-comment">// 字节偏移量</span></li><li>    <span class="hljs-type">size_t</span> byteOffset = <span class="hljs-number">4</span>;</li><li>    <span class="hljs-comment">// 获取回调函数的参数信息</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将参数转换为对象类型</span></li><li>    <span class="hljs-built_in">napi_coerce_to_object</span>(env, args[<span class="hljs-number">0</span>], &amp;arraybuffer);</li><li>    <span class="hljs-comment">// 创建一个数据视图对象，并指定字节长度和字节偏移量</span></li><li>    napi_status status = <span class="hljs-built_in">napi_create_dataview</span>(env, byteLength, arraybuffer, byteOffset, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-comment">// 抛出创建DataView内容失败的错误</span></li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Failed to create DataView"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 获取DataView的指针和长度信息</span></li><li>    <span class="hljs-type">uint8_t</span> *data = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">size_t</span> length = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_dataview_info</span>(env, result, &amp;length, (<span class="hljs-type">void</span> **)&amp;data, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 为DataView赋值</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">size_t</span> i = <span class="hljs-number">0</span>; i &lt; length; i++) {</li><li>        data[i] = <span class="hljs-built_in">static_cast</span>&lt;<span class="hljs-type">uint8_t</span>&gt;(i + <span class="hljs-number">1</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createDataView</span>: <span class="hljs-function">(<span class="hljs-params">arraybuffer:<span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> <span class="hljs-title class_">DataView</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>);</li><li><span class="hljs-keyword">const</span> dataView = testNapi.<span class="hljs-title function_">createDataView</span>(arrayBuffer) <span class="hljs-keyword">as</span> <span class="hljs-title class_">DataView</span>;</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API dataView：%{public}d'</span>, dataView.<span class="hljs-property">byteLength</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API dataView第一个数据：%{public}d'</span>, dataView.<span class="hljs-title function_">getInt8</span>(<span class="hljs-number">0</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_is_dataview">napi_is_dataview<i class="anchor-icon anchor-icon-link" anchorid="napi_is_dataview" tips="复制节点链接"></i></h3><p>用于在Node-API模块中判断ArkTS侧给定的napi_value是否为DataView。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsDataView</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 调用napi_is_dataview接口判断给定入参是否为DataView数据。</span></li><li>    <span class="hljs-type">bool</span> result;</li><li>    napi_status status;</li><li>    status = <span class="hljs-built_in">napi_is_dataview</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_is_dataview fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回。</span></li><li>    napi_value returnValue;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>
</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isDataView</span>: <span class="hljs-function">(<span class="hljs-params">date: <span class="hljs-built_in">DataView</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(<span class="hljs-number">16</span>);</li><li>  <span class="hljs-keyword">let</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(buffer);</li><li>  <span class="hljs-keyword">let</span> data = <span class="hljs-string">"123"</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_dataview: %{public}s'</span>, testNapi.<span class="hljs-title function_">isDataView</span>(dataView));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_dataview: %{public}s'</span>, testNapi.<span class="hljs-title function_">isDataView</span>(data));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_dataview error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_dataview_info">napi_get_dataview_info<i class="anchor-icon anchor-icon-link" anchorid="napi_get_dataview_info" tips="复制节点链接"></i></h3><p>获取给定DataView的各种属性。</p> <p>cpp部分代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetDataViewInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传入的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将第二个参数转为int32类型的数字</span></li><li>    <span class="hljs-type">int32_t</span> infoType;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">1</span>], &amp;infoType);</li><li>    <span class="hljs-type">size_t</span> byteLength;</li><li>    <span class="hljs-type">void</span> *data;</li><li>    napi_value arrayBuffer;</li><li>    <span class="hljs-type">size_t</span> byteOffset;</li><li>    <span class="hljs-comment">// 定义枚举类型与ArkTS侧枚举类型InfoType顺序含义一致</span></li><li>    <span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> { BYTE_LENGTH = <span class="hljs-number">0</span>, ARRAY_BUFFER, BYTE_OFFSET };</li><li>    <span class="hljs-comment">// 获取dataview信息</span></li><li>    <span class="hljs-built_in">napi_get_dataview_info</span>(env, args[<span class="hljs-number">0</span>], &amp;byteLength, &amp;data, &amp;arrayBuffer, &amp;byteOffset);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">switch</span> (infoType) {</li><li>        <span class="hljs-keyword">case</span> BYTE_LENGTH:</li><li>            <span class="hljs-comment">// 返回查询DataView的字节数</span></li><li>            napi_value napiByteLength;</li><li>            <span class="hljs-built_in">napi_create_int32</span>(env, byteLength, &amp;napiByteLength);</li><li>            result = napiByteLength;</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> ARRAY_BUFFER:</li><li>            <span class="hljs-comment">// 返回查询DataView的arraybuffer</span></li><li>            result = arrayBuffer;</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> BYTE_OFFSET:</li><li>            <span class="hljs-comment">// 返回查询DataView的偏移字节量</span></li><li>            napi_value napiByteOffset;</li><li>            <span class="hljs-built_in">napi_create_int32</span>(env, byteOffset, &amp;napiByteOffset);</li><li>            result = napiByteOffset;</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">default</span>:</li><li>            <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"infoType is not the InfoType"</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getDataViewInfo</span>: <span class="hljs-function">(<span class="hljs-params">dataView: <span class="hljs-built_in">DataView</span>, infoType: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-title class_">ArrayBuffer</span> | <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建一个ArrayBuffer</span></li><li><span class="hljs-keyword">let</span> arrayBuffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>([<span class="hljs-number">2</span>, <span class="hljs-number">5</span>]).<span class="hljs-property">buffer</span>;</li><li><span class="hljs-comment">// 使用arrayBuffer创建一个dataView</span></li><li><span class="hljs-keyword">let</span> dataView = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataView</span>(arrayBuffer);</li><li><span class="hljs-comment">// 定义一个枚举类型</span></li><li><span class="hljs-keyword">enum</span> <span class="hljs-title class_">InfoType</span> {</li><li>    <span class="hljs-variable constant_">BYTE_LENGTH</span> = <span class="hljs-number">0</span>,</li><li>    <span class="hljs-variable constant_">ARRAY_BUFFER</span> = <span class="hljs-number">1</span>,</li><li>    <span class="hljs-variable constant_">BYTE_OFFSET</span> = <span class="hljs-number">2</span>,</li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-comment">// 传入DataView类型参数查询DataView的字节数</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_dataview_info_bytelength %{public}d'</span>, testNapi.<span class="hljs-title function_">getDataViewInfo</span>(dataView, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">BYTE_LENGTH</span>));</li><li>  <span class="hljs-comment">// 传入DataView类型参数查询DataView的ArrayBuffer</span></li><li>  <span class="hljs-keyword">let</span> arrBuffer = testNapi.<span class="hljs-title function_">getDataViewInfo</span>(dataView, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">ARRAY_BUFFER</span>) <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>;</li><li>  <span class="hljs-comment">// 将arraybuffer转为数组</span></li><li>  <span class="hljs-keyword">let</span> arr = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Int8Array</span>(arrBuffer));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_dataview_info_arraybuffer %{public}s'</span>, arr.<span class="hljs-title function_">toString</span>());</li><li>  <span class="hljs-comment">// 传入DataView类型参数查询DataView开始投影的数据缓冲区中的字节偏移量</span></li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_dataview_info_byteoffset %{public}d'</span>, testNapi.<span class="hljs-title function_">getDataViewInfo</span>(dataView, <span class="hljs-title class_">InfoType</span>.<span class="hljs-property">BYTE_OFFSET</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_dataview_info error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-mbh-c106="" class="highlight-div"><div _ngcontent-mbh-c106="" class="highlight-div-header"><div _ngcontent-mbh-c106="" class="highlight-div-header-left"><div _ngcontent-mbh-c106="" class="handle-button expand-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-mbh-c106="" class="highlight-div-header-right"><div _ngcontent-mbh-c106="" class="handle-button ai-button"></div><div _ngcontent-mbh-c106="" class="handle-button line-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-mbh-c106="" class="handle-button theme-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-mbh-c106="" class="handle-button copy-button"><div _ngcontent-mbh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-mbh-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>