<h1 _ngcontent-qim-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口进行object相关开发"> 使用Node-API接口进行object相关开发 </h1>

<div _ngcontent-qim-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>Node-API提供了相关接口对object进行基本操作，例如创建对象、获取原型、冻结和密封对象，检查对象的类型等。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>在Node-API接口开发中，经常需要定义和操作对象。例如，创建一个API接口，该接口接受一个对象作为输入参数，对该对象执行某些操作，并返回一个结果对象。在这个过程中，需要确保接口的定义清晰、规范，并且与对象的属性和方法相兼容。</p> <ul><li><strong>接口（API）</strong>：接口定义了组件之间的交互协议，包括输入参数、输出结果以及可能的错误处理。通过接口，组件可以相互调用和交换数据，而无需了解对方的内部实现细节。</li><li><strong>对象（Object）</strong>：在ArkTS中，对象是一种复合数据类型，允许存储多个不同类型的值作为一个单独的实体。对象是属性和方法的集合。属性是与对象相关联的值，而方法则是对象可以执行的操作。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下Node-API接口主要用于操作和管理ArkTS对象，使用场景介绍：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_get_prototype</td> <td class="cellrowborder" valign="top" width="50%">当需要获取一个ArkTS对象的原型时，可以使用这个接口。通过这个接口可以在C/C++中获取到这个原型对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_object</td> <td class="cellrowborder" valign="top" width="50%">在Node-API模块中创建一个默认的ArkTS对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_object_freeze</td> <td class="cellrowborder" valign="top" width="50%">当需要确保一个对象不会被修改时（immutable），可以使用这个接口来冻结该对象，使其属性不可更改。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_object_seal</td> <td class="cellrowborder" valign="top" width="50%">类似于napi_object_freeze，napi_object_seal用于密封给定的对象，使其属性不可添加或删除，但可以修改属性的值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_typeof</td> <td class="cellrowborder" valign="top" width="50%">在处理传入的ArkTS值时，可以使用这个接口来获取其类型，以便进行相应的处理。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_instanceof</td> <td class="cellrowborder" valign="top" width="50%">当需要在Node-API模块中确定一个对象是否为特定构造函数的实例时，可以使用这个接口。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_type_tag_object</td> <td class="cellrowborder" valign="top" width="50%">可以将指针的特定值与ArkTS对象关联起来，这对于一些自定义的内部对象标记非常有用。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_check_object_type_tag</td> <td class="cellrowborder" valign="top" width="50%">使用此接口可以检查给定的对象上是否关联了特定类型的标记。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_symbol</td> <td class="cellrowborder" valign="top" width="50%">创建一个ArkTS Symbol对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external</td> <td class="cellrowborder" valign="top" width="50%">用于创建一个ArkTS外部对象，该对象可以用于将C/C++中的自定义数据结构或对象传递到ArkTS中，并且可以在ArkTS中访问其属性和方法。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_external</td> <td class="cellrowborder" valign="top" width="50%">用于获得napi_create_external创建的绑定了外部数据的ArkTS值，此函数可以在ArkTS和C/C++之间传递数据。</td> </tr>  </tbody></table></div> </div> <p>这些接口为开发人员提供了在Node-API模块中处理ArkTS对象的灵活性和功能性，可以实现从创建对象、管理对象属性和类型检查等多种操作。</p> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="napi_get_prototype" class="firsth2">napi_get_prototype<i class="anchor-icon anchor-icon-link" anchorid="napi_get_prototype" tips="复制节点链接"></i></h3><p>可以获得给定ArkTS对象的prototype。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetPrototype</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 获取此对象的原型对象，将结果返回到napi_value类型的变量result中</span></li><li>    <span class="hljs-built_in">napi_get_prototype</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getPrototype</span>: <span class="hljs-function">(<span class="hljs-params"><span class="hljs-built_in">object</span>: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-title class_">Object</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 定义一个类</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-comment">// 属性</span></li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-comment">// 构造函数</span></li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>  }</li><li>}</li><li><span class="hljs-comment">// 创建类的实例</span></li><li><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">30</span>);</li><li><span class="hljs-comment">// 传入实例对象，获取该对象的原型</span></li><li><span class="hljs-keyword">let</span> applePrototype = testNapi.<span class="hljs-title function_">getPrototype</span>(person);</li><li><span class="hljs-comment">// 判断通过testNapi.getPrototype()函数获取到的原型是不是apple的原型</span></li><li><span class="hljs-comment">// 在DevEco Studio 4.1及以后的版本中，由于ArkTS没有原型的概念，</span></li><li><span class="hljs-comment">// 因此尝试进行原型赋值或相关操作时，</span></li><li><span class="hljs-comment">// 将会触发错误提示'Prototype assignment is not supported (arkts-no-prototype-assignment)'，</span></li><li><span class="hljs-comment">// 以下代码需在ts文件中执行</span></li><li><span class="hljs-keyword">if</span> (applePrototype === <span class="hljs-title class_">Person</span>.<span class="hljs-property"><span class="hljs-keyword">prototype</span></span>) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_prototype_success'</span>);</li><li>} <span class="hljs-keyword">else</span> {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_prototype_fail'</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_object">napi_create_object<i class="anchor-icon anchor-icon-link" anchorid="napi_create_object" tips="复制节点链接"></i></h3><p>用于在Node-API模块中创建一个空的ArkTS对象。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function">napi_value <span class="hljs-title">NewObject</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value object = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 创建一个空对象</span></li><li>    <span class="hljs-built_in">napi_create_object</span>(env, &amp;object);</li><li>    <span class="hljs-comment">// 设置对象的属性</span></li><li>    napi_value name = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 设置属性名为"name"</span></li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"name"</span>, NAPI_AUTO_LENGTH, &amp;name);</li><li>    napi_value value = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 设置属性值为"Hello from Node-API!"</span></li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Hello from Node-API!"</span>, NAPI_AUTO_LENGTH, &amp;value);</li><li>    <span class="hljs-comment">// 将属性设置到对象上</span></li><li>    <span class="hljs-built_in">napi_set_property</span>(env, object, name, value);</li><li>    <span class="hljs-keyword">return</span> object;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createObject</span>: <span class="hljs-function">() =&gt;</span> { <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> };</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">const</span> myObject = testNapi.<span class="hljs-title function_">createObject</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_object: %{public}s'</span>, myObject.<span class="hljs-property">name</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_object errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_object_freeze">napi_object_freeze<i class="anchor-icon anchor-icon-link" anchorid="napi_object_freeze" tips="复制节点链接"></i></h3><p>用于冻结给定的ArkTS对象。冻结对象后，无法再向对象添加新的属性或方法，也无法修改已有属性或方法的值。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ObjectFreeze</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接受一个ArkTS侧传入的object</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 调用接口napi_object_freeze将传入的object冻结</span></li><li>    napi_value objFreeze = argv[<span class="hljs-number">0</span>];</li><li>    napi_status status = <span class="hljs-built_in">napi_object_freeze</span>(env, objFreeze);</li><li>    <span class="hljs-keyword">if</span> (status == napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Node-API napi_object_freeze success"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 将冻结后的object传回ArkTS侧</span></li><li>    <span class="hljs-keyword">return</span> objFreeze;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">objectFreeze</span>: <span class="hljs-function">(<span class="hljs-params">objFreeze: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-title class_">Obj</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = {<span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span>};</li><li>  <span class="hljs-keyword">let</span> objFreeze = testNapi.<span class="hljs-title function_">objectFreeze</span>(obj);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_freeze: %{public}s'</span>, (objFreeze.<span class="hljs-property">data</span> = <span class="hljs-number">1</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_freeze error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_object_seal">napi_object_seal<i class="anchor-icon anchor-icon-link" anchorid="napi_object_seal" tips="复制节点链接"></i></h3><p>封闭一个对象后，无法向其添加新的属性，也无法删除或修改现有属性的可配置性。但是，可以继续修改已有属性的值。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ObjectSeal</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接受一个ArkTS侧传入的object</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用接口napi_object_seal将传入的object封闭，使其无法添加新的属性</span></li><li>    napi_value objSeal = argv[<span class="hljs-number">0</span>];</li><li>    napi_status status = <span class="hljs-built_in">napi_object_seal</span>(env, objSeal);</li><li>    <span class="hljs-keyword">if</span> (status == napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Node-API napi_object_seal success"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_object_seal failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将封闭后的object传回ArkTS侧</span></li><li>    <span class="hljs-keyword">return</span> objSeal;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span></li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span></li><li>  <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span></li><li>}</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> objectSeal : <span class="hljs-function">(<span class="hljs-params">objSeal: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-title class_">Obj</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>    <span class="hljs-comment">// 可选属性</span></li><li>    address?: <span class="hljs-built_in">number</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span>};</li><li>  <span class="hljs-keyword">let</span> objSeal = testNapi.<span class="hljs-title function_">objectSeal</span>(obj);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_seal: %{public}s'</span>, objSeal.<span class="hljs-property">message</span>);</li><li>  objSeal.<span class="hljs-property">data</span> = <span class="hljs-number">1</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_seal: %{public}d'</span>, objSeal.<span class="hljs-property">data</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_seal: %{public}d'</span>, (objSeal.<span class="hljs-property">id</span> = <span class="hljs-number">1</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_object_seal error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_typeof">napi_typeof<i class="anchor-icon anchor-icon-link" anchorid="napi_typeof" tips="复制节点链接"></i></h3><p>这个接口用于获取给定ArkTS value的ArkTS Type。</p> <p>**注：**napi_typeof可以判断的类型包含：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.4.1.2.1.1" valign="top" width="100%">类型</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="100%">undefined</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">null</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">boolean</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">number</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">string</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">object</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">function</td> </tr> <tr><td class="cellrowborder" valign="top" width="100%">bigint</td> </tr>  </tbody></table></div> </div> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiTypeOf</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接受一个入参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 调用napi_typeof判断传入ArkTS参数类型</span></li><li>    napi_valuetype valueType;</li><li>    napi_status status = <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueType);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_typeof fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回。</span></li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">switch</span>(valueType) {</li><li>    <span class="hljs-keyword">case</span> napi_undefined:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_undefined"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_null:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_null"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_boolean:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_boolean"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_number:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_number"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_string:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_string"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_object:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_object"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_function:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_function"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">case</span> napi_bigint:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"Input type is napi_bigint"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>        <span class="hljs-keyword">break</span>;</li><li>    <span class="hljs-keyword">default</span>:</li><li>        <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"unknown"</span>, NAPI_AUTO_LENGTH, &amp;returnValue);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> napiTypeOf : &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">value: T</span>) =&gt;</span> <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">varUndefined</span>: <span class="hljs-literal">undefined</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varUndefined));</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">varNull</span>: <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varNull));</li><li>  <span class="hljs-keyword">let</span> varTrue= <span class="hljs-literal">true</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varTrue));</li><li>  <span class="hljs-keyword">let</span> varNum = <span class="hljs-number">1</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varNum));</li><li>  <span class="hljs-keyword">let</span> varString = <span class="hljs-string">"str"</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varString));</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">id</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">varObject</span>: <span class="hljs-title class_">Obj</span> = {<span class="hljs-attr">id</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">name</span>: <span class="hljs-string">"LiLei"</span>};</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varObject));</li><li>  <span class="hljs-keyword">const</span> mulNum = (<span class="hljs-attr">a</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">b</span>: <span class="hljs-built_in">number</span>): <span class="hljs-function"><span class="hljs-params">number</span> =&gt;</span> a * b;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(mulNum));</li><li>  <span class="hljs-keyword">let</span> varBigint = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"1234567890123456789012345678901234567890"</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiTypeOf</span>(varBigint));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_typeof error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_instanceof">napi_instanceof<i class="anchor-icon anchor-icon-link" anchorid="napi_instanceof" tips="复制节点链接"></i></h3><p>用于检查一个对象是否是指定构造函数的实例。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiInstanceOf</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接受两个入参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用napi_instanceof接口判断给定object是否为给定constructor的实例</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">true</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_instanceof</span>(env, args[<span class="hljs-number">0</span>], args[<span class="hljs-number">1</span>], &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"Node-API napi_instanceof fail"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将结果转成napi_value类型返回</span></li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>
</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiInstanceOf</span>: <span class="hljs-function">(<span class="hljs-params">date: <span class="hljs-built_in">Object</span>, construct: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>    <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>    <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>
</li><li>    <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span></span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>    }</li><li>  }</li><li>  <span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>(<span class="hljs-string">"Alice"</span>, <span class="hljs-number">30</span>);</li><li>  <span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>    <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>    <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">obj</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span>};</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_instanceof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiInstanceOf</span>(person, <span class="hljs-title class_">Person</span>));</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_instanceof: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiInstanceOf</span>(obj, <span class="hljs-title class_">Person</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_instanceof error: %{public}s'</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_type_tag_object">napi_type_tag_object<i class="anchor-icon anchor-icon-link" anchorid="napi_type_tag_object" tips="复制节点链接"></i></h3><p>使用类型标签type_tag来标记ArkTS对象，后续可以更精确地识别ArkTS对象。</p> <p>ArkTS版本中，napi_type_tag_object接口没有使用private symbol，导致type_tag有被改写的风险，开发者应避免在关键安全场景中使用该接口。</p> </div>  <div class="tiledSection"><h3 id="napi_check_object_type_tag">napi_check_object_type_tag<i class="anchor-icon anchor-icon-link" anchorid="napi_check_object_type_tag" tips="复制节点链接"></i></h3><p>验证一个ArkTS对象是否带有特定类型标签。</p> <p>类型标签提供了一种在Node-API模块和ArkTS对象之间建立强类型关联的机制，使得原生代码能够更准确地识别和处理特定的ArkTS对象。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">define</span> NUMBERINT_FOUR 4</span></li><li><span class="hljs-comment">// 定义一个静态常量napi_type_tag数组存储类型标签</span></li><li><span class="hljs-type">static</span> <span class="hljs-type">const</span> napi_type_tag TagsData[NUMBERINT_FOUR] = {</li><li>    {<span class="hljs-number">0x9e4b2449547061b3</span>, <span class="hljs-number">0x33999f8a6516c499</span>},</li><li>    {<span class="hljs-number">0x1d55a794c53a726d</span>, <span class="hljs-number">0x43633f509f9c944e</span>},</li><li>    <span class="hljs-comment">// 用于表示无标签或默认标签</span></li><li>    {<span class="hljs-number">0</span>, <span class="hljs-number">0</span>},</li><li>    {<span class="hljs-number">0x6a971439f5b2e5d7</span>, <span class="hljs-number">0x531dc28a7e5317c0</span>},</li><li>};</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">SetTypeTagToObject</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取函数调用信息和参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取索引数字转换为napi_value</span></li><li>    <span class="hljs-type">int32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 给参数（对象）设置类型标签</span></li><li>    napi_status status = <span class="hljs-built_in">napi_type_tag_object</span>(env, args[<span class="hljs-number">0</span>], &amp;TagsData[index]);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-string">"Reconnect error"</span>, <span class="hljs-string">"napi_type_tag_object failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, <span class="hljs-literal">true</span>, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CheckObjectTypeTag</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取函数调用信息和参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取索引数字转换为napi_value</span></li><li>    <span class="hljs-type">int32_t</span> index = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">1</span>], &amp;index);</li><li>    <span class="hljs-comment">// 检查对象的类型标签</span></li><li>    <span class="hljs-type">bool</span> checkResult = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-built_in">napi_check_object_type_tag</span>(env, args[<span class="hljs-number">0</span>], &amp;TagsData[index], &amp;checkResult);</li><li>    <span class="hljs-comment">// 将bool结果转换为napi_value并返回</span></li><li>    napi_value checked = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, checkResult, &amp;checked);</li><li>
</li><li>    <span class="hljs-keyword">return</span> checked;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">setTypeTagToObject</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">checkObjectTypeTag</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Obj</span> {</li><li>  <span class="hljs-attr">data</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">objA</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"hello world"</span>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">objB</span>: <span class="hljs-title class_">Obj</span> = { <span class="hljs-attr">data</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">message</span>: <span class="hljs-string">"typeTag"</span>};</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_type_tag_object objA -&gt; 0: %{public}s'</span>, testNapi.<span class="hljs-title function_">setTypeTagToObject</span>(objA, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_type_tag_object objB -&gt; 0: %{public}s'</span>, testNapi.<span class="hljs-title function_">setTypeTagToObject</span>(objB, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_check_object_type_tag objA -&gt; 0: %{public}s'</span>, testNapi.<span class="hljs-title function_">checkObjectTypeTag</span>(objA, <span class="hljs-number">0</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_check_object_type_tag objB -&gt; 1: %{public}s'</span>, testNapi.<span class="hljs-title function_">checkObjectTypeTag</span>(objB, <span class="hljs-number">1</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_external">napi_create_external<i class="anchor-icon anchor-icon-link" anchorid="napi_create_external" tips="复制节点链接"></i></h3><p>创建自定义的C/C++对象并将其公开给ArkTS代码。这种情况下，我们可以使用napi_create_external来创建一个包含指向自定义对象的指针的Node-API值，以便让ArkTS代码能够访问和操作该对象。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstdlib&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 用于释放外部数据的回调函数</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">finalizeCallback</span><span class="hljs-params">(napi_env env, <span class="hljs-type">void</span> *data, <span class="hljs-type">void</span> *hint)</span> </span>{</li><li>    <span class="hljs-comment">// 释放外部数据</span></li><li>    <span class="hljs-built_in">free</span>(data);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetExternalType</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取参数的数据类型</span></li><li>    napi_valuetype valueType;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, args[<span class="hljs-number">0</span>], &amp;valueType);</li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (valueType == napi_external) {</li><li>        <span class="hljs-comment">// 如果数据类型是napi_external,则返回true</span></li><li>        <span class="hljs-built_in">napi_get_boolean</span>(env, <span class="hljs-literal">true</span>, &amp;returnValue);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">napi_get_boolean</span>(env, <span class="hljs-literal">false</span>, &amp;returnValue);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateExternal</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 设置外部数据大小为10</span></li><li>    <span class="hljs-type">const</span> <span class="hljs-type">size_t</span> dataSize = <span class="hljs-number">10</span>;</li><li>    <span class="hljs-comment">// 分配外部数据</span></li><li>    <span class="hljs-type">void</span> *data = <span class="hljs-built_in">malloc</span>(dataSize);</li><li>    <span class="hljs-keyword">if</span> (data == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"malloc failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 初始化外部数据</span></li><li>    <span class="hljs-built_in">memset</span>(data, <span class="hljs-number">0</span>, dataSize);</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 返回带有外部数据的对象</span></li><li>    napi_status status = <span class="hljs-built_in">napi_create_external</span>(env, data, finalizeCallback, <span class="hljs-literal">nullptr</span>, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">" Node-API Failed to create external data"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createExternal</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getExternalType</span>: <span class="hljs-function">(<span class="hljs-params">externalData: <span class="hljs-built_in">Object</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> externalData = testNapi.<span class="hljs-title function_">createExternal</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_external:%{public}s'</span>, testNapi.<span class="hljs-title function_">getExternalType</span>(externalData));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_external">napi_get_value_external<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_external" tips="复制节点链接"></i></h3><p>napi_create_external可以创建包装自定义的C/C++对象并将其公开给ArkTS代码，而napi_get_value_external就是用来获得napi_create_external所创建的外部对象的。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-type">static</span> <span class="hljs-type">int</span> external = <span class="hljs-number">5</span>;</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueExternal</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 创建外部数据</span></li><li>    <span class="hljs-type">int</span>* data = &amp;external;</li><li>    napi_value setExternal = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_external</span>(env, data, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;setExternal);</li><li>    <span class="hljs-comment">// 获得外部数据的值</span></li><li>    <span class="hljs-type">void</span> *getExternal;</li><li>    <span class="hljs-built_in">napi_get_value_external</span>(env, setExternal, &amp;getExternal);</li><li>    <span class="hljs-comment">// 返回获得到的外部数据</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, *(<span class="hljs-type">int</span> *)getExternal, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueExternal</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_external:%{public}d'</span>, testNapi.<span class="hljs-title function_">getValueExternal</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_symbol">napi_create_symbol<i class="anchor-icon anchor-icon-link" anchorid="napi_create_symbol" tips="复制节点链接"></i></h3><p>用于创建一个新的Symbol。Symbol是一种特殊的数据类型，用于表示唯一的标识符。与字符串或数字不同，符号的值是唯一的，即使两个符号具有相同的描述，它们也是不相等的。符号通常用作对象属性的键，以确保属性的唯一性。</p> <p>cpp部分代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateSymbol</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span> *des = <span class="hljs-string">"only"</span>;</li><li>    <span class="hljs-comment">// 使用napi_create_string_utf8创建描述字符串</span></li><li>    napi_status status = <span class="hljs-built_in">napi_create_string_utf8</span>(env, des, NAPI_AUTO_LENGTH, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"Node-API napi_create_string_utf8 failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    napi_value returnSymbol = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 创建一个symbol类型，并返回</span></li><li>    status = <span class="hljs-built_in">napi_create_symbol</span>(env, result, &amp;returnSymbol);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"Node-API napi_create_symbol failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> returnSymbol;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> createSymbol : <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">symbol</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> varSymbol = testNapi.<span class="hljs-title function_">createSymbol</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'createSymbol:%{public}s'</span>, <span class="hljs-keyword">typeof</span> varSymbol);</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-qim-c106="" class="highlight-div"><div _ngcontent-qim-c106="" class="highlight-div-header"><div _ngcontent-qim-c106="" class="highlight-div-header-left"><div _ngcontent-qim-c106="" class="handle-button expand-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qim-c106="" class="highlight-div-header-right"><div _ngcontent-qim-c106="" class="handle-button ai-button"></div><div _ngcontent-qim-c106="" class="handle-button line-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qim-c106="" class="handle-button theme-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qim-c106="" class="handle-button copy-button"><div _ngcontent-qim-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qim-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>