<h1 _ngcontent-yoq-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口进行primitive类相关开发"> 使用Node-API接口进行primitive类相关开发 </h1>

<div _ngcontent-yoq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用Node-API接口，开发人员可以在Node-API模块中与ArkTS对象交互，进行数据转换和获取特定对象。这些操作在不同场景中发挥重要作用，使开发人员能够更灵活地处理ArkTS值和对象。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>使用Node-API操作ArkTS对象时，需要了解一些基本概念。</p> <ul><li><strong>ArkTS值到C/C++类型的转换：</strong> 在Node-API模块中，可以使用Node-API函数将ArkTS值转换为C/C++的数据类型，如将ArkTS数值转换为C/C++的整数、将ArkTS字符串转换为C/C++的字符数组等。同样，也可以将C/C++的数据类型转换为ArkTS值，以便将结果返回给ArkTS代码。</li></ul> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下接口用于从C/C++代码中与ArkTS交互，传递数据并执行操作</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_bool</td> <td class="cellrowborder" valign="top" width="50%">将给定的ArkTS value强转为ArkTS boolean值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_number</td> <td class="cellrowborder" valign="top" width="50%">将给定的ArkTS value强转成ArkTS number。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_object</td> <td class="cellrowborder" valign="top" width="50%">将给定的ArkTS value强转成ArkTS Object。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_string</td> <td class="cellrowborder" valign="top" width="50%">将给定的ArkTS value强转成ArkTS string。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_boolean</td> <td class="cellrowborder" valign="top" width="50%">将给定的C boolean值，获取ArkTS boolean值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_bool</td> <td class="cellrowborder" valign="top" width="50%">根据给定的ArkTS boolean值，获取等价的C/C++布尔值。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_global</td> <td class="cellrowborder" valign="top" width="50%">获取全局ArkTS对象，以便在C/C++中访问和操纵全局对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_null</td> <td class="cellrowborder" valign="top" width="50%">获取ArkTS null。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_undefined</td> <td class="cellrowborder" valign="top" width="50%">获取ArkTS undefined。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅展示接口对应的C++及ArkTS相关代码。</p> </div>  <div class="tiledSection"><h3 id="napi_coerce_to_bool" class="firsth2">napi_coerce_to_bool<i class="anchor-icon anchor-icon-link" anchorid="napi_coerce_to_bool" tips="复制节点链接"></i></h3><p>用于将给定的ArkTS value强转成ArkTS boolean值。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CoerceToBool</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传进的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的值转换为布尔值</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_coerce_to_bool</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-comment">//返回强转之后的ArkTS boolean值</span></li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">coerceToBool</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">coerceToBool</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">0</span>);</li><li><span class="hljs-keyword">let</span> str = testNapi.<span class="hljs-property">coerceToBool</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'111111111'</span>);</li><li><span class="hljs-keyword">let</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();</li><li><span class="hljs-keyword">let</span> res = testNapi.<span class="hljs-property">coerceToBool</span>&lt;<span class="hljs-title class_">Object</span>&gt;(obj);</li><li><span class="hljs-keyword">let</span> result = testNapi.<span class="hljs-property">coerceToBool</span>&lt;<span class="hljs-literal">null</span>&gt;(<span class="hljs-literal">null</span>);</li><li><span class="hljs-comment">// false</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_bool:%{public}s'</span>, value);</li><li><span class="hljs-comment">// true</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_bool:%{public}s'</span>, str);</li><li><span class="hljs-comment">// true</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_bool:%{public}s'</span>, res);</li><li><span class="hljs-comment">// false</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_bool:%{public}s'</span>, result);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_coerce_to_number">napi_coerce_to_number<i class="anchor-icon anchor-icon-link" anchorid="napi_coerce_to_number" tips="复制节点链接"></i></h3><p>将给定的ArkTS value强转成ArkTS number。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CoerceToNumber</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传进的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的值转换为number值</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_coerce_to_number</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">coerceToNumber</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">coerceToNumber</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'2556'</span>);</li><li><span class="hljs-keyword">let</span> str = testNapi.<span class="hljs-property">coerceToNumber</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'sssss'</span>);</li><li><span class="hljs-keyword">let</span> bool = testNapi.<span class="hljs-property">coerceToNumber</span>&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">true</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_number:%{public}d'</span>, value);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_number:%{public}d'</span>, str);    <span class="hljs-comment">// 返回的为NAN</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_number:%{public}d'</span>, bool);   <span class="hljs-comment">// 返回的是1</span></li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_coerce_to_object">napi_coerce_to_object<i class="anchor-icon anchor-icon-link" anchorid="napi_coerce_to_object" tips="复制节点链接"></i></h3><p>用于将给定的ArkTS value强转成ArkTS Object。</p> <p>cpp部分代码：</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CoerceToObject</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传进的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    napi_value obj = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的值转换为Object值</span></li><li>    <span class="hljs-built_in">napi_coerce_to_object</span>(env, args[<span class="hljs-number">0</span>], &amp;obj);</li><li>    <span class="hljs-keyword">return</span> obj;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">coerceToObject</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-title class_">Object</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">coerceToObject</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'222222'</span>);</li><li><span class="hljs-keyword">let</span> result = testNapi.<span class="hljs-property">coerceToObject</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">111</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Node-API coerceToObject:%{public}s.'</span>, <span class="hljs-keyword">typeof</span> result);</li><li><span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> value === <span class="hljs-string">'object'</span>) {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Node-API The value is an object.'</span>);</li><li>} <span class="hljs-keyword">else</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Node-API The value is not an object.'</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_coerce_to_string">napi_coerce_to_string<i class="anchor-icon anchor-icon-link" anchorid="napi_coerce_to_string" tips="复制节点链接"></i></h3><p>用于将给定的ArkTS value强转成ArkTS string。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CoerceToString</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传进的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的值转换为string</span></li><li>    napi_value str = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_coerce_to_string</span>(env, args[<span class="hljs-number">0</span>], &amp;str);</li><li>    <span class="hljs-keyword">return</span> str;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">coerceToString</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T</span>) =&gt;</span> <span class="hljs-built_in">string</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">coerceToString</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">212</span>);</li><li><span class="hljs-keyword">let</span> obj = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>();</li><li><span class="hljs-keyword">let</span> res = testNapi.<span class="hljs-property">coerceToString</span>&lt;<span class="hljs-title class_">Object</span>&gt;(obj);</li><li><span class="hljs-keyword">let</span> bool = testNapi.<span class="hljs-property">coerceToString</span>&lt;<span class="hljs-built_in">boolean</span>&gt;(<span class="hljs-literal">false</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_string:%{public}s'</span>, value);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_string:%{public}s'</span>, <span class="hljs-keyword">typeof</span> res);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_coerce_to_string:%{public}s'</span>, bool);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_boolean">napi_get_boolean<i class="anchor-icon anchor-icon-link" anchorid="napi_get_boolean" tips="复制节点链接"></i></h3><p>根据给定的C boolean值，获取等价的ArkTS boolean值。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetBoolean</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 传入两个参数并解析</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>];</li><li>    napi_valuetype data, value;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_cb_info failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 判断两个参数类型值</span></li><li>    <span class="hljs-built_in">napi_typeof</span>(env, argv[<span class="hljs-number">0</span>], &amp;data);</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, argv[<span class="hljs-number">1</span>], &amp;value);</li><li>
</li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 判断两个类型值是否相等,获取结果的布尔值</span></li><li>    status = <span class="hljs-built_in">napi_get_boolean</span>(env, data == value, &amp;returnValue);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_boolean failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 返回结果</span></li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getBoolean</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">data: T, value: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-property">getBoolean</span>&lt;<span class="hljs-built_in">number</span>&gt;(<span class="hljs-number">1</span>, <span class="hljs-string">'1'</span>);</li><li><span class="hljs-keyword">let</span> data = testNapi.<span class="hljs-property">getBoolean</span>&lt;<span class="hljs-built_in">string</span>&gt;(<span class="hljs-string">'sss'</span>, <span class="hljs-string">'1'</span>);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_boolean:%{public}s'</span>, value);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_boolean:%{public}s'</span>, data);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_value_bool">napi_get_value_bool<i class="anchor-icon anchor-icon-link" anchorid="napi_get_value_bool" tips="复制节点链接"></i></h3><p>使用此函数将ArkTS中的布尔值转换为等价的C布尔值。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetValueBool</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">bool</span> bool_c = <span class="hljs-literal">false</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_bool</span>(env, args[<span class="hljs-number">0</span>], &amp;bool_c);</li><li>    <span class="hljs-keyword">if</span> (status == napi_boolean_expected) {</li><li>        <span class="hljs-comment">// 如果napi_get_value_bool成功会返回napi_ok，如果传入一个非布尔值则会返回napi_boolean_expected</span></li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    napi_value boolNapi = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_get_boolean</span>(env, bool_c, &amp;boolNapi);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"napi_get_boolean failed"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> boolNapi;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getValueBool</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 分别传入布尔值和非布尔值检测接口,传入布尔值将返回原布尔值,传入其他类型返回undefined</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_bool_not_bool %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueBool</span>(<span class="hljs-string">'你好123'</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_bool_true %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueBool</span>(<span class="hljs-literal">true</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'Node-API'</span>, <span class="hljs-string">'get_value_bool_false %{public}s'</span>, testNapi.<span class="hljs-title function_">getValueBool</span>(<span class="hljs-literal">false</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_global">napi_get_global<i class="anchor-icon anchor-icon-link" anchorid="napi_get_global" tips="复制节点链接"></i></h3><p>获取全局ArkTS对象。此函数用于获取表示ArkTS全局对象的napi_value，使C/C++模块能与ArkTS运行时的全局对象交互。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetGlobal</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value global = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 获取global对象</span></li><li>    <span class="hljs-built_in">napi_get_global</span>(env, &amp;global);</li><li>    <span class="hljs-keyword">return</span> global;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getGlobal</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> globalObj = testNapi.<span class="hljs-title function_">getGlobal</span>();</li><li><span class="hljs-comment">// 判断获取的global是否具有global的自身属性</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_global:%{public}s'</span>, globalObj.<span class="hljs-property">hasOwnProperty</span>!(<span class="hljs-string">"undefined"</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_null">napi_get_null<i class="anchor-icon anchor-icon-link" anchorid="napi_get_null" tips="复制节点链接"></i></h3><p>获取ArkTS中的null值。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetNull</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value nullValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_null</span>(env, &amp;nullValue);</li><li>    <span class="hljs-keyword">return</span> nullValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getNull</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-literal">null</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-title function_">getNull</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_null:%{public}s'</span>, value);</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_undefined">napi_get_undefined<i class="anchor-icon anchor-icon-link" anchorid="napi_get_undefined" tips="复制节点链接"></i></h3><p>获取ArkTS中的undefined值。</p> <p>cpp部分代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetUndefined</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取并解析传进的参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    napi_value value = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_undefined</span>(env, &amp;value);</li><li>    <span class="hljs-comment">// 判断传入参数的类型与undefined值的类型是否一致</span></li><li>    <span class="hljs-type">bool</span> isEqual = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-built_in">napi_strict_equals</span>(env, args[<span class="hljs-number">0</span>], value, &amp;isEqual);</li><li>    <span class="hljs-comment">// 参数与undefined值相等</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 返回判断类型之后的结果，相等返回为true，不等则为false</span></li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, isEqual, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getUndefined</span>: <span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-literal">undefined</span></span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">let</span> value = testNapi.<span class="hljs-title function_">getUndefined</span>(data);</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_undefined:%{public}s'</span>, value);</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-yoq-c106="" class="highlight-div"><div _ngcontent-yoq-c106="" class="highlight-div-header"><div _ngcontent-yoq-c106="" class="highlight-div-header-left"><div _ngcontent-yoq-c106="" class="handle-button expand-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yoq-c106="" class="highlight-div-header-right"><div _ngcontent-yoq-c106="" class="handle-button ai-button"></div><div _ngcontent-yoq-c106="" class="handle-button line-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yoq-c106="" class="handle-button theme-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yoq-c106="" class="handle-button copy-button"><div _ngcontent-yoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yoq-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>