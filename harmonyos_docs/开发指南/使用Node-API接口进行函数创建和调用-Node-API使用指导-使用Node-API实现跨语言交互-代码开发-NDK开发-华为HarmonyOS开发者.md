<h1 _ngcontent-xyd-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口进行函数创建和调用"> 使用Node-API接口进行函数创建和调用 </h1>

<div _ngcontent-xyd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>函数调用允许开发者从Node-API模块中调用ArkTS函数并传递参数，或在Node-API模块中创建ArkTS函数。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>函数是一种非常重要的编程概念，可以执行特定的任务或操作、提高代码的可读性、把复杂任务简化、提高代码复用性以及支持代码的组织与管理。每个函数可以负责不同的功能，提供一种将代码模块化和组织结构化的方式，使其更易于理解、维护和重用。</p> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_get_cb_info</td> <td class="cellrowborder" valign="top" width="50%">当需要从给定的callback info中获取有关调用的参数信息和this指针时，可使用此接口。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_call_function</td> <td class="cellrowborder" valign="top" width="50%">当需要在Node-API模块中对ArkTS侧函数进行调用时，可使用此接口。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_function</td> <td class="cellrowborder" valign="top" width="50%">当需要将C/C++函数创建为ArkTS函数时，可以使用此接口。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h2 id="napi_get_cb_info">napi_get_cb_info<i class="anchor-icon anchor-icon-link" anchorid="napi_get_cb_info" tips="复制节点链接"></i></h2><p>获取有关函数调用的详细信息。</p> <p>cpp部分代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-comment">// 获取ArkTS侧入参的的参数信息</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetCbArgs</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">return</span> args[<span class="hljs-number">0</span>];</li><li>}</li><li><span class="hljs-comment">// 获取ArkTS侧入参的参数个数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetCbArgQuantity</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">0</span>;</li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, argc, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li><span class="hljs-comment">// 获取ArkTS侧this参数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetCbContext</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_value thisArg = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, &amp;thisArg, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">return</span> thisArg;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getCbArgs</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">arg: T</span>) =&gt;</span> T;</li><li><span class="hljs-comment">// getCbArgQuantity的入参由用户自定义，在此用例中，我们用两个入参，一个是string，一个是number</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getCbArgQuantity</span>: <span class="hljs-function">(<span class="hljs-params">str: <span class="hljs-built_in">string</span>, num: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getCbContext</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span>;</li></ol></pre></div></div> <p>ArkTS 侧示例代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">summation</span>(<span class="hljs-params">arr: <span class="hljs-built_in">Array</span>&lt;<span class="hljs-built_in">number</span>&gt;</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">sum</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; arr.<span class="hljs-property">length</span>; i++) {</li><li>    sum += arr[i];</li><li>  }</li><li>  <span class="hljs-keyword">return</span> sum;</li><li>}</li><li><span class="hljs-keyword">const</span> str = <span class="hljs-string">'message'</span>;</li><li><span class="hljs-keyword">const</span> arr = [<span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>];</li><li><span class="hljs-keyword">const</span> num = <span class="hljs-number">526</span>;</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Student</span> {</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">age</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">score</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">name: <span class="hljs-built_in">string</span>, age: <span class="hljs-built_in">number</span>, score: <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">name</span> = name;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">age</span> = age;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">score</span> = score;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> student = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Student</span>(<span class="hljs-string">'Alice'</span>, <span class="hljs-number">18</span>, <span class="hljs-number">100</span>);</li><li><span class="hljs-comment">// 获取参数</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get string arg:%{public}s'</span>, testNapi.<span class="hljs-title function_">getCbArgs</span>(str));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get array arg:%{public}s '</span>, testNapi.<span class="hljs-title function_">getCbArgs</span>(arr).<span class="hljs-title function_">toString</span>());</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get num arg:%{public}d '</span>, testNapi.<span class="hljs-title function_">getCbArgs</span>(num));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get undefined arg:%{public}s '</span>, testNapi.<span class="hljs-title function_">getCbArgs</span>(<span class="hljs-literal">undefined</span>));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get object arg:%{public}s '</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(testNapi.<span class="hljs-title function_">getCbArgs</span>(student)));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get function arg:%{public}d '</span>, testNapi.<span class="hljs-title function_">getCbArgs</span>(<span class="hljs-title function_">summation</span>(arr)));</li><li><span class="hljs-comment">// 获取参数个数</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get arg quantity:%{public}d '</span>, testNapi.<span class="hljs-title function_">getCbArgQuantity</span>(str, num));</li><li><span class="hljs-comment">// 获取上下文</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_cb_info get thisArg:%{public}s '</span>, testNapi.<span class="hljs-title function_">getCbContext</span>().<span class="hljs-title function_">toString</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="napi_call_function">napi_call_function<i class="anchor-icon anchor-icon-link" anchorid="napi_call_function" tips="复制节点链接"></i></h2><p>在C/C++侧对ArkTS函数进行调用。</p> <p>注意事项：napi_call_function传入的argv的长度必须大于等于argc声明的数量，并且每个元素都应初始化为nullptr。</p> <p>cpp部分代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CallFunction</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-comment">// 获取ArkTS侧入参</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 获取全局对象，这里用global是因为napi_call_function的第二个参数是JS函数的this入参。</span></li><li>    napi_value global = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_global</span>(env, &amp;global);</li><li>    <span class="hljs-comment">// 调用ArkTS方法</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 调用napi_call_function时传入的argv的长度必须大于等于argc声明的数量，且被初始化成nullptr</span></li><li>    <span class="hljs-built_in">napi_call_function</span>(env, global, argv[<span class="hljs-number">0</span>], argc, argv, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ObjCallFunction</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传递的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-comment">// 获取ArkTS侧入参</span></li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用ArkTS方法</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 调用napi_call_function时传入的argv的长度必须大于等于argc声明的数量，且被初始化成nullptr</span></li><li>    <span class="hljs-built_in">napi_call_function</span>(env, argv[<span class="hljs-number">0</span>], argv[<span class="hljs-number">1</span>], argc, argv, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">callFunction</span>: <span class="hljs-function">(<span class="hljs-params">func: <span class="hljs-built_in">Function</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">objCallFunction</span>: <span class="hljs-function">(<span class="hljs-params">obj: <span class="hljs-built_in">Object</span>, func: <span class="hljs-built_in">Function</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS 侧示例代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">returnNumber</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>;</li><li>}</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Person</span> {</li><li>  <span class="hljs-title function_">age</span>(): <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">11</span>;</li><li>  }</li><li>}</li><li><span class="hljs-keyword">const</span> person = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Person</span>();</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API call_function:%{public}d'</span>, testNapi.<span class="hljs-title function_">callFunction</span>(returnNumber));</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API call_function:%{public}d'</span>, testNapi.<span class="hljs-title function_">objCallFunction</span>(person,person.<span class="hljs-property">age</span>));</li></ol></pre></div></div> </div>  <div class="tiledSection"><h2 id="napi_create_function">napi_create_function<i class="anchor-icon anchor-icon-link" anchorid="napi_create_function" tips="复制节点链接"></i></h2><p>将一个C/C++函数包装为可在ArkTS中调用的函数，并返回一个表示该函数的napi_value。</p> <p>cpp部分代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CalculateArea</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取ArkTS侧传递的两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value args[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-type">double</span> width = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">0</span>], &amp;width);</li><li>    <span class="hljs-type">double</span> height = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, args[<span class="hljs-number">1</span>], &amp;height);</li><li>    napi_value area = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, width * height, &amp;area);</li><li>    <span class="hljs-keyword">return</span> area;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_value fn = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_function</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, CalculateArea, <span class="hljs-literal">nullptr</span>, &amp;fn);</li><li>    <span class="hljs-built_in">napi_set_named_property</span>(env, exports, <span class="hljs-string">"calculateArea"</span>, fn);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">calculateArea</span>: <span class="hljs-function">(<span class="hljs-params">width: <span class="hljs-built_in">number</span>, height: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div> <p>ArkTS 侧示例代码</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API create_function:%{public}d '</span>, testNapi.<span class="hljs-title function_">calculateArea</span>(<span class="hljs-number">1.2</span>, <span class="hljs-number">4</span>));</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-xyd-c106="" class="highlight-div"><div _ngcontent-xyd-c106="" class="highlight-div-header"><div _ngcontent-xyd-c106="" class="highlight-div-header-left"><div _ngcontent-xyd-c106="" class="handle-button expand-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xyd-c106="" class="highlight-div-header-right"><div _ngcontent-xyd-c106="" class="handle-button ai-button"></div><div _ngcontent-xyd-c106="" class="handle-button line-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xyd-c106="" class="handle-button theme-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xyd-c106="" class="handle-button copy-button"><div _ngcontent-xyd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xyd-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>