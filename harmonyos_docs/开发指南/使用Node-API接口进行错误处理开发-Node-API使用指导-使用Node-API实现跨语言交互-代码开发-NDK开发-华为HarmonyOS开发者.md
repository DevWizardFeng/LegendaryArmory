<h1 _ngcontent-owi-c119="" class="doc-title ng-star-inserted" title="使用Node-API接口进行错误处理开发"> 使用Node-API接口进行错误处理开发 </h1>

<div _ngcontent-owi-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="简介">简介<i class="anchor-icon anchor-icon-link" anchorid="简介" tips="复制节点链接"></i></h2><p>使用Node-API接口进行错误处理，使得在Node-API模块中能够更好地管理和响应错误情况。通过合理使用这些函数，可以提高模块的稳定性和可靠性。</p> </div>  <div class="tiledSection"><h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2><p>在ArkTS编程中，异常和错误是常见的概念。异常表示发生了某种意外情况，而错误则指示程序无法正确执行某些操作。Node-API提供了一系列方法来帮助开发者在Node-API模块中处理ArkTS中的异常和错误。下面是一些基本概念：</p> <ul><li><strong>异常（Exception）</strong>：在程序执行过程中可能会出现的意外情况，可以是语法错误、运行时错误或逻辑错误，例如除以零或对未定义变量的操作。</li><li><strong>错误（Error）</strong>：表示程序无法顺利执行某些操作，可以是由底层系统、API函数或开发者自定义的。</li><li><strong>类型错误（Type Error）</strong>：表示操作或值的类型不符合预期，通常是由错误的数据类型导致的。</li><li><strong>范围错误（Range Error）</strong>：表示一个值不在预期的范围内，例如对数组长度之外的索引进行访问。</li></ul> <p>这些基本概念在异常和错误处理中非常重要，开发者需要通过适当的方法来捕获、处理或向用户报告这些异常和错误，以确保程序的稳定性和正确性。Node-API提供的方法可以帮助开发者在Node-API模块中处理ArkTS中的异常和错误。</p> </div>  <div class="tiledSection"><h2 id="场景和功能介绍">场景和功能介绍<i class="anchor-icon anchor-icon-link" anchorid="场景和功能介绍" tips="复制节点链接"></i></h2><p>以下Node-API接口主要用于与ArkTS交互时处理错误和异常情况。其使用场景如下：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_create_error、napi_create_type_error、napi_create_range_error</td> <td class="cellrowborder" valign="top" width="50%">在C/C++中需要创建一个错误对象时，可以使用这些函数。创建的错误对象可以使用napi_throw抛出到ArkTS。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw</td> <td class="cellrowborder" valign="top" width="50%">当在C/C++中出现了错误或异常情况时，通过使用napi_create_error或napi_get_last_error_info方法创建或获取ArkTS Error对象，使用该方法抛出已有的ArkTS Error对象。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw_error、napi_throw_type_error、napi_throw_range_error</td> <td class="cellrowborder" valign="top" width="50%">当在C/C++中出现了错误或异常情况时，可以使用这些函数来抛出ArkTS中的异常。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_error</td> <td class="cellrowborder" valign="top" width="50%">检查一个napi_value是否代表一个错误对象时，可以使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_and_clear_last_exception</td> <td class="cellrowborder" valign="top" width="50%">当你需要获取最近一次出现的异常，并将异常队列清空时，可以使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_exception_pending</td> <td class="cellrowborder" valign="top" width="50%">当你需要判断是否有未处理的异常时，可以使用这个函数。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_fatal_error</td> <td class="cellrowborder" valign="top" width="50%">当遇到严重错误或不可恢复的情况时，可以使用这个函数引发致命错误来立即终止进程。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_fatal_exception</td> <td class="cellrowborder" valign="top" width="50%">抛出一个致命异常并终止进程, 同时产生相应的crash日志。</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="使用示例">使用示例<i class="anchor-icon anchor-icon-link" anchorid="使用示例" tips="复制节点链接"></i></h2><p>Node-API接口开发流程参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/use-napi-process">使用Node-API实现跨语言交互开发流程</a>，本文仅对接口对应C++及ArkTS相关代码进行展示。</p> </div>  <div class="tiledSection"><h3 id="napi_get_last_error_info" class="firsth2">napi_get_last_error_info<i class="anchor-icon anchor-icon-link" anchorid="napi_get_last_error_info" tips="复制节点链接"></i></h3><p>用于获取最后一次发生的错误信息，包括错误码、错误消息以及错误进栈信息，即使存在挂起的ArkTS异常，也可以调用此API。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetLastErrorInfo</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取输入参数（这里以字符串message作为参数传入）</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入的字符串参数以napi_get_value_int32取出，主动制造错误</span></li><li>    <span class="hljs-type">int32_t</span> value = <span class="hljs-number">0</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;value);</li><li>    <span class="hljs-comment">// 接口使用错误，故返回值不为napi_ok</span></li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Test Node-API napi_get_value_int32 return status, status is not equal to napi_ok."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 调用接口napi_get_last_error_info获取最后一次错误信息</span></li><li>    <span class="hljs-type">const</span> napi_extended_error_info *errorInfo;</li><li>    <span class="hljs-built_in">napi_get_last_error_info</span>(env, &amp;errorInfo);</li><li>    <span class="hljs-comment">// 取出错误码与接口调用错误后其返回值作比较</span></li><li>    <span class="hljs-keyword">if</span> (errorInfo-&gt;error_code == status) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Test Node-API napi_get_last_error_info return errorInfo, error_code equal to status."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 取出错误消息作为返回值带出去打印</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, errorInfo-&gt;error_message, NAPI_AUTO_LENGTH, &amp;result);</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getLastErrorInfo</span>: <span class="hljs-function">(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">string</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_last_error_info: %{public}s'</span>, testNapi.<span class="hljs-title function_">getLastErrorInfo</span>(<span class="hljs-string">'message'</span>));</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_last_error_info error: %{public}s'</span>, error);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_type_error">napi_create_type_error<i class="anchor-icon anchor-icon-link" anchorid="napi_create_type_error" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的ArkTS TypeError。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateTypeError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 构造errorCode和errorMessage</span></li><li>    napi_value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"napi_create_error errorCode"</span>, NAPI_AUTO_LENGTH, &amp;errorCode);</li><li>    napi_value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"napi_create_error errorMessage"</span>, NAPI_AUTO_LENGTH, &amp;errorMessage);</li><li>    <span class="hljs-comment">// 调用napi_create_type_error创建一个typeError错误对象</span></li><li>    napi_value error = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_type_error</span>(env, errorCode, errorMessage, &amp;error);</li><li>    <span class="hljs-keyword">return</span> error;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createTypeError</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Error</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">throw</span> testNapi.<span class="hljs-title function_">createTypeError</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_type_error errorCode: %{public}s, errorMessage %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_range_error">napi_create_range_error<i class="anchor-icon anchor-icon-link" anchorid="napi_create_range_error" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的ArkTS RangeError。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">CreateRangeError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 构造errorCode和errorMessage</span></li><li>    napi_value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"napi_create_error errorCode"</span>, NAPI_AUTO_LENGTH, &amp;errorCode);</li><li>    napi_value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"napi_create_error errorMessage"</span>, NAPI_AUTO_LENGTH, &amp;errorMessage);</li><li>    <span class="hljs-comment">// 调用napi_create_range_error创建一个typeError错误对象</span></li><li>    napi_value error = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_range_error</span>(env, errorCode, errorMessage, &amp;error);</li><li>    <span class="hljs-keyword">return</span> error;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">createRangeError</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Error</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">throw</span> testNapi.<span class="hljs-title function_">createRangeError</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_create_range_error errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_create_error">napi_create_error<i class="anchor-icon anchor-icon-link" anchorid="napi_create_error" tips="复制节点链接"></i></h3><p>创建并获取一个带文本信息的ArkTS Error。</p> </div>  <div class="tiledSection"><h3 id="napi_throw">napi_throw<i class="anchor-icon anchor-icon-link" anchorid="napi_throw" tips="复制节点链接"></i></h3><p>用于在Node-API模块中抛出ArkTS异常的函数。当在本地代码中发生错误或检测到不符合预期的情况时，可以使用此接口来抛出一个ArkTS异常，使其能够被捕获并处理。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiThrow</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 代码中发生某些错误后，可执行以下操作抛出异常</span></li><li>    <span class="hljs-comment">// 在Node-API环境中创建一个字符串，并将其存储在errorCode变量中</span></li><li>    napi_value errorCode = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"throw errorCode"</span>, NAPI_AUTO_LENGTH, &amp;errorCode);</li><li>    <span class="hljs-comment">// 在Node-API环境中创建一个字符串，并将其存储在errorMessage变量中</span></li><li>    napi_value errorMessage = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_string_utf8</span>(env, <span class="hljs-string">"throw errorMessage"</span>, NAPI_AUTO_LENGTH, &amp;errorMessage);</li><li>    <span class="hljs-comment">// 创建一个ArkTS对象error</span></li><li>    napi_value error = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_error</span>(env, errorCode, errorMessage, &amp;error);</li><li>    <span class="hljs-comment">// 通过napi_throw接口将对象抛出</span></li><li>    <span class="hljs-built_in">napi_throw</span>(env, error);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiThrow</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">napiThrow</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_throw_error">napi_throw_error<i class="anchor-icon anchor-icon-link" anchorid="napi_throw_error" tips="复制节点链接"></i></h3><p>用于抛出一个带文本信息的ArkTS Error。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 这里直接抛出一个带有errorMessage的错误</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiThrowErrorMessage</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_throw_error throwing an error"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// 传入两个参数，在第二个参数，也就是除数为0的时候抛出一个错误</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiThrowError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// ArkTS侧传入两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将其转换为double类型的值作为被除数和除数</span></li><li>    <span class="hljs-type">double</span> dividend, divisor;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, argv[<span class="hljs-number">0</span>], &amp;dividend);</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, argv[<span class="hljs-number">1</span>], &amp;divisor);</li><li>    <span class="hljs-comment">// 在这里判断除数如果为0则直接抛出一个错误，errorCode为：DIVIDE_BY_ZERO，errorMessage为：Cannot divide by zero</span></li><li>    <span class="hljs-keyword">if</span> (divisor == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-string">"DIVIDE_BY_ZERO"</span>, <span class="hljs-string">"Cannot divide by zero"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiThrowErrorMessage</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiThrowError</span>: <span class="hljs-function">(<span class="hljs-params">dividend: <span class="hljs-built_in">number</span>, divisor: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">napiThrowErrorMessage</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_error error code: %{public}s , message: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">napiThrowError</span>(<span class="hljs-number">5</span>, <span class="hljs-number">0</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_error errorCode: %{public}s , errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_throw_type_error">napi_throw_type_error<i class="anchor-icon anchor-icon-link" anchorid="napi_throw_type_error" tips="复制节点链接"></i></h3><p>抛出一个带文本信息的ArkTS TypeError。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 这里直接抛出一个带有errorMessage的TypeError</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ThrowTypeErrorMessage</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_throw_type_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_throw_type_error throwing an error"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// 传入一个类型不匹配的参数，判断类型不匹配之后抛出typeError</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ThrowTypeError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// ArkTS侧传入一个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 将传入参数转换为napi_valuetype类型的值</span></li><li>    napi_valuetype valueType;</li><li>    <span class="hljs-built_in">napi_typeof</span>(env, argv[<span class="hljs-number">0</span>], &amp;valueType);</li><li>    <span class="hljs-comment">// 如果传入参数不为napi_number类型的值则抛出TypeError</span></li><li>    <span class="hljs-keyword">if</span> (valueType != napi_number) {</li><li>        <span class="hljs-comment">// 这里抛出一个既带有errorCode也带有errorMessage的TypeError</span></li><li>        <span class="hljs-built_in">napi_throw_type_error</span>(env, <span class="hljs-string">"napi_throw_type_error"</span>, <span class="hljs-string">"Argument must be a number"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">throwTypeErrorMessage</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">throwTypeError</span>: <span class="hljs-function">(<span class="hljs-params">message: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">throwTypeErrorMessage</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_type_error errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">throwTypeError</span>(<span class="hljs-string">'str'</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_type_error errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_throw_range_error">napi_throw_range_error<i class="anchor-icon anchor-icon-link" anchorid="napi_throw_range_error" tips="复制节点链接"></i></h3><p>抛出一个带文本信息的ArkTS RangeError。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 这里直接抛出一个带有errorMessage的RangeError</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ThrowRangeErrorMessage</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_throw_range_error</span>(env, <span class="hljs-literal">nullptr</span>, <span class="hljs-string">"napi_throw_range_error one"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li><span class="hljs-comment">// 传入不匹配的参数个数，判断不匹配之后抛出rangeError</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ThrowRangeError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// ArkTS侧传入两个参数</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">2</span>;</li><li>    napi_value argv[<span class="hljs-number">2</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 如果传入参数个数不为2</span></li><li>    <span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) {</li><li>        <span class="hljs-comment">// 这里抛出一个RangeError</span></li><li>        <span class="hljs-built_in">napi_throw_range_error</span>(env, <span class="hljs-string">"napi_throw_range_error"</span>, <span class="hljs-string">"Expected two numbers as arguments"</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 下面将传入的两值相加并传出去</span></li><li>    <span class="hljs-type">double</span> numOne = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">double</span> numTwo = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, argv[<span class="hljs-number">0</span>], &amp;numOne);</li><li>    <span class="hljs-built_in">napi_get_value_double</span>(env, argv[<span class="hljs-number">1</span>], &amp;numTwo);</li><li>    <span class="hljs-type">double</span> result = numOne + numTwo;</li><li>    napi_value resultValue;</li><li>    <span class="hljs-built_in">napi_create_double</span>(env, result, &amp;resultValue);</li><li>    <span class="hljs-keyword">return</span> resultValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">throwRangeErrorMessage</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">throwRangeError</span>: <span class="hljs-function">(<span class="hljs-params">num: <span class="hljs-built_in">number</span></span>) =&gt;</span> <span class="hljs-built_in">number</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">throwRangeErrorMessage</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_range_error errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">throwRangeError</span>(<span class="hljs-number">1</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_throw_range_error errorCode: %{public}s, errorMessage: %{public}s'</span>, error.<span class="hljs-property">code</span>, error.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_is_error">napi_is_error<i class="anchor-icon anchor-icon-link" anchorid="napi_is_error" tips="复制节点链接"></i></h3><p>用于判断给定的napi_value是否表示一个error对象。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NapiIsError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 接收一个入参</span></li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-comment">// 调用接口napi_is_error判断入参是否为一个error对象</span></li><li>    <span class="hljs-type">bool</span> result = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 如果napi_value为一个error对象，则设置result为true的布尔值，否则设置为false</span></li><li>    <span class="hljs-built_in">napi_is_error</span>(env, args[<span class="hljs-number">0</span>], &amp;result);</li><li>    <span class="hljs-comment">// 取出result通过napi_get_boolean接口将取出的bool值转换为napi_value类型的值返回出去</span></li><li>    napi_value returnValue = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, result, &amp;returnValue);</li><li>    <span class="hljs-keyword">return</span> returnValue;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">napiIsError</span>: &lt;T&gt;<span class="hljs-function">(<span class="hljs-params">obj: T</span>) =&gt;</span> <span class="hljs-built_in">boolean</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"throwing an error"</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_error error: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiIsError</span>(error)</li><li>    .<span class="hljs-title function_">toString</span>());</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_error error: %{public}s'</span>, testNapi.<span class="hljs-title function_">napiIsError</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">toString</span>());</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_get_and_clear_last_exception">napi_get_and_clear_last_exception<i class="anchor-icon anchor-icon-link" anchorid="napi_get_and_clear_last_exception" tips="复制节点链接"></i></h3><p>用于获取并清除最近一次出现的异常。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetAndClearLastException</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 抛出异常，创造异常情况</span></li><li>    <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-string">"napi_create_error errorCode"</span>, <span class="hljs-string">"napi_create_error errorMessage"</span>);</li><li>    <span class="hljs-comment">// 调用napi_get_and_clear_last_exception接口获取并清除最后一个未处理的异常。即使存在挂起的ArkTS异常，也可以调用此API</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_status status = <span class="hljs-built_in">napi_get_and_clear_last_exception</span>(env, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">getAndClearLastException</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Error</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-comment">// 这里获取到最后一个未处理的异常</span></li><li>hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_get_and_clear_last_exception, error.message: %{public}s'</span>,</li><li>           testNapi.<span class="hljs-title function_">getAndClearLastException</span>());</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_is_exception_pending">napi_is_exception_pending<i class="anchor-icon anchor-icon-link" anchorid="napi_is_exception_pending" tips="复制节点链接"></i></h3><p>用于判断是否出现了异常。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsExceptionPending</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_status status;</li><li>    <span class="hljs-type">bool</span> isExceptionPending = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-comment">// 在执行一些可能引发异常的操作后</span></li><li>    <span class="hljs-built_in">napi_throw_error</span>(env, <span class="hljs-string">"napi_create_error errorCode"</span>, <span class="hljs-string">"napi_create_error errorMessage"</span>);</li><li>    <span class="hljs-comment">// 检查当前环境中是否有异常挂起</span></li><li>    status = <span class="hljs-built_in">napi_is_exception_pending</span>(env, &amp;isExceptionPending);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isExceptionPending) {</li><li>        <span class="hljs-comment">// 处理异常挂起的情况</span></li><li>        napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>        status = <span class="hljs-built_in">napi_get_and_clear_last_exception</span>(env, &amp;result);</li><li>        <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>        }</li><li>        <span class="hljs-comment">// 将处理的异常返回出去</span></li><li>        <span class="hljs-keyword">return</span> result;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">isExceptionPending</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-title class_">Object</span> | <span class="hljs-literal">undefined</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">MyObject</span> {</li><li>  <span class="hljs-attr">code</span>: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span>;</li><li>}</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> result = testNapi.<span class="hljs-title function_">isExceptionPending</span>() <span class="hljs-keyword">as</span> <span class="hljs-title class_">MyObject</span>;</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_exception_pending, error.Code: %{public}s, error.message: %{public}s'</span>,</li><li>    result.<span class="hljs-property">code</span>, result.<span class="hljs-property">message</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_is_exception_pending error'</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_fatal_error">napi_fatal_error<i class="anchor-icon anchor-icon-link" anchorid="napi_fatal_error" tips="复制节点链接"></i></h3><p>用于引发致命错误以立即终止进程。在调用napi_fatal_error函数后，导致应用程序终止，因此应该慎重使用，避免在正常操作中频繁调用该函数。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">FatalError</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 请注意，使用napi_fatal_error函数会导致应用进程直接终止，因此应该谨慎使用，仅在遇到无法恢复的严重错误时才应该调用该函数</span></li><li>    <span class="hljs-comment">// 模拟一个致命错误条件</span></li><li>    <span class="hljs-type">bool</span> errorCondition = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-keyword">if</span> (errorCondition) {</li><li>        <span class="hljs-comment">// 创建一个致命错误信息</span></li><li>        <span class="hljs-built_in">napi_fatal_error</span>(<span class="hljs-string">"napi_fatal_error test"</span>, NAPI_AUTO_LENGTH, <span class="hljs-string">"napi_create_error errorMessage"</span>, NAPI_AUTO_LENGTH);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">fatalError</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  testNapi.<span class="hljs-title function_">fatalError</span>();</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">'Test Node-API napi_fatal_error error'</span>);</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="napi_fatal_exception">napi_fatal_exception<i class="anchor-icon anchor-icon-link" anchorid="napi_fatal_exception" tips="复制节点链接"></i></h3><p>在主线程的上下文环境中调用napi_fatal_exception函数后，抛出一个致命异常，导致应用程序终止，同时会生成相应的crash日志。因此应该慎重使用，避免在正常操作中频繁调用该函数。</p> <p>cpp部分代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">FatalException</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    napi_status status = <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 请注意，使用napi_fatal_exception函数会导致应用进程直接终止，因此应该谨慎使用，仅在主线程遇到无法恢复的严重错误时才应该调用该函数</span></li><li>    <span class="hljs-comment">// 模拟一个致命错误条件</span></li><li>    status = <span class="hljs-built_in">napi_fatal_exception</span>(env, args[<span class="hljs-number">0</span>]);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div> <p>接口声明</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">fatalException</span>: <span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">Error</span></span>) =&gt;</span> <span class="hljs-built_in">void</span>;</li></ol></pre></div></div> <p>ArkTS侧示例代码</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> err = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">"a fatal exception occurred"</span>);</li><li>testNapi.<span class="hljs-title function_">fatalException</span>(err);</li></ol></pre></div></div> <p>以上代码如果要在native cpp中打印日志，需在CMakeLists.txt文件中添加以下配置信息（并添加头文件：#include "hilog/log.h"）：</p> <div _ngcontent-owi-c106="" class="highlight-div"><div _ngcontent-owi-c106="" class="highlight-div-header"><div _ngcontent-owi-c106="" class="highlight-div-header-left"><div _ngcontent-owi-c106="" class="handle-button expand-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-owi-c106="" class="highlight-div-header-right"><div _ngcontent-owi-c106="" class="handle-button ai-button"></div><div _ngcontent-owi-c106="" class="handle-button line-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-owi-c106="" class="handle-button theme-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-owi-c106="" class="handle-button copy-button"><div _ngcontent-owi-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-owi-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"" )</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div> </div> </div> <div></div></div>