<h1 _ngcontent-xom-c119="" class="doc-title ng-star-inserted" title="使用OH_DisplayManager实现屏幕基础信息查询和状态监听 (C/C++)"> 使用OH_DisplayManager实现屏幕基础信息查询和状态监听 (C/C++) </h1>

<div _ngcontent-xom-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-displaymanager" target="_blank">OH_DisplayManager</a>屏幕管理模块用于提供屏幕的信息查询、屏幕状态变化监听、折叠设备的折叠状态变化监听等能力，应用可根据对应的屏幕信息、屏幕状态变化、屏幕折叠状态适配不同的UI界面显示。</p>     <ul>      <li>       <p>支持查询的屏幕信息，包括屏幕的分辨率、物理像素密度、逻辑像素密度、刷新率、屏幕尺寸、屏幕旋转方向、屏幕旋转角度等。</p></li>      <li>       <p>支持屏幕状态变化的监听，包括屏幕旋转变化，屏幕分辨率变化、屏幕刷新率变化等。</p></li>      <li>       <p>支持查询当前设备是否为可折叠设备，同时支持折叠状态（展开/折叠）变化的监听。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="基本概念">基本概念<i class="anchor-icon anchor-icon-link" anchorid="基本概念" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>屏幕的物理像素密度(densityDPI)：代表每英寸屏幕所拥有的物理像素点数。</p></li>      <li>       <p>屏幕的逻辑像素的密度(densityPixels)：代表物理像素与逻辑像素的缩放系数比，计算方法为物理像素密度除以160。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>常用接口如下表所示。更多API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-displaymanager" target="_blank">OH_DisplayManager</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_GetDefaultDisplayRotation(NativeDisplayManager_Rotation *displayRotation)</td>         <td class="cellrowborder" valign="top" width="50%">获取默认屏幕的旋转角度。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_CreateDefaultDisplayCutoutInfo(NativeDisplayManager_CutoutInfo **cutoutInfo)</td>         <td class="cellrowborder" valign="top" width="50%">获取挖孔屏、刘海屏、瀑布屏等不可用屏幕区域信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_DestroyDefaultDisplayCutoutInfo(NativeDisplayManager_CutoutInfo *cutoutInfo)</td>         <td class="cellrowborder" valign="top" width="50%">销毁挖孔屏、刘海屏、瀑布屏等不可用屏幕区域信息。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_IsFoldable()</td>         <td class="cellrowborder" valign="top" width="50%">查询设备是否可折叠。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_RegisterDisplayChangeListener( OH_NativeDisplayManager_DisplayChangeCallback displayChangeCallback, uint32_t *listenerIndex)</td>         <td class="cellrowborder" valign="top" width="50%">注册屏幕状态变化监听（如旋转变化、刷新率、DPI、分辨率等）。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_UnregisterDisplayChangeListener(uint32_t listenerIndex)</td>         <td class="cellrowborder" valign="top" width="50%">取消屏幕状态变化监听。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_RegisterFoldDisplayModeChangeListener( OH_NativeDisplayManager_FoldDisplayModeChangeCallback displayModeChangeCallback, uint32_t *listenerIndex)</td>         <td class="cellrowborder" valign="top" width="50%">注册屏幕展开、折叠状态变化监听。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeDisplayManager_UnregisterFoldDisplayModeChangeListener(uint32_t listenerIndex)</td>         <td class="cellrowborder" valign="top" width="50%">取消屏幕展开、折叠状态变化监听。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="在cmake脚本中链接动态库">在CMake脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在cmake脚本中链接动态库" tips="复制节点链接"></i></h2>          <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libhilog_ndk.z.so)</li><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_display_manager.so )</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="添加头文件">添加头文件<i class="anchor-icon anchor-icon-link" anchorid="添加头文件" tips="复制节点链接"></i></h2>          <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_info.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_manager.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="获取屏幕状态">获取屏幕状态<i class="anchor-icon anchor-icon-link" anchorid="获取屏幕状态" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>可以通过OH_NativeDisplayManager_GetDefaultDisplayRotation获取默认屏幕的旋转角度。</p>       <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_info.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_manager.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">GetDefaultDisplayRotation</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    NativeDisplayManager_Rotation displayRotation;</li><li>    NativeDisplayManager_ErrorCode errCode = <span class="hljs-built_in">OH_NativeDisplayManager_GetDefaultDisplayRotation</span>(&amp;displayRotation);</li><li>    <span class="hljs-keyword">if</span> (errCode == NativeDisplayManager_ErrorCode::DISPLAY_MANAGER_OK) {</li><li>        napi_value rotation;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, displayRotation, &amp;rotation);</li><li>        <span class="hljs-keyword">return</span> rotation;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        napi_value errorCode;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, errCode, &amp;errorCode);</li><li>        <span class="hljs-keyword">return</span> errorCode;</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>       {<span class="hljs-string">"getDisplayRotation"</span>, <span class="hljs-literal">nullptr</span>, GetDefaultDisplayRotation, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>      <li>       <p>可以通过OH_NativeDisplayManager_CreateDefaultDisplayCutoutInfo获取挖孔屏、刘海屏、瀑布屏等不可用屏幕区域信息。 可通过OH_NativeDisplayManager_DestroyDefaultDisplayCutoutInfo销毁挖孔屏、刘海屏、瀑布屏等不可用屏幕区域信息。</p>       <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"napi/native_api.h"</span></li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">window_manager</span>/<span class="hljs-title class_">oh_display_info</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">window_manager</span>/<span class="hljs-title class_">oh_display_manager</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">hilog</span>/<span class="hljs-title class_">log</span>.<span class="hljs-title class_">h</span>&gt;</li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">CreateDefaultDisplayCutoutInfo</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_callback_info</span> <span class="hljs-variable">info</span>)</li><li>{</li><li>    <span class="hljs-variable">NativeDisplayManager_CutoutInfo</span> *<span class="hljs-variable">cutOutInfo</span> = <span class="hljs-variable">NULL</span>;</li><li>    <span class="hljs-variable">NativeDisplayManager_ErrorCode</span> <span class="hljs-variable">errCode</span> = <span class="hljs-title function_">OH_NativeDisplayManager_CreateDefaultDisplayCutoutInfo</span>(&amp;<span class="hljs-title class_">cutOutInfo</span>);</li><li>    <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"GetDefaultCutoutInfo errCode=%{public}d"</span>, <span class="hljs-variable">errCode</span>);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable">errCode</span> == <span class="hljs-variable">NativeDisplayManager_ErrorCode</span>::<span class="hljs-title class_">DISPLAY_MANAGER_OK</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">cutOutInfo</span> != <span class="hljs-variable">NULL</span> &amp;&amp; <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRectsLength</span> != <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"GetDefaultCutoutInfo cutOutInfo length=%{public}d"</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRectsLength</span>);</li><li>            <span class="hljs-keyword">for</span> (<span class="hljs-variable">int</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-title class_">i</span> &lt; <span class="hljs-title class_">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRectsLength</span>; <span class="hljs-title class_">i</span>++) {</li><li>                <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"cutOutInfo[%{public}d]=[%{public}d %{public}d %{public}d %{public}d]"</span>,</li><li>                    <span class="hljs-variable">i</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRects</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">left</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRects</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">top</span>,</li><li>                    <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRects</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">width</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRects</span>[<span class="hljs-title class_">i</span>].<span class="hljs-variable">height</span>);</li><li>            }</li><li>            <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"cutOutInfo waterfall left rect=[%{public}d %{public}d %{public}d %{public}d]"</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">left</span>.<span class="hljs-title class_">left</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">left</span>.<span class="hljs-title class_">top</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">left</span>.<span class="hljs-title class_">width</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">left</span>.<span class="hljs-title class_">height</span>);</li><li>            <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"cutOutInfo waterfall top rect=[%{public}d %{public}d %{public}d %{public}d]"</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">top</span>.<span class="hljs-title class_">left</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">top</span>.<span class="hljs-title class_">top</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">top</span>.<span class="hljs-title class_">width</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">top</span>.<span class="hljs-title class_">height</span>);</li><li>            <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"cutOutInfo waterfall right rect=[%{public}d %{public}d %{public}d %{public}d]"</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">right</span>.<span class="hljs-title class_">left</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">right</span>.<span class="hljs-title class_">top</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">right</span>.<span class="hljs-title class_">width</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">right</span>.<span class="hljs-title class_">height</span>);</li><li>            <span class="hljs-title function_">OH_LOG_INFO</span>(<span class="hljs-variable">LOG_APP</span>, <span class="hljs-string">"cutOutInfo waterfall bottom rect=[%{public}d %{public}d %{public}d %{public}d]"</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">bottom</span>.<span class="hljs-title class_">left</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">bottom</span>.<span class="hljs-title class_">top</span>,</li><li>            <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">bottom</span>.<span class="hljs-title class_">width</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">waterfallDisplayAreaRects</span>.<span class="hljs-title class_">bottom</span>.<span class="hljs-title class_">height</span>);</li><li>        }</li><li>        <span class="hljs-variable">napi_value</span> <span class="hljs-variable">boundingRectsLength</span>;</li><li>        <span class="hljs-title function_">napi_create_int32</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">cutOutInfo</span>-&gt;<span class="hljs-title class_">boundingRectsLength</span>, &amp;<span class="hljs-title class_">boundingRectsLength</span>);</li><li>        <span class="hljs-title function_">OH_NativeDisplayManager_DestroyDefaultDisplayCutoutInfo</span>(<span class="hljs-variable">cutOutInfo</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">boundingRectsLength</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable">napi_value</span> <span class="hljs-variable">errorCode</span>;</li><li>        <span class="hljs-title function_">napi_create_int32</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">errCode</span>, &amp;<span class="hljs-title class_">errorCode</span>);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">errorCode</span>;</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-variable">EXTERN_C_START</span></li><li><span class="hljs-keyword">static</span> <span class="hljs-variable">napi_value</span> <span class="hljs-title function_">Init</span>(<span class="hljs-variable">napi_env</span> <span class="hljs-variable">env</span>, <span class="hljs-variable">napi_value</span> <span class="hljs-variable">exports</span>) {</li><li>    <span class="hljs-variable">napi_property_descriptor</span> <span class="hljs-variable">desc</span>[] = {</li><li>        {<span class="hljs-string">"getCutoutInfo"</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">CreateDefaultDisplayCutoutInfo</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">napi_default</span>, <span class="hljs-variable">nullptr</span>},</li><li>    };</li><li>    <span class="hljs-title function_">napi_define_properties</span>(<span class="hljs-variable">env</span>, <span class="hljs-variable">exports</span>, <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">desc</span>) / <span class="hljs-title function_">sizeof</span>(<span class="hljs-variable">desc</span>[<span class="hljs-number">0</span>]), <span class="hljs-variable">desc</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">exports</span>;</li><li>}</li><li><span class="hljs-variable">EXTERN_C_END</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="监听屏幕状态变化">监听屏幕状态变化<i class="anchor-icon anchor-icon-link" anchorid="监听屏幕状态变化" tips="复制节点链接"></i></h2>          <p>可以通过OH_NativeDisplayManager_RegisterDisplayChangeListener接口注册屏幕变化的监听，包括屏幕旋转、分辨率变化、刷新率变化、DPI变化等。 通过OH_NativeDisplayManager_UnregisterDisplayChangeListener接口取消屏幕状态变化的监听。</p>     <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_info.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_manager.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">DisplayChangeCallback</span><span class="hljs-params">(<span class="hljs-type">uint64_t</span> displayId)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"DisplayChangeCallback displayId=%{public}lu."</span>, displayId);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RegisterDisplayChangeListener</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">uint32_t</span> listenerIndex;</li><li>    NativeDisplayManager_ErrorCode errCode = <span class="hljs-built_in">OH_NativeDisplayManager_RegisterDisplayChangeListener</span>(</li><li>        DisplayChangeCallback, &amp;listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"RegisterDisplayChangeListener listenerIndex =%{public}d errCode=%{public}d."</span>,</li><li>        listenerIndex, errCode);</li><li>    <span class="hljs-keyword">if</span> (errCode == NativeDisplayManager_ErrorCode::DISPLAY_MANAGER_OK) {</li><li>        napi_value registerIndex;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, listenerIndex, &amp;registerIndex);</li><li>        <span class="hljs-keyword">return</span> registerIndex;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        napi_value errorCode;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, errCode, &amp;errorCode);</li><li>        <span class="hljs-keyword">return</span> errorCode;</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">UnregisterDisplayChangeListener</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>
</li><li>    <span class="hljs-type">uint32_t</span> listenerIndex;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-built_in">napi_get_value_uint32</span>(env, args[<span class="hljs-number">0</span>], &amp;listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"UnregisterDisplayChangeListener listenerIndex =%{public}d."</span>, listenerIndex);</li><li>    NativeDisplayManager_ErrorCode errCode = <span class="hljs-built_in">OH_NativeDisplayManager_UnregisterDisplayChangeListener</span>(listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"UnregisterDisplayChangeListener errCode=%{public}d."</span>, errCode);</li><li>    napi_value errorCode;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, errCode, &amp;errorCode);</li><li>    <span class="hljs-keyword">return</span> errorCode;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"registerDisplayChange"</span>, <span class="hljs-literal">nullptr</span>, RegisterDisplayChangeListener, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>        {<span class="hljs-string">"unregisterDisplayChange"</span>, <span class="hljs-literal">nullptr</span>, UnregisterDisplayChangeListener, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>,</li><li>            napi_default, <span class="hljs-literal">nullptr</span>},</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="监听折叠设备状态变化">监听折叠设备状态变化<i class="anchor-icon anchor-icon-link" anchorid="监听折叠设备状态变化" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>可以通过OH_NativeDisplayManager_IsFoldable接口查询设备是不是折叠设备。</p>       <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_manager.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">IsFoldable</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">bool</span> isFoldDevice = <span class="hljs-built_in">OH_NativeDisplayManager_IsFoldable</span>();</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"IsFoldable isFoldDevice =%{public}d."</span>, isFoldDevice);</li><li>    napi_value isFold;</li><li>    <span class="hljs-built_in">napi_get_boolean</span>(env, isFoldDevice, &amp;isFold);</li><li>    <span class="hljs-keyword">return</span> isFold;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"checkIsFoldDevice"</span>, <span class="hljs-literal">nullptr</span>, IsFoldable, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>      <li>       <p>可以通过OH_NativeDisplayManager_RegisterFoldDisplayModeChangeListener注册屏幕展开/折叠状态变化的监听。 通过OH_NativeDisplayManager_UnregisterFoldDisplayModeChangeListener接口取消屏幕展开/折叠状态变化的监听。</p>       <div _ngcontent-xom-c106="" class="highlight-div"><div _ngcontent-xom-c106="" class="highlight-div-header"><div _ngcontent-xom-c106="" class="highlight-div-header-left"><div _ngcontent-xom-c106="" class="handle-button expand-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xom-c106="" class="highlight-div-header-right"><div _ngcontent-xom-c106="" class="handle-button ai-button"></div><div _ngcontent-xom-c106="" class="handle-button line-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xom-c106="" class="handle-button theme-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xom-c106="" class="handle-button copy-button"><div _ngcontent-xom-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xom-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_info.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;window_manager/oh_display_manager.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">FoldDisplayModeChangeCallback</span><span class="hljs-params">(NativeDisplayManager_FoldDisplayMode displayMode)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"displayMode=%{public}d."</span>, displayMode);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RegisterFoldDisplayModeChangeListener</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">uint32_t</span> listenerIndex = <span class="hljs-number">0</span>;</li><li>    NativeDisplayManager_ErrorCode errCode = <span class="hljs-built_in">OH_NativeDisplayManager_RegisterFoldDisplayModeChangeListener</span>(</li><li>        FoldDisplayModeChangeCallback, &amp;listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"listenerIndex =%{public}d errCode=%{public}d."</span>,</li><li>        listenerIndex, errCode);</li><li>    <span class="hljs-keyword">if</span> (errCode == NativeDisplayManager_ErrorCode::DISPLAY_MANAGER_OK) {</li><li>        napi_value registerIndex;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, listenerIndex, &amp;registerIndex);</li><li>        <span class="hljs-keyword">return</span> registerIndex;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        napi_value errorCode;</li><li>        <span class="hljs-built_in">napi_create_int32</span>(env, errCode, &amp;errorCode);</li><li>        <span class="hljs-keyword">return</span> errorCode;</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">UnregisterFoldDisplayModeChangeListener</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-type">uint32_t</span> listenerIndex;</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args , <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>    <span class="hljs-built_in">napi_get_value_uint32</span>(env, args[<span class="hljs-number">0</span>], &amp;listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"listenerIndex =%{public}d."</span>, listenerIndex);</li><li>    NativeDisplayManager_ErrorCode errCode = <span class="hljs-built_in">OH_NativeDisplayManager_UnregisterFoldDisplayModeChangeListener</span>(listenerIndex);</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"errorCode=%{public}d"</span>, errCode);</li><li>    napi_value errorCode;</li><li>    <span class="hljs-built_in">napi_create_int32</span>(env, errCode, &amp;errorCode);</li><li>    <span class="hljs-keyword">return</span> errorCode;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>    { <span class="hljs-string">"registerFoldDisplayModeChange"</span>, <span class="hljs-literal">nullptr</span>, RegisterFoldDisplayModeChangeListener, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>,</li><li>        napi_default, <span class="hljs-literal">nullptr</span> },</li><li>    { <span class="hljs-string">"unregisterFoldDisplayModeChange"</span>, <span class="hljs-literal">nullptr</span>, UnregisterFoldDisplayModeChangeListener, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>,</li><li>        <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> },</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>