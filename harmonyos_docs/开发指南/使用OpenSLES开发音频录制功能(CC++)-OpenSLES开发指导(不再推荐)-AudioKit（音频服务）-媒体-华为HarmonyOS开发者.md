<h1 _ngcontent-foq-c119="" class="doc-title ng-star-inserted" title="使用OpenSL ES开发音频录制功能(C/C++)"> 使用OpenSL ES开发音频录制功能(C/C++) </h1>

<div _ngcontent-foq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>OpenSL ES全称为Open Sound Library for Embedded Systems，是一个嵌入式、跨平台、免费的音频处理库。为嵌入式移动多媒体设备上的应用开发者提供标准化、高性能、低延迟的API。HarmonyOS的Native API基于<a href="https://www.khronos.org/" target="_blank">Khronos Group</a>开发的<a href="https://www.khronos.org/opensles/" target="_blank">OpenSL ES</a> 1.0.1 API 规范实现，开发者可以通过&lt;OpenSLES.h&gt;和&lt;OpenSLES_OpenHarmony.h&gt;在HarmonyOS上使用相关API。</p>  <div class="tiledSection"><h2 id="使用ohaudio替代opensl-es">使用OHAudio替代OpenSL ES<i class="anchor-icon anchor-icon-link" anchorid="使用ohaudio替代opensl-es" tips="复制节点链接"></i></h2><p>HarmonyOS上的OpenSL ES接口，是早期SDK8版本开始提供，用于支持应用Native层音频开发的接口。但随着版本演进，接口定义的可扩展性不足，不再能满足音频系统的能力拓展，因此当前已不再推荐应用开发者继续使用此接口进行音频功能开发，可能存在一些接口能力不足的缺陷。</p> <p>在SDK10版本，HarmonyOS推出了OHAudio接口，并将系统具备的所有音频功能都通过此接口开放。OHAudio接口已能够覆盖OpenSL ES在HarmonyOS中已提供的所有能力，并拓展支持音频焦点事件，低时延等新版本特性。</p> <p>OHAudio的开发指南见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/using-ohaudio-for-recording">使用OHAudio开发音频录制功能(C/C++)</a>。</p> <p>考虑到一些接入HarmonyOS较早的应用开发者，这里提供了一份OpenSL ES接口切换到OHAudio的对照参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/replace-opensles-by-ohaudio">OpenSL ES接口切换OHAudio参考</a>，便于开发者能够更快的在新版本切换到使用新接口。</p> </div>  <div class="tiledSection"><h2 id="harmonyos上的opensl-es">HarmonyOS上的OpenSL ES<i class="anchor-icon anchor-icon-link" anchorid="harmonyos上的opensl-es" tips="复制节点链接"></i></h2><p>OpenSL ES中提供了以下的接口，HarmonyOS当前仅实现了部分<a href="https://gitcode.com/openharmony/third_party_opensles/blob/master/api/1.0.1/OpenSLES.h" target="_blank">接口</a>，可以实现音频录制的基础功能。</p> <p>调用未实现接口后会返回**SL_RESULT_FEATURE_UNSUPPORTED，**当前没有相关扩展可以使用。</p> <p>以下列表列举了HarmonyOS上已实现的OpenSL ES的接口，具体说明请参考<a href="https://www.khronos.org/opensles/" target="_blank">OpenSL ES</a>规范：</p> <ul><li><p><strong>HarmonyOS上支持的SLInterfaceID：</strong></p>   <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.5.1.2.1.3.1.1" valign="top" width="50%">SLInterfaceID</th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.1.2.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">SL_IID_ENGINE</td> <td class="cellrowborder" valign="top" width="50%">通用引擎，提供创建录音对象接口。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SL_IID_RECORD</td> <td class="cellrowborder" valign="top" width="50%">提供录音状态接口。</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SL_IID_OH_BUFFERQUEUE</td> <td class="cellrowborder" valign="top" width="50%">提供音频录制流数据回调注册接口。</td> </tr>  </tbody></table></div> </div>  </li><li><p><strong>HarmonyOS上支持的Engine接口：</strong></p>  <ul><li>SLresult (*CreateAudioPlayer) (SLEngineItf self, SLObjectItf * pPlayer, SLDataSource *pAudioSrc, SLDataSink *pAudioSnk, SLuint32 numInterfaces, const SLInterfaceID * pInterfaceIds, const SLboolean * pInterfaceRequired)</li><li>SLresult (*CreateAudioRecorder) (SLEngineItf self, SLObjectItf * pRecorder, SLDataSource *pAudioSrc, SLDataSink *pAudioSnk, SLuint32 numInterfaces, const SLInterfaceID * pInterfaceIds, const SLboolean * pInterfaceRequired)</li><li>SLresult (*CreateOutputMix) (SLEngineItf self, SLObjectItf * pMix, SLuint32 numInterfaces, const SLInterfaceID * pInterfaceIds, const SLboolean * pInterfaceRequired)</li></ul>  </li><li><p><strong>HarmonyOS上支持的Object接口：</strong></p>  <ul><li>SLresult (*Realize) (SLObjectItf self, SLboolean async)</li><li>SLresult (*GetState) (SLObjectItf self, SLuint32 * pState)</li><li>SLresult (*GetInterface) (SLObjectItf self, const SLInterfaceID iid, void * pInterface)</li><li>void (*Destroy) (SLObjectItf self)</li></ul>  </li><li><p><strong>HarmonyOS上支持的Recorder接口：</strong></p>  <ul><li>SLresult (*SetRecordState) (SLRecordItf self, SLuint32 state)</li><li>SLresult (*GetRecordState) (SLRecordItf self,SLuint32 *pState)</li></ul>  </li><li><p><strong>HarmonyOS上支持的BufferQueue接口：</strong></p>  <p>以下接口需引入&lt;OpenSLES_OpenHarmony.h&gt;使用。</p>   <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.5.5.3.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.3.5.5.3.1.3.1.2" valign="top" width="50%">说明</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">SLresult (*Enqueue) (SLOHBufferQueueItf self, const void *buffer, SLuint32 size)</td> <td class="cellrowborder" valign="top" width="50%"><p>根据情况将buffer加到相应队列中。</p> <p>如果是播放操作，则将带有音频数据的buffer插入到filledBufferQ_队列中；如果是录音操作，则将录音使用后的空闲buffer插入到freeBufferQ_队列中。</p> <p>self：表示调用该函数的BufferQueue接口对象。</p> <p>buffer：播放时表示带有音频数据的buffer，录音时表示已存储完录音数据后的空闲buffer。</p> <p>size：表示buffer的大小。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SLresult (*Clear) (SLOHBufferQueueItf self)</td> <td class="cellrowborder" valign="top" width="50%"><p>释放BufferQueue接口对象。</p> <p>self：表示调用该函数的BufferQueue接口对象将被释放。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SLresult (*GetState) (SLOHBufferQueueItf self, SLOHBufferQueueState *state)</td> <td class="cellrowborder" valign="top" width="50%"><p>获取BufferQueue接口对象状态。</p> <p>self：表示调用该函数的BufferQueue接口对象。</p> <p>state：BufferQueue的当前状态。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SLresult (*RegisterCallback) (SLOHBufferQueueItf self, SlOHBufferQueueCallback callback, void* pContext)</td> <td class="cellrowborder" valign="top" width="50%"><p>注册回调函数。</p> <p>self：表示调用该函数的BufferQueue接口对象。</p> <p>callback：播放/录音时注册的回调函数。</p> <p>pContext：播放时传入待播放音频文件，录音时传入将要录制的音频文件。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">SLresult (*GetBuffer) (SLOHBufferQueueItf self, SLuint8** buffer, SLuint32* size)</td> <td class="cellrowborder" valign="top" width="50%"><p>根据情况获取相应的buffer。</p> <p>如果是播放操作，则从freeBufferQ_队列中获取空闲buffer；如果是录音操作，则从filledBufferQ_队列中获取携带录音数据的buffer。</p> <p>self：表示调用该函数的BufferQueue接口对象。</p> <p>buffer：播放时表示空闲的buffer，录音时表示携带录音数据的buffer。</p> <p>size：表示buffer的大小。</p> </td> </tr>  </tbody></table></div> </div>  </li></ul> </div>  <div class="tiledSection"><h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2></div>  <div class="tiledSection"><h3 id="在-cmake-脚本中链接动态库" class="firsth2">在 CMake 脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在-cmake-脚本中链接动态库" tips="复制节点链接"></i></h3><div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cmake prettyprint linenums hljs language-scss" hw-language="cmake" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(sample PUBLIC libOpenSLES.so)</li></ol></pre></div></div> <p>参考下列示例代码，完成音频录制。</p> <ol><li><p>添加头文件。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"SLES/OpenSLES.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"SLES/OpenSLES_OpenHarmony.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"SLES/OpenSLES_Platform.h"</span></span></li></ol></pre></div></div>  </li><li><p>使用slCreateEngine接口创建引擎对象和实例化引擎对象engine。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>SLObjectItf engineObject = <span class="hljs-literal">nullptr</span>;</li><li><span class="hljs-built_in">slCreateEngine</span>(&amp;engineObject, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>(*engineObject)-&gt;<span class="hljs-built_in">Realize</span>(engineObject, SL_BOOLEAN_FALSE);</li></ol></pre></div></div>  </li><li><p>获取接口SL_IID_ENGINE的引擎接口engineEngine实例。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>SLEngineItf engineItf = <span class="hljs-literal">nullptr</span>;</li><li>(*engineObject)-&gt;<span class="hljs-built_in">GetInterface</span>(engineObject, SL_IID_ENGINE, &amp;engineItf);</li></ol></pre></div></div>  </li><li><p>配置录音器信息（配置输入源audiosource、输出源audiosink），创建录音对象pcmCapturerObject。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>SLDataLocator_IODevice io_device = {</li><li>    SL_DATALOCATOR_IODEVICE,</li><li>    SL_IODEVICE_AUDIOINPUT,</li><li>    SL_DEFAULTDEVICEID_AUDIOINPUT,</li><li>    <span class="hljs-literal">NULL</span></li><li>};</li><li>SLDataSource audioSource = {</li><li>    &amp;io_device,</li><li>    <span class="hljs-literal">NULL</span></li><li>};</li><li>SLDataLocator_BufferQueue buffer_queue = {</li><li>    SL_DATALOCATOR_BUFFERQUEUE,</li><li>    <span class="hljs-number">3</span></li><li>};</li><li><span class="hljs-comment">// 具体参数需要根据音频文件格式进行适配。</span></li><li>SLDataFormat_PCM format_pcm = {</li><li>    SL_DATAFORMAT_PCM,           <span class="hljs-comment">// 输入的音频格式。</span></li><li>    <span class="hljs-number">1</span>,                           <span class="hljs-comment">// 单声道。</span></li><li>    SL_SAMPLINGRATE_44_1,        <span class="hljs-comment">// 采样率: 44100HZ。</span></li><li>    SL_PCMSAMPLEFORMAT_FIXED_16, <span class="hljs-comment">// 音频采样格式, 小端, 带符号的16位整数。</span></li><li>    <span class="hljs-number">16</span>,</li><li>    SL_SPEAKER_FRONT_LEFT,</li><li>    SL_BYTEORDER_LITTLEENDIAN</li><li>};</li><li>SLDataSink audioSink = {</li><li>    &amp;buffer_queue,</li><li>    &amp;format_pcm</li><li>};</li><li>
</li><li>SLObjectItf pcmCapturerObject = <span class="hljs-literal">nullptr</span>;</li><li>(*engineItf)-&gt;<span class="hljs-built_in">CreateAudioRecorder</span>(engineItf, &amp;pcmCapturerObject,</li><li>    &amp;audioSource, &amp;audioSink, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>(*pcmCapturerObject)-&gt;<span class="hljs-built_in">Realize</span>(pcmCapturerObject, SL_BOOLEAN_FALSE);</li></ol></pre></div></div>  </li><li><p>获取录音接口SL_IID_RECORD的recordItf接口实例。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>SLRecordItf  recordItf;</li><li>(*pcmCapturerObject)-&gt;<span class="hljs-built_in">GetInterface</span>(pcmCapturerObject, SL_IID_RECORD, &amp;recordItf);</li></ol></pre></div></div>  </li><li><p>获取接口SL_IID_OH_BUFFERQUEUE的bufferQueueItf实例。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>SLOHBufferQueueItf bufferQueueItf;</li><li>(*pcmCapturerObject)-&gt;<span class="hljs-built_in">GetInterface</span>(pcmCapturerObject, SL_IID_OH_BUFFERQUEUE, &amp;bufferQueueItf);</li></ol></pre></div></div>  </li><li><p>注册BufferQueueCallback回调。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">BufferQueueCallback</span><span class="hljs-params">(SLOHBufferQueueItf bufferQueueItf, <span class="hljs-type">void</span> *pContext, SLuint32 size)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 可从pContext获取注册时传入的使用者信息。</span></li><li>    SLuint8 *buffer = <span class="hljs-literal">nullptr</span>;</li><li>    SLuint32 pSize = <span class="hljs-number">0</span>;</li><li>    (*bufferQueueItf)-&gt;<span class="hljs-built_in">GetBuffer</span>(bufferQueueItf, &amp;buffer, &amp;pSize);</li><li>    <span class="hljs-keyword">if</span> (buffer != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-comment">// 可从buffer内读取录音数据进行后续处理。</span></li><li>        (*bufferQueueItf)-&gt;<span class="hljs-built_in">Enqueue</span>(bufferQueueItf, buffer, size);</li><li>    }</li><li>}</li><li><span class="hljs-type">void</span> *pContext; <span class="hljs-comment">// 可传入自定义的上下文信息，会在Callback内收到。</span></li><li>(*bufferQueueItf)-&gt;<span class="hljs-built_in">RegisterCallback</span>(bufferQueueItf, BufferQueueCallback, pContext);</li></ol></pre></div></div>  </li><li><p>开始录音。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>(*recordItf)-&gt;<span class="hljs-built_in">SetRecordState</span>(recordItf, SL_RECORDSTATE_RECORDING);</li></ol></pre></div></div>  </li><li><p>结束音频录制。</p>  <div _ngcontent-foq-c106="" class="highlight-div"><div _ngcontent-foq-c106="" class="highlight-div-header"><div _ngcontent-foq-c106="" class="highlight-div-header-left"><div _ngcontent-foq-c106="" class="handle-button expand-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-foq-c106="" class="highlight-div-header-right"><div _ngcontent-foq-c106="" class="handle-button ai-button"></div><div _ngcontent-foq-c106="" class="handle-button line-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-foq-c106="" class="handle-button theme-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-foq-c106="" class="handle-button copy-button"><div _ngcontent-foq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-foq-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li>(*recordItf)-&gt;<span class="hljs-built_in">SetRecordState</span>(recordItf, SL_RECORDSTATE_STOPPED);</li><li>(*pcmCapturerObject)-&gt;<span class="hljs-built_in">Destroy</span>(pcmCapturerObject);</li><li>(*engineObject)-&gt;<span class="hljs-built_in">Destroy</span>(engineObject);</li></ol></pre></div></div>  </li></ol> </div> </div> <div></div></div>