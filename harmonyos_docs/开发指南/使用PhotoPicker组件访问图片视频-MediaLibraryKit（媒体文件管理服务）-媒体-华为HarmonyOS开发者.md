<h1 _ngcontent-sfh-c119="" class="doc-title ng-star-inserted" title="使用PhotoPicker组件访问图片/视频"> 使用PhotoPicker组件访问图片/视频 </h1>

<div _ngcontent-sfh-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>当应用需要读取用户图片时，开发者可以在应用界面中嵌入PhotoPicker组件，在用户选择所需要的图片资源后，直接返回该图片资源，而不需要授予应用读取图片文件的权限，即可完成图片或视频文件的访问和读取。</p> <p>界面效果如图所示。</p> <div class="tbBox"><table class="simpletableborder"><tbody><tr><td valign="top"><p>宫格页</p> </td> <td valign="top"><p>大图页</p> </td> </tr> <tr><td valign="top"><p><span><img height="493.00745900000004" originheight="1960" originwidth="1253" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114419.90642135218094873773958977322735:50001231000000:2800:35A441E11A9DDD8103137DB6730FE6194DB04D55C06F87A33284B18610950F42.jpg" title="点击放大" width="316.20750000000004"></span></p> </td> <td valign="top"><p><span><img height="482.1915" originheight="1944" originwidth="1252" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114419.33547433663834069651725356162248:50001231000000:2800:652D05DA6B387122E26E271D087308CC69D18F77ACCDE66759ECC290E65949E0.jpg" title="点击放大" width="314.677335"></span></p> </td> </tr> </tbody></table></div> <div class="tiledSection"><h2 id="section98651036145412">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section98651036145412" tips="复制节点链接"></i></h2></div> <ol><li>导入PhotoPicker模块文件。<div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {</li><li>  <span class="hljs-title class_">PhotoPickerComponent</span>,</li><li>  <span class="hljs-title class_">PickerController</span>,</li><li>  <span class="hljs-title class_">PickerOptions</span>,</li><li>  <span class="hljs-title class_">DataType</span>,</li><li>  <span class="hljs-title class_">BaseItemInfo</span>,</li><li>  <span class="hljs-title class_">ItemInfo</span>,</li><li>  <span class="hljs-title class_">PhotoBrowserInfo</span>,</li><li>  <span class="hljs-title class_">ItemType</span>,</li><li>  <span class="hljs-title class_">ClickType</span>,</li><li>  <span class="hljs-title class_">MaxCountType</span>,</li><li>  <span class="hljs-title class_">PhotoBrowserRange</span>,</li><li>  <span class="hljs-title class_">ReminderMode</span>,</li><li>  photoAccessHelper</li><li>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li></ol></pre></div></div> </li><li>创建Picker组件配置选项实例（PickerOptions）和控制实例（PickerController）。<p>通过PickerOptions，开发者可配置Picker宫格的样式（如勾选框背景色、文本颜色等）、滑动预览方向、最大选择数量等参数，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#pickeroptions" target="_blank">PickerOptions API参考</a>。</p> <p>通过PickerController，应用可向Picker组件发送数据。</p> <div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-comment">// 组件初始化时设置参数信息。</span></li><li>  <span class="hljs-attr">pickerOptions</span>: <span class="hljs-title class_">PickerOptions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PickerOptions</span>();</li><li>
</li><li>  <span class="hljs-comment">// 组件初始化完成后，可控制组件部分行为。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">pickerController</span>: <span class="hljs-title class_">PickerController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PickerController</span>();</li><li>
</li><li>  <span class="hljs-comment">// 已选择的图片。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectUris</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>
</li><li>  <span class="hljs-comment">// 目前选择的图片。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  </li><li>  <span class="hljs-comment">// 是否显示大图。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isBrowserShow</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li></ol></pre></div></div> </li><li>应用界面出现时，初始化组件配置选项实例（PickerOptions）。<div class="p">此处仅列举实例用到的参数，当前支持的配置项及其取值范围详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#pickeroptions" target="_blank">PickerOptions API参考</a>。<div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置picker宫格页数据类型。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_VIDEO_TYPE</span> <span class="hljs-comment">// 图片和视频都显示。</span></li><li><span class="hljs-comment">// 最大选择数量。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">5</span>;</li><li><span class="hljs-comment">// 超出最大选择数量时。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">maxSelectedReminderMode</span> = <span class="hljs-title class_">ReminderMode</span>.<span class="hljs-property">TOAST</span>;</li><li><span class="hljs-comment">// 是否展示搜索框，默认false。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">isSearchSupported</span> = <span class="hljs-literal">true</span>;</li><li><span class="hljs-comment">// 是否支持拍照，默认false。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">isPhotoTakingSupported</span> = <span class="hljs-literal">true</span>;</li></ol></pre></div></div> </div> </li><li>实现回调函数。<p>通过实现以下回调事件，可在用户在界面操作时，将相关信息报给应用进行处理。</p> <ul><li>进退大图、切换大图回调，上报的大图相关信息详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#photobrowserinfo" target="_blank">PhotoBrowserInfo</a>。</li><li>勾选图片/视频，将上报图片URI供应用使用。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>回调返回的所有URI均为只读URI，开发者可以根据结果集中的URI读取文件数据。但不能在Picker的回调中直接使用此URI打开文档，需要定义一个全局变量保存URI，样例可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker#指定uri读取文件数据" target="_blank">指定URI读取文件数据</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/photoaccesshelper-photoviewpicker#指定uri获取图片或视频资源" target="_blank">指定URI获取图片或视频资源</a>。</li><li>如需获取元数据，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs" target="_blank">文件管理</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fileuri" target="_blank">文件URI</a>接口，根据uri获取部分文件属性信息，比如文件大小、访问时间、修改时间、文件名、文件路径等。</li></ul> </div></div></div> </li><li>点击图片（缩略图item），将上报图片/视频信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#iteminfo" target="_blank">ItemInfo</a>；点击相机item，可拉起系统相机或应用自行处理。</li></ul> <div class="p">支持的回调事件及其参数请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#photopickercomponent" target="_blank">PhotoPickerComponent API参考</a>。<div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 资源被选中回调，返回资源的信息，以及选中方式。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onItemClicked</span>(<span class="hljs-attr">itemInfo</span>: <span class="hljs-title class_">ItemInfo</span>, <span class="hljs-attr">clickType</span>: <span class="hljs-title class_">ClickType</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-keyword">if</span> (!itemInfo) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">ItemType</span> | <span class="hljs-literal">undefined</span> = itemInfo.<span class="hljs-property">itemType</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = itemInfo.<span class="hljs-property">uri</span>;</li><li>  <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-title class_">ItemType</span>.<span class="hljs-property">CAMERA</span>) {</li><li>    <span class="hljs-comment">// 点击相机item。</span></li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true则拉起系统相机，若应用需要自行处理则返回false。</span></li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-keyword">if</span> (clickType === <span class="hljs-title class_">ClickType</span>.<span class="hljs-property">SELECTED</span>) {</li><li>      <span class="hljs-comment">// 应用做自己的业务处理。</span></li><li>      <span class="hljs-keyword">if</span> (uri) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-title function_">push</span>(uri);</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">preselectedUris</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>];</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true则勾选，否则则不响应勾选。</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">if</span> (uri) {</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">return</span> item != uri;</li><li>        });</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">preselectedUris</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>];</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 进入大图的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onEnterPhotoBrowser</span>(<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBrowserShow</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 退出大图的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onExitPhotoBrowser</span>(<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBrowserShow</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 接收到该回调后，便可通过pickerController相关接口向picker发送数据，在此之前不生效。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onPickerControllerReady</span>(): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">elements</span>: <span class="hljs-built_in">number</span>[] = [<span class="hljs-title class_">PhotoBrowserUIElement</span>.<span class="hljs-property">BACK_BUTTON</span>];</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">setPhotoBrowserUIElementVisibility</span>(elements, <span class="hljs-literal">false</span>); <span class="hljs-comment">// 设置大图页不显示返回按钮。</span></li><li>}</li><li>
</li><li><span class="hljs-comment">// 大图左右滑动的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onPhotoBrowserChanged</span>(<span class="hljs-attr">browserItemInfo</span>: <span class="hljs-title class_">BaseItemInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUri</span> = browserItemInfo.<span class="hljs-property">uri</span> ?? <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 已勾选图片被删除时的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onSelectedItemsDeleted</span>(<span class="hljs-attr">baseItemInfos</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">BaseItemInfo</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>}</li><li>
</li><li><span class="hljs-comment">// 超过最大选择数量再次点击时的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onExceedMaxSelected</span>(<span class="hljs-attr">exceedMaxCountType</span>: <span class="hljs-title class_">MaxCountType</span>): <span class="hljs-built_in">void</span> {</li><li>}</li><li>
</li><li><span class="hljs-comment">// 当前相册被删除时的回调。</span></li><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onCurrentAlbumDeleted</span>(): <span class="hljs-built_in">void</span> {</li><li>}</li></ol></pre></div></div> </div> </li><li>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#photopickercomponent" target="_blank">PhotoPickerComponent</a>组件。<div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>  <span class="hljs-title class_">PhotoPickerComponent</span>({</li><li>    <span class="hljs-attr">pickerOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>,</li><li>    <span class="hljs-attr">onItemClicked</span>: (<span class="hljs-attr">itemInfo</span>: <span class="hljs-title class_">ItemInfo</span>, <span class="hljs-attr">clickType</span>: <span class="hljs-title class_">ClickType</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onItemClicked</span>(itemInfo, clickType),</li><li>    <span class="hljs-attr">onEnterPhotoBrowser</span>: (<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onEnterPhotoBrowser</span>(photoBrowserInfo),</li><li>    <span class="hljs-attr">onExitPhotoBrowser</span>: (<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onExitPhotoBrowser</span>(photoBrowserInfo),</li><li>    <span class="hljs-attr">onPickerControllerReady</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPickerControllerReady</span>(),</li><li>    <span class="hljs-attr">onPhotoBrowserChanged</span>: (<span class="hljs-attr">browserItemInfo</span>: <span class="hljs-title class_">BaseItemInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPhotoBrowserChanged</span>(browserItemInfo),</li><li>    <span class="hljs-attr">onSelectedItemsDeleted</span>: <span class="hljs-function">(<span class="hljs-params">BaseItemInfo: <span class="hljs-built_in">Array</span>&lt;BaseItemInfo&gt;</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSelectedItemsDeleted</span>(<span class="hljs-title class_">BaseItemInfo</span>),</li><li>    <span class="hljs-attr">onExceedMaxSelected</span>: <span class="hljs-function">(<span class="hljs-params">exceedMaxCountType: MaxCountType</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onExceedMaxSelected</span>(exceedMaxCountType),</li><li>    <span class="hljs-attr">onCurrentAlbumDeleted</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onCurrentAlbumDeleted</span>(),</li><li>    <span class="hljs-attr">pickerController</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>,</li><li>  })</li></ol></pre></div></div> </li><li>通过PickerController向Picker组件发送数据，实现控制PhotoPickerComponent组件行为。<p>存在多种用法，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#pickercontroller" target="_blank">PickerController</a>API文档。</p> </li></ol> <div class="tiledSection"><h2 id="section129721434173814">完整示例<i class="anchor-icon anchor-icon-link" anchorid="section129721434173814" tips="复制节点链接"></i></h2><div _ngcontent-sfh-c106="" class="highlight-div"><div _ngcontent-sfh-c106="" class="highlight-div-header"><div _ngcontent-sfh-c106="" class="highlight-div-header-left"><div _ngcontent-sfh-c106="" class="handle-button expand-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sfh-c106="" class="highlight-div-header-right"><div _ngcontent-sfh-c106="" class="handle-button ai-button"></div><div _ngcontent-sfh-c106="" class="handle-button line-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sfh-c106="" class="handle-button theme-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sfh-c106="" class="handle-button copy-button"><div _ngcontent-sfh-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sfh-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> {</li><li>  <span class="hljs-title class_">PhotoPickerComponent</span>,</li><li>  <span class="hljs-title class_">PickerController</span>,</li><li>  <span class="hljs-title class_">PickerOptions</span>,</li><li>  <span class="hljs-title class_">DataType</span>,</li><li>  <span class="hljs-title class_">BaseItemInfo</span>,</li><li>  <span class="hljs-title class_">ItemInfo</span>,</li><li>  <span class="hljs-title class_">PhotoBrowserInfo</span>,</li><li>  <span class="hljs-title class_">ItemType</span>,</li><li>  <span class="hljs-title class_">ClickType</span>,</li><li>  <span class="hljs-title class_">MaxCountType</span>,</li><li>  <span class="hljs-title class_">PhotoBrowserRange</span>,</li><li>  <span class="hljs-title class_">ReminderMode</span>,</li><li>  photoAccessHelper</li><li>} <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">PhotoPickerComponentDemo</span> {</li><li>  <span class="hljs-comment">// 组件初始化时设置参数信息。</span></li><li>  <span class="hljs-attr">pickerOptions</span>: <span class="hljs-title class_">PickerOptions</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PickerOptions</span>();</li><li>
</li><li>  <span class="hljs-comment">// 组件初始化完成后，可控制组件部分行为。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">pickerController</span>: <span class="hljs-title class_">PickerController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PickerController</span>();</li><li>
</li><li>  <span class="hljs-comment">// 已选择的图片。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectUris</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>
</li><li>  <span class="hljs-comment">// 目前选择的图片。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">currentUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-comment">// 是否显示大图。</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">isBrowserShow</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 设置picker宫格页数据类型</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">MIMEType</span> = photoAccessHelper.<span class="hljs-property">PhotoViewMIMETypes</span>.<span class="hljs-property">IMAGE_VIDEO_TYPE</span> <span class="hljs-comment">// 图片和视频都显示。</span></li><li>    <span class="hljs-comment">// 最大选择数量。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">maxSelectNumber</span> = <span class="hljs-number">5</span>;</li><li>    <span class="hljs-comment">// 超出最大选择数量时。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">maxSelectedReminderMode</span> = <span class="hljs-title class_">ReminderMode</span>.<span class="hljs-property">TOAST</span>;</li><li>    <span class="hljs-comment">// 是否展示搜索框，默认false。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">isSearchSupported</span> = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-comment">// 是否支持拍照，默认false。</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">isPhotoTakingSupported</span> = <span class="hljs-literal">true</span>;</li><li>
</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 资源被选中回调，返回资源的信息，以及选中方式。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onItemClicked</span>(<span class="hljs-attr">itemInfo</span>: <span class="hljs-title class_">ItemInfo</span>, <span class="hljs-attr">clickType</span>: <span class="hljs-title class_">ClickType</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (!itemInfo) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">type</span>: <span class="hljs-title class_">ItemType</span> | <span class="hljs-literal">undefined</span> = itemInfo.<span class="hljs-property">itemType</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = itemInfo.<span class="hljs-property">uri</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">type</span> === <span class="hljs-title class_">ItemType</span>.<span class="hljs-property">CAMERA</span>) {</li><li>      <span class="hljs-comment">// 点击相机item。</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true则拉起系统相机，若应用需要自行处理则返回false。</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">if</span> (clickType === <span class="hljs-title class_">ClickType</span>.<span class="hljs-property">SELECTED</span>) {</li><li>        <span class="hljs-comment">// 应用做自己的业务处理。</span></li><li>        <span class="hljs-keyword">if</span> (uri) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-title function_">push</span>(uri);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">preselectedUris</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>];</li><li>        }</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true则勾选，否则则不响应勾选。</span></li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">if</span> (uri) {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">return</span> item != uri;</li><li>          });</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>.<span class="hljs-property">preselectedUris</span> = [...<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>];</li><li>        }</li><li>      }</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 进入大图的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onEnterPhotoBrowser</span>(<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBrowserShow</span> = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 退出大图的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onExitPhotoBrowser</span>(<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isBrowserShow</span> = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 接收到该回调后，便可通过pickerController相关接口向picker发送数据，在此之前不生效。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onPickerControllerReady</span>(): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 大图左右滑动的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onPhotoBrowserChanged</span>(<span class="hljs-attr">browserItemInfo</span>: <span class="hljs-title class_">BaseItemInfo</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUri</span> = browserItemInfo.<span class="hljs-property">uri</span> ?? <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 已勾选图片被删除时的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onSelectedItemsDeleted</span>(<span class="hljs-attr">baseItemInfos</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">BaseItemInfo</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 超过最大选择数量再次点击时的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onExceedMaxSelected</span>(<span class="hljs-attr">exceedMaxCountType</span>: <span class="hljs-title class_">MaxCountType</span>): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 当前相册被删除时的回调。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">onCurrentAlbumDeleted</span>(): <span class="hljs-built_in">void</span> {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({</li><li>      <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>,</li><li>      <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span></li><li>    }) {</li><li>      <span class="hljs-title class_">PhotoPickerComponent</span>({</li><li>        <span class="hljs-attr">pickerOptions</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerOptions</span>,</li><li>        <span class="hljs-attr">onItemClicked</span>: (<span class="hljs-attr">itemInfo</span>: <span class="hljs-title class_">ItemInfo</span>, <span class="hljs-attr">clickType</span>: <span class="hljs-title class_">ClickType</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onItemClicked</span>(itemInfo, clickType),</li><li>        <span class="hljs-attr">onEnterPhotoBrowser</span>: (<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onEnterPhotoBrowser</span>(photoBrowserInfo),</li><li>        <span class="hljs-attr">onExitPhotoBrowser</span>: (<span class="hljs-attr">photoBrowserInfo</span>: <span class="hljs-title class_">PhotoBrowserInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onExitPhotoBrowser</span>(photoBrowserInfo),</li><li>        <span class="hljs-attr">onPickerControllerReady</span>: (): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPickerControllerReady</span>(),</li><li>        <span class="hljs-attr">onPhotoBrowserChanged</span>: (<span class="hljs-attr">browserItemInfo</span>: <span class="hljs-title class_">BaseItemInfo</span>): <span class="hljs-function"><span class="hljs-params">boolean</span> =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onPhotoBrowserChanged</span>(browserItemInfo),</li><li>        <span class="hljs-attr">onSelectedItemsDeleted</span>: <span class="hljs-function">(<span class="hljs-params">BaseItemInfo: <span class="hljs-built_in">Array</span>&lt;BaseItemInfo&gt;</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onSelectedItemsDeleted</span>(<span class="hljs-title class_">BaseItemInfo</span>),</li><li>        <span class="hljs-attr">onExceedMaxSelected</span>: <span class="hljs-function">(<span class="hljs-params">exceedMaxCountType: MaxCountType</span>) =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onExceedMaxSelected</span>(exceedMaxCountType),</li><li>        <span class="hljs-attr">onCurrentAlbumDeleted</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">onCurrentAlbumDeleted</span>(),</li><li>        <span class="hljs-attr">pickerController</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>,</li><li>      })</li><li>
</li><li>      <span class="hljs-comment">// 这里模拟应用侧底部的选择栏。</span></li><li>      <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isBrowserShow</span>) {</li><li>        <span class="hljs-comment">// 已选择的图片缩略图。</span></li><li>        <span class="hljs-title class_">Row</span>() {</li><li>          <span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>, <span class="hljs-function">(<span class="hljs-params">uri: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (uri === <span class="hljs-variable language_">this</span>.<span class="hljs-property">currentUri</span>) {</li><li>              <span class="hljs-title class_">Image</span>(uri).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>                .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                })</li><li>                .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>                .<span class="hljs-title function_">borderColor</span>(<span class="hljs-string">'red'</span>)</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-title class_">Image</span>(uri).<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">setData</span>(<span class="hljs-title class_">DataType</span>.<span class="hljs-property">SET_SELECTED_URIS</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>);</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">setPhotoBrowserItem</span>(uri, <span class="hljs-title class_">PhotoBrowserRange</span>.<span class="hljs-property">ALL</span>);</li><li>              })</li><li>            }</li><li>          }, <span class="hljs-function">(<span class="hljs-params">uri: <span class="hljs-built_in">string</span></span>) =&gt;</span> <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(uri))</li><li>        }.<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-property">length</span> ? <span class="hljs-number">10</span> : <span class="hljs-number">0</span>)</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 进入大图，预览已选择的图片。</span></li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'预览'</span>).<span class="hljs-title function_">width</span>(<span class="hljs-string">'33%'</span>).<span class="hljs-title function_">alignSelf</span>(<span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Start</span>).<span class="hljs-title function_">height</span>(<span class="hljs-string">'5%'</span>).<span class="hljs-title function_">margin</span>(<span class="hljs-number">10</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">setPhotoBrowserItem</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectUris</span>[<span class="hljs-number">0</span>], <span class="hljs-title class_">PhotoBrowserRange</span>.<span class="hljs-property">SELECTED_ONLY</span>);</li><li>          }</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>