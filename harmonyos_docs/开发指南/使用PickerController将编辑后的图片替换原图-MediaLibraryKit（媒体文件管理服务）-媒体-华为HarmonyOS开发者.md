<h1 _ngcontent-pwd-c119="" class="doc-title ng-star-inserted" title="使用PickerController将编辑后的图片替换原图"> 使用PickerController将编辑后的图片替换原图 </h1>

<div _ngcontent-pwd-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section139531411112816">替换PhotoPicker中显示的图片/视频<i class="anchor-icon anchor-icon-link" anchorid="section139531411112816" tips="复制节点链接"></i></h2><p>应用可获得用户从Picker选择的图片、视频的访问权限，读取图片、视频后进行编辑、修改。完成编辑修改后的图片/视频缓存到应用沙箱后，可调用本API，将编辑结果文件发送给PhotoPicker，并指定替换显示的原图。Picker根据指定将接收的编辑结果文件替换原图片进行显示。</p> <p>效果如图所示。</p> <p><span><img height="511.45150000000007" originheight="857" originwidth="468" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114421.88899606672693014558809118479484:50001231000000:2800:3BD57C482F8E24839F8D7A42840DC404A11E748A69B38904416A93E29324217E.gif" title="点击放大" width="279.3"></span></p> </div> <div class="tiledSection"><h3 id="section59774482913" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section59774482913" tips="复制节点链接"></i></h3><ol><li>导入选择器模块和文件管理模块。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PickerController</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.file.PhotoPickerComponent'</span>;</li><li><span class="hljs-keyword">import</span> { fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li></ol></pre></div></div> </li><li>创建参数列表。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">pickerController</span>: PickerController = new <span class="hljs-built_in">PickerController</span>();</li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">originUrl</span>: string = <span class="hljs-string">''</span>; <span class="hljs-comment">// 原图URI</span></li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">replaceUrl</span>: string = <span class="hljs-string">''</span>; <span class="hljs-comment">// 原图编辑后的沙箱URI</span></li></ol></pre></div></div> </li><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#replacephotopickerpreview15" target="_blank">replacePhotoPickerPreview()</a>替换图片/视频。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">replacePhotoPickerPreview</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">originUrl</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">replaceUrl</span>, <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"hello this.pickerController.replaceUrl code res:"</span> + b)</li><li>})</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="section186741448316">将Picker上替换显示的图片/视频保存到图库<i class="anchor-icon anchor-icon-link" anchorid="section186741448316" tips="复制节点链接"></i></h2><p>应用指定保存的文件，需在替换显示的范围内。应用调用API后，PhotoPicker将在Picker上成功替换显示的图片、视频保存到图库。确保保存的内容与替换显示的图片、视频一致。</p> <p>效果如图所示。</p> <p><span><img height="511.45150000000007" originheight="857" originwidth="468" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114421.85548956295785069087624755117582:50001231000000:2800:D446CFC4261A4F49501B7D54459D58B5C8C9B772B180AD9ABAA0E5DBC5003C92.gif" title="点击放大" width="279.3"></span></p> </div> <div class="tiledSection"><h3 id="section1583583615315" class="firsth2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section1583583615315" tips="复制节点链接"></i></h3><ol><li>导入选择器模块和文件管理模块。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> photoAccessHelper <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.file.photoAccessHelper'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">PickerController</span>, <span class="hljs-title class_">PickerOptions</span>, <span class="hljs-title class_">SaveMode</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.file.PhotoPickerComponent'</span>;</li><li><span class="hljs-keyword">import</span> { fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li></ol></pre></div></div> </li><li>创建参数列表。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-less" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">pickerController</span>: PickerController = new <span class="hljs-built_in">PickerController</span>();</li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">originUrl</span>: string = <span class="hljs-string">''</span>; <span class="hljs-comment">// 原图URI</span></li><li><span class="hljs-variable">@State</span> <span class="hljs-attribute">replaceUrl</span>: string = <span class="hljs-string">''</span>; <span class="hljs-comment">// 原图编辑后的沙箱URI</span></li></ol></pre></div></div> </li><li>调用saveTrustedPhotoAssets()保存图片/视频到图库。<div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">pickerController</span>.<span class="hljs-title function_">saveTrustedPhotoAssets</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">replaceUris</span>, <span class="hljs-function">(<span class="hljs-params">a, b</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">"hello this.pickerController.save as new code a.code:"</span> + a.<span class="hljs-property">code</span> + <span class="hljs-string">",a.message:"</span> + a.<span class="hljs-property">message</span> + <span class="hljs-string">",res:"</span> + b)</li><li>}, photoCreationConfigs, <span class="hljs-title class_">SaveMode</span>.<span class="hljs-property">SAVE_AS</span>); <span class="hljs-comment">// SaveMode: SAVE_AS = 0(另存为)，OVERWRITE = 1 （覆盖保存）</span></li></ol></pre></div></div> <p>该接口使用依赖<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#replacephotopickerpreview15" target="_blank">pickerController.replacePhotoPickerPreview</a>，需要先执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#replacephotopickerpreview15" target="_blank">pickerController.replacePhotoPickerPreview</a>后才能执行<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ohos-file-photopickercomponent#savetrustedphotoassets15" target="_blank">pickerController.saveTrustedPhotoAssets</a>。</p> </li></ol> </div> <div class="tiledSection"><h3 id="section1228128173319">完整示例<i class="anchor-icon anchor-icon-link" anchorid="section1228128173319" tips="复制节点链接"></i></h3><div _ngcontent-pwd-c106="" class="highlight-div"><div _ngcontent-pwd-c106="" class="highlight-div-header"><div _ngcontent-pwd-c106="" class="highlight-div-header-left"><div _ngcontent-pwd-c106="" class="handle-button expand-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pwd-c106="" class="highlight-div-header-right"><div _ngcontent-pwd-c106="" class="handle-button ai-button"></div><div _ngcontent-pwd-c106="" class="handle-button line-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pwd-c106="" class="handle-button theme-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pwd-c106="" class="handle-button copy-button"><div _ngcontent-pwd-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pwd-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> photoAccessHelper from <span class="hljs-string">'@ohos.file.photoAccessHelper'</span>;</li><li><span class="hljs-keyword">import</span> {</li><li>  PhotoPickerComponent,</li><li>  PickerController,</li><li>  PickerOptions,</li><li>  ItemInfo,</li><li>  PhotoBrowserInfo,</li><li>  ItemType,</li><li>  ClickType,</li><li>  MaxCountType,</li><li>  BaseItemInfo,</li><li>  SaveMode,</li><li>} from <span class="hljs-string">'@ohos.file.PhotoPickerComponent'</span>;</li><li><span class="hljs-keyword">import</span> { AlbumPickerOptions } from <span class="hljs-string">'@ohos.file.AlbumPickerComponent'</span>;</li><li><span class="hljs-keyword">import</span> { common } from <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { AsyncCallback } from <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileUri } from <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-keyword">private</span> context = getContext(<span class="hljs-keyword">this</span>) <span class="hljs-keyword">as</span> common.UIAbilityContext;</li><li>  <span class="hljs-meta">@State</span> pickerController: PickerController = new PickerController();</li><li>  pickerOptions: PickerOptions = new PickerOptions();</li><li>  albumOptions: AlbumPickerOptions = new AlbumPickerOptions();</li><li>  <span class="hljs-meta">@State</span> selectedUris: Array&lt;string&gt; = new Array&lt;string&gt;();</li><li>  <span class="hljs-meta">@State</span> allBackGroundColor: number = <span class="hljs-number">0xf1f3f5</span>;</li><li>  <span class="hljs-meta">@State</span> isShowAll: boolean = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> isShowVideo: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> isShowPhoto: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> isShowAlbum: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">private</span> isBlock: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> isInPhotoBrowser: boolean = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> isShow: boolean = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-meta">@State</span> originUrl: string = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> trustedUris: Array&lt;string&gt; = new Array&lt;string&gt;();</li><li>
</li><li>  <span class="hljs-keyword">private</span> onEnterPhotoBrowser(photoBrowserInfo: PhotoBrowserInfo): boolean {</li><li>    <span class="hljs-keyword">this</span>.isInPhotoBrowser = <span class="hljs-literal">true</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onExitPhotoBrowser(photoBrowserInfo: PhotoBrowserInfo): boolean {</li><li>    <span class="hljs-keyword">this</span>.isInPhotoBrowser = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onPickerControllerReady(): void {</li><li>    <span class="hljs-keyword">this</span>.isShow = <span class="hljs-literal">false</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onSelect(uri: string): void {</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.preselectedUris = [...<span class="hljs-keyword">this</span>.selectedUris];</li><li>    <span class="hljs-keyword">this</span>.originUrl = uri;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onDeselect(uri: string): void {</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.preselectedUris = [...<span class="hljs-keyword">this</span>.selectedUris];</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onItemClicked(itemInfo: ItemInfo, clickType: ClickType): boolean {</li><li>    <span class="hljs-keyword">if</span> (!itemInfo) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>    let type: ItemType | undefined = itemInfo.itemType;</li><li>    let uri: string | undefined = itemInfo.uri;</li><li>    <span class="hljs-keyword">if</span> (type === ItemType.CAMERA) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (type === ItemType.THUMBNAIL) {</li><li>      <span class="hljs-keyword">if</span> (clickType === ClickType.SELECTED) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.isBlock) {</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (uri) {</li><li>          <span class="hljs-keyword">this</span>.selectedUris.push(uri);</li><li>          <span class="hljs-keyword">this</span>.pickerOptions.preselectedUris = [...<span class="hljs-keyword">this</span>.selectedUris];</li><li>        }</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-keyword">if</span> (uri) {</li><li>          <span class="hljs-keyword">this</span>.selectedUris = <span class="hljs-keyword">this</span>.selectedUris.filter((item: string) =&gt; {</li><li>            <span class="hljs-keyword">return</span> item !== uri;</li><li>          })</li><li>          <span class="hljs-keyword">this</span>.pickerOptions.preselectedUris = [...<span class="hljs-keyword">this</span>.selectedUris];</li><li>        }</li><li>      }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onSelectedItemsDeleted(baseItemInfos: Array&lt;BaseItemInfo&gt;): void {</li><li>    <span class="hljs-keyword">for</span> (let info of baseItemInfos) {</li><li>      <span class="hljs-keyword">if</span> (info?.uri) {</li><li>        <span class="hljs-keyword">this</span>.selectedUris = <span class="hljs-keyword">this</span>.selectedUris.filter((item: string) =&gt; {</li><li>          <span class="hljs-keyword">return</span> info?.uri != item;</li><li>        })</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onExceedMaxSelected(exceedMaxCountType: MaxCountType): void {</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> onCurrentAlbumDeleted(): void {</li><li>  }</li><li>
</li><li>  aboutToAppear() {</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.MIMEType = photoAccessHelper.PhotoViewMIMETypes.IMAGE_VIDEO_TYPE;</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.isPreviewForSingleSelectionSupported = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.isSlidingSelectionSupported = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">this</span>.pickerOptions.isRepeatSelectSupported = <span class="hljs-literal">false</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@State</span> currentIndex: number = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> controller: TabsController = new TabsController();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  tabBuilder(index: number, name: string) {</li><li>    Column() {</li><li>      Text(name)</li><li>        .fontColor(<span class="hljs-keyword">this</span>.currentIndex === index ? <span class="hljs-string">'#007DFF'</span> : <span class="hljs-string">'#182431222'</span>)</li><li>        .fontSize(<span class="hljs-number">16</span>)</li><li>        .fontWeight(<span class="hljs-keyword">this</span>.currentIndex === index ? <span class="hljs-number">500</span> : <span class="hljs-number">400</span>)</li><li>        .lineHeight(<span class="hljs-number">22</span>)</li><li>        .margin({ top: <span class="hljs-number">17</span>, bottom: <span class="hljs-number">7</span> })</li><li>        .zIndex(<span class="hljs-number">1</span>)</li><li>      Divider()</li><li>        .strokeWidth(<span class="hljs-number">2</span>)</li><li>        .color(<span class="hljs-string">'#007DFF'</span>)</li><li>        .opacity(<span class="hljs-keyword">this</span>.currentIndex === index ? <span class="hljs-number">1</span> : <span class="hljs-number">0</span>)</li><li>    }.width(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  handle(callback: AsyncCallback&lt;number&gt;): Promise&lt;number&gt; {</li><li>    let num = <span class="hljs-number">1</span></li><li>    <span class="hljs-keyword">return</span> new Promise((resolve, reject) =&gt; {</li><li>      <span class="hljs-keyword">if</span> (num == <span class="hljs-number">1</span>) {</li><li>        resolve(<span class="hljs-number">100</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        reject(<span class="hljs-number">100</span>);</li><li>      }</li><li>    })</li><li>  }</li><li>
</li><li>  build() {</li><li>    Row() {</li><li>      Stack() {</li><li>        Column() {</li><li>          Row() {</li><li>            Button(<span class="hljs-string">'另存为'</span>).width(<span class="hljs-string">'25%'</span>).height(<span class="hljs-string">'50%'</span>).margin({ top: <span class="hljs-number">10</span> }).onClick(() =&gt; {</li><li>              console.log(<span class="hljs-string">"----save as new:--------------------------------------------"</span>);</li><li>              let replaceUris: Array&lt;string&gt; = [];</li><li>              <span class="hljs-keyword">this</span>.trustedUris.forEach((uri: string) =&gt; {</li><li>                replaceUris.push(uri);</li><li>              });</li><li>              <span class="hljs-keyword">this</span>.trustedUris.splice(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.trustedUris.length);</li><li>              <span class="hljs-keyword">this</span>.pickerController.saveTrustedPhotoAssets(replaceUris, (a, b) =&gt; {</li><li>                console.log(<span class="hljs-string">"this.pickerController.save as new, res:"</span> + b);</li><li>              }, undefined, SaveMode.SAVE_AS);</li><li>            }).margin(<span class="hljs-number">10</span>)</li><li>
</li><li>            Button(<span class="hljs-string">'覆盖保存'</span>).width(<span class="hljs-string">'25%'</span>).height(<span class="hljs-string">'50%'</span>).margin({ top: <span class="hljs-number">10</span> }).onClick(() =&gt; {</li><li>              console.log(<span class="hljs-string">"----save as overwrite:--------------------------------------------"</span>);</li><li>              let replaceUris: Array&lt;string&gt; = [];</li><li>              <span class="hljs-keyword">this</span>.trustedUris.forEach((uri: string) =&gt; {</li><li>                replaceUris.push(uri);</li><li>              });</li><li>              <span class="hljs-keyword">this</span>.trustedUris.splice(<span class="hljs-number">0</span>, <span class="hljs-keyword">this</span>.trustedUris.length);</li><li>
</li><li>              <span class="hljs-keyword">this</span>.pickerController.saveTrustedPhotoAssets(replaceUris, (a, b) =&gt; {</li><li>                console.log(<span class="hljs-string">"this.pickerController.save override, res:"</span> + b)</li><li>              }, undefined, SaveMode.OVERWRITE);</li><li>            }).margin(<span class="hljs-number">10</span>)</li><li>
</li><li>            Button(<span class="hljs-string">'Replace Url'</span>).width(<span class="hljs-string">'25%'</span>).height(<span class="hljs-string">'50%'</span>).margin({ top: <span class="hljs-number">10</span> }).onClick(() =&gt; {</li><li>              let mediaType = <span class="hljs-keyword">this</span>.originUrl.split(<span class="hljs-string">'.'</span>)[<span class="hljs-keyword">this</span>.originUrl.split(<span class="hljs-string">'.'</span>).length - <span class="hljs-number">1</span>];</li><li>              let boxPath = <span class="hljs-keyword">this</span>.getReplaceUri(mediaType);</li><li>              <span class="hljs-keyword">this</span>.trustedUris.push(boxPath);</li><li>              <span class="hljs-keyword">this</span>.pickerController.replacePhotoPickerPreview(<span class="hljs-keyword">this</span>.originUrl, boxPath, (a, b) =&gt; {</li><li>                console.log(<span class="hljs-string">"this.pickerController.replaceUrl code"</span> + JSON.stringify(a) + <span class="hljs-string">", res:"</span> + JSON.stringify(b))</li><li>              })</li><li>            }).margin(<span class="hljs-number">10</span>)</li><li>          }.width(<span class="hljs-string">'100%'</span>).height(<span class="hljs-string">'10%'</span>)</li><li>
</li><li>          Row() {</li><li>            ForEach(<span class="hljs-keyword">this</span>.selectedUris, (uri: string) =&gt; {</li><li>              Image(uri).height(<span class="hljs-string">'95%'</span>).width(<span class="hljs-string">'20%'</span>).backgroundColor(<span class="hljs-keyword">this</span>.allBackGroundColor).onClick(() =&gt; {</li><li>              })</li><li>            }, (uri: string) =&gt; JSON.stringify(uri))</li><li>          }.width(<span class="hljs-string">'100%'</span>).height(<span class="hljs-string">'15%'</span>)</li><li>
</li><li>          Tabs({ barPosition: BarPosition.Start, index: <span class="hljs-keyword">this</span>.currentIndex, controller: <span class="hljs-keyword">this</span>.controller }) {</li><li>            TabContent() {</li><li>              PhotoPickerComponent({</li><li>                pickerOptions: <span class="hljs-keyword">this</span>.pickerOptions,</li><li>                onSelect: (uri: string): void =&gt; <span class="hljs-keyword">this</span>.onSelect(uri),</li><li>                onDeselect: (uri: string): void =&gt; <span class="hljs-keyword">this</span>.onDeselect(uri),</li><li>                onItemClicked: (itemInfo: ItemInfo, clickType: ClickType): boolean =&gt; <span class="hljs-keyword">this</span>.onItemClicked(itemInfo,</li><li>                  clickType),</li><li>                onEnterPhotoBrowser: (photoBrowserInfo: PhotoBrowserInfo): boolean =&gt; <span class="hljs-keyword">this</span>.onEnterPhotoBrowser(photoBrowserInfo),</li><li>                onExitPhotoBrowser: (photoBrowserInfo: PhotoBrowserInfo): boolean =&gt; <span class="hljs-keyword">this</span>.onExitPhotoBrowser(photoBrowserInfo),</li><li>                onPickerControllerReady: (): void =&gt; <span class="hljs-keyword">this</span>.onPickerControllerReady(),</li><li>                onSelectedItemsDeleted: (baseItemInfos: Array&lt;BaseItemInfo&gt;): void =&gt; <span class="hljs-keyword">this</span>.onSelectedItemsDeleted(baseItemInfos),</li><li>                onExceedMaxSelected: (maxCountType: MaxCountType): void =&gt; <span class="hljs-keyword">this</span>.onExceedMaxSelected(maxCountType),</li><li>                onCurrentAlbumDeleted: (): void =&gt; <span class="hljs-keyword">this</span>.onCurrentAlbumDeleted(),</li><li>                pickerController: <span class="hljs-keyword">this</span>.pickerController,</li><li>              }).height(<span class="hljs-string">'87%'</span>).width(<span class="hljs-string">'100%'</span>).defaultFocus(<span class="hljs-literal">true</span>)</li><li>            }.tabBar(<span class="hljs-keyword">this</span>.tabBuilder(<span class="hljs-number">0</span>, <span class="hljs-string">'全部'</span>))</li><li>          }</li><li>          .vertical(<span class="hljs-literal">false</span>)</li><li>          .barMode(BarMode.Fixed)</li><li>          .barWidth(<span class="hljs-string">'100%'</span>)</li><li>          .barHeight(<span class="hljs-number">56</span>)</li><li>          .animationDuration(<span class="hljs-number">100</span>)</li><li>          .onChange((index: number) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (index === <span class="hljs-number">1</span>) {</li><li>              <span class="hljs-keyword">this</span>.isShow = <span class="hljs-literal">true</span>;</li><li>            }</li><li>            <span class="hljs-keyword">this</span>.currentIndex = index;</li><li>          })</li><li>          .width(<span class="hljs-string">'100%'</span>)</li><li>          .height(<span class="hljs-string">'84%'</span>)</li><li>          .backgroundColor(<span class="hljs-string">'#F1F3F5'</span>)</li><li>          .scrollable(!<span class="hljs-keyword">this</span>.isInPhotoBrowser)</li><li>        }.width(<span class="hljs-string">'100%'</span>).height(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> getReplaceUri(mediaType: string) {</li><li>    let boxPath = fileUri.getUriFromPath(<span class="hljs-keyword">this</span>.context.filesDir + <span class="hljs-string">"/test1.jpg"</span>);</li><li>    <span class="hljs-keyword">if</span> (mediaType === <span class="hljs-string">'mp4'</span>) {</li><li>      boxPath = fileUri.getUriFromPath(<span class="hljs-keyword">this</span>.context.filesDir + <span class="hljs-string">"/file1.mp4"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      boxPath = fileUri.getUriFromPath(<span class="hljs-keyword">this</span>.context.filesDir + <span class="hljs-string">"/test1.jpg"</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> boxPath;</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>