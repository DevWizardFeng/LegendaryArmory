<h1 _ngcontent-chk-c119="" class="doc-title ng-star-inserted" title="使用RSA密钥对签名验签（PSS模式）(ArkTS)"> 使用RSA密钥对签名验签（PSS模式）(ArkTS) </h1>

<div _ngcontent-chk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-sign-sig-verify-overview#rsa">签名验签算法规格：RSA</a>。</p>    <p><strong>签名</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygeneratorbyspec10" target="_blank">cryptoFramework.createAsyKeyGeneratorBySpec</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypair10" target="_blank">AsyKeyGeneratorBySpec.generateKeyPair</a>，指定密钥参数，生成RSA非对称密钥对（KeyPair）。</p>      <p>如何生成RSA非对称密钥，开发者可参考下文示例，并结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-asym-key-pair-from-key-spec">指定密钥参数生成非对称密钥对</a>理解，参考文档与当前示例可能存在入参差异，请在阅读时注意区分。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatesign" target="_blank">cryptoFramework.createSign</a>，指定字符串参数'RSA|PSS|SHA256|MGF1_SHA256'，创建非对称密钥类型为不带长度的RSA、填充模式为PSS、摘要算法为SHA256、掩码算法为MGF1_SHA256的Sign实例，用于完成签名操作。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-3" target="_blank">Sign.init</a>，使用私钥（PriKey）初始化Sign实例。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#setsignspec10" target="_blank">Sign.setSignSpec</a>，设置签名参数。此处设置盐值的长度（SignSpecItem.PSS_SALT_LEN_NUM）为32字节。在验签时将校验此数据。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getsignspec10" target="_blank">Sign.getSignSpec</a>，获取其他签名参数。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-3" target="_blank">Sign.update</a>，传入待签名的数据。当前单次update长度没有限制，开发者可以根据数据量判断如何调用update。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#sign-1" target="_blank">Sign.sign</a>，生成数据签名。</p></li>    </ol>    <p><strong>验签</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateverify" target="_blank">cryptoFramework.createVerify</a>，指定字符串参数'RSA2048|PSS|SHA256|MGF1_SHA256'，创建非对称密钥类型为RSA2048、填充模式为PSS、摘要算法为SHA256、掩码算法为MGF1_SHA256的Verify实例，用于完成验签操作。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#setverifyspec10" target="_blank">Verify.setVerifySpec</a>，设置签名参数。需要与签名时设置的保持一致。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-5" target="_blank">Verify.init</a>，使用公钥（PubKey）初始化Verify实例。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#update-5" target="_blank">Verify.update</a>，传入待验证的数据。当前单次update长度没有限制，开发者可以根据数据量判断如何调用update。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#verify-1" target="_blank">Verify.verify</a>，对数据进行验签。</p></li>    </ol>    <ul>     <li>      <p>异步方法示例：</p>      <div _ngcontent-chk-c106="" class="highlight-div"><div _ngcontent-chk-c106="" class="highlight-div-header"><div _ngcontent-chk-c106="" class="highlight-div-header-left"><div _ngcontent-chk-c106="" class="handle-button expand-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chk-c106="" class="highlight-div-header-right"><div _ngcontent-chk-c106="" class="handle-button ai-button"></div><div _ngcontent-chk-c106="" class="handle-button line-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chk-c106="" class="handle-button theme-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chk-c106="" class="handle-button copy-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 根据密钥参数属性构造RSA非对称密钥对密钥参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span>, dIn: <span class="hljs-built_in">bigint</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaKeyPairSpec</span>: cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">sk</span>: dIn,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaKeyPairSpec;</li><li>}</li><li><span class="hljs-comment">// 生成RSA2048密钥对参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048KeyPairSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25"</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x010001"</span>);</li><li>  <span class="hljs-keyword">let</span> dIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x6a7df2ca63ead4dda191d614b6b385e0d9056a3d6d5cfe07db1daabee022db08212d97613d3328e0267c9dd23d787abde2afcb306aeb7dfce69246cc73f5c87fdf06030179a2114b767db1f083ff841c025d7dc00cd82435b9a90f695369e94df23d2ce458bc3b3283ad8bba2b8fa1ba62e2dce9accff3799aae7c840016f3ba8e0048c0b6cc4339af7161003a5beb864a0164b2c1c9237b64bc87556994351b27506c33d4bcdfce0f9c491a7d6b0628c7c852be4f0a9c3132b2ed3a2c8881e9aab07e20e17deb074691be677776a78b5c502e05d9bdde72126b3738695e2dd1a0a98a14247c65d8a7ee79432a092cb0721a12df798e44f7cfce0c498147a9b1"</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(nIn, eIn, dIn);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyMessagePSS</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 完整的明文被拆分为input1和input2。</span></li><li>  <span class="hljs-keyword">let</span> plan1 = <span class="hljs-string">"This is Sign test plan1"</span>;</li><li>  <span class="hljs-keyword">let</span> plan2 = <span class="hljs-string">"This is Sign test plan2"</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input1</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan1, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input2</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan2, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-comment">// 获得RSA密钥对密钥参数对象。</span></li><li>  <span class="hljs-keyword">let</span> rsaKeyPairSpec = <span class="hljs-title function_">genRsa2048KeyPairSpec</span>();</li><li>  <span class="hljs-comment">// 构造RSA密钥对生成器。</span></li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaKeyPairSpec);</li><li>  <span class="hljs-comment">// sign和verify均支持RSA密钥带长度/不带长度的写法。</span></li><li>  <span class="hljs-keyword">let</span> signer = cryptoFramework.<span class="hljs-title function_">createSign</span>(<span class="hljs-string">"RSA|PSS|SHA256|MGF1_SHA256"</span>);</li><li>  <span class="hljs-keyword">let</span> verifier = cryptoFramework.<span class="hljs-title function_">createVerify</span>(<span class="hljs-string">"RSA2048|PSS|SHA256|MGF1_SHA256"</span>);</li><li>  <span class="hljs-keyword">let</span> keyPair = <span class="hljs-keyword">await</span> rsaGeneratorSpec.<span class="hljs-title function_">generateKeyPair</span>();</li><li>  <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">init</span>(keyPair.<span class="hljs-property">priKey</span>);</li><li>  <span class="hljs-comment">// 在签名初始化后，对PSS参数进行set和get操作。</span></li><li>  <span class="hljs-keyword">let</span> setN = <span class="hljs-number">32</span>;</li><li>  signer.<span class="hljs-title function_">setSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>, setN);</li><li>  <span class="hljs-keyword">let</span> saltLen = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"SaltLen == "</span> + saltLen);</li><li>  <span class="hljs-keyword">let</span> tf = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_TRAILER_FIELD_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"trailer field == "</span> + tf);</li><li>  <span class="hljs-keyword">let</span> md = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  <span class="hljs-keyword">let</span> mgf = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  <span class="hljs-keyword">let</span> mgf1Md = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">update</span>(input1);</li><li>  <span class="hljs-keyword">let</span> signMessageBlob = <span class="hljs-keyword">await</span> signer.<span class="hljs-title function_">sign</span>(input2);</li><li>  <span class="hljs-comment">// 在验签初始化前，对PSS参数进行set和get操作。</span></li><li>  verifier.<span class="hljs-title function_">setVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>, setN);</li><li>  saltLen = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"SaltLen == "</span> + saltLen);</li><li>  tf = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_TRAILER_FIELD_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"trailer field == "</span> + tf);</li><li>  md = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  mgf = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  mgf1Md = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF1_MD_STR</span>);</li><li>  <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">init</span>(keyPair.<span class="hljs-property">pubKey</span>);</li><li>  <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">update</span>(input1);</li><li>  <span class="hljs-keyword">let</span> verifyResult = <span class="hljs-keyword">await</span> verifier.<span class="hljs-title function_">verify</span>(input2, signMessageBlob);</li><li>  <span class="hljs-keyword">if</span> (verifyResult === <span class="hljs-literal">true</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'verify success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'verify failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>同步方法示例：</p>      <div _ngcontent-chk-c106="" class="highlight-div"><div _ngcontent-chk-c106="" class="highlight-div-header"><div _ngcontent-chk-c106="" class="highlight-div-header-left"><div _ngcontent-chk-c106="" class="handle-button expand-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chk-c106="" class="highlight-div-header-right"><div _ngcontent-chk-c106="" class="handle-button ai-button"></div><div _ngcontent-chk-c106="" class="handle-button line-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chk-c106="" class="handle-button theme-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chk-c106="" class="handle-button copy-button"><div _ngcontent-chk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chk-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 根据密钥参数属性构造RSA非对称密钥对密钥参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span>, dIn: <span class="hljs-built_in">bigint</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaKeyPairSpec</span>: cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">sk</span>: dIn,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaKeyPairSpec;</li><li>}</li><li><span class="hljs-comment">// 生成RSA2048密钥对参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048KeyPairSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25"</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x010001"</span>);</li><li>  <span class="hljs-keyword">let</span> dIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x6a7df2ca63ead4dda191d614b6b385e0d9056a3d6d5cfe07db1daabee022db08212d97613d3328e0267c9dd23d787abde2afcb306aeb7dfce69246cc73f5c87fdf06030179a2114b767db1f083ff841c025d7dc00cd82435b9a90f695369e94df23d2ce458bc3b3283ad8bba2b8fa1ba62e2dce9accff3799aae7c840016f3ba8e0048c0b6cc4339af7161003a5beb864a0164b2c1c9237b64bc87556994351b27506c33d4bcdfce0f9c491a7d6b0628c7c852be4f0a9c3132b2ed3a2c8881e9aab07e20e17deb074691be677776a78b5c502e05d9bdde72126b3738695e2dd1a0a98a14247c65d8a7ee79432a092cb0721a12df798e44f7cfce0c498147a9b1"</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(nIn, eIn, dIn);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">verifyMessagePSS</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 完整的明文被拆分为input1和input2。</span></li><li>  <span class="hljs-keyword">let</span> plan1 = <span class="hljs-string">"This is Sign test plan1"</span>;</li><li>  <span class="hljs-keyword">let</span> plan2 = <span class="hljs-string">"This is Sign test plan2"</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input1</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan1, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input2</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan2, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-comment">// 获得RSA密钥对密钥参数对象。</span></li><li>  <span class="hljs-keyword">let</span> rsaKeyPairSpec = <span class="hljs-title function_">genRsa2048KeyPairSpec</span>();</li><li>  <span class="hljs-comment">// 构造RSA密钥对生成器。</span></li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaKeyPairSpec);</li><li>  <span class="hljs-comment">// sign和verify均支持RSA密钥带长度/不带长度的写法。</span></li><li>  <span class="hljs-keyword">let</span> signer = cryptoFramework.<span class="hljs-title function_">createSign</span>(<span class="hljs-string">"RSA|PSS|SHA256|MGF1_SHA256"</span>);</li><li>  <span class="hljs-keyword">let</span> verifier = cryptoFramework.<span class="hljs-title function_">createVerify</span>(<span class="hljs-string">"RSA2048|PSS|SHA256|MGF1_SHA256"</span>);</li><li>  <span class="hljs-keyword">let</span> keyPair = rsaGeneratorSpec.<span class="hljs-title function_">generateKeyPairSync</span>();</li><li>  signer.<span class="hljs-title function_">initSync</span>(keyPair.<span class="hljs-property">priKey</span>);</li><li>  <span class="hljs-comment">// 在签名初始化后，对PSS参数进行set和get操作。</span></li><li>  <span class="hljs-keyword">let</span> setN = <span class="hljs-number">32</span>;</li><li>  signer.<span class="hljs-title function_">setSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>, setN);</li><li>  <span class="hljs-keyword">let</span> saltLen = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"SaltLen == "</span> + saltLen);</li><li>  <span class="hljs-keyword">let</span> tf = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_TRAILER_FIELD_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"trailer field == "</span> + tf);</li><li>  <span class="hljs-keyword">let</span> md = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  <span class="hljs-keyword">let</span> mgf = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  <span class="hljs-keyword">let</span> mgf1Md = signer.<span class="hljs-title function_">getSignSpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  signer.<span class="hljs-title function_">updateSync</span>(input1);</li><li>  <span class="hljs-keyword">let</span> signMessageBlob = signer.<span class="hljs-title function_">signSync</span>(input2);</li><li>  <span class="hljs-comment">// 在验签初始化前，对PSS参数进行set和get操作。</span></li><li>  verifier.<span class="hljs-title function_">setVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>, setN);</li><li>  saltLen = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_SALT_LEN_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"SaltLen == "</span> + saltLen);</li><li>  tf = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_TRAILER_FIELD_NUM</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"trailer field == "</span> + tf);</li><li>  md = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  mgf = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  mgf1Md = verifier.<span class="hljs-title function_">getVerifySpec</span>(cryptoFramework.<span class="hljs-property">SignSpecItem</span>.<span class="hljs-property">PSS_MGF1_MD_STR</span>);</li><li>  verifier.<span class="hljs-title function_">initSync</span>(keyPair.<span class="hljs-property">pubKey</span>);</li><li>  verifier.<span class="hljs-title function_">updateSync</span>(input1);</li><li>  <span class="hljs-keyword">let</span> verifyResult = verifier.<span class="hljs-title function_">verifySync</span>(input2, signMessageBlob);</li><li>  <span class="hljs-keyword">if</span> (verifyResult === <span class="hljs-literal">true</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'verify success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'verify failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>    </ul>   </div>   <div></div></div>