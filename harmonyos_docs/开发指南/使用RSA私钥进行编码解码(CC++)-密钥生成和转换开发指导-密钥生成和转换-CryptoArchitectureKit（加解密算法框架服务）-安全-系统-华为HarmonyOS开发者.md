<h1 _ngcontent-dkf-c119="" class="doc-title ng-star-inserted" title="使用RSA私钥进行编码解码(C/C++)"> 使用RSA私钥进行编码解码(C/C++) </h1>

<div _ngcontent-dkf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p><strong>编码</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygenerator_create" target="_blank">OH_CryptoAsymKeyGenerator_Create</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygenerator_generate" target="_blank">OH_CryptoAsymKeyGenerator_Generate</a>，生成RSA密钥类型为RSA2048、素数个数为2的非对称密钥对（keyPair）。keyPair对象中包括公钥PubKey、私钥PriKey。</p>      <p>如何生成RSA非对称密钥对，开发者可参考下文示例，并结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-asym-key-pair-randomly-ndk">随机生成非对称密钥对(C/C++)</a>理解。参考文档与当前示例可能存在入参差异，请在阅读时注意区分。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkeyencodingparams_create" target="_blank">OH_CryptoPrivKeyEncodingParams_Create</a>创建参数对象（params），并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkeyencodingparams_setparam" target="_blank">OH_CryptoPrivKeyEncodingParams_SetParam</a>设置加密算法和密码。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoprivkey_encode" target="_blank">OH_CryptoPrivKey_Encode</a>，传入参数CRYPTO_PEM/CRYPTO_DER、PKCS1/PKCS8和参数对象（params）生成编码后的私钥字符串。</p></li>    </ol>    <p><strong>解码</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-crypto-asym-key-h#oh_cryptoasymkeygenerator_create" target="_blank">OH_CryptoAsymKeyGenerator_Create</a>生成RSA非对称密钥生成器keyGen。</p>      <p>如何生成RSA非对称密钥对，开发者可参考下文示例，并结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>。</p></li>     <li>      <p>调用[OH_CryptoAsymKeyGenerator_SetPassword]，传入编码后的私钥字符串与编码口令。</p></li>     <li>      <p>调用[OH_CryptoAsymKeyGenerator_Convert]，传入参数CRYPTO_PEM和编码后的私钥字符串，返回RSA密钥对。</p></li>    </ol>    <ul>     <li>编码示例：</li>    </ul>    <div _ngcontent-dkf-c106="" class="highlight-div"><div _ngcontent-dkf-c106="" class="highlight-div-header"><div _ngcontent-dkf-c106="" class="highlight-div-header-left"><div _ngcontent-dkf-c106="" class="handle-button expand-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dkf-c106="" class="highlight-div-header-right"><div _ngcontent-dkf-c106="" class="handle-button ai-button"></div><div _ngcontent-dkf-c106="" class="handle-button line-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dkf-c106="" class="handle-button theme-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dkf-c106="" class="handle-button copy-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"CryptoArchitectureKit/crypto_architecture_kit.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> OH_Crypto_ErrCode <span class="hljs-title">doTestPriKeyPkcs1Encoded</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    OH_CryptoAsymKeyGenerator *keyGen = <span class="hljs-literal">nullptr</span>;</li><li>    OH_Crypto_ErrCode ret = <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Create</span>(<span class="hljs-string">"RSA2048"</span>, &amp;keyGen);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    OH_CryptoKeyPair *keyPair = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Generate</span>(keyGen, &amp;keyPair);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    OH_CryptoPrivKey *privKey = <span class="hljs-built_in">OH_CryptoKeyPair_GetPrivKey</span>(keyPair);</li><li>    <span class="hljs-keyword">if</span> (privKey == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> CRYPTO_OPERTION_ERROR;</li><li>    }</li><li>    OH_CryptoPrivKeyEncodingParams *params = <span class="hljs-literal">nullptr</span>;</li><li>    ret = <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_Create</span>(&amp;params);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    Crypto_DataBlob password = {(<span class="hljs-type">uint8_t</span> *)<span class="hljs-string">"1234567890"</span>, <span class="hljs-number">10</span>};</li><li>    Crypto_DataBlob cipher = {(<span class="hljs-type">uint8_t</span> *)<span class="hljs-string">"AES-128-CBC"</span>, <span class="hljs-number">11</span>};</li><li>    ret = <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_SetParam</span>(params, CRYPTO_PRIVATE_KEY_ENCODING_PASSWORD_STR, &amp;password);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_Destroy</span>(params);</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret = <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_SetParam</span>(params, CRYPTO_PRIVATE_KEY_ENCODING_SYMMETRIC_CIPHER_STR, &amp;cipher);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_Destroy</span>(params);</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    Crypto_DataBlob pemData = {<span class="hljs-number">0</span>};</li><li>    ret = <span class="hljs-built_in">OH_CryptoPrivKey_Encode</span>(privKey, CRYPTO_PEM, <span class="hljs-string">"PKCS1"</span>, params, &amp;pemData);</li><li>    <span class="hljs-keyword">if</span> (ret != CRYPTO_SUCCESS) {</li><li>        <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_Destroy</span>(params);</li><li>        <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>        <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-built_in">OH_Crypto_FreeDataBlob</span>(&amp;pemData);</li><li>    <span class="hljs-built_in">OH_CryptoPrivKeyEncodingParams_Destroy</span>(params);</li><li>    <span class="hljs-built_in">OH_CryptoKeyPair_Destroy</span>(keyPair);</li><li>    <span class="hljs-built_in">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>    <ul>     <li>解码示例：</li>    </ul>    <div _ngcontent-dkf-c106="" class="highlight-div"><div _ngcontent-dkf-c106="" class="highlight-div-header"><div _ngcontent-dkf-c106="" class="highlight-div-header-left"><div _ngcontent-dkf-c106="" class="handle-button expand-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dkf-c106="" class="highlight-div-header-right"><div _ngcontent-dkf-c106="" class="handle-button ai-button"></div><div _ngcontent-dkf-c106="" class="handle-button line-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dkf-c106="" class="handle-button theme-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dkf-c106="" class="handle-button copy-button"><div _ngcontent-dkf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dkf-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-swift" data-highlighted="yes"><ol class="linenums"><li>#include <span class="hljs-string">"CryptoArchitectureKit/crypto_architecture_kit.h"</span></li><li>#include <span class="hljs-operator">&lt;</span>string<span class="hljs-operator">&gt;</span></li><li>
</li><li><span class="hljs-keyword">static</span> <span class="hljs-type">OH_Crypto_ErrCode</span> doTestConvertPemKeyByPromise()</li><li>{</li><li>    std::string priKeyPkcs1EncodingStr <span class="hljs-operator">=</span> <span class="hljs-string">"-----BEGIN RSA PRIVATE KEY-----<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"Proc-Type: 4,ENCRYPTED<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"DEK-Info: AES-128-CBC,815A066131BF05CF87CE610A59CC69AE<span class="hljs-subst">\n</span><span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"7Jd0vmOmYGFZ2yRY8fqRl3+6rQlFtNcMILvcb5KWHDSrxA0ULmJE7CW0DSRikHoA<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"t0KgafhYXeQXh0dRy9lvVRAFSLHCLJVjchx90V7ZSivBFEq7+iTozVp4AlbgYsJP<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"vx/1sfZD2WAcyMJ7IDmJyft7xnpVSXsyWGTT4f3eaHJIh1dqjwrso7ucAW0FK6rp<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"/TONyOoXNfXtRbVtxNyCWBxt4HCSclDZFvS9y8fz9ZwmCUV7jei/YdzyQI2wnE13<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"W8cKlpzRFL6BWi8XPrUtAw5MWeHBAPUgPWMfcmiaeyi5BJFhQCrHLi+Gj4EEJvp7<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"mP5cbnQAx6+paV5z9m71SKrI/WSc4ixsYYdVmlL/qwAK9YliFfoPl030YJWW6rFf<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"T7J9BUlHGUJ0RB2lURNNLakM+UZRkeE9TByzCzgTxuQtyv5Lwsh2mAk3ia5x0kUO<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"LHg3Eoabhdh+YZA5hHaxnpF7VjspB78E0F9Btq+A41rSJ6zDOdToHey4MJ2nxdey<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"Z3bi81TZ6Fp4IuROrvZ2B/Xl3uNKR7n+AHRKnaAO87ywzyltvjwSh2y3xhJueiRs<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"BiYkyL3/fnocD3pexTdN6h3JgQGgO5GV8zw/NrxA85mw8o9im0HreuFObmNj36T9<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"k5N+R/QIXW83cIQOLaWK1ThYcluytf0tDRiMoKqULiaA6HvDMigExLxuhCtnoF8I<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"iOLN1cPdEVQjzwDHLqXP2DbWW1z9iRepLZlEm1hLRLEmOrTGKezYupVv306SSa6J<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"OA55lAeXMbyjFaYCr54HWrpt4NwNBX1efMUURc+1LcHpzFrBTTLbfjIyq6as49pH<span class="hljs-subst">\n</span>"</span></li><li>                                         <span class="hljs-string">"-----END RSA PRIVATE KEY-----<span class="hljs-subst">\n</span>"</span>;</li><li>
</li><li>    <span class="hljs-type">OH_CryptoAsymKeyGenerator</span> <span class="hljs-operator">*</span>keyGen <span class="hljs-operator">=</span> nullptr;</li><li>    <span class="hljs-type">OH_Crypto_ErrCode</span> ret <span class="hljs-operator">=</span> <span class="hljs-type">OH_CryptoAsymKeyGenerator_Create</span>(<span class="hljs-string">"RSA2048"</span>, <span class="hljs-operator">&amp;</span>keyGen);</li><li>    <span class="hljs-keyword">if</span> (ret <span class="hljs-operator">!=</span> <span class="hljs-type">CRYPTO_SUCCESS</span>) {</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>
</li><li>    <span class="hljs-type">OH_CryptoKeyPair</span> <span class="hljs-operator">*</span>dupKeyPair <span class="hljs-operator">=</span> nullptr;</li><li>    <span class="hljs-type">Crypto_DataBlob</span> priKeyPkcs1EncodingData <span class="hljs-operator">=</span> {};</li><li>    priKeyPkcs1EncodingData.data <span class="hljs-operator">=</span> reinterpret_cast<span class="hljs-operator">&lt;</span>uint8_t <span class="hljs-operator">*&gt;</span>(const_cast<span class="hljs-operator">&lt;</span>char <span class="hljs-operator">*&gt;</span>(priKeyPkcs1EncodingStr.c_str()));</li><li>    priKeyPkcs1EncodingData.len <span class="hljs-operator">=</span> strlen(priKeyPkcs1EncodingStr.c_str());</li><li>    std::string password <span class="hljs-operator">=</span> <span class="hljs-string">"123456"</span>;</li><li>    ret <span class="hljs-operator">=</span> <span class="hljs-type">OH_CryptoAsymKeyGenerator_SetPassword</span>(keyGen, reinterpret_cast<span class="hljs-operator">&lt;</span>const unsigned char <span class="hljs-operator">*&gt;</span>(password.c_str()),</li><li>        password.size());</li><li>    <span class="hljs-keyword">if</span> (ret <span class="hljs-operator">!=</span> <span class="hljs-type">CRYPTO_SUCCESS</span>) {</li><li>        <span class="hljs-type">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    ret <span class="hljs-operator">=</span> <span class="hljs-type">OH_CryptoAsymKeyGenerator_Convert</span>(keyGen, <span class="hljs-type">CRYPTO_PEM</span>, nullptr, <span class="hljs-operator">&amp;</span>priKeyPkcs1EncodingData, <span class="hljs-operator">&amp;</span>dupKeyPair);</li><li>    <span class="hljs-keyword">if</span> (ret <span class="hljs-operator">!=</span> <span class="hljs-type">CRYPTO_SUCCESS</span>) {</li><li>        <span class="hljs-type">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>        <span class="hljs-keyword">return</span> ret;</li><li>    }</li><li>    <span class="hljs-type">OH_CryptoKeyPair_Destroy</span>(dupKeyPair);</li><li>    <span class="hljs-type">OH_CryptoAsymKeyGenerator_Destroy</span>(keyGen);</li><li>    <span class="hljs-keyword">return</span> ret;</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>