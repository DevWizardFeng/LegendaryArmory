<h1 _ngcontent-ria-c119="" class="doc-title ng-star-inserted" title="使用RSA非对称密钥（PKCS1_OAEP模式）加解密"> 使用RSA非对称密钥（PKCS1_OAEP模式）加解密 </h1>

<div _ngcontent-ria-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>对应的算法规格请查看<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-encrypt-decrypt-spec#rsa">非对称密钥加解密算法规格：RSA</a>。</p>    <p><strong>加密</strong></p>    <ol>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreateasykeygeneratorbyspec10" target="_blank">cryptoFramework.createAsyKeyGeneratorBySpec</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generatekeypair10" target="_blank">AsyKeyGeneratorBySpec.generateKeyPair</a>，指定密钥参数，生成RSA非对称密钥对（KeyPair）。</p>      <p>如何生成RSA非对称密钥对，开发者可参考下文示例，并结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-asym-key-generation-conversion-spec#rsa">非对称密钥生成和转换规格：RSA</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/crypto-generate-asym-key-pair-from-key-spec">指定密钥参数生成非对称密钥对</a>理解，参考文档与当前示例可能存在入参差异，请在阅读时注意区分。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatecipher" target="_blank">cryptoFramework.createCipher</a>，指定字符串参数'RSA2048|PKCS1_OAEP|SHA256|MGF1_SHA1'，创建非对称密钥类型为RSA2048、填充模式为PKCS1_OAEP、摘要算法为SHA256、掩码摘要为MGF1_SHA1的RSA密钥的Cipher实例，用于完成加解密操作。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-1" target="_blank">Cipher.init</a>，设置模式为加密（CryptoMode.ENCRYPT_MODE），指定加密密钥（KeyPair.PubKey），初始化加密Cipher实例。</p>      <p>非对称密钥无加密参数，直接传入null。</p></li>     <li>      <p>在调用Cipher.doFinal前，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#setcipherspec10" target="_blank">Cipher.setCipherSpec</a>设置PKCS1_OAEP填充参数pSource。调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getcipherspec10" target="_blank">Cipher.getCipherSpec</a>可获得OAEP相关参数。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#dofinal-1" target="_blank">Cipher.doFinal</a>，传入明文，获取加密后的数据。</p></li>    </ol>    <p><strong>解密</strong></p>    <ol>     <li>      <p>由于RSA算法的Cipher实例不支持重复init操作，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreatecipher" target="_blank">cryptoFramework.createCipher</a>，重新生成Cipher实例。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#init-1" target="_blank">Cipher.init</a>，设置模式为解密（CryptoMode.DECRYPT_MODE），指定解密密钥（KeyPair.PriKey）初始化解密Cipher实例。PKCS1模式无加密参数，直接传入null。</p></li>     <li>      <p>在调用Cipher.doFinal前，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#setcipherspec10" target="_blank">Cipher.setCipherSpec</a>设置PKCS1_OAEP填充参数pSource，此处需要和加密时设置的保持一致。调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#getcipherspec10" target="_blank">Cipher.getCipherSpec</a>可获得OAEP相关参数。</p></li>     <li>      <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#dofinal-1" target="_blank">Cipher.doFinal</a>，传入密文，获取解密后的数据。</p></li>    </ol>    <ul>     <li>      <p>异步方法示例：</p>      <div _ngcontent-ria-c106="" class="highlight-div"><div _ngcontent-ria-c106="" class="highlight-div-header"><div _ngcontent-ria-c106="" class="highlight-div-header-left"><div _ngcontent-ria-c106="" class="handle-button expand-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ria-c106="" class="highlight-div-header-right"><div _ngcontent-ria-c106="" class="handle-button ai-button"></div><div _ngcontent-ria-c106="" class="handle-button line-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ria-c106="" class="handle-button theme-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ria-c106="" class="handle-button copy-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ria-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 根据密钥参数属性构造RSA非对称密钥对密钥参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span>, dIn: <span class="hljs-built_in">bigint</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaKeyPairSpec</span>: cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">sk</span>: dIn,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaKeyPairSpec;</li><li>}</li><li><span class="hljs-comment">// 生成RSA2048密钥对参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048KeyPairSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25"</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x010001"</span>);</li><li>  <span class="hljs-keyword">let</span> dIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x6a7df2ca63ead4dda191d614b6b385e0d9056a3d6d5cfe07db1daabee022db08212d97613d3328e0267c9dd23d787abde2afcb306aeb7dfce69246cc73f5c87fdf06030179a2114b767db1f083ff841c025d7dc00cd82435b9a90f695369e94df23d2ce458bc3b3283ad8bba2b8fa1ba62e2dce9accff3799aae7c840016f3ba8e0048c0b6cc4339af7161003a5beb864a0164b2c1c9237b64bc87556994351b27506c33d4bcdfce0f9c491a7d6b0628c7c852be4f0a9c3132b2ed3a2c8881e9aab07e20e17deb074691be677776a78b5c502e05d9bdde72126b3738695e2dd1a0a98a14247c65d8a7ee79432a092cb0721a12df798e44f7cfce0c498147a9b1"</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(nIn, eIn, dIn);</li><li>}</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">rsaUseSpecDecryptOAEPPromise</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> plan = <span class="hljs-string">"This is a test"</span>;</li><li>  <span class="hljs-comment">// 获得RSA密钥对密钥参数对象。</span></li><li>  <span class="hljs-keyword">let</span> rsaKeyPairSpec = <span class="hljs-title function_">genRsa2048KeyPairSpec</span>();</li><li>  <span class="hljs-comment">// 根据RSA密钥对参数生成RSA密钥对。</span></li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaKeyPairSpec);</li><li>  <span class="hljs-keyword">let</span> cipher = cryptoFramework.<span class="hljs-title function_">createCipher</span>(<span class="hljs-string">"RSA2048|PKCS1_OAEP|SHA256|MGF1_SHA1"</span>);</li><li>  <span class="hljs-keyword">let</span> decoder = cryptoFramework.<span class="hljs-title function_">createCipher</span>(<span class="hljs-string">"RSA2048|PKCS1_OAEP|SHA256|MGF1_SHA1"</span>);</li><li>  <span class="hljs-comment">// RSA加解密PKCS1-OAEP模式填充字节流P。</span></li><li>  <span class="hljs-keyword">let</span> pSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// 此处为示例，可以是任意值，由开发者自行决定。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-comment">// 生成密钥对。</span></li><li>  <span class="hljs-keyword">let</span> keyPair = <span class="hljs-keyword">await</span> rsaGeneratorSpec.<span class="hljs-title function_">generateKeyPair</span>();</li><li>  <span class="hljs-comment">// 进行加密操作初始化。</span></li><li>  <span class="hljs-keyword">await</span> cipher.<span class="hljs-title function_">init</span>(cryptoFramework.<span class="hljs-property">CryptoMode</span>.<span class="hljs-property">ENCRYPT_MODE</span>, keyPair.<span class="hljs-property">pubKey</span>, <span class="hljs-literal">null</span>);</li><li>  <span class="hljs-comment">// get和set操作可以放在Cipher对象init之后，此处对cipher进行set和get操作。</span></li><li>  cipher.<span class="hljs-title function_">setCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>, pSource);</li><li>  <span class="hljs-keyword">let</span> retP = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>);</li><li>  <span class="hljs-comment">// 比较get出来的P字节流与set进去的P字节流是否一致。</span></li><li>  <span class="hljs-keyword">if</span> (retP.<span class="hljs-title function_">toString</span>() !== pSource.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error init pSource"</span> + retP);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"pSource changed =="</span> + retP);</li><li>  }</li><li>  <span class="hljs-comment">// 进行OAEP其他参数的get操作。</span></li><li>  <span class="hljs-keyword">let</span> md = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  <span class="hljs-keyword">let</span> mgf = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  <span class="hljs-keyword">let</span> mgf1Md = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  <span class="hljs-keyword">let</span> cipherDataBlob = <span class="hljs-keyword">await</span> cipher.<span class="hljs-title function_">doFinal</span>(input);</li><li>  <span class="hljs-comment">// get和set操作可以放在Cipher对象init之前，且与init之后等价，此处对decoder进行set和get操作。</span></li><li>  decoder.<span class="hljs-title function_">setCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>, pSource);</li><li>  retP = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>);</li><li>  <span class="hljs-comment">// 比较get出来的P字节流与set进去的P字节流是否一致。</span></li><li>  <span class="hljs-keyword">if</span> (retP.<span class="hljs-title function_">toString</span>() !== pSource.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error init pSource"</span> + retP);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"pSource changed =="</span> + retP);</li><li>  }</li><li>  <span class="hljs-comment">// 进行OAEP其他参数的get操作。</span></li><li>  md = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  mgf = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  mgf1Md = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  <span class="hljs-comment">// 初始化解密操作。</span></li><li>  <span class="hljs-keyword">await</span> decoder.<span class="hljs-title function_">init</span>(cryptoFramework.<span class="hljs-property">CryptoMode</span>.<span class="hljs-property">DECRYPT_MODE</span>, keyPair.<span class="hljs-property">priKey</span>, <span class="hljs-literal">null</span>);</li><li>  <span class="hljs-keyword">let</span> decodeData = <span class="hljs-keyword">await</span> decoder.<span class="hljs-title function_">doFinal</span>(cipherDataBlob);</li><li>  <span class="hljs-comment">// 解密成功。</span></li><li>  <span class="hljs-keyword">if</span> (decodeData.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>() === input.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"oaep decrypt success"</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"oaep decrypt fail"</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     <li>      <p>同步方法示例：</p>      <div _ngcontent-ria-c106="" class="highlight-div"><div _ngcontent-ria-c106="" class="highlight-div-header"><div _ngcontent-ria-c106="" class="highlight-div-header-left"><div _ngcontent-ria-c106="" class="handle-button expand-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ria-c106="" class="highlight-div-header-right"><div _ngcontent-ria-c106="" class="handle-button ai-button"></div><div _ngcontent-ria-c106="" class="handle-button line-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ria-c106="" class="handle-button theme-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ria-c106="" class="handle-button copy-button"><div _ngcontent-ria-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ria-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { buffer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li><span class="hljs-comment">// 根据密钥参数属性构造RSA非对称密钥对密钥参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(<span class="hljs-params">nIn: <span class="hljs-built_in">bigint</span>, eIn: <span class="hljs-built_in">bigint</span>, dIn: <span class="hljs-built_in">bigint</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaCommSpec</span>: cryptoFramework.<span class="hljs-property">RSACommonParamsSpec</span> = {</li><li>    <span class="hljs-attr">n</span>: nIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">COMMON_PARAMS_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">rsaKeyPairSpec</span>: cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> = {</li><li>    <span class="hljs-attr">params</span>: rsaCommSpec,</li><li>    <span class="hljs-attr">sk</span>: dIn,</li><li>    <span class="hljs-attr">pk</span>: eIn,</li><li>    <span class="hljs-attr">algName</span>: <span class="hljs-string">"RSA"</span>,</li><li>    <span class="hljs-attr">specType</span>: cryptoFramework.<span class="hljs-property">AsyKeySpecType</span>.<span class="hljs-property">KEY_PAIR_SPEC</span></li><li>  };</li><li>  <span class="hljs-keyword">return</span> rsaKeyPairSpec;</li><li>}</li><li><span class="hljs-comment">// 生成RSA2048密钥对参数。</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">genRsa2048KeyPairSpec</span>(<span class="hljs-params"></span>): cryptoFramework.<span class="hljs-property">RSAKeyPairSpec</span> {</li><li>  <span class="hljs-keyword">let</span> nIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x9260d0750ae117eee55c3f3deaba74917521a262ee76007cdf8a56755ad73a1598a1408410a01434c3f5bc54a88b57fa19fc4328daea0750a4c44e88cff3b2382621b80f670464433e4336e6d003e8cd65bff211da144b88291c2259a00a72b711c116ef7686e8fee34e4d933c868187bdc26f7be071493c86f7a5941c3510806ad67b0f94d88f5cf5c02a092821d8626e8932b65c5bd8c92049c210932b7afa7ac59c0e886ae5c1edb00d8ce2c57633db26bd6639bff73cee82be9275c402b4cf2a4388da8cf8c64eefe1c5a0f5ab8057c39fa5c0589c3e253f0960332300f94bea44877b588e1edbde97cf2360727a09b775262d7ee552b3319b9266f05a25"</span>);</li><li>  <span class="hljs-keyword">let</span> eIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x010001"</span>);</li><li>  <span class="hljs-keyword">let</span> dIn = <span class="hljs-title class_">BigInt</span>(<span class="hljs-string">"0x6a7df2ca63ead4dda191d614b6b385e0d9056a3d6d5cfe07db1daabee022db08212d97613d3328e0267c9dd23d787abde2afcb306aeb7dfce69246cc73f5c87fdf06030179a2114b767db1f083ff841c025d7dc00cd82435b9a90f695369e94df23d2ce458bc3b3283ad8bba2b8fa1ba62e2dce9accff3799aae7c840016f3ba8e0048c0b6cc4339af7161003a5beb864a0164b2c1c9237b64bc87556994351b27506c33d4bcdfce0f9c491a7d6b0628c7c852be4f0a9c3132b2ed3a2c8881e9aab07e20e17deb074691be677776a78b5c502e05d9bdde72126b3738695e2dd1a0a98a14247c65d8a7ee79432a092cb0721a12df798e44f7cfce0c498147a9b1"</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-title function_">genRsaKeyPairSpec</span>(nIn, eIn, dIn);</li><li>}</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">main</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> plan = <span class="hljs-string">"This is a test"</span>;</li><li>  <span class="hljs-comment">// 获得RSA密钥对密钥参数对象。</span></li><li>  <span class="hljs-keyword">let</span> rsaKeyPairSpec = <span class="hljs-title function_">genRsa2048KeyPairSpec</span>();</li><li>  <span class="hljs-comment">// 根据RSA密钥对参数生成RSA密钥对。</span></li><li>  <span class="hljs-keyword">let</span> rsaGeneratorSpec = cryptoFramework.<span class="hljs-title function_">createAsyKeyGeneratorBySpec</span>(rsaKeyPairSpec);</li><li>  <span class="hljs-keyword">let</span> cipher = cryptoFramework.<span class="hljs-title function_">createCipher</span>(<span class="hljs-string">"RSA2048|PKCS1_OAEP|SHA256|MGF1_SHA1"</span>);</li><li>  <span class="hljs-keyword">let</span> decoder = cryptoFramework.<span class="hljs-title function_">createCipher</span>(<span class="hljs-string">"RSA2048|PKCS1_OAEP|SHA256|MGF1_SHA1"</span>);</li><li>  <span class="hljs-comment">// RSA加解密PKCS1-OAEP模式填充字节流P。</span></li><li>  <span class="hljs-keyword">let</span> pSource = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>]); <span class="hljs-comment">// 此处为示例，可以是任意值，由开发者自行决定。</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">input</span>: cryptoFramework.<span class="hljs-property">DataBlob</span> = { <span class="hljs-attr">data</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(buffer.<span class="hljs-title function_">from</span>(plan, <span class="hljs-string">'utf-8'</span>).<span class="hljs-property">buffer</span>) };</li><li>  <span class="hljs-comment">// 生成密钥对。</span></li><li>  <span class="hljs-keyword">let</span> keyPair = rsaGeneratorSpec.<span class="hljs-title function_">generateKeyPairSync</span>();</li><li>  <span class="hljs-comment">// 进行加密操作初始化。</span></li><li>  cipher.<span class="hljs-title function_">initSync</span>(cryptoFramework.<span class="hljs-property">CryptoMode</span>.<span class="hljs-property">ENCRYPT_MODE</span>, keyPair.<span class="hljs-property">pubKey</span>, <span class="hljs-literal">null</span>);</li><li>  <span class="hljs-comment">// get和set操作可以放在Cipher对象init之后，此处对cipher进行set和get操作。</span></li><li>  cipher.<span class="hljs-title function_">setCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>, pSource);</li><li>  <span class="hljs-keyword">let</span> retP = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>);</li><li>  <span class="hljs-comment">// 比较get出来的P字节流与set进去的P字节流是否一致。</span></li><li>  <span class="hljs-keyword">if</span> (retP.<span class="hljs-title function_">toString</span>() !== pSource.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error init pSource"</span> + retP);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"pSource changed =="</span> + retP);</li><li>  }</li><li>  <span class="hljs-comment">// 进行OAEP其他参数的get操作。</span></li><li>  <span class="hljs-keyword">let</span> md = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  <span class="hljs-keyword">let</span> mgf = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  <span class="hljs-keyword">let</span> mgf1Md = cipher.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  <span class="hljs-keyword">let</span> cipherDataBlob = cipher.<span class="hljs-title function_">doFinalSync</span>(input);</li><li>  <span class="hljs-comment">// get和set操作可以放在Cipher对象init之前，且与init之后等价，此处对decoder进行set和get操作。</span></li><li>  decoder.<span class="hljs-title function_">setCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>, pSource);</li><li>  retP = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_PSRC_UINT8ARR</span>);</li><li>  <span class="hljs-comment">// 比较get出来的P字节流与set进去的P字节流是否一致。</span></li><li>  <span class="hljs-keyword">if</span> (retP.<span class="hljs-title function_">toString</span>() !== pSource.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"error init pSource"</span> + retP);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"pSource changed =="</span> + retP);</li><li>  }</li><li>  <span class="hljs-comment">// 进行OAEP其他参数的get操作。</span></li><li>  md = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MD_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"md == "</span> + md);</li><li>  mgf = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF_NAME_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf == "</span> + mgf);</li><li>  mgf1Md = decoder.<span class="hljs-title function_">getCipherSpec</span>(cryptoFramework.<span class="hljs-property">CipherSpecItem</span>.<span class="hljs-property">OAEP_MGF1_MD_STR</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"mgf1Md == "</span> + mgf1Md);</li><li>  <span class="hljs-comment">// 初始化解密操作。</span></li><li>  decoder.<span class="hljs-title function_">initSync</span>(cryptoFramework.<span class="hljs-property">CryptoMode</span>.<span class="hljs-property">DECRYPT_MODE</span>, keyPair.<span class="hljs-property">priKey</span>, <span class="hljs-literal">null</span>);</li><li>  <span class="hljs-keyword">let</span> decodeData = decoder.<span class="hljs-title function_">doFinalSync</span>(cipherDataBlob);</li><li>  <span class="hljs-comment">// 解密成功。</span></li><li>  <span class="hljs-keyword">if</span> (decodeData.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>() === input.<span class="hljs-property">data</span>.<span class="hljs-title function_">toString</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"oaep decrypt success"</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"oaep decrypt fail"</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>    </ul>   </div>   <div></div></div>