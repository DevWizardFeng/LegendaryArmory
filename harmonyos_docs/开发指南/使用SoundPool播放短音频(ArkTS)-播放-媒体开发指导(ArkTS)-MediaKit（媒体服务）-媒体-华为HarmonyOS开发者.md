<h1 _ngcontent-jgu-c119="" class="doc-title ng-star-inserted" title="使用SoundPool播放短音频(ArkTS)"> 使用SoundPool播放短音频(ArkTS) </h1>

<div _ngcontent-jgu-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/media-kit-intro#soundpool">SoundPool</a>（音频池）提供的接口，可以实现低时延短音播放。</p>    <p>当应用开发时，经常需要使用一些急促简短的音效（如相机快门音效、系统通知音效等），此时建议调用SoundPool，实现一次加载，多次低时延播放。</p>    <p>SoundPool当前支持播放解码后1MB以下的音频资源，解码后大小超过1MB的长音频将截取前面的1MB大小数据进行播放，这相当于44.1kHz的16bit位深的立体声下约5.6秒的音频时长（在较低采样率或单声道配置下，持续时间会相应延长）。</p>    <p>本开发指导将以SoundPool进行一次低时延播放音频的过程为例，向开发者讲解如何使用SoundPool。详细的API声明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-multimedia-soundpool" target="_blank">SoundPool API参考</a>。</p>    <p>过程包括：创建SoundPool实例，加载音频资源（包括资源的解封装与解码:解码格式参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-decoding">音频解码支持</a>），设置播放参数（循环模式/播放优先级等），播放控制（播放/停止），释放资源。</p>    <p>在应用开发过程中，开发者应通过监听方法检查当前播放状态并按照一定顺序调用接口，执行对应操作，否则系统可能会抛出异常或生成其他未定义的行为。具体顺序可参考下列开发步骤及对应说明。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>使用SoundPool播放短音频时，涉及音频焦点管控策略的问题，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/audio-playback-concurrency">音频焦点指南</a>。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="开发步骤及注意事项">开发步骤及注意事项<i class="anchor-icon anchor-icon-link" anchorid="开发步骤及注意事项" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>调用createSoundPool方法创建SoundPool实例。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { media } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaKit'</span>;</li><li><span class="hljs-keyword">import</span> { audio } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AudioKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">soundPool</span>: media.<span class="hljs-property">SoundPool</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-comment">// audioRenderInfo中的参数usage取值为STREAM_USAGE_UNKNOWN，STREAM_USAGE_MUSIC，STREAM_USAGE_MOVIE。</span></li><li><span class="hljs-comment">// STREAM_USAGE_AUDIOBOOK时，SoundPool播放短音时为混音模式，不会打断其他音频播放。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">audioRendererInfo</span>: audio.<span class="hljs-property">AudioRendererInfo</span> = {</li><li>  <span class="hljs-attr">usage</span>: audio.<span class="hljs-property">StreamUsage</span>.<span class="hljs-property">STREAM_USAGE_MUSIC</span>, <span class="hljs-comment">// 音频流使用类型：音乐。根据业务场景配置，参考StreamUsage。</span></li><li>  <span class="hljs-attr">rendererFlags</span>: <span class="hljs-number">1</span> <span class="hljs-comment">// 音频渲染器标志。</span></li><li>};</li><li>
</li><li><span class="hljs-comment">//创建soundPool实例。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span> = <span class="hljs-keyword">await</span> media.<span class="hljs-title function_">createSoundPool</span>(<span class="hljs-number">14</span>, audioRendererInfo); <span class="hljs-comment">// 最大播放的流数为14。</span></li></ol></pre></div></div></li>      <li>       <p>调用on('loadComplete')方法，用于监听“资源加载完成”。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">soundId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 加载完成回调。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'loadComplete'</span>, <span class="hljs-function">(<span class="hljs-params">soundId_: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundId</span> = soundId_;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'loadComplete soundId: '</span> + soundId_);</li><li>})</li></ol></pre></div></div></li>      <li>       <p>调用on('playFinished')或者on('playFinishedWithStreamId')方法，用于监听“播放完成”。</p>       <p>当仅单独注册'playFinished'事件回调或者'playFinishedWithStreamId'事件回调时，当音频播放完成的时候，都会触发注册的回调。</p>       <p>当同时注册'playFinished'事件回调和'playFinishedWithStreamId'事件回调时，当音频播放完成的时候，仅会触发'playFinishedWithStreamId'事件回调，不会触发'playFinished'事件回调。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'playFinished'</span>, <span class="hljs-function">() =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive play finished message"</span>);</li><li>  <span class="hljs-comment">// 可进行下次播放。</span></li><li>});</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'playFinishedWithStreamId'</span>, <span class="hljs-function">(<span class="hljs-params">streamId</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"receive play finished message, streamId: "</span> + streamId);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用on('error')方法，设置错误类型监听。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error happened,message is :'</span> + error.<span class="hljs-property">code</span>);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'error happened,message is :'</span> + error.<span class="hljs-property">message</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用load方法进行音频资源加载。</p>       <p>可以传入uri或fd加载资源，此处使用传入fd的方式为例，更多方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-multimedia-soundpool#load" target="_blank">API文档</a>。</p>       <p>当系统加载完毕音频资源文件的时候，会通过loadComplete回调，通知用户资源加载完成，请在收到回调之后，再进行后续的play操作。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">soundId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-comment">// 获取当前组件所在Ability的Context，以通过Context获取应用文件路径。</span></li><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-comment">// 获取输入文件fd，test.ogg为rawfile目录下的预置资源，需要开发者根据实际情况进行替换。</span></li><li><span class="hljs-keyword">let</span> fileDescriptor = <span class="hljs-keyword">await</span> context!.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFd</span>(<span class="hljs-string">'test.ogg'</span>);</li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundId</span> = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">load</span>(fileDescriptor.<span class="hljs-property">fd</span>, fileDescriptor.<span class="hljs-property">offset</span>, fileDescriptor.<span class="hljs-property">length</span>);</li><li><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`load soundPool soundId: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.soundId}</span>`</span>)</li></ol></pre></div></div></li>      <li>       <p>配置播放参数PlayParameters，并在收到loadComplete回调通知之后，调用play方法播放音频。多次调用play播放同一个soundID，只会播放一次。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-attr">soundId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">private</span> <span class="hljs-attr">streamId</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">playParameters</span>: media.<span class="hljs-property">PlayParameters</span> = {</li><li>  <span class="hljs-attr">loop</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 循环1次，即播放2次。</span></li><li>  <span class="hljs-attr">rate</span>: <span class="hljs-number">1</span>, <span class="hljs-comment">// 2倍速播放。</span></li><li>  <span class="hljs-attr">leftVolume</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 取值范围0.0-1.0。</span></li><li>  <span class="hljs-attr">rightVolume</span>: <span class="hljs-number">0.5</span>, <span class="hljs-comment">// 取值范围0.0-1.0。</span></li><li>  <span class="hljs-attr">priority</span>: <span class="hljs-number">0</span>, <span class="hljs-comment">// 最低优先级。</span></li><li>};</li><li><span class="hljs-comment">// 开始播放，调用play可携带播放参数PlayParameters。请在音频资源加载完毕，即收到loadComplete回调之后再执行play操作。</span></li><li><span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">play</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">soundId</span>, playParameters, <span class="hljs-function">(<span class="hljs-params">error, streamID: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`play sound Error: errCode is <span class="hljs-subst">${error.code}</span>, errMessage is <span class="hljs-subst">${error.message}</span>`</span>)</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span> = streamID;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'play success soundId:'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span>);</li><li>  }</li><li>});</li></ol></pre></div></div></li>      <li>       <p>调用setLoop方法设置循环次数。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置循环播放次数。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">setLoop</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span>, <span class="hljs-number">2</span>); <span class="hljs-comment">// 播放3次。</span></li></ol></pre></div></div></li>      <li>       <p>调用setPriority方法设置优先级。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置对应流的优先级。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">setPriority</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span>, <span class="hljs-number">1</span>);</li></ol></pre></div></div></li>      <li>       <p>调用setVolume方法设置音量。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置音量。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">setVolume</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>);</li></ol></pre></div></div></li>      <li>       <p>调用stop方法终止指定流的播放。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 终止指定流的播放。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">stop</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">streamId</span>);</li></ol></pre></div></div></li>      <li>       <p>调用unload方法卸载音频资源。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 卸载音频资源。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">unload</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">soundId</span>);</li></ol></pre></div></div></li>      <li>       <p>调用off('loadComplete')方法注销加载完成监听。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">off</span>(<span class="hljs-string">'loadComplete'</span>);</li></ol></pre></div></div></li>      <li>       <p>调用off('playFinished')方法注销播放完成监听。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">off</span>(<span class="hljs-string">'playFinished'</span>);</li></ol></pre></div></div></li>      <li>       <p>调用off('error')方法注销错误类型监听。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">off</span>(<span class="hljs-string">'error'</span>);</li></ol></pre></div></div></li>      <li>       <p>调用release方法释放SoundPool实例。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 释放SoundPool。</span></li><li><span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">soundPool</span>!.<span class="hljs-title function_">release</span>();</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="运行示例工程">运行示例工程<i class="anchor-icon anchor-icon-link" anchorid="运行示例工程" tips="复制节点链接"></i></h2>          <p>参考以下示例，使用SoundPool进行低时延播放。</p>     <ol>      <li>       <p>新建工程，下载<a href="https://gitcode.com/openharmony/applications_app_samples/tree/master/code/DocsSample/Media/SoundPool/SoundPoolArkTS" target="_blank">完整示例工程</a>，并将示例工程的资源复制到对应目录。</p>       <div _ngcontent-jgu-c106="" class="highlight-div"><div _ngcontent-jgu-c106="" class="highlight-div-header"><div _ngcontent-jgu-c106="" class="highlight-div-header-left"><div _ngcontent-jgu-c106="" class="handle-button expand-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jgu-c106="" class="highlight-div-header-right"><div _ngcontent-jgu-c106="" class="handle-button ai-button"></div><div _ngcontent-jgu-c106="" class="handle-button line-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jgu-c106="" class="handle-button theme-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jgu-c106="" class="handle-button copy-button"><div _ngcontent-jgu-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jgu-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-css" data-highlighted="yes"><ol class="linenums"><li>SoundPoolArkTS</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/ets/</li><li>└── pages</li><li>    └── Index<span class="hljs-selector-class">.ets</span> (播放界面)</li><li>entry/<span class="hljs-attribute">src</span>/<span class="hljs-selector-tag">main</span>/resources/</li><li>├── base</li><li>│   ├── element</li><li>│   │   ├── <span class="hljs-attribute">color</span><span class="hljs-selector-class">.json</span></li><li>│   │   ├── <span class="hljs-attribute">float</span><span class="hljs-selector-class">.json</span></li><li>│   │   └── string<span class="hljs-selector-class">.json</span></li><li>│   └── media</li><li>│</li><li>└── rawfile</li><li>    └── test<span class="hljs-selector-class">.ogg</span> (音频资源)</li></ol></pre></div></div></li>      <li>       <p>编译新建工程并运行。</p></li>     </ol>    </div>   </div>   <div></div></div>