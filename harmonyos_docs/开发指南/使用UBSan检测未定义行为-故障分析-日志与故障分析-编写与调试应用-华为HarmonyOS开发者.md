<h1 _ngcontent-cqo-c119="" class="doc-title ng-star-inserted" title="使用UBSan检测未定义行为"> 使用UBSan检测未定义行为 </h1>

<div _ngcontent-cqo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div id="body0000002062445957">    <p id="ZH-CN_TOPIC_0000002478334450__p560251617411">代码中出现未定义行为，最初可能不会产生任何问题，但是随着代码的复杂度提高，未定义行为可能造成程序崩溃或发生错误，检测出根源会变得更加困难。UBSan（Undefined Behavior Sanitizer）可以检测代码中出现的未定义行为，帮助用户清除未定义行为引起的运行时错误。UBSan支持的异常检测类型请参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-stability-ubsan-detection#section124211321406" target="_blank">UBSan</a>。</p>    <p id="ZH-CN_TOPIC_0000002478334450__p8060118">常见的未定义行为有：</p>    <ul id="ZH-CN_TOPIC_0000002478334450__ul1910691813318">     <li id="li810614185319">除数为零。</li>     <li id="li274810191038">使用未对齐的指针，或未对齐的引用。</li>     <li id="li83261921031">浮点数转换导致的溢出。</li>     <li id="li3751019154014">访问空指针。</li>    </ul>    <p id="ZH-CN_TOPIC_0000002478334450__p5310137102114">该功能从DevEco Studio 5.1.0 Release版本开始支持。</p>    <div class="tiledSection">     <h2 id="section117615302315">使用约束<i class="anchor-icon anchor-icon-link" anchorid="section117615302315" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002478334450__p6493185110293">ASan、TSan、UBSan、HWASan不能同时开启，四个只能开启其中一个。</p>    </div>    <div class="tiledSection">     <h2 id="section19738384313">使能UBSan<i class="anchor-icon anchor-icon-link" anchorid="section19738384313" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002478334450__p2800029105116">可通过以下两种方式使能UBSan。</p>    </div>    <div class="tiledSection">     <h3 id="section741114011411" class="firsth2">方式一<i class="anchor-icon anchor-icon-link" anchorid="section741114011411" tips="复制节点链接"></i></h3>          <p id="ZH-CN_TOPIC_0000002478334450__p137001524113015">点击<strong><strong>Run &gt; Edit Configurations &gt;</strong> Diagnostics</strong>，勾选<strong>UndefinedBehaviorSanitizer</strong>开启检测。</p>     <p id="ZH-CN_TOPIC_0000002478334450__p15860143012241"><span><img originheight="274" originwidth="680" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104844.40450305597056138687859583785706:50001231000000:2800:75F7D617F2B99FEAA689B90D5A50D5FB2F039DC599A96BD2E86D4F1CAF130B5F.png" width="680" height="274"></span></p>    </div>    <div class="tiledSection">     <h3 id="section31022911513">方式二<i class="anchor-icon anchor-icon-link" anchorid="section31022911513" tips="复制节点链接"></i></h3>          <div class="p" id="ZH-CN_TOPIC_0000002478334450__p75991453813">      在需要使能UBSan的模块中，通过添加构建参数开启UBSan检测插桩，在对应模块的模块级build-profile.json5中添加命令参数：      <div _ngcontent-cqo-c106="" class="highlight-div"><div _ngcontent-cqo-c106="" class="highlight-div-header"><div _ngcontent-cqo-c106="" class="highlight-div-header-left"><div _ngcontent-cqo-c106="" class="handle-button expand-button"><div _ngcontent-cqo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cqo-c106="" class="highlight-div-header-right"><div _ngcontent-cqo-c106="" class="handle-button ai-button"></div><div _ngcontent-cqo-c106="" class="handle-button line-button"><div _ngcontent-cqo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cqo-c106="" class="handle-button theme-button"><div _ngcontent-cqo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cqo-c106="" class="handle-button copy-button"><div _ngcontent-cqo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cqo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-json" id="ZH-CN_TOPIC_0000002478334450__screen145851536135510" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-attr">"arguments"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"-DOHOS_ENABLE_UBSAN=ON"</span></li></ol></pre></div></div>     </div>     <p id="ZH-CN_TOPIC_0000002478334450__p1590626682"><span><img originheight="199" originwidth="384" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104844.25666958676509378601547445921907:50001231000000:2800:AD1A56D34E77FB8B6F5D0ABDAB67F49F1B32BA011BB50D1F9959C6EA359A67EE.png" width="384" height="199"></span></p>    </div>    <div class="tiledSection">     <h2 id="section065213164710">启用UBSan<i class="anchor-icon anchor-icon-link" anchorid="section065213164710" tips="复制节点链接"></i></h2>          <ol id="ZH-CN_TOPIC_0000002478334450__ol149914221460">      <li id="li11742192654620">运行或调试当前应用。</li>      <li id="li5991722154617">当检测出未定义行为时，弹出UBSan log信息，点击信息中的链接即可跳转到未定义行为的代码处。       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p id="ZH-CN_TOPIC_0000002478334450__p594617134810">无论<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-hvigor-compilation-options-customizing-guide#section192461528194916">编译模式</a>是debug或release，均有链接可直接跳转至源码。</p>        </div></div></div></li>     </ol>     <p id="ZH-CN_TOPIC_0000002478334450__p135731853153915"><span><img originheight="685" originwidth="1373" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104844.99672827576625636690694674269952:50001231000000:2800:1BB15780CF34DDC14861C324124E5623F7355B8B0C24DCFD9404616A50A5B9C8.png" width="920" height="458.9949016751639"></span></p>    </div>   </div>   <div></div></div>