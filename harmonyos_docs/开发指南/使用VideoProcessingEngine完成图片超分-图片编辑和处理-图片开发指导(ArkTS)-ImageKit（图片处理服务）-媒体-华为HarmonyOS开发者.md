<h1 _ngcontent-sqp-c119="" class="doc-title ng-star-inserted" title="使用VideoProcessingEngine完成图片超分"> 使用VideoProcessingEngine完成图片超分 </h1>

<div _ngcontent-sqp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>本模块提供图片细节增强的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-videoprocessingengine" target="_blank">ArkTS接口</a>，通过调用本模块，可以实现图片内容的清晰度增强及缩放功能，处理后的数据可以用于送显和输出。</p> <p>典型应用场景如：从URL获取图片源 &gt; 图片细节增强 &gt; 显示。</p> <div class="tiledSection"><h2 id="section74721331358">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section74721331358" tips="复制节点链接"></i></h2><ol><li>当前仅支持处理同时满足以下条件的图片：<ul><li>图片为SDR（Standard dynamic range）图片。</li><li>图片的像素格式为RGBA、BGRA、NV12、NV21，输出格式与输入格式一致。</li><li>处理的PixelMap对象需为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/image-allocator-type#内存类型介绍" target="_blank">DMA内存</a>。</li></ul> </li><li>本模块提供4个质量档位的算法，处理效果逐渐变优，但性能也会逐渐下降。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.2.2.1.1.5.1.1" valign="top" width="25%"><p>质量档位</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.1.1.5.1.2" valign="top" width="25%"><p>输入分辨率要求</p> <p>（单位：像素）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.1.1.5.1.3" valign="top" width="25%"><p>输出分辨率要求</p> <p>（单位：像素）</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.2.2.1.1.5.1.4" valign="top" width="25%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>NONE</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，支持改变宽高比例，无清晰度增强效果。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>LOW</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，支持改变宽高比例。</p> <p>缩放时会对图像进行低质量的清晰度增强，处理效率较高。</p> <p>此质量档位为默认设置。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>MEDIUM</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[32,3000]</p> <p>高：[32,3000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>仅适用于缩放场景，支持改变宽高比例。</p> <p>缩放时会对图像进行中等质量的清晰度增强，处理效率适中。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>HIGH</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[512,2000]</p> <p>高：[512,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>宽：[512,2000]</p> <p>高：[512,2000]</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>适用于缩放及清晰度增强场景，支持改变宽高比例。</p> <p>缩放时会对图像进行高质量的清晰度增强，处理效率相对较低。</p> </td> </tr>  </tbody></table></div> </div> </li></ol> </div> <div class="tiledSection"><h2 id="section796405418919">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section796405418919" tips="复制节点链接"></i></h2><ol><li>添加引用文件。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { image, videoProcessingEngine } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li></ol></pre></div></div> </li><li>初始化环境。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">promise</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; = <span class="hljs-variable">videoProcessingEngine</span>.<span class="hljs-title function_">initializeEnvironment</span>();</li></ol></pre></div></div> </li><li>（可选）配置输入。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-variable">scale</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0.5</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">width</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">512</span>; <span class="hljs-comment">// 示例代码，配置宽为512。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">height</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">512</span>;<span class="hljs-comment">// 示例代码，配置高为512。</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">color</span>: <span class="hljs-title class_">ArrayBuffer</span> = <span class="hljs-variable">new</span> <span class="hljs-title function_">ArrayBuffer</span>(<span class="hljs-variable">width</span> * <span class="hljs-variable">height</span> * <span class="hljs-number">4</span>); <span class="hljs-comment">// width * height * 4为需要创建的像素buffer大小。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">opts</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">InitializationOptions</span> = { <span class="hljs-variable">editable</span>: <span class="hljs-keyword">true</span>, <span class="hljs-variable">pixelFormat</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMapFormat</span>.<span class="hljs-title class_">RGBA_8888</span>, <span class="hljs-variable">size</span>: { <span class="hljs-variable">height</span>, <span class="hljs-variable">width</span> } }</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">sourceImage</span> : <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createPixelMapSync</span>(<span class="hljs-variable">color</span>, <span class="hljs-variable">opts</span>);</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">level</span> : <span class="hljs-title class_">videoProcessingEngine</span>.<span class="hljs-title class_">QualityLevel</span> = <span class="hljs-variable">videoProcessingEngine</span>.<span class="hljs-variable">QualityLevel</span>.<span class="hljs-variable">LOW</span>;</li></ol></pre></div></div> </li><li>创建图像处理模块。<p>预期返回值：videoProcessingEngine.ImageProcessor，图片处理模块实例。</p> <div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-csharp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建图片细节增强模块实例</span></li><li><span class="hljs-keyword">let</span> imageProcessor = videoProcessingEngine.create() <span class="hljs-keyword">as</span> videoProcessingEngine.ImageProcessor;</li></ol></pre></div></div> </li><li>启动细节增强处理。当输入图片srcImage和输出图片dstImage分辨率不一致时，进行缩放。<p>示例中的变量说明如下：</p> <p>sourceImage：PixelMap类型的输入图像，必填。</p> <p>width：目标宽度（单位px），当没有配置目标缩放比例时必填。</p> <p>height：目标高度（单位px），当没有配置目标缩放比例时必填。</p> <p>scale：目标缩放比例，当没有配置目标分辨率时必填。目标分辨率即宽*高。</p> <p>level：<a href="/consumer/cn/doc/harmonyos-guides/image-processing-arkts#section74721331358">质量算法档位</a>，默认为LOW。</p> <ul><li>方式一：指定原图、目标分辨率。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 同步方法</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">enhancedPixelmap</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> = <span class="hljs-variable">imageProcessor</span>.<span class="hljs-title function_">enhanceDetailSync</span>(</li><li><span class="hljs-variable">sourceImage</span>, <span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>, <span class="hljs-variable">level</span>);</li></ol></pre></div></div> <div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 异步方法</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">enhancedPixelmap</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span>&gt; = <span class="hljs-variable">imageProcessor</span>.<span class="hljs-title function_">enhanceDetail</span>(<span class="hljs-variable">sourceImage</span>, <span class="hljs-variable">width</span>, <span class="hljs-variable">height</span>, <span class="hljs-variable">level</span>);</li></ol></pre></div></div> </li><li>方式二：指定原图、缩放比例。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 同步方法</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">enhancedPixelmap</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> = <span class="hljs-variable">imageProcessor</span>.<span class="hljs-title function_">enhanceDetailSync</span>(</li><li><span class="hljs-variable">sourceImage</span>, <span class="hljs-variable">scale</span>, <span class="hljs-variable">level</span>);</li></ol></pre></div></div> <div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 异步方法</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable">enhancedPixelmap</span>: <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span>&gt; = <span class="hljs-variable">imageProcessor</span>.<span class="hljs-title function_">enhanceDetail</span>(</li><li><span class="hljs-variable">sourceImage</span>, <span class="hljs-variable">scale</span>, <span class="hljs-variable">level</span>);</li></ol></pre></div></div> </li></ul> </li><li>释放处理资源。<div _ngcontent-sqp-c106="" class="highlight-div"><div _ngcontent-sqp-c106="" class="highlight-div-header"><div _ngcontent-sqp-c106="" class="highlight-div-header-left"><div _ngcontent-sqp-c106="" class="handle-button expand-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sqp-c106="" class="highlight-div-header-right"><div _ngcontent-sqp-c106="" class="handle-button ai-button"></div><div _ngcontent-sqp-c106="" class="handle-button line-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sqp-c106="" class="handle-button theme-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sqp-c106="" class="handle-button copy-button"><div _ngcontent-sqp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sqp-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li>videoProcessingEngine<span class="hljs-selector-class">.deinitializeEnvironment</span>();</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>