<h1 _ngcontent-chc-c119="" class="doc-title ng-star-inserted" title="使用WebSocket访问网络"> 使用WebSocket访问网络 </h1>

<div _ngcontent-chc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>WebSocket是一种网络通信协议，它允许客户端和服务器之间建立一个持久的连接，并在该连接上进行全双工通信，连接之后客户端和服务器端可以同时主动发送数据，这是WebSocket和传统的HTTP协议最大的区别，HTTP以单向通信为主，客户端发起请求，服务器端响应数据，一次传输之后，连接会断开。一般情况下，HTTP适用于一次性数据获取（如网页内容加载），Websocket适用于实时性要求高的场景下（如在线聊天、实时游戏），以避免频繁建立连接提升用户体验。</p>     <p>该模块给第三方应用提供webSocket客户端和服务端能力，实现客户端与服务端的双向连接，目前服务端仅支持智慧屏使用。</p>     <p>客户端：使用WebSocket建立服务器与客户端的双向连接，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#websocketcreatewebsocket" target="_blank">createWebSocket()</a>方法创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#websocket" target="_blank">WebSocket</a>对象，然后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#connect" target="_blank">connect()</a>方法连接到服务器。当连接成功后，客户端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onopen" target="_blank">open</a>事件的回调，之后客户端就可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#send" target="_blank">send()</a>方法与服务器进行通信。当服务器发信息给客户端时，客户端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onmessage" target="_blank">message</a>事件的回调。当客户端想要取消此连接时，通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#close" target="_blank">close()</a>方法主动断开连接后，客户端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onclose" target="_blank">close</a>事件的回调。若在上述任一过程中发生错误，客户端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onerror" target="_blank">error</a>事件的回调。</p>     <p>服务端：（目前服务端仅支持智慧屏使用）使用WebSocket建立服务器与客户端的双向连接，需要先通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#websocketcreatewebsocketserver19" target="_blank">createWebSocketServer()</a>方法创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#websocketserver19" target="_blank">WebSocketServer</a>对象，然后通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#start19" target="_blank">start()</a>方法启动服务器，监听客户端申请建链的消息。当连接成功后，服务端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onconnect19" target="_blank">connect</a>事件的回调，之后服务端可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#send19" target="_blank">send()</a>方法与客户端进行通信，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#listallconnections19" target="_blank">listAllConnections()</a>方法列举出当前与服务端建链的所有客户端信息。当客户端给服务端发消息时，服务端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onmessagereceive19" target="_blank">messageReceive</a>事件回调。当服务端想断开某个与客户端的连接时，可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#close19" target="_blank">close()</a>方法主动断开与某个客户端的连接，之后服务端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onclose19" target="_blank">close</a>事件的回调。当服务端想停止service时，可以调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#stop19" target="_blank">stop()</a>方法。若在上述任一过程中发生错误，服务端会收到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#onerror19" target="_blank">error</a>事件的回调。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>websocket支持<a href="https://datatracker.ietf.org/doc/html/rfc6455#section-5.5.2" target="_blank">心跳检测机制</a>，在客户端和服务端建立webSocket连接之后，从连接建立或者客户端收到Pong帧开始计时，每间隔pingInterval秒客户端会发送Ping帧给服务器。服务器若支持websocket协议则会在收到Ping帧后自动回复Pong帧，表示连接正常，若服务端异常或服务端不支持websocket协议则不会回复Pong帧；若Ping帧发出去后，pongTimeout秒内没有收到Pong帧，则会主动断开连接。支持开发者关闭心跳检测机制，自定义pingInterval与pongTimeout，详情请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-websocket#websocketrequestoptions" target="_blank">WebsocketRequestOptions</a>。</p>       <p>服务端从API version 19开始支持。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="client端开发步骤">client端开发步骤<i class="anchor-icon anchor-icon-link" anchorid="client端开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入webSocket以及错误码模块。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建WebSocket连接，返回一个WebSocket对象。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> defaultIpAddress = <span class="hljs-string">"ws://"</span>;</li><li><span class="hljs-keyword">let</span> ws = webSocket.<span class="hljs-title function_">createWebSocket</span>();</li></ol></pre></div></div></li>      <li>       <p>订阅WebSocket的打开、消息接收、关闭、Error事件（可选），当收到on('open')事件时，可以通过send()方法与服务器进行通信，当收到服务器的bye消息时（此消息字段仅为示意，具体字段需要与服务器协商），主动断开连接。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">Object</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on open, status:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));</li><li>  <span class="hljs-comment">// 当收到on('open')事件时，可以通过send()方法与服务器进行通信。</span></li><li>  ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello, server!"</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Message send successfully"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to send the message. Err:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>    }</li><li>  });</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: string | <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on message, message:"</span> + value);</li><li>  <span class="hljs-comment">// 当收到服务器的`bye`消息时（此消息字段仅为示意，具体字段需要与服务器协商），主动断开连接。</span></li><li>  <span class="hljs-keyword">if</span> (value === <span class="hljs-string">'bye'</span>) {</li><li>    ws.<span class="hljs-title function_">close</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Connection closed successfully"</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to close the connection. Err: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      }</li><li>    });</li><li>  }</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: webSocket.CloseResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on close, code is "</span> + value.<span class="hljs-property">code</span> + <span class="hljs-string">", reason is "</span> + value.<span class="hljs-property">reason</span>);</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"on error, error:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>});</li></ol></pre></div></div></li>      <li>       <p>根据URL地址，发起WebSocket连接。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li>ws.<span class="hljs-title function_">connect</span>(defaultIpAddress, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (!err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Connected successfully"</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Connection failed. Err:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  }</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="server端开发步骤">server端开发步骤<i class="anchor-icon anchor-icon-link" anchorid="server端开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入webSocket以及错误码模块。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建WebSocketServer对象。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localServer</span>: webSocket.<span class="hljs-property">WebSocketServer</span>;</li><li>localServer = webSocket.<span class="hljs-title function_">createWebSocketServer</span>();</li></ol></pre></div></div></li>      <li>       <p>订阅WebSocketServer的客户端连接事件、消息接收事件、关闭事件、Error事件（可选），在收到客户端连接事件后，服务端可以通过send()方法与客户端进行通信，当收到客户端的"bye"消息时（此消息字段仅为示意，具体字段需要与客户端协商），主动断开连接。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">connection</span>: webSocket.<span class="hljs-property">WebSocketConnection</span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`New client connected! Client ip: <span class="hljs-subst">${connection.clientIP}</span>, Client port: <span class="hljs-subst">${connection.clientPort}</span>`</span>);</li><li>  <span class="hljs-comment">// 当收到on('connect')事件时，可以通过send()方法与客户端进行通信。</span></li><li>  localServer.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello, I'm server!"</span>, connection).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (success) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'message send successfully'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'message send failed'</span>);</li><li>    }</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`message send failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'messageReceive'</span>, <span class="hljs-function">(<span class="hljs-params">message: webSocket.WebSocketMessage</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">try</span>{</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on message received, client: <span class="hljs-subst">${message.clientConnection}</span>, data: <span class="hljs-subst">${message.data}</span>`</span>);</li><li>    <span class="hljs-comment">// 当收到客户端的"bye"消息时（此消息字段仅为示意，具体字段需要与客户端协商），主动断开连接。</span></li><li>    <span class="hljs-keyword">if</span> (message.<span class="hljs-property">data</span> === <span class="hljs-string">'bye'</span>) {</li><li>      localServer.<span class="hljs-title function_">close</span>(message.<span class="hljs-property">clientConnection</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (success) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'close client successfully'</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'close client failed'</span>);</li><li>        }</li><li>      });</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`on messageReceive failed. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">clientConnection: webSocket.WebSocketConnection, closeReason: webSocket.CloseResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`client close, client: <span class="hljs-subst">${clientConnection}</span>, closeReason: Code: <span class="hljs-subst">${closeReason.code}</span>, reason: <span class="hljs-subst">${closeReason.reason}</span>`</span>);</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>配置config参数启动server端服务。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: webSocket.<span class="hljs-property">WebSocketServerConfig</span> = {</li><li>  <span class="hljs-comment">// 监听端口。</span></li><li>  <span class="hljs-attr">serverPort</span>: <span class="hljs-number">8080</span>,</li><li>  <span class="hljs-attr">maxConcurrentClientsNumber</span>: <span class="hljs-number">10</span>,</li><li>  <span class="hljs-attr">maxConnectionsForOneClient</span>: <span class="hljs-number">10</span>,</li><li>}</li><li>localServer.<span class="hljs-title function_">start</span>(config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (success) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'webSocket server start success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'websocket server start failed'</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to start. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>});</li></ol></pre></div></div></li>      <li>       <p>服务端监听所有客户端连接状态（可选）。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connections</span>: webSocket.<span class="hljs-property">WebSocketConnection</span>[] = [];</li><li><span class="hljs-keyword">try</span> {</li><li>  connections = <span class="hljs-keyword">await</span> localServer.<span class="hljs-title function_">listAllConnections</span>();</li><li>  <span class="hljs-keyword">if</span> (connections.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'client list is empty'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`client list cnt: <span class="hljs-subst">${connections.length}</span>, client connections list is: <span class="hljs-subst">${connections}</span>`</span>);</li><li>  }</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to listAllConnections. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>需要关闭WebSocketServer端服务器时，可以通过stop()停止服务。</p>       <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li>localServer.<span class="hljs-title function_">stop</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (success) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'server stop service successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'server stop service failed'</span>);</li><li>  }</li><li>});</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="客户端完整示例">客户端完整示例<i class="anchor-icon anchor-icon-link" anchorid="客户端完整示例" tips="复制节点链接"></i></h2>          <p><strong>示例：</strong></p>     <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> defaultIpAddress = <span class="hljs-string">"ws://"</span>;</li><li><span class="hljs-keyword">let</span> ws = webSocket.<span class="hljs-title function_">createWebSocket</span>();</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'open'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: <span class="hljs-built_in">Object</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on open, status:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(value));</li><li>  <span class="hljs-comment">// 当收到on('open')事件时，可以通过send()方法与服务器进行通信。</span></li><li>  ws.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello, server!"</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (!err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Message send successfully"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to send the message. Err:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>    }</li><li>  });</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'message'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: string | <span class="hljs-built_in">ArrayBuffer</span></span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on message, message:"</span> + value);</li><li>  <span class="hljs-comment">// 当收到服务器的`bye`消息时（此消息字段仅为示意，具体字段需要与服务器协商），主动断开连接。</span></li><li>  <span class="hljs-keyword">if</span> (value === <span class="hljs-string">'bye'</span>) {</li><li>    ws.<span class="hljs-title function_">close</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span> (!err) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Connection closed successfully"</span>);</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Failed to close the connection. Err: "</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>      }</li><li>    });</li><li>  }</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: webSocket.CloseResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"on close, code is "</span> + value.<span class="hljs-property">code</span> + <span class="hljs-string">", reason is "</span> + value.<span class="hljs-property">reason</span>);</li><li>});</li><li>ws.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"on error, error:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>});</li><li>ws.<span class="hljs-title function_">connect</span>(defaultIpAddress, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, value: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (!err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"Connected successfully"</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"Connection failed. Err:"</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  }</li><li>});</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="server端完整示例">server端完整示例<i class="anchor-icon anchor-icon-link" anchorid="server端完整示例" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>导入需要的webSocket模块。</p></li>      <li>       <p>创建一个WebSocketServer对象。</p></li>      <li>       <p>（可选）订阅WebSocketServer的客户端连接事件、消息接收事件、关闭事件、Error事件。</p></li>      <li>       <p>配置config参数，通过start()启动server端服务。</p></li>      <li>       <p>通过WebSocketServer收发消息、监听事件等。</p></li>      <li>       <p>使用完WebSocketServer端服务器后，通过stop()停止服务。</p></li>     </ol>     <p><strong>示例：</strong></p>     <div _ngcontent-chc-c106="" class="highlight-div"><div _ngcontent-chc-c106="" class="highlight-div-header"><div _ngcontent-chc-c106="" class="highlight-div-header-left"><div _ngcontent-chc-c106="" class="handle-button expand-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-chc-c106="" class="highlight-div-header-right"><div _ngcontent-chc-c106="" class="handle-button ai-button"></div><div _ngcontent-chc-c106="" class="handle-button line-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-chc-c106="" class="handle-button theme-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-chc-c106="" class="handle-button copy-button"><div _ngcontent-chc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-chc-c106="" class="highlight-scroll-div"><pre class="js prettyprint linenums hljs language-javascript" hw-language="js" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webSocket } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">connections</span>: webSocket.<span class="hljs-property">WebSocketConnection</span>[] = [];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">localServer</span>: webSocket.<span class="hljs-property">WebSocketServer</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">config</span>: webSocket.<span class="hljs-property">WebSocketServerConfig</span> = {</li><li>  <span class="hljs-comment">// 监听端口。</span></li><li>  <span class="hljs-attr">serverPort</span>: <span class="hljs-number">8080</span>,</li><li>  <span class="hljs-attr">maxConcurrentClientsNumber</span>: <span class="hljs-number">10</span>,</li><li>  <span class="hljs-attr">maxConnectionsForOneClient</span>: <span class="hljs-number">10</span>,</li><li>}</li><li>
</li><li>localServer = webSocket.<span class="hljs-title function_">createWebSocketServer</span>();</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'connect'</span>, <span class="hljs-keyword">async</span> (<span class="hljs-attr">connection</span>: webSocket.<span class="hljs-property">WebSocketConnection</span>) =&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`New client connected! Client ip: <span class="hljs-subst">${connection.clientIP}</span>, Client port: <span class="hljs-subst">${connection.clientPort}</span>`</span>);</li><li>  <span class="hljs-comment">// 当收到on('connect')事件时，可以通过send()方法与客户端进行通信。</span></li><li>  localServer.<span class="hljs-title function_">send</span>(<span class="hljs-string">"Hello, I'm server!"</span>, connection).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (success) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'message send successfully'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'message send failed'</span>);</li><li>    }</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`message send failed, Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-keyword">try</span> {</li><li>    connections = <span class="hljs-keyword">await</span> localServer.<span class="hljs-title function_">listAllConnections</span>();</li><li>    <span class="hljs-keyword">if</span> (connections.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'client list is empty'</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`client list cnt: <span class="hljs-subst">${connections.length}</span>, client connections list is: <span class="hljs-subst">${connections}</span>`</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to listAllConnections. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'messageReceive'</span>, <span class="hljs-function">(<span class="hljs-params">message: webSocket.WebSocketMessage</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">try</span>{</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`on message received, client: <span class="hljs-subst">${message.clientConnection}</span>, data: <span class="hljs-subst">${message.data}</span>`</span>);</li><li>    <span class="hljs-comment">// 当收到客户端的"bye"消息时（此消息字段仅为示意，具体字段需要与客户端协商），主动断开连接。</span></li><li>    <span class="hljs-keyword">if</span> (message.<span class="hljs-property">data</span> === <span class="hljs-string">'bye'</span>) {</li><li>      localServer.<span class="hljs-title function_">close</span>(message.<span class="hljs-property">clientConnection</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (success) {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'close client successfully'</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'close client failed'</span>);</li><li>        }</li><li>      });</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`on messageReceive failed. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  }</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'close'</span>, <span class="hljs-function">(<span class="hljs-params">clientConnection: webSocket.WebSocketConnection, closeReason: webSocket.CloseResult</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`client close, client: <span class="hljs-subst">${clientConnection}</span>, closeReason: Code: <span class="hljs-subst">${closeReason.code}</span>, reason: <span class="hljs-subst">${closeReason.reason}</span>`</span>);</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`error. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">start</span>(config).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (success) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'webSocket server start success'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'websocket server start failed'</span>);</li><li>  }</li><li>}).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to start. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>});</li><li>
</li><li>localServer.<span class="hljs-title function_">stop</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">success: boolean</span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">if</span> (success) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'server stop service successfully'</span>);</li><li>  } <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'server stop service failed'</span>);</li><li>  }</li><li>});</li></ol></pre></div></div>    </div>   </div>   <div></div></div>