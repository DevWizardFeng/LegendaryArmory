<h1 _ngcontent-vdm-c119="" class="doc-title ng-star-inserted" title="使用Web组件保存前端页面为PDF"> 使用Web组件保存前端页面为PDF </h1>

<div _ngcontent-vdm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 14开始，支持使用Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#createpdf14" target="_blank">createPdf</a>方法，为应用提供了保存前端页面为PDF的功能。</p>    <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#createpdf14" target="_blank">createPdf</a>生成实例后，调用pdfArrayBuffer方法获取二进制数据流，再使用fileIo方法将二进制数据流保存为PDF文件。用户可以将前端页面内容保存为PDF以便分享或保存。例如，生成报告、发票等，方便用户保存和传输。</p>    <div class="tiledSection">     <h2 id="需要权限">需要权限<i class="anchor-icon anchor-icon-link" anchorid="需要权限" tips="复制节点链接"></i></h2>          <p>若涉及网络文档获取，需在module.json5中配置网络访问权限。具体添加方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/declare-permissions#在配置文件中声明权限">在配置文件中声明权限</a>。</p>     <div _ngcontent-vdm-c106="" class="highlight-div"><div _ngcontent-vdm-c106="" class="highlight-div-header"><div _ngcontent-vdm-c106="" class="highlight-div-header-left"><div _ngcontent-vdm-c106="" class="handle-button expand-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vdm-c106="" class="highlight-div-header-right"><div _ngcontent-vdm-c106="" class="handle-button ai-button"></div><div _ngcontent-vdm-c106="" class="handle-button line-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vdm-c106="" class="handle-button theme-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vdm-c106="" class="handle-button copy-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vdm-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"requestPermissions"</span>:[</li><li>    {</li><li>      <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.INTERNET"</span></li><li>    }</li><li>  ]</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="callback方式保存pdf">callback方式保存PDF<i class="anchor-icon anchor-icon-link" anchorid="callback方式保存pdf" tips="复制节点链接"></i></h2>          <p>通过callback方式调用createPdf接口，获取到的result通过pdfArrayBuffer接口取得PDF二进制数据流，最后使用fileIo方法将二进制数据流保存为PDF文件。</p>     <div _ngcontent-vdm-c106="" class="highlight-div"><div _ngcontent-vdm-c106="" class="highlight-div-header"><div _ngcontent-vdm-c106="" class="highlight-div-header-left"><div _ngcontent-vdm-c106="" class="handle-button expand-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vdm-c106="" class="highlight-div-header-right"><div _ngcontent-vdm-c106="" class="handle-button ai-button"></div><div _ngcontent-vdm-c106="" class="handle-button line-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vdm-c106="" class="handle-button theme-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vdm-c106="" class="handle-button copy-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vdm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">pdfConfig</span>: webview.<span class="hljs-property">PdfConfiguration</span> = {</li><li>    <span class="hljs-attr">width</span>: <span class="hljs-number">8.27</span>,</li><li>    <span class="hljs-attr">height</span>: <span class="hljs-number">11.69</span>,</li><li>    <span class="hljs-attr">marginTop</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginRight</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">shouldPrintBackground</span>: <span class="hljs-literal">true</span></li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'SavePDF'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 触发PDF生成，需要确保页面渲染完成，可使用onPageEnd事件监听</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">createPdf</span>(</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pdfConfig</span>,</li><li>            <span class="hljs-function">(<span class="hljs-params">error, result: webview.PdfData</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-comment">// 获取到的result通过`pdfArrayBuffer`接口取得PDF二进制数据流，最后使用`fileIo`方法将二进制数据流保存为PDF文件</span></li><li>                <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>                <span class="hljs-keyword">let</span> filePath = context.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/test.pdf"</span>;</li><li>                <span class="hljs-keyword">let</span> file = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>                fs.<span class="hljs-title function_">write</span>(file.<span class="hljs-property">fd</span>, result.<span class="hljs-title function_">pdfArrayBuffer</span>().<span class="hljs-property">buffer</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">writeLen: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"createPDF write data to file succeed and size is:"</span> + writeLen);</li><li>                }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"createPDF write data to file failed with error message: "</span> + err.<span class="hljs-property">message</span> +</li><li>                    <span class="hljs-string">", error code: "</span> + err.<span class="hljs-property">code</span>);</li><li>                }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-comment">// 关闭file</span></li><li>                  fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>                });</li><li>              } <span class="hljs-keyword">catch</span> (resError) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>              }</li><li>            });</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">"www.example.com"</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="promise方式保存pdf">Promise方式保存PDF<i class="anchor-icon anchor-icon-link" anchorid="promise方式保存pdf" tips="复制节点链接"></i></h2>          <p>通过Promise方式调用createPdf接口，获取到的result通过pdfArrayBuffer接口取得PDF二进制数据流，最后使用fileIo方法将二进制数据流保存为PDF文件。</p>     <div _ngcontent-vdm-c106="" class="highlight-div"><div _ngcontent-vdm-c106="" class="highlight-div-header"><div _ngcontent-vdm-c106="" class="highlight-div-header-left"><div _ngcontent-vdm-c106="" class="handle-button expand-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vdm-c106="" class="highlight-div-header-right"><div _ngcontent-vdm-c106="" class="handle-button ai-button"></div><div _ngcontent-vdm-c106="" class="handle-button line-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vdm-c106="" class="handle-button theme-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vdm-c106="" class="handle-button copy-button"><div _ngcontent-vdm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vdm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">pdfConfig</span>: webview.<span class="hljs-property">PdfConfiguration</span> = {</li><li>    <span class="hljs-attr">width</span>: <span class="hljs-number">8.27</span>,</li><li>    <span class="hljs-attr">height</span>: <span class="hljs-number">11.69</span>,</li><li>    <span class="hljs-attr">marginTop</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginBottom</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginRight</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">marginLeft</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">shouldPrintBackground</span>: <span class="hljs-literal">true</span></li><li>  }</li><li>
</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'SavePDF'</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 触发PDF生成，需要确保页面渲染完成，可使用onPageEnd事件监听</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">createPdf</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">pdfConfig</span>)</li><li>            .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: webview.PdfData</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-comment">// 获取到的result通过`pdfArrayBuffer`接口取得PDF二进制数据流，最后使用`fileIo`方法将二进制数据流保存为PDF文件</span></li><li>                <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>                <span class="hljs-keyword">let</span> filePath = context.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/test.pdf"</span>;</li><li>                <span class="hljs-keyword">let</span> file = fs.<span class="hljs-title function_">openSync</span>(filePath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>                fs.<span class="hljs-title function_">write</span>(file.<span class="hljs-property">fd</span>, result.<span class="hljs-title function_">pdfArrayBuffer</span>().<span class="hljs-property">buffer</span>).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">writeLen: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"createPDF write data to file succeed and size is:"</span> + writeLen);</li><li>                }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"createPDF write data to file failed with error message: "</span> + err.<span class="hljs-property">message</span> +</li><li>                    <span class="hljs-string">", error code: "</span> + err.<span class="hljs-property">code</span>);</li><li>                }).<span class="hljs-title function_">finally</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-comment">// 关闭file</span></li><li>                  fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>                });</li><li>              } <span class="hljs-keyword">catch</span> (resError) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(resError <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(resError <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>              }</li><li>            })</li><li>        })</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">"www.example.com"</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>