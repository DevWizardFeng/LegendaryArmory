<h1 _ngcontent-ped-c119="" class="doc-title ng-star-inserted" title="使用Web组件的广告过滤功能"> 使用Web组件的广告过滤功能 </h1>

<div _ngcontent-ped-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkWeb为应用提供广告过滤功能，支持通过云端推送默认的easylist规则，或允许应用通过接口设定自定义规则文件。它在网络层拦截广告资源的下载，或在网页中注入CSS规则以隐藏特定的广告元素。</p>    <p>当前配置文件格式为<a href="https://easylist-downloads.adblockplus.org/easylist.txt" target="_blank">easylist规则</a>。</p>    <div class="tiledSection">     <h2 id="常用easylist语法规则">常用easylist语法规则<i class="anchor-icon anchor-icon-link" anchorid="常用easylist语法规则" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.1" valign="top" width="33.33333333333333%">规则类别</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.2" valign="top" width="33.33333333333333%">说明</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.2.1.4.1.3" valign="top" width="33.33333333333333%">示例</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">URL拦截规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">拦截所有网站中url能匹配"example.com/js/*_tv.js"的子资源请求。用于定义域名过滤规则，匹配特定的域名及其所有子域名。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">||example.com/js/*_tv.js</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">URL拦截规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">拦截非alimama.com、非taobao.com域名网站中的url匹配"alimama.cn"的第三方资源。$third_party是一种options语法，表示匹配第三方资源；域名前使用'~'表示不包括该域名。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">||alimama.cn^$third-party,domain=<span>alimama.com|\</span>taobao.com</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">例外规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">关闭example.com网页内的广告过滤。@@是例外规则的语法关键字，表示不过滤。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">@@||example.com^$document</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">例外规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">在域名为litv.tv的网页中，不过滤能匹配上".adserver."的子资源。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">@@.adserver.$domain=litv.tv</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">元素隐藏规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">隐藏myabandonware.com和myware.com域名中所有class="i528"的元素。##用于表示元素隐藏。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">myabandonware.com, myware.com##.i528</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">元素隐藏例外规则</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">不隐藏sdf-event.sakura.ne.jp网站中id="ad_1"的元素。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">sdf-event.sakura.ne.jp#@##ad_1</td>        </tr>             </tbody></table></div>     </div>     <p>例外规则，通常是与普通规则配合使用的，在某些特定场景下使普通规则不适用，单独应用例外规则是没有意义的。</p>     <p>例如先配置了一条过滤所有网站的拦截规则：||abc.com/js/123.js，如果某些网站出现误拦截或不能拦截的情况，可以针对这些网站配置新的例外规则。</p>    </div>    <div class="tiledSection">     <h2 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller" target="_blank">WebviewController</a>类中，增加开启/关闭广告过滤特性的接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#enableadsblock12" target="_blank">enableAdsBlock()</a>，支持Web实例级的特性开关。</p></li>      <li>       <p>新增<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager" target="_blank">AdsBlockManager</a>全局单例类，提供自定义广告过滤配置、控制网站级特性开关的能力。</p></li>      <li>       <p>Web实例上提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#onadsblocked12" target="_blank">onAdsBlocked()</a>回调通知方法，支持将拦截信息通知到上层应用。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager" target="_blank">AdsBlockManager</a>接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#setadsblockrules12" target="_blank">setAdsBlockRules()</a>接口仅能设置一份自定义配置，此配置会持久化，应用冷启动无需重新配置，可避免每次冷启动配置规则都触发广告过滤配置的编译解析。</p></li>      <li>       <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager" target="_blank">AdsBlockManager</a>接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockdisallowedlist12" target="_blank">addAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#removeadsblockdisallowedlist12" target="_blank">removeAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#clearadsblockdisallowedlist12" target="_blank">clearAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockallowedlist12" target="_blank">addAdsBlockAllowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#removeadsblockallowedlist12" target="_blank">removeAdsBlockAllowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#clearadsblockallowedlist12" target="_blank">clearAdsBlockAllowedList()</a>操作的数据不会持久化，应用冷启动需要重新设置。</p></li>      <li>       <p>如果1个Web实例启用了广告过滤特性，但未调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager" target="_blank">AdsBlockManager</a>接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockdisallowedlist12" target="_blank">addAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#removeadsblockdisallowedlist12" target="_blank">removeAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#clearadsblockdisallowedlist12" target="_blank">clearAdsBlockDisallowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockallowedlist12" target="_blank">addAdsBlockAllowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#removeadsblockallowedlist12" target="_blank">removeAdsBlockAllowedList()</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#clearadsblockallowedlist12" target="_blank">clearAdsBlockAllowedList()</a>配置disallowlist和allowlist数据，则默认所有网站均启用广告过滤。</p></li>      <li>       <p>allowlist和disallowlist数据共同使用时，allowlist的优先级高于disallowlist，即先使用allowlist匹配，如果匹配成功就不再使用disallowlist匹配，该网站会启用广告过滤特性。</p></li>      <li>       <p>如果应用未启用广告过滤特性，那么Web组件不会向服务器请求默认的内置easylist规则。</p></li>      <li>       <p>disallowlist和allowlist数据采用后缀匹配，例如应用的设置的域名"xxyy.com"，可以匹配上url为"wwsstt.xxyy.com"的网站。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="开启广告过滤" class="firsth2">开启广告过滤<i class="anchor-icon anchor-icon-link" anchorid="开启广告过滤" tips="复制节点链接"></i></h3>          <p>应用可以通过AdsBlockManager提供的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#setadsblockrules12" target="_blank">setAdsBlockRules()</a>接口设置自定义的easylist过滤规则，并通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#enableadsblock12" target="_blank">enableAdsBlock()</a>接口使能广告过滤特性。</p>     <p>在下面的示例中，演示了一个应用通过文件选择器选择easylist规则文件，并开启广告过滤功能。</p>     <div _ngcontent-ped-c106="" class="highlight-div"><div _ngcontent-ped-c106="" class="highlight-div-header"><div _ngcontent-ped-c106="" class="highlight-div-header-left"><div _ngcontent-ped-c106="" class="handle-button expand-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ped-c106="" class="highlight-div-header-right"><div _ngcontent-ped-c106="" class="handle-button ai-button"></div><div _ngcontent-ped-c106="" class="handle-button line-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ped-c106="" class="handle-button theme-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ped-c106="" class="handle-button copy-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ped-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { picker, fileUri } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 演示点击按钮，通过filepicker打开一个easylist规则文件并设置到Web组件中</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">main_url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">input_text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Flex</span>() {</li><li>          <span class="hljs-title class_">Button</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>}) {</li><li>            <span class="hljs-title class_">Text</span>(<span class="hljs-string">"setAdsBlockRules"</span>)</li><li>          }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">documentSelectionOptions</span>: <span class="hljs-title class_">ESObject</span> = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentSelectOptions</span>();</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">documentPicker</span>: <span class="hljs-title class_">ESObject</span> = <span class="hljs-keyword">new</span> picker.<span class="hljs-title class_">DocumentViewPicker</span>();</li><li>              documentPicker.<span class="hljs-title function_">select</span>(documentSelectionOptions).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">documentSelectResult: ESObject</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (documentSelectResult &amp;&amp; documentSelectResult.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>                  <span class="hljs-keyword">let</span> fileRealPath = <span class="hljs-keyword">new</span> fileUri.<span class="hljs-title class_">FileUri</span>(documentSelectResult[<span class="hljs-number">0</span>]);</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'DocumentViewPicker.select successfully, uri: '</span> + fileRealPath);</li><li>                  webview.<span class="hljs-property">AdsBlockManager</span>.<span class="hljs-title function_">setAdsBlockRules</span>(fileRealPath.<span class="hljs-property">path</span>, <span class="hljs-literal">true</span>);</li><li>                }</li><li>              })</li><li>            } <span class="hljs-keyword">catch</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'DocumentViewPicker.select failed with err:'</span> + err);</li><li>            }</li><li>          })</li><li>        }</li><li>      }</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">main_url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">enableAdsBlock</span>(<span class="hljs-literal">true</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>如果存在内置的easylist规则文件，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#setadsblockrules12" target="_blank">setAdsBlockRules()</a>接口的replace参数可用于设置规则文件的使用策略，replace为true表示不使用内置的easylist规则文件，replace为false表示自定义规则和内置的规则将会同时工作，如果发现内置规则与自定义规则冲突，可使用replace=true禁用内置规则效果。</p>     <p>设置的自定义规则文件在应用进程内对所有的Web组件生效，是一个应用级全局配置文件，并将持久化，应用重启后可继续工作。</p>    </div>    <div class="tiledSection">     <h3 id="关闭特定域名页面的广告过滤">关闭特定域名页面的广告过滤<i class="anchor-icon anchor-icon-link" anchorid="关闭特定域名页面的广告过滤" tips="复制节点链接"></i></h3>          <p>在Web组件的广告过滤开关开启后，应用有时候会期望关闭一些特定页面的广告过滤功能，除了可以使用自定义的easylist规则，AdsBlockManager还提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockdisallowedlist12" target="_blank">addAdsBlockDisallowedList()</a>接口完成此功能。</p>     <div _ngcontent-ped-c106="" class="highlight-div"><div _ngcontent-ped-c106="" class="highlight-div-header"><div _ngcontent-ped-c106="" class="highlight-div-header-left"><div _ngcontent-ped-c106="" class="handle-button expand-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ped-c106="" class="highlight-div-header-right"><div _ngcontent-ped-c106="" class="handle-button ai-button"></div><div _ngcontent-ped-c106="" class="handle-button line-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ped-c106="" class="handle-button theme-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ped-c106="" class="handle-button copy-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ped-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-comment">// 演示通过一个按钮的点击向Web组件设置广告过滤的域名策略</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">main_url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>  <span class="hljs-attr">text_input_controller</span>: <span class="hljs-title class_">TextInputController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextInputController</span>();</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">input_text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Flex</span>() {</li><li>          <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">main_url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">text_input_controller</span>})</li><li>            .<span class="hljs-title function_">id</span>(<span class="hljs-string">"input_url"</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>            .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>            .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span> = value;</li><li>            })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>}) { <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Go"</span>) }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span>);</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>}) { <span class="hljs-title class_">Text</span>(<span class="hljs-string">"addAdsBlockDisallowedList"</span>) }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> arrDomainSuffixes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>            arrDomainSuffixes.<span class="hljs-title function_">push</span>(<span class="hljs-string">'example.com'</span>);</li><li>            arrDomainSuffixes.<span class="hljs-title function_">push</span>(<span class="hljs-string">'abcdefg.cn'</span>);</li><li>            webview.<span class="hljs-property">AdsBlockManager</span>.<span class="hljs-title function_">addAdsBlockDisallowedList</span>(arrDomainSuffixes);</li><li>          })</li><li>        }</li><li>      }</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">main_url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">enableAdsBlock</span>(<span class="hljs-literal">true</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockdisallowedlist12" target="_blank">addAdsBlockDisallowedList()</a>接口将域名设置到AdsBlockManager的DisallowedList中，下次页面加载时会使用网页url和DisallowedList中的域名进行后缀匹配，匹配成功则不会对此页面进行广告过滤。此外，还提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockallowedlist12" target="_blank">addAdsBlockAllowedList()</a>接口配合DisallowedList进行域名设置，控制是否开启广告过滤。</p>     <p>AdsBlockManager中缓存有2组域名列表，分别为DisallowedList和AllowList，其中DisallowedList用于禁用网页的广告过滤，而AllowList用于重新开启被DisallowedList关闭的广告过滤开关，其中AllowList优先级更高。页面加载时会先使用网页url和AllowList进行匹配，匹配成功的网页广告过滤将保持开启，否则将会继续使用DisallowedList进行匹配，匹配成功将关闭网页的广告过滤。如果访问的网页不在AllowList和DisallowedList中，那么默认网页的广告过滤会保持开启状态。</p>     <p>例如，应用想要开启域名为'news.example.com'和'sport.example.com'的广告过滤，但需要关闭'example.com'的其他域名下网页的广告过滤，就可以先使用addAdsBlockDisallowedList()接口添加'example.com'域名到DisallowedList，再使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-adsblockmanager#addadsblockdisallowedlist12" target="_blank">addAdsBlockDisallowedList()</a>接口添加'news.example.com'和'sport.example.com'域名。</p>     <div _ngcontent-ped-c106="" class="highlight-div"><div _ngcontent-ped-c106="" class="highlight-div-header"><div _ngcontent-ped-c106="" class="highlight-div-header-left"><div _ngcontent-ped-c106="" class="handle-button expand-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ped-c106="" class="highlight-div-header-right"><div _ngcontent-ped-c106="" class="handle-button ai-button"></div><div _ngcontent-ped-c106="" class="handle-button line-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ped-c106="" class="handle-button theme-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ped-c106="" class="handle-button copy-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ped-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-comment">// 演示addAdsBlockAllowedList和addAdsBlockAllowedList配套使用，设置网页级的广告过滤开关。</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">main_url</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>  <span class="hljs-attr">text_input_controller</span>: <span class="hljs-title class_">TextInputController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextInputController</span>();</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">input_text</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'https://www.example.com'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">Flex</span>() {</li><li>          <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">text</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span>, <span class="hljs-attr">placeholder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">main_url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">text_input_controller</span>})</li><li>            .<span class="hljs-title function_">id</span>(<span class="hljs-string">"input_url"</span>)</li><li>            .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>            .<span class="hljs-title function_">margin</span>(<span class="hljs-number">5</span>)</li><li>            .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>)</li><li>            .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span> = value;</li><li>            })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>}) { <span class="hljs-title class_">Text</span>(<span class="hljs-string">"Go"</span>) }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">input_text</span>);</li><li>          })</li><li>
</li><li>          <span class="hljs-title class_">Button</span>({<span class="hljs-attr">type</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span>}) { <span class="hljs-title class_">Text</span>(<span class="hljs-string">"addAdsBlockAllowedList"</span>) }</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-keyword">let</span> arrDisallowDomainSuffixes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>            arrDisallowDomainSuffixes.<span class="hljs-title function_">push</span>(<span class="hljs-string">'example.com'</span>);</li><li>            webview.<span class="hljs-property">AdsBlockManager</span>.<span class="hljs-title function_">addAdsBlockDisallowedList</span>(arrDisallowDomainSuffixes);</li><li>
</li><li>            <span class="hljs-keyword">let</span> arrAllowedDomainSuffixes = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;();</li><li>            arrAllowedDomainSuffixes.<span class="hljs-title function_">push</span>(<span class="hljs-string">'news.example.com'</span>);</li><li>            arrAllowedDomainSuffixes.<span class="hljs-title function_">push</span>(<span class="hljs-string">'sport.example.com'</span>);</li><li>            webview.<span class="hljs-property">AdsBlockManager</span>.<span class="hljs-title function_">addAdsBlockAllowedList</span>(arrAllowedDomainSuffixes);</li><li>          })</li><li>        }</li><li>      }</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">main_url</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">enableAdsBlock</span>(<span class="hljs-literal">true</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>需要注意的是，AdsBlockManager的DisallowedList和AllowedList列表不会持久化，因此重启应用后会重置为空。</p>     <p>如果Web组件未通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-webview-webviewcontroller#enableadsblock12" target="_blank">enableAdsBlock()</a>接口开启广告过滤功能，上述接口设置在此Web组件中将不起作用。</p>    </div>    <div class="tiledSection">     <h3 id="收集广告过滤的信息">收集广告过滤的信息<i class="anchor-icon anchor-icon-link" anchorid="收集广告过滤的信息" tips="复制节点链接"></i></h3>          <p>在Web组件的广告过滤开关开启后，访问的网页如果发生了广告过滤，会通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#onadsblocked12" target="_blank">onAdsBlocked()</a>回调接口通知到应用，应用可根据需要进行过滤信息的收集和统计。</p>     <div _ngcontent-ped-c106="" class="highlight-div"><div _ngcontent-ped-c106="" class="highlight-div-header"><div _ngcontent-ped-c106="" class="highlight-div-header-left"><div _ngcontent-ped-c106="" class="handle-button expand-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ped-c106="" class="highlight-div-header-right"><div _ngcontent-ped-c106="" class="handle-button ai-button"></div><div _ngcontent-ped-c106="" class="handle-button line-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ped-c106="" class="handle-button theme-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ped-c106="" class="handle-button copy-button"><div _ngcontent-ped-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ped-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">totalAdsBlockCounts</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onAdsBlocked</span>(<span class="hljs-function">(<span class="hljs-params">details: AdsBlockedDetails</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (details) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">' Blocked '</span> + details.<span class="hljs-property">adsBlocked</span>.<span class="hljs-property">length</span> + <span class="hljs-string">' in '</span> + details.<span class="hljs-property">url</span>);</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">adList</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt; = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Set</span>(details.<span class="hljs-property">adsBlocked</span>));</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalAdsBlockCounts</span> += adList.<span class="hljs-property">length</span>;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Total blocked counts :'</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">totalAdsBlockCounts</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>由于页面可能随时发生变化并不断产生网络请求，为了减少通知频次、降低对页面加载过程的影响，仅在页面加载完成时进行首次通知，此后发生的过滤将间隔1秒钟上报，无广告过滤则无通知。</p>    </div>   </div>   <div></div></div>