<h1 _ngcontent-equ-c119="" class="doc-title ng-star-inserted" title="使用Web组件的手势与应用交互"> 使用Web组件的手势与应用交互 </h1>

<div _ngcontent-equ-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在移动端或支持触控的Web应用中，用户通过触摸屏与页面交互，Web组件支持了常见的手势识别，例如长按、滑动、点击等，以支持丰富的用户交互体验。</p>    <div class="tiledSection">     <h2 id="arkweb手势识别">ArkWeb手势识别<i class="anchor-icon anchor-icon-link" anchorid="arkweb手势识别" tips="复制节点链接"></i></h2>          <p>ArkWeb接收ArkUI的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-interaction-development-guide-touch-screen#触摸事件">触摸事件</a>，并识别出手势（触摸事件的分发策略详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-interaction-basic-principles">交互基础机制说明</a>）。ArkWeb手势符合W3C标准：Touch Events、UI Events、Pointer Events。</p>     <p>常见事件识别说明：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.1" valign="top" width="50%">手势事件</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.4.1.3.1.2" valign="top" width="50%">触发条件</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">Tap</td>         <td class="cellrowborder" valign="top" width="50%">按下并抬起时触发，且间隔较短未触发长按。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">LongPress</td>         <td class="cellrowborder" valign="top" width="50%">按下且不移动，经过一段延迟后触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">ScrollBegin</td>         <td class="cellrowborder" valign="top" width="50%">滚动开始时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">ScrollUpdate</td>         <td class="cellrowborder" valign="top" width="50%">滚动时触发，包括抛滑和拖滑。手指未离开屏幕时的滚动为拖滑；若手指离开屏幕时带有速度，离手后页面继续滚动，被称为抛滑。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">ScrollEnd</td>         <td class="cellrowborder" valign="top" width="50%">滚动结束时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FlingStart</td>         <td class="cellrowborder" valign="top" width="50%">滚动过程中手指抬起，且抬手速度足够快，触发了抛滑。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">FlingCancel</td>         <td class="cellrowborder" valign="top" width="50%">取消抛滑时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PinchBegin</td>         <td class="cellrowborder" valign="top" width="50%">捏合开始时触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PinchUpdate</td>         <td class="cellrowborder" valign="top" width="50%">捏合过程中触发。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">PinchEnd</td>         <td class="cellrowborder" valign="top" width="50%">捏合结束时触发。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="arkweb手势与arkui手势">ArkWeb手势与ArkUI手势<i class="anchor-icon anchor-icon-link" anchorid="arkweb手势与arkui手势" tips="复制节点链接"></i></h2>          <p>ArkUI提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-binding">手势绑定</a>，Web组件有独立的手势识别，因此需要区分两种手势：</p>     <ul>      <li>ArkWeb手势：Web组件接收触摸事件自动生成的手势，这些手势作用于网页上。</li>      <li>ArkUI手势：Web组件作为通用组件会接收ArkUI手势，ArkUI手势并不直接作用于网页，而作用于Web组件上。</li>     </ul>     <p>以缩放为例说明两种手势的区别：</p>     <ul>      <li>在Web上使用双指捏合时，Web组件中的内容将会缩放。这是由于ArkWeb识别了Pinch事件并将其作用于网页上。</li>      <li>使用三指捏合，Web组件本身会进行缩放。这是因为ArkWeb接收到ArkUI识别出的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-single-gesture#捏合手势pinchgesture">PinchGesture</a>，执行绑定的回调函数。同时，ArkWeb支持scale方法，能够调整Web组件的缩放比例。</li>     </ul>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>该示例仅用于说明ArkUI手势和ArkWeb手势的区别，不建议使用此方法进行Web组件的缩放。</p>      </div></div></div>     <div _ngcontent-equ-c106="" class="highlight-div"><div _ngcontent-equ-c106="" class="highlight-div-header"><div _ngcontent-equ-c106="" class="highlight-div-header-left"><div _ngcontent-equ-c106="" class="handle-button expand-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-equ-c106="" class="highlight-div-header-right"><div _ngcontent-equ-c106="" class="handle-button ai-button"></div><div _ngcontent-equ-c106="" class="handle-button line-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-equ-c106="" class="handle-button theme-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-equ-c106="" class="handle-button copy-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-equ-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">scaleValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">pinchValue</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>      <span class="hljs-comment">// 在组件上绑定缩放比例，可以通过修改缩放比例来实现组件的缩小或者放大</span></li><li>      .<span class="hljs-title function_">scale</span>({ <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scaleValue</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">scaleValue</span>, <span class="hljs-attr">z</span>: <span class="hljs-number">1</span> })</li><li>      .<span class="hljs-title function_">zoomAccess</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">gesture</span>(</li><li>        <span class="hljs-comment">// 在组件上绑定三指触发的捏合手势</span></li><li>        <span class="hljs-title class_">PinchGesture</span>({ <span class="hljs-attr">fingers</span>: <span class="hljs-number">3</span> })</li><li>          .<span class="hljs-title function_">onActionStart</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent|<span class="hljs-literal">undefined</span></span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Pinch start'</span>);</li><li>          })</li><li>            <span class="hljs-comment">// 当捏合手势触发时，可以通过回调函数获取缩放比例，从而修改组件的缩放比例</span></li><li>          .<span class="hljs-title function_">onActionUpdate</span>(<span class="hljs-function">(<span class="hljs-params">event: GestureEvent|<span class="hljs-literal">undefined</span></span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span>(event){</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">scaleValue</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">pinchValue</span> * event.<span class="hljs-property">scale</span>;</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Pinch update'</span>);</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">onActionEnd</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">pinchValue</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">scaleValue</span>;</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Pinch end'</span>);</li><li>          })</li><li>      )</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="951" originwidth="554" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.86355906140571718996246576471925:50001231000000:2800:A326CBCD39B7120BDAA19594944AB992A9CF469AEBF4C7D84D9C71739B81AB2F.gif" width="554" height="951"></span></p>    </div>    <div class="tiledSection">     <h2 id="web组件的手势拦截">Web组件的手势拦截<i class="anchor-icon anchor-icon-link" anchorid="web组件的手势拦截" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>ArkUI手势</p>       <p>ArkWeb会消费部分ArkUI手势，例如<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-single-gesture#滑动手势pangesture">滑动手势</a>，若希望自行处理这些手势而非由ArkWeb消费，可以参考ArkUI的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-gesture-events-gesture-judge">手势冲突处理</a>。</p></li>      <li>       <p>ArkWeb手势</p>       <p>ArkWeb手势的生成需要Web组件接收触摸事件，有两种拦截方案：</p>       <ol>        <li>完全禁止触摸事件发送给Web组件，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-interaction-basic-principles#触摸测试">触摸测试</a>。</li>        <li>发送TouchCancel触摸事件给Web组件，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-gesture-h#函数" target="_blank">OH_ArkUI_TouchRecognizer_CancelTouch</a>。</li>       </ol></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="如何禁用缩放手势" class="firsth2">如何禁用缩放手势<i class="anchor-icon anchor-icon-link" anchorid="如何禁用缩放手势" tips="复制节点链接"></i></h3>          <p>Web组件提供了接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#zoomaccess" target="_blank">zoomAccess</a>，控制是否可以缩放。网页上有user-scalable属性也会影响缩放。详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-scale-zoom">使用Web组件管理网页缩放</a>。</p>    </div>    <div class="tiledSection">     <h3 id="web组件中如何通过手势滑动返回上一个web页面">Web组件中如何通过手势滑动返回上一个Web页面<i class="anchor-icon anchor-icon-link" anchorid="web组件中如何通过手势滑动返回上一个web页面" tips="复制节点链接"></i></h3>          <p><strong>解决措施</strong></p>     <p>通过重写onBackPress函数来自定义返回逻辑，使用WebviewController判断是否返回上一个Web页面。</p>     <p><strong>示例代码</strong></p>     <div _ngcontent-equ-c106="" class="highlight-div"><div _ngcontent-equ-c106="" class="highlight-div-header"><div _ngcontent-equ-c106="" class="highlight-div-header-left"><div _ngcontent-equ-c106="" class="handle-button expand-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-equ-c106="" class="highlight-div-header-right"><div _ngcontent-equ-c106="" class="handle-button ai-button"></div><div _ngcontent-equ-c106="" class="handle-button line-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-equ-c106="" class="handle-button theme-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-equ-c106="" class="handle-button copy-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-equ-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com'</span>, <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })<span class="hljs-comment">//需要手动替换为真实网站</span></li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onBackPress</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 当前页面是否可前进或者后退给定的step步(-1),正数代表前进，负数代表后退</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">accessStep</span>(-<span class="hljs-number">1</span>)) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">backward</span>(); <span class="hljs-comment">// 返回上一个web页</span></li><li>      <span class="hljs-comment">// 执行用户自定义返回逻辑</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-comment">// 执行系统默认返回逻辑，返回上一个page页</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="为什么web加载后网页无法交互">为什么Web加载后网页无法交互？<i class="anchor-icon anchor-icon-link" anchorid="为什么web加载后网页无法交互" tips="复制节点链接"></i></h3>          <p>网页可能基于其他平台的User-Agent进行判断。为解决此问题，可以在Web组件中设置自定义User-Agent，例如：</p>     <div _ngcontent-equ-c106="" class="highlight-div"><div _ngcontent-equ-c106="" class="highlight-div-header"><div _ngcontent-equ-c106="" class="highlight-div-header-left"><div _ngcontent-equ-c106="" class="handle-button expand-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-equ-c106="" class="highlight-div-header-right"><div _ngcontent-equ-c106="" class="handle-button ai-button"></div><div _ngcontent-equ-c106="" class="handle-button line-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-equ-c106="" class="handle-button theme-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-equ-c106="" class="handle-button copy-button"><div _ngcontent-equ-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-equ-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-attr">webController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()</li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>){</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Web</span>({</li><li>          <span class="hljs-attr">src</span>: <span class="hljs-string">'https://www.example.com'</span>,</li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>,</li><li>        }).<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 自定义User-Agent</span></li><li>          <span class="hljs-keyword">let</span> customUA = <span class="hljs-string">'Mozilla/5.0 (Phone; Android; HarmonyOS 5.0) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/129.0.0.0 Mobile Safari/537.36'</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>.<span class="hljs-title function_">setCustomUserAgent</span>(customUA)</li><li>        })</li><li>      }</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>