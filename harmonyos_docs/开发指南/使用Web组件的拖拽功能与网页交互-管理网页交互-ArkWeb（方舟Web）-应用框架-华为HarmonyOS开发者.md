<h1 _ngcontent-vju-c119="" class="doc-title ng-star-inserted" title="使用Web组件的拖拽功能与网页交互"> 使用Web组件的拖拽功能与网页交互 </h1>

<div _ngcontent-vju-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkWeb的拖拽功能使应用能够在网页中实现元素的拖放，用户可以长按可拖拽的元素，将其拖至可放置的元素上，然后松手完成放置。ArkWeb在网页内容中的拖拽功能满足H5标准。</p>    <div class="tiledSection">     <h2 id="将网页内容拖拽至其他应用">将网页内容拖拽至其他应用<i class="anchor-icon anchor-icon-link" anchorid="将网页内容拖拽至其他应用" tips="复制节点链接"></i></h2>          <p>ArkWeb目前支持以下四种数据格式。应用按照 H5 标准设置这些格式的拖拽数据，即可将内容拖拽到其他应用中。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.1" valign="top" width="50%">数据格式</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">text/plain</td>         <td class="cellrowborder" valign="top" width="50%">文本</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">text/uri-list</td>         <td class="cellrowborder" valign="top" width="50%">链接</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">text/html</td>         <td class="cellrowborder" valign="top" width="50%">HTML格式</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">Files</td>         <td class="cellrowborder" valign="top" width="50%">文件</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="拖拽事件通知">拖拽事件通知<i class="anchor-icon anchor-icon-link" anchorid="拖拽事件通知" tips="复制节点链接"></i></h2>          <p>ArkWeb拖拽不同于ArkUI的组件级拖拽，主要针对网页内容的拖拽，因此仅支持部分拖拽事件的监听方法。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">监听方法</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-drag-drop#ondragstart" target="_blank">onDragStart</a></td>         <td class="cellrowborder" valign="top" width="50%">不建议使用此方法，否则会影响Web组件的拖拽行为，造成拖拽逻辑不符合预期，如无法触发html拖拽事件监听，预览图无法创建或预览图错误，拖拽数据无法预置等。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-drag-drop#ondragenter" target="_blank">onDragEnter</a></td>         <td class="cellrowborder" valign="top" width="50%">拖拽的元素进入Web区域。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-drag-drop#ondragmove" target="_blank">onDragMove</a></td>         <td class="cellrowborder" valign="top" width="50%">拖拽的元素在Web区域移动。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-drag-drop#ondragleave" target="_blank">onDragLeave</a></td>         <td class="cellrowborder" valign="top" width="50%">拖拽的元素离开Web区域。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-events-drag-drop#ondragend10" target="_blank">onDragEnd</a></td>         <td class="cellrowborder" valign="top" width="50%">由Web发起的拖拽元素结束拖拽。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="在arkts侧实现拖拽相关逻辑">在ArkTS侧实现拖拽相关逻辑<i class="anchor-icon anchor-icon-link" anchorid="在arkts侧实现拖拽相关逻辑" tips="复制节点链接"></i></h2>          <p>在多数情况下，应用在H5端实现的拖拽功能能够满足需求。如有需要，请参考以下案例，实现在ArkTS端进行拖拽数据读取等操作。</p>     <ol>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web-app-page-data-channel">建立应用侧与前端页面数据通道</a>。</li>      <li>在onDrop方法中，做简单逻辑，例如暂存一些关键数据。</li>      <li>在ArkTS侧接受消息的方法中，添加应用处理逻辑，可以进行耗时任务。</li>     </ol>     <p>由于ArkTS侧的onDrop方法会早于H5中放置事件的处理方法（html示例中的droppable.addEventListener('drop')）执行，若在onDrop方法中进行页面跳转等操作，将导致H5中的drop方法无法正确执行，产生不符合预期的结果。因此，应建立双向通信机制，在H5中的drop方法执行完毕后，通知ArkTS侧执行相应的业务逻辑，以确保业务逻辑的预期执行。</p>     <div _ngcontent-vju-c106="" class="highlight-div"><div _ngcontent-vju-c106="" class="highlight-div-header"><div _ngcontent-vju-c106="" class="highlight-div-header-left"><div _ngcontent-vju-c106="" class="handle-button expand-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vju-c106="" class="highlight-div-header-right"><div _ngcontent-vju-c106="" class="handle-button ai-button"></div><div _ngcontent-vju-c106="" class="handle-button line-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vju-c106="" class="handle-button theme-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vju-c106="" class="handle-button copy-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vju-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span></li><li><span class="hljs-keyword">import</span> { unifiedDataChannel, uniformTypeDescriptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">DragDrop</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">ports</span>: <span class="hljs-title class_">Array</span>&lt;webview.<span class="hljs-property">WebMessagePort</span>&gt; = []</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">dragData</span>: <span class="hljs-title class_">Array</span>&lt;unifiedDataChannel.<span class="hljs-property">UnifiedRecord</span>&gt; = []</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({</li><li>        <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"drag.html"</span>),</li><li>        <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>,</li><li>      }).<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>        <span class="hljs-comment">//注册通信端口</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ports</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">createWebMessagePorts</span>();</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">ports</span>[<span class="hljs-number">1</span>].<span class="hljs-title function_">onMessageEvent</span>(<span class="hljs-function">(<span class="hljs-params">result: webview.WebMessage</span>) =&gt;</span> {</li><li>          <span class="hljs-comment">//ArkTS收到html传来的数据后的处理，可以先打日志确认下消息，双端的消息格式可以自己约定，能唯一识别就行</span></li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"ETS receive Message: typeof (result) = "</span> + <span class="hljs-keyword">typeof</span> (result) + <span class="hljs-string">";"</span> + result);</li><li>          <span class="hljs-comment">//这里添加result中消息接收到后的处理,可进行耗时任务</span></li><li>        });</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"ETS postMessage set h5port "</span>);</li><li>        <span class="hljs-comment">//完成通信端口注册后，向前端发送注册完成消息，完成双向的端口绑定</span></li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">postMessage</span>(<span class="hljs-string">'__init_port__'</span>, [<span class="hljs-variable language_">this</span>.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>]], <span class="hljs-string">'*'</span>);</li><li>      })<span class="hljs-comment">// onDrop 可做简单逻辑，例如暂存一些关键数据</span></li><li>        .<span class="hljs-title function_">onDrop</span>(<span class="hljs-function">(<span class="hljs-params">DragEvent: DragEvent</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"ETS onDrop!"</span>)</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: <span class="hljs-title class_">UnifiedData</span> = <span class="hljs-title class_">DragEvent</span>.<span class="hljs-title function_">getData</span>();</li><li>          <span class="hljs-keyword">if</span>(!data) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>          }</li><li>          <span class="hljs-keyword">let</span> <span class="hljs-attr">uriArr</span>: <span class="hljs-title class_">Array</span>&lt;unifiedDataChannel.<span class="hljs-property">UnifiedRecord</span>&gt; = data.<span class="hljs-title function_">getRecords</span>();</li><li>          <span class="hljs-keyword">if</span> (!uriArr || uriArr.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>          }</li><li>          <span class="hljs-comment">// 可以遍历records取数据暂存，或者以其他方式暂存数据</span></li><li>          <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; uriArr.<span class="hljs-property">length</span>; ++i) {</li><li>            <span class="hljs-keyword">if</span> (uriArr[i].<span class="hljs-title function_">getType</span>() === uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>) {</li><li>              <span class="hljs-keyword">let</span> plainText = uriArr[i] <span class="hljs-keyword">as</span> unifiedDataChannel.<span class="hljs-property">PlainText</span>;</li><li>              <span class="hljs-keyword">if</span> (plainText.<span class="hljs-property">textContent</span>) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"plainText.textContent: "</span>, plainText.<span class="hljs-property">textContent</span>);</li><li>              }</li><li>            }</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></li><li>        })</li><li>    }</li><li>
</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>html示例:</p>     <div _ngcontent-vju-c106="" class="highlight-div"><div _ngcontent-vju-c106="" class="highlight-div-header"><div _ngcontent-vju-c106="" class="highlight-div-header-left"><div _ngcontent-vju-c106="" class="handle-button expand-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vju-c106="" class="highlight-div-header-right"><div _ngcontent-vju-c106="" class="handle-button ai-button"></div><div _ngcontent-vju-c106="" class="handle-button line-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vju-c106="" class="handle-button theme-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vju-c106="" class="handle-button copy-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vju-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0, user-scalable=no"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>H5 拖拽 Demo<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span></li><li><span class="language-css">    <span class="hljs-selector-tag">body</span> {</span></li><li><span class="language-css">      <span class="hljs-attribute">font-family</span>: Arial, sans-serif;</span></li><li><span class="language-css">      <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;</span></li><li><span class="language-css">    }</span></li><li><span class="language-css"></span></li><li><span class="language-css">    <span class="hljs-selector-class">.draggable</span> {</span></li><li><span class="language-css">      <span class="hljs-attribute">width</span>: <span class="hljs-number">100px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">height</span>: <span class="hljs-number">100px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4CAF50</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">color</span>: white;</span></li><li><span class="language-css">      <span class="hljs-attribute">text-align</span>: center;</span></li><li><span class="language-css">      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">100px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">margin-bottom</span>: <span class="hljs-number">20px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">cursor</span>: grab;</span></li><li><span class="language-css">    }</span></li><li><span class="language-css"></span></li><li><span class="language-css">    <span class="hljs-selector-class">.droppable</span> {</span></li><li><span class="language-css">      <span class="hljs-attribute">width</span>: <span class="hljs-number">300px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">height</span>: <span class="hljs-number">150px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">border</span>: <span class="hljs-number">2px</span> dashed <span class="hljs-number">#999</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f0f0f0</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">text-align</span>: center;</span></li><li><span class="language-css">      <span class="hljs-attribute">line-height</span>: <span class="hljs-number">150px</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;</span></li><li><span class="language-css">    }</span></li><li><span class="language-css"></span></li><li><span class="language-css">    <span class="hljs-selector-class">.success</span> {</span></li><li><span class="language-css">      <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#4CAF50</span>;</span></li><li><span class="language-css">      <span class="hljs-attribute">color</span>: white;</span></li><li><span class="language-css">    }</span></li><li><span class="language-css"></span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">h2</span>&gt;</span>H5 拖拽 Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"draggable"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"draggable"</span> <span class="hljs-attr">draggable</span>=<span class="hljs-string">"true"</span>&gt;</span>可拖拽元素<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">"droppable"</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"droppable"</span>&gt;</span>请将方块拖到这里<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-keyword">const</span> draggable = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'draggable'</span>);</span></li><li><span class="language-javascript">    <span class="hljs-keyword">const</span> droppable = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">'droppable'</span>);</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">// 拖拽开始事件</span></span></li><li><span class="language-javascript">    draggable.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragstart'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {</span></li><li><span class="language-javascript">      e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">setData</span>(<span class="hljs-string">'text/plain'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">id</span>);</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'0.4'</span>;</span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">// 拖拽结束事件</span></span></li><li><span class="language-javascript">    draggable.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragend'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">style</span>.<span class="hljs-property">opacity</span> = <span class="hljs-string">'1'</span>;</span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">// 拖入目标区域时触发</span></span></li><li><span class="language-javascript">    droppable.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'dragover'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {</span></li><li><span class="language-javascript">      e.<span class="hljs-title function_">preventDefault</span>(); <span class="hljs-comment">// 必须调用，否则无法触发 drop 事件</span></span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">// 放置事件</span></span></li><li><span class="language-javascript">    droppable.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'drop'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) {</span></li><li><span class="language-javascript">      e.<span class="hljs-title function_">preventDefault</span>();</span></li><li><span class="language-javascript">      <span class="hljs-keyword">const</span> data = e.<span class="hljs-property">dataTransfer</span>.<span class="hljs-title function_">getData</span>(<span class="hljs-string">'text/plain'</span>);</span></li><li><span class="language-javascript">      <span class="hljs-comment">// 传入ArkTS</span></span></li><li><span class="language-javascript">      <span class="hljs-title class_">PostMsgToArkTS</span>(data);</span></li><li><span class="language-javascript">      <span class="hljs-keyword">const</span> draggableEl = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(data);</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">appendChild</span>(draggableEl);</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">'success'</span>);</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">this</span>.<span class="hljs-property">textContent</span> = <span class="hljs-string">"放置成功！"</span>;</span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">//     scriptproxy端口在js侧设置</span></span></li><li><span class="language-javascript">    <span class="hljs-keyword">var</span> h5Port;</span></li><li><span class="language-javascript">    <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'message'</span>, <span class="hljs-keyword">function</span> (<span class="hljs-params">event</span>) {</span></li><li><span class="language-javascript">    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"H5 receive settingPort message"</span>);</span></li><li><span class="language-javascript">        <span class="hljs-keyword">if</span> (event.<span class="hljs-property">data</span> == <span class="hljs-string">'__init_port__'</span>) {</span></li><li><span class="language-javascript">            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>] != <span class="hljs-literal">null</span>) {</span></li><li><span class="language-javascript">                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"H5 set h5Port "</span> + event.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>]);</span></li><li><span class="language-javascript">                h5Port = event.<span class="hljs-property">ports</span>[<span class="hljs-number">0</span>];</span></li><li><span class="language-javascript">            }</span></li><li><span class="language-javascript">        }</span></li><li><span class="language-javascript">    });</span></li><li><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-comment">// 通过scriptproxy方式,发送数据到ArkTS侧的实现</span></span></li><li><span class="language-javascript">    <span class="hljs-keyword">function</span> <span class="hljs-title function_">PostMsgToArkTS</span>(<span class="hljs-params">data</span>) {</span></li><li><span class="language-javascript">        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"H5 PostMsgToArkTS, h5Port "</span> + h5Port);</span></li><li><span class="language-javascript">        <span class="hljs-keyword">if</span> (h5Port) {</span></li><li><span class="language-javascript">          h5Port.<span class="hljs-title function_">postMessage</span>(data);</span></li><li><span class="language-javascript">        } <span class="hljs-keyword">else</span> {</span></li><li><span class="language-javascript">          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"h5Port is null, Please initialize first"</span>);</span></li><li><span class="language-javascript">        }</span></li><li><span class="language-javascript">    }</span></li><li><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="1104" originwidth="633" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.19372861742767031162547395767722:50001231000000:2800:DCF2CD76AB8134515EB4E994D400384EA976B845578DD8A0BC71F85A2AD144CF.gif" width="633" height="1104"></span></p>     <p>日志打印：</p>     <p><span><img originheight="181" originwidth="1300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.13130282594345008823254355394835:50001231000000:2800:E42C3734B890EEF1D6DB52650D06BAD4EFA17676041799C9924D3F28F306E9D5.png" width="920" height="128.0923076923077"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="为什么h5设置的拖拽事件没有触发" class="firsth2">为什么H5设置的拖拽事件没有触发？<i class="anchor-icon anchor-icon-link" anchorid="为什么h5设置的拖拽事件没有触发" tips="复制节点链接"></i></h3>          <p>请检查相关CSS资源是否正常设置，因为有些网页UA做了判断，针对特定设备的UA才会进行CSS样式设置。可以考虑在Web组件设置自定义UA解决这种问题，例如：</p>     <div _ngcontent-vju-c106="" class="highlight-div"><div _ngcontent-vju-c106="" class="highlight-div-header"><div _ngcontent-vju-c106="" class="highlight-div-header-left"><div _ngcontent-vju-c106="" class="handle-button expand-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vju-c106="" class="highlight-div-header-right"><div _ngcontent-vju-c106="" class="handle-button ai-button"></div><div _ngcontent-vju-c106="" class="handle-button line-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vju-c106="" class="handle-button theme-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vju-c106="" class="handle-button copy-button"><div _ngcontent-vju-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vju-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span></li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>    <span class="hljs-keyword">private</span> <span class="hljs-attr">webController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()</li><li>    <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>){</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Web</span>({</li><li>          <span class="hljs-attr">src</span>: <span class="hljs-string">"example.com"</span>,</li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>,</li><li>        }).<span class="hljs-title function_">onControllerAttached</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 特定UA</span></li><li>          <span class="hljs-keyword">let</span> customUA = <span class="hljs-string">'android'</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>.<span class="hljs-title function_">setCustomUserAgent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>.<span class="hljs-title function_">getUserAgent</span>() + customUA)</li><li>        })</li><li>      }</li><li>    }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>