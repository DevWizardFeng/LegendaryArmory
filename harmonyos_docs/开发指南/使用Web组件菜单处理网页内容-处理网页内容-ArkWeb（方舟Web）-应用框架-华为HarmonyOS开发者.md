<h1 _ngcontent-xsv-c119="" class="doc-title ng-star-inserted" title="使用Web组件菜单处理网页内容"> 使用Web组件菜单处理网页内容 </h1>

<div _ngcontent-xsv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>菜单作为用户交互的关键组件，其作用是构建清晰的导航体系，通过结构化布局展示功能入口，使用户能够迅速找到目标内容或执行操作。作为人机交互的重要枢纽，它显著提升了Web组件的可访问性和用户体验，是应用设计中必不可少的部分。Web组件菜单类型包括<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#文本选中菜单">文本选中菜单</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#上下文菜单">上下文菜单</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#自定义菜单">自定义菜单</a>，应用可根据具体需求灵活选择。</p>    <div class="tablenoborder">     <div class="tbBox"><table class="layoutFixed idpTab">      <thead>       <tr>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.5.1.1" valign="top" width="25%">菜单类型</th>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.5.1.2" valign="top" width="25%">目标元素</th>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.5.1.3" valign="top" width="25%">响应类型</th>        <th align="left" class="cellrowborder" id="mcps1.3.2.1.5.1.4" valign="top" width="25%">是否支持自定义</th>       </tr>      </thead>             <tbody><tr>        <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#文本选中菜单">文本选中菜单</a></td>        <td class="cellrowborder" valign="top" width="25%">文本</td>        <td class="cellrowborder" valign="top" width="25%">手势长按</td>        <td class="cellrowborder" valign="top" width="25%">可增减菜单项，菜单样式不可自定义</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#上下文菜单">上下文菜单</a></td>        <td class="cellrowborder" valign="top" width="25%">超链接、图片、文字</td>        <td class="cellrowborder" valign="top" width="25%">手势长按、鼠标右键</td>        <td class="cellrowborder" valign="top" width="25%">支持通过菜单组件自定义</td>       </tr>       <tr>        <td class="cellrowborder" valign="top" width="25%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/web_menu#自定义菜单">自定义菜单</a></td>        <td class="cellrowborder" valign="top" width="25%">图片</td>        <td class="cellrowborder" valign="top" width="25%">手势长按</td>        <td class="cellrowborder" valign="top" width="25%">支持通过菜单组件自定义</td>       </tr>           </tbody></table></div>    </div>    <div class="tiledSection">     <h2 id="文本选中菜单">文本选中菜单<i class="anchor-icon anchor-icon-link" anchorid="文本选中菜单" tips="复制节点链接"></i></h2>          <p>Web组件的文本选中菜单是一种通过自定义元素实现的上下文交互组件，当用户选中文本时会动态显示，提供复制、分享、标注等语义化操作，具备标准化功能与可扩展性，是移动端文本操作的核心功能。文本选中菜单在用户长按选中文本或编辑状态下长按出现单手柄时弹出，菜单项横向排列。系统提供默认的菜单实现。应用可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#editmenuoptions12" target="_blank">editMenuOptions</a>接口对文本选中菜单进行自定义操作。</p>     <ol>      <li>通过onCreateMenu方法自定义菜单项，通过操作Array&lt;<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#textmenuitem12对象说明" target="_blank">TextMenuItem</a>&gt;数组可对显示菜单项进行增减操作，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#textmenuitem12对象说明" target="_blank">TextMenuItem</a>中定义菜单项名称、图标、ID等内容。</li>      <li>通过onMenuItemClick方法处理菜单项点击事件，当返回false时会执行系统默认逻辑。</li>      <li>创建一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#editmenuoptions" target="_blank">EditMenuOptions</a>对象，包含onCreateMenu和onMenuItemClick两个方法，通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#editmenuoptions12" target="_blank">editMenuOptions</a>方法与Web组件绑定。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">onCreateMenu</span>(<span class="hljs-attr">menuItems</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">TextMenuItem</span>&gt;): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">TextMenuItem</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> items = menuItems.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">menuItem</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 过滤用户需要的系统按键</span></li><li>      <span class="hljs-keyword">return</span> (</li><li>        menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-property">CUT</span>) ||</li><li>        menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-property">COPY</span>) ||</li><li>        menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-property">PASTE</span>)</li><li>      );</li><li>    });</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">customItem1</span>: <span class="hljs-title class_">TextMenuItem</span> = {</li><li>      <span class="hljs-attr">content</span>: <span class="hljs-string">'customItem1'</span>,</li><li>      <span class="hljs-attr">id</span>: <span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">'customItem1'</span>),</li><li>      <span class="hljs-attr">icon</span>: $r(<span class="hljs-string">'app.media.startIcon'</span>)</li><li>    };</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">customItem2</span>: <span class="hljs-title class_">TextMenuItem</span> = {</li><li>      <span class="hljs-attr">content</span>: $r(<span class="hljs-string">'app.string.EntryAbility_label'</span>),</li><li>      <span class="hljs-attr">id</span>: <span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">'customItem2'</span>),</li><li>      <span class="hljs-attr">icon</span>: $r(<span class="hljs-string">'app.media.startIcon'</span>)</li><li>    };</li><li>    items.<span class="hljs-title function_">push</span>(customItem1); <span class="hljs-comment">// 在选项列表后添加新选项</span></li><li>    items.<span class="hljs-title function_">unshift</span>(customItem2); <span class="hljs-comment">// 在选项列表前添加选项</span></li><li>    items.<span class="hljs-title function_">push</span>(customItem1);</li><li>    items.<span class="hljs-title function_">push</span>(customItem1);</li><li>    items.<span class="hljs-title function_">push</span>(customItem1);</li><li>    items.<span class="hljs-title function_">push</span>(customItem1);</li><li>    items.<span class="hljs-title function_">push</span>(customItem1);</li><li>    <span class="hljs-keyword">return</span> items;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMenuItemClick</span>(<span class="hljs-attr">menuItem</span>: <span class="hljs-title class_">TextMenuItem</span>, <span class="hljs-attr">textRange</span>: <span class="hljs-title class_">TextRange</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">if</span> (menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-property">CUT</span>)) {</li><li>      <span class="hljs-comment">// 用户自定义行为</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"拦截 id：CUT"</span>)</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 返回true不执行系统回调</span></li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-property">COPY</span>)) {</li><li>      <span class="hljs-comment">// 用户自定义行为</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"不拦截 id：COPY"</span>)</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 返回false执行系统回调</span></li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">'customItem1'</span>))) {</li><li>      <span class="hljs-comment">// 用户自定义行为</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"拦截 id：customItem1"</span>)</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>; <span class="hljs-comment">// 用户自定义菜单选项返回true时点击后不关闭菜单，返回false时关闭菜单</span></li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (menuItem.<span class="hljs-property">id</span>.<span class="hljs-title function_">equals</span>(<span class="hljs-title class_">TextMenuItemId</span>.<span class="hljs-title function_">of</span>(<span class="hljs-string">'customItem2'</span>))) {</li><li>      <span class="hljs-comment">// 用户自定义行为</span></li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"拦截 id：customItem2"</span>)</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 返回默认值false</span></li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-title class_">EditMenuOptions</span>: <span class="hljs-title class_">EditMenuOptions</span> = { <span class="hljs-attr">onCreateMenu</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onCreateMenu</span>, <span class="hljs-attr">onMenuItemClick</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMenuItemClick</span> }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">editMenuOptions</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">EditMenuOptions</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--index.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>测试网页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>editMenuOptions Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>edit menu options<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="485" originwidth="314" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.24805608724072412378501591694336:50001231000000:2800:B9EB049EE2B8A80D16610938A35787F239C6C6E4D2403E41925FD331924894F3.gif" width="314" height="485"></span></p>    </div>    <div class="tiledSection">     <h2 id="上下文菜单">上下文菜单<i class="anchor-icon anchor-icon-link" anchorid="上下文菜单" tips="复制节点链接"></i></h2>          <p>上下文菜单是用户通过特定操作（如右键点击或长按富文本）触发的快捷菜单，用于提供与当前操作对象或界面元素相关的功能选项。菜单项纵向排列。系统未提供默认实现，若应用未实现，则不显示上下文菜单。应用需要创建一个<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>组件并与Web绑定，在菜单弹出时可通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow</a>回调接口获取上下文菜单的详细信息，包括点击位置的HTML元素信息及点击位置信息。</p>     <ol>      <li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>组件作为弹出的菜单，包含所有菜单项行为与样式。</li>      <li>使用bindPopup方法将Menu组件与Web组件绑定。当上下文菜单弹出时，将显示创建的Menu组件。</li>      <li>在onContextMenuShow回调中获取上下文菜单事件信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-i#oncontextmenushowevent12" target="_blank">onContextMenuShowEvent</a>。其中param为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuparam" target="_blank">WebContextMenuParam</a>类型，包含点击位置对应HTML元素信息和位置信息，result为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-webcontextmenuresult" target="_blank">WebContextMenuResult</a>类型，提供常见的菜单能力。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { pasteboard } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable constant_">TAG</span> = <span class="hljs-string">'ContextMenu'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">WebContextMenuResult</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">linkUrl</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">offsetX</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">offsetY</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">showMenu</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-comment">// 构建自定义菜单及触发功能接口</span></li><li>  <span class="hljs-title class_">MenuBuilder</span>() {</li><li>    <span class="hljs-comment">// 以垂直列表形式显示的菜单。</span></li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-comment">// 展示菜单Menu中具体的item菜单项。</span></li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'复制图片'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">copyImage</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'剪切'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">cut</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'复制'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">copy</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'粘贴'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">paste</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'复制链接'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> pasteData = pasteboard.<span class="hljs-title function_">createData</span>(<span class="hljs-string">'text/plain'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">linkUrl</span>);</li><li>          pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>().<span class="hljs-title function_">setData</span>(pasteData, <span class="hljs-function">(<span class="hljs-params">error</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (error) {</li><li>              <span class="hljs-keyword">return</span>;</li><li>            }</li><li>          })</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">'全选'</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">100</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">selectAll</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">150</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        <span class="hljs-comment">// 触发自定义弹窗</span></li><li>        .<span class="hljs-title function_">onContextMenuShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = event.<span class="hljs-property">result</span></li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"x coord = "</span> + event.<span class="hljs-property">param</span>.<span class="hljs-title function_">x</span>());</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"link url = "</span> + event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getLinkUrl</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">linkUrl</span> = event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getLinkUrl</span>();</li><li>          }</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`x: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.offsetX}</span>, y: <span class="hljs-subst">${<span class="hljs-variable language_">this</span>.offsetY}</span>`</span>);</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span> = <span class="hljs-number">0</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">max</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(event?.<span class="hljs-property">param</span>.<span class="hljs-title function_">y</span>() ?? <span class="hljs-number">0</span>) - <span class="hljs-number">0</span>, <span class="hljs-number">0</span>);</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">bindPopup</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span>,</li><li>          {</li><li>            <span class="hljs-attr">builder</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">MenuBuilder</span>(),</li><li>            <span class="hljs-attr">enableArrow</span>: <span class="hljs-literal">false</span>,</li><li>            <span class="hljs-attr">placement</span>: <span class="hljs-title class_">Placement</span>.<span class="hljs-property">LeftTop</span>,</li><li>            <span class="hljs-attr">offset</span>: { <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetX</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">offsetY</span> },</li><li>            <span class="hljs-attr">mask</span>: <span class="hljs-literal">false</span>,</li><li>            <span class="hljs-attr">onStateChange</span>: <span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {</li><li>              <span class="hljs-keyword">if</span> (!e.<span class="hljs-property">isVisible</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>!.<span class="hljs-title function_">closeContextMenu</span>();</li><li>              }</li><li>            }</li><li>          })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!-- index.html --&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"en"</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>onContextMenuShow<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"http://www.example.com"</span> <span class="hljs-attr">style</span>=<span class="hljs-string">"font-size:27px"</span>&gt;</span>超链接www.example.com<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></li><li>  <span class="hljs-comment">&lt;!--example.png为html同目录下图片--&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"example.png"</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>选中文字鼠标右键弹出菜单<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="568" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.36565385568761465833936221249388:50001231000000:2800:FBCD5888BB6592DF00677E274F5BC06838D93B8927197354F0CABB0586C38148.gif" width="324" height="568"></span></p>    </div>    <div class="tiledSection">     <h2 id="自定义菜单">自定义菜单<i class="anchor-icon anchor-icon-link" anchorid="自定义菜单" tips="复制节点链接"></i></h2>          <p>自定义菜单赋予开发者灵活控制菜单触发时机与视觉呈现的能力，使应用能够根据用户操作场景动态匹配功能入口，显著简化开发过程中的界面适配工作，同时让交互体验更贴近用户直觉。</p>     <p>开发者可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#bindselectionmenu13" target="_blank">bindSelectionMenu</a>接口实现自定义菜单功能。目前，已额外支持通过长按图片、链接和文本，触发自定义菜单及自定义文本菜单。</p>     <ol>      <li>创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>组件作为菜单弹窗。</li>      <li>通过Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#bindselectionmenu13" target="_blank">bindSelectionMenu</a>方法绑定MenuBuilder菜单弹窗。将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-e#webelementtype13" target="_blank">WebElementType</a>设置为WebElementType.IMAGE，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-e#webresponsetype13" target="_blank">responseType</a>设置为WebResponseType.LONG_PRESS，表示长按图片时弹出菜单。在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-i#selectionmenuoptionsext13" target="_blank">options</a>中定义菜单显示回调onAppear、菜单消失回调onDisappear、预览窗口preview和菜单类型menuType。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PreviewBuilderParam</span> {</li><li>  <span class="hljs-attr">previewImage</span>: <span class="hljs-title class_">Resource</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Builder</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PreviewBuilderGlobal</span>(<span class="hljs-params">$$: PreviewBuilderParam</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Image</span>($$.<span class="hljs-property">previewImage</span>)</li><li>      .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>      .<span class="hljs-title function_">autoResize</span>(<span class="hljs-literal">true</span>)</li><li>  }.<span class="hljs-title function_">width</span>($$.<span class="hljs-property">width</span>).<span class="hljs-title function_">height</span>($$.<span class="hljs-property">height</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">WebContextMenuResult</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewImage</span>: <span class="hljs-title class_">Resource</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">MenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">'复制'</span>, })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">copy</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">'全选'</span>, })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">selectAll</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">bindSelectionMenu</span>(<span class="hljs-title class_">WebElementType</span>.<span class="hljs-property">IMAGE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">MenuBuilder</span>, <span class="hljs-title class_">WebResponseType</span>.<span class="hljs-property">LONG_PRESS</span>,</li><li>          {</li><li>            <span class="hljs-attr">onAppear</span>: <span class="hljs-function">() =&gt;</span> {},</li><li>            <span class="hljs-attr">onDisappear</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>            },</li><li>            <span class="hljs-attr">preview</span>: <span class="hljs-title class_">PreviewBuilderGlobal</span>({</li><li>              <span class="hljs-attr">previewImage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span>,</li><li>              <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewWidth</span>,</li><li>              <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewHeight</span></li><li>            }),</li><li>            <span class="hljs-attr">menuType</span>: <span class="hljs-title class_">MenuType</span>.<span class="hljs-property">PREVIEW_MENU</span></li><li>          })</li><li>        .<span class="hljs-title function_">onContextMenuShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>            <span class="hljs-keyword">if</span> (event) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = event.<span class="hljs-property">result</span>;</li><li>              <span class="hljs-keyword">if</span> (event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getLinkUrl</span>()) {</li><li>                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>              }</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewWidth</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getPreviewWidth</span>());</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewHeight</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getPreviewHeight</span>());</li><li>              <span class="hljs-keyword">if</span> (event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"resource://rawfile/"</span>) == <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span> = $rawfile(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>().<span class="hljs-title function_">substr</span>(<span class="hljs-number">19</span>));</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span> = event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>();</li><li>              }</li><li>              <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>            }</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>          })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--index.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>测试网页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>bindSelectionMenu Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li>    <span class="hljs-comment">&lt;!--img.png为html同目录下图片--&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./img.png"</span> &gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="568" originwidth="324" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.53657078286156563433827771716333:50001231000000:2800:DDF23016690DF09BE7B0A617B9A8CA859E0072585ED65124D594A130DAFE2C40.gif" width="324" height="568"></span></p>     <p>自API version 20起，支持绑定长按超链接菜单。可以为图片和链接绑定不同的自定义菜单。</p>     <p>以下示例中，PreviewBuilder定义了超链接对应菜单的弹出内容，用Web组件加载了超链接内容，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-components-progress-indicator">Progress组件</a>展示了加载进度。</p>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { pasteboard } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PreviewBuilderParam</span> {</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">url</span>:<span class="hljs-title class_">Resource</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">PreviewBuilderParamForImage</span> {</li><li>  <span class="hljs-attr">previewImage</span>: <span class="hljs-title class_">Resource</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li>
</li><li><span class="hljs-meta">@Builder</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">PreviewBuilderGlobalForImage</span>(<span class="hljs-params">$$: PreviewBuilderParamForImage</span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-title class_">Image</span>($$.<span class="hljs-property">previewImage</span>)</li><li>      .<span class="hljs-title function_">objectFit</span>(<span class="hljs-title class_">ImageFit</span>.<span class="hljs-property">Fill</span>)</li><li>      .<span class="hljs-title function_">autoResize</span>(<span class="hljs-literal">true</span>)</li><li>  }.<span class="hljs-title function_">width</span>($$.<span class="hljs-property">width</span>).<span class="hljs-title function_">height</span>($$.<span class="hljs-property">height</span>)</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">SelectionMenuLongPress</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-attr">previewController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title class_">PreviewBuilder</span>(<span class="hljs-attr">$$</span>: <span class="hljs-title class_">PreviewBuilderParam</span>){</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Stack</span>(){</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">""</span>) <span class="hljs-comment">// 可选择是否展示url</span></li><li>          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">5</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Start</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">copyOption</span>(<span class="hljs-title class_">CopyOptions</span>.<span class="hljs-property">LocalDevice</span>)</li><li>          .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">textOverflow</span>({<span class="hljs-attr">overflow</span>:<span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span>})</li><li>        <span class="hljs-title class_">Progress</span>({ <span class="hljs-attr">value</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressValue</span>, <span class="hljs-attr">total</span>: <span class="hljs-number">100</span>, <span class="hljs-attr">type</span>: <span class="hljs-title class_">ProgressType</span>.<span class="hljs-property">Linear</span> }) <span class="hljs-comment">// 展示进度条</span></li><li>          .<span class="hljs-title function_">style</span>({ <span class="hljs-attr">strokeWidth</span>: <span class="hljs-number">3</span>, <span class="hljs-attr">enableSmoothEffect</span>: <span class="hljs-literal">true</span> })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>          .<span class="hljs-title function_">opacity</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">progressVisible</span>?<span class="hljs-number">1</span>:<span class="hljs-number">0</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>      }.<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">Bottom</span>)</li><li>      <span class="hljs-title class_">Web</span>({<span class="hljs-attr">src</span>:$$.<span class="hljs-property">url</span>,<span class="hljs-attr">controller</span>: <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>()})</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onlineImageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">imageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onPageBegin</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressValue</span> = <span class="hljs-number">0</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressVisible</span> = <span class="hljs-literal">true</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onProgressChange</span>(<span class="hljs-function">(<span class="hljs-params">event</span>)=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressValue</span> = event.<span class="hljs-property">newProgress</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">onPageEnd</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">progressVisible</span> = <span class="hljs-literal">false</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">hitTestBehavior</span>(<span class="hljs-title class_">HitTestMode</span>.<span class="hljs-property">None</span>) <span class="hljs-comment">// 使预览Web不响应手势</span></li><li>    }.<span class="hljs-title function_">width</span>($$.<span class="hljs-property">width</span>).<span class="hljs-title function_">height</span>($$.<span class="hljs-property">height</span>) <span class="hljs-comment">// 设置预览宽高</span></li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">WebContextMenuResult</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewImage</span>: <span class="hljs-title class_">Resource</span> | <span class="hljs-built_in">string</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewWidth</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewHeight</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewWidthImage</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">previewHeightImage</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">linkURL</span>:<span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">progressValue</span>:<span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">progressVisible</span>:<span class="hljs-built_in">boolean</span> = <span class="hljs-literal">true</span>;</li><li>  <span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">LinkMenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">'复制链接'</span>, })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">const</span> pasteboardData = pasteboard.<span class="hljs-title function_">createData</span>(pasteboard.<span class="hljs-property">MIMETYPE_TEXT_PLAIN</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">linkURL</span>);</li><li>          <span class="hljs-keyword">const</span> systemPasteboard = pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>();</li><li>          systemPasteboard.<span class="hljs-title function_">setData</span>(pasteboardData);</li><li>        })</li><li>      <span class="hljs-title class_">MenuItem</span>({<span class="hljs-attr">content</span>:<span class="hljs-string">'打开链接'</span>})</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">loadUrl</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">linkURL</span>);</li><li>        })</li><li>    }</li><li>  }</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">ImageMenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">'复制图片'</span>, })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">copyImage</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>        })</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onlineImageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">imageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">bindSelectionMenu</span>(<span class="hljs-title class_">WebElementType</span>.<span class="hljs-property">LINK</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">LinkMenuBuilder</span>, <span class="hljs-title class_">WebResponseType</span>.<span class="hljs-property">LONG_PRESS</span>,</li><li>          {</li><li>            <span class="hljs-attr">onAppear</span>: <span class="hljs-function">() =&gt;</span> {},</li><li>            <span class="hljs-attr">onDisappear</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>            },</li><li>            <span class="hljs-attr">preview</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-title class_">PreviewBuilder</span>({</li><li>              <span class="hljs-attr">width</span>: <span class="hljs-number">500</span>,</li><li>              <span class="hljs-attr">height</span>: <span class="hljs-number">400</span>,</li><li>              <span class="hljs-attr">url</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">linkURL</span></li><li>            }),</li><li>            <span class="hljs-attr">menuType</span>: <span class="hljs-title class_">MenuType</span>.<span class="hljs-property">PREVIEW_MENU</span>,</li><li>          })</li><li>        .<span class="hljs-title function_">bindSelectionMenu</span>(<span class="hljs-title class_">WebElementType</span>.<span class="hljs-property">IMAGE</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">ImageMenuBuilder</span>, <span class="hljs-title class_">WebResponseType</span>.<span class="hljs-property">LONG_PRESS</span>,</li><li>          {</li><li>            <span class="hljs-attr">onAppear</span>: <span class="hljs-function">() =&gt;</span> {},</li><li>            <span class="hljs-attr">onDisappear</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span>?.<span class="hljs-title function_">closeContextMenu</span>();</li><li>            },</li><li>            <span class="hljs-attr">preview</span>: <span class="hljs-title class_">PreviewBuilderGlobalForImage</span>({</li><li>              <span class="hljs-attr">previewImage</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span>,</li><li>              <span class="hljs-attr">width</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewWidthImage</span>,</li><li>              <span class="hljs-attr">height</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewHeightImage</span>,</li><li>            }),</li><li>            <span class="hljs-attr">menuType</span>: <span class="hljs-title class_">MenuType</span>.<span class="hljs-property">PREVIEW_MENU</span>,</li><li>          })</li><li>        .<span class="hljs-title function_">zoomAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onContextMenuShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">result</span> = event.<span class="hljs-property">result</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewWidthImage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getPreviewWidth</span>());</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewHeightImage</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiContext</span>!.<span class="hljs-title function_">px2vp</span>(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getPreviewHeight</span>());</li><li>            <span class="hljs-keyword">if</span> (event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>().<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">"resource://rawfile/"</span>) == <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span> = $rawfile(event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>().<span class="hljs-title function_">substring</span>(<span class="hljs-number">19</span>));</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">previewImage</span> = event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getSourceUrl</span>();</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">linkURL</span> = event.<span class="hljs-property">param</span>.<span class="hljs-title function_">getLinkUrl</span>()</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>          }</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>        })</li><li>    }</li><li>
</li><li>  }</li><li>  <span class="hljs-comment">// 侧滑返回</span></li><li>  <span class="hljs-title function_">onBackPress</span>(): <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">accessStep</span>(-<span class="hljs-number">1</span>)) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">backward</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>html示例</p>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>综合信息页面<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>综合信息与联系详情<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">section</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example.com"</span>&gt;</span>EXAMPLE<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">href</span>=<span class="hljs-string">"https://www.example1.com/"</span>&gt;</span>EXAMPLE1<span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">section</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">footer</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span>请注意，以上提供的所有网址仅供演示之用。<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">footer</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="518" originwidth="338" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.02948026403093104756494108494254:50001231000000:2800:8F920903A54D74742998AD774F267529D9128A261F6F2B3BFA79E964C3833B31.gif" width="338" height="518"></span></p>    </div>    <div class="tiledSection">     <h2 id="web菜单保存图片">Web菜单保存图片<i class="anchor-icon anchor-icon-link" anchorid="web菜单保存图片" tips="复制节点链接"></i></h2>          <ol>      <li>创建MenuBuilder组件作为菜单弹窗，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-security-components-savebutton" target="_blank">SaveButton</a>组件实现图片保存，通过bindContextMenu将MenuBuilder与Web绑定。</li>      <li>在onContextMenuShow中获取图片url，通过copyLocalPicToDir或copyUrlPicToDir将图片保存至应用沙箱。</li>      <li>通过photoAccessHelper将应用沙箱中的图片保存至图库。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { systemDateTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">saveButtonOptions</span>: <span class="hljs-title class_">SaveButtonOptions</span> = {</li><li>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">SaveIconStyle</span>.<span class="hljs-property">FULL_FILLED</span>,</li><li>    <span class="hljs-attr">text</span>: <span class="hljs-title class_">SaveDescription</span>.<span class="hljs-property">SAVE_IMAGE</span>,</li><li>    <span class="hljs-attr">buttonType</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span></li><li>  }</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">showMenu</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">imgUrl</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">copyLocalPicToDir</span>(<span class="hljs-attr">rawfilePath</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">newFileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> srcFileDes = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFdSync</span>(rawfilePath);</li><li>    <span class="hljs-keyword">let</span> dstPath = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/"</span> + newFileName;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">dest</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(dstPath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>    <span class="hljs-keyword">let</span> bufsize = <span class="hljs-number">4096</span>;</li><li>    <span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(bufsize);</li><li>    <span class="hljs-keyword">let</span> off = <span class="hljs-number">0</span>, len = <span class="hljs-number">0</span>, readedLen = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (len = fs.<span class="hljs-title function_">readSync</span>(srcFileDes.<span class="hljs-property">fd</span>, buf, { <span class="hljs-attr">offset</span>: srcFileDes.<span class="hljs-property">offset</span> + off, <span class="hljs-attr">length</span>: bufsize })) {</li><li>      readedLen += len;</li><li>      fs.<span class="hljs-title function_">writeSync</span>(dest.<span class="hljs-property">fd</span>, buf, { <span class="hljs-attr">offset</span>: off, <span class="hljs-attr">length</span>: len });</li><li>      off = off + len;</li><li>      <span class="hljs-keyword">if</span> ((srcFileDes.<span class="hljs-property">length</span> - readedLen) &lt; bufsize) {</li><li>        bufsize = srcFileDes.<span class="hljs-property">length</span> - readedLen;</li><li>      }</li><li>    }</li><li>    fs.<span class="hljs-title function_">close</span>(dest.<span class="hljs-property">fd</span>);</li><li>    <span class="hljs-keyword">return</span> dest.<span class="hljs-property">path</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">copyUrlPicToDir</span>(<span class="hljs-attr">picUrl</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">newFileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> uri = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: http.<span class="hljs-property">HttpResponse</span> = <span class="hljs-keyword">await</span> (httpRequest.<span class="hljs-title function_">request</span>(picUrl) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;http.<span class="hljs-property">HttpResponse</span>&gt;);</li><li>    <span class="hljs-keyword">if</span> (data?.<span class="hljs-property">responseCode</span> == http.<span class="hljs-property">ResponseCode</span>.<span class="hljs-property">OK</span>) {</li><li>      <span class="hljs-keyword">let</span> dstPath = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/"</span> + newFileName;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">dest</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(dstPath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">writeLen</span>: <span class="hljs-built_in">number</span> = fs.<span class="hljs-title function_">writeSync</span>(dest.<span class="hljs-property">fd</span>, data.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>);</li><li>      uri = dest.<span class="hljs-property">path</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> uri;</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">MenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">SaveButton</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">saveButtonOptions</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> (event, <span class="hljs-attr">result</span>: <span class="hljs-title class_">SaveButtonOnClickResult</span>) =&gt; {</li><li>            <span class="hljs-keyword">if</span> (result == <span class="hljs-title class_">SaveButtonOnClickResult</span>.<span class="hljs-property">SUCCESS</span>) {</li><li>              <span class="hljs-keyword">try</span> {</li><li>                <span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>;</li><li>                <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>                <span class="hljs-keyword">let</span> uri = <span class="hljs-string">''</span>;</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'rawfile'</span>)) {</li><li>                  <span class="hljs-keyword">let</span> <span class="hljs-attr">rawFileName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>);</li><li>                  uri = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">copyLocalPicToDir</span>(rawFileName, <span class="hljs-string">'copyFile.png'</span>);</li><li>                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'http'</span>) || <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'https'</span>)) {</li><li>                  uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">copyUrlPicToDir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>, <span class="hljs-string">`onlinePic<span class="hljs-subst">${systemDateTime.getTime()}</span>.png`</span>);</li><li>                }</li><li>                <span class="hljs-keyword">let</span> <span class="hljs-attr">assetChangeRequest</span>: photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span> =</li><li>                  photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span>.<span class="hljs-title function_">createImageAssetRequest</span>(context, uri);</li><li>                <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">applyChanges</span>(assetChangeRequest);</li><li>              } <span class="hljs-keyword">catch</span> (err) {</li><li>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create asset failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>              }</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`SaveButtonOnClickResult create asset failed`</span>);</li><li>            }</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">false</span>;</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span>, <span class="hljs-attr">bottom</span>: <span class="hljs-number">20</span> })</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80'</span>)</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>    .<span class="hljs-title function_">borderRadius</span>(<span class="hljs-number">10</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onContextMenuShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-keyword">let</span> hitValue = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getLastHitTest</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span> = hitValue.<span class="hljs-property">extra</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">bindContextMenu</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">MenuBuilder</span>, <span class="hljs-title class_">ResponseType</span>.<span class="hljs-property">LongPress</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--index.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>SavePicture<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>SavePicture<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">br</span>&gt;</span></li><li><span class="hljs-comment">&lt;!--startIcon.png为html同目录下图片--&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"./startIcon.png"</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="466" originwidth="348" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.63078305640012371305272238682892:50001231000000:2800:2A969B6E593460E6F892B4B52A02B7C6BECF5236A93873B9AAA2C40C95418B11.gif" width="348" height="466"></span></p>    </div>    <div class="tiledSection">     <h2 id="web菜单获取选中文本">Web菜单获取选中文本<i class="anchor-icon anchor-icon-link" anchorid="web菜单获取选中文本" tips="复制节点链接"></i></h2>          <p>Web组件的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#editmenuoptions12" target="_blank">editMenuOptions</a>接口中没有提供获取选中文本的方式。开发者可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#javascriptproxy" target="_blank">javaScriptProxy</a>获取到JavaScript的选中文本，实现自定义菜单的逻辑。</p>     <ol>      <li>创建SelectClass类，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#javascriptproxy" target="_blank">javaScriptProxy</a>将SelectClass对象注册到Web组件中。</li>      <li>在Html侧注册选区变更监听器，在选区变更时通过SelectClass对象将选区设置到ArkTS侧。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">let</span> selectText = <span class="hljs-string">''</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">SelectClass</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">setSelectText</span>(<span class="hljs-params">param: <span class="hljs-built_in">String</span></span>) {</li><li>    selectText = param.<span class="hljs-title function_">toString</span>();</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">webController</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectObj</span>: <span class="hljs-title class_">SelectClass</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SelectClass</span>();</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textStr</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'index.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span>})</li><li>        .<span class="hljs-title function_">javaScriptProxy</span>({</li><li>          <span class="hljs-attr">object</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectObj</span>,</li><li>          <span class="hljs-attr">name</span>: <span class="hljs-string">'selectObjName'</span>,</li><li>          <span class="hljs-attr">methodList</span>: [<span class="hljs-string">'setSelectText'</span>],</li><li>          <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">webController</span></li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Click here to get the selected text.'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">textStr</span> = selectText;</li><li>        })</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'10%'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Selected text is '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">textStr</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'10%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>Test Get Select<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span></li><li><span class="language-css">        <span class="hljs-selector-tag">body</span> {</span></li><li><span class="language-css">          <span class="hljs-attribute">margin</span>: <span class="hljs-number">40px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f4f4f4</span>;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css">        <span class="hljs-selector-class">.edit-container</span> {</span></li><li><span class="language-css">          <span class="hljs-attribute">padding</span>: <span class="hljs-number">20px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#fff</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">box-shadow</span>: <span class="hljs-number">0</span> <span class="hljs-number">0</span> <span class="hljs-number">10px</span> <span class="hljs-built_in">rgba</span>(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.1</span>);</span></li><li><span class="language-css">          <span class="hljs-attribute">margin</span>: auto;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css">        <span class="hljs-selector-tag">textarea</span> {</span></li><li><span class="language-css">          <span class="hljs-attribute">width</span>: <span class="hljs-number">100%</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">height</span>: <span class="hljs-number">400px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">font-size</span>: <span class="hljs-number">16px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">padding</span>: <span class="hljs-number">10px</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">border</span>: <span class="hljs-number">1px</span> solid <span class="hljs-number">#ccc</span>;</span></li><li><span class="language-css">          <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">4px</span>;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"edit-container"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">textarea</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">"Enter the text here and select it by long pressing."</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">textarea</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">addEventListener</span>(<span class="hljs-string">'selectionchange'</span>, <span class="hljs-function">() =&gt;</span> {</span></li><li><span class="language-javascript">      <span class="hljs-keyword">var</span> selection = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>();</span></li><li><span class="language-javascript">      <span class="hljs-keyword">if</span>(selection.<span class="hljs-property">rangeCount</span> &gt; <span class="hljs-number">0</span>) {</span></li><li><span class="language-javascript">        <span class="hljs-keyword">var</span> selectedText = selection.<span class="hljs-title function_">toString</span>();</span></li><li><span class="language-javascript">        selectObjName.<span class="hljs-title function_">setSelectText</span>(selectedText);</span></li><li><span class="language-javascript">      }</span></li><li><span class="language-javascript">    })</span></li><li><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="469" originwidth="333" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.51906166112240532018286042317526:50001231000000:2800:D2A74076F93BC38827D172D87C13F39D97339B5E00CA08A7F9172B0399E9D47A.gif" width="333" height="469"></span></p>    </div>    <div class="tiledSection">     <h2 id="web菜单识别图片二维码">Web菜单识别图片二维码<i class="anchor-icon anchor-icon-link" anchorid="web菜单识别图片二维码" tips="复制节点链接"></i></h2>          <p>在二维码跳转页面或者付款场景中，开发者可通过实现上下文菜单，获取到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-events#oncontextmenushow9" target="_blank">onContextMenuShow</a>接口中的二维码图片信息进行处理，提供给用户扫描二维码入口。</p>     <ol>      <li>创建MenuBuilder组件作为菜单弹窗，通过bindContextMenu将MenuBuilder与Web绑定。</li>      <li>在onContextMenuShow中获取图片url，通过copyLocalPicToDir或copyUrlPicToDir将图片保存至应用沙箱。</li>      <li>通过detectBarcode.decode解析保存在沙箱中的图片，获取到结果。</li>     </ol>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { systemDateTime } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { http } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.NetworkKit'</span>;</li><li><span class="hljs-keyword">import</span> { scanCore, scanBarcode, detectBarcode } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ScanKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">saveButtonOptions</span>: <span class="hljs-title class_">SaveButtonOptions</span> = {</li><li>    <span class="hljs-attr">icon</span>: <span class="hljs-title class_">SaveIconStyle</span>.<span class="hljs-property">FULL_FILLED</span>,</li><li>    <span class="hljs-attr">text</span>: <span class="hljs-title class_">SaveDescription</span>.<span class="hljs-property">SAVE_IMAGE</span>,</li><li>    <span class="hljs-attr">buttonType</span>: <span class="hljs-title class_">ButtonType</span>.<span class="hljs-property">Capsule</span></li><li>  }</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">result</span>: <span class="hljs-title class_">WebContextMenuResult</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">showMenu</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">imgUrl</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">decodeResult</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li>
</li><li>  <span class="hljs-title function_">copyLocalPicToDir</span>(<span class="hljs-attr">rawfilePath</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">newFileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">let</span> srcFileDes = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">resourceManager</span>.<span class="hljs-title function_">getRawFdSync</span>(rawfilePath);</li><li>    <span class="hljs-keyword">let</span> dstPath = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/"</span> + newFileName;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">dest</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(dstPath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>    <span class="hljs-keyword">let</span> bufsize = <span class="hljs-number">4096</span>;</li><li>    <span class="hljs-keyword">let</span> buf = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayBuffer</span>(bufsize);</li><li>    <span class="hljs-keyword">let</span> off = <span class="hljs-number">0</span>, len = <span class="hljs-number">0</span>, readedLen = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">while</span> (len = fs.<span class="hljs-title function_">readSync</span>(srcFileDes.<span class="hljs-property">fd</span>, buf, { <span class="hljs-attr">offset</span>: srcFileDes.<span class="hljs-property">offset</span> + off, <span class="hljs-attr">length</span>: bufsize })) {</li><li>      readedLen += len;</li><li>      fs.<span class="hljs-title function_">writeSync</span>(dest.<span class="hljs-property">fd</span>, buf, { <span class="hljs-attr">offset</span>: off, <span class="hljs-attr">length</span>: len });</li><li>      off = off + len;</li><li>      <span class="hljs-keyword">if</span> ((srcFileDes.<span class="hljs-property">length</span> - readedLen) &lt; bufsize) {</li><li>        bufsize = srcFileDes.<span class="hljs-property">length</span> - readedLen;</li><li>      }</li><li>    }</li><li>    fs.<span class="hljs-title function_">close</span>(dest.<span class="hljs-property">fd</span>);</li><li>    <span class="hljs-keyword">return</span> dest.<span class="hljs-property">path</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">copyUrlPicToDir</span>(<span class="hljs-attr">picUrl</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">newFileName</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> uri = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">let</span> httpRequest = http.<span class="hljs-title function_">createHttp</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">data</span>: http.<span class="hljs-property">HttpResponse</span> = <span class="hljs-keyword">await</span> (httpRequest.<span class="hljs-title function_">request</span>(picUrl) <span class="hljs-keyword">as</span> <span class="hljs-title class_">Promise</span>&lt;http.<span class="hljs-property">HttpResponse</span>&gt;);</li><li>    <span class="hljs-keyword">if</span> (data?.<span class="hljs-property">responseCode</span> == http.<span class="hljs-property">ResponseCode</span>.<span class="hljs-property">OK</span>) {</li><li>      <span class="hljs-keyword">let</span> dstPath = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">filesDir</span> + <span class="hljs-string">"/"</span> + newFileName;</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">dest</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(dstPath, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span>);</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">writeLen</span>: <span class="hljs-built_in">number</span> = fs.<span class="hljs-title function_">writeSync</span>(dest.<span class="hljs-property">fd</span>, data.<span class="hljs-property">result</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">ArrayBuffer</span>);</li><li>      uri = dest.<span class="hljs-property">path</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> uri;</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">MenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">MenuItem</span>({</li><li>        <span class="hljs-attr">content</span>: <span class="hljs-string">"Scan QR Code"</span>,</li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">let</span> uri = <span class="hljs-string">''</span>;</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'rawfile'</span>)) {</li><li>              <span class="hljs-keyword">let</span> <span class="hljs-attr">rawFileName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>.<span class="hljs-title function_">substring</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>.<span class="hljs-title function_">lastIndexOf</span>(<span class="hljs-string">'/'</span>) + <span class="hljs-number">1</span>);</li><li>              uri = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">copyLocalPicToDir</span>(rawFileName, <span class="hljs-string">'copyFile.png'</span>);</li><li>            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'http'</span>) || <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>?.<span class="hljs-title function_">includes</span>(<span class="hljs-string">'https'</span>)) {</li><li>              uri = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">copyUrlPicToDir</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span>, <span class="hljs-string">`onlinePic<span class="hljs-subst">${systemDateTime.getTime()}</span>.png`</span>);</li><li>            }</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: scanBarcode.<span class="hljs-property">ScanOptions</span> =</li><li>              { <span class="hljs-attr">scanTypes</span>: [scanCore.<span class="hljs-property">ScanType</span>.<span class="hljs-property">ALL</span>], <span class="hljs-attr">enableMultiMode</span>: <span class="hljs-literal">true</span>, <span class="hljs-attr">enableAlbum</span>: <span class="hljs-literal">true</span> }</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-attr">inputImage</span>: detectBarcode.<span class="hljs-property">InputImage</span> = { <span class="hljs-attr">uri</span>: uri };</li><li>            <span class="hljs-keyword">try</span> {</li><li>              <span class="hljs-comment">// 调用图片识码接口</span></li><li>              detectBarcode.<span class="hljs-title function_">decode</span>(inputImage, options,</li><li>                <span class="hljs-function">(<span class="hljs-params">error: BusinessError, result: <span class="hljs-built_in">Array</span>&lt;scanBarcode.ScanResult&gt;</span>) =&gt;</span> {</li><li>                  <span class="hljs-keyword">if</span> (error &amp;&amp; error.<span class="hljs-property">code</span>) {</li><li>                    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create asset failed with error: <span class="hljs-subst">${error.code}</span>, <span class="hljs-subst">${error.message}</span>`</span>);</li><li>                    <span class="hljs-keyword">return</span>;</li><li>                  }</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">decodeResult</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result);</li><li>                });</li><li>            } <span class="hljs-keyword">catch</span> (err) {</li><li>              <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to detect Barcode. Code: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>            }</li><li>          } <span class="hljs-keyword">catch</span> (err) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`create asset failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>          }</li><li>        })</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">onContextMenuShow</span>(<span class="hljs-function">(<span class="hljs-params">event</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event) {</li><li>            <span class="hljs-keyword">let</span> hitValue = <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">getLastHitTest</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">imgUrl</span> = hitValue.<span class="hljs-property">extra</span>;</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">showMenu</span> = <span class="hljs-literal">true</span>;</li><li>          <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">bindContextMenu</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">MenuBuilder</span>, <span class="hljs-title class_">ResponseType</span>.<span class="hljs-property">LongPress</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'40%'</span>)</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'Decode result is '</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">decodeResult</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'10%'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--index.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>test QR code<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>Long press and click to scan the QR code<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li><span class="hljs-comment">&lt;!--img.png为二维码图片--&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">src</span>=<span class="hljs-string">"img.png"</span> &gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="469" originwidth="340" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.91944333689250735819181701770359:50001231000000:2800:59B37C2B26732F4DF9E53DE42E485801872C07D71DCA87152259D617B3BB2FFC.gif" width="340" height="469"></span></p>    </div>    <div class="tiledSection">     <h2 id="常见问题">常见问题<i class="anchor-icon anchor-icon-link" anchorid="常见问题" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="如何禁用长按选择时弹出菜单" class="firsth2">如何禁用长按选择时弹出菜单<i class="anchor-icon anchor-icon-link" anchorid="如何禁用长按选择时弹出菜单" tips="复制节点链接"></i></h3>          <p>可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#editmenuoptions12" target="_blank">editMenuOptions</a>接口将系统默认菜单全部过滤，此时无菜单项，则不会显示菜单。</p>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">onCreateMenu</span>(<span class="hljs-attr">menuItems</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">TextMenuItem</span>&gt;): <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">TextMenuItem</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> items = menuItems.<span class="hljs-title function_">filter</span>(<span class="hljs-function">(<span class="hljs-params">menuItem</span>) =&gt;</span> {</li><li>      <span class="hljs-comment">// 过滤用户需要的系统按键</span></li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    });</li><li>    <span class="hljs-keyword">return</span> items;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onMenuItemClick</span>(<span class="hljs-attr">menuItem</span>: <span class="hljs-title class_">TextMenuItem</span>, <span class="hljs-attr">textRange</span>: <span class="hljs-title class_">TextRange</span>): <span class="hljs-built_in">boolean</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>; <span class="hljs-comment">// 返回默认值false</span></li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-title class_">EditMenuOptions</span>: <span class="hljs-title class_">EditMenuOptions</span> = { <span class="hljs-attr">onCreateMenu</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onCreateMenu</span>, <span class="hljs-attr">onMenuItemClick</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">onMenuItemClick</span> }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">"index.html"</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">editMenuOptions</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">EditMenuOptions</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--index.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>      <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>测试网页<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">h1</span>&gt;</span>editMenuOptions Demo<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>edit menu options<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></li><li>  <span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="355" originwidth="321" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.65235577095374156082692832775221:50001231000000:2800:BF7FAFCC5B96D2AF32F543AB7ADCB6709E0022A09D64227334E0F9525087226F.gif" width="321" height="355"></span></p>    </div>    <div class="tiledSection">     <h3 id="出现选区时手柄菜单不显示">出现选区时手柄菜单不显示<i class="anchor-icon anchor-icon-link" anchorid="出现选区时手柄菜单不显示" tips="复制节点链接"></i></h3>          <p>可排查是否通过JS的<a href="https://www.w3.org/TR/selection-api/" target="_blank">selection-api</a>对选区进行了操作，目前通过这种方式改变选区会导致手柄菜单不显示。</p>    </div>    <div class="tiledSection">     <h3 id="如何修改文本选中菜单的样式">如何修改文本选中菜单的样式<i class="anchor-icon anchor-icon-link" anchorid="如何修改文本选中菜单的样式" tips="复制节点链接"></i></h3>          <p>从API version 21开始，应用可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-basic-components-web-attributes#bindselectionmenu13" target="_blank">bindSelectionMenu</a>接口，实现自定义文本菜单。</p>     <p><strong>示例代码</strong></p>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { webview } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkWeb'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">WebComponent</span> {</li><li>  <span class="hljs-attr">controller</span>: webview.<span class="hljs-property">WebviewController</span> = <span class="hljs-keyword">new</span> webview.<span class="hljs-title class_">WebviewController</span>();</li><li>
</li><li>  <span class="hljs-title function_">clearSelection</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">runJavaScript</span>(</li><li>        <span class="hljs-string">'clearSelection()'</span>,</li><li>        <span class="hljs-function">(<span class="hljs-params">error, result</span>) =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`run clearSelection JavaScript error, ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: $  {(error as BusinessError).message}`</span>);</li><li>            <span class="hljs-keyword">return</span>;</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (result) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`The clearSelection() return value is: <span class="hljs-subst">${result}</span>`</span>);</li><li>          }</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">TextMenuBuilder</span>() {</li><li>    <span class="hljs-title class_">Menu</span>() {</li><li>      <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">'Copy'</span>, })</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">runJavaScript</span>(</li><li>              <span class="hljs-string">'copySelectedText()'</span>,</li><li>              <span class="hljs-function">(<span class="hljs-params">error, result</span>) =&gt;</span> {</li><li>                <span class="hljs-keyword">if</span> (error) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`run copySelectedText JavaScript error, ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,    Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>                  <span class="hljs-keyword">return</span>;</li><li>                }</li><li>                <span class="hljs-keyword">if</span> (result) {</li><li>                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`The copySelectedText() return value is: <span class="hljs-subst">${result}</span>`</span>);</li><li>                }</li><li>              });</li><li>          } <span class="hljs-keyword">catch</span> (error) {</li><li>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`ErrorCode: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).code}</span>,  Message: <span class="hljs-subst">${(error <span class="hljs-keyword">as</span> BusinessError).message}</span>`</span>);</li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">clearSelection</span>()</li><li>        }).<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>)</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Web</span>({ <span class="hljs-attr">src</span>: $rawfile(<span class="hljs-string">'bindSelectionMenuText.html'</span>), <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> })</li><li>        .<span class="hljs-title function_">javaScriptAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">fileAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">onlineImageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">imageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">domStorageAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">zoomAccess</span>(<span class="hljs-literal">true</span>)</li><li>        .<span class="hljs-title function_">bindSelectionMenu</span>(<span class="hljs-title class_">WebElementType</span>.<span class="hljs-property">TEXT</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">TextMenuBuilder</span>, <span class="hljs-title class_">WebResponseType</span>.<span class="hljs-property">LONG_PRESS</span>,</li><li>          {</li><li>            <span class="hljs-attr">onAppear</span>: <span class="hljs-function">() =&gt;</span> {},</li><li>            <span class="hljs-attr">onDisappear</span>: <span class="hljs-function">() =&gt;</span> {},</li><li>            <span class="hljs-attr">menuType</span>: <span class="hljs-title class_">MenuType</span>.<span class="hljs-property">SELECTION_MENU</span>,</li><li>          })</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">onBackPress</span>(): <span class="hljs-built_in">boolean</span> | <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">accessStep</span>(-<span class="hljs-number">1</span>)) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span>.<span class="hljs-title function_">backward</span>();</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div _ngcontent-xsv-c106="" class="highlight-div"><div _ngcontent-xsv-c106="" class="highlight-div-header"><div _ngcontent-xsv-c106="" class="highlight-div-header-left"><div _ngcontent-xsv-c106="" class="handle-button expand-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xsv-c106="" class="highlight-div-header-right"><div _ngcontent-xsv-c106="" class="handle-button ai-button"></div><div _ngcontent-xsv-c106="" class="handle-button line-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xsv-c106="" class="handle-button theme-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xsv-c106="" class="handle-button copy-button"><div _ngcontent-xsv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xsv-c106="" class="highlight-scroll-div"><pre class="html prettyprint linenums hljs language-xml" hw-language="html" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">&lt;!--bindSelectionMenuText.html--&gt;</span></li><li><span class="hljs-meta">&lt;!DOCTYPE <span class="hljs-keyword">html</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">html</span> <span class="hljs-attr">lang</span>=<span class="hljs-string">"zh-CN"</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">head</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">"UTF-8"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">meta</span> <span class="hljs-attr">name</span>=<span class="hljs-string">"viewport"</span> <span class="hljs-attr">content</span>=<span class="hljs-string">"width=device-width, initial-scale=1.0"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">title</span>&gt;</span>自定义文本菜单<span class="hljs-tag">&lt;/<span class="hljs-name">title</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">style</span>&gt;</span><span class="language-css"></span></li><li><span class="language-css">        <span class="hljs-selector-class">.container</span> {</span></li><li><span class="language-css">            <span class="hljs-attribute">background-color</span>: white;</span></li><li><span class="language-css">            <span class="hljs-attribute">padding</span>: <span class="hljs-number">30px</span>;</span></li><li><span class="language-css">            <span class="hljs-attribute">margin</span>: <span class="hljs-number">20px</span> <span class="hljs-number">0</span>;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css"></span></li><li><span class="language-css">        <span class="hljs-selector-class">.context</span> {</span></li><li><span class="language-css">            <span class="hljs-attribute">line-height</span>: <span class="hljs-number">1.8</span>;</span></li><li><span class="language-css">            <span class="hljs-attribute">font-size</span>: <span class="hljs-number">18px</span>;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css"></span></li><li><span class="language-css">        <span class="hljs-selector-class">.context</span> <span class="hljs-selector-tag">span</span> {</span></li><li><span class="language-css">            <span class="hljs-attribute">border-radius</span>: <span class="hljs-number">8px</span>;</span></li><li><span class="language-css">            <span class="hljs-attribute">background-color</span>: <span class="hljs-number">#f8f9fa</span>;</span></li><li><span class="language-css">        }</span></li><li><span class="language-css">    </span><span class="hljs-tag">&lt;/<span class="hljs-name">style</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">head</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"container"</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">"context"</span>&gt;</span></li><li>        <span class="hljs-tag">&lt;<span class="hljs-name">span</span>&gt;</span>在这个数字时代，文本复制功能变得日益重要。无论是引用名言、保存重要信息，还是分享有趣的内容，复制文本都是我们日常操作的  一部分。<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span></li><li>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span></li><li>
</li><li><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span></li><li><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">copySelectedText</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-javascript">      <span class="hljs-keyword">const</span> selectedText = <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>().<span class="hljs-title function_">toString</span>();</span></li><li><span class="language-javascript">      <span class="hljs-keyword">if</span> (selectedText.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</span></li><li><span class="language-javascript">          <span class="hljs-comment">// 使用Clipboard API复制文本</span></span></li><li><span class="language-javascript">          navigator.<span class="hljs-property">clipboard</span>.<span class="hljs-title function_">writeText</span>(selectedText)</span></li><li><span class="language-javascript">              .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</span></li><li><span class="language-javascript">                  <span class="hljs-title function_">showNotification</span>();</span></li><li><span class="language-javascript">              })</span></li><li><span class="language-javascript">              .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {</span></li><li><span class="language-javascript">                  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'copy failed:'</span>, err);</span></li><li><span class="language-javascript">              });</span></li><li><span class="language-javascript">      }</span></li><li><span class="language-javascript">  }</span></li><li><span class="language-javascript">  <span class="hljs-keyword">function</span> <span class="hljs-title function_">clearSelection</span>(<span class="hljs-params"></span>) {</span></li><li><span class="language-javascript">    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">window</span>.<span class="hljs-property">getSelection</span>) {</span></li><li><span class="language-javascript">      <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">getSelection</span>().<span class="hljs-title function_">removeAllRanges</span>();</span></li><li><span class="language-javascript">    }</span></li><li><span class="language-javascript">  }</span></li><li><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">body</span>&gt;</span></li><li><span class="hljs-tag">&lt;/<span class="hljs-name">html</span>&gt;</span></li></ol></pre></div></div>     <p><span><img originheight="245" originwidth="282" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114742.19695428401593437818443333772243:50001231000000:2800:2C40B0EFCCE4E12B7F0CEDB4EFEFD22B811E8694749D501ED11B0E48996FE47F.gif" class="notEnlarge" width="282" height="245"></span></p>    </div>   </div>   <div></div></div>