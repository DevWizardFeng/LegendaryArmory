<h1 _ngcontent-ybo-c119="" class="doc-title ng-star-inserted" title="使用WindowManager管理多模输入事件（C/C++）"> 使用WindowManager管理多模输入事件（C/C++） </h1>

<div _ngcontent-ybo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-windowmanager" target="_blank">WindowManager</a>提供应用窗口的管理能力，可以用于管理多模输入事件。</p>     <p>当前支持使用WindowManager进行多模输入事件的过滤，还可以将多模触摸事件注入目标窗口，具体开发步骤可见下文。</p>    </div>    <div class="tiledSection">     <h2 id="过滤多模输入事件">过滤多模输入事件<i class="anchor-icon anchor-icon-link" anchorid="过滤多模输入事件" tips="复制节点链接"></i></h2>          <p>使用WindowManager模块提供的能力去拦截按键事件，让按键事件不往应用内部组件分发。</p>    </div>    <div class="tiledSection">     <h3 id="在cmake脚本中链接动态库" class="firsth2">在CMake脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在cmake脚本中链接动态库" tips="复制节点链接"></i></h3>          <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_window_manager.so libohinput.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加头文件">添加头文件<i class="anchor-icon anchor-icon-link" anchorid="添加头文件" tips="复制节点链接"></i></h3>          <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_input_manager.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_key_code.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window_comm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window_event_filter.h"</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="接口使用说明">接口使用说明<i class="anchor-icon anchor-icon-link" anchorid="接口使用说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeWindowManager_RegisterKeyEventFilter(int32_t windowId, OH_NativeWindowManager_KeyEventFilter keyEventFilter)</td>         <td class="cellrowborder" valign="top" width="50%">为指定的窗口注册过滤回调函数keyEventFilter。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_NativeWindowManager_UnregisterKeyEventFilter(int32_t windowId)</td>         <td class="cellrowborder" valign="top" width="50%">取消指定窗口上的过滤回调函数。</td>        </tr>             </tbody></table></div>     </div>     <ul>      <li>应用窗口创建后，使用窗口ID绑定按键事件过滤函数。</li>      <li>应用窗口需要收到按键事件时，才触发按键事件的拦截。</li>      <li>当回调函数返回true表示拦截，false表示不拦截。</li>      <li>同一个窗口ID注册的回调函数只允许一个，最后注册的回调函数会覆盖之前注册过的回调函数。如需过滤多个按键的组合场景，建议在一个回调函数里面处理。</li>     </ul>    </div>    <div class="tiledSection">     <h3 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h3>          <p>以下示例代码中介绍了如何注册过滤函数和取消过滤函数，以过滤ESC退出按键和数字按键为例。</p>     <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window_comm.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window_event_filter.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_input_manager.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_key_code.h"</span></span></li><li>
</li><li><span class="hljs-comment">// 设置过滤函数</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">bool</span> <span class="hljs-title">filterFunc</span><span class="hljs-params">(Input_KeyEvent *event)</span> </span>{</li><li>  <span class="hljs-keyword">auto</span> keyCode = <span class="hljs-built_in">OH_Input_GetKeyEventKeyCode</span>(event);</li><li>  <span class="hljs-keyword">auto</span> action = <span class="hljs-built_in">OH_Input_GetKeyEventAction</span>(event);</li><li>  <span class="hljs-comment">// case1: 过滤escape</span></li><li>  <span class="hljs-comment">// return keyCode == Input_KeyCode::KEYCODE_ESCAPE;</span></li><li>
</li><li>  <span class="hljs-comment">// case2: 过滤数字键的按下，抬起不过滤</span></li><li>  <span class="hljs-comment">// return keyCode &gt;= Input_KeyCode::KEYCODE_0 &amp;&amp; keyCode &lt;= Input_KeyCode::KEYCODE_9</span></li><li>  <span class="hljs-comment">//  &amp;&amp; action == Input_KeyEventAction::KEY_ACTION_DOWN;</span></li><li>  </li><li>  <span class="hljs-comment">// 过滤escape和数字键的按下(case1 || case2)</span></li><li>  <span class="hljs-keyword">return</span> (keyCode &gt;= Input_KeyCode::KEYCODE_0 &amp;&amp; keyCode &lt;= Input_KeyCode::KEYCODE_9</li><li>     &amp;&amp; action == Input_KeyEventAction::KEY_ACTION_DOWN) || (keyCode == Input_KeyCode::KEYCODE_ESCAPE);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">registerFilter</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>  <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>  napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>  <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>  </li><li>  <span class="hljs-type">int32_t</span> windowId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;windowId);</li><li>  </li><li>  <span class="hljs-comment">// 向windowId对应的窗口注册filterFunc的过滤函数</span></li><li>  <span class="hljs-keyword">auto</span> res = <span class="hljs-built_in">OH_NativeWindowManager_RegisterKeyEventFilter</span>(windowId, filterFunc);</li><li>  </li><li>  napi_value errCode;</li><li>  <span class="hljs-built_in">napi_create_int32</span>(env, res, &amp;errCode);</li><li>  <span class="hljs-keyword">return</span> errCode;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">clearFilter</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>  <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>  napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>  <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> windowId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;windowId);</li><li>
</li><li>  <span class="hljs-keyword">auto</span> res = <span class="hljs-built_in">OH_NativeWindowManager_UnregisterKeyEventFilter</span>(windowId);</li><li>  napi_value errCode;</li><li>  <span class="hljs-built_in">napi_create_int32</span>(env, res, &amp;errCode);</li><li>  <span class="hljs-keyword">return</span> errCode;</li><li>
</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>  napi_property_descriptor desc[] = {</li><li>    {<span class="hljs-string">"registerFilter"</span>, <span class="hljs-literal">nullptr</span>, registerFilter, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>},</li><li>    {<span class="hljs-string">"clearFilter"</span>, <span class="hljs-literal">nullptr</span>, clearFilter, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}};</li><li>  <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>  <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="将多模触摸事件注入给目标窗口">将多模触摸事件注入给目标窗口<i class="anchor-icon anchor-icon-link" anchorid="将多模触摸事件注入给目标窗口" tips="复制节点链接"></i></h2>          <p>使用WindowManager模块提供的能力为指定窗口注入触摸事件，仅支持同进程窗口。此操作不会触发窗口焦点、层级变化或拖拽，事件会直接发送给ArkUI。</p>    </div>    <div class="tiledSection">     <h3 id="在cmake脚本中链接动态库-1" class="firsth2">在CMake脚本中链接动态库<i class="anchor-icon anchor-icon-link" anchorid="在cmake脚本中链接动态库-1" tips="复制节点链接"></i></h3>          <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-built_in">target_link_libraries</span>(entry PUBLIC libnative_window_manager.so libohinput.so)</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="添加头文件-1">添加头文件<i class="anchor-icon anchor-icon-link" anchorid="添加头文件-1" tips="复制节点链接"></i></h3>          <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_input_manager.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="接口使用说明-1">接口使用说明<i class="anchor-icon anchor-icon-link" anchorid="接口使用说明-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_WindowManager_InjectTouchEvent(int32_t windowId, Input_TouchEvent* touchEvent, int32_t windowX, int32_t windowY)</td>         <td class="cellrowborder" valign="top" width="50%">为指定的窗口注入触摸事件。</td>        </tr>             </tbody></table></div>     </div>     <ul>      <li>       <p>构造事件参数，向目标窗口ID注入事件。</p></li>      <li>       <p>仅支持注入同进程窗口。注入不会触发窗口焦点、层级变化或拖拽，事件直接发送给ArkUI。</p></li>      <li>       <p>接口需要在指定窗口加载UI后调用。</p></li>      <li>       <p>完成窗口和多模触摸事件校验，确保事件参数正确，再将事件发送给ArkUI。具体参数说明如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.10.3.4.2.1.3.1.1" valign="top" width="50%">参数名</th>           <th align="left" class="cellrowborder" id="mcps1.3.10.3.4.2.1.3.1.2" valign="top" width="50%">描述</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="50%">windowId</td>           <td class="cellrowborder" valign="top" width="50%">目标窗口ID，仅支持同进程的窗口，否则返回错误码1300002。窗口需完成UI加载，否则返回错误码1300003。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">touchEvent</td>           <td class="cellrowborder" valign="top" width="50%">多模触摸事件，具体可见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-input-input-touchevent" target="_blank">Input_TouchEvent</a>，事件定义在oh_input_manager.h中。调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_createtouchevent" target="_blank">OH_Input_CreateTouchEvent</a>接口创建touchEvent对象，使用完后调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_destroytouchevent" target="_blank">OH_Input_DestroyTouchEvent</a>接口销毁该对象。具体参数说明见下表。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">windowX</td>           <td class="cellrowborder" valign="top" width="50%">注入事件相对于注入窗口的落点横坐标。参数应为大于等于0的整数，否则返回错误码1300003。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="50%">windowY</td>           <td class="cellrowborder" valign="top" width="50%">注入事件相对于注入窗口的落点纵坐标。参数应为大于等于0的整数，否则返回错误码1300003。</td>          </tr>                 </tbody></table></div>       </div>       <p>其中，touchEvent多模触摸事件具体参数说明如下：</p>       <div class="tablenoborder">        <div class="tbBox"><table class="layoutFixed idpTab">         <thead>          <tr>           <th align="left" class="cellrowborder" id="mcps1.3.10.3.4.4.1.4.1.1" valign="top" width="33.33333333333333%">参数名</th>           <th align="left" class="cellrowborder" id="mcps1.3.10.3.4.4.1.4.1.2" valign="top" width="33.33333333333333%">方法</th>           <th align="left" class="cellrowborder" id="mcps1.3.10.3.4.4.1.4.1.3" valign="top" width="33.33333333333333%">描述</th>          </tr>         </thead>                   <tbody><tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">action</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventaction" target="_blank">OH_Input_SetTouchEventAction</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>表示事件行为，默认值为0。</p>            <p>当前只支持0-3的行为，分别表示为：</p>            <p>- 0：cancel，表示取消事件。</p>            <p>- 1：down，表示按下事件。</p>            <p>- 2：move，表示移动事件。</p>            <p>- 3：up，表示抬起事件。</p>            <p>- 其他行为会返回错误码1300003。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">id</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventfingerid" target="_blank">OH_Input_SetTouchEventFingerId</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>表示手指ID，默认值为0。</p>            <p>应为大于等于0的整数，否则返回错误码1300003。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">displayX</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventdisplayx" target="_blank">OH_Input_SetTouchEventDisplayX</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>表示事件落点相对于屏幕的横坐标，默认值为0。</p>            <p>参数应为非负整数，否则返回错误码1300003。建议与windowX保持对应关系，即使不一致也不会返回错误码，仅校验入参合法范围。转换方法推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowproperties9" target="_blank">getWindowProperties()</a>方法获取windowRect属性，通过displayX减去windowRect中窗口左上角横坐标计算对应的windowX。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">displayY</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventdisplayy" target="_blank">OH_Input_SetTouchEventDisplayY</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">            <p>表示事件落点相对于屏幕的纵坐标，默认值为0。</p>            <p>参数应为非负整数，否则返回错误码1300003。建议与windowY保持对应关系，即使不一致也不会返回错误码，仅校验入参合法范围。转换方法推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowproperties9" target="_blank">getWindowProperties()</a>方法获取windowRect属性，通过displayY减去windowRect中窗口左上角纵坐标计算对应的windowY。</p></td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">actionTime</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventactiontime" target="_blank">OH_Input_SetTouchEventActionTime</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">表示时间戳，默认值为-1。参数应为非负整数，否则返回错误码1300003。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">windowId</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventwindowid" target="_blank">OH_Input_SetTouchEventWindowId</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">表示事件注入窗口ID，默认值为-1。若参数不为默认值且不等于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-window-h#oh_windowmanager_injecttouchevent" target="_blank">OH_WindowManager_InjectTouchEvent</a>接口参数windowId，将校验传入参数错误。</td>          </tr>          <tr>           <td class="cellrowborder" valign="top" width="33.33333333333333%">displayId</td>           <td class="cellrowborder" valign="top" width="33.33333333333333%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-input-manager-h#oh_input_settoucheventdisplayid" target="_blank">OH_Input_SetTouchEventDisplayId</a></td>           <td class="cellrowborder" valign="top" width="33.33333333333333%">表示事件注入屏幕ID，默认值为-1。无限制，但是应该尽量保证与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-window-h#oh_windowmanager_injecttouchevent" target="_blank">OH_WindowManager_InjectTouchEvent</a>接口参数windowId有相互对应关系，推荐使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-window#getwindowproperties9" target="_blank">getWindowProperties()</a>方法获取displayId属性。</td>          </tr>                 </tbody></table></div>       </div></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="示例代码-1">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码-1" tips="复制节点链接"></i></h3>          <p>以下示例代码介绍了如何将多模触摸事件注入目标窗口，以单次事件注入为例。</p>     <div _ngcontent-ybo-c106="" class="highlight-div"><div _ngcontent-ybo-c106="" class="highlight-div-header"><div _ngcontent-ybo-c106="" class="highlight-div-header-left"><div _ngcontent-ybo-c106="" class="handle-button expand-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ybo-c106="" class="highlight-div-header-right"><div _ngcontent-ybo-c106="" class="handle-button ai-button"></div><div _ngcontent-ybo-c106="" class="handle-button line-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ybo-c106="" class="handle-button theme-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ybo-c106="" class="handle-button copy-button"><div _ngcontent-ybo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ybo-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"window_manager/oh_window.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"multimodalinput/oh_input_manager.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">injectEvent</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>  <span class="hljs-type">size_t</span> argc = <span class="hljs-number">10</span>;</li><li>  napi_value args[<span class="hljs-number">10</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>  <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> windowId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">0</span>], &amp;windowId);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> displayId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">1</span>], &amp;displayId);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> windowX;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">2</span>], &amp;windowX);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> windowY;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">3</span>], &amp;windowY);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> action;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">4</span>], &amp;action);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> fingerId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">5</span>], &amp;fingerId);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> displayX;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">6</span>], &amp;displayX);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> displayY;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">7</span>], &amp;displayY);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> actionTime;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">8</span>], &amp;actionTime);</li><li>
</li><li>  <span class="hljs-type">int32_t</span> TE_WindowId;</li><li>  <span class="hljs-built_in">napi_get_value_int32</span>(env, args[<span class="hljs-number">9</span>], &amp;TE_WindowId);</li><li>  </li><li>  <span class="hljs-comment">// 构造多模事件touchEvent</span></li><li>  Input_TouchEvent* touchEvent = <span class="hljs-built_in">OH_Input_CreateTouchEvent</span>();</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventAction</span>(touchEvent, action);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventFingerId</span>(touchEvent, fingerId);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventDisplayX</span>(touchEvent, displayX);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventDisplayY</span>(touchEvent, displayY);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventActionTime</span>(touchEvent, actionTime);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventWindowId</span>(touchEvent, TE_WindowId);</li><li>  <span class="hljs-built_in">OH_Input_SetTouchEventDisplayId</span>(touchEvent, displayId);</li><li>
</li><li>  <span class="hljs-comment">// 向windowId对应的窗口注入多模触摸事件</span></li><li>  <span class="hljs-keyword">auto</span> res = <span class="hljs-built_in">OH_WindowManager_InjectTouchEvent</span>(windowId, touchEvent, windowX, windowY);</li><li>
</li><li>  <span class="hljs-comment">// 使用完touchEvent后销毁对象</span></li><li>  <span class="hljs-built_in">OH_Input_DestroyTouchEvent</span>(&amp;touchEvent);</li><li>  </li><li>  napi_value errCode;</li><li>  <span class="hljs-built_in">napi_create_int32</span>(env, res, &amp;errCode);</li><li>  <span class="hljs-keyword">return</span> errCode;</li><li>}</li><li>
</li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>  napi_property_descriptor desc[] = {</li><li>    {<span class="hljs-string">"injectEvent"</span>, <span class="hljs-literal">nullptr</span>, injectEvent, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}};</li><li>  <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>  <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li></ol></pre></div></div>    </div>   </div>   <div></div></div>