<h1 _ngcontent-pee-c119="" class="doc-title ng-star-inserted" title="使用crashpad收集Web组件崩溃信息"> 使用crashpad收集Web组件崩溃信息 </h1>

<div _ngcontent-pee-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>Web组件支持使用crashpad记录进程崩溃信息。crashpad是chromium内核提供的进程崩溃信息处理工具，在应用使用Web组件导致的进程（Web渲染进程）崩溃出现后，crashpad会在应用主进程沙箱目录写入minidump文件。该文件为二进制格式，后缀为dmp，其记录了进程崩溃的原因、线程信息、寄存器信息等，应用可以使用该文件分析Web组件相关进程崩溃问题。</p> <p>使用步骤如下：</p> <ol><li><p>在应用使用Web组件导致的进程崩溃出现后，会在应用主进程沙箱目录下产生对应的dmp文件，对应的沙箱路径如下：</p>  <div _ngcontent-pee-c106="" class="highlight-div"><div _ngcontent-pee-c106="" class="highlight-div-header"><div _ngcontent-pee-c106="" class="highlight-div-header-left"><div _ngcontent-pee-c106="" class="handle-button expand-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pee-c106="" class="highlight-div-header-right"><div _ngcontent-pee-c106="" class="handle-button ai-button"></div><div _ngcontent-pee-c106="" class="handle-button line-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pee-c106="" class="handle-button theme-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pee-c106="" class="handle-button copy-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pee-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>/data/storage/el2/<span class="hljs-built_in">log</span>/crashpad</li></ol></pre></div></div>  </li><li><p>参考<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-file-native-side" target="_blank">Native访问应用沙箱</a>实现访问应用沙箱dmp文件。</p>  </li><li><p>获取dmp文件后进行解析，具体步骤如下：</p>  <ul><li><p>通过minidump_stackwalk工具解析dmp文件，可以得到上述dmp文件对应的进程崩溃信息（崩溃的原因、线程信息、寄存器信息等），示例如下（Linux环境）：</p>  <div _ngcontent-pee-c106="" class="highlight-div"><div _ngcontent-pee-c106="" class="highlight-div-header"><div _ngcontent-pee-c106="" class="highlight-div-header-left"><div _ngcontent-pee-c106="" class="handle-button expand-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pee-c106="" class="highlight-div-header-right"><div _ngcontent-pee-c106="" class="handle-button ai-button"></div><div _ngcontent-pee-c106="" class="handle-button line-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pee-c106="" class="handle-button theme-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pee-c106="" class="handle-button copy-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pee-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>./minidump_stackwalk b678e0b5<span class="hljs-number">-894b</span><span class="hljs-number">-4794</span><span class="hljs-number">-9</span>ab3-fb5d6dda06a3.dmp &gt; parsed_stacktrace.txt</li></ol></pre></div></div>  <p>minidump_stackwalk由breakpad项目源码编译得到，编译方法见项目仓库：<a href="https://chromium.googlesource.com/breakpad/breakpad" target="_blank">breakpad仓库地址</a>。</p>  </li><li><p>查看解析后的文件，以下示例列出部分内容：</p>  <div _ngcontent-pee-c106="" class="highlight-div"><div _ngcontent-pee-c106="" class="highlight-div-header"><div _ngcontent-pee-c106="" class="highlight-div-header-left"><div _ngcontent-pee-c106="" class="handle-button expand-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pee-c106="" class="highlight-div-header-right"><div _ngcontent-pee-c106="" class="handle-button ai-button"></div><div _ngcontent-pee-c106="" class="handle-button line-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pee-c106="" class="handle-button theme-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pee-c106="" class="handle-button copy-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pee-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>Crash reason:  SIGSEGV /SEGV_MAPERR    表示导致进程crash的信号，此处示例为段错误</li><li>Crash address: <span class="hljs-number">0x0</span></li><li>Process uptime: <span class="hljs-number">12</span> seconds</li><li>
</li><li>Thread <span class="hljs-number">0</span> (crashed)                     表示Thread <span class="hljs-number">0</span>发生crash</li><li> <span class="hljs-number">0</span>  libweb_engine.so + <span class="hljs-number">0x2e0b340</span>       <span class="hljs-number">0</span>层调用栈，<span class="hljs-number">0x2e0b340</span>为so偏移地址，可用来反编译解析crash源码（依赖unstripped so）</li><li>     x0 = <span class="hljs-number">0x00000006a5719ff8</span>    x1 = <span class="hljs-number">0x000000019a5a28c0</span></li><li>     x2 = <span class="hljs-number">0x0000000000020441</span>    x3 = <span class="hljs-number">0x00000000000001b6</span></li><li>     x4 = <span class="hljs-number">0x0000000000000018</span>    x5 = <span class="hljs-number">0x0000000000008065</span></li><li>     x6 = <span class="hljs-number">0x0000000000008065</span>    x7 = <span class="hljs-number">0x63ff686067666d60</span></li><li>     x8 = <span class="hljs-number">0x0000000000000000</span>    x9 = <span class="hljs-number">0x5f129cf9e7bf008c</span></li><li>    x10 = <span class="hljs-number">0x0000000000000001</span>   x11 = <span class="hljs-number">0x0000000000000000</span></li><li>    x12 = <span class="hljs-number">0x000000069bfcc6d8</span>   x13 = <span class="hljs-number">0x0000000009a1746e</span></li><li>    x14 = <span class="hljs-number">0x0000000000000000</span>   x15 = <span class="hljs-number">0x0000000000000000</span></li><li>    x16 = <span class="hljs-number">0x0000000690df4850</span>   x17 = <span class="hljs-number">0x000000010c0d47f8</span></li><li>    x18 = <span class="hljs-number">0x0000000000000000</span>   x19 = <span class="hljs-number">0x0000005eea827db8</span></li><li>    x20 = <span class="hljs-number">0x0000005eea827c38</span>   x21 = <span class="hljs-number">0x00000006a56b1000</span></li><li>    x22 = <span class="hljs-number">0x00000006a8b85020</span>   x23 = <span class="hljs-number">0x00000020002103c0</span></li><li>    x24 = <span class="hljs-number">0x00000006a56b8a70</span>   x25 = <span class="hljs-number">0x0000000000000000</span></li><li>    x26 = <span class="hljs-number">0x00000006a8b84e00</span>   x27 = <span class="hljs-number">0x0000000000000001</span></li><li>    x28 = <span class="hljs-number">0x0000000000000000</span>    fp = <span class="hljs-number">0x0000005eea827c10</span></li><li>     lr = <span class="hljs-number">0x000000069fa4b33c</span>    sp = <span class="hljs-number">0x0000005eea827c10</span></li><li>     pc = <span class="hljs-number">0x000000069fa4b340</span></li><li>    Found by: given as instruction pointer in context</li><li> <span class="hljs-number">1</span>  libweb_engine.so + <span class="hljs-number">0x2e0b338</span></li><li>     fp = <span class="hljs-number">0x0000005eea827d80</span>    lr = <span class="hljs-number">0x000000069fa48d44</span></li><li>     sp = <span class="hljs-number">0x0000005eea827c20</span>    pc = <span class="hljs-number">0x000000069fa4b33c</span></li><li>    Found by: previous frame<span class="hljs-number">'</span>s frame pointer</li><li> <span class="hljs-number">2</span>  libweb_engine.so + <span class="hljs-number">0x2e08d40</span></li><li>     fp = <span class="hljs-number">0x0000005eea827e50</span>    lr = <span class="hljs-number">0x00000006a385cef8</span></li><li>     sp = <span class="hljs-number">0x0000005eea827d90</span>    pc = <span class="hljs-number">0x000000069fa48d44</span></li><li>    Found by: previous frame<span class="hljs-number">'</span>s frame pointer</li><li> <span class="hljs-number">3</span>  libweb_engine.so + <span class="hljs-number">0x6c1cef4</span></li><li>     fp = <span class="hljs-number">0x0000005eea828260</span>    lr = <span class="hljs-number">0x00000006a0f11298</span></li><li>     sp = <span class="hljs-number">0x0000005eea827e60</span>    pc = <span class="hljs-number">0x00000006a385cef8</span></li><li> ......</li></ol></pre></div></div>  </li><li><p>使用llvm工具链解析crash源码位置，示例如下（Linux环境）：</p>  <div _ngcontent-pee-c106="" class="highlight-div"><div _ngcontent-pee-c106="" class="highlight-div-header"><div _ngcontent-pee-c106="" class="highlight-div-header-left"><div _ngcontent-pee-c106="" class="handle-button expand-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pee-c106="" class="highlight-div-header-right"><div _ngcontent-pee-c106="" class="handle-button ai-button"></div><div _ngcontent-pee-c106="" class="handle-button line-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pee-c106="" class="handle-button theme-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pee-c106="" class="handle-button copy-button"><div _ngcontent-pee-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pee-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>./llvm-addr2line -Cfpie libweb_engine.so <span class="hljs-number">0x2e0b340</span></li></ol></pre></div></div>  <p>llvm-addr2line工具链位于sdk中。</p>  </li></ul>  </li></ol> </div> <div></div></div>