<h1 _ngcontent-jys-c119="" class="doc-title ng-star-inserted" title="使用主题字体（ArkTS）"> 使用主题字体（ArkTS） </h1>

<div _ngcontent-jys-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>主题字体，特指系统<strong>主题应用</strong>中能使用的字体，属于一种特殊的自定义字体，可以通过相关接口调用使能主题应用中的主题字体。</p>    </div>    <div class="tiledSection">     <h2 id="实现机制">实现机制<i class="anchor-icon anchor-icon-link" anchorid="实现机制" tips="复制节点链接"></i></h2>          <p><strong>图1</strong> 主题字体的切换和使用</p>     <p><span><img originheight="417" originwidth="295" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114358.06881941241945832619002823591596:50001231000000:2800:601BC4C18260B9241766ECF067B369179C9488FBA4C663DCAB542CB9AFFA49E7.jpg" class="notEnlarge" width="295" height="417"></span></p>     <p>针对主题字的切换使用，应用方应确保订阅主题字变更事件，当接收字体变更事件后，由应用方主动调用页面刷新才能实现主题字的切换，否则主题字只能在重启应用后才生效。</p>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>注册使用主题字体的常用接口如下表所示，详细接口说明请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text" target="_blank">@ohos.graphics.text (文本模块)</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">getGlobalInstance(): FontCollection</td>         <td class="cellrowborder" valign="top" width="50%">获取应用全局字体集的实例。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>请确保在设备系统<strong>主题应用</strong>中，能成功应用一项主题字体。</p></li>      <li>       <p>导入依赖的相关模块。</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { text } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li></ol></pre></div></div></li>      <li>       <p>使用getGlobalInstance()接口获取全局字体集对象，系统框架在注册主题字体过程中仅会将主题字体信息传入全局字体集对象中。</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> fontCollection = text.<span class="hljs-property">FontCollection</span>.<span class="hljs-title function_">getGlobalInstance</span>();</li></ol></pre></div></div></li>      <li>       <p>创建段落样式，并使用字体管理器实例构造段落生成器ParagraphBuilder实例，用于生成段落。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>在生成段落对象设置段落样式入参时，不能指定fontFamilies属性，否则会变为优先使用指定字体而非主题字体。</p>         <p>若未在系统<strong>主题应用</strong>中设置一项主题字体，则将使用系统默认字体进行绘制。</p>        </div></div></div>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置文本样式</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">myTextStyle</span>: text.<span class="hljs-property">TextStyle</span> = {</li><li>    <span class="hljs-attr">color</span>: { <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">red</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">blue</span>: <span class="hljs-number">0</span> },</li><li>    <span class="hljs-attr">fontSize</span>: <span class="hljs-number">100</span>,</li><li>    <span class="hljs-comment">// fontFamilies:['Test Font'] // 不要指定fontFamilies，否则优先使用指定字体</span></li><li>};</li><li><span class="hljs-comment">// 创建一个段落样式对象，以设置排版风格</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">myParagraphStyle</span>: text.<span class="hljs-property">ParagraphStyle</span> = {<span class="hljs-attr">textStyle</span>: myTextStyle}</li><li><span class="hljs-comment">// 创建一个段落生成器</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">paragraphBuilder</span>: text.<span class="hljs-property">ParagraphBuilder</span> = <span class="hljs-keyword">new</span> text.<span class="hljs-title class_">ParagraphBuilder</span>(myParagraphStyle, fontCollection);</li></ol></pre></div></div></li>      <li>       <p>设置文本样式，添加文本内容，并生成段落文本用于后续文本的绘制显示。</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 在段落生成器中设置文本样式</span></li><li>paragraphBuilder.<span class="hljs-title function_">pushStyle</span>(myTextStyle);</li><li><span class="hljs-comment">// 在段落生成器中设置文本内容</span></li><li>paragraphBuilder.<span class="hljs-title function_">addText</span>(<span class="hljs-string">"Hello World. \nThis is the theme font."</span>);</li><li><span class="hljs-comment">// 通过段落生成器生成段落</span></li><li><span class="hljs-keyword">let</span> paragraph = paragraphBuilder.<span class="hljs-title function_">build</span>();</li></ol></pre></div></div></li>      <li>       <p>创建渲染节点，并保存到数组。（此处示例代码为简化逻辑，采用数组作为容器，实际开发中应结合应用情况选择更恰当的容器来保证节点的添加与删除对应。）</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 创建渲染节点数组</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">renderNodeMap</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RenderNode</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li><span class="hljs-comment">// 创建节点控制器</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext)</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span></li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>()</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-property">frame</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> }</li><li>      renderNode.<span class="hljs-property">pivot</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span></li><li>  }</li><li>  <span class="hljs-title function_">addNode</span>(<span class="hljs-attr">node</span>: <span class="hljs-title class_">RenderNode</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span></li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>()</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-title function_">appendChild</span>(node)</li><li>      <span class="hljs-comment">// 将节点添加到渲染节点数组中</span></li><li>      renderNodeMap.<span class="hljs-title function_">push</span>(node)</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">clearNodes</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span></li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>()</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-title function_">clearChildren</span>()</li><li>      <span class="hljs-comment">// 将节点从渲染节点数组中移除</span></li><li>      renderNodeMap.<span class="hljs-title function_">pop</span>()</li><li>    }</li><li>  }</li><li>}</li><li><span class="hljs-keyword">let</span> paragraph = paragraphBuilder.<span class="hljs-title function_">build</span>();</li></ol></pre></div></div></li>      <li>       <p>创建渲染节点更新函数，并导出函数，供其他文件（如：EntryAbility.ets）使用；重绘制节点目的为更新排版中字体信息，若不更新字体信息，使用之前残留结果，可能造成文字乱码。</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导出渲染节点更新函数</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateRenderNodeData</span>(<span class="hljs-params"></span>) {</li><li>  renderNodeMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 主动触发节点重绘制</span></li><li>    node.<span class="hljs-title function_">invalidate</span>()</li><li>  })</li><li>}</li></ol></pre></div></div></li>      <li>       <p>在EntryAbility.ets中接收主题字变更事件，并调用渲染节点更新函数。</p>       <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/entryability/EntryAbility.ets</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    preFontId =<span class="hljs-string">""</span>;</li><li>    <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>):<span class="hljs-built_in">void</span>{</li><li>        <span class="hljs-keyword">let</span> fontId = newConfig.<span class="hljs-property">fontId</span>;</li><li>        <span class="hljs-keyword">if</span>(fontId &amp;&amp; fontId !=<span class="hljs-variable language_">this</span>.<span class="hljs-property">preFontId</span>){</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">preFontId</span> = fontId;</li><li>            <span class="hljs-title function_">updateRenderNodeData</span>();</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2>          <p>这里以使用主题字体绘制"Hello World. \nThis is the theme font."文本为例，提供完整的示例和效果示意图。</p>     <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// /pages/Index.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">NodeController</span>, <span class="hljs-title class_">FrameNode</span>, <span class="hljs-title class_">RenderNode</span>, <span class="hljs-title class_">DrawContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">UIContext</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { text } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-comment">// 创建一个自定义的渲染节点类，用于绘制文本</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyRenderNode</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">RenderNode</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">draw</span>(<span class="hljs-params">context: DrawContext</span>) {</li><li>    <span class="hljs-comment">// 获取画布canvas对象</span></li><li>    <span class="hljs-keyword">const</span> canvas = context.<span class="hljs-property">canvas</span>;</li><li>    <span class="hljs-comment">// 设置文本样式</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">myTextStyle</span>: text.<span class="hljs-property">TextStyle</span> = {</li><li>      <span class="hljs-attr">color</span>: { <span class="hljs-attr">alpha</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">red</span>: <span class="hljs-number">255</span>, <span class="hljs-attr">green</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">blue</span>: <span class="hljs-number">0</span> },</li><li>      <span class="hljs-attr">fontSize</span>: <span class="hljs-number">33</span></li><li>    };</li><li>    <span class="hljs-comment">// 创建一个段落样式对象，以设置排版风格</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">myParagraphStyle</span>: text.<span class="hljs-property">ParagraphStyle</span> = {</li><li>      <span class="hljs-attr">textStyle</span>: myTextStyle,</li><li>      <span class="hljs-attr">align</span>: <span class="hljs-number">3</span>,</li><li>      <span class="hljs-attr">wordBreak</span>:text.<span class="hljs-property">WordBreak</span>.<span class="hljs-property">NORMAL</span></li><li>    };</li><li>    <span class="hljs-comment">// 获取字体管理器全局FontCollection实例</span></li><li>    <span class="hljs-keyword">let</span> fontCollection = text.<span class="hljs-property">FontCollection</span>.<span class="hljs-title function_">getGlobalInstance</span>(); <span class="hljs-comment">// 获取Arkui全局FC</span></li><li>    <span class="hljs-comment">// 创建一个段落生成器</span></li><li>    <span class="hljs-keyword">let</span> paragraphGraphBuilder = <span class="hljs-keyword">new</span> text.<span class="hljs-title class_">ParagraphBuilder</span>(myParagraphStyle, fontCollection);</li><li>    <span class="hljs-comment">// 在段落生成器中设置文本样式</span></li><li>    paragraphGraphBuilder.<span class="hljs-title function_">pushStyle</span>(myTextStyle);</li><li>    <span class="hljs-comment">// 在段落生成器中设置文本内容</span></li><li>    paragraphGraphBuilder.<span class="hljs-title function_">addText</span>(<span class="hljs-string">"Hello World. \nThis is the theme font."</span>);</li><li>    <span class="hljs-comment">// 通过段落生成器生成段落</span></li><li>    <span class="hljs-keyword">let</span> paragraph = paragraphGraphBuilder.<span class="hljs-title function_">build</span>();</li><li>    <span class="hljs-comment">// 布局</span></li><li>    paragraph.<span class="hljs-title function_">layoutSync</span>(<span class="hljs-number">2500</span>);</li><li>    paragraph.<span class="hljs-title function_">paint</span>(canvas, <span class="hljs-number">0</span>, <span class="hljs-number">400</span>);</li><li>  }</li><li>}</li><li><span class="hljs-comment">// 创建渲染节点数组</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">renderNodeMap</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">RenderNode</span>&gt; = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>();</li><li><span class="hljs-comment">// 导出渲染节点更新函数</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">updateRenderNodeData</span>(<span class="hljs-params"></span>) {</li><li>  renderNodeMap.<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">node</span>) =&gt;</span> {</li><li>    <span class="hljs-comment">// 主动触发节点重绘制</span></li><li>    node.<span class="hljs-title function_">invalidate</span>();</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyNodeController</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">NodeController</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">rootNode</span>: <span class="hljs-title class_">FrameNode</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>  <span class="hljs-title function_">makeNode</span>(<span class="hljs-attr">uiContext</span>: <span class="hljs-title class_">UIContext</span>): <span class="hljs-title class_">FrameNode</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FrameNode</span>(uiContext);</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-property">frame</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">width</span>: <span class="hljs-number">300</span>, <span class="hljs-attr">height</span>: <span class="hljs-number">50</span> };</li><li>      renderNode.<span class="hljs-property">pivot</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0</span> };</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>;</li><li>  }</li><li>  <span class="hljs-title function_">addNode</span>(<span class="hljs-attr">node</span>: <span class="hljs-title class_">RenderNode</span>): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-title function_">appendChild</span>(node);</li><li>      <span class="hljs-comment">// 将节点添加到渲染节点数组中</span></li><li>      renderNodeMap.<span class="hljs-title function_">push</span>(node);</li><li>    }</li><li>  }</li><li>  <span class="hljs-title function_">clearNodes</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span> == <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">const</span> renderNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">rootNode</span>.<span class="hljs-title function_">getRenderNode</span>();</li><li>    <span class="hljs-keyword">if</span> (renderNode != <span class="hljs-literal">null</span>) {</li><li>      renderNode.<span class="hljs-title function_">clearChildren</span>();</li><li>      <span class="hljs-comment">// 将节点从渲染节点数组中移除</span></li><li>      renderNodeMap.<span class="hljs-title function_">pop</span>();</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-comment">// 创建一个TextRenderNode对象</span></li><li><span class="hljs-keyword">const</span> textNode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyRenderNode</span>();</li><li><span class="hljs-comment">// 定义textNode的像素格式</span></li><li>textNode.<span class="hljs-property">frame</span> = {</li><li>  <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>  <span class="hljs-attr">y</span>: <span class="hljs-number">100</span>,</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-number">600</span>,</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-number">800</span></li><li>};</li><li>textNode.<span class="hljs-property">pivot</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">0.2</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">0.8</span> };</li><li>textNode.<span class="hljs-property">scale</span> = { <span class="hljs-attr">x</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">y</span>: <span class="hljs-number">1</span> };</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">RenderTest</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">myNodeController</span>: <span class="hljs-title class_">MyNodeController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MyNodeController</span>();</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Row</span>() {</li><li>        <span class="hljs-title class_">NodeContainer</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">height</span>(<span class="hljs-string">'90%'</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">White</span>)</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Draw Text"</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-string">'16fp'</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-number">500</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">bottom</span>: <span class="hljs-number">24</span>, <span class="hljs-attr">right</span>: <span class="hljs-number">12</span> })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">clearNodes</span>();</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">myNodeController</span>.<span class="hljs-title function_">addNode</span>(textNode);</li><li>          })</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'50%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-number">40</span>)</li><li>          .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_LG</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>) <span class="hljs-comment">// 设置当前Row容器内子元素在主轴上居中对齐</span></li><li>      .<span class="hljs-title function_">shadow</span>(<span class="hljs-title class_">ShadowStyle</span>.<span class="hljs-property">OUTER_DEFAULT_SM</span>) <span class="hljs-comment">// 设置Row容器外阴影效果</span></li><li>      .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Bottom</span>) <span class="hljs-comment">// 设置当前Row容器内子元素在交叉轴（垂直方向）上的对齐方式为底部对齐</span></li><li>      .<span class="hljs-title function_">layoutWeight</span>(<span class="hljs-number">1</span>) <span class="hljs-comment">// 设置当前Row在父容器Column中的布局权重为1</span></li><li>    }</li><li>  }</li><li>}</li><li>
</li></ol></pre></div></div>     <div _ngcontent-jys-c106="" class="highlight-div"><div _ngcontent-jys-c106="" class="highlight-div-header"><div _ngcontent-jys-c106="" class="highlight-div-header-left"><div _ngcontent-jys-c106="" class="handle-button expand-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jys-c106="" class="highlight-div-header-right"><div _ngcontent-jys-c106="" class="handle-button ai-button"></div><div _ngcontent-jys-c106="" class="handle-button line-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jys-c106="" class="handle-button theme-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jys-c106="" class="handle-button copy-button"><div _ngcontent-jys-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jys-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/entryability/EntryAbility.ets</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">AbilityConstant</span>, <span class="hljs-title class_">Configuration</span>, <span class="hljs-title class_">UIAbility</span>, <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { updateRenderNodeData } <span class="hljs-keyword">from</span> <span class="hljs-string">'../pages/Index'</span>;</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">UIAbility</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    preFontId =<span class="hljs-string">""</span>;</li><li>    <span class="hljs-title function_">onConfigurationUpdate</span>(<span class="hljs-attr">newConfig</span>: <span class="hljs-title class_">Configuration</span>):<span class="hljs-built_in">void</span>{</li><li>        <span class="hljs-keyword">let</span> fontId = newConfig.<span class="hljs-property">fontId</span>;</li><li>        <span class="hljs-keyword">if</span>(fontId &amp;&amp; fontId !=<span class="hljs-variable language_">this</span>.<span class="hljs-property">preFontId</span>){</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">preFontId</span> = fontId;</li><li>            <span class="hljs-title function_">updateRenderNodeData</span>();</li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="效果展示">效果展示<i class="anchor-icon anchor-icon-link" anchorid="效果展示" tips="复制节点链接"></i></h2>          <p>以下展示了在系统<strong>主题应用</strong>中切换使用不同主题字体后，对应的文字渲染效果。</p>     <p>不同主题字体显示效果不同，此处仅示意。</p>     <p><strong>图2</strong> 主题字体1的效果</p>     <p><span><img originheight="572" originwidth="329" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114358.93391316755296731776558498339092:50001231000000:2800:5ECA46B48937AAA2CDD4FC3616D88734AC91625A8E1A192639B98B6065E5E7B4.png" width="329" height="572"></span></p>     <p><strong>图3</strong> 主题字体2的效果</p>     <p><span><img originheight="707" originwidth="353" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114358.43225820238796461298485406364074:50001231000000:2800:85424D863C5F115C445B8AEC55CBE927DCAC1EDDA50B41E285F10977A6CBC184.png" width="353" height="707"></span></p>    </div>   </div>   <div></div></div>