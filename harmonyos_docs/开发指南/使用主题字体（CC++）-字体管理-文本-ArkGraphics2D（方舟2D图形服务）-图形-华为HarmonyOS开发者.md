<h1 _ngcontent-qai-c119="" class="doc-title ng-star-inserted" title="使用主题字体（C/C++）"> 使用主题字体（C/C++） </h1>

<div _ngcontent-qai-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p>主题字体，特指系统<strong>主题应用</strong>中能使用的字体，属于一种特殊的自定义字体。可以通过相关接口调用使能主题应用中的主题字体。</p>    </div>    <div class="tiledSection">     <h2 id="实现机制">实现机制<i class="anchor-icon anchor-icon-link" anchorid="实现机制" tips="复制节点链接"></i></h2>          <p><strong>图1</strong> 主题字体的切换和使用</p>     <p><span><img originheight="417" originwidth="295" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114407.59729322989848267228945908275609:50001231000000:2800:13DE19DFAAE1AD310A28F39CC9471C4D4D73D74B427F8FB6F7FE29E858C2C37B.jpg" class="notEnlarge" width="295" height="417"></span></p>     <p>针对主题字的切换使用，应用方应确保订阅主题字变更事件，当接收字体变更事件后，由应用方主动调用页面刷新才能实现主题字的切换，否则主题字只能在重启应用后才生效；主题字的绘制需要使用OH_Drawing_GetFontCollectionGlobalInstance来获取全局字体集对象，仅该接口返回的对象拥有主题字体信息。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>由OH_Drawing_CreateSharedFontCollection创建的字体集对象不包含主题字信息，无法用于绘制主题字。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h2 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h2>          <p>注册使用主题字体的常用接口如下表所示，详细接口说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-drawing" target="_blank">Drawing</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%">接口名</th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_Drawing_FontCollection* OH_Drawing_GetFontCollectionGlobalInstance(void)</td>         <td class="cellrowborder" valign="top" width="50%">获取全局的字体集对象OH_Drawing_FontCollection。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-ability#abilityonconfigurationupdate" target="_blank">onConfigurationUpdate()</a></td>         <td class="cellrowborder" valign="top" width="50%">          <p>系统配置更新时调用。</p>          <p>主题应用当前仅提供ArkTS接口发布变更事件，需要应用自行处理进行跨语言调用。</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>请确保在设备系统<strong>主题应用</strong>中，能成功应用一项主题字体。</p></li>      <li>       <p>在应用入口文件（默认工程中为EntryAbility.ets）中复写onConfigurationUpdate函数，以响应fontId变更，适配主题字体的切换和页面刷新。</p>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// entry/src/main/ets/entryability/EntryAbility.ets</span></li><li>export <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EntryAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">UIAbility</span> {</li><li>    <span class="hljs-comment">// ...</span></li><li>    preFontId =<span class="hljs-string">""</span>;</li><li>    onConfigurationUpdate(newConfig: Configuration):<span class="hljs-keyword">void</span>{</li><li>        <span class="hljs-type">let</span> <span class="hljs-variable">fontId</span> <span class="hljs-operator">=</span> newConfig.fontId;</li><li>        <span class="hljs-keyword">if</span>(fontId &amp;&amp; fontId !=<span class="hljs-built_in">this</span>.preFontId){</li><li>            <span class="hljs-built_in">this</span>.preFontId = fontId;</li><li>            <span class="hljs-comment">// 调用C++代码</span></li><li>        }</li><li>    }</li><li>    <span class="hljs-comment">// ...</span></li><li>};</li></ol></pre></div></div>       <p>系统配置信息（即示例中的newConfig）变化时，会自动触发onConfigurationUpdate函数。应用可从系统发送的配置信息获取fontId，通过判断是否与应用本地保存的fontId一致来识别主题字的切换。若不一致则刷新本地fontId，并调用C++代码刷新排版结果。</p></li>      <li>       <p>本步骤及之后均为主题字体在C++侧的使用，从ArkTS到C++的调用通路需应用根据实际情况选取调用方式，本示例不作推荐。跨语言调用可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/napi-introduction">Node-API简介</a>。</p>       <p>在工程的src/main/cpp/CMakeLists.txt文件中添加以下lib。</p>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>libnative_drawing.so</li></ol></pre></div></div>       <p>导入头文件。</p>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_font_collection.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_text_typography.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;native_drawing/drawing_register_font.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>创建字体管理器。</p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>注册主题字体作用于字体管理集全局对象，故必须使用OH_Drawing_GetFontCollectionGlobalInstance获取全局字体集对象进行绘制。如若使用OH_Drawing_CreateSharedFontCollection或OH_Drawing_CreateFontCollection创建字体集对象，无法使用主题字体。OH_Drawing_GetFontCollectionGlobalInstance获取的全局字体集不允许释放，释放会造成字体绘制紊乱问题。</p>        </div></div></div>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-undefined" data-highlighted="yes"><ol class="linenums"><li>OH_Drawing_FontCollection *fontCollection = OH_Drawing_GetFontCollectionGlobalInstance();</li></ol></pre></div></div></li>      <li>       <p>OH_Drawing_SetTextStyleFontFamilies()接口可以用来指定字体家族名，从而实现使用指定字体。但使用主题字体，不需要使用OH_Drawing_SetTextStyleFontFamilies()接口指定字体，否则行为变更为优先使用指定字体，而不是主题字体。</p>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-java" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">OH_Drawing_TextStyle</span> <span class="hljs-variable">textStyle</span> <span class="hljs-operator">=</span> OH_Drawing_CreateTextStyle();</li><li><span class="hljs-comment">// const char* myFontFamilies[] = {"otherFontFamilyName"};</span></li><li><span class="hljs-comment">// 注意不要使用此接口来指定字体</span></li><li><span class="hljs-comment">// OH_Drawing_SetTextStyleFontFamilies(textStyle, 1, myFontFamilies);</span></li></ol></pre></div></div></li>      <li>       <p>设置段落文本内容为"Hello World. \nThis is the theme font."，此时该段落文本将应用主题字体。</p>       <div _ngcontent-qai-c106="" class="highlight-div"><div _ngcontent-qai-c106="" class="highlight-div-header"><div _ngcontent-qai-c106="" class="highlight-div-header-left"><div _ngcontent-qai-c106="" class="handle-button expand-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-qai-c106="" class="highlight-div-header-right"><div _ngcontent-qai-c106="" class="handle-button ai-button"></div><div _ngcontent-qai-c106="" class="handle-button line-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-qai-c106="" class="handle-button theme-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-qai-c106="" class="handle-button copy-button"><div _ngcontent-qai-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-qai-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 设置其他文本样式</span></li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleColor</span>(textStyle, <span class="hljs-built_in">OH_Drawing_ColorSetArgb</span>(<span class="hljs-number">0xFF</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>, <span class="hljs-number">0x00</span>));</li><li><span class="hljs-built_in">OH_Drawing_SetTextStyleFontSize</span>(textStyle, <span class="hljs-number">50.0</span>);</li><li><span class="hljs-comment">// 创建一个段落样式对象，以设置排版风格</span></li><li>OH_Drawing_TypographyStyle *typographyStyle = <span class="hljs-built_in">OH_Drawing_CreateTypographyStyle</span>();</li><li><span class="hljs-built_in">OH_Drawing_SetTypographyTextAlign</span>(typographyStyle, TEXT_ALIGN_LEFT); <span class="hljs-comment">// 设置段落样式为左对齐</span></li><li><span class="hljs-comment">// 创建一个段落生成器</span></li><li>OH_Drawing_TypographyCreate* handler = <span class="hljs-built_in">OH_Drawing_CreateTypographyHandler</span>(typographyStyle, fontCollection);</li><li><span class="hljs-comment">// 在段落生成器中设置文本样式</span></li><li><span class="hljs-built_in">OH_Drawing_TypographyHandlerPushTextStyle</span>(handler, textStyle);</li><li><span class="hljs-comment">// 在段落生成器中设置文本内容</span></li><li><span class="hljs-type">const</span> <span class="hljs-type">char</span>* text = <span class="hljs-string">"Hello World. \nThis is the theme font."</span>;</li><li><span class="hljs-built_in">OH_Drawing_TypographyHandlerAddText</span>(handler, text);</li><li><span class="hljs-comment">// 通过段落生成器生成段落</span></li><li>OH_Drawing_Typography* typography = <span class="hljs-built_in">OH_Drawing_CreateTypography</span>(handler);</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="效果展示">效果展示<i class="anchor-icon anchor-icon-link" anchorid="效果展示" tips="复制节点链接"></i></h2>          <p>以下展示了在系统<strong>主题应用</strong>中切换使用不同主题字体后，对应的文字渲染效果。</p>     <p>不同主题字体显示效果不同，此处仅示意。</p>     <p><strong>图2</strong> 主题字体1的效果</p>     <p><span><img originheight="567" originwidth="358" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114407.77670749640109177211350118439633:50001231000000:2800:E76D0A40717C3A2CD4678C3127CCF9D5978017550F8CB7AC28660033CEA7F461.png" width="358" height="567"></span></p>     <p><strong>图3</strong> 主题字体2的效果</p>     <p><span><img originheight="786" originwidth="386" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114408.95184414764038070310423161329048:50001231000000:2800:7A08C0E2CDAA6E6EF015EE877849B571F54B4EB4369C8697EE278385167A6E5F.png" width="386" height="786"></span></p>    </div>   </div>   <div></div></div>