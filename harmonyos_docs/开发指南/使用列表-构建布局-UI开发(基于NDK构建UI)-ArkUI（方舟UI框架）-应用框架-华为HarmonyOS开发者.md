<h1 _ngcontent-eru-c119="" class="doc-title ng-star-inserted" title="使用列表"> 使用列表 </h1>

<div _ngcontent-eru-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>ArkUI开发框架在NDK接口提供了列表组件，使用列表可以轻松高效地显示结构化、可滚动的信息。列表组件支持控制滚动位置、支持分组显示内容、支持使用NodeAdapter实现懒加载以提升列表创建性能。</p>    <div class="tiledSection">     <h2 id="创建列表">创建列表<i class="anchor-icon anchor-icon-link" anchorid="创建列表" tips="复制节点链接"></i></h2>          <p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-access-the-arkts-page">接入ArkTS页面章节</a>实现列表创建。</p>    </div>    <div class="tiledSection">     <h2 id="监听滚动事件">监听滚动事件<i class="anchor-icon anchor-icon-link" anchorid="监听滚动事件" tips="复制节点链接"></i></h2>          <p>参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ndk-listen-to-component-events">监听组件事件</a>章节实现列表滚动事件监听。</p>    </div>    <div class="tiledSection">     <h2 id="使用懒加载">使用懒加载<i class="anchor-icon anchor-icon-link" anchorid="使用懒加载" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="nodeadapter介绍" class="firsth2">NodeAdapter介绍<i class="anchor-icon anchor-icon-link" anchorid="nodeadapter介绍" tips="复制节点链接"></i></h3>          <p>NDK提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-arkui-nativemodule-arkui-nodeadapter8h" target="_blank">NodeAdapter</a>对象替代ArkTS侧的LazyForEach功能，用于按需生成子组件，NodeAdapter支持在List/ListItemGroup、Grid、WaterFlow、Swiper组件中使用。</p>     <ul>      <li>       <p>设置了NodeAdapter属性的节点，不再支持addChild等直接添加子组件的接口。子组件完全由NodeAdapter管理，使用属性方法设置NodeAdapter时，会判断父组件是否已经存在子节点，如果父组件已经存在子节点，则设置NodeAdapter操作失败，返回错误码。</p></li>      <li>       <p>NodeAdapter通过相关事件通知开发者按需生成组件，类似组件事件机制，开发者使用NodeAdapter时要注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#oh_arkui_nodeadapter_registereventreceiver" target="_blank">事件监听器</a>，在监听器事件中处理逻辑，相关事件通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeadaptereventtype" target="_blank">ArkUI_NodeAdapterEventType</a>定义。另外NodeAdapter不会主动释放不在屏幕内显示的组件对象，开发者需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-node-h#arkui_nodeadaptereventtype" target="_blank">NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER</a>事件中进行组件对象的释放，或者进行缓存复用。下图展示了典型列表滑动场景下的事件触发机制：</p>       <p><span><img originheight="523" originwidth="808" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114755.35628452313061499690893289576946:50001231000000:2800:A671609BE2BBF6CD3ADA94A27F1A75F2B0B6A3B4C5DADBCF0A536E4874FA1B8C.png" width="808" height="523"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="实现懒加载适配器">实现懒加载适配器<i class="anchor-icon anchor-icon-link" anchorid="实现懒加载适配器" tips="复制节点链接"></i></h3>          <p>使用ArkUIListItemAdapter类来管理懒加载适配器，在类的构造中创建NodeAdapter对象，并给NodeAdapter对象设置事件监听器，在类的析构函数中，销毁NodeAdapter对象。</p>     <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListItemAdapter</span></li><li><span class="hljs-comment">// 用于文本列表懒加载功能代码。</span></li><li>
</li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMADAPTER_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMADAPTER_H</span></li><li>
</li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">arkui</span>/<span class="hljs-title class_">native_node</span>.<span class="hljs-title class_">h</span>&gt;</li><li>#<span class="hljs-title class_">include</span> &lt;<span class="hljs-title class_">stack</span>&gt;</li><li>#<span class="hljs-title class_">include</span> &lt;<span class="hljs-title class_">string</span>&gt;</li><li>#<span class="hljs-title class_">include</span> &lt;<span class="hljs-title class_">unordered_set</span>&gt;</li><li>
</li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListItemNode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUITextNode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"NativeModule.h"</span></li><li>#<span class="hljs-variable">include</span> &lt;<span class="hljs-title class_">hilog</span>/<span class="hljs-title class_">log</span>.<span class="hljs-title class_">h</span>&gt;</li><li>
</li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span> {</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListItemAdapter</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-title function_">ArkUIListItemAdapter</span>()</li><li>        : <span class="hljs-title class_">module_</span>(<span class="hljs-variable">NativeModuleInstance</span>::<span class="hljs-title class_">GetInstance</span>()-&gt;<span class="hljs-title class_">GetNativeNodeAPI</span>()), <span class="hljs-title function_">handle_</span>(<span class="hljs-title function_">OH_ArkUI_NodeAdapter_Create</span>()) { <span class="hljs-comment">// 使用NodeAdapter创建函数。</span></li><li>        <span class="hljs-comment">// 初始化懒加载数据。</span></li><li>        <span class="hljs-keyword">for</span> (<span class="hljs-variable">int32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-number">1000</span>; <span class="hljs-title class_">i</span>++) {</li><li>            <span class="hljs-variable">data_</span>.<span class="hljs-title function_">emplace_back</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">to_string</span>(<span class="hljs-title class_">i</span>));</li><li>        }</li><li>        <span class="hljs-comment">// 设置懒加载数据。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_SetTotalNodeCount</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">data_</span>.<span class="hljs-title function_">size</span>());</li><li>        <span class="hljs-comment">// 设置懒加载回调事件。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_RegisterEventReceiver</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-keyword">this</span>, <span class="hljs-variable">OnStaticAdapterEvent</span>);</li><li>    }</li><li>
</li><li>    ~<span class="hljs-title function_">ArkUIListItemAdapter</span>() {</li><li>        <span class="hljs-comment">// 释放创建的组件。</span></li><li>        <span class="hljs-keyword">while</span> (!<span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">empty</span>()) {</li><li>            <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">pop</span>();</li><li>        }</li><li>        <span class="hljs-variable">items_</span>.<span class="hljs-title function_">clear</span>();</li><li>        <span class="hljs-comment">// 释放Adapter相关资源。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_UnregisterEventReceiver</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_Dispose</span>(<span class="hljs-variable">handle_</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">ArkUI_NodeAdapterHandle</span> <span class="hljs-title function_">GetHandle</span>() <span class="hljs-keyword">const</span> { <span class="hljs-keyword">return</span> <span class="hljs-variable">handle_</span>; }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">RemoveItem</span>(<span class="hljs-variable">int32_t</span> <span class="hljs-variable">index</span>) {</li><li>        <span class="hljs-comment">// 删除第index个数据。</span></li><li>        <span class="hljs-variable">data_</span>.<span class="hljs-title function_">erase</span>(<span class="hljs-variable">data_</span>.<span class="hljs-title function_">begin</span>() + <span class="hljs-variable">index</span>);</li><li>        <span class="hljs-comment">// 如果index会导致可视区域元素发生可见性变化，则会回调NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER事件删除元素，</span></li><li>        <span class="hljs-comment">// 根据是否有新增元素回调NODE_ADAPTER_EVENT_ON_GET_NODE_ID和NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER事件。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_RemoveItem</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">index</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-comment">// 更新新的数量。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_SetTotalNodeCount</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">data_</span>.<span class="hljs-title function_">size</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">InsertItem</span>(<span class="hljs-variable">int32_t</span> <span class="hljs-variable">index</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> &amp;<span class="hljs-title class_">value</span>) {</li><li>        <span class="hljs-variable">data_</span>.<span class="hljs-title function_">insert</span>(<span class="hljs-variable">data_</span>.<span class="hljs-title function_">begin</span>() + <span class="hljs-variable">index</span>, <span class="hljs-variable">value</span>);</li><li>        <span class="hljs-comment">// 如果index会导致可视区域元素发生可见性变化，则会回调NODE_ADAPTER_EVENT_ON_GET_NODE_ID和NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER事件，</span></li><li>        <span class="hljs-comment">// 根据是否有删除元素回调NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER事件。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_InsertItem</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">index</span>, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-comment">// 更新新的数量。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_SetTotalNodeCount</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">data_</span>.<span class="hljs-title function_">size</span>());</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">MoveItem</span>(<span class="hljs-variable">int32_t</span> <span class="hljs-variable">oldIndex</span>, <span class="hljs-variable">int32_t</span> <span class="hljs-variable">newIndex</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">temp</span> = <span class="hljs-variable">data_</span>[<span class="hljs-variable">oldIndex</span>];</li><li>        <span class="hljs-variable">data_</span>.<span class="hljs-title function_">insert</span>(<span class="hljs-variable">data_</span>.<span class="hljs-title function_">begin</span>() + <span class="hljs-variable">newIndex</span>, <span class="hljs-variable">temp</span>);</li><li>        <span class="hljs-variable">data_</span>.<span class="hljs-title function_">erase</span>(<span class="hljs-variable">data_</span>.<span class="hljs-title function_">begin</span>() + <span class="hljs-variable">oldIndex</span>);</li><li>        <span class="hljs-comment">// 移到位置如果未发生可视区域内元素的可见性变化，则不回调事件，反之根据新增和删除场景回调对应的事件。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_MoveItem</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">oldIndex</span>, <span class="hljs-variable">newIndex</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">ReloadItem</span>(<span class="hljs-variable">int32_t</span> <span class="hljs-variable">index</span>, <span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">string</span> &amp;<span class="hljs-title class_">value</span>) {</li><li>        <span class="hljs-variable">data_</span>[<span class="hljs-variable">index</span>] = <span class="hljs-variable">value</span>;</li><li>        <span class="hljs-comment">// 如果index位于可视区域内，先回调NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER删除老元素，</span></li><li>        <span class="hljs-comment">// 再回调NODE_ADAPTER_EVENT_ON_GET_NODE_ID和NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER事件。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_ReloadItem</span>(<span class="hljs-variable">handle_</span>, <span class="hljs-variable">index</span>, <span class="hljs-number">1</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">ReloadAllItem</span>() {</li><li>        <span class="hljs-variable">std</span>::<span class="hljs-title class_">reverse</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">data_</span>.<span class="hljs-title class_">end</span>());</li><li>        <span class="hljs-comment">// 全部重新加载场景下，会回调NODE_ADAPTER_EVENT_ON_GET_NODE_ID接口获取新的组件ID，</span></li><li>        <span class="hljs-comment">// 根据新的组件ID进行对比，ID不发生变化的进行复用，</span></li><li>        <span class="hljs-comment">// 针对新增ID的元素，调用NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER事件创建新的组件，</span></li><li>        <span class="hljs-comment">// 然后判断老数据中遗留的未使用ID，调用NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER删除老元素。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapter_ReloadAllItems</span>(<span class="hljs-variable">handle_</span>);</li><li>    }</li><li>
</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-keyword">static</span> <span class="hljs-variable">void</span> <span class="hljs-title function_">OnStaticAdapterEvent</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-comment">// 获取实例对象，回调实例事件。</span></li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">itemAdapter</span> = <span class="hljs-title class_">reinterpret_cast</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span> *&gt;(<span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetUserData</span>(<span class="hljs-variable">event</span>));</li><li>        <span class="hljs-variable">itemAdapter</span>-&gt;<span class="hljs-title class_">OnAdapterEvent</span>(<span class="hljs-title class_">event</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnAdapterEvent</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-keyword">type</span> = <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetType</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">switch</span> (<span class="hljs-keyword">type</span>) {</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-variable">NODE_ADAPTER_EVENT_ON_GET_NODE_ID</span>:</li><li>            <span class="hljs-title function_">OnNewItemIdCreated</span>(<span class="hljs-variable">event</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-variable">NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER</span>:</li><li>            <span class="hljs-title function_">OnNewItemAttached</span>(<span class="hljs-variable">event</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-variable">NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER</span>:</li><li>            <span class="hljs-title function_">OnItemDetached</span>(<span class="hljs-variable">event</span>);</li><li>            <span class="hljs-keyword">break</span>;</li><li>        <span class="hljs-variable">default</span>:</li><li>            <span class="hljs-keyword">break</span>;</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 分配ID给需要显示的Item，用于ReloadAllItems场景的元素diff。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnNewItemIdCreated</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetItemIndex</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-keyword">static</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">hash</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>&gt; <span class="hljs-title class_">hashId</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">hash</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>&gt;();</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">id</span> = <span class="hljs-title function_">hashId</span>(<span class="hljs-variable">data_</span>[<span class="hljs-variable">index</span>]);</li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_SetNodeId</span>(<span class="hljs-variable">event</span>, <span class="hljs-variable">id</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 需要新的Item显示在可见区域。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnNewItemAttached</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetItemIndex</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">handle</span> = <span class="hljs-variable">nullptr</span>;</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">empty</span>()) {</li><li>            <span class="hljs-comment">// 使用并更新回收复用的缓存。</span></li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">recycledItem</span> = <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">top</span>();</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">textItem</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">dynamic_pointer_cast</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;(<span class="hljs-variable">recycledItem</span>-&gt;<span class="hljs-title class_">GetChildren</span>().<span class="hljs-title class_">back</span>());</li><li>            <span class="hljs-variable">textItem</span>-&gt;<span class="hljs-title class_">SetTextContent</span>(<span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]);</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">recycledItem</span>-&gt;<span class="hljs-title class_">GetHandle</span>();</li><li>            <span class="hljs-comment">// 释放缓存池的引用。</span></li><li>            <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">pop</span>();</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">// 创建新的元素。</span></li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">listItem</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListItemNode</span>&gt;();</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">textNode</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;();</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetTextContent</span>(<span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetFontSize</span>(<span class="hljs-number">16</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetPercentWidth</span>(<span class="hljs-number">1</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetHeight</span>(<span class="hljs-number">100</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetBackgroundColor</span>(<span class="hljs-number">0xFFfffacd</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetTextAlign</span>(<span class="hljs-title class_">ARKUI_TEXT_ALIGNMENT_CENTER</span>);</li><li>            <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">AddChild</span>(<span class="hljs-title class_">textNode</span>);</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">swipeNode</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;();</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">RegisterOnClick</span>([<span class="hljs-keyword">this</span>, <span class="hljs-title class_">data</span> = <span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]](<span class="hljs-variable">ArkUI_NodeEvent</span> *<span class="hljs-variable">event</span>) {</li><li>                <span class="hljs-variable">auto</span> <span class="hljs-variable">it</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">find</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">data_</span>.<span class="hljs-title class_">end</span>(), <span class="hljs-title class_">data</span>);</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">it</span> != <span class="hljs-variable">data_</span>.<span class="hljs-title function_">end</span>()) {</li><li>                    <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">distance</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">it</span>);</li><li>                    <span class="hljs-title function_">RemoveItem</span>(<span class="hljs-variable">index</span>);</li><li>                }</li><li>            });</li><li>            <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">SetSwiperAction</span>(<span class="hljs-title class_">swipeNode</span>);</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">GetHandle</span>();</li><li>            <span class="hljs-comment">// 保持文本列表项的引用。</span></li><li>            <span class="hljs-variable">items_</span>.<span class="hljs-title function_">emplace</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">listItem</span>);</li><li>        }</li><li>        <span class="hljs-comment">// 设置需要展示的元素。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_SetItem</span>(<span class="hljs-variable">event</span>, <span class="hljs-variable">handle</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// Item从可见区域移除。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnItemDetached</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">item</span> = <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetRemovedNode</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-comment">// 放置到缓存池中进行回收复用。</span></li><li>        <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">emplace</span>(<span class="hljs-variable">items_</span>[<span class="hljs-variable">item</span>]);</li><li>    }</li><li>
</li><li>
</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">vector</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">string</span>&gt; <span class="hljs-title class_">data_</span>;</li><li>    <span class="hljs-variable">ArkUI_NativeNodeAPI_1</span> *<span class="hljs-variable">module_</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">ArkUI_NodeAdapterHandle</span> <span class="hljs-variable">handle_</span> = <span class="hljs-variable">nullptr</span>;</li><li>
</li><li>    <span class="hljs-comment">// 管理NodeAdapter生成的元素。</span></li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">unordered_map</span>&lt;<span class="hljs-title class_">ArkUI_NodeHandle</span>, <span class="hljs-title class_">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemNode</span>&gt;&gt; <span class="hljs-title class_">items_</span>;</li><li>
</li><li>    <span class="hljs-comment">// 管理回收复用组件池。</span></li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">stack</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemNode</span>&gt;&gt; <span class="hljs-title class_">cachedItems_</span>;</li><li>};</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li>#<span class="hljs-variable">endif</span> <span class="hljs-comment">// MYAPPLICATION_ARKUILISTITEMADAPTER_H</span></li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="在列表中应用懒加载适配器">在列表中应用懒加载适配器<i class="anchor-icon anchor-icon-link" anchorid="在列表中应用懒加载适配器" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>在ArkUIListNode中添加SetLazyAdapter函数，给列表节点设置NODE_LIST_NODE_ADAPTER属性，并将NodeAdapter作为属性入参传入。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListNode.h</span></li><li><span class="hljs-comment">// 列表封装对象。</span></li><li>
</li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTNODE_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTNODE_H</span></li><li>
</li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListItemAdapter.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUINode.h"</span></li><li>
</li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span> {</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-title function_">ArkUIListNode</span>()</li><li>        : <span class="hljs-title class_">ArkUINode</span>((<span class="hljs-variable">NativeModuleInstance</span>::<span class="hljs-title class_">GetInstance</span>()-&gt;<span class="hljs-title class_">GetNativeNodeAPI</span>())-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_LIST</span>)) {}</li><li>
</li><li>    ~<span class="hljs-title function_">ArkUIListNode</span>() <span class="hljs-keyword">override</span> {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">nativeModule_</span>) {</li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">unregisterNodeEvent</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ON_SCROLL_INDEX</span>);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">adapter_</span>) {</li><li>            <span class="hljs-comment">// 析构的时候卸载adapter下的UI组件。</span></li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">resetAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_NODE_ADAPTER</span>);</li><li>            <span class="hljs-variable">adapter_</span>.<span class="hljs-title function_">reset</span>();</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetScrollBarState</span>(<span class="hljs-variable">bool</span> <span class="hljs-variable">isShow</span>) {</li><li>        <span class="hljs-title function_">assert</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-variable">ArkUI_ScrollBarDisplayMode</span> <span class="hljs-variable">displayMode</span> =</li><li>            <span class="hljs-variable">isShow</span> ? <span class="hljs-variable">ARKUI_SCROLL_BAR_DISPLAY_MODE_ON</span> : <span class="hljs-title class_">ARKUI_SCROLL_BAR_DISPLAY_MODE_OFF</span>;</li><li>        <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {{.<span class="hljs-variable">i32</span> = <span class="hljs-variable">displayMode</span>}};</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span> = {<span class="hljs-variable">value</span>, <span class="hljs-number">1</span>};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_SCROLL_BAR_DISPLAY_MODE</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">RegisterOnScrollIndex</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">function</span>&lt;<span class="hljs-title class_">void</span>(<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">index</span>)&gt; &amp;<span class="hljs-title class_">onScrollIndex</span>) {</li><li>        <span class="hljs-title function_">assert</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-variable">onScrollIndex_</span> = <span class="hljs-variable">onScrollIndex</span>;</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">registerNodeEvent</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ON_SCROLL_INDEX</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">nullptr</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 引入懒加载模块。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetLazyAdapter</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt; &amp;<span class="hljs-title class_">adapter</span>) {</li><li>        <span class="hljs-title function_">assert</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span>{<span class="hljs-variable">nullptr</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">adapter</span>-&gt;<span class="hljs-title class_">GetHandle</span>()};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_NODE_ADAPTER</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>        <span class="hljs-variable">adapter_</span> = <span class="hljs-variable">adapter</span>;</li><li>    }</li><li>
</li><li><span class="hljs-keyword">protected</span>:</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnNodeEvent</span>(<span class="hljs-variable">ArkUI_NodeEvent</span> *<span class="hljs-variable">event</span>) <span class="hljs-keyword">override</span> {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">eventType</span> = <span class="hljs-title function_">OH_ArkUI_NodeEvent_GetEventType</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">switch</span> (<span class="hljs-variable">eventType</span>) {</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-variable">NODE_LIST_ON_SCROLL_INDEX</span>: {</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-title function_">OH_ArkUI_NodeEvent_GetNodeComponentEvent</span>(<span class="hljs-variable">event</span>)-&gt;<span class="hljs-title class_">data</span>[<span class="hljs-number">0</span>];</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable">onScrollIndex_</span>) {</li><li>                <span class="hljs-title function_">onScrollIndex_</span>(<span class="hljs-variable">index</span>.<span class="hljs-variable">i32</span>);</li><li>            }</li><li>        }</li><li>        <span class="hljs-variable">default</span>: {</li><li>        }</li><li>        }</li><li>    }</li><li>
</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">function</span>&lt;<span class="hljs-title class_">void</span>(<span class="hljs-title class_">int32_t</span> <span class="hljs-title class_">index</span>)&gt; <span class="hljs-title class_">onScrollIndex_</span>;</li><li>
</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt; <span class="hljs-title class_">adapter_</span>;</li><li>};</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li>#<span class="hljs-variable">endif</span> <span class="hljs-comment">// MYAPPLICATION_ARKUILISTNODE_H</span></li></ol></pre></div></div></li>      <li>       <p>创建List使用懒加载的示例代码，调用List节点的SetLazyAdapter接口设置懒加载适配器。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// LazyTextListExample</span></li><li><span class="hljs-comment">// 懒加载列表示例代码。</span></li><li>
</li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li><li>
</li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIBaseNode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListNode.h"</span></li><li>
</li><li>
</li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span> {</li><li>
</li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIBaseNode</span>&gt; <span class="hljs-title class_">CreateLazyTextListExample</span>(<span class="hljs-title class_">napi_env</span> <span class="hljs-title class_">env</span>) {</li><li>    <span class="hljs-comment">// 创建组件并挂载</span></li><li>    <span class="hljs-comment">// 1：创建List组件。</span></li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">list</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListNode</span>&gt;();</li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetPercentWidth</span>(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetPercentHeight</span>(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-comment">// 2：创建ListItem懒加载组件并挂载到List上。</span></li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">adapter</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt;();</li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetLazyAdapter</span>(<span class="hljs-title class_">adapter</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">list</span>;</li><li>}</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li><li>
</li><li>#<span class="hljs-variable">endif</span> <span class="hljs-comment">// MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li></ol></pre></div></div></li>      <li>       <p>在NativeEntry.cpp中调用List使用懒加载的示例代码。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// NDK接口入口挂载文件。</span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"NativeEntry.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"LazyTextListExample.h"</span></span></li><li>
</li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_node_napi.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;arkui/native_type.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;js_native_api.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;uv.h&gt;</span></span></li><li>
</li><li><span class="hljs-keyword">namespace</span> NativeModule {</li><li>
</li><li>
</li><li><span class="hljs-function">napi_value <span class="hljs-title">CreateNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>
</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-comment">// 获取NodeContent</span></li><li>    ArkUI_NodeContentHandle contentHandle;</li><li>    <span class="hljs-built_in">OH_ArkUI_GetNodeContentFromNapiValue</span>(env, args[<span class="hljs-number">0</span>], &amp;contentHandle);</li><li>    NativeEntry::<span class="hljs-built_in">GetInstance</span>()-&gt;<span class="hljs-built_in">SetContentHandle</span>(contentHandle);</li><li>
</li><li>    <span class="hljs-comment">// 创建懒加载文本列表</span></li><li>    <span class="hljs-keyword">auto</span> node = <span class="hljs-built_in">CreateLazyTextListExample</span>(env);</li><li>
</li><li>    <span class="hljs-comment">// 保持Native侧对象到管理类中，维护生命周期。</span></li><li>    NativeEntry::<span class="hljs-built_in">GetInstance</span>()-&gt;<span class="hljs-built_in">SetRootNode</span>(node);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function">napi_value <span class="hljs-title">DestroyNativeRoot</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span> </span>{</li><li>    <span class="hljs-comment">// 从管理类中释放Native侧对象。</span></li><li>    NativeEntry::<span class="hljs-built_in">GetInstance</span>()-&gt;<span class="hljs-built_in">DisposeRootNode</span>();</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li>} <span class="hljs-comment">// namespace NativeModule</span></li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="控制列表滚动位置">控制列表滚动位置<i class="anchor-icon anchor-icon-link" anchorid="控制列表滚动位置" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>控制列表滚动到指定偏移量位置。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//ArkUIListNode.h</span></li><li><span class="hljs-comment">//列表封装对象。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListNode</span>: <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li>    <span class="hljs-comment">//...</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">ScrollTo</span>(<span class="hljs-variable">float</span> <span class="hljs-variable">offset</span>) {</li><li>        <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {{.<span class="hljs-variable">f32</span> =<span class="hljs-number">0</span>},{.<span class="hljs-variable">f32</span> = <span class="hljs-variable">offset</span>},{.<span class="hljs-variable">f32</span> = <span class="hljs-number">0</span>}};</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">value</span>,.<span class="hljs-variable">size</span> = <span class="hljs-number">3</span>};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_SCROLL_OFFSET</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>    }</li><li>};</li></ol></pre></div></div></li>      <li>       <p>控制列表滚动到指定元素。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//ArkUIListNode.h</span></li><li><span class="hljs-comment">//列表封装对象。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li>    <span class="hljs-comment">//...</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">ScrollToIndex</span>(<span class="hljs-variable">int32_t</span> <span class="hljs-variable">index</span>) {</li><li>        <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {{.<span class="hljs-variable">i32</span> = <span class="hljs-variable">index</span>}};</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">value</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">1</span>};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_SCROLL_TO_INDEX</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>    }</li><li>};</li></ol></pre></div></div></li>      <li>       <p>控制列表滚动指定偏移量。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">//ArkUIListNode.h</span></li><li><span class="hljs-comment">//列表封装对象。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">ScrollBy</span>(<span class="hljs-variable">float</span> <span class="hljs-variable">offset</span>) {</li><li>        <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {{.<span class="hljs-variable">f32</span> =<span class="hljs-number">0</span>},{.<span class="hljs-variable">f32</span> = <span class="hljs-variable">offset</span>}};</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">value</span> = <span class="hljs-variable">value</span>, .<span class="hljs-variable">size</span> = <span class="hljs-number">2</span>};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_SCROLL_BY</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>    }</li><li>};</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="listitem横划删除">ListItem横划删除<i class="anchor-icon anchor-icon-link" anchorid="listitem横划删除" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>ListItem设置NODE_LIST_ITEM_SWIPE_ACTION属性，将ArkUI_ListItemSwipeActionOption对象作为属性参数传入。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListItemNode.h</span></li><li><span class="hljs-comment">//提供列表项的封装类。</span></li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMNODE_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMNODE_H</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUINode.h"</span></li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span>{</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListItemNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-title function_">ArkUIListItemNode</span>()</li><li>        : <span class="hljs-title class_">ArkUINode</span>((<span class="hljs-variable">NativeModuleInstance</span>::<span class="hljs-title class_">GetInstance</span>()-&gt;<span class="hljs-title class_">GetNativeNodeAPI</span>())-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_LIST_ITEM</span>)) {}</li><li>    ~<span class="hljs-title function_">ArkUIListItemNode</span>() {</li><li>        <span class="hljs-keyword">if</span>(<span class="hljs-variable">swipeAction_</span>) {</li><li>            <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionOption_Dispose</span>(<span class="hljs-variable">swipeAction_</span>);</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">swipeItem_</span>) {</li><li>            <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionItem_Dispose</span>(<span class="hljs-variable">swipeItem_</span>);</li><li>        }</li><li>    }</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetSwiperAction</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">node</span>) {</li><li>        <span class="hljs-variable">swipeContent_</span> = <span class="hljs-variable">node</span>;</li><li>        <span class="hljs-variable">swipeItem_</span> = <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionItem_Create</span>();</li><li>        <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionItem_SetContent</span>(<span class="hljs-variable">swipeItem_</span>, <span class="hljs-variable">node</span>-&gt;<span class="hljs-title class_">GetHandle</span>());</li><li>        <span class="hljs-variable">swipeAction_</span> = <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionOption_Create</span>();</li><li>        <span class="hljs-title function_">OH_ArkUI_ListItemSwipeActionOption_SetEnd</span>(<span class="hljs-variable">swipeAction_</span>, <span class="hljs-variable">swipeItem_</span>);</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">object</span>= <span class="hljs-variable">swipeAction_</span> };</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>,<span class="hljs-title class_">NODE_LIST_ITEM_SWIPE_ACTION</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>    }</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">GetSwipeContent</span>() <span class="hljs-keyword">const</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">swipeContent_</span>;</li><li>    }</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">list</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIBaseNode</span>&gt;&gt; &amp;<span class="hljs-title class_">GetChildren</span>() {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">children_</span>;</li><li>    }</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-variable">ArkUI_ListItemSwipeActionOption</span>* <span class="hljs-variable">swipeAction_</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">ArkUI_ListItemSwipeActionItem</span>* <span class="hljs-variable">swipeItem_</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">swipeContent_</span> = <span class="hljs-variable">nullptr</span>;</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">list</span>&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIBaseNode</span>&gt;&gt; <span class="hljs-title class_">children_</span>;</li><li>};</li><li>}<span class="hljs-comment">// namespace NativeModule</span></li><li>#<span class="hljs-variable">endif</span><span class="hljs-comment">// MYAPPLICATION_ARKUILISTITEMNODE_H</span></li></ol></pre></div></div></li>      <li>       <p>创建ListItem时，创建ListItem的划出组件，并绑定点击事件，在点击事件中执行删除数据源操作。ListItem复用时，更新划出组件的绑定事件。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListItemAdapter.h</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListItemAdapter</span> {</li><li>    <span class="hljs-comment">//...</span></li><li>    <span class="hljs-comment">//需要新的Item显示在可见区域。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">OnNewItemAttached</span>(<span class="hljs-variable">ArkUI_NodeAdapterEvent</span> *<span class="hljs-variable">event</span>) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_GetItemIndex</span>(<span class="hljs-variable">event</span>);</li><li>        <span class="hljs-variable">ArkUI_NodeHandle</span> <span class="hljs-variable">handle</span> = <span class="hljs-variable">nullptr</span>;</li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">empty</span>()) {</li><li>            <span class="hljs-comment">//使用并更新回收复用的缓存。</span></li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">recycledItem</span> = <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">top</span>();</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">textItem</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">dynamic_pointer_cast</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;(<span class="hljs-variable">recycledItem</span>-&gt;<span class="hljs-title class_">GetChildren</span>().<span class="hljs-title class_">back</span>());</li><li>            <span class="hljs-variable">textItem</span>-&gt;<span class="hljs-title class_">SetTextContent</span>(<span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]);</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">recycledItem</span>-&gt;<span class="hljs-title class_">GetHandle</span>();</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">swipeContent</span> = <span class="hljs-variable">recycledItem</span>-&gt;<span class="hljs-title class_">GetSwipeContent</span>();</li><li>            <span class="hljs-variable">swipeContent</span>-&gt;<span class="hljs-title class_">RegisterOnClick</span>([<span class="hljs-keyword">this</span>, <span class="hljs-title class_">data</span> = <span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]]() {</li><li>                <span class="hljs-variable">auto</span> <span class="hljs-variable">it</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">find</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">data_</span>.<span class="hljs-title class_">end</span>(), <span class="hljs-title class_">data</span>);</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">it</span> != <span class="hljs-variable">data_</span>.<span class="hljs-title function_">end</span>()) {</li><li>                    <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">distance</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">it</span>);</li><li>                    <span class="hljs-title function_">RemoveItem</span>(<span class="hljs-variable">index</span>);</li><li>                }</li><li>            });</li><li>            <span class="hljs-comment">//释放缓存池的引用。</span></li><li>            <span class="hljs-variable">cachedItems_</span>.<span class="hljs-title function_">pop</span>();</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-comment">//创建新的元素。</span></li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">listItem</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListItemNode</span>&gt;();</li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">textNode</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;();</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetTextContent</span>(<span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetFontSize</span>(<span class="hljs-number">16</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetPercentWidth</span>(<span class="hljs-number">1</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetHeight</span>(<span class="hljs-number">100</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetBackgroundColor</span>(<span class="hljs-number">0xFFfffacd</span>);</li><li>            <span class="hljs-variable">textNode</span>-&gt;<span class="hljs-title class_">SetTextAlign</span>(<span class="hljs-title class_">ARKUI_TEXT_ALIGNMENT_CENTER</span>);</li><li>            <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">AddChild</span>(<span class="hljs-title class_">textNode</span>);</li><li>            <span class="hljs-comment">//创建ListItem划出菜单。</span></li><li>            <span class="hljs-variable">auto</span> <span class="hljs-variable">swipeNode</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;();</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetTextContent</span>("<span class="hljs-title class_">del</span>");</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetFontSize</span>(<span class="hljs-number">16</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetFontColor</span>(<span class="hljs-number">0xFFFFFFFF</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetWidth</span>(<span class="hljs-number">100</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetHeight</span>(<span class="hljs-number">100</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetBackgroundColor</span>(<span class="hljs-number">0xFFFF0000</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">SetTextAlign</span>(<span class="hljs-title class_">ARKUI_TEXT_ALIGNMENT_CENTER</span>);</li><li>            <span class="hljs-variable">swipeNode</span>-&gt;<span class="hljs-title class_">RegisterOnClick</span>([<span class="hljs-keyword">this</span>, <span class="hljs-title class_">data</span> = <span class="hljs-title class_">data_</span>[<span class="hljs-title class_">index</span>]]() {</li><li>                <span class="hljs-variable">auto</span> <span class="hljs-variable">it</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">find</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">data_</span>.<span class="hljs-title class_">end</span>(), <span class="hljs-title class_">data</span>);</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable">it</span> != <span class="hljs-variable">data_</span>.<span class="hljs-title function_">end</span>()) {</li><li>                    <span class="hljs-variable">auto</span> <span class="hljs-variable">index</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">distance</span>(<span class="hljs-title class_">data_</span>.<span class="hljs-title class_">begin</span>(), <span class="hljs-title class_">it</span>);</li><li>                    <span class="hljs-title function_">RemoveItem</span>(<span class="hljs-variable">index</span>);</li><li>                }</li><li>            });</li><li>            <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">SetSwiperAction</span>(<span class="hljs-title class_">swipeNode</span>);</li><li>            <span class="hljs-variable">handle</span> = <span class="hljs-variable">listItem</span>-&gt;<span class="hljs-title class_">GetHandle</span>();</li><li>            <span class="hljs-comment">//保持文本列表项的引用。</span></li><li>            <span class="hljs-variable">items_</span>.<span class="hljs-title function_">emplace</span>(<span class="hljs-variable">handle</span>, <span class="hljs-variable">listItem</span>);</li><li>        }</li><li>        <span class="hljs-comment">//设置需要展示的元素。</span></li><li>        <span class="hljs-title function_">OH_ArkUI_NodeAdapterEvent_SetItem</span>(<span class="hljs-variable">event</span>, <span class="hljs-variable">handle</span>);</li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>ArkUIListItemAdapter中新增RemoveItem，用于删除数据源并且调用OH_ArkUI_NodeAdapter_RemoveItem接口通知框架刷新UI。</p>       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-scss" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListItemAdapter.h</span></li><li>class ArkUIListItemAdapter {</li><li>    <span class="hljs-comment">//...</span></li><li>    void <span class="hljs-built_in">RemoveItem</span>(size_t index) {</li><li>        <span class="hljs-comment">//删除第index个数据。</span></li><li>        data_<span class="hljs-selector-class">.erase</span>(data_.begin() + index);</li><li>        <span class="hljs-comment">//如果index会导致可视区域元素发生可见性变化，则会回调NODE_ADAPTER_EVENT_ON_REMOVE_NODE_FROM_ADAPTER事件删除元素，</span></li><li>        <span class="hljs-comment">//根据是否有新增元素回调NODE_ADAPTER_EVENT_ON_GET_NODE_ID和NODE_ADAPTER_EVENT_ON_ADD_NODE_TO_ADAPTER事件。</span></li><li>        <span class="hljs-built_in">OH_ArkUI_NodeAdapter_RemoveItem</span>(handle_, index, <span class="hljs-number">1</span>);</li><li>        <span class="hljs-comment">//更新新的数量。</span></li><li>        <span class="hljs-built_in">OH_ArkUI_NodeAdapter_SetTotalNodeCount</span>(handle_, data_.size());</li><li>    }</li><li>};</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用分组列表">使用分组列表<i class="anchor-icon anchor-icon-link" anchorid="使用分组列表" tips="复制节点链接"></i></h2>          <ol>      <li>分组列表使用ListItemGroup组件实现，ListItemGroup支持添加header、footer设置函数，支持使用懒加载。       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListItemGroupNode.h</span></li><li>
</li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMGROUPNODE_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_ARKUILISTITEMGROUPNODE_H</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUINode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListItemAdapter.h"</span></li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span>{</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListItemGroupNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-title function_">ArkUIListItemGroupNode</span>()</li><li>        : <span class="hljs-title class_">ArkUINode</span>((<span class="hljs-variable">NativeModuleInstance</span>::<span class="hljs-title class_">GetInstance</span>()-&gt;<span class="hljs-title class_">GetNativeNodeAPI</span>())-&gt;<span class="hljs-title class_">createNode</span>(<span class="hljs-title class_">ARKUI_NODE_LIST_ITEM_GROUP</span>)) {}</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetHeader</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">node</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">node</span>) {</li><li>            <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">object</span> = <span class="hljs-variable">node</span>-&gt;<span class="hljs-title class_">GetHandle</span>()};</li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ITEM_GROUP_SET_HEADER</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">resetAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ITEM_GROUP_SET_HEADER</span>);</li><li>        }</li><li>    }</li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetFooter</span>(<span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">node</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">node</span>) {</li><li>            <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">Item</span> = {.<span class="hljs-variable">object</span>= <span class="hljs-variable">node</span>-&gt;<span class="hljs-title class_">GetHandle</span>()};</li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ITEM_GROUP_SET_FOOTER</span>, &amp;<span class="hljs-title class_">Item</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">resetAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ITEM_GROUP_SET_FOOTER</span>);</li><li>        }</li><li>    }</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">GetHeader</span>() <span class="hljs-keyword">const</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">header_</span>;</li><li>    }</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">GetFooter</span>() <span class="hljs-keyword">const</span> {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-variable">footer_</span>;</li><li>    }</li><li>    <span class="hljs-comment">//引入懒加载模块。</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetLazyAdapter</span>(<span class="hljs-keyword">const</span> <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt; &amp;<span class="hljs-title class_">adapter</span>) {</li><li>        <span class="hljs-title function_">assert</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span>{<span class="hljs-variable">nullptr</span>,<span class="hljs-number">0</span>, <span class="hljs-variable">nullptr</span>, <span class="hljs-variable">adapter</span>-&gt;<span class="hljs-title class_">GetHandle</span>()};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_ITEM_GROUP_NODE_ADAPTER</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>        <span class="hljs-variable">adapter_</span> = <span class="hljs-variable">adapter</span>;</li><li>    }</li><li><span class="hljs-keyword">private</span>:</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">header_</span>;</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUINode</span>&gt; <span class="hljs-title class_">footer_</span>;</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt; <span class="hljs-title class_">adapter_</span>;</li><li>};</li><li>}<span class="hljs-comment">// namespace NativeModule</span></li><li>#<span class="hljs-variable">endif</span><span class="hljs-comment">//MYAPPLICATION_ARKUILISTITEMGROUPNODE_H</span></li></ol></pre></div></div></li>      <li>List组件设置吸顶。       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ArkUIListNode.h</span></li><li><span class="hljs-comment">//列表封装对象。</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ArkUIListNode</span> : <span class="hljs-keyword">public</span> <span class="hljs-title class_">ArkUINode</span>{</li><li>    <span class="hljs-comment">//...</span></li><li>    <span class="hljs-variable">void</span> <span class="hljs-title function_">SetSticky</span>(<span class="hljs-variable">ArkUI_StickyStyle</span> <span class="hljs-variable">style</span>) {</li><li>        <span class="hljs-title function_">assert</span>(<span class="hljs-variable">handle_</span>);</li><li>        <span class="hljs-variable">ArkUI_NumberValue</span> <span class="hljs-variable">value</span>[] = {{.<span class="hljs-variable">i32</span> = <span class="hljs-variable">style</span>}};</li><li>        <span class="hljs-variable">ArkUI_AttributeItem</span> <span class="hljs-variable">item</span> = {<span class="hljs-variable">value</span>, <span class="hljs-number">1</span>};</li><li>        <span class="hljs-variable">nativeModule_</span>-&gt;<span class="hljs-title class_">setAttribute</span>(<span class="hljs-title class_">handle_</span>, <span class="hljs-title class_">NODE_LIST_STICKY</span>, &amp;<span class="hljs-title class_">item</span>);</li><li>    }</li><li>};</li></ol></pre></div></div></li>      <li>List组件下使用ListItemGroup实现分组列表界面。       <div _ngcontent-eru-c106="" class="highlight-div"><div _ngcontent-eru-c106="" class="highlight-div-header"><div _ngcontent-eru-c106="" class="highlight-div-header-left"><div _ngcontent-eru-c106="" class="handle-button expand-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eru-c106="" class="highlight-div-header-right"><div _ngcontent-eru-c106="" class="handle-button ai-button"></div><div _ngcontent-eru-c106="" class="handle-button line-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eru-c106="" class="handle-button theme-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eru-c106="" class="handle-button copy-button"><div _ngcontent-eru-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eru-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// LazyTextListExample.h</span></li><li><span class="hljs-comment">//懒加载列表示例代码。</span></li><li>#<span class="hljs-variable">ifndef</span> <span class="hljs-variable">MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li><li>#<span class="hljs-variable">define</span> <span class="hljs-variable">MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIBaseNode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListNode.h"</span></li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"ArkUIListItemGroupNode.h"</span></li><li><span class="hljs-variable">namespace</span> <span class="hljs-variable">NativeModule</span> {</li><li><span class="hljs-variable">std</span>::<span class="hljs-title class_">shared_ptr</span>&lt;<span class="hljs-title class_">ArkUIBaseNode</span>&gt; <span class="hljs-title class_">CreateLazyTextListExample</span>() {</li><li><span class="hljs-comment">//创建组件并挂载</span></li><li><span class="hljs-comment">//1: 创建List组件。</span></li><li>    <span class="hljs-variable">auto</span> <span class="hljs-variable">list</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListNode</span>&gt;();</li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetPercentWidth</span>(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetPercentHeight</span>(<span class="hljs-number">1</span>);</li><li>    <span class="hljs-comment">//设置吸顶</span></li><li>    <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">SetSticky</span>(<span class="hljs-title class_">ARKUI_STICKY_STYLE_BOTH</span>);</li><li>    <span class="hljs-comment">//2: 创建ListItemGroup并挂载到List上。</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-variable">int32_t</span> <span class="hljs-variable">i</span> = <span class="hljs-number">0</span>; <span class="hljs-variable">i</span> &lt; <span class="hljs-number">3</span>; <span class="hljs-title class_">i</span>++) {</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">header</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUITextNode</span>&gt;();</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetTextContent</span>("<span class="hljs-title class_">header</span>");</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetFontSize</span>(<span class="hljs-number">16</span>);</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetPercentWidth</span>(<span class="hljs-number">1</span>);</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetHeight</span>(<span class="hljs-number">50</span>);</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetBackgroundColor</span>(<span class="hljs-number">0xFFDCDCDC</span>);</li><li>        <span class="hljs-variable">header</span>-&gt;<span class="hljs-title class_">SetTextAlign</span>(<span class="hljs-title class_">ARKUI_TEXT_ALIGNMENT_CENTER</span>);</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">listItemGroup</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListItemGroupNode</span>&gt;();</li><li>        <span class="hljs-variable">listItemGroup</span>-&gt;<span class="hljs-title class_">SetHeader</span>(<span class="hljs-title class_">header</span>);</li><li>        <span class="hljs-variable">auto</span> <span class="hljs-variable">adapter</span> = <span class="hljs-variable">std</span>::<span class="hljs-title class_">make_shared</span>&lt;<span class="hljs-title class_">ArkUIListItemAdapter</span>&gt;();</li><li>        <span class="hljs-variable">listItemGroup</span>-&gt;<span class="hljs-title class_">SetLazyAdapter</span>(<span class="hljs-title class_">adapter</span>);</li><li>        <span class="hljs-variable">list</span>-&gt;<span class="hljs-title class_">AddChild</span>(<span class="hljs-title class_">listItemGroup</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable">list</span>;</li><li>}</li><li>}<span class="hljs-comment">// namespace NativeModule</span></li><li>#<span class="hljs-variable">endif</span><span class="hljs-comment">// MYAPPLICATION_LAZYTEXTLISTEXAMPLE_H</span></li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>