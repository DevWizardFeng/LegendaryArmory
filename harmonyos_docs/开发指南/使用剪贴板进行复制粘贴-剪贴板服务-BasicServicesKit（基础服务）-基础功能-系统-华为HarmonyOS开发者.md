<h1 _ngcontent-anv-c119="" class="doc-title ng-star-inserted" title="使用剪贴板进行复制粘贴"> 使用剪贴板进行复制粘贴 </h1>

<div _ngcontent-anv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard" target="_blank">剪贴板</a>为开发者提供数据的复制粘贴能力。当需要使用复制粘贴等功能时，例如：复制文字内容到备忘录中粘贴，复制图库照片到文件管理粘贴，就可以通过剪贴板来完成。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>剪贴板内容包含剪贴板系统服务元数据和应用设置的数据，总大小上限默认为128MB，PC/2in1设备可通过系统配置修改上限，有效范围为128MB~2GB。</li>      <li>为保证剪贴板数据的准确性，同一时间只能支持一个复制操作。</li>      <li>API version 12及之后，系统为提升用户隐私安全保护能力，剪贴板读取接口增加<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/get-pastedata-permission-guidelines">权限管控</a>。</li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用基础数据类型进行复制粘贴">使用基础数据类型进行复制粘贴<i class="anchor-icon anchor-icon-link" anchorid="使用基础数据类型进行复制粘贴" tips="复制节点链接"></i></h2>          <p>剪贴板支持使用基础数据类型进行复制粘贴，当前支持的基础数据类型有文本、HTML、URI、Want、PixelMap。ArkTS接口与NDK接口支持数据类型不完全一致，使用时须匹配接口支持类型。</p>     <p>新开发的应用建议使用本方案实现复制粘贴功能。</p>    </div>    <div class="tiledSection">     <h3 id="arkts接口与ndk接口数据类型对应关系" class="firsth2">ArkTS接口与NDK接口数据类型对应关系<i class="anchor-icon anchor-icon-link" anchorid="arkts接口与ndk接口数据类型对应关系" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.1" valign="top" width="50%">ArkTS数据类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.2.1.3.1.2" valign="top" width="50%">NDK数据类型</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">MIMETYPE_PIXELMAP : "pixelMap"</td>         <td class="cellrowborder" valign="top" width="50%">UDMF_META_OPENHARMONY_PIXEL_MAP : "openharmony.pixel-map"</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MIMETYPE_TEXT_HTML : "text/html"</td>         <td class="cellrowborder" valign="top" width="50%">UDMF_META_HTML : "general.html"</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MIMETYPE_TEXT_PLAIN : "text/plain"</td>         <td class="cellrowborder" valign="top" width="50%">UDMF_META_PLAIN_TEXT : "general.plain-text"</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MIMETYPE_TEXT_URI : "text/uri"</td>         <td class="cellrowborder" valign="top" width="50%">UDMF_META_GENERAL_FILE_URI : "general.file-uri"</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">MIMETYPE_TEXT_WANT : "text/want"</td>         <td class="cellrowborder" valign="top" width="50%">NDK接口不支持该数据类型。</td>        </tr>             </tbody></table></div>     </div>     <p>ArkTS数据类型对应剪贴板类型，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard" target="_blank">ohos.pasteboard</a>。NDK数据类型对应统一数据管理框架，详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf" target="_blank">UDMF</a>。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3>          <p>详细接口见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard#getdata9" target="_blank">接口文档</a>。</p>     <p>使用剪贴板getData接口获取到uri类型数据之后，请使用文件管理的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-file-fs#fscopy11" target="_blank">fs.copy</a>接口获取文件。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.5.4.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">setData(data: PasteData, callback: AsyncCallback&lt;void&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">将数据写入系统剪贴板，使用callback异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setData(data: PasteData): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">将数据写入系统剪贴板，使用Promise异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getData( callback: AsyncCallback&lt;PasteData&gt;): void</td>         <td class="cellrowborder" valign="top" width="50%">读取系统剪贴板内容，使用callback异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getData(): Promise&lt;PasteData&gt;</td>         <td class="cellrowborder" valign="top" width="50%">读取系统剪贴板内容，使用Promise异步回调。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getDataSync(): PasteData</td>         <td class="cellrowborder" valign="top" width="50%">读取系统剪贴板内容, 此接口为同步接口，不能与SetData同线程调用。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h3>          <div _ngcontent-anv-c106="" class="highlight-div"><div _ngcontent-anv-c106="" class="highlight-div-header"><div _ngcontent-anv-c106="" class="highlight-div-header-left"><div _ngcontent-anv-c106="" class="handle-button expand-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-anv-c106="" class="highlight-div-header-right"><div _ngcontent-anv-c106="" class="handle-button ai-button"></div><div _ngcontent-anv-c106="" class="handle-button line-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-anv-c106="" class="handle-button theme-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-anv-c106="" class="handle-button copy-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-anv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, pasteboard } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">systemPasteboard</span>: pasteboard.<span class="hljs-property">SystemPasteboard</span> = pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>();</li><li><span class="hljs-comment">// ...</span></li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">setPlainData</span>(<span class="hljs-params">content: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>    <span class="hljs-keyword">let</span> pasteData = pasteboard.<span class="hljs-title function_">createData</span>(pasteboard.<span class="hljs-property">MIMETYPE_TEXT_PLAIN</span>, content);</li><li>    <span class="hljs-keyword">await</span> systemPasteboard.<span class="hljs-title function_">setData</span>(pasteData);</li><li>  }</li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">getPlainData</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-comment">// 从系统剪贴板中读取数据</span></li><li>    <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">await</span> systemPasteboard.<span class="hljs-title function_">getData</span>();</li><li>    <span class="hljs-comment">// 从剪贴板数据中获取条目数量</span></li><li>    <span class="hljs-keyword">let</span> recordCount = data.<span class="hljs-title function_">getRecordCount</span>();</li><li>    <span class="hljs-comment">// 从剪贴板数据中获取对应条目信息</span></li><li>    <span class="hljs-keyword">let</span> result = <span class="hljs-string">''</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; recordCount; i++) {</li><li>      <span class="hljs-keyword">let</span> record = data.<span class="hljs-title function_">getRecord</span>(i).<span class="hljs-title function_">toPlainText</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Get data success, record:'</span> + record);</li><li>      result += record;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>  }</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="使用统一数据类型进行复制粘贴">使用统一数据类型进行复制粘贴<i class="anchor-icon anchor-icon-link" anchorid="使用统一数据类型进行复制粘贴" tips="复制节点链接"></i></h2>          <p>为了方便剪贴板与其他应用间进行数据交互，减少数据类型适配的工作量，剪贴板支持使用统一数据对象进行复制粘贴。详细的统一数据对象请见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-unifieddatachannel" target="_blank">标准化数据通路</a>文档介绍。</p>     <p>剪贴板支持使用基础数据类型进行复制粘贴，当前支持的基础数据类型有文本、HTML。ArkTS接口与NDK接口支持的数据类型不完全一致，使用时需匹配对应接口所支持的类型。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-1" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-1" tips="复制节点链接"></i></h3>          <p>详细接口见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard#getunifieddata12" target="_blank">接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.8.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">setUnifiedData(data: udc.UnifiedData): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据对象的数据写入系统剪贴板。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setUnifiedDataSync(data: udc.UnifiedData): void</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据对象的数据写入系统剪贴板，此接口为同步接口。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getUnifiedData(): Promise&lt;udc.UnifiedData&gt;</td>         <td class="cellrowborder" valign="top" width="50%">从系统剪贴板中读取统一数据对象的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getUnifiedDataSync(): udc.UnifiedData</td>         <td class="cellrowborder" valign="top" width="50%">从系统剪贴板中读取统一数据对象的数据，此接口为同步接口。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="示例代码-1">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码-1" tips="复制节点链接"></i></h3>          <div _ngcontent-anv-c106="" class="highlight-div"><div _ngcontent-anv-c106="" class="highlight-div-header"><div _ngcontent-anv-c106="" class="highlight-div-header-left"><div _ngcontent-anv-c106="" class="handle-button expand-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-anv-c106="" class="highlight-div-header-right"><div _ngcontent-anv-c106="" class="handle-button ai-button"></div><div _ngcontent-anv-c106="" class="handle-button line-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-anv-c106="" class="handle-button theme-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-anv-c106="" class="handle-button copy-button"><div _ngcontent-anv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-anv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, pasteboard } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { unifiedDataChannel, uniformDataStruct, uniformTypeDescriptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">systemPasteboard</span>: pasteboard.<span class="hljs-property">SystemPasteboard</span> = pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>();</li><li><span class="hljs-comment">// ...</span></li><li>  <span class="hljs-comment">// 1.构造一条PlainText数据</span></li><li>  <span class="hljs-keyword">export</span> <span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">handleUniformData</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">plainText</span>: uniformDataStruct.<span class="hljs-property">PlainText</span> = {</li><li>      <span class="hljs-attr">uniformDataType</span>: uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>,</li><li>      <span class="hljs-attr">textContent</span>: <span class="hljs-string">'PLAINTEXT_CONTENT'</span>,</li><li>      <span class="hljs-attr">abstract</span>: <span class="hljs-string">'PLAINTEXT_ABSTRACT'</span>,</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">let</span> record = <span class="hljs-keyword">new</span> unifiedDataChannel.<span class="hljs-title class_">UnifiedRecord</span>(uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>, plainText);</li><li>    <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">new</span> unifiedDataChannel.<span class="hljs-title class_">UnifiedData</span>();</li><li>    data.<span class="hljs-title function_">addRecord</span>(record);</li><li>    <span class="hljs-comment">// 2.向系统剪贴板中存入一条PlainText数据</span></li><li>    systemPasteboard.<span class="hljs-title function_">setUnifiedData</span>(data).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: <span class="hljs-built_in">void</span></span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Succeeded in setting UnifiedData.'</span>);</li><li>      <span class="hljs-comment">// 存入成功，处理正常场景</span></li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to set UnifiedData. Cause: '</span> + err.<span class="hljs-property">message</span>);</li><li>      <span class="hljs-comment">// 处理异常场景</span></li><li>    });</li><li>    <span class="hljs-comment">// 3.从系统剪贴板中读取这条text数据</span></li><li>    systemPasteboard.<span class="hljs-title function_">getUnifiedData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">records</span>: unifiedDataChannel.<span class="hljs-property">UnifiedRecord</span>[] = data.<span class="hljs-title function_">getRecords</span>();</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> j = <span class="hljs-number">0</span>; j &lt; records.<span class="hljs-property">length</span>; j++) {</li><li>        <span class="hljs-keyword">if</span> (records[j].<span class="hljs-title function_">getType</span>() === uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>) {</li><li>          <span class="hljs-keyword">let</span> text = records[j].<span class="hljs-title function_">getValue</span>() <span class="hljs-keyword">as</span> uniformDataStruct.<span class="hljs-property">PlainText</span>;</li><li>          hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">`<span class="hljs-subst">${j + <span class="hljs-number">1</span>}</span>.<span class="hljs-subst">${text.textContent}</span>`</span>);</li><li>        }</li><li>      }</li><li>    }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to get UnifiedData. Cause: '</span> + err.<span class="hljs-property">message</span>);</li><li>      <span class="hljs-comment">// 处理异常场景</span></li><li>    });</li><li>  }</li></ol></pre></div></div>    </div>   </div>   <div></div></div>