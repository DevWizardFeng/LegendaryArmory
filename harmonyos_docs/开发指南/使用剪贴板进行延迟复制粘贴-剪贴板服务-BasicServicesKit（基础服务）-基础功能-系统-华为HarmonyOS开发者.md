<h1 _ngcontent-nst-c119="" class="doc-title ng-star-inserted" title="使用剪贴板进行延迟复制粘贴"> 使用剪贴板进行延迟复制粘贴 </h1>

<div _ngcontent-nst-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2>          <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-pasteboard" target="_blank">剪贴板服务</a>主要提供管理系统剪贴板的能力，为系统复制、粘贴功能提供支持。</p>     <p>反复执行复制操作时，剪贴板缓存中会存储多余数据从而导致内存增加，为了优化内存以及后续支持指定数据类型粘贴，剪贴板提供了延迟复制粘贴的功能。</p>     <p>用户复制使用延迟复制技术的应用内的数据时，该条真实数据不会立即写入剪贴板服务的缓存中，而是等需要粘贴时，再从应用获取数据。</p>    </div>    <div class="tiledSection">     <h2 id="约束限制">约束限制<i class="anchor-icon anchor-icon-link" anchorid="约束限制" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>剪贴板内容包含剪贴板系统服务元数据和应用设置的数据，总大小上限默认为128MB，PC/2in1设备可通过系统配置修改上限，有效范围为128MB~2GB。</p></li>      <li>       <p>NDK接口仅支持Record级别的延迟复制粘贴。</p></li>      <li>       <p>ArkTS接口仅支持PasteData级别的延迟复制粘贴（不建议使用）。</p></li>      <li>       <p>当复制的数据量较小且准备数据所需时间不会影响用户体验时，不建议应用程序使用延迟复制功能，推荐将数据直接写入剪贴板。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用基于record级别的延迟复制粘贴推荐">使用基于Record级别的延迟复制粘贴（推荐）<i class="anchor-icon anchor-icon-link" anchorid="使用基于record级别的延迟复制粘贴推荐" tips="复制节点链接"></i></h2>          <p>本方案可以在粘贴前查询数据type信息，应用可以据此决定是否向剪贴板请求数据，因此建议使用本方案实现延迟复制功能。</p>     <p>从API version 21开始，应用退出不仅可以调用延迟复制接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_setdata" target="_blank">OH_Pasteboard_SetData</a>主动提交所有复制数据，还可以使用同步延迟数据接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_syncdelayeddataasync" target="_blank">OH_Pasteboard_SyncDelayedDataAsync</a>通知剪贴板获取全量数据。</p>     <ol>      <li>       <p>当应用使用延迟复制功能复制时，仅将应用支持的数据类型写入剪贴板。应用应在退出时，重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_setdata" target="_blank">OH_Pasteboard_SetData</a>接口主动提交所有复制数据或调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_syncdelayeddataasync" target="_blank">OH_Pasteboard_SyncDelayedDataAsync</a>接口通知剪贴板获取全量数据，等待数据同步完成再继续退出，否则可能导致其他应用粘贴获取不到数据。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_syncdelayeddataasync" target="_blank">OH_Pasteboard_SyncDelayedDataAsync</a>接口会延长退出过程，建议应用在复制数据时直接设置数据到剪贴板，而不是调用延迟复制接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf-h#oh_udmfrecordprovider_setdata" target="_blank">OH_UdmfRecordProvider_SetData</a>和同步延迟数据接口<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_syncdelayeddataasync" target="_blank">OH_Pasteboard_SyncDelayedDataAsync</a>。</p></li>      <li>       <p>延迟复制场景应用异常退出时，无法触发应用退出延迟数据同步流程，会导致其他应用粘贴时获取不到数据。</p></li>     </ol>    </div>    <div class="tiledSection">     <h3 id="接口说明" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3>          <p>详细接口见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-pasteboard" target="_blank">Pasteboard文档</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-udmf" target="_blank">UDMF接口文档</a>。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfRecordProvider* OH_UdmfRecordProvider_Create()</td>         <td class="cellrowborder" valign="top" width="50%">创建一个指向统一数据提供者的指针。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecordProvider_SetData(OH_UdmfRecordProvider* provider, void* context, const OH_UdmfRecordProvider_GetData callback, const UdmfData_Finalize finalize)</td>         <td class="cellrowborder" valign="top" width="50%">设置统一数据提供者的回调函数。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_UdmfRecord_SetProvider(OH_UdmfRecord* pThis, const char* const* types, unsigned int count, OH_UdmfRecordProvider* provider)</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据提供者配置到OH_UdmfRecord中。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">int OH_Pasteboard_SetData(OH_Pasteboard* pasteboard, OH_UdmfData* data)</td>         <td class="cellrowborder" valign="top" width="50%">向剪贴板中写入数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfData * OH_Pasteboard_GetData(OH_Pasteboard* pasteboard, int* status)</td>         <td class="cellrowborder" valign="top" width="50%">获取剪贴板中的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">OH_UdmfRecord** OH_UdmfData_GetRecords(OH_UdmfData* pThis, unsigned int* count)</td>         <td class="cellrowborder" valign="top" width="50%">获取OH_UdmfData中全部的数据记录。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">void OH_Pasteboard_SyncDelayedDataAsync(OH_Pasteboard* pasteboard, void (*callback)(int errorCode))</td>         <td class="cellrowborder" valign="top" width="50%">通知剪贴板从应用同步所有延迟数据。 当应用使用延迟复制功能复制时，仅将应用支持的数据类型写入剪贴板。应用应在退出时，重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_setdata" target="_blank">OH_Pasteboard_SetData</a>接口主动提交所有复制数据或调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-pasteboard-h#oh_pasteboard_syncdelayeddataasync" target="_blank">OH_Pasteboard_SyncDelayedDataAsync</a>接口通知剪贴板获取全量数据，等待数据同步完成再继续退出，否则可能导致其他应用粘贴获取不到数据。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <p>下面以纯文本类型和HTML类型数据为例，说明如何向剪贴板服务设置延迟复制数据。</p>     <p>为了代码可读性，代码中省略了各个步骤操作结果的校验，实际开发中需要确认每次调用的成功。</p>     <ol>      <li>       <p>引用头文件。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;cstring&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/pasteboard/oh_pasteboard.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/udmf.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/uds.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;database/udmf/udmf_meta.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;accesstoken/ability_access_control.h&gt;</span></span></li></ol></pre></div></div></li>      <li>       <p>定义OH_UdmfRecordProvider的数据提供函数和实例注销回调函数。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 1. 获取数据时触发的提供剪贴板数据的回调函数。</span></li><li><span class="hljs-type">void</span>* <span class="hljs-title function_">GetDataCallback</span><span class="hljs-params">(<span class="hljs-type">void</span>* context, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* type)</span></li><li>{</li><li>    <span class="hljs-comment">// 纯文本类型</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">memcmp</span>(type, UDMF_META_PLAIN_TEXT, <span class="hljs-keyword">sizeof</span>(UDMF_META_PLAIN_TEXT) - <span class="hljs-number">1</span>) == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 创建纯文本类型的Uds对象。</span></li><li>        OH_UdsPlainText* udsText = OH_UdsPlainText_Create();</li><li>        <span class="hljs-comment">// 设置纯文本内容。</span></li><li>        OH_UdsPlainText_SetContent(udsText, <span class="hljs-string">"hello world"</span>);</li><li>        <span class="hljs-keyword">return</span> udsText;</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(type, UDMF_META_HTML) == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 创建HTML类型的Uds对象。</span></li><li>        OH_UdsHtml* udsHtml = OH_UdsHtml_Create();</li><li>        <span class="hljs-comment">// 设置HTML内容。</span></li><li>        OH_UdsHtml_SetContent(udsHtml, <span class="hljs-string">"&lt;div&gt;hello world&lt;/div&gt;"</span>);</li><li>        <span class="hljs-keyword">return</span> udsHtml;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> nullptr;</li><li>}</li><li><span class="hljs-comment">// 2. OH_UdmfRecordProvider销毁时触发的回调函数。</span></li><li><span class="hljs-type">void</span> <span class="hljs-title function_">ProviderFinalizeCallback</span><span class="hljs-params">(<span class="hljs-type">void</span>* context)</span></li><li>{</li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"OH_UdmfRecordProvider finalize."</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>定义OH_Pasteboard_SyncDelayedDataAsync的回调函数。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 3. 定义应用退出时调用延迟同步接口触发的回调函数。</span></li><li><span class="hljs-type">void</span> <span class="hljs-title function_">SyncCallback</span><span class="hljs-params">(<span class="hljs-type">int</span> errorCode)</span></li><li>{</li><li>    <span class="hljs-comment">// 继续退出</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>在剪贴板中准备延迟复制数据。此步骤完成后纯文本类型数据与HTML类型数据并未真正写入剪贴板服务，只有当数据使用者从OH_UdmfRecord中获取OH_UdsPlainText或OH_UdsHtml时，才会触发上文定义的GetDataCallback数据提供函数，从中得到数据。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>OH_Pasteboard* <span class="hljs-title function_">CreateAndSetPasteboardData</span><span class="hljs-params">()</span></li><li>{</li><li>    <span class="hljs-comment">// 4. 创建OH_UdmfRecord对象。</span></li><li>    OH_UdmfRecord* record = OH_UdmfRecord_Create();</li><li>    <span class="hljs-comment">// 5. 创建OH_UdmfRecordProvider对象，并设置用于提供延迟数据、析构的两个回调函数。</span></li><li>    OH_UdmfRecordProvider* provider = OH_UdmfRecordProvider_Create();</li><li>    OH_UdmfRecordProvider_SetData(provider, (<span class="hljs-type">void</span> *)record, GetDataCallback, ProviderFinalizeCallback);</li><li>    <span class="hljs-comment">// 6. 将provider绑定到record，并设置支持的数据类型。</span></li><li>    <span class="hljs-meta">#<span class="hljs-keyword">define</span> TYPE_COUNT 2</span></li><li>    <span class="hljs-type">const</span> <span class="hljs-type">char</span>* types[TYPE_COUNT] = {UDMF_META_PLAIN_TEXT, UDMF_META_HTML};</li><li>    OH_UdmfRecord_SetProvider(record, types, TYPE_COUNT, provider);</li><li>    <span class="hljs-comment">// 7. 创建OH_UdmfData对象，并向OH_UdmfData中添加OH_UdmfRecord。</span></li><li>    OH_UdmfData* setData = OH_UdmfData_Create();</li><li>    <span class="hljs-keyword">if</span> (setData != nullptr) {</li><li>        OH_UdmfData_AddRecord(setData, record);</li><li>    }</li><li>    <span class="hljs-comment">// 8. 创建OH_Pasteboard对象，将数据写入剪贴板中。</span></li><li>    OH_Pasteboard* pasteboard = OH_Pasteboard_Create();</li><li>    <span class="hljs-keyword">if</span> (setData != nullptr) {</li><li>        OH_Pasteboard_SetData(pasteboard, setData);</li><li>    }</li><li>    OH_UdmfRecordProvider_Destroy(provider);</li><li>    OH_UdmfRecord_Destroy(record);</li><li>    OH_UdmfData_Destroy(setData);</li><li>    <span class="hljs-keyword">return</span> pasteboard;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>从剪贴板获取延迟复制数据。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-type">void</span> <span class="hljs-title function_">ProcessRecordType</span><span class="hljs-params">(OH_UdmfRecord* record, <span class="hljs-type">const</span> <span class="hljs-type">char</span>* recordType)</span></li><li>{</li><li>    OH_UdsPlainText* udsText = nullptr;</li><li>    OH_UdsHtml* udsHtml = nullptr;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(recordType, UDMF_META_PLAIN_TEXT) == <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-comment">// 创建纯文本类型的Uds对象</span></li><li>        udsText = OH_UdsPlainText_Create();</li><li>        <span class="hljs-keyword">if</span> (udsText != nullptr) {</li><li>            <span class="hljs-comment">// 从record中获取纯文本类型的Uds对象</span></li><li>            OH_UdmfRecord_GetPlainText(record, udsText);</li><li>            <span class="hljs-comment">// 从Uds对象中获取内容</span></li><li>            <span class="hljs-type">const</span> <span class="hljs-type">char</span>* content = OH_UdsPlainText_GetContent(udsText);</li><li>        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">strcmp</span>(recordType, UDMF_META_HTML) == <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-comment">// 创建HTML类型的Uds对象</span></li><li>            udsHtml = OH_UdsHtml_Create();</li><li>            <span class="hljs-keyword">if</span> (udsHtml != nullptr) {</li><li>                <span class="hljs-comment">// 从record中获取HTML类型的Uds对象</span></li><li>                OH_UdmfRecord_GetHtml(record, udsHtml);</li><li>                <span class="hljs-comment">// 从Uds对象中获取内容</span></li><li>                <span class="hljs-type">const</span> <span class="hljs-type">char</span>* content = OH_UdsHtml_GetContent(udsHtml);</li><li>            }</li><li>        }</li><li>    }</li><li>}</li><li><span class="hljs-type">void</span> <span class="hljs-title function_">ProcessRecord</span><span class="hljs-params">(OH_UdmfRecord* record)</span></li><li>{</li><li>    <span class="hljs-comment">// 13. 查询OH_UdmfRecord中的数据类型。</span></li><li>    <span class="hljs-type">unsigned</span> typeCount = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">char</span>** recordTypes = OH_UdmfRecord_GetTypes(record, &amp;typeCount);</li><li>    <span class="hljs-comment">// 14. 遍历数据类型。</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> typeIndex = <span class="hljs-number">0</span>; typeIndex &lt; typeCount; ++typeIndex) {</li><li>        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* recordType = recordTypes[typeIndex];</li><li>        ProcessRecordType(record, recordType);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-type">static</span> napi_value <span class="hljs-title function_">NAPI_Pasteboard_time</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></li><li>{</li><li>    OH_Pasteboard* pasteboard = CreateAndSetPasteboardData();</li><li>    <span class="hljs-comment">// 9. 记录当前的剪贴板数据变化次数。</span></li><li>    <span class="hljs-type">uint32_t</span> changeCount = OH_Pasteboard_GetChangeCount(pasteboard);</li><li>
</li><li>    <span class="hljs-comment">// 10. 从剪贴板获取OH_UdmfData。</span></li><li>    <span class="hljs-type">int</span> status = <span class="hljs-number">-1</span>;</li><li>    <span class="hljs-type">bool</span> hasPermission = OH_AT_CheckSelfPermission(<span class="hljs-string">"ohos.permission.READ_PASTEBOARD"</span>);</li><li>    <span class="hljs-keyword">if</span> (!hasPermission) {</li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"No Permission READ_PASTEBOARD"</span>);</li><li>    };</li><li>    OH_UdmfData* getData = OH_Pasteboard_GetData(pasteboard, &amp;status);</li><li>    <span class="hljs-keyword">if</span> (getData == nullptr) {</li><li>        <span class="hljs-comment">// 处理错误情况，清理资源</span></li><li>        OH_LOG_ERROR(LOG_APP, <span class="hljs-string">"Failed to get data from pasteboard, status: %d\n"</span>, status);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 11. 获取OH_UdmfData中的所有OH_UdmfRecord。</span></li><li>    <span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordCount = <span class="hljs-number">0</span>;</li><li>    OH_UdmfRecord** getRecords = OH_UdmfData_GetRecords(getData, &amp;recordCount);</li><li>    OH_UdsPlainText* udsText = nullptr;</li><li>    OH_UdsHtml* udsHtml = nullptr;</li><li>
</li><li>    <span class="hljs-comment">// 12. 遍历OH_UdmfRecord。</span></li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-type">unsigned</span> <span class="hljs-type">int</span> recordIndex = <span class="hljs-number">0</span>; recordIndex &lt; recordCount; ++recordIndex) {</li><li>        OH_UdmfRecord* record = getRecords[recordIndex];</li><li>        ProcessRecord(record);</li><li>    }</li></ol></pre></div></div></li>      <li>       <p>应用退出时，如果剪贴板内的数据没有变化，则通知剪贴板获取全量数据，等待回调完成再继续退出，否则可能导致其他应用粘贴获取不到数据。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 15. 查询剪贴板内的数据是否变化。</span></li><li><span class="hljs-type">uint32_t</span> newChangeCount = OH_Pasteboard_GetChangeCount(pasteboard);</li><li><span class="hljs-keyword">if</span> (newChangeCount == changeCount) {</li><li>    <span class="hljs-comment">// 16. 通知剪贴板获取全量数据。</span></li><li>    OH_Pasteboard_SyncDelayedDataAsync(pasteboard, SyncCallback);</li><li>    <span class="hljs-comment">// 需要等待SyncCallback回调完成再继续退出</span></li><li>} <span class="hljs-keyword">else</span> {</li><li>    <span class="hljs-comment">// 继续退出</span></li><li>    OH_LOG_INFO(LOG_APP, <span class="hljs-string">"No newChangeCount in pasteboard."</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用完毕后需要及时释放相关对象的内存。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="c prettyprint linenums hljs language-c" hw-language="c" data-highlighted="yes"><ol class="linenums"><li>    OH_UdsPlainText_Destroy(udsText);</li><li>    OH_UdsHtml_Destroy(udsHtml);</li><li>    OH_UdmfData_Destroy(getData);</li><li>    OH_Pasteboard_Destroy(pasteboard);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="使用基于pastedata级别的延迟复制粘贴不建议使用">使用基于PasteData级别的延迟复制粘贴（不建议使用）<i class="anchor-icon anchor-icon-link" anchorid="使用基于pastedata级别的延迟复制粘贴不建议使用" tips="复制节点链接"></i></h2>          <p>本方案不支持粘贴前对数据type的查询。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-1" class="firsth2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.2.1.3.1.2" valign="top" width="50%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">setUnifiedData(data: unifiedDataChannel.UnifiedData): Promise&lt;void&gt;</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据类型的数据写入系统剪贴板，在使用延迟复制粘贴功能时，不可与getUnifiedDataSync同线程调用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setUnifiedDataSync(data: unifiedDataChannel.UnifiedData): void</td>         <td class="cellrowborder" valign="top" width="50%">将统一数据类型的数据写入系统剪贴板，此接口为同步接口，在使用延迟复制粘贴功能时，不可与getUnifiedDataSync同线程调用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getUnifiedData(): Promise&lt;unifiedDataChannel.UnifiedData&gt;</td>         <td class="cellrowborder" valign="top" width="50%">从系统剪贴板中读取统一数据类型的数据。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">getUnifiedDataSync(): unifiedDataChannel.UnifiedData</td>         <td class="cellrowborder" valign="top" width="50%">从系统剪贴板中读取统一数据类型的数据，此接口为同步接口，在使用延迟复制粘贴功能时，不可与setUnifiedData和setUnifiedDataSync同线程调用。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">setAppShareOptions(shareOptions: ShareOption): void</td>         <td class="cellrowborder" valign="top" width="50%">应用设置本应用剪贴板数据的可粘贴范围。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="50%">removeAppShareOptions(): void</td>         <td class="cellrowborder" valign="top" width="50%">应用删除本应用设置的剪贴板数据可粘贴范围配置。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="开发步骤-1">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-1" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>导入pasteboard,unifiedDataChannel和uniformTypeDescriptor模块。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span>, pasteboard } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { unifiedDataChannel, uniformDataStruct, uniformTypeDescriptor } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">systemPasteboard</span>: pasteboard.<span class="hljs-property">SystemPasteboard</span> = pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>();</li></ol></pre></div></div></li>      <li>       <p>构造一条PlainText数据,并书写获取延时数据的函数。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> plainTextData = <span class="hljs-keyword">new</span> unifiedDataChannel.<span class="hljs-title class_">UnifiedData</span>();</li><li><span class="hljs-keyword">let</span> getDelayPlainText = (<span class="hljs-function">(<span class="hljs-params">dataType: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>  <span class="hljs-keyword">let</span> plainText = <span class="hljs-keyword">new</span> unifiedDataChannel.<span class="hljs-title class_">PlainText</span>();</li><li>  plainText.<span class="hljs-property">details</span> = {</li><li>    <span class="hljs-title class_">Key</span>: <span class="hljs-string">'delayPlaintext'</span>,</li><li>    <span class="hljs-title class_">Value</span>: <span class="hljs-string">'delayPlaintext'</span>,</li><li>  };</li><li>  plainText.<span class="hljs-property">textContent</span> = <span class="hljs-string">'delayTextContent'</span>;</li><li>  plainText.<span class="hljs-property">abstract</span> = <span class="hljs-string">'delayTextContent'</span>;</li><li>  plainTextData.<span class="hljs-title function_">addRecord</span>(plainText);</li><li>  <span class="hljs-keyword">return</span> plainTextData;</li><li>});</li></ol></pre></div></div></li>      <li>       <p>向系统剪贴板中存入一条PlainText数据。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> <span class="hljs-title function_">setDelayPlainText</span> = (<span class="hljs-params"></span>) =&gt; {</li><li>  plainTextData.<span class="hljs-property">properties</span>.<span class="hljs-property">shareOptions</span> = unifiedDataChannel.<span class="hljs-property">ShareOptions</span>.<span class="hljs-property">CROSS_APP</span>;</li><li>  <span class="hljs-comment">// 跨应用使用时设置为CROSS_APP，本应用内使用时设置为IN_APP</span></li><li>  plainTextData.<span class="hljs-property">properties</span>.<span class="hljs-property">getDelayData</span> = getDelayPlainText;</li><li>  pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>().<span class="hljs-title function_">setUnifiedData</span>(plainTextData).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Succeeded in set PlainText.'</span>);</li><li>    <span class="hljs-comment">// 存入成功，处理正常场景</span></li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to set PlainText. Cause: '</span> + error.<span class="hljs-property">message</span>);</li><li>    <span class="hljs-comment">// 处理异常场景</span></li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>从系统剪贴板中读取这条text数据。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> getPlainTextUnifiedData = (<span class="hljs-function">() =&gt;</span> {</li><li>  pasteboard.<span class="hljs-title function_">getSystemPasteboard</span>().<span class="hljs-title function_">getUnifiedData</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">let</span> outputData = data;</li><li>    <span class="hljs-keyword">let</span> records = outputData.<span class="hljs-title function_">getRecords</span>();</li><li>    <span class="hljs-keyword">if</span> (records[<span class="hljs-number">0</span>].<span class="hljs-title function_">getType</span>() == uniformTypeDescriptor.<span class="hljs-property">UniformDataType</span>.<span class="hljs-property">PLAIN_TEXT</span>) {</li><li>      <span class="hljs-keyword">let</span> record = records[<span class="hljs-number">0</span>] <span class="hljs-keyword">as</span> unifiedDataChannel.<span class="hljs-property">PlainText</span>;</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'GetPlainText success, type:'</span> + records[<span class="hljs-number">0</span>].<span class="hljs-title function_">getType</span>());</li><li>      <span class="hljs-comment">// 注意：用户复制的数据内容属于敏感信息，禁止应用程序使用日志明文打印从剪贴板获取到的数据内容。</span></li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Get Plain Text Data No Success, Type is: '</span> + records[<span class="hljs-number">0</span>].<span class="hljs-title function_">getType</span>());</li><li>    }</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to get PlainTextUnifiedData. Cause: '</span> + error.<span class="hljs-property">message</span>);</li><li>    <span class="hljs-comment">// 处理异常场景</span></li><li>  })</li><li>})</li></ol></pre></div></div></li>      <li>       <p>应用设置本应用剪贴板数据的可粘贴范围。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  systemPasteboard.<span class="hljs-title function_">setAppShareOptions</span>(pasteboard.<span class="hljs-property">ShareOption</span>.<span class="hljs-property">LOCALDEVICE</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Set app share options success.'</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to Set app share options. Cause: '</span> + err.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-comment">// 处理异常场景</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>应用删除本应用设置的剪贴板数据可粘贴范围配置。</p>       <div _ngcontent-nst-c106="" class="highlight-div"><div _ngcontent-nst-c106="" class="highlight-div-header"><div _ngcontent-nst-c106="" class="highlight-div-header-left"><div _ngcontent-nst-c106="" class="handle-button expand-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-nst-c106="" class="highlight-div-header-right"><div _ngcontent-nst-c106="" class="handle-button ai-button"></div><div _ngcontent-nst-c106="" class="handle-button line-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-nst-c106="" class="handle-button theme-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-nst-c106="" class="handle-button copy-button"><div _ngcontent-nst-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-nst-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  systemPasteboard.<span class="hljs-title function_">removeAppShareOptions</span>();</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Remove app share options success.'</span>);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0xFF00</span>, <span class="hljs-string">'[Sample_pasteboard]'</span>, <span class="hljs-string">'Failed to Remove app share options. Cause: '</span> + err.<span class="hljs-property">message</span>);</li><li>  <span class="hljs-comment">// 处理异常场景</span></li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>