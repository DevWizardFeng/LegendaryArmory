<h1 _ngcontent-gec-c119="" class="doc-title ng-star-inserted" title="使用华为账号登录（必选）"> 使用华为账号登录（必选） </h1>

<div _ngcontent-gec-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>接入后，华为平台会将HarmonyOS 4及以下游戏的玩家标识playerId/openId赋值给HarmonyOS 5.0及以上游戏的玩家标识gamePlayerId，为新老系统游戏的账号资产（角色、区服信息、游戏进度等）实现互通。互通前后，华为账号ID不会发生变化，也不涉及开发者服务器和数据库层面的变动。</p> <p>使用华为账号登录的网络游戏，华为账号的实名认证、未成年人防沉迷由基础游戏服务实现，华为账号的支付合规控制（例如未成年人支付限额）由IAP Kit（应用内支付服务）实现。</p> <div class="tiledSection"><h2 id="section19921144816517">接入策略<i class="anchor-icon anchor-icon-link" anchorid="section19921144816517" tips="复制节点链接"></i></h2><p>游戏必须接入华为账号登录。</p> </div> <div class="tiledSection"><h2 id="section818512085410">开发准备<i class="anchor-icon anchor-icon-link" anchorid="section818512085410" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section13243172782312" class="firsth2">创建游戏<i class="anchor-icon anchor-icon-link" anchorid="section13243172782312" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p14583100125519">在华为应用市场发布游戏，要求前往AppGallery Connect创建游戏类应用，具体操作请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-create-app-0000002247955506" target="_blank">创建HarmonyOS应用</a>。其中：</p> <ul id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_ul193371138195813"><li id="zh-cn_topic_0000002385861065_li16337183818589">“应用类型”：选择“HarmonyOS应用”。</li><li id="zh-cn_topic_0000002385861065_li1733713810589">“应用分类”：选择“游戏”。</li></ul> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p69611011125713">用于正式上架的游戏包名建议不要包含test、dev等信息。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section11331193420240">申请版署实名认证<i class="anchor-icon anchor-icon-link" anchorid="section11331193420240" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002452599310__p22941540114419">按照版署《关于开展网络游戏防沉迷实名认证系统接口对接工作的通知》，各游戏出版运营企业均要求在2021年6月1日前完成接入<a href="https://wlc.nppa.gov.cn/fcm_company/index.html#/login?redirect=/" target="_blank">网络游戏防沉迷实名认证系统</a>，并获取“bizID（游戏备案识别码）”，再将bizID配置到AppGallery Connect，华为将为游戏自动对接国家新闻出版署的实名认证系统并开启强制实名认证，开发者无需进行额外的开发。具体操作请参见<a href="https://developer.huawei.com/consumer/cn/doc/games-guides/game-center-identification-applyfor-0000002392353221" target="_blank">版署实名认证申请</a>。</p> </div> <div class="tiledSection"><h3 id="section7479151102812">申请备案<i class="anchor-icon anchor-icon-link" anchorid="section7479151102812" tips="复制节点链接"></i></h3><p>请参考<a href="https://developer.huawei.com/consumer/cn/doc/App/50130" target="_blank">APP备案FAQ</a>完成游戏备案。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>HarmonyOS 4及以下游戏与HarmonyOS 5.0及以上游戏要求分别申请备案。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section3930231192311">生成签名证书<i class="anchor-icon anchor-icon-link" anchorid="section3930231192311" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p01071448135718">数字证书和Profile文件等签名信息可以确保游戏的完整性：</p> <ul id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002279275420_zh-cn_topic_0000002385861065_ul932175510581"><li id="zh-cn_topic_0000002279275420_zh-cn_topic_0000002385861065_li1032135517588">调试阶段：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section297715173233" target="_blank">手动签名</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-debug-cert-0000002283256797" target="_blank">申请调试证书</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-debug-profile-0000002248181278" target="_blank">申请调试Profile</a>。</li><li id="zh-cn_topic_0000002279275420_zh-cn_topic_0000002385861065_li1647610235919">发布阶段：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ide-signing#section297715173233" target="_blank">手动签名</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-release-cert-0000002283336729" target="_blank">申请发布证书</a>、<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-release-profile-0000002248341090" target="_blank">申请发布Profile</a>。</li></ul> </div> <div class="tiledSection"><h3 id="section205943551234">配置签名证书指纹<i class="anchor-icon anchor-icon-link" anchorid="section205943551234" tips="复制节点链接"></i></h3><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p123590396535">AppGallery Connect会自动生成证书对应的公钥信息，并计算出对应的SHA256指纹。开发者前往AppGallery Connect获取并配置SHA256指纹，且每个游戏至多添加4个签名证书指纹，配置签名证书指纹的具体操作请参见<a href="https://developer.huawei.com/consumer/cn/doc/app/agc-help-cert-fingerprint-0000002278002933" target="_blank">配置公钥指纹</a>。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p698615514914">请在调试阶段添加调试证书对应的指纹，在发布阶段添加发布证书对应的指纹。</p> </div></div></div> </div> <div class="tiledSection"><h3 id="section7658201162412">配置APP ID和Client ID<i class="anchor-icon anchor-icon-link" anchorid="section7658201162412" tips="复制节点链接"></i></h3><ol id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_ol465374784615"><li id="zh-cn_topic_0000002385861065_li13661164319451">登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“开发与服务”下选择项目及项目下的游戏，获取“应用”下的APP ID和Client ID。<p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p19912854315"><span><img originheight="544" originwidth="1304" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.45060950176200235310208762505279:50001231000000:2800:CC91A26483568941E87A008F4C832BB928E5058B3358E66F53436482B085F040.png" width="920" height="383.8036809815951"></span></p> </li><li id="zh-cn_topic_0000002385861065_li8636653203411">在工程的entry模块module.json5文件中，新增metadata并配置client_id和app_id，同时新增requestPermissions以配置网络权限。如下所示：<div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_screen859849122816" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-string">"module"</span></span><span class="">: </span>{</li><li>  <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"entry"</span></span><span class="">,</span></li><li>  <span class=""><span class="hljs-string">"type"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxx"</span></span><span class="">,</span></li><li>  <span class=""><span class="hljs-string">"description"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxxx"</span></span><span class="">,</span></li><li><span class="">  <span class="hljs-string">"mainElement"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxxx"</span></span><span class="">,</span></li><li>  <span class=""><span class="hljs-string">"deviceTypes"</span></span><span class="">: </span>[]<span class="">,</span></li><li>  <span class=""><span class="hljs-string">"pages"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxxx"</span></span><span class="">,</span></li><li>  <span class=""><span class="hljs-string">"abilities"</span></span><span class="">: </span>[]<span class="">,</span></li><li><span class="">  <span class="hljs-string">"metadata"</span></span><span class="">: </span>[ <span class=""><span class="hljs-comment">/</span></span><span class=""><span class="hljs-comment">/ </span></span><span class=""><span class="hljs-comment">配置如下信息</span></span></li><li>    {</li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"client_id"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"value"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxxxxx"</span></span> <span class="hljs-comment">// 配置为前面步骤中获取的Client ID</span></li><li>    },</li><li>    {</li><li>      <span class=""><span class="hljs-string">"name"</span></span><span class="">: </span><span class=""><span class="hljs-string">"app_id"</span></span><span class="">,</span></li><li>      <span class=""><span class="hljs-string">"value"</span></span><span class="">: </span><span class=""><span class="hljs-string">"xxxxxx"</span></span> <span class="hljs-comment">// 配置为前面步骤中获取的APP ID</span></li><li>    }</li><li>  ],</li><li>  <span class="hljs-string">"requestPermissions"</span>: [ <span class="hljs-comment">// 配置网络权限</span></li><li>    {</li><li>      <span class="hljs-string">"name"</span>: <span class="hljs-string">"ohos.permission.INTERNET"</span></li><li>    }</li><li>  ]</li><li>}</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h3 id="section3907114313255">配置APP ID映射关系<i class="anchor-icon anchor-icon-link" anchorid="section3907114313255" tips="复制节点链接"></i></h3><p>由于要求实现HarmonyOS 5.0及以上系统和HarmonyOS 4及以下系统上游戏内资产互通，用户登录新系统游戏时需要找到对应的老系统游戏，以及用户在该游戏下的账号ID，所以要求开发者在上架游戏时配置游戏在新老系统下的APP ID映射关系，并配置游戏在老系统游戏上接入的账号ID类型（playerId/openId）。</p> <ol><li id="zh-cn_topic_0000002385861065_li5426154905118">登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，在“开发与服务”下选择项目及项目下的游戏，左侧菜单选择“构建 &gt; 游戏服务”，在右侧点击“新增配置”。<p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p1090693643318"><span><img originheight="444" originwidth="1224" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.35344259643718592313727686178083:50001231000000:2800:81F684F9898AA8BC7C6E8A4626DBC81B0DD4F9254000587A02DD2D5F3EA7A605.png" width="920" height="333.72549019607845"></span></p> </li><li>在弹出的“新增配置信息”窗口中选择HAP游戏和APK游戏，完成后点击“下一步”。<p><span><img originheight="374" originwidth="602" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.31115906032254203182388355675317:50001231000000:2800:4461182367E370AF4BBF08BCBA9E0DB45E5DD37CA3F22A1FAB45DD821D1C2F41.png" width="602" height="374"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.3.2.2.1.3.1.1" valign="top" width="30%"><p>信息项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.2.2.1.3.1.2" valign="top" width="70%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="30%"><p>HarmonyOS 5.0及以上游戏</p> </td> <td class="cellrowborder" valign="top" width="70%"><p>请选择待上架的HAP游戏。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="30%"><p>HarmonyOS 4及以下游戏</p> </td> <td class="cellrowborder" valign="top" width="70%"><p>请选择已上架或待上架的APK游戏。</p> <p>若无待上架的游戏，请新建草稿态游戏。</p> </td> </tr>  </tbody></table></div> </div> </li><li>在弹出的窗口中继续填写信息，完成后点击“下一步”。<p><span><img originheight="354" originwidth="524" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.63508510738265136845552981930003:50001231000000:2800:675E3C7323192BF0984490B32B57704E682D120DD0929CF38665B810EE30D6EF.png" width="524" height="354"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.11.3.3.2.1.3.1.1" valign="top" width="30%"><p>信息项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.11.3.3.2.1.3.1.2" valign="top" width="70%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="30%"><p>支持数据继承的玩家标识类型</p> </td> <td class="cellrowborder" valign="top" width="70%"><p>请选择HarmonyOS 4及以下游戏的玩家标识类型：</p> <ul><li><strong>playerId</strong>：老系统游戏确认使用<strong>playerId</strong>作为玩家标识，请选择“<strong>playerId</strong>”。选择后，新系统游戏的玩家标识gamePlayerId=playerId。</li><li><strong>openId</strong>：如下情况请选择“<strong>openId</strong>”<ul><li>情况一：老系统游戏确认使用<strong>openId</strong>作为玩家标识。</li><li>情况二：老系统游戏确认使用<strong>unionId</strong>作为玩家标识。此时，请同时勾选“使用了unionId”，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-convertid" target="_blank">转换ID</a>用gamePlayerId（openId）换取unionId，若unionId未在游戏侧找到玩家记录，则当前玩家为新系统游戏的新用户。</li><li>情况三：部分游戏由于处于playerId替换为openId方案的过渡期，导致老系统游戏的玩家标识存在<strong>playerId与openId混用</strong>的情况，例如A玩家使用openId，B玩家使用playerId。此时，若无法通过gamePlayerId在游戏侧找到玩家记录，可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-convertid" target="_blank">转换ID</a>接口用gamePlayerId（openId）换取playerId，若playerId能在游戏侧找到玩家记录，表明该玩家是使用playerId作为玩家标识的老用户，否则该玩家为新系统游戏的新用户。</li><li>情况四：HarmonyOS 4及以下游戏未上架时。</li></ul> </li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="30%"><p>接入unionId的HarmonyOS 4及以下游戏实现数据继承需要进行转换处理</p> </td> <td class="cellrowborder" valign="top" width="70%"><p>若老系统的游戏确认使用<strong>unionId</strong>作为玩家标识，请勾选“使用了unionId”。</p> </td> </tr>  </tbody></table></div> </div> </li><li>（可选）填写开发者服务器的回调地址，回调地址要求支持HTTPS协议，且具有合法商用证书，完成后点击“确定”提交APP ID映射关系的审批申请。<p><span><img originheight="244" originwidth="594" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.99708887517464794366336481239611:50001231000000:2800:E2B1735248AA1A464F432E0583D735762E7815E3FA74D5FE83CB483FB5F55708.png" width="594" height="244"></span></p> </li><li>若出现异常情况，将在提示框以红字提醒。<p>建议点击“取消”重新配置映射关系。若忽略异常情况点击“确定”继续提交申请，可能会造成映射关系审批不通过。</p> <p><span><img originheight="461" originwidth="714" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.39508779205165946699696493781430:50001231000000:2800:2ECB6AA48A2473E8A15190EC18BC2883E6288748034F9FE525D4F7D30AC53810.png" width="714" height="461"></span></p> </li><li>提交申请后，华为工作人员完成审核需要1~3个工作日，请耐心等待。APP ID映射关系生效后想要重新配置，请先提交映射关系的删除申请。<p><span><img originheight="264" originwidth="1084" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.98340195663718789493041480477458:50001231000000:2800:9AA5436F1E5AB5DC85BA6A3E15A65043E9BE912AEDA1DFF16B4308AE332099A6.png" width="920" height="224.0590405904059"></span></p> <p>配置/删除APP ID映射关系的审核结果将通过互动中心或邮件进行通知。</p> <p><span><img originheight="805" originwidth="1114" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114707.01951225886471122166415539749371:50001231000000:2800:48A41E557553638EF48DC4F2C772196D6920BC7F0E5A39227E4334765763EA94.png" width="920" height="664.8114901256732"></span></p> </li></ol> </div> <div class="tiledSection"><h2 id="section18785822174617">业务流程<i class="anchor-icon anchor-icon-link" anchorid="section18785822174617" tips="复制节点链接"></i></h2><div class="p"><span><img originheight="826" originwidth="1375" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.41715752901584557272396636310758:50001231000000:2800:0A637401A70737FAF56DE32F661DCEA76DDE395BD260EB5D6F36CDBCA5C04DD1.png" width="920" height="552.6690909090909"></span><ol><li>玩家启动游戏。</li><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section225333655719" target="_blank">init</a>接口初始化Game Service Kit。初始化后，弹出华为隐私协议，玩家签署协议后，则继续往下执行。</li><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section1097616266227" target="_blank">on</a>接口注册事件监听。若监听到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section57008633419" target="_blank">PlayerChangedEvent</a>事件，先清除本地缓存信息，再重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>登录逻辑，showLoginDialog设置为true，重新拉起联合登录面板。</li><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>建议使用session缓存登录状态，玩家下次登录进入游戏无需再调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口，但仍需调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section15119154416715" target="_blank">verifyLocalPlayer</a>接口。</p> </div></div></div> </li><li>向玩家展示联合登录面板。</li><li>玩家选择“华为账号登录”。</li><li>游戏顶部弹出欢迎横幅，并向游戏返回accountName（选择华为账号登录返回值为hw_account）、gamePlayerId等信息。</li><li>【<strong>异步流程</strong>】玩家信息核验。建议在服务端校验玩家信息，若没有服务器，无需校验一致性。<ol><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section7843123616411" target="_blank">createLoginWithHuaweiIDRequest</a>接口，获取用于服务器校验的Authorization Code。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>Authorization Code只有5分钟有效期，且仅能使用一次，不可复用。</p> </div></div></div> </li><li>游戏向开发者服务器上传Authorization Code、gamePlayerId等信息。</li><li>开发者服务器携带Authorization Code，请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token" target="_blank">获取用户级凭证</a>接口，获取Access Token。</li><li>开发者服务器携带Access Token，请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-getplayerinfo" target="_blank">获取玩家标识</a>接口，获取gamePlayerId。</li><li>开发者服务器把从华为游戏服务器获取的gamePlayerId与客户端获取的gamePlayerId进行一致性核验。若核验不通过，已通过合规校验进入游戏的玩家也需强制退出游戏。</li></ol> </li><li>游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section15119154416715" target="_blank">verifyLocalPlayer</a>接口，校验当前用户设备登录华为账号的实名认证、未成年人防沉迷信息。校验通过后，玩家进入游戏。若校验未通过请根据返回的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-error-code" target="_blank">错误码</a>进行相应处理。</li><li>若玩家在游戏内创建角色，建议游戏调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section201561659105917" target="_blank">savePlayerRole</a>上报角色信息。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>若游戏无区服角色，或限制为1个区服角色，此时，建议游戏允许玩家直接进入游戏，而无需玩家点击“进入游戏”或者选择区服角色才能进入游戏。</p> </div></div></div> </li></ol> </div> </div> <div class="tiledSection"><h2 id="section1212682065918">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section1212682065918" tips="复制节点链接"></i></h2><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p14126132016595">具体API说明请详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer" target="_blank">接口文档</a>。</p>  <div class="tablenoborder"><div class="tbBox"><table id="zh-cn_topic_0000002385861065_table41261208591" class="layoutFixed idpTab"><thead><tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row11126162020594"><th align="left" class="cellrowborder" id="mcps1.3.13.3.1.3.1.1" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p512652085911">接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.13.3.1.3.1.2" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p312632012599">描述</p> </th> </tr> </thead> <tbody><tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row1012612205591"><td class="cellrowborder" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__p1722611911016"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section225333655719" target="_blank">init</a>(context: common.UIAbilityContext, callback: AsyncCallback&lt;void&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p112682075914">游戏初始化接口，使用默认的上下文信息，使用callback回调。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row34221416663"><td class="cellrowborder" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p65521435631"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section1097616266227" target="_blank">on</a>(type: 'playerChanged', callback: Callback&lt;PlayerChangedResult&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p125528357319">玩家变化事件监听接口，通过Callback回调获取玩家变化结果信息。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row1612692065920"><td class="cellrowborder" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p01261320145919"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>(context: common.UIAbilityContext, loginParam: UnionLoginParam): Promise&lt;UnionLoginResult&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p1812712075917">华为账号和游戏官方账号联合登录接口，通过Promise对象获取返回值。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row13127132017596"><td class="cellrowborder" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p2128142075913"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section15119154416715" target="_blank">verifyLocalPlayer</a>(context: common.UIAbilityContext, thirdUserInfo: ThirdUserInfo): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p18128142010599">合规校验接口，校验当前设备登录的华为账号的实名认证、游戏防沉迷信息，通过Promise对象获取返回值。</p> </td> </tr> <tr id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_row722415544114"><td class="cellrowborder" valign="top" width="53.769999999999996%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p1225654516"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section201561659105917" target="_blank">savePlayerRole</a>(context<span style="color: rgb(154,110,58);">:</span> common.UIAbilityContext, request: GSKPlayerRole): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="46.23%"><p id="ZH-CN_TOPIC_0000002452599310__zh-cn_topic_0000002385861065_p922519542015">保存角色信息到华为游戏服务器，使用默认的上下文信息，通过Promise对象获取返回值。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section11559185483318">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section11559185483318" tips="复制节点链接"></i></h2></div> <div class="tiledSection"><h3 id="section578585213911" class="firsth2">接口调用流程图<i class="anchor-icon anchor-icon-link" anchorid="section578585213911" tips="复制节点链接"></i></h3><p>接入华为账号登录的接口调用流程如下：</p> <p><span><img originheight="616" originwidth="1058" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.06138263103080962271309869540211:50001231000000:2800:A820E514068B5B39A8F88A97685710D2760D45FDB001B20851D539C3E6DE1AD6.png" width="920" height="535.6521739130435"></span></p> </div> <div class="tiledSection"><h3 id="section148743784818">导入模块<i class="anchor-icon anchor-icon-link" anchorid="section148743784818" tips="复制节点链接"></i></h3><p>导入Account Kit模块、Game Service Kit模块及相关公共模块。</p> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { authentication } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AccountKit'</span>;</li><li><span class="hljs-keyword">import</span> { gamePlayer } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.GameServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Callback</span>, <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable language_">window</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { util } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li></ol></pre></div></div> </div> <div class="tiledSection"><h3 id="section188422114487">初始化<i class="anchor-icon anchor-icon-link" anchorid="section188422114487" tips="复制节点链接"></i></h3><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section225333655719" target="_blank">init</a>接口初始化Game Service Kit。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>调用接口时严格要求继承UIAbility，并且获取上下文的时机是onWindowStageCreate生命周期中页面加载成功后。</li><li>要求游戏先成功调用初始化<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section225333655719" target="_blank">init</a>接口后再调用其他接口，否则将导致审核被驳回。</li></ul> </div></div></div> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">onWindowStageCreate</span>(<span class="hljs-params">windowStage: <span class="hljs-variable language_">window</span>.WindowStage</span>) {</li><li>  windowStage.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">"pages/index"</span>, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      gamePlayer.<span class="hljs-title function_">init</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>,<span class="hljs-function">()=&gt;</span>{</li><li>        hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in initing.`</span>);</li><li>      });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to init. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  });</li><li>}</li></ol></pre></div></div> </div> <p>初始化后，游戏弹出华为隐私协议窗口，用户同意签署协议，则继续往下执行。</p> <p><span><img height="302.7612" originheight="448" originwidth="984" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.70523481397230447597502886020539:50001231000000:2800:C7DD729C7A51A70F5473DD11CD8801A9942EBA34920A8B9B4AA55CBB90B63966.png" title="点击放大" width="665"></span></p> <p>若当前华为账号同意过游戏服务隐私协议，后续使用该华为账号登录的游戏将不会再弹出隐私协议窗口。</p> <div class="tiledSection"><h3 id="section19394161516488">注册事件监听<i class="anchor-icon anchor-icon-link" anchorid="section19394161516488" tips="复制节点链接"></i></h3><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section1097616266227" target="_blank">on</a>接口注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section57008633419" target="_blank">PlayerChangedEvent</a>事件监听，及时感知游戏过程中账号的变化。</p> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">private</span> <span class="hljs-title function_">onPlayerChangedEventCallback</span>(<span class="hljs-params">result: gamePlayer.PlayerChangedResult</span>) {</li><li>  <span class="hljs-keyword">if</span> (result.<span class="hljs-property">event</span> === gamePlayer.<span class="hljs-property">PlayerChangedEvent</span>.<span class="hljs-property">SWITCH_GAME_ACCOUNT</span>) {</li><li>     <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// 游戏号已切换，完成本地缓存清理工作后，再次调用unionLogin接口等</span></li><li>  }</li><li>}</li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-comment">// 调用on接口注册playerChanged事件监听</span></li><li><span class="hljs-keyword">try</span> {</li><li>  gamePlayer.<span class="hljs-title function_">on</span>(<span class="hljs-string">'playerChanged'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">onPlayerChangedEventCallback</span>);</li><li>  hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in registering.`</span>);</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to register. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> <p>目前有如下两个场景可以监听到账号变化：</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.21.5.1.3.1.1" valign="top" width="50.49%"><p>能监听到账号切换的场景</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.21.5.1.3.1.2" valign="top" width="49.51%"><p>监听到账号切换后的措施</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50.49%"><p>场景一：</p> <p>玩家点击“欢迎横幅-&gt;管理-&gt;切换”或者点击“欢迎横幅-&gt;管理-&gt;X”。</p> <p>详情请参见<a href="/consumer/cn/doc/harmonyos-guides/gameservice-gameplayer-huawei#section03151161013">欢迎横幅管理游戏账号</a>。</p> </td> <td class="cellrowborder" rowspan="2" valign="top" width="49.51%"><p>若监听到账号变化，游戏应先清除本地缓存信息（session或其他用户缓存），再重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口（showLoginDialog设置为true），重新拉起联合登录面板。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>场景二：</p> <p>用户在设备上切换华为账号后，游戏重启但没有调用unionLogin，直接调用verifyLocalPlayer。此时，verifyLocalPlayer接口会返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-error-code#section1955824812307" target="_blank">1002000015</a>错误码，同时触发on回调。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h3 id="section1178692184813">展示联合登录面板<i class="anchor-icon anchor-icon-link" anchorid="section1178692184813" tips="复制节点链接"></i></h3><div class="p">调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口，向玩家展示联合登录面板。<div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">thirdAccountInfo1</span>: gamePlayer.<span class="hljs-property">ThirdAccountInfo</span> = {</li><li>  <span class="hljs-string">'accountName'</span>: <span class="hljs-string">'testName1'</span>, <span class="hljs-comment">// 游戏开放给开发者接入的账号类型名字，例如“官方账号”、“xx账号”等，并不是具体某个玩家ID或开发者ID。</span></li><li>  <span class="hljs-string">'accountIcon'</span>: $r(<span class="hljs-string">'app.media.icon'</span>) <span class="hljs-comment">// 游戏官方账号图标资源信息，图标大小总和不能超过35KB。</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: gamePlayer.<span class="hljs-property">UnionLoginParam</span> = {</li><li>  <span class="hljs-attr">showLoginDialog</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 是否弹出联合登录面板。true表示强制弹出面板，false表示优先使用玩家上一次的登录选择，不弹出联合登录面板，若玩家首次登录或卸载重装，则正常弹出。</span></li><li>  <span class="hljs-attr">thirdAccountInfos</span>: [ </li><li>    thirdAccountInfo1 <span class="hljs-comment">// 若游戏无官包或无官方账号体系，请传空数组。</span></li><li>  ]</li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  gamePlayer.<span class="hljs-title function_">unionLogin</span>(context, request).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result: gamePlayer.UnionLoginResult</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in logining: <span class="hljs-subst">${result?.accountName}</span>`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <p>联合登录面板为官方统一样式，不支持开发者自定义联合登录面板样式。</p> <p><span><img height="302.2824" originheight="720" originwidth="1584" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.34906653688942511309151510653057:50001231000000:2800:DEFEBF5B725D44401DA1257025177FB2EB47474713EAB781525698572D10007F.jpg" title="点击放大" width="665"></span></p> <p>用户完成登录流程后，游戏顶部弹出欢迎横幅，并向游戏返回accountName（选择华为账号登录返回值为hw_account）、gamePlayerId等信息。</p> <p><span><img height="302.8543" originheight="429" originwidth="942" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.34234250097858497888721010937645:50001231000000:2800:3F52DB75FB66A9F323E028F70EC59D372DC2D2A1743EE5BBA1115207F7CE2DAE.png" title="点击放大" width="665"></span></p> <p>游戏获取到的gamePlayerId（HarmonyOS 5.0及以上系统）与openId/playerId（HarmonyOS 4及以下系统）数值相等。开发者可以根据gamePlayerId实现HarmonyOS 5.0及以上游戏和HarmonyOS 4及以下游戏的账号资产互通。</p> <p>若在开发者服务器找到玩家记录，表明该玩家是老用户。若未找到玩家记录，表明该玩家为新用户，开发者可以为该玩家在HarmonyOS 5.0及以上系统创建新的游戏号。</p> </div> <div class="tiledSection"><h3 id="section1171118166431">异步步骤：核验玩家信息<i class="anchor-icon anchor-icon-link" anchorid="section1171118166431" tips="复制节点链接"></i></h3><p>由于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口返回的gamePlayerId存在被篡改的风险，建议在开发者服务端核验玩家信息，即从开发者服务器获取gamePlayerId与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口返回的gamePlayerId做比对，确保玩家信息一致性。若无服务器，无需校验一致性。</p> <p><span><img height="355.72950000000003" originheight="425" originwidth="1096" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.85926886448485455094753124156126:50001231000000:2800:AC89637A5B1AC7A08A7C5BDCCAEB4F8A3746D819BACECAF4C9B754EC741965C6.png" title="点击放大" width="920"></span></p> <ol><li>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section7843123616411" target="_blank">createLoginWithHuaweiIDRequest</a>创建认证请求并设置参数。<div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">创建认证请求，并设置参数</span></span></li><li><span class=""><span class="hljs-keyword">let</span> loginRequest = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">HuaweiIDProvider</span>().<span class="hljs-title function_">createLoginWithHuaweiIDRequest</span>();</span></li><li><span class="">loginRequest</span><span class="">.<span class="hljs-property">state</span> = util.<span class="hljs-title function_">generateRandomUUID</span>();</span></li></ol></pre></div></div> <div class="p">调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section620452019185" target="_blank">AuthenticationController</a>对象的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-authentication#section164113311433" target="_blank">executeRequest</a>方法执行认证请求，并在Callback中处理认证结果，获取到Authorization Code。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>Authorization Code有效时间为5分钟，且仅能使用一次，不可复用。</p> </div></div></div> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class=""><span class="hljs-comment">// </span></span><span class=""><span class="hljs-comment">执行认证请求</span></span></li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> controller = <span class="hljs-keyword">new</span> authentication.<span class="hljs-title class_">AuthenticationController</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>());</li><li>  controller.<span class="hljs-title function_">executeRequest</span>(loginRequest, <span class="hljs-function">(<span class="hljs-params">err, data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> loginWithHuaweiIDResponse = data <span class="hljs-keyword">as</span> authentication.<span class="hljs-property">LoginWithHuaweiIDResponse</span>;</li><li>    <span class="hljs-keyword">let</span> state = loginWithHuaweiIDResponse.<span class="hljs-property">state</span>;</li><li>    <span class="hljs-keyword">if</span> (state != <span class="hljs-literal">undefined</span> &amp;&amp; loginRequest.<span class="hljs-property">state</span> != state) {</li><li>      hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. State is different.`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in logining.`</span>);</li><li>    <span class="hljs-keyword">let</span> loginWithHuaweiIDCredential = loginWithHuaweiIDResponse.<span class="hljs-property">data</span>!;</li><li>    <span class="hljs-keyword">let</span> authorizationCode = loginWithHuaweiIDCredential.<span class="hljs-property">authorizationCode</span>;</li><li><span class="">    <span class="hljs-comment">// 开发者处理</span></span><span class="hljs-comment">authorizationCode</span></li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to login. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> </li><li>游戏向开发者服务器上传<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口返回的gamePlayerId。</li><li>携带Authorization Code，请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token" target="_blank">获取用户级凭证</a>接口，获取Access Token。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>由于Access Token的有效期仅为60分钟，当Access Token失效或者即将失效时（可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-get-token-info#section1737691991515" target="_blank">NSP_STATUS错误码</a>判断），可以使用Refresh Token（有效期180天）通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/account-api-obtain-user-token" target="_blank">获取用户级凭证</a>向华为账号服务器请求获取新的Access Token。</p> </div></div></div> </li><li>携带Access Token，请求<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-getplayerinfo" target="_blank">获取玩家标识</a>接口，获取华为服务器侧的玩家标识gamePlayerId。</li><li>将华为服务器返回的玩家标识gamePlayerId与步骤<strong>2</strong>传入的玩家标识gamePlayerId进行玩家信息核验。<p>若gamePlayerId一致，表示玩家标识gamePlayerId核验通过，允许玩家进入游戏。若核验不通过，已通过合规校验进入游戏的玩家也需强制退出游戏。</p> </li></ol> </div> <div class="tiledSection"><h3 id="section1843482554811">合规校验<i class="anchor-icon anchor-icon-link" anchorid="section1843482554811" tips="复制节点链接"></i></h3><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section15119154416715" target="_blank">verifyLocalPlayer</a>接口对用户设备登录华为账号的实名认证和未成年人防沉迷进行合规校验，校验通过后，玩家进入游戏。</p> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-comment">// ThirdUserInfo是使用游戏官方账号登录游戏的玩家合规信息，接入华为账号登录时无需传入该信息，但在接入游戏官方账号登录时要求传入相关信息。</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: gamePlayer.<span class="hljs-property">ThirdUserInfo</span> = {</li><li>  <span class="hljs-attr">thirdOpenId</span>: <span class="hljs-string">'123xxxx'</span>, <span class="hljs-comment">// 游戏官方账号ID，接入华为账号登录时传空。</span></li><li>  <span class="hljs-attr">isRealName</span>: <span class="hljs-literal">true</span> <span class="hljs-comment">// 玩家是否实名,该值为true时表示已实名,为false时表示未实名，接入华为账号登录时不传该字段。</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  gamePlayer.<span class="hljs-title function_">verifyLocalPlayer</span>(context, request).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in verifying.`</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to verify. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to verify. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> </div> <div class="p">使用华为账号登录的网络游戏，华为账号的实名认证、未成年人防沉迷由基础游戏服务实现，华为账号的支付合规控制（例如未成年人支付限额）由IAP Kit（应用内支付服务）实现。 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.25.1.1.5.1.1" valign="top" width="10%"><p>合规校验</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.25.1.1.5.1.2" valign="top" width="20%"><p>校验项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.25.1.1.5.1.3" valign="top" width="30%"><p>国家政策</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.25.1.1.5.1.4" valign="top" width="40%"><p>解决方案</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="10%"><p>华为账号实名认证</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>校验用户设备登录的华为账号是否已实名认证。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p>根据相关法律法规要求，所有网络游戏玩家必须使用真实有效身份信息注册并登录网络游戏。</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>若玩家使用未实名认证的华为账号登录游戏时，基础游戏服务向玩家弹出实名认证窗口，要求玩家进行实名认证。若玩家取消实名认证，则返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-error-code#section206921217496" target="_blank">1002000004</a>错误码。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10%"><p>未成年人防沉迷</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>校验已实名认证为未成年人的华为账号是否在规定时间内登录游戏。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p>根据国家新闻出版署的最新规定，所有网络游戏企业仅可在周五、周六、周日和法定节假日每日20时至21时向未成年人提供1小时网络游戏服务，其他时间均不得以任何形式向未成年人提供网络游戏服务。</p> </td> <td class="cellrowborder" valign="top" width="40%"><ul><li>已实名认证为未成年人的华为账号在规定时间内登录游戏，当游戏进行到晚上21时，基础游戏服务会弹窗提示玩家已到游戏时间，强制玩家退出游戏并返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-error-code#section4418848101513" target="_blank">1002000006</a>错误码。</li><li>已实名认证为未成年人的华为账号在非规定游戏时间内登录游戏，基础游戏服务会弹框提示玩家不允许游戏，强制玩家退出游戏并返回<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-error-code#section4418848101513" target="_blank">1002000006</a>错误码。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="10%"><p>未成年人支付限额</p> </td> <td class="cellrowborder" valign="top" width="20%"><p>校验已实名认证为未成年人的华为账号是否限额付费。</p> </td> <td class="cellrowborder" valign="top" width="30%"><p>根据国家新闻出版署的最新规定，网络游戏企业不得为未满8周岁的用户提供游戏付费服务。同一网络游戏企业所提供的游戏付费服务，8周岁以上未满16周岁的用户，单次充值金额不得超过50元人民币，每月充值金额累计不得超过200元人民币；16周岁以上未满18周岁的用户，单次充值金额不得超过100元人民币，每月充值金额累计不得超过400元人民币。</p> </td> <td class="cellrowborder" valign="top" width="40%"><p>已实名认证为未成年人的华为账号在游戏内超额付费，IAP Kit会弹窗提示消费金额超出限制。</p> <p>用户在使用华为应用内支付时，华为会自动根据国家新闻出版署的要求进行支付限额控制，您无需处理。</p> </td> </tr>  </tbody></table></div> </div> </div>  <div class="tablenoborder"><div class="tbBox"><table style="border-style: none;" class="layoutFixed idpTab"><tbody><tr><td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33%"><p><span><img height="126.752" originheight="720" originwidth="1584" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.05556711875739375311959785530924:50001231000000:2800:0B0536B3A06748D3B6ED50D7ACE3E0F0CFB1AF9D095DAE59D88B1D3D0ADAB708.png" title="点击放大" width="279.6"></span></p> <p>华为账号实名认证</p> </td> <td align="center" class="row-nocellborder" style="border: none;" valign="top" width="33%"><p><span><img height="126.752" originheight="720" originwidth="1584" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.19810929731267812340632022333983:50001231000000:2800:6F2B07DDBD071012E4DCEB908271BBF2E00D7DCC03AC57E0EEB07B8190AC28C0.png" title="点击放大" width="279.6"></span></p> <p>未成年人防沉迷</p> </td> <td align="center" class="cellrowborder" style="border: none;" valign="top" width="34%"><p><span><img height="131.47138666666666" originheight="428" originwidth="940" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114708.70788737748127355971937803543750:50001231000000:2800:4D7F80A23D8BB05E78AD559E78CE7CDCFE9D2F048828C41A9968E541ECD76562.png" title="点击放大" width="288.8"></span></p> <p>未成年人支付限额</p> </td> </tr>  </tbody></table></div> </div> <div class="tiledSection"><h3 id="section4186103074814">提交玩家角色信息<i class="anchor-icon anchor-icon-link" anchorid="section4186103074814" tips="复制节点链接"></i></h3><p>推荐接入。</p> <p>玩家成功登录游戏并选择角色、区服后，游戏将角色信息提交到华为游戏服务器，可用于后续基于角色维度的联运活动规划，为玩家提供更好的体验和更丰富的能力。</p> <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section201561659105917" target="_blank">savePlayerRole</a>接口，将角色信息上报至华为游戏服务器。</p> </div> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>若游戏没有角色系统，“roleId”请传入“0”，“roleName”请传入“default”，请勿传""和null。</p> </div></div></div> <div _ngcontent-gec-c106="" class="highlight-div"><div _ngcontent-gec-c106="" class="highlight-div-header"><div _ngcontent-gec-c106="" class="highlight-div-header-left"><div _ngcontent-gec-c106="" class="handle-button expand-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-gec-c106="" class="highlight-div-header-right"><div _ngcontent-gec-c106="" class="handle-button ai-button"></div><div _ngcontent-gec-c106="" class="handle-button line-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-gec-c106="" class="handle-button theme-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-gec-c106="" class="handle-button copy-button"><div _ngcontent-gec-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-gec-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()?.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> common.<span class="hljs-property">UIAbilityContext</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">request</span>: gamePlayer.<span class="hljs-property">GSKPlayerRole</span> = {</li><li>  <span class="hljs-attr">roleId</span>: <span class="hljs-string">'123'</span>, <span class="hljs-comment">// 玩家角色ID，如游戏没有角色系统，请传入“0”，务必不要传""和null。</span></li><li>  <span class="hljs-attr">roleName</span>: <span class="hljs-string">'Jason'</span>, <span class="hljs-comment">// 玩家角色名，如游戏没有角色系统，请传入“default”，务必不要传""和null。</span></li><li>  <span class="hljs-attr">serverId</span>: <span class="hljs-string">'456'</span>,</li><li>  <span class="hljs-attr">serverName</span>: <span class="hljs-string">'Zhangshan'</span>,</li><li>  <span class="hljs-attr">gamePlayerId</span>: <span class="hljs-string">'789'</span>, <span class="hljs-comment">// 请根据实际获取到的gamePlayerId传值。</span></li><li>  <span class="hljs-attr">thirdOpenId</span>: <span class="hljs-string">'123'</span> <span class="hljs-comment">// 接入华为账号登录时不传该字段。接入游戏官方账号登录时，请根据实际获取到的thirdOpenId传值。</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  gamePlayer.<span class="hljs-title function_">savePlayerRole</span>(context, request).<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in saving.`</span>);</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (error) {</li><li>  <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to save. Code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>}</li></ol></pre></div></div> <div class="tiledSection"><h3 id="section03151161013">欢迎横幅管理游戏账号<i class="anchor-icon anchor-icon-link" anchorid="section03151161013" tips="复制节点链接"></i></h3><p>不涉及角色交易、或不存在多个游戏号的游戏可忽略。</p> <p>接入角色交易、或存在多个游戏号的游戏，玩家成功登录后会在顶部欢迎横幅出现“管理”按钮。</p> <p>若玩家在“顶部欢迎横幅 &gt; 管理 &gt; 管理游戏号”中切换/删除游戏号时，开发者的实现逻辑如下：</p> <ol><li>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section1097616266227" target="_blank">on</a>接口回调中清理游戏的登录缓存。</li><li>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section1097616266227" target="_blank">on</a>接口回调中重新调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/gameservice-gameplayer#section157848375136" target="_blank">unionLogin</a>接口，将<strong>showLoginDialog</strong>参数设置为<strong>true</strong>，即可强制拉起联合登录面板，允许玩家重新选择华为账号登录或游戏官方账号登录。</li></ol> <p><span><img height="485.17070000000007" originheight="740" originwidth="710" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114709.06439071170080690964099563379739:50001231000000:2800:9D7DD84A874A61854422695F996768FFD4600A67366AF9A9C60D2F8CBE65A988.png" title="点击放大" width="465.5"></span></p> </div> </div> <div></div></div>