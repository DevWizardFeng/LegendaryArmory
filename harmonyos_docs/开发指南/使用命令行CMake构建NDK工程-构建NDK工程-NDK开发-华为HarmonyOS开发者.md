<h1 _ngcontent-sdn-c119="" class="doc-title ng-star-inserted" title="使用命令行CMake构建NDK工程"> 使用命令行CMake构建NDK工程 </h1>

<div _ngcontent-sdn-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>在很多复杂应用工程中，C++代码工程是通过CMake等构建系统以命令行方式来编译构建的，接下来介绍如何把已有的CMake工程切换到HarmonyOS工具链中，从而使用命令行CMake构建该工程。</p>  <div class="tiledSection"><h2 id="获取ndk开发包">获取NDK开发包<i class="anchor-icon anchor-icon-link" anchorid="获取ndk开发包" tips="复制节点链接"></i></h2><p>先下载并安装完成DevEco Studio，NDK开发相关工具位于$DevEco Studio安装目录/sdk/default/openharmony/native路径下。</p> </div>  <div class="tiledSection"><h3 id="配置环境变量" class="firsth2">配置环境变量<i class="anchor-icon anchor-icon-link" anchorid="配置环境变量" tips="复制节点链接"></i></h3><p>如果只是在DevEco Studio中使用，跳过以下步骤：</p> <ol><li><p>将NDK自带的CMake编译工具添加到环境变量中。</p>  <ul><li><p>配置 linux 系统下环境变量</p>  <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_"># </span><span class="language-bash">打开.bashrc文件</span></li><li>vim ~/.bashrc</li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">在文件最后添加cmake路径，该路径是自己的放置文件的路径，之后保存退出</span></li><li>export PATH=${实际SDK路径}/native/build-tools/cmake/bin:$PATH</li><li><span class="hljs-meta prompt_"># </span><span class="language-bash">在命令行执行<span class="hljs-built_in">source</span> ~/.bashrc使环境变量生效</span></li><li>source ~/.bashrc</li></ol></pre></div></div>  </li><li><p>配置 mac 系统下环境变量</p>  <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">#</span><span class="language-bash">在当前用户目录下，打开 .bash_profile 文件，文件如果不存在，创建即可</span></li><li>vim ~/.bash_profile</li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">在文件最后添加 cmake 路径，该路径是自己的放置文件的路径，之后保存退出</span></li><li>export PATH=${实际SDK路径}/native/build-tools/cmake/bin:$PATH</li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">在命令行执行 <span class="hljs-built_in">source</span> ~/.bash_profile 使环境变量生效</span></li><li>source ~/.bash_profile</li></ol></pre></div></div>  </li><li><p>配置 windows 下的环境变量</p>  </li></ul>  <p> 右键点击我的电脑，在下拉框中选择【属性】，然后点击【高级系统设置】，进入【环境变量】，找到【Path】并点击【编辑】，接着点击【新建】添加路径，保存后退出。最后打开cmd（若下一步不能够实现，请重启电脑尝试）。</p>  <p> <span><img originheight="667" originwidth="1629" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.45344878912343637662657563069422:50001231000000:2800:F02086C5824171D802684681F852841C436668F9B3F793D278A57B2E37C20FD0.png" width="920" height="376.69736034376916"></span></p>  <p> 打开命令框，输入{cmake实际安装路径}\cmake.exe -version，命令行正确回显cmake的版本号，说明环境变量配置完成。</p>  <p> <span><img originheight="85" originwidth="918" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.05305766269781104473072181888291:50001231000000:2800:9ED64F552CE483F27191C94AF681E4F61C0F79F3A07EFB3C7D033FC04838A887.png" width="918" height="85"></span></p>  </li><li><p>查看CMake默认路径。</p>  <ul><li><p>linux 和 mac 系统环境下</p>  <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_">#</span><span class="language-bash">在命令行输入<span class="hljs-built_in">which</span>命令查询当前CMake所在路径</span></li><li>which cmake</li><li><span class="hljs-meta prompt_">#</span><span class="language-bash">结果路径与.bashrc中设置一致</span></li><li>~/ohos-sdk/ohos-sdk/linux/native/build-tools/cmake/bin/cmake</li></ol></pre></div></div>  </li><li><p>windows 系统环境下，cmake 安装路径为自己所配置的环境变量路径</p>  <p>通过 我的电脑-&gt;高级系统设置-&gt;环境变量-&gt;在 Path 对象中查看</p>  </li></ul>  </li></ol> </div>  <div class="tiledSection"><h2 id="使用ndk开发包编译native程序">使用NDK开发包编译Native程序<i class="anchor-icon anchor-icon-link" anchorid="使用ndk开发包编译native程序" tips="复制节点链接"></i></h2><p>应用开发者可以通过NDK开发包快速的开发出Native动态库、静态库与可执行文件。NDK开发包提供CMake编译构建工具脚本，下面通过编写一个C/C++ demo工程来演示适配过程。</p> </div>  <div class="tiledSection"><h3 id="demo工程内容" class="firsth2">demo工程内容<i class="anchor-icon anchor-icon-link" anchorid="demo工程内容" tips="复制节点链接"></i></h3><p>下面是一个CMake的demo工程内容，此工程包含两个目录，include目录包含此库的头文件，src目录包含全部源码；src目录包含两个文件，sum.cpp的算法文件，以及hello.cpp的调用算法的主入口文件，目标是编译成一个可执行程序，以及一个算法动态库。</p> <p><strong>demo目录图</strong></p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>demo</li><li>  ├── CMakeLists.txt</li><li>  ├── include</li><li>       └── sum.h</li><li>  └── src</li><li>       ├── CMakeLists.txt</li><li>       ├── sum.cpp</li><li>       └── hello.cpp</li></ol></pre></div></div> <p><strong>根目录CMakeLists.txt内容</strong></p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li># 指定CMake的最小版本</li><li>CMAKE_MINIMUM_REQUIRED(VERSION 3.16)</li><li>
</li><li># 工程名称，这里我们就叫HELLO</li><li>PROJECT(HELLO)</li><li>
</li><li>#添加一个子目录并构建该子目录。</li><li>ADD_SUBDIRECTORY(src)</li></ol></pre></div></div> <p><strong>内部CMakeLists.txt内容</strong></p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>SET(LIBHELLO_SRC hello.cpp)</li><li>
</li><li># 设置编译参数</li><li>SET(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -O0")</li><li> </li><li># 设置链接参数，具体参数可以忽略，纯粹为了举例</li><li>SET(CMAKE_EXE_LINKER_FLAGS "${CMAKE_EXE_LINKER_FLAGS} -Wl,--emit-relocs --verbose")</li><li>
</li><li># 添加一个libsum动态库目标，编译成功会生成一个libsum.so</li><li>ADD_LIBRARY(sum SHARED sum.cpp)</li><li>
</li><li># 生成可执行程序，添加一个Hello的可执行程序目标，编译成功会生成一个Hello可执行程序</li><li>ADD_EXECUTABLE(Hello ${LIBHELLO_SRC})</li><li>
</li><li># 指定Hello目标include目录路径</li><li>TARGET_INCLUDE_DIRECTORIES(Hello PUBLIC ../include)</li><li>
</li><li># 指定Hello目标需要链接的库名字</li><li>TARGET_LINK_LIBRARIES(Hello PUBLIC sum)</li></ol></pre></div></div> <p><strong>源码内容</strong></p> <p>hello.cpp源码</p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li>#<span class="hljs-title class_">include</span> &lt;<span class="hljs-title class_">iostream</span>&gt;</li><li>#<span class="hljs-variable">include</span> <span class="hljs-string">"sum.h"</span></li><li>
</li><li><span class="hljs-variable">int</span> <span class="hljs-keyword">main</span>(<span class="hljs-variable">int</span> <span class="hljs-variable">argc</span>,<span class="hljs-keyword">const</span> <span class="hljs-variable">char</span> **<span class="hljs-variable">argv</span>)</li><li>{</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span>&lt;&lt; <span class="hljs-string">"hello world!"</span> &lt;&lt;<span class="hljs-title class_">std</span>::<span class="hljs-title class_">endl</span>;</li><li>    <span class="hljs-variable">int</span> <span class="hljs-variable">total</span> = <span class="hljs-title function_">sum</span>(<span class="hljs-number">1</span>, <span class="hljs-number">100</span>);</li><li>    <span class="hljs-variable">std</span>::<span class="hljs-title class_">cout</span>&lt;&lt; <span class="hljs-string">"Sum 1 + 100="</span> &lt;&lt; <span class="hljs-title class_">total</span> &lt;&lt; <span class="hljs-title class_">std</span>::<span class="hljs-title class_">endl</span>;</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;</li><li>}</li></ol></pre></div></div> <p>sum.h源码</p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span>;</li></ol></pre></div></div> <p>sum.cpp源码</p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;iostream&gt;</span></span></li><li>    </li><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">sum</span><span class="hljs-params">(<span class="hljs-type">int</span> a, <span class="hljs-type">int</span> b)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">return</span> a + b;</li><li>}</li></ol></pre></div></div> </div>  <div class="tiledSection"><h3 id="编译构建demo工程">编译构建demo工程<i class="anchor-icon anchor-icon-link" anchorid="编译构建demo工程" tips="复制节点链接"></i></h3><p><strong>linux 和 mac 系统环境下</strong></p> <p>在工程目录的模块目录下，创建build目录，用来放置CMake构建时产生的中间文件。注意: ohos-sdk是下载下来的SDK的根目录，开发者需要自行替换成实际的下载目录。</p> <ol><li><p>采用OHOS_STL=c++_shared动态链接c++库方式构建工程，如不指定，默认采用c++_shared；DOHOS_ARCH参数可根据系统架构来决定具体值，例如当DOHOS_ARCH=armeabi-v7a会编译32位动态库，而当DOHOS_ARCH=arm64-v8a会编译64位动态库。</p>  <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash"><span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build</span></li><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash">cmake -DOHOS_STL=c++_shared -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE={ohos-sdk}/linux/native/build/cmake/ohos.toolchain.cmake ..</span></li><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash">cmake --build .</span></li></ol></pre></div></div>  </li><li><p>采用OHOS_STL=c++_static静态链接c++库方式构建工程，当DOHOS_ARCH=armeabi-v7a会编译32位静态库，而当DOHOS_ARCH=arm64-v8a会编译64位静态库。</p>  <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash"><span class="hljs-built_in">mkdir</span> build &amp;&amp; <span class="hljs-built_in">cd</span> build</span></li><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash">cmake -DOHOS_STL=c++_static -DOHOS_ARCH=arm64-v8a -DOHOS_PLATFORM=OHOS -DCMAKE_TOOLCHAIN_FILE={ohos-sdk}/linux/native/build/cmake/ohos.toolchain.cmake ..</span></li><li><span class="hljs-meta prompt_"> &gt;</span><span class="language-bash">cmake --build .</span></li></ol></pre></div></div>  <p>命令中，OHOS_ARCH与OHOS_PLATFORM两个变量最终会生成clang++的--target命令参数，在此例子中就是--target=arm-linux-ohos --march=armv7a两个参数。</p>  <p>CMAKE_TOOLCHAIN_FILE指定了toolchain文件，在此文件中默认给clang++设置了--sysroot={ndk_sysroot目录}，告诉编译器查找系统头文件的根目录。</p>  </li></ol> <p><strong>windows系统环境下</strong></p> <p>在windows下使用cmake进行编译，与linux下不同的是，使用cmake要加入参数 -G 选择使用的生成器，直接回车会列出下面的生成器。</p> <p><span><img originheight="906" originwidth="610" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.30749829455622715972119114888705:50001231000000:2800:F9BA520395076551B2500598FB3B70F22CF5E9A5B48742C0D16A8C1A8FC31B14.png" width="610" height="906"></span></p> <p>这里使用的是cmake .. -G "Ninja" 引号里面跟的参数就是上图查看的环境所支持的生成器，这里ndk中自带的生成器是Ninja。</p> <p><span><img originheight="238" originwidth="668" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.16715092747428824250649406504107:50001231000000:2800:17045718CCA4B13D0917F94B7DFF2ACE72C415C612ACE2F9E4B9369B9C3E0074.png" width="668" height="238"></span></p> <p>Step 1. 同样在工程目录的模块目录下创建 build 文件夹，进入build目录并执行以下指令：</p> <div _ngcontent-sdn-c106="" class="highlight-div"><div _ngcontent-sdn-c106="" class="highlight-div-header"><div _ngcontent-sdn-c106="" class="highlight-div-header-left"><div _ngcontent-sdn-c106="" class="handle-button expand-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-sdn-c106="" class="highlight-div-header-right"><div _ngcontent-sdn-c106="" class="handle-button ai-button"></div><div _ngcontent-sdn-c106="" class="handle-button line-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-sdn-c106="" class="handle-button theme-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-sdn-c106="" class="handle-button copy-button"><div _ngcontent-sdn-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-sdn-c106="" class="highlight-scroll-div"><pre class="shell prettyprint linenums hljs language-shell" hw-language="shell" data-highlighted="yes"><ol class="linenums"><li> F:\windows\native\build-tools\cmake\bin\cmake.exe -G "Ninja" -D OHOS_STL=c++_shared -D OHOS_ARCH=arm64-v8a -D OHOS_PLATFORM=OHOS -D CMAKE_TOOLCHAIN_FILE=F:\windows\native\build\cmake\ohos.toolchain.cmake ..</li></ol></pre></div></div> <p><strong>注意</strong>：如需debug调试，增加参数 -D CMAKE_BUILD_TYPE=normal；cmake路径和编译工具链ohos.toolchain.cmake路径都是下载好的ndk路径。</p> <p>执行结果如下图：</p> <p><span><img originheight="293" originwidth="1675" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.06397610747127852896939352074275:50001231000000:2800:02ABFC78DC79D5B9747E8A9DBAD53D6C78948240E75EC01C7EB392B5990DE9E5.png" width="920" height="160.9313432835821"></span></p> <p>这里生成的build.ninja文件就是我们需要的 。</p> <p>Step 2. 让我们用ninja指令来编译生成目标文件，其位置如下图所示：</p> <p><span><img originheight="212" originwidth="453" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114333.83524445247629388985431259285439:50001231000000:2800:149DDAA36E64B9FC18F09E06F5CAF3AAA611A29F8A2CDB47D096422CE0CC0D8B.png" width="453" height="212"></span></p> <p>ninja -f build.ninja 或者用 cmake --build . 执行结果如下：</p> <p><span><img originheight="104" originwidth="1011" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114334.57434928355858761985711472992240:50001231000000:2800:6B0BC931933F597E0A64442A4DF7892BDB85ABD5C30EE4616EEC756055A8C252.png" width="920" height="94.63897131552918"></span></p> </div> </div> <div></div></div>