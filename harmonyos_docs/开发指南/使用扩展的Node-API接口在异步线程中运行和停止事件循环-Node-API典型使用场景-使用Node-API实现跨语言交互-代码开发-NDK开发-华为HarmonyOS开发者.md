<h1 _ngcontent-skc-c119="" class="doc-title ng-star-inserted" title="使用扩展的Node-API接口在异步线程中运行和停止事件循环"> 使用扩展的Node-API接口在异步线程中运行和停止事件循环 </h1>

<div _ngcontent-skc-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div> <div class="tiledSection"><h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2><p>开发者在自己创建的ArkTS运行环境中调用异步的ArkTS接口时，可以通过使用Node-API中的扩展接口napi_run_event_loop和napi_stop_event_loop来运行和停止ArkTS实例中的事件循环。</p> </div>  <div class="tiledSection"><h2 id="调用异步的arkts接口示例">调用异步的ArkTS接口示例<i class="anchor-icon anchor-icon-link" anchorid="调用异步的arkts接口示例" tips="复制节点链接"></i></h2><p>调用的ArkTS接口为异步接口时，需要通过扩展接口napi_run_event_loop将异步线程中的事件循环运行起来，底层事件队列中的异步任务将被处理执行。当前Node-API扩展了两种事件循环模式来运行异步线程的事件循环，分别为napi_event_mode_nowait模式和napi_event_mode_default模式。</p> <p>如果使用napi_event_mode_nowait模式运行底层事件循环，系统会尝试从底层的事件队列中取出一个任务并处理，完成之后事件循环停止，如果底层的事件队列中没有任务，事件循环会立刻停止，当前的异步线程不会被阻塞；</p> <p>如果使用napi_event_mode_default模式来运行底层事件循环，系统会阻塞当前的线程，同时会一直尝试从事件队列中获取任务并执行处理这些任务。如果不想当前线程继续被阻塞，可以使用扩展接口napi_stop_event_loop将正在运行的事件循环停止。</p> </div>  <div class="tiledSection"><h3 id="示例代码" class="firsth2">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h3><ul><li><p>功能实现</p>    <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;pthread.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;hilog/log.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;napi/common.h&gt;</span></span></li><li><span class="hljs-comment">// ...</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">ResolvedCallback</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_stop_event_loop</span>(env);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RejectedCallback</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_stop_event_loop</span>(env);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> *<span class="hljs-title">RunEventLoopFunc</span><span class="hljs-params">(<span class="hljs-type">void</span> *arg)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 1. 创建ArkTS实例</span></li><li>    napi_env env;</li><li>    napi_status ret = <span class="hljs-built_in">napi_create_ark_runtime</span>(&amp;env);</li><li>    <span class="hljs-keyword">if</span> (ret != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_handle_scope scope;</li><li>    ret = <span class="hljs-built_in">napi_open_handle_scope</span>(env, &amp;scope);</li><li>    <span class="hljs-keyword">if</span> (ret != napi_ok) {</li><li>        <span class="hljs-built_in">napi_destroy_ark_runtime</span>(&amp;env);</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 2. 加载自定义的模块</span></li><li>    napi_value objectUtils;</li><li>    <span class="hljs-comment">// 'com.example.myapplication' 为当前应用的bundleName</span></li><li>    ret = <span class="hljs-built_in">napi_load_module_with_info</span>(env, <span class="hljs-string">"entry/src/main/ets/pages/ObjectUtils"</span>, <span class="hljs-string">"com.example.myapplication/entry"</span>,</li><li>                                     &amp;objectUtils);</li><li>    <span class="hljs-keyword">if</span> (ret != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 3. 调用异步SetTimeout接口</span></li><li>    napi_value setTimeout = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value promise = <span class="hljs-literal">nullptr</span>;</li><li>
</li><li>    <span class="hljs-built_in">napi_get_named_property</span>(env, objectUtils, <span class="hljs-string">"SetTimeout"</span>, &amp;setTimeout);</li><li>    <span class="hljs-built_in">napi_call_function</span>(env, objectUtils, setTimeout, <span class="hljs-number">0</span>, <span class="hljs-literal">nullptr</span>, &amp;promise);</li><li>
</li><li>    napi_value theFunc = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">napi_get_named_property</span>(env, promise, <span class="hljs-string">"then"</span>, &amp;theFunc) != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>
</li><li>    napi_value resolvedCallback = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value rejectedCallback = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-built_in">napi_create_function</span>(env, <span class="hljs-string">"resolvedCallback"</span>, NAPI_AUTO_LENGTH, ResolvedCallback, <span class="hljs-literal">nullptr</span>, &amp;resolvedCallback);</li><li>    <span class="hljs-built_in">napi_create_function</span>(env, <span class="hljs-string">"rejectedCallback"</span>, NAPI_AUTO_LENGTH, RejectedCallback, <span class="hljs-literal">nullptr</span>, &amp;rejectedCallback);</li><li>    napi_value argv[<span class="hljs-number">2</span>] = {resolvedCallback, rejectedCallback};</li><li>    <span class="hljs-built_in">napi_call_function</span>(env, promise, theFunc, INT_ARG_2, argv, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-keyword">auto</span> flag = <span class="hljs-built_in">reinterpret_cast</span>&lt;<span class="hljs-type">bool</span> *&gt;(arg);</li><li>    <span class="hljs-keyword">if</span> (*flag == <span class="hljs-literal">true</span>) {</li><li>        <span class="hljs-built_in">napi_run_event_loop</span>(env, napi_event_mode_default);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// 非阻塞式的处理任务，有可能队列中还没有任务就已经返回了</span></li><li>        <span class="hljs-built_in">napi_run_event_loop</span>(env, napi_event_mode_nowait);</li><li>    }</li><li>
</li><li>    <span class="hljs-keyword">if</span> (scope != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">napi_close_handle_scope</span>(env, scope);</li><li>        scope = <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (env != <span class="hljs-literal">nullptr</span>) {</li><li>        napi_status destroy_ret = <span class="hljs-built_in">napi_destroy_ark_runtime</span>(&amp;env);</li><li>        <span class="hljs-keyword">if</span> (destroy_ret != napi_ok) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"Failed to destroy ark runtime"</span>);</li><li>        }</li><li>        env = <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">RunEventLoop</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-type">pthread_t</span> tid;</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value argv[<span class="hljs-number">1</span>] = { <span class="hljs-literal">nullptr</span> };</li><li>    <span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, argv, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-type">bool</span> flag = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-built_in">napi_get_value_bool</span>(env, argv[<span class="hljs-number">0</span>], &amp;flag);</li><li>    <span class="hljs-comment">// 创建异步线程</span></li><li>    <span class="hljs-built_in">pthread_create</span>(&amp;tid, <span class="hljs-literal">nullptr</span>, RunEventLoopFunc, &amp;flag);</li><li>    <span class="hljs-built_in">pthread_join</span>(tid, <span class="hljs-literal">nullptr</span>);</li><li>
</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>}</li></ol></pre></div></div>  </li><li><p>模块注册</p>  <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        { <span class="hljs-string">"runEventLoop"</span>, <span class="hljs-literal">nullptr</span>, RunEventLoop, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span> }</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module nativeModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = <span class="hljs-literal">nullptr</span>,</li><li>    .reserved = { <span class="hljs-number">0</span> },</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_module_register</span>(&amp;nativeModule);</li><li>}</li></ol></pre></div></div>  </li><li><p>接口声明</p>    <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">runEventLoop</span>: <span class="hljs-function">(<span class="hljs-params">isDefault: <span class="hljs-built_in">boolean</span></span>) =&gt;</span> <span class="hljs-built_in">object</span>;</li></ol></pre></div></div>  </li><li><p>编译配置</p>  </li></ul> <ol><li><p>CMakeLists.txt文件需要按照如下配置</p>  <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="text prettyprint linenums hljs language-plaintext" hw-language="text" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li># the minimum version of CMake.</li><li>cmake_minimum_required(VERSION 3.5.0)</li><li>project(MyApplication3)</li><li>
</li><li>set(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li>
</li><li>if(DEFINED PACKAGE_FIND_FILE)</li><li>    include(${PACKAGE_FIND_FILE})</li><li>endif()</li><li>add_definitions( "-DLOG_TAG=\"LOG_TAG\"" )</li><li>include_directories(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li>add_library(entry SHARED napi_init.cpp)</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div>  </li><li><p>需要在模块的build-profile.json5文件中进行以下配置</p>    <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="JSON5 prettyprint linenums hljs language-cangjie" hw-language="JSON5" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"buildOption"</span>: {</li><li>  <span class="hljs-string">"arkOptions"</span> : {</li><li>    <span class="hljs-string">"runtimeOnly"</span> : {</li><li>      <span class="hljs-string">"sources"</span>: [</li><li>        <span class="hljs-string">"./src/main/ets/pages/ObjectUtils.ets"</span></li><li>      ]</li><li>    }</li><li>  },</li></ol></pre></div></div>  </li></ol> <ul><li><p>ArkTS代码示例</p>  <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 导入头文件</span></li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">'libentry.so'</span></li></ol></pre></div></div>    <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.ets</span></li><li>testNapi.<span class="hljs-title function_">runEventLoop</span>(<span class="hljs-literal">true</span>);</li></ol></pre></div></div>    <div _ngcontent-skc-c106="" class="highlight-div"><div _ngcontent-skc-c106="" class="highlight-div-header"><div _ngcontent-skc-c106="" class="highlight-div-header-left"><div _ngcontent-skc-c106="" class="handle-button expand-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-skc-c106="" class="highlight-div-header-right"><div _ngcontent-skc-c106="" class="handle-button ai-button"></div><div _ngcontent-skc-c106="" class="handle-button line-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-skc-c106="" class="handle-button theme-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-skc-c106="" class="handle-button copy-button"><div _ngcontent-skc-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-skc-c106="" class="highlight-scroll-div"><pre class="TypeScript prettyprint linenums hljs language-TypeScript" hw-language="TypeScript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">SetTimeout</span>(<span class="hljs-params"></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> {</li><li>    <span class="hljs-built_in">setTimeout</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'set timer delay 1s'</span>);</li><li>      <span class="hljs-comment">// attempt to stop the event loop at napi terminal</span></li><li>      <span class="hljs-title function_">resolve</span>();</li><li>    }, <span class="hljs-number">1000</span>)</li><li>  })</li><li>}</li></ol></pre></div></div>  </li></ul> </div> </div> <div></div></div>