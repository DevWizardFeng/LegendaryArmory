<h1 _ngcontent-pgp-c119="" class="doc-title ng-star-inserted" title="使用扩展的Node-API接口在当前线程中创建、切换和销毁上下文环境"> 使用扩展的Node-API接口在当前线程中创建、切换和销毁上下文环境 </h1>

<div _ngcontent-pgp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>在应用被拉起时，应用的主线程即为一个ArkTS线程，该线程中存在一个由系统管理的上下文环境，当ArkTS需要和C/C++交互时，在C/C++侧，napi_env即代表该上下文环境，每个上下文环境中存在着独立的globalThis对象。</p> <p>开发者可以通过使用Node-API中的扩展接口napi_create_ark_context和napi_destroy_ark_context在当前线程中创建和销毁新的上下文环境，这些新创建的上下文环境和线程中原始的上下文环境共用一个运行时虚拟机。</p> <p>需要注意的是napi_create_ark_context接口仅仅是创建新的上下文环境，而不是创建一个新的运行时，同时通过该接口创建上下文环境，需要通过napi_destroy_ark_context接口销毁，否则会造成内存泄漏。</p> <p>当然ArkTS线程的原始上下文环境不能通过napi_destroy_ark_context接口销毁。</p> <p>当需要切换到指定的上下文环境时，可以调用Node-API中的扩展接口napi_switch_ark_context来切换到指定的上下文环境。</p> <p>开发者可以在一个新的上下文环境中访问globalThis上的某些属性方法，也可以在访问完之后，切回到原先的上下文环境保证上下文环境的隔离。</p>  <div class="tiledSection"><h2 id="场景介绍">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h2><p>开发者可以通过napi_create_ark_context接口在当前的线程中创建新的上下文环境，该上下文环境拥有独立的globalThis对象。</p> <p>这意味着当前线程上原始的上下文环境和新创建的上下文环境是相互隔离的，即上下文环境中的globalThis对象不同。</p> <p>开发者可以通过新创建的上下文环境进行模块化加载，加载生成的模块化对象将挂载在当前上下文环境中的globalThis对象上，不同的模块加载在不同的上下文环境中，可以避免一个模块对globalThis对象上的属性的修改影响到另一个模块对globalThis对象上属性的访问。</p> <p>当然部分的Node-API标准接口和扩展接口也进行上下文的适配，这意味着调用这些Node-API的接口，上下文环境会根据接口入参的napi_env来主动进行上下文的切换动作，开发者不需要主动调用napi_switch_ark_context来进行上下文环境的切换。</p> <p>需要注意的是从C++/C侧回到ArkTS侧时，要主动调用napi_switch_ark_context接口将上下文环境切回到对应的上下文环境，否则会造成ArkTS侧的代码执行在另外一个上下文环境导致不可预知的稳定性问题。</p> </div>  <div class="tiledSection"><h2 id="支持多运行时上下文环境调用的napi接口">支持多运行时上下文环境调用的NAPI接口<i class="anchor-icon anchor-icon-link" anchorid="支持多运行时上下文环境调用的napi接口" tips="复制节点链接"></i></h2><p>下列表格中的NAPI接口都支持在多上下文的环境中执行，其中部分NAPI接口会主动进行上下文的切换。</p> <p>即使调用方没有主动调用napi_switch_ark_context来切换运行时上下文，这部分接口仍然可以通过比较当前运行的上下文环境和接口指定的运行时环境是否一致来决定是否切换上下文环境。</p> <p>如果上下文环境不一致，这些NAPI接口会将当前的运行时环境切换成接口参数指定的上下文环境。</p> <p>当然不涉及主动切换上下文环境的接口意味着这部分接口和运行时上下文无关，使用任意一个有效的上下文环境都行正常执行。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.8.6.1.3.1.2" valign="top" width="50%">是否会主动进行上下文切换</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_module_register</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_fatal_error</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_async_init</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_async_destroy</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_make_callback</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_buffer</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external_buffer</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_buffer_copy</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_buffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_buffer_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_async_work</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_async_work</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_queue_async_work</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_cancel_async_work</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_node_version</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_fatal_exception</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_add_env_cleanup_hook</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_remove_env_cleanup_hook</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_open_callback_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_close_callback_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_threadsafe_function_context</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_call_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_acquire_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_release_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_unref_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_ref_threadsafe_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_add_async_cleanup_hook</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_remove_async_cleanup_hook</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">node_api_get_module_file_name</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_last_error_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_undefined</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_null</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_global</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_boolean</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_object</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_array</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_array_with_length</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_double</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_int32</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_uint32</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_int64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_latin1</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_utf8</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_string_utf16</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external_string_ascii</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external_string_utf16</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_symbol</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_function</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_type_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_range_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_typeof</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_double</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_int32</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_uint32</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_int64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_bool</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_latin1</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_utf8</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_string_utf16</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_bool</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_number</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_object</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_string</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_prototype</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_property_names</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_own_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_named_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_named_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_named_property</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_element</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_has_element</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_element</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_element</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_define_properties</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_array</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_array_length</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_strict_equals</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_call_function</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_new_instance</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_instanceof</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_cb_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_new_target</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_define_class</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_wrap</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_unwrap</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_remove_wrap</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_external</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_reference</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_reference</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_reference_ref</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_reference_unref</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_reference_value</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_open_handle_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_close_handle_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_open_escapable_handle_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_close_escapable_handle_scope</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_escape_handle</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw_type_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_throw_range_error</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_error</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_exception_pending</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_and_clear_last_exception</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_external_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_arraybuffer_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_typedarray</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_typedarray</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_typedarray_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_dataview</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_dataview</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_dataview_info</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_version</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_promise</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_resolve_deferred</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_reject_deferred</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_promise</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_run_script</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_date</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_date</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_date_value</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_add_finalizer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_bigint_int64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_bigint_uint64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_bigint_words</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_bigint_int64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_bigint_uint64</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_value_bigint_words</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_all_property_names</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_set_instance_data</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_instance_data</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_detach_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_detached_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_type_tag_object</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_check_object_type_tag</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_object_freeze</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_object_seal</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_run_script_path</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_queue_async_work_with_qos</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_load_module</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_object_with_properties</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_object_with_named_properties</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_coerce_to_native_binding_object</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_load_module_with_info</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_ark_runtime</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_destroy_ark_runtime</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_serialize</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_deserialize</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_serialization_data</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_call_threadsafe_function_with_priority</td> <td class="cellrowborder" valign="top" width="50%">否</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_wrap_enhance</td> <td class="cellrowborder" valign="top" width="50%">是</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h2 id="不支持多运行时上下文环境调用的napi接口">不支持多运行时上下文环境调用的NAPI接口<i class="anchor-icon anchor-icon-link" anchorid="不支持多运行时上下文环境调用的napi接口" tips="复制节点链接"></i></h2> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.9.2.1.3.1.1" valign="top" width="50%">接口</th> <th align="left" class="cellrowborder" id="mcps1.3.9.2.1.3.1.2" valign="top" width="50%">多运行时上下文环境调用返回值</th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%">napi_define_sendable_class</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_is_sendable</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_sendable_object_with_properties</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_wrap_sendable</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_wrap_sendable_with_size</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_unwrap_sendable</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_remove_wrap_sendable</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_sendable_array</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_sendable_array_with_length</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_sendable_arraybuffer</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_sendable_typedarray</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_run_event_loop</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_stop_event_loop</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_uv_event_loop</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_create_strong_sendable_reference</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_delete_strong_sendable_reference</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr> <tr><td class="cellrowborder" valign="top" width="50%">napi_get_strong_sendable_reference_value</td> <td class="cellrowborder" valign="top" width="50%">napi_invalid_arg</td> </tr>  </tbody></table></div> </div> </div>  <div class="tiledSection"><h3 id="示例代码" class="firsth2">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h3><ul><li><p>模块注册</p>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// napi_init.cpp</span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"napi/native_api.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">NAPI_Global_callFunctionInContext</span><span class="hljs-params">(napi_env env, napi_callback_info info)</span></span></li><li><span class="hljs-function"></span>{</li><li>    napi_status status = napi_ok;</li><li>    <span class="hljs-type">size_t</span> argc = <span class="hljs-number">1</span>;</li><li>    napi_value args[<span class="hljs-number">1</span>] = {<span class="hljs-literal">nullptr</span>};</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">napi_get_cb_info</span>(env, info, &amp;argc, args, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>) != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 在原始上下文中加载模块plugin1.ets</span></li><li>    napi_value plugin1 = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_load_module_with_info</span>(env, <span class="hljs-string">"entry/src/main/ets/pages/plugin1"</span>, <span class="hljs-string">"com.example.myapplication/entry"</span>, &amp;plugin1);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"load plugin1 failed"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 获取模块plugin1中的方法GetLocation</span></li><li>    napi_value getLocation1 = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(env, plugin1, <span class="hljs-string">"GetLocation"</span>, &amp;getLocation1);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"obtain GetLocation from plugin1 failed"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 创建新的上下文环境newEnv2</span></li><li>    napi_env newEnv2 = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_create_ark_context</span>(env, &amp;newEnv2);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 主动切换到新的上下文环境newEnv2</span></li><li>    status = <span class="hljs-built_in">napi_switch_ark_context</span>(newEnv2);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"switch to newEnv2 failed"</span>);</li><li>    }</li><li>    napi_value plugin2 = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-comment">// 在新的上下文环境中加载模块plugin2.ets</span></li><li>    status = <span class="hljs-built_in">napi_load_module_with_info</span>(newEnv2, <span class="hljs-string">"entry/src/main/ets/pages/plugin2"</span>, <span class="hljs-string">"com.example.myapplication/entry"</span>,</li><li>                                        &amp;plugin2);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"load plugin2 failed"</span>);</li><li>    }</li><li>
</li><li>    napi_value getLocation2 = <span class="hljs-literal">nullptr</span>;</li><li>    status = <span class="hljs-built_in">napi_get_named_property</span>(newEnv2, plugin2, <span class="hljs-string">"GetLocation"</span>, &amp;getLocation2);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"obtain GetLocation from plugin2 failed"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 在新上下文环境中执行ArkTS侧的方法getLocation, 入参为模块plugin2中的方法GetLocation</span></li><li>    napi_value result = <span class="hljs-literal">nullptr</span>;</li><li>    napi_value args2[<span class="hljs-number">1</span>] = {};</li><li>    args2[<span class="hljs-number">0</span>] = getLocation2;</li><li>
</li><li>    status = <span class="hljs-built_in">napi_call_function</span>(newEnv2, <span class="hljs-literal">nullptr</span>, args[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, args2, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"call function of env failed"</span>);</li><li>    }</li><li>    <span class="hljs-type">int32_t</span> ret = <span class="hljs-number">0</span>;</li><li>    status = <span class="hljs-built_in">napi_get_value_int32</span>(newEnv2, result, &amp;ret);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"napi_get_value_int32 of env failed"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// plugin2的上下文中globalThis.a为3000</span></li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"ret is %{public}d"</span>, ret); <span class="hljs-comment">// 3000</span></li><li>    }</li><li>    <span class="hljs-comment">// 主动切回原始上下文环境env</span></li><li>    status = <span class="hljs-built_in">napi_switch_ark_context</span>(env);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"switch to env failed"</span>);</li><li>    }</li><li>    args2[<span class="hljs-number">0</span>] = getLocation1;</li><li>    status = <span class="hljs-built_in">napi_call_function</span>(env, <span class="hljs-literal">nullptr</span>, args[<span class="hljs-number">0</span>], <span class="hljs-number">1</span>, args2, &amp;result);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 获取GetLocation接口调用之后的返回值</span></li><li>    ret = <span class="hljs-number">0</span>;</li><li>    status = <span class="hljs-built_in">napi_get_value_int32</span>(env, result, &amp;ret);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-comment">// plugin1的上下文中globalThis.a为2000</span></li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"ret is %{public}d"</span>, ret); <span class="hljs-comment">// 2000</span></li><li>    }</li><li>    <span class="hljs-comment">// 销毁创建的上下文环境</span></li><li>    status = <span class="hljs-built_in">napi_destroy_ark_context</span>(newEnv2);</li><li>    <span class="hljs-keyword">if</span> (status != napi_ok) {</li><li>        <span class="hljs-keyword">return</span> <span class="hljs-literal">nullptr</span>;</li><li>    }</li><li>    <span class="hljs-keyword">return</span> result;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 模块注册</span></li><li><span class="hljs-function">EXTERN_C_START</span></li><li><span class="hljs-function"><span class="hljs-type">static</span> napi_value <span class="hljs-title">Init</span><span class="hljs-params">(napi_env env, napi_value exports)</span> </span>{</li><li>    napi_property_descriptor desc[] = {</li><li>        {<span class="hljs-string">"callFunctionInContext"</span>, <span class="hljs-literal">nullptr</span>, NAPI_Global_callFunctionInContext,</li><li>            <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, <span class="hljs-literal">nullptr</span>, napi_default, <span class="hljs-literal">nullptr</span>}</li><li>    };</li><li>    <span class="hljs-built_in">napi_define_properties</span>(env, exports, <span class="hljs-built_in">sizeof</span>(desc) / <span class="hljs-built_in">sizeof</span>(desc[<span class="hljs-number">0</span>]), desc);</li><li>    <span class="hljs-keyword">return</span> exports;</li><li>}</li><li>EXTERN_C_END</li><li>
</li><li><span class="hljs-type">static</span> napi_module demoModule = {</li><li>    .nm_version = <span class="hljs-number">1</span>,</li><li>    .nm_flags = <span class="hljs-number">0</span>,</li><li>    .nm_filename = <span class="hljs-literal">nullptr</span>,</li><li>    .nm_register_func = Init,</li><li>    .nm_modname = <span class="hljs-string">"entry"</span>,</li><li>    .nm_priv = ((<span class="hljs-type">void</span>*)<span class="hljs-number">0</span>),</li><li>    .reserved = { <span class="hljs-number">0</span> },</li><li>};</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> __attribute__((constructor)) <span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">RegisterEntryModule</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-built_in">napi_module_register</span>(&amp;demoModule);</li><li>}</li></ol></pre></div></div>  </li><li><p>接口声明</p>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.d.ts</span></li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">const</span> <span class="hljs-attr">callFunctionInContext</span>: <span class="hljs-function">(<span class="hljs-params">func: (func:()=&gt;<span class="hljs-built_in">number</span>)=&gt;{}</span>) =&gt;</span> <span class="hljs-built_in">number</span>;</li></ol></pre></div></div>  </li><li><p>编译配置</p>  </li></ul> <ol><li><p>CMakeLists.txt文件需要按照如下配置</p>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>// CMakeLists.txt</li><li># the minimum version of CMake.</li><li>cmake_minimum_required(VERSION 3.5.0)</li><li>project(MyApplication8)</li><li>
</li><li>set(NATIVERENDER_ROOT_PATH ${CMAKE_CURRENT_SOURCE_DIR})</li><li>
</li><li>if(DEFINED PACKAGE_FIND_FILE)</li><li>    include(${PACKAGE_FIND_FILE})</li><li>endif()</li><li>
</li><li>add_definitions( "-DLOG_DOMAIN=0xd0d0" )</li><li>add_definitions( "-DLOG_TAG=\"testTag\"")</li><li>
</li><li>include_directories(${NATIVERENDER_ROOT_PATH}</li><li>                    ${NATIVERENDER_ROOT_PATH}/include)</li><li>
</li><li>add_library(entry SHARED napi_init.cpp)</li><li>target_link_libraries(entry PUBLIC libace_napi.z.so libhilog_ndk.z.so)</li></ol></pre></div></div>  </li><li><p>需要在工程的build-profile.json5文件中进行以下配置</p>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>    <span class="hljs-attr">"buildOption"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"arkOptions"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>            <span class="hljs-attr">"runtimeOnly"</span> <span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>                <span class="hljs-attr">"sources"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>                    <span class="hljs-string">"./src/main/ets/pages/plugin1.ets"</span><span class="hljs-punctuation">,</span></li><li>                    <span class="hljs-string">"./src/main/ets/pages/plugin2.ets"</span></li><li>                <span class="hljs-punctuation">]</span></li><li>            <span class="hljs-punctuation">}</span></li><li>        <span class="hljs-punctuation">}</span></li><li>    <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li></ol> <ul><li>ArkTS代码示例<div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// index.ets</span></li><li><span class="hljs-keyword">import</span> testNapi <span class="hljs-keyword">from</span> <span class="hljs-string">"libentry.so"</span></li><li><span class="hljs-comment">// 该接口用于执行模块plugin1或plugin2中的GetLocation方法</span></li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getLocation</span>(<span class="hljs-params">func: () =&gt; <span class="hljs-built_in">number</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title function_">func</span>();</li><li>}</li><li>testNapi.<span class="hljs-title function_">callFunctionInContext</span>(getLocation)</li></ol></pre></div></div>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ets/pages/plugin1.ets</span></li><li>globalThis.<span class="hljs-property">a</span> = <span class="hljs-number">2000</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetLocation</span>(<span class="hljs-params"></span>) : <span class="hljs-built_in">number</span> {</li><li>    <span class="hljs-keyword">return</span> globalThis.<span class="hljs-property">a</span>;</li><li>}</li></ol></pre></div></div>  <div _ngcontent-pgp-c106="" class="highlight-div"><div _ngcontent-pgp-c106="" class="highlight-div-header"><div _ngcontent-pgp-c106="" class="highlight-div-header-left"><div _ngcontent-pgp-c106="" class="handle-button expand-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-pgp-c106="" class="highlight-div-header-right"><div _ngcontent-pgp-c106="" class="handle-button ai-button"></div><div _ngcontent-pgp-c106="" class="handle-button line-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-pgp-c106="" class="handle-button theme-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-pgp-c106="" class="handle-button copy-button"><div _ngcontent-pgp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-pgp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// ets/pages/plugin2.ets</span></li><li>globalThis.<span class="hljs-property">a</span> = <span class="hljs-number">3000</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">GetLocation</span>(<span class="hljs-params"></span>) : <span class="hljs-built_in">number</span> {</li><li><span class="hljs-keyword">return</span> globalThis.<span class="hljs-property">a</span>;</li><li>}</li></ol></pre></div></div>  </li></ul> </div> </div> <div></div></div>