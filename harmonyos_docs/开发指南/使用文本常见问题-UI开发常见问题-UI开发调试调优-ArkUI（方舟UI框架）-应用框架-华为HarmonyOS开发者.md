<h1 _ngcontent-fki-c119="" class="doc-title ng-star-inserted" title="使用文本常见问题"> 使用文本常见问题 </h1>

<div _ngcontent-fki-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本文档介绍使用文本的常见问题并提供参考。</p>    <div class="tiledSection">     <h2 id="文本显示textspan常见问题">文本显示（Text/Span）常见问题<i class="anchor-icon anchor-icon-link" anchorid="文本显示textspan常见问题" tips="复制节点链接"></i></h2>          <p>以下内容介绍了使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text" target="_blank">Text</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>组件进行文本显示时可能遇到的常见问题，包括文本截断、添加标签、显示表情等场景的处理方法。</p>    </div>    <div class="tiledSection">     <h3 id="text组件尾部省略号后为什么还有一段空白没有占满组件宽度" class="firsth2">Text组件尾部省略号后为什么还有一段空白，没有占满组件宽度<i class="anchor-icon anchor-icon-link" anchorid="text组件尾部省略号后为什么还有一段空白没有占满组件宽度" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>在Text组件上未设置宽度，当内容过长时，省略号与组件边缘之间会留有较大空白，且内容更新时省略号的位置会发生变化。</p>     <p><span><img originheight="174" originwidth="329" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.62143191401211236983284849875074:50001231000000:2800:F2E0797F0600837ADA1D4FF9853591A23619A03F36AD34B79BBC22182A76674A.gif" width="329" height="174"></span></p>     <p><strong>原因分析</strong></p>     <p>当Text组件未设置宽度且内容超长时，组件宽度将采用父组件传递的布局约束的最大宽度。不同内容、不同的断词模式导致排版塑型结果不同，因此省略开始位置也会不同。</p>     <p><strong>解决措施</strong></p>     <p>设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#wordbreak11" target="_blank">wordBreak</a>属性为WordBreak.BREAK_ALL，任意2个字符间断行使文本内容尽量占满组件区域。</p>     <p>示例代码如下：</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'混合Hello World! honorificabilitudinitatibus!'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-string">'25fp'</span>)</li><li>        .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">1</span>)</li><li>        .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-attr">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span>})</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Welcome try try try 1235628327434348'</span>;</li><li>        })</li><li>        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>})</li><li>        .<span class="hljs-title function_">wordBreak</span>(<span class="hljs-title class_">WordBreak</span>.<span class="hljs-property">BREAK_ALL</span>) <span class="hljs-comment">// 修改断词模式</span></li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>    .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>})</li><li>    .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">left</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>})</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="59" originwidth="316" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.31382294183521209450254854544370:50001231000000:2800:86D7A540D0598511251FC8C4981D6DD8F534095944B0E1F2159AE398DFF980B1.gif" width="316" height="59"></span></p>    </div>    <div class="tiledSection">     <h3 id="text组件如何实现行末展开样式">Text组件如何实现行末展开样式<i class="anchor-icon anchor-icon-link" anchorid="text组件如何实现行末展开样式" tips="复制节点链接"></i></h3>          <p><strong>解决措施</strong></p>     <p>自行测算截断字符，并在行末添加...展开或者...图标作为组件内容。实现方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-measureutils#getparagraphs20" target="_blank">属性字符串转Paragraph数组</a>、<a href="https://developer.huawei.com/consumer/cn/doc/best-practices/bpta-text-expand-collapse" target="_blank">文本展开折叠</a>。</p>    </div>    <div class="tiledSection">     <h3 id="text组件如何实现内容超长时自动显示省略样式吗">Text组件如何实现内容超长时自动显示省略样式吗？<i class="anchor-icon anchor-icon-link" anchorid="text组件如何实现内容超长时自动显示省略样式吗" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>在固定尺寸的组件区域内，不同字号的内容显示的最大行数会有所不同。期望实现内容超长时自动显示省略样式，则无需设置固定的maxLines值。</p>     <p><strong>解决措施</strong></p>     <p>设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#heightadaptivepolicy10" target="_blank">heightAdaptivePolicy</a>为TextHeightAdaptivePolicy.LAYOUT_CONSTRAINT_FIRST，该模式会删除超过布局约束的行，从而实现类似设置maxLines的效果。</p>     <p>示例代码如下：</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'混合Hello World! 多行文本 中英文数字混合 1282378283 ~'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">fontSize</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">25</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">10</span> }) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">id</span>(<span class="hljs-string">'HelloWorld'</span>)</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span>)</li><li>        .<span class="hljs-title function_">textOverflow</span>({ <span class="hljs-attr">overflow</span>: <span class="hljs-title class_">TextOverflow</span>.<span class="hljs-property">Ellipsis</span>})</li><li>        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>})</li><li>        .<span class="hljs-title function_">heightAdaptivePolicy</span>(<span class="hljs-title class_">TextHeightAdaptivePolicy</span>.<span class="hljs-property">LAYOUT_CONSTRAINT_FIRST</span>) <span class="hljs-comment">// 调整自适应布局策略</span></li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>      <span class="hljs-title class_">Row</span>(){</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'fontSize+5'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> += <span class="hljs-number">5</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">'fontSize-5'</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">()=&gt;</span>{</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontSize</span> -= <span class="hljs-number">5</span>;</li><li>          })</li><li>      }</li><li>    }</li><li>    .<span class="hljs-title function_">margin</span>({<span class="hljs-attr">left</span>: <span class="hljs-number">30</span>, <span class="hljs-attr">top</span>: <span class="hljs-number">50</span>})</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="244" originwidth="314" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.61328577362946070262654049679363:50001231000000:2800:FC454FC3B5B9CFEBE72B9D824DB047A3EFE64583FE025A7A523697EB5A02FC7D.gif" width="314" height="244"></span></p>    </div>    <div class="tiledSection">     <h3 id="在文本前后添加自定义标签">在文本前后添加自定义标签<i class="anchor-icon anchor-icon-link" anchorid="在文本前后添加自定义标签" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>如何在文本的前后各添加一个标签，例如“专题”或“Top1”，且这些标签的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-background" target="_blank">背景样式</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-size" target="_blank">尺寸设置</a>需要能够自定义。</p>     <p><strong>解决措施一</strong></p>     <p>如果标签和中间的长文本需在同一行显示，开发者可能会考虑使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>实现，但是Span不支持设置尺寸。此时，可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-flex-layout">弹性布局 (Flex)</a>或者<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-row" target="_blank">Row</a>中放置标签和长文本，并为长文本设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#textoverflow" target="_blank">textOverflow</a>属性，以确保文本超长时能够自适应截断，显示在一行之内。</p>     <p>实现步骤：</p>     <p>1.将标签和长文本放在同一个沿水平方向布局的容器Row中。</p>     <p>2.中间长文本设置textOverflow属性为TextOverflow.Ellipsis，空间不足时截断文本，显示省略号。</p>     <p>实现案例请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-common-components-text-display#实现热搜榜">实现热搜榜</a>，该示例中，文字“1”、“爆”就是“我是热搜词条”的两个标签。这种实现方式写法简便，适合单行文本添加标签的场景。</p>     <p><strong>解决措施二</strong></p>     <p>如果需在多行文本前后添加标签并且不截断文本，上述方案会导致三个Text中的文本不能对齐，因为多行文本会在Row的宽度内折行。此时，可以在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-layout-development-stack-layout">层叠布局 (Stack)</a>中放置标签和长文本，给中间多行文本设置首行文本缩进距离<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#textindent10" target="_blank">textIndent</a>。多行文本后面的标签则需要通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-location#offset" target="_blank">offset</a>属性调整位置。这种实现方式，可以让三个Text组件中的文字水平对齐。实现步骤如下：</p>     <p>实现步骤：</p>     <p>1.将标签和长文本放在Stack中。</p>     <p>2.在组件显示之前的回调<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-custom-component-lifecycle#abouttoappear" target="_blank">aboutToAppear</a>中，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-measureutils#measuretextsize12" target="_blank">measureTextSize</a>计算前标签的宽度，作为中间多行文本的首行缩进距离。</p>     <p>3.在组件显示之前的回调aboutToAppear中，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-uicontext-measureutils#getparagraphs20" target="_blank">getparagraphs</a>计算中间多行文本最后一行的宽度、除最后一行文本之外的高度，作为后标签的偏移量offset。</p>     <p>4.设置后标签相对于Stack左上角的偏移量。</p>     <p>示例：</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">LengthMetrics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'这是一段长文本，超长部分折行，前后添加标签'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">frontTag</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'前标签'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">backTag</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'后标签'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">frontPaddingVp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">20</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">backPaddingVp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">10</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">fontTagWidthVp</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">backTagWidthVp</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">backOffsetVpX</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">backOffsetVpY</span>: <span class="hljs-title class_">Length</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">messageLines</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">stackWidthVp</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">300</span>;</li><li>
</li><li>  <span class="hljs-comment">// 显示之前，测算前后标签的位置，中间文本的缩进距离</span></li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-comment">// 计算前标签的宽度fontTagWidthVp，作为message的首行缩进距离</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">frontTagSize</span>: <span class="hljs-title class_">SizeOptions</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getMeasureUtils</span>().<span class="hljs-title function_">measureTextSize</span>({</li><li>      <span class="hljs-attr">textContent</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontTag</span>,</li><li>    });</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">fontTagWidthVp</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(<span class="hljs-title class_">Number</span>(frontTagSize.<span class="hljs-property">width</span>)) + <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontPaddingVp</span> * <span class="hljs-number">2</span></li><li>
</li><li>    <span class="hljs-comment">// 计算frontTag+message占据的行数</span></li><li>    <span class="hljs-keyword">let</span> linesFrontTagPlusMessage = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">let</span> mutableStr = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MutableStyledString</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>,</li><li>      [{</li><li>        <span class="hljs-attr">start</span>: <span class="hljs-number">0</span>,</li><li>        <span class="hljs-attr">length</span>: <span class="hljs-number">1</span>,</li><li>        <span class="hljs-attr">styledKey</span>: <span class="hljs-title class_">StyledStringKey</span>.<span class="hljs-property">PARAGRAPH_STYLE</span>,</li><li>        <span class="hljs-attr">styledValue</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">ParagraphStyle</span>({ <span class="hljs-attr">textIndent</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fontTagWidthVp</span>) })</li><li>      }]</li><li>    )</li><li>    <span class="hljs-keyword">let</span> paragraphArr = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>()</li><li>      .<span class="hljs-title function_">getMeasureUtils</span>()</li><li>      .<span class="hljs-title function_">getParagraphs</span>(mutableStr, { <span class="hljs-attr">constraintWidth</span>: <span class="hljs-title class_">LengthMetrics</span>.<span class="hljs-title function_">vp</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stackWidthVp</span>) });</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paragraphArr.<span class="hljs-property">length</span>; ++i) {</li><li>      linesFrontTagPlusMessage += paragraphArr[i].<span class="hljs-title function_">getLineCount</span>();</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 后标签offsetX的偏移量backOffsetVpX=frontTag+message最后一行的宽度</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backOffsetVpX</span> =</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>((paragraphArr[paragraphArr.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>].<span class="hljs-title function_">getLineWidth</span>(linesFrontTagPlusMessage - <span class="hljs-number">1</span>)))</li><li>    <span class="hljs-comment">// 后标签offsetY的偏移量backOffsetVpY=frontTag+message总高度-最后一行的高度。</span></li><li>    <span class="hljs-keyword">let</span> heightFrontTagPlusMessageVp = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; paragraphArr.<span class="hljs-property">length</span>; ++i) {</li><li>      heightFrontTagPlusMessageVp += <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(paragraphArr[i].<span class="hljs-title function_">getHeight</span>());</li><li>    }</li><li>    <span class="hljs-keyword">let</span> lastLineHeight =</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">px2vp</span>(paragraphArr[paragraphArr.<span class="hljs-property">length</span>-<span class="hljs-number">1</span>].<span class="hljs-title function_">getLineHeight</span>(linesFrontTagPlusMessage - <span class="hljs-number">1</span>))</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">backOffsetVpY</span> = heightFrontTagPlusMessageVp - lastLineHeight</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>({ <span class="hljs-attr">space</span>: <span class="hljs-number">20</span> }) {</li><li>      <span class="hljs-title class_">Blank</span>()</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>      <span class="hljs-title class_">Stack</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">frontTag</span>)</li><li>          .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontPaddingVp</span>, <span class="hljs-attr">right</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">frontPaddingVp</span> })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgb(39, 135, 217)'</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">textIndent</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fontTagWidthVp</span>)</li><li>          .<span class="hljs-title function_">padding</span>(<span class="hljs-number">0</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">backTag</span>)</li><li>          .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">left</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">backPaddingVp</span>, <span class="hljs-attr">right</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">backPaddingVp</span> })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgb(0, 74, 175)'</span>)</li><li>          .<span class="hljs-title function_">offset</span>({</li><li>            <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">backOffsetVpX</span>,</li><li>            <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">backOffsetVpY</span></li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">alignContent</span>(<span class="hljs-title class_">Alignment</span>.<span class="hljs-property">TopStart</span>) <span class="hljs-comment">// 顶部起始端对齐</span></li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">stackWidthVp</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'90%'</span>)</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-string">'5%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="49" originwidth="307" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.48991311863027261256486209410219:50001231000000:2800:890872CECD519084ACDF6ACAD3F5E5E6598B2C357C75EB52ADB3D404E5E875B3.png" width="307" height="49"></span></p>    </div>    <div class="tiledSection">     <h3 id="text组件如何实现表情与文字一起显示">Text组件如何实现表情与文字一起显示<i class="anchor-icon anchor-icon-link" anchorid="text组件如何实现表情与文字一起显示" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>emoji表情有时以表情符号的形式表示，如何将表情符号转换为emoji表情，并在Text组件中与文字一同显示？</p>     <p><strong>解决措施</strong></p>     <p>使用正则表达式解析表情符号，再将表情符号与图片资源建立映射，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-span" target="_blank">Span</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-imagespan" target="_blank">ImageSpan</a>同时展示表情和文字。</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextExample</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">fulltext</span>: <span class="hljs-built_in">string</span> =</li><li>    <span class="hljs-string">'你好我是Text[grin]，你好我[rolling_on_the_floor_laughing]是Text，[slightly_smiling_face]你好我是Text[grin]'</span>;</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">classifyTextAndEmojis</span>(<span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span>): <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt; {</li><li>    <span class="hljs-keyword">const</span> emojiRegex = <span class="hljs-regexp">/\[([a-zA-Z_]+)\]/g</span>; <span class="hljs-comment">// 根据实际情况编写正则表达式</span></li><li>    <span class="hljs-keyword">const</span> resultMap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Map</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span>[]&gt;(); <span class="hljs-comment">// 用map记录普通文本和表情</span></li><li>    resultMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'text'</span>, []);</li><li>    resultMap.<span class="hljs-title function_">set</span>(<span class="hljs-string">'emojis'</span>, []);</li><li>
</li><li>    <span class="hljs-keyword">let</span> lastIndex = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">match</span>: <span class="hljs-title class_">RegExpExecArray</span> | <span class="hljs-literal">null</span> = <span class="hljs-literal">null</span>;</li><li>
</li><li>    <span class="hljs-keyword">while</span> ((match = emojiRegex.<span class="hljs-title function_">exec</span>(input)) !== <span class="hljs-literal">null</span>) {</li><li>      <span class="hljs-comment">// 添加普通文本</span></li><li>      <span class="hljs-keyword">if</span> (match.<span class="hljs-property">index</span> &gt; lastIndex) {</li><li>        resultMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'text'</span>)?.<span class="hljs-title function_">push</span>(input.<span class="hljs-title function_">substring</span>(lastIndex, match.<span class="hljs-property">index</span>));</li><li>      }</li><li>      <span class="hljs-comment">// 添加匹配到的表情</span></li><li>      resultMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'emojis'</span>)?.<span class="hljs-title function_">push</span>(match[<span class="hljs-number">1</span>]);</li><li>      lastIndex = match.<span class="hljs-property">index</span> + match[<span class="hljs-number">0</span>].<span class="hljs-property">length</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 添加最后一段文本</span></li><li>    <span class="hljs-keyword">if</span> (lastIndex &lt; input.<span class="hljs-property">length</span>) {</li><li>      resultMap.<span class="hljs-title function_">get</span>(<span class="hljs-string">'text'</span>)?.<span class="hljs-title function_">push</span>(input.<span class="hljs-title function_">substring</span>(lastIndex));</li><li>    }</li><li>    <span class="hljs-keyword">return</span> resultMap;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">static</span> <span class="hljs-title function_">getEmojiImg</span>(<span class="hljs-attr">emojis</span>: <span class="hljs-built_in">string</span>[]): <span class="hljs-title class_">Resource</span>[] { <span class="hljs-comment">// 根据正则匹配结果返回自定义表情资源</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">emojisImg</span>: <span class="hljs-title class_">Resource</span>[] = []</li><li>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; emojis.<span class="hljs-property">length</span>; i++) {</li><li>      <span class="hljs-keyword">switch</span> (emojis[i]) { <span class="hljs-comment">// $r("...")需要替换为开发者所需的图像资源</span></li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'rolling_on_the_floor_laughing'</span>:</li><li>          emojisImg.<span class="hljs-title function_">push</span>($r(<span class="hljs-string">"app.media.rolling_on_the_floor_laughing"</span>))</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'slightly_smiling_face'</span>:</li><li>          emojisImg.<span class="hljs-title function_">push</span>($r(<span class="hljs-string">"app.media.slightly_smiling_face"</span>))</li><li>        <span class="hljs-keyword">case</span> <span class="hljs-string">'grin'</span>:</li><li>          emojisImg.<span class="hljs-title function_">push</span>($r(<span class="hljs-string">"app.media.grin"</span>))</li><li>        <span class="hljs-attr">default</span>:</li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> emojisImg</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">TextInput</span>({</li><li>        <span class="hljs-attr">placeholder</span>: <span class="hljs-string">"用户输入带表情的文本，例如：你好[grin]"</span></li><li>      })</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>        .<span class="hljs-title function_">padding</span>(<span class="hljs-number">10</span>)</li><li>        .<span class="hljs-title function_">border</span>({ <span class="hljs-attr">width</span>: <span class="hljs-number">1</span>, <span class="hljs-attr">color</span>: <span class="hljs-string">'#EEEEEE'</span> })</li><li>        .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value: <span class="hljs-built_in">string</span></span>) =&gt;</span> {</li><li>          <span class="hljs-comment">// 输入变化时，更新 fulltext</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">fulltext</span> = value;</li><li>        });</li><li>
</li><li>      <span class="hljs-title class_">Text</span>() {</li><li>        <span class="hljs-title class_">ForEach</span>(<span class="hljs-title class_">TextExample</span>.<span class="hljs-title function_">classifyTextAndEmojis</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fulltext</span>).<span class="hljs-title function_">get</span>(<span class="hljs-string">'text'</span>),</li><li>          <span class="hljs-function">(<span class="hljs-params">item: <span class="hljs-built_in">string</span>, index: <span class="hljs-built_in">number</span></span>) =&gt;</span> { <span class="hljs-comment">// 展示文本和自定义表情资源</span></li><li>            <span class="hljs-title class_">Span</span>(item)</li><li>              .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">18</span>)</li><li>              .<span class="hljs-title function_">fontColor</span>(<span class="hljs-string">'#666666'</span>)</li><li>              .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Regular</span>)</li><li>
</li><li>            <span class="hljs-title class_">ImageSpan</span>(<span class="hljs-title class_">TextExample</span>.<span class="hljs-title function_">getEmojiImg</span>(</li><li>              <span class="hljs-title class_">TextExample</span>.<span class="hljs-title function_">classifyTextAndEmojis</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">fulltext</span>).<span class="hljs-title function_">get</span>(<span class="hljs-string">'emojis'</span>))[index])</li><li>              .<span class="hljs-title function_">verticalAlign</span>(<span class="hljs-title class_">ImageSpanAlignment</span>.<span class="hljs-property">BOTTOM</span>)</li><li>              .<span class="hljs-title function_">height</span>(<span class="hljs-number">24</span>)</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>      .<span class="hljs-title function_">padding</span>(<span class="hljs-number">15</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">alignItems</span>(<span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span>)</li><li>    .<span class="hljs-title function_">padding</span>(<span class="hljs-number">20</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="115" originwidth="300" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.03321574464937170931566515308145:50001231000000:2800:AA686DFB72C3E86188AF1D9CE6FD1164B405F1A5F3483B5BA5388CAFC64355E4.png" width="300" height="115"></span></p>    </div>    <div class="tiledSection">     <h3 id="文本超长时如何展示">文本超长时如何展示<i class="anchor-icon anchor-icon-link" anchorid="文本超长时如何展示" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>Text组件中内容过多，超出父组件容器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-column" target="_blank">Column</a>的高度，会导致文本溢出容器边界，如何让文本显示在父组件容器的区域内？</p>     <p><strong>解决措施一</strong></p>     <p>Text文本是自动折行的，当没有限制Text高度<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-attributes-size#height" target="_blank">height</a>时，Text高度在文本的行数增加时自动调整。可以通过设置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#maxlines" target="_blank">maxLines</a>属性限制文本的最大行数，如果有多余的文本默认会被截断。也可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#textoverflow" target="_blank">textOverflow</a>属性来指定截断方式。</p>     <p>以下示例展示了限制Text组件不超过三行的场景。</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'这是一段超长文本'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">50</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'auto'</span>)</li><li>        .<span class="hljs-title function_">maxLines</span>(<span class="hljs-number">3</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-string">'10%'</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="223" originwidth="313" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.98751777082707197697394951865326:50001231000000:2800:63F0E36D4689B049EFEE86C4E45E14E23868BA005A68FCFE097AEBD611D9A4E3.png" width="313" height="223"></span></p>     <p><strong>解决措施二</strong></p>     <p>上述方法会导致部分文本被裁剪掉，如果需要保留全部文本，可以把Text组件放在滚动容器<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-container-scroll" target="_blank">Scroll</a>内，再通过手势滑动来浏览全部文本，具体示例如下：</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'这是一段超长文本'</span>.<span class="hljs-title function_">repeat</span>(<span class="hljs-number">50</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Scroll</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>      }</li><li>      .<span class="hljs-title function_">scrollBar</span>(<span class="hljs-title class_">BarState</span>.<span class="hljs-property">Off</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">200</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'80%'</span>)</li><li>    .<span class="hljs-title function_">margin</span>(<span class="hljs-string">'10%'</span>)</li><li>    .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="224" originwidth="346" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.21158861730318209405031282755900:50001231000000:2800:BB87C802A99ACF7F9DA070C1A7D2199F62DB3BDF932598D25757A28C675FE9A5.gif" width="346" height="224"></span></p>    </div>    <div class="tiledSection">     <h3 id="selection如何触发弹出自定义菜单并设置菜单字体大小">selection如何触发弹出自定义菜单并设置菜单字体大小<i class="anchor-icon anchor-icon-link" anchorid="selection如何触发弹出自定义菜单并设置菜单字体大小" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#bindselectionmenu11" target="_blank">bindSelectionMenu</a>自定义选择菜单中，可通过TextResponseType设置文本选择菜单的响应类型。通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#selection11" target="_blank">selection</a>如何触发弹出自定义菜单并设置菜单字体大小。</p>     <p><strong>解决措施</strong></p>     <p>若希望由selection触发自定义菜单，可将TextResponseType设置为DEFAULT。同时，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-menu" target="_blank">Menu</a>组件上通过配置font属性，即可自定义菜单的字体大小，灵活适配界面设计需求。</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextExample8</span> {</li><li>  <span class="hljs-attr">controller</span>: <span class="hljs-title class_">TextController</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">TextController</span>();</li><li>  <span class="hljs-attr">options</span>: <span class="hljs-title class_">TextOptions</span> = { <span class="hljs-attr">controller</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">controller</span> };</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectStart</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">selectEnd</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"TextTextTextText"</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">selection</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">selectStart</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectEnd</span>)</li><li>          .<span class="hljs-title function_">copyOption</span>(<span class="hljs-title class_">CopyOptions</span>.<span class="hljs-property">InApp</span>)</li><li>          .<span class="hljs-title function_">bindSelectionMenu</span>(<span class="hljs-title class_">TextSpanType</span>.<span class="hljs-property">TEXT</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">CustomMenu</span>, <span class="hljs-title class_">TextResponseType</span>.<span class="hljs-property">DEFAULT</span>, {</li><li>            <span class="hljs-attr">onDisappear</span>: <span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectStart</span> = -<span class="hljs-number">1</span>;</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectEnd</span> = -<span class="hljs-number">1</span>;</li><li>            },</li><li>          })</li><li>          .<span class="hljs-title function_">textAlign</span>(<span class="hljs-title class_">TextAlign</span>.<span class="hljs-property">Center</span>)</li><li>          .<span class="hljs-title function_">borderWidth</span>(<span class="hljs-number">1</span>)</li><li>          .<span class="hljs-title function_">borderColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>        <span class="hljs-title class_">Button</span>(<span class="hljs-string">"Set selection"</span>)</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectStart</span> = <span class="hljs-number">0</span>;</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">selectEnd</span> = <span class="hljs-number">10</span>;</li><li>          })</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">14</span>)</li><li>          .<span class="hljs-title function_">margin</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">20</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>      .<span class="hljs-title function_">padding</span>({ <span class="hljs-attr">top</span>: <span class="hljs-number">300</span> })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span></li><li>  <span class="hljs-title class_">CustomMenu</span>() {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Menu</span>() {</li><li>        <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">"Item Content"</span> })</li><li>        <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">"Item Content"</span> })</li><li>        <span class="hljs-title class_">MenuItem</span>({ <span class="hljs-attr">content</span>: <span class="hljs-string">"Item Content"</span> })</li><li>      }</li><li>      .<span class="hljs-title function_">font</span>({ <span class="hljs-attr">size</span>: <span class="hljs-number">14</span> })</li><li>      .<span class="hljs-title function_">radius</span>($r(<span class="hljs-string">'sys.float.ohos_id_corner_radius_card'</span>))</li><li>      .<span class="hljs-title function_">clip</span>(<span class="hljs-literal">true</span>)</li><li>      .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F0F0F0'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="270" originwidth="214" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114834.85762506269460719668373705642775:50001231000000:2800:036ED85BD0F30144DE9E719F99E021C17D39BA838F186CFB98640F4615151956.gif" class="notEnlarge" width="214" height="270"></span></p>    </div>    <div class="tiledSection">     <h3 id="如何屏蔽文本的长按手势">如何屏蔽文本的长按手势<i class="anchor-icon anchor-icon-link" anchorid="如何屏蔽文本的长按手势" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>配置<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-appendix-enums#copyoptions9" target="_blank">CopyOptions</a>将文本设置为可选择，此时长按文本会选择文字内容并弹出系统菜单，如何使长按手势不生效。</p>     <p><strong>解决措施</strong></p>     <p>想要使长按手势对文本不生效，可以设置触发时间小于系统菜单触发时间（500ms）的自定义长按手势。</p>     <div _ngcontent-fki-c106="" class="highlight-div"><div _ngcontent-fki-c106="" class="highlight-div-header"><div _ngcontent-fki-c106="" class="highlight-div-header-left"><div _ngcontent-fki-c106="" class="handle-button expand-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fki-c106="" class="highlight-div-header-right"><div _ngcontent-fki-c106="" class="handle-button ai-button"></div><div _ngcontent-fki-c106="" class="handle-button line-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fki-c106="" class="handle-button theme-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fki-c106="" class="handle-button copy-button"><div _ngcontent-fki-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fki-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">TextExample8</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">"TextTextTextText"</span>)</li><li>        .<span class="hljs-title function_">copyOption</span>(<span class="hljs-title class_">CopyOptions</span>.<span class="hljs-property">InApp</span>)</li><li>        .<span class="hljs-title function_">gesture</span>(<span class="hljs-title class_">LongPressGesture</span>({ <span class="hljs-attr">repeat</span>: <span class="hljs-literal">false</span>, <span class="hljs-attr">duration</span>: <span class="hljs-number">400</span> })</li><li>          .<span class="hljs-title function_">onAction</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          }))</li><li>        .<span class="hljs-title function_">margin</span>({</li><li>          <span class="hljs-attr">top</span>: <span class="hljs-number">100</span>,</li><li>          <span class="hljs-attr">bottom</span>: <span class="hljs-number">100</span>,</li><li>          <span class="hljs-attr">left</span>: <span class="hljs-number">100</span>,</li><li>          <span class="hljs-attr">right</span>: <span class="hljs-number">100</span></li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="设置enablevariablefontweight为true后字重不能跟随设置调节">设置enableVariableFontWeight为true后字重不能跟随设置调节<i class="anchor-icon anchor-icon-link" anchorid="设置enablevariablefontweight为true后字重不能跟随设置调节" tips="复制节点链接"></i></h3>          <p><strong>问题现象</strong></p>     <p>Text组件调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-text#fontweight12" target="_blank">fontWeight</a>接口，<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-text-common#fontsettingoptions12对象说明" target="_blank">FontSettingOptions</a>类型的入参options设置enableVariableFontWeight值为true之后，在系统设置的“字体大小和界面缩放”页面中调节字体粗细，Text组件的字重不跟随变化。</p>     <p><strong>解决措施</strong></p>     <ol>      <li>       <p>如果需要Text组件字重跟随系统设置变化，需要在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-configuration-file#configuration标签">configuration标签</a>设置followSystem。</p></li>      <li>       <p>字体配置项options控制是否启用可变字重调节。</p></li>     </ol>     <ul>      <li>       <p>当options的参数enableVariableFontWeight取值true时，启用可变字重调节。weight取值为[100, 900]范围内任意整数时，字重取值为weight。此时如果在设置中调节字体粗细，字重始终是开发者设置的数值weight，字体粗细不会变化。</p></li>      <li>       <p>当options的参数enableVariableFontWeight取值false时，禁用可变字重调节。weight取值为[100, 900]范围内的整百数值时，字重取值为weight。weight是非整百数值时，字重取默认值400。此时更改设置中的字体粗细，字重会随设置变化。此时如果在设置中调节字体粗细，字重会随设置变化。</p></li>     </ul>    </div>   </div>   <div></div></div>