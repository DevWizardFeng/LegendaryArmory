<h1 _ngcontent-ctr-c119="" class="doc-title ng-star-inserted" title="使用画布绘制自定义图形 (Canvas)"> 使用画布绘制自定义图形 (Canvas) </h1>

<div _ngcontent-ctr-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>Canvas提供画布组件，用于自定义绘制图形，开发者使用CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象在Canvas组件上进行绘制，绘制对象可以是基础形状、文本、图片等。</p>    <div class="tiledSection">     <h2 id="使用画布组件绘制自定义图形">使用画布组件绘制自定义图形<i class="anchor-icon anchor-icon-link" anchorid="使用画布组件绘制自定义图形" tips="复制节点链接"></i></h2>          <p>可以由以下三种形式在画布绘制自定义图形：</p>     <ul>      <li>       <p>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d" target="_blank">CanvasRenderingContext2D</a>对象在Canvas画布上绘制。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CanvasExample1</span> {</li><li>  <span class="hljs-comment">//用来配置CanvasRenderingContext2D对象的参数，包括是否开启抗锯齿，true表明开启抗锯齿。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-comment">//用来创建CanvasRenderingContext2D对象，通过在canvas中调用CanvasRenderingContext2D对象来绘制。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-comment">//在canvas中调用CanvasRenderingContext2D对象。</span></li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">//可以在这里绘制内容。</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">strokeRect</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="220" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.86763364044923875653284766958520:50001231000000:2800:AD9CE7158B1CAC3528385D7E85EE2F14B721269CBB380BD90338FF58868D2BB3.jpg" class="notEnlarge" width="220" height="220"></span></p></li>      <li>       <p>离屏绘制是指将需要绘制的内容先绘制在缓存区，再将其转换成图片，一次性绘制到Canvas上，加快了绘制速度。过程为：</p>       <ol>        <li>通过transferToImageBitmap方法将离屏画布最近渲染的图像创建为一个ImageBitmap对象。</li>        <li>通过CanvasRenderingContext2D对象的transferFromImageBitmap方法显示给定的ImageBitmap对象。</li>       </ol>       <p>具体使用参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-offscreencanvasrenderingcontext2d" target="_blank">OffscreenCanvasRenderingContext2D</a>对象。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CanvasExample2</span> {</li><li>  <span class="hljs-comment">//用来配置CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象的参数，包括是否开启抗锯齿。true表明开启抗锯齿</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-comment">//用来创建OffscreenCanvas对象，width为离屏画布的宽度，height为离屏画布的高度。通过在canvas中调用OffscreenCanvasRenderingContext2D对象来绘制。</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">600</span>, <span class="hljs-number">600</span>);</li><li> </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>          <span class="hljs-comment">//可以在这里绘制内容</span></li><li>          offContext.<span class="hljs-title function_">strokeRect</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>, <span class="hljs-number">150</span>);</li><li>          <span class="hljs-comment">//将离屏绘制渲染的图像在普通画布上显示</span></li><li>          <span class="hljs-keyword">let</span> image = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="220" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.73764765232156991291975171706704:50001231000000:2800:B86B7C634B62237CC6F61E8FCD167866080CD42001F39AB8CCEBD7F4BAC86332.jpg" class="notEnlarge" width="220" height="220"></span></p>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>在画布组件中，通过CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象在Canvas组件上进行绘制时调用的接口相同，另外，接口参数如无特别说明，单位均为vp。</p>        </div></div></div></li>      <li>       <p>在Canvas上加载Lottie动画时，需要先按照如下方式下载Lottie。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> lottie <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos/lottie'</span>;</li></ol></pre></div></div>       <p>具体接口请参考<a href="https://gitcode.com/openharmony-tpc/lottieArkTS" target="_blank">lottie</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="初始化画布组件">初始化画布组件<i class="anchor-icon anchor-icon-link" anchorid="初始化画布组件" tips="复制节点链接"></i></h2>          <p>onReady(event: () =&gt; void)是Canvas组件初始化完成时的事件回调，调用该事件后，可获取Canvas组件的确定宽高，进一步使用CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象调用相关API进行图形绘制。</p>     <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#0097D4'</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>  })</li></ol></pre></div></div>     <p><span><img originheight="222" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.49572640644144956553859485121186:50001231000000:2800:C63D4DCD430CE1350DA9731FF060704EEFC2CEF0E29CF8E97AA74E049FF80DDF.jpg" class="notEnlarge" width="220" height="222"></span></p>    </div>    <div class="tiledSection">     <h2 id="画布组件绘制方式">画布组件绘制方式<i class="anchor-icon anchor-icon-link" anchorid="画布组件绘制方式" tips="复制节点链接"></i></h2>          <p>在Canvas组件生命周期接口onReady()调用之后，开发者可以直接使用canvas组件进行绘制。或者可以脱离Canvas组件和onReady()生命周期，单独定义Path2d对象构造理想的路径，并在onReady()调用之后使用Canvas组件进行绘制。</p>     <ul>      <li>       <p>通过CanvasRenderingContext2D对象直接调用相关API进行绘制。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">beginPath</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">280</span>, <span class="hljs-number">160</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">stroke</span>();</li><li>   })</li></ol></pre></div></div>       <p><span><img originheight="220" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.18508123233862942925568455324722:50001231000000:2800:75B7D40B935E086F7453F21A566FCA425868B5454D591D948162DF52CCBC0DE2.jpg" class="notEnlarge" width="220" height="220"></span></p></li>      <li>       <p>先单独定义path2d对象构造理想的路径，再通过调用CanvasRenderingContext2D对象和OffscreenCanvasRenderingContext2D对象的stroke接口或者fill接口进行绘制，具体使用可以参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-path2d" target="_blank">Path2D</a>对象。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>     <span class="hljs-keyword">let</span> region = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>();</li><li>     region.<span class="hljs-title function_">arc</span>(<span class="hljs-number">100</span>, <span class="hljs-number">75</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6.28</span>);</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">stroke</span>(region);</li><li>  })</li></ol></pre></div></div>       <p><span><img originheight="219" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.84748099243671129559081342145011:50001231000000:2800:3073F09C1DBB5E8CDA09D5A3A0785DEBC02DBFF034AAF6E5FE7716478BD8786B.jpg" class="notEnlarge" width="220" height="219"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="画布组件常用方法">画布组件常用方法<i class="anchor-icon anchor-icon-link" anchorid="画布组件常用方法" tips="复制节点链接"></i></h2>          <p>OffscreenCanvasRenderingContext2D对象和CanvasRenderingContext2D对象提供了大量的属性和方法，可以用来绘制文本、图形，处理像素等，是Canvas组件的核心。常用接口有<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#fill" target="_blank">fill</a>（对封闭路径进行填充）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#clip" target="_blank">clip</a>（设置当前路径为剪切路径）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#stroke" target="_blank">stroke</a>（进行边框绘制操作）等等，同时提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#fillstyle" target="_blank">fillStyle</a>（指定绘制的填充色）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#globalalpha" target="_blank">globalAlpha</a>（设置透明度）与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#strokestyle" target="_blank">strokeStyle</a>（设置描边的颜色）等属性修改绘制内容的样式。将通过以下几个方面简单介绍画布组件常见使用方法：</p>     <ul>      <li>       <p>绘制基础形状。</p>       <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#arc" target="_blank">arc</a>（绘制弧线路径）、 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#ellipse" target="_blank">ellipse</a>（绘制一个椭圆）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#rect" target="_blank">rect</a>（创建矩形路径）等接口绘制基础形状。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>     <span class="hljs-comment">//绘制矩形</span></li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">beginPath</span>();</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">rect</span>(<span class="hljs-number">100</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-number">100</span>);</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">stroke</span>();</li><li>     <span class="hljs-comment">//绘制圆形</span></li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">beginPath</span>();</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">arc</span>(<span class="hljs-number">150</span>, <span class="hljs-number">250</span>, <span class="hljs-number">50</span>, <span class="hljs-number">0</span>, <span class="hljs-number">6.28</span>);</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">stroke</span>();</li><li>     <span class="hljs-comment">//绘制椭圆</span></li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">beginPath</span>();</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">ellipse</span>(<span class="hljs-number">150</span>, <span class="hljs-number">450</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0.25</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>);</li><li>     <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">stroke</span>();</li><li>  })</li></ol></pre></div></div>       <p><span><img originheight="355" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.08396192679991946299813849683060:50001231000000:2800:EFE696A98B02BEF62105EB0ED131C6C549B6DCC39AB6C04FF684D75295C00516.jpg" class="notEnlarge" width="220" height="355"></span></p></li>      <li>       <p>绘制文本。</p>       <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#filltext" target="_blank">fillText</a>（文本填充）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#stroketext" target="_blank">strokeText</a>（文本描边）等接口进行文本绘制，示例中设置了font为50像素高加粗的"sans-serif"字体，然后调用fillText方法在(50, 100)处绘制文本"Hello World!"，设置strokeStyle为红色，lineWidth为2，font为50像素高加粗的"sans-serif"字体，然后调用strokeText方法在(50, 150)处绘制文本"Hello World!"的轮廓。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">// 文本填充</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'50px bolder sans-serif'</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>);</li><li>    <span class="hljs-comment">// 文本描边</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-string">"#ff0000"</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">2</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'50px bolder sans-serif'</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">strokeText</span>(<span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">50</span>, <span class="hljs-number">150</span>);</li><li>  })</li></ol></pre></div></div>       <p><span><img originheight="360" originwidth="360" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114902.94968308083853019301162709040116:50001231000000:2800:198597104F7946A33DF50EDFA9171E9A12A52EBC3C00955A07F681E66A36143A.jpg" width="360" height="360"></span></p></li>      <li>       <p>绘制文本边框。</p>       <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#measuretext" target="_blank">measureText</a>（文本测量）计算绘制文本的宽度和高度，使用测量的宽度和高度作为边框的尺寸。在示例中，设置textBaseline为'top'，font为30像素的"monospace"字体，通过measureText测量出文本的宽度和高度，然后调用fillText方法在(20, 100)处绘制文本"Hello World!"，并调用strokeRect方法在同一位置使用测量的宽度和高度绘制相应尺寸的边框。接着，设置font为60像素的粗体"sans-serif"字体，再次通过measureText测量文本的宽度和高度，接着调用fillText方法在(20, 150)处绘制文本"Hello World!"，并调用strokeRect方法在同一位置使用测量的宽度和高度绘制对应尺寸的边框。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// xxx.ets</span></li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct measureTextAndRect {</li><li>  <span class="hljs-attr">drawText</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"Hello World"</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 文本的水平对齐方式为'top'</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">textBaseline</span> = <span class="hljs-string">'top'</span></li><li>          <span class="hljs-comment">// 文本字号为30px，字体系列为monospace</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'30px monospace'</span></li><li>          <span class="hljs-keyword">let</span> textWidth = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">measureText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>).<span class="hljs-property">width</span></li><li>          <span class="hljs-keyword">let</span> textHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">measureText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>).<span class="hljs-property">height</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>, <span class="hljs-number">20</span>, <span class="hljs-number">100</span>)</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">strokeRect</span>(<span class="hljs-number">20</span>, <span class="hljs-number">100</span>, textWidth, textHeight)</li><li>          <span class="hljs-comment">// 文本字体粗细为粗体，字号为60px，字体系列为sans-serif</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'bold 60px sans-serif'</span></li><li>          textWidth = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">measureText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>).<span class="hljs-property">width</span></li><li>          textHeight = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">measureText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>).<span class="hljs-property">height</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">drawText</span>, <span class="hljs-number">20</span>, <span class="hljs-number">150</span>)</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">strokeRect</span>(<span class="hljs-number">20</span>, <span class="hljs-number">150</span>, textWidth, textHeight)</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="287" originwidth="361" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.88545247438897428662190340562576:50001231000000:2800:E434DCA5E11BEDABD04167AAAE3F201C56AAAE4F77A99D8711116400B38A847B.png" width="361" height="287"></span></p></li>      <li>       <p>使用自定义字体绘制文本。</p>       <p>从API version 20开始，可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#getglobalinstance" target="_blank">getGlobalInstance</a>获取应用全局字体管理器的实例，然后使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-graphics-text#loadfontsync" target="_blank">loadfontsync</a>接口从设置的路径中加载自定义字体并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#font" target="_blank">font</a>（设置文本绘制中的字体样式）接口设置文本绘制中的字体样式，接着通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#filltext" target="_blank">fillText</a>（绘制填充类文本）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#stroketext" target="_blank">strokeText</a>（绘制描边类文本）等接口进行文本绘制。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { text } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkGraphics2D'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CustomFont</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">//加载自定义字体</span></li><li>          <span class="hljs-keyword">let</span> fontCollection = text.<span class="hljs-property">FontCollection</span>.<span class="hljs-title function_">getGlobalInstance</span>();</li><li>          fontCollection.<span class="hljs-title function_">loadFontSync</span>(<span class="hljs-string">'customFont'</span>, $rawfile(<span class="hljs-string">"customFont.ttf"</span>))</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'30vp customFont'</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">50</span>)</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">strokeText</span>(<span class="hljs-string">"Hello World!"</span>, <span class="hljs-number">20</span>, <span class="hljs-number">100</span>)</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="213" originwidth="392" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.39425321460960743355309650859742:50001231000000:2800:075636013850521CEAA6AACB18DF57EC39DE6DB58FCE03D97E404082DFDE74B2.jpeg" width="392" height="213"></span></p></li>      <li>       <p>绘制图片和图像像素信息处理。</p>       <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#drawimage" target="_blank">drawImage</a>（图像绘制）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#putimagedata" target="_blank">putImageData</a>（使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-imagedata" target="_blank">ImageData</a>数据填充新的矩形区域）等接口绘制图片，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#createimagedata" target="_blank">createImageData</a>（创建新的ImageData 对象）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#getpixelmap" target="_blank">getPixelMap</a>（以当前canvas指定区域内的像素创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-image-pixelmap" target="_blank">PixelMap</a>对象）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#getimagedata" target="_blank">getImageData</a>（以当前canvas指定区域内的像素创建ImageData对象）等接口进行图像像素信息处理。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">GetImageData</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">offCanvas</span>: <span class="hljs-title class_">OffscreenCanvas</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">OffscreenCanvas</span>(<span class="hljs-number">600</span>, <span class="hljs-number">600</span>);</li><li>  <span class="hljs-comment">// "/common/images/1234.png"需要替换为开发者所需的图像资源文件</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">img</span>: <span class="hljs-title class_">ImageBitmap</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ImageBitmap</span>(<span class="hljs-string">"/common/images/1234.png"</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> offContext = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">getContext</span>(<span class="hljs-string">"2d"</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>)</li><li>          <span class="hljs-comment">// 使用drawImage接口将图片画在（0，0）为起点，宽高130的区域</span></li><li>          offContext.<span class="hljs-title function_">drawImage</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">img</span>, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">130</span>, <span class="hljs-number">130</span>);</li><li>          <span class="hljs-comment">// 使用getImageData接口，获得canvas组件区域中，（50，50）为起点，宽高130范围内的绘制内容</span></li><li>          <span class="hljs-keyword">let</span> imageData = offContext.<span class="hljs-title function_">getImageData</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">130</span>, <span class="hljs-number">130</span>);</li><li>          <span class="hljs-comment">// 使用putImageData接口将得到的ImageData画在起点为（150， 150）的区域中</span></li><li>          offContext.<span class="hljs-title function_">putImageData</span>(imageData, <span class="hljs-number">150</span>, <span class="hljs-number">150</span>);</li><li>          <span class="hljs-comment">// 将离屏绘制的内容画到canvas组件上</span></li><li>          <span class="hljs-keyword">let</span> image = <span class="hljs-variable language_">this</span>.<span class="hljs-property">offCanvas</span>.<span class="hljs-title function_">transferToImageBitmap</span>();</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">transferFromImageBitmap</span>(image);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="168" originwidth="167" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.39241209333007701430482880125274:50001231000000:2800:AF0A027E2D01BD270F8FD3E580116599D3832F82B7FBC9CA3AD35D3F31437F67.png" class="notEnlarge" width="167" height="168"></span></p></li>      <li>       <p>其他方法。</p>       <p>Canvas中还提供其他类型的方法。渐变（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-components-canvas-canvasgradient" target="_blank">CanvasGradient</a>对象）相关的方法：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#createlineargradient" target="_blank">createLinearGradient</a>（创建一个线性渐变色）、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#createradialgradient" target="_blank">createRadialGradient</a>（创建一个径向渐变色）等。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>  .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>  .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-comment">//创建一个径向渐变色的CanvasGradient对象</span></li><li>    <span class="hljs-keyword">let</span> grad = <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">createRadialGradient</span>(<span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>)</li><li>    <span class="hljs-comment">//为CanvasGradient对象设置渐变断点值，包括偏移和颜色</span></li><li>    grad.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.0</span>, <span class="hljs-string">'#E87361'</span>);</li><li>    grad.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">0.5</span>, <span class="hljs-string">'#FFFFF0'</span>);</li><li>    grad.<span class="hljs-title function_">addColorStop</span>(<span class="hljs-number">1.0</span>, <span class="hljs-string">'#BDDB69'</span>);</li><li>    <span class="hljs-comment">//用CanvasGradient对象填充矩形</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = grad;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">400</span>, <span class="hljs-number">400</span>);</li><li>  })</li></ol></pre></div></div>       <p><span><img originheight="220" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.50323313948072047374234083228130:50001231000000:2800:AD745E54CCF1C86BE12434C3723E54B6591C7C69F8126FCCD14B39C2489C7258.jpg" class="notEnlarge" width="220" height="220"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="使用状态变量驱动画布刷新">使用状态变量驱动画布刷新<i class="anchor-icon anchor-icon-link" anchorid="使用状态变量驱动画布刷新" tips="复制节点链接"></i></h2>          <p>可以使用状态变量来驱动Canvas刷新，将变化的数据通过@Watch监听，并绑定自定义的draw()方法。当数据刷新时，@Watch绑定的方法会执行绘制逻辑，使Canvas刷新。</p>     <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CanvasContentUpdate</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'draw'</span>)<span class="hljs-attr">content</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello World'</span>;</li><li>
</li><li>  <span class="hljs-title function_">draw</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">400</span>, <span class="hljs-number">200</span>); <span class="hljs-comment">// 清空Canvas的内容</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>); <span class="hljs-comment">// 重新绘制</span></li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'25%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'rgb(39, 135, 217)'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">font</span> = <span class="hljs-string">'65px sans-serif'</span>;</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillText</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">content</span>, <span class="hljs-number">50</span>, <span class="hljs-number">100</span>);</li><li>        })</li><li>      <span class="hljs-title class_">TextInput</span>({</li><li>        <span class="hljs-attr">text</span>:$$this.<span class="hljs-property">content</span> <span class="hljs-comment">// 修改文本输入框里的内容时，状态变量的更新会驱动Canvas刷新</span></li><li>      })</li><li>        .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">35</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>     <p><span><img originheight="250" originwidth="360" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.47491785959179583953710220862834:50001231000000:2800:D3A8334434D3FF2B58FB972ECA00C5031F9EAFFD12A7C8D5F3BC5E38ADF11B55.gif" width="360" height="250"></span></p>    </div>    <div class="tiledSection">     <h2 id="控制在画布组件不可见时不进行绘制">控制在画布组件不可见时不进行绘制<i class="anchor-icon anchor-icon-link" anchorid="控制在画布组件不可见时不进行绘制" tips="复制节点链接"></i></h2>          <p>可以使用以下两种方式监听Canvas组件可见性，避免不可见时仍在无效绘制。</p>     <ul>      <li>       <p>从API version 13开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-uicommonevent#setonvisibleareaapproximatechange" target="_blank">setOnVisibleAreaApproximateChange</a>接口监听Canvas组件可见性。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ColorMetrics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasContext</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timerId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">drawRandomCircle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">center</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span> + <span class="hljs-number">50</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span> + <span class="hljs-number">50</span>]</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span> + <span class="hljs-number">10</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">ColorMetrics</span> =</li><li>      <span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">rgba</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>),</li><li>        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>))</li><li>
</li><li>    <span class="hljs-comment">// 清空原先内容与画布状态</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">reset</span>()</li><li>
</li><li>    <span class="hljs-comment">// 开始绘制</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">fillStyle</span> = color.<span class="hljs-property">color</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()</li><li>    path.<span class="hljs-title function_">ellipse</span>(center[<span class="hljs-number">0</span>], center[<span class="hljs-number">1</span>], radius, radius, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">fill</span>(path)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">let</span> frameNode = <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">canvas</span>;</li><li>          frameNode.<span class="hljs-property">commonEvent</span>.<span class="hljs-title function_">setOnVisibleAreaApproximateChange</span>({ <span class="hljs-attr">ratios</span>: [<span class="hljs-number">0.0</span>] },</li><li>            <span class="hljs-function">(<span class="hljs-params">isVisible: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            <span class="hljs-comment">// canvas不可见</span></li><li>            <span class="hljs-keyword">if</span> (!isVisible &amp;&amp; currentRatio &lt;= <span class="hljs-number">0</span>) {</li><li>              <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span>)</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = -<span class="hljs-number">2</span></li><li>            }</li><li>            <span class="hljs-comment">// canvas可见</span></li><li>            <span class="hljs-keyword">if</span> (isVisible) {</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> == -<span class="hljs-number">2</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawRandomCircle</span>()</li><li>                }, <span class="hljs-number">500</span>)</li><li>              }</li><li>            }</li><li>          })</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"draw sth"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> &lt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawRandomCircle</span>()</li><li>            }, <span class="hljs-number">500</span>)</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="460" originwidth="342" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.97723802595497024875578242819519:50001231000000:2800:69311D27E7B99FE8CA489A0A870BAE0F46D23920EB395D580EAE392498786328.gif" width="342" height="460"></span></p></li>      <li>       <p>从API version 17开始，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-universal-component-visible-area-change-event#onvisibleareaapproximatechange17" target="_blank">onVisibleAreaApproximateChange</a>接口监听Canvas组件可见性。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ColorMetrics</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Page</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasContext</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>()</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">timerId</span>: <span class="hljs-built_in">number</span> = -<span class="hljs-number">1</span>;</li><li>
</li><li>  <span class="hljs-title function_">drawRandomCircle</span>(): <span class="hljs-built_in">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">center</span>: [<span class="hljs-built_in">number</span>, <span class="hljs-built_in">number</span>] = [<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span> + <span class="hljs-number">50</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">200</span> + <span class="hljs-number">50</span>]</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">radius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">20</span> + <span class="hljs-number">10</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">ColorMetrics</span> =</li><li>      <span class="hljs-title class_">ColorMetrics</span>.<span class="hljs-title function_">rgba</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>), <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>),</li><li>        <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-title class_">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">255</span>))</li><li>
</li><li>    <span class="hljs-comment">// 清空原先内容与画布状态</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">reset</span>()</li><li>
</li><li>    <span class="hljs-comment">// 开始绘制</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">fillStyle</span> = color.<span class="hljs-property">color</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">path</span>: <span class="hljs-title class_">Path2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>()</li><li>    path.<span class="hljs-title function_">ellipse</span>(center[<span class="hljs-number">0</span>], center[<span class="hljs-number">1</span>], radius, radius, <span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span> * <span class="hljs-number">2</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">fill</span>(path)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">onVisibleAreaApproximateChange</span>({ <span class="hljs-attr">ratios</span>: [<span class="hljs-number">0.0</span>] },</li><li>            <span class="hljs-function">(<span class="hljs-params">isVisible: <span class="hljs-built_in">boolean</span>, currentRatio: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>              <span class="hljs-comment">// canvas不可见</span></li><li>              <span class="hljs-keyword">if</span> (!isVisible &amp;&amp; currentRatio &lt;= <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-built_in">clearInterval</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span>)</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = -<span class="hljs-number">2</span></li><li>              }</li><li>              <span class="hljs-comment">// canvas可见</span></li><li>              <span class="hljs-keyword">if</span> (isVisible) {</li><li>                <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> == -<span class="hljs-number">2</span>) {</li><li>                  <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawRandomCircle</span>()</li><li>                  }, <span class="hljs-number">500</span>)</li><li>                }</li><li>              }</li><li>            })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"draw sth"</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> &lt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">timerId</span> = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawRandomCircle</span>()</li><li>            }, <span class="hljs-number">500</span>)</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="460" originwidth="342" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.79444349401337558026019436267650:50001231000000:2800:A1FCAA61B576C9748395C511BAB1AD9B0813C993E431477A835CC9797A91E1BF.gif" width="342" height="460"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="场景示例">场景示例<i class="anchor-icon anchor-icon-link" anchorid="场景示例" tips="复制节点链接"></i></h2>          <ul>      <li>       <p>绘制规则基础形状。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ClearRect</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Flex</span>({ <span class="hljs-attr">direction</span>: <span class="hljs-title class_">FlexDirection</span>.<span class="hljs-property">Column</span>, <span class="hljs-attr">alignItems</span>: <span class="hljs-title class_">ItemAlign</span>.<span class="hljs-property">Center</span>, <span class="hljs-attr">justifyContent</span>: <span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span> }) {</li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 设定填充样式，填充颜色设为蓝色</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#0097D4'</span>;</li><li>          <span class="hljs-comment">// 以(50, 50)为左上顶点，画一个宽高200的矩形</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fillRect</span>(<span class="hljs-number">50</span>, <span class="hljs-number">50</span>, <span class="hljs-number">200</span>, <span class="hljs-number">200</span>);</li><li>          <span class="hljs-comment">// 以(70, 70)为左上顶点，清除宽150高100的区域</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">70</span>, <span class="hljs-number">70</span>, <span class="hljs-number">150</span>, <span class="hljs-number">100</span>);</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="219" originwidth="220" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.14790976876312279481269373592951:50001231000000:2800:43C64F01DCFF1CE0FCA9FDABE23802BEBDDDB8083017BE8EAEBC51117DE7DBEB.jpg" class="notEnlarge" width="220" height="219"></span></p></li>      <li>       <p>绘制不规则图形。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Path2</span>d {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">context</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  </li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>)</li><li>          .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#F5DC62'</span>)</li><li>          .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>            <span class="hljs-comment">// 使用Path2D的接口构造一个五边形</span></li><li>            <span class="hljs-keyword">let</span> path = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Path2D</span>();</li><li>            path.<span class="hljs-title function_">moveTo</span>(<span class="hljs-number">150</span>, <span class="hljs-number">50</span>);</li><li>            path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">50</span>, <span class="hljs-number">150</span>);</li><li>            path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">100</span>, <span class="hljs-number">250</span>);</li><li>            path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">200</span>, <span class="hljs-number">250</span>);</li><li>            path.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">250</span>, <span class="hljs-number">150</span>);</li><li>            path.<span class="hljs-title function_">closePath</span>();</li><li>            <span class="hljs-comment">// 设定填充色为蓝色</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-string">'#0097D4'</span>;</li><li>            <span class="hljs-comment">// 使用填充的方式，将Path2D描述的五边形绘制在canvas组件内部</span></li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">context</span>.<span class="hljs-title function_">fill</span>(path);</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="219" originwidth="360" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.50782685866558136418097017001240:50001231000000:2800:CA1B7B854B6B0C6677F785F744B84AFD6CE7DF642AF99A0ADF38922E5847E661.jpg" width="360" height="219"></span></p></li>      <li>       <p>绘制可拖动的光标。</p>       <p>可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#beginpath" target="_blank">beginPath</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#moveto" target="_blank">moveTo</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#lineto" target="_blank">lineTo</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#arc" target="_blank">arc</a>方法设置光标的位置，使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#stroke" target="_blank">stroke</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-canvasrenderingcontext2d#fill" target="_blank">fill</a>方法绘制光标，将是否按下和位置变化通过@Watch监听，并绑定自定义的drawCursor()方法。当拖动光标时，@Watch绑定的方法会执行绘制逻辑，计算并更新光标的颜色和位置。</p>       <div _ngcontent-ctr-c106="" class="highlight-div"><div _ngcontent-ctr-c106="" class="highlight-div-header"><div _ngcontent-ctr-c106="" class="highlight-div-header-left"><div _ngcontent-ctr-c106="" class="handle-button expand-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ctr-c106="" class="highlight-div-header-right"><div _ngcontent-ctr-c106="" class="handle-button ai-button"></div><div _ngcontent-ctr-c106="" class="handle-button line-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ctr-c106="" class="handle-button theme-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ctr-c106="" class="handle-button copy-button"><div _ngcontent-ctr-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ctr-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">CursorMoving</span> {</li><li>  <span class="hljs-comment">// 监听是否按下，刷新光标颜色</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'drawCursor'</span>) <span class="hljs-attr">isTouchDown</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></li><li>  <span class="hljs-comment">// 监听位置变化，刷新页面</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-meta">@Watch</span>(<span class="hljs-string">'drawCursor'</span>) <span class="hljs-attr">cursorPosition</span>: <span class="hljs-title class_">RectPosition</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">width</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">height</span>: <span class="hljs-number">0</span>,</li><li>  }</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">settings</span>: <span class="hljs-title class_">RenderingContextSettings</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">RenderingContextSettings</span>(<span class="hljs-literal">true</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">canvasContext</span>: <span class="hljs-title class_">CanvasRenderingContext2D</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">CanvasRenderingContext2D</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">settings</span>);</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">sw</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">360</span>; <span class="hljs-comment">// Canvas固定宽度</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">sh</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">270</span>; <span class="hljs-comment">// Canvas固定高度</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">cursorWH</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">50</span>; <span class="hljs-comment">// 光标区域宽高</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">dashedLineW</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">7</span>; <span class="hljs-comment">// 光标宽高</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">arcRadius</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">6</span>; <span class="hljs-comment">// 光标中心圆半径</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">isReadyMove</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span></li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">touchPosition</span>: <span class="hljs-title class_">Position</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>  };</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">cursorCenterPosition</span>: <span class="hljs-title class_">Position</span> = {</li><li>    <span class="hljs-attr">x</span>: <span class="hljs-number">0</span>,</li><li>    <span class="hljs-attr">y</span>: <span class="hljs-number">0</span>,</li><li>  };</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 绘制光标</span></li><li>      <span class="hljs-title class_">Canvas</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-string">'#D5D5D5'</span>)</li><li>        .<span class="hljs-title function_">onReady</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorWH</span>) / <span class="hljs-number">2</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> = (<span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorWH</span>) / <span class="hljs-number">2</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorWH</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorWH</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span> = {</li><li>            <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>,</li><li>            <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span></li><li>          }</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">drawCursor</span>()</li><li>        })</li><li>        .<span class="hljs-title function_">onTouch</span>(<span class="hljs-function"><span class="hljs-params">event</span> =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">TouchType</span>.<span class="hljs-property">Down</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isReadyMove</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">isTouchCursorArea</span>(event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>]);</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isReadyMove</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTouchDown</span> = <span class="hljs-literal">true</span></li><li>            }</li><li>
</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPosition</span> = {</li><li>              <span class="hljs-attr">x</span>: event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayX</span>,</li><li>              <span class="hljs-attr">y</span>: event.<span class="hljs-property">touches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayY</span></li><li>            }</li><li>          } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (event.<span class="hljs-property">type</span> === <span class="hljs-title class_">TouchType</span>.<span class="hljs-property">Move</span>) {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">isReadyMove</span>) {</li><li>              <span class="hljs-keyword">let</span> moveX = event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayX</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPosition</span>.<span class="hljs-property">x</span>;</li><li>              <span class="hljs-keyword">let</span> moveY = event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayY</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPosition</span>.<span class="hljs-property">y</span>;</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">touchPosition</span> = {</li><li>                <span class="hljs-attr">x</span>: event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayX</span>,</li><li>                <span class="hljs-attr">y</span>: event.<span class="hljs-property">changedTouches</span>[<span class="hljs-number">0</span>].<span class="hljs-property">displayY</span></li><li>              }</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> += moveX;</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> += moveY;</li><li>
</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span> = {</li><li>                <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>,</li><li>                <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span></li><li>              }</li><li>              <span class="hljs-comment">// 光标区域中心点位置限制</span></li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">x</span> &lt; <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> = -<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span></li><li>              }</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">y</span> &lt; <span class="hljs-number">0</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> = -<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span></li><li>              }</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">x</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span></li><li>              }</li><li>              <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">y</span> &gt; <span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span>) {</li><li>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span></li><li>              }</li><li>            }</li><li>          } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTouchDown</span> = <span class="hljs-literal">false</span></li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    .<span class="hljs-title function_">justifyContent</span>(<span class="hljs-title class_">FlexAlign</span>.<span class="hljs-property">Center</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 绘制裁剪框</span></li><li>  <span class="hljs-title function_">drawCursor</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 算出菱形四个点</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">positionL</span>: <span class="hljs-title class_">Position</span> = { <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span> }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">positionT</span>: <span class="hljs-title class_">Position</span> = { <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">positionR</span>: <span class="hljs-title class_">Position</span> = {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span>,</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span> / <span class="hljs-number">2</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">positionB</span>: <span class="hljs-title class_">Position</span> = {</li><li>      <span class="hljs-attr">x</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>,</li><li>      <span class="hljs-attr">y</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">height</span></li><li>    }</li><li>    <span class="hljs-keyword">let</span> lineWidth = <span class="hljs-number">2</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">clearRect</span>(<span class="hljs-number">0</span>, <span class="hljs-number">0</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">lineWidth</span> = lineWidth</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTouchDown</span> ? <span class="hljs-string">'#ff1a5cae'</span> : <span class="hljs-string">'#ffffffff'</span></li><li>
</li><li>    <span class="hljs-comment">// 画出四角</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">beginPath</span>()</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionL.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionL.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionL.<span class="hljs-property">x</span>, positionL.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionL.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionL.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionT.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionT.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionT.<span class="hljs-property">x</span>, positionT.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionT.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionT.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionR.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionR.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionR.<span class="hljs-property">x</span>, positionR.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionR.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionR.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionB.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionB.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionB.<span class="hljs-property">x</span>, positionB.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionB.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>, positionB.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">dashedLineW</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">stroke</span>()</li><li>
</li><li>    <span class="hljs-comment">// 画出中心圆</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">beginPath</span>()</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">strokeStyle</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTouchDown</span> ? <span class="hljs-string">'#ff1a5cae'</span> : <span class="hljs-string">'#ff9ba59b'</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">fillStyle</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">isTouchDown</span> ? <span class="hljs-string">'#ff1a5cae'</span> : <span class="hljs-string">'#ff9ba59b'</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">arc</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">x</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>,</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">y</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorPosition</span>.<span class="hljs-property">width</span> / <span class="hljs-number">2</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">arcRadius</span>, <span class="hljs-number">0</span>, <span class="hljs-number">2</span> * <span class="hljs-title class_">Math</span>.<span class="hljs-property">PI</span>)</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">fill</span>()</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">stroke</span>()</li><li>
</li><li>    <span class="hljs-comment">// 画出四条线</span></li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">beginPath</span>();</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-property">lineWidth</span> = <span class="hljs-number">0.7</span>;</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionL.<span class="hljs-property">x</span>, positionL.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(<span class="hljs-number">0</span>, positionL.<span class="hljs-property">y</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionT.<span class="hljs-property">x</span>, positionT.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionT.<span class="hljs-property">x</span>, <span class="hljs-number">0</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionR.<span class="hljs-property">x</span>, positionR.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">sw</span>, positionR.<span class="hljs-property">y</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">moveTo</span>(positionB.<span class="hljs-property">x</span>, positionB.<span class="hljs-property">y</span>);</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">lineTo</span>(positionB.<span class="hljs-property">x</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">sh</span>);</li><li>
</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">canvasContext</span>.<span class="hljs-title function_">stroke</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 判断点击位置是否在棱形中</span></li><li>  <span class="hljs-title function_">isTouchCursorArea</span>(<span class="hljs-params">touch: TouchObject</span>) {</li><li>    <span class="hljs-keyword">let</span> tempLength = <span class="hljs-title class_">Math</span>.<span class="hljs-title function_">sqrt</span>((touch.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">x</span>) * (touch.<span class="hljs-property">x</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">x</span>) +</li><li>      (touch.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">y</span>) * (touch.<span class="hljs-property">y</span> - <span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorCenterPosition</span>.<span class="hljs-property">y</span>))</li><li>    <span class="hljs-keyword">if</span> (tempLength &lt; (<span class="hljs-variable language_">this</span>.<span class="hljs-property">cursorWH</span> / <span class="hljs-number">2</span> / <span class="hljs-number">1.414</span>)) {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span></li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span></li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">RectPosition</span> {</li><li>  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">height</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">width</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Position</span> {</li><li>  <span class="hljs-attr">x</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">y</span>: <span class="hljs-built_in">number</span>;</li><li>}</li></ol></pre></div></div>       <p><span><img originheight="405" originwidth="540" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114903.47670045097258534602811087468950:50001231000000:2800:36C0050CD986F5FC0515566F7F0E6148715498909E15E66CCEC8C468BC73FA59.gif" width="540" height="405"></span></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="示例代码">示例代码<i class="anchor-icon anchor-icon-link" anchorid="示例代码" tips="复制节点链接"></i></h2>          <ul>      <li><a href="https://gitcode.com/harmonyos_samples/custom-canvas" target="_blank">自定义Canvas画布</a></li>     </ul>    </div>   </div>   <div></div></div>