<h1 _ngcontent-ufo-c119="" class="doc-title ng-star-inserted" title="使用相机预配置(ArkTS)"> 使用相机预配置(ArkTS) </h1>

<div _ngcontent-ufo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>相机预配置（Preconfig），对常用的场景和分辨率进行了预配置集成，可简化开发相机应用流程，提高应用的开发效率。</p> <p>开发者在开发相机应用时，在获取到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameradevice" target="_blank">CameraDevice</a>之后，如果遵循通用流程开发，步骤较为繁琐。需要先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager" target="_blank">CameraManager</a>的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#getsupportedoutputcapability11" target="_blank">getSupportedOutputCapability</a>来查询当前相机在指定模式下所支持的各类输出的配置信息，拿到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>之后，应用开发者还需要对里面的各类数据进行解析，筛选，找到自己需要的配置数据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#profile" target="_blank">Profile</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#videoprofile" target="_blank">VideoProfile</a>。最后使用对应的Profile以及VideoProfile创建对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-previewoutput" target="_blank">PreviewOutput</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput" target="_blank">PhotoOutput</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-videooutput" target="_blank">VideoOutput</a>。</p> <p>为了解决上述问题，优化应用开发流程，系统针对拍照（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession" target="_blank">PhotoSession</a>）、录像（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-videosession" target="_blank">VideoSession</a>）两类场景，提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession#preconfig12" target="_blank">preconfig</a>接口帮助开发者快速完成相机参数配置。推荐仅需要自定义拍照界面的无需开发专业相机应用的开发者，使用相机预配置功能快速开发应用。</p> <p>在开发相机应用时，需要先<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation" target="_blank">申请相关权限</a>。以拍照（PhotoSession）为例，相机预配置（Preconfig）开发流程与<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-shooting-case" target="_blank">通用流程</a>开发，存在以下差异：</p> <p><span><img originheight="1477" originwidth="1074" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114440.55071399187928491061832022622567:50001231000000:2800:77DC509AF9DF118595D897FAA594AC659733F14679C1005F745C5C8A5A1F0E9B.png" width="920" height="1265.214152700186"></span></p> <p><strong>其他相关能力：</strong></p> <ul><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-picker" target="_blank">CameraPicker</a>：无需开发相机功能，拉起系统相机获取照片或视频。</li><li><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation" target="_blank">调用全量相机接口开发</a>：可开发自定义界面、分辨率、图像效果的专业相机应用。</li></ul> <div class="tiledSection"><h2 id="section1207155472118">规格说明<i class="anchor-icon anchor-icon-link" anchorid="section1207155472118" tips="复制节点链接"></i></h2><p>系统提供了4种预配置类型（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#preconfigtype12" target="_blank">PreconfigType</a>），分别为PRECONFIG_720P、PRECONFIG_1080P、PRECONFIG_4K、PRECONFIG_HIGH_QUALITY。以及3种画幅比例规格（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#preconfigratio12" target="_blank">PreconfigRatio</a>），1:1画幅（PRECONFIG_RATIO_1_1）、4:3画幅（PRECONFIG_RATIO_4_3）、16:9画幅（PRECONFIG_RATIO_16_9）。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>由于不同的设备所支持的能力不同。使用相机预配置（preconfig）功能时，需要先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession#canpreconfig12" target="_blank">canPreconfig</a>检查对应的PreconfigType和PreconfigRatio的组合在当前设备上是否支持。</p> </div></div></div> <p>在不同的画幅比例下，其分辨率规格不同，详见下表。</p> <ul><li>普通拍照模式下的预览输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.1.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.1.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1440</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1440</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2560x1440</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通拍照模式下的拍照输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.2.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.2.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.2.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.2.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的预览输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.3.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.3.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.3.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.3.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的录像输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.4.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.4.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.4.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.4.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的拍照输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.8.5.5.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.5.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.5.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.8.5.5.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor（镜头）最大能力</p> </td> </tr>  </tbody></table></div> </div> </li></ul> </div> <div class="tiledSection"><h2 id="section914172110528">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section914172110528" tips="复制节点链接"></i></h2><p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-camera" target="_blank">Camera API参考</a>。</p> <ol><li><p>导入相关接口。</p> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div> </li><li><p>创建输出流Output。</p> <p>此处以创建预览流和拍照流为例。</p> <p>创建预览输出流时，涉及参数surfaceId。XComponent组件为预览流提供Surface（获取surfaceId请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent#getxcomponentsurfaceid9" target="_blank">getXcomponentSurfaceId</a>方法），而XComponent的能力由UI提供，相关介绍可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/ts-basic-components-xcomponent" target="_blank">XComponent组件参考</a>。</p> <p>创建cameraManager对象的方法可参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-f#cameragetcameramanager" target="_blank">getCameraManager</a>。</p> <div class="p">Context获取方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息" target="_blank">获取UIAbility的上下文信息</a>。<div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCameraOutput</span>(<span class="hljs-params">context: common.BaseContext, surfaceId: string</span>) : <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// 创建预览输出流</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">previewOutput</span>: camera.<span class="hljs-property">PreviewOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">let</span> cameraManager = camera.<span class="hljs-title function_">getCameraManager</span>(context);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    previewOutput = cameraManager.<span class="hljs-title function_">createPreviewOutput</span>(surfaceId);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create the PreviewOutput instance. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (previewOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建拍照输出流</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOutput</span>: camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to createPhotoOutput errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div> </div> </li><li><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager" target="_blank">CameraManager</a>中的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createcamerainput" target="_blank">createCameraInput</a>方法，创建输入流Input。</p> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">createAndOpenCameraInput</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>) : <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-comment">// 获取相机列表</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>  <span class="hljs-keyword">if</span> (cameraArray.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"cameraManager.getSupportedCameras error"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraInput = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraArray[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to createCameraInput errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (cameraInput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 打开相机</span></li><li>  <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>();</li><li>}</li></ol></pre></div></div> </li><li><p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createsession11" target="_blank">createSession</a>创建会话（Session）。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>SceneMode需要指定为NORMAL_PHOTO或NORMAL_VIDEO，对应拍照场景<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession" target="_blank">PhotoSession</a>和录像场景<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-videosession" target="_blank">VideoSession</a>。</p> </div></div></div> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">createCameraSession</span>(<span class="hljs-params">cameraManager: camera.CameraManager</span>) : <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">//创建会话</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoSession</span>: camera.<span class="hljs-property">PhotoSession</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession = cameraManager.<span class="hljs-title function_">createSession</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to create the session instance. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (photoSession === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div> </li><li><div class="p">调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession#canpreconfig12" target="_blank">canPreconfig</a>检查对应的PreconfigType和PreconfigRatio的组合在当前设备上是否支持。确认支持后，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photosession#preconfig12" target="_blank">preconfig</a>启用Preconfig配置。<div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">GetPreconfig</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>) : <span class="hljs-keyword">void</span> {</li><li>  <span class="hljs-comment">// 查询Preconfig能力</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> isPreconfigSupport = photoSession.<span class="hljs-title function_">canPreconfig</span>(camera.<span class="hljs-property">PreconfigType</span>.<span class="hljs-property">PRECONFIG_1080P</span>);</li><li>    <span class="hljs-keyword">if</span> (!isPreconfigSupport) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PhotoSession canPreconfig check fail.'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to call canPreconfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 配置Preconfig</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">preconfig</span>(camera.<span class="hljs-property">PreconfigType</span>.<span class="hljs-property">PRECONFIG_1080P</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to call preconfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>}</li></ol></pre></div></div> </div> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>若当前模式为普通录像模式，且<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#preconfigtype12" target="_blank">PreConfigType</a>使用PRECONFIG_HIGH_QUALITY类型时，为避免录制失败，请务必将<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-i#avrecorderprofile9" target="_blank">AVRecorderProfile</a>配置文件中videoCodec参数必须配置为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-media-e#codecmimetype8" target="_blank">VIDEO_HEVC</a>，isHdr参数配置为true。</p> </div></div></div> </li><li><p>Session添加Input和Output。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>Session调用preconfig接口成功之后，Session内部会将预置数据准备好，如果向Session中进行添加未配置Profile的Output，Session则会对相应的Output进行配置对应Profile。如果向Session中添加已配置Profile的Output，则Session的预配置数据不生效。</p> </div></div></div> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">initCamera</span>(<span class="hljs-params">photoSession: camera.PhotoSession, cameraInput: camera.CameraInput,</span></li><li><span class="hljs-params">  previewOutput: camera.PreviewOutput, photoOutput: camera.PhotoOutput</span>) : <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-comment">// 开始配置会话</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">beginConfig</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to beginConfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加相机输入流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addInput. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加预览输出流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addOutput(previewOutput). errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加拍照输出流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(photoOutput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addOutput(photoOutput). errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-comment">// 提交会话配置</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">commitConfig</span>();</li><li>}</li></ol></pre></div></div> </li><li><p>启动Session。</p> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startCamera</span>(<span class="hljs-params">photoSession: camera.PhotoSession</span>) : <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-keyword">void</span>&gt; {</li><li>  <span class="hljs-comment">// 启动会话</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">start</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Promise returned to indicate the session start success.'</span>);</li><li>  });</li><li>}</li></ol></pre></div></div> </li></ol> </div> <div class="tiledSection"><h2 id="完整示例">完整示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2><p>Context获取方式请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/uiability-usage#获取uiability的上下文信息" target="_blank">获取UIAbility的上下文信息</a>。</p> <div _ngcontent-ufo-c106="" class="highlight-div"><div _ngcontent-ufo-c106="" class="highlight-div-header"><div _ngcontent-ufo-c106="" class="highlight-div-header-left"><div _ngcontent-ufo-c106="" class="handle-button expand-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ufo-c106="" class="highlight-div-header-right"><div _ngcontent-ufo-c106="" class="handle-button ai-button"></div><div _ngcontent-ufo-c106="" class="handle-button line-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ufo-c106="" class="handle-button theme-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ufo-c106="" class="handle-button copy-button"><div _ngcontent-ufo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ufo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { image } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ImageKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { fileIo <span class="hljs-keyword">as</span> fs } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">savePicture</span>(<span class="hljs-params">buffer: <span class="hljs-built_in">ArrayBuffer</span>, img: image.Image, context: Context</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">accessHelper</span>: photoAccessHelper.<span class="hljs-property">PhotoAccessHelper</span> = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">options</span>: photoAccessHelper.<span class="hljs-property">CreateOptions</span> = {</li><li>    <span class="hljs-attr">title</span>: <span class="hljs-title class_">Date</span>.<span class="hljs-title function_">now</span>().<span class="hljs-title function_">toString</span>()</li><li>  };</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoUri</span>: <span class="hljs-built_in">string</span> = <span class="hljs-keyword">await</span> accessHelper.<span class="hljs-title function_">createAsset</span>(photoAccessHelper.<span class="hljs-property">PhotoType</span>.<span class="hljs-property">IMAGE</span>, <span class="hljs-string">'jpg'</span>, options);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">file</span>: fs.<span class="hljs-property">File</span> = fs.<span class="hljs-title function_">openSync</span>(photoUri, fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">READ_WRITE</span> | fs.<span class="hljs-property">OpenMode</span>.<span class="hljs-property">CREATE</span>);</li><li>  fs.<span class="hljs-title function_">writeSync</span>(file.<span class="hljs-property">fd</span>, buffer);</li><li>  fs.<span class="hljs-title function_">closeSync</span>(file);</li><li>  <span class="hljs-keyword">await</span> img.<span class="hljs-title function_">release</span>();</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">setPhotoOutputCb</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput, context: Context</span>): <span class="hljs-built_in">void</span> {</li><li>  <span class="hljs-comment">//设置回调之后，调用photoOutput的capture方法，就会将拍照的buffer回传到回调中</span></li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAvailable'</span>, (<span class="hljs-attr">errCode</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">photo</span>: camera.<span class="hljs-property">Photo</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getPhoto start'</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`err: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(errCode)}</span>`</span>);</li><li>    <span class="hljs-keyword">if</span> (errCode || photo === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getPhoto failed'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> imageObj = photo.<span class="hljs-property">main</span>;</li><li>    imageObj.<span class="hljs-title function_">getComponent</span>(image.<span class="hljs-property">ComponentType</span>.<span class="hljs-property">JPEG</span>, (<span class="hljs-attr">errCode</span>: <span class="hljs-title class_">BusinessError</span>, <span class="hljs-attr">component</span>: image.<span class="hljs-property">Component</span>): <span class="hljs-function"><span class="hljs-params">void</span> =&gt;</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'getComponent start'</span>);</li><li>      <span class="hljs-keyword">if</span> (errCode || component === <span class="hljs-literal">undefined</span>) {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getComponent failed'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">buffer</span>: <span class="hljs-title class_">ArrayBuffer</span>;</li><li>      <span class="hljs-keyword">if</span> (component.<span class="hljs-property">byteBuffer</span>) {</li><li>        buffer = component.<span class="hljs-property">byteBuffer</span>;</li><li>      } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'byteBuffer is null'</span>);</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-title function_">savePicture</span>(buffer, imageObj, context);</li><li>    });</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cameraShootingCase</span>(<span class="hljs-params">context: Context, surfaceId: <span class="hljs-built_in">string</span></span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-comment">// 创建CameraManager对象</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraManager</span>: camera.<span class="hljs-property">CameraManager</span> = camera.<span class="hljs-title function_">getCameraManager</span>(context);</li><li>  <span class="hljs-keyword">if</span> (!cameraManager) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"camera.getCameraManager error"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 监听相机状态变化</span></li><li>  cameraManager.<span class="hljs-title function_">on</span>(<span class="hljs-string">'cameraStatus'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, cameraStatusInfo: camera.CameraStatusInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'cameraStatus with errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`camera : <span class="hljs-subst">${cameraStatusInfo.camera.cameraId}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`status: <span class="hljs-subst">${cameraStatusInfo.status}</span>`</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 获取相机列表</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>  <span class="hljs-keyword">if</span> (cameraArray.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"cameraManager.getSupportedCameras error"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>; index &lt; cameraArray.<span class="hljs-property">length</span>; index++) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraId : '</span> + cameraArray[index].<span class="hljs-property">cameraId</span>); <span class="hljs-comment">// 获取相机ID</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraPosition : '</span> + cameraArray[index].<span class="hljs-property">cameraPosition</span>); <span class="hljs-comment">// 获取相机位置</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'cameraType : '</span> + cameraArray[index].<span class="hljs-property">cameraType</span>); <span class="hljs-comment">// 获取相机类型</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'connectionType : '</span> + cameraArray[index].<span class="hljs-property">connectionType</span>); <span class="hljs-comment">// 获取相机连接类型</span></li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建相机输入流</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraInput = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraArray[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to createCameraInput errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (cameraInput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 监听cameraInput错误信息</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraDevice</span>: camera.<span class="hljs-property">CameraDevice</span> = cameraArray[<span class="hljs-number">0</span>];</li><li>  cameraInput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, cameraDevice, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Camera input error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  })</li><li>
</li><li>  <span class="hljs-comment">// 打开相机</span></li><li>  <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>();</li><li>
</li><li>  <span class="hljs-comment">// 获取支持的模式类型</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">sceneModes</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">SceneMode</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedSceneModes</span>(cameraArray[<span class="hljs-number">0</span>]);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">isSupportPhotoMode</span>: <span class="hljs-built_in">boolean</span> = sceneModes.<span class="hljs-title function_">indexOf</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) &gt;= <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">if</span> (!isSupportPhotoMode) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'photo mode not support'</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">//创建会话</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoSession</span>: camera.<span class="hljs-property">PhotoSession</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession = cameraManager.<span class="hljs-title function_">createSession</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to create the session instance. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (photoSession === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 监听session错误信息</span></li><li>  photoSession.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Capture session error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 查询Preconfig能力</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> isPreconfigSupport = photoSession.<span class="hljs-title function_">canPreconfig</span>(camera.<span class="hljs-property">PreconfigType</span>.<span class="hljs-property">PRECONFIG_1080P</span>);</li><li>    <span class="hljs-keyword">if</span> (!isPreconfigSupport) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'PhotoSession canPreconfig check fail.'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to call canPreconfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 配置Preconfig</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">preconfig</span>(camera.<span class="hljs-property">PreconfigType</span>.<span class="hljs-property">PRECONFIG_1080P</span>);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to call preconfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 创建预览输出流,其中参数 surfaceId 参考上文 XComponent 组件，预览流为XComponent组件提供的surface</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">previewOutput</span>: camera.<span class="hljs-property">PreviewOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    previewOutput = cameraManager.<span class="hljs-title function_">createPreviewOutput</span>(surfaceId);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to create the PreviewOutput instance. error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (previewOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 监听预览输出错误信息</span></li><li>  previewOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Preview output error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 创建拍照输出流</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOutput</span>: camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to createPhotoOutput errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (photoOutput === <span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">//调用上面的回调函数来保存图片</span></li><li>  <span class="hljs-title function_">setPhotoOutputCb</span>(photoOutput, context);</li><li>
</li><li>  <span class="hljs-comment">// 开始配置会话</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">beginConfig</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to beginConfig. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加相机输入流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addInput. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加预览输出流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addOutput(previewOutput). errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 向会话中添加拍照输出流</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(photoOutput);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to addOutput(photoOutput). errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 提交会话配置</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">commitConfig</span>();</li><li>
</li><li>  <span class="hljs-comment">// 启动会话</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">start</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Promise returned to indicate the session start success.'</span>);</li><li>  });</li><li>  <span class="hljs-comment">// 判断设备是否支持闪光灯</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">flashStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    flashStatus = photoSession.<span class="hljs-title function_">hasFlash</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to hasFlash. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Returned with the flash light support status:'</span> + flashStatus);</li><li>
</li><li>  <span class="hljs-keyword">if</span> (flashStatus) {</li><li>    <span class="hljs-comment">// 判断是否支持自动闪光灯模式</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">flashModeStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">status</span>: <span class="hljs-built_in">boolean</span> = photoSession.<span class="hljs-title function_">isFlashModeSupported</span>(camera.<span class="hljs-property">FlashMode</span>.<span class="hljs-property">FLASH_MODE_AUTO</span>);</li><li>      flashModeStatus = status;</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to check whether the flash mode is supported. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span>(flashModeStatus) {</li><li>      <span class="hljs-comment">// 设置自动闪光灯模式</span></li><li>      <span class="hljs-keyword">try</span> {</li><li>        photoSession.<span class="hljs-title function_">setFlashMode</span>(camera.<span class="hljs-property">FlashMode</span>.<span class="hljs-property">FLASH_MODE_AUTO</span>);</li><li>      } <span class="hljs-keyword">catch</span> (error) {</li><li>        <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set the flash mode. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 判断是否支持连续自动变焦模式</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">focusModeStatus</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">status</span>: <span class="hljs-built_in">boolean</span> = photoSession.<span class="hljs-title function_">isFocusModeSupported</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_CONTINUOUS_AUTO</span>);</li><li>    focusModeStatus = status;</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to check whether the focus mode is supported. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">if</span> (focusModeStatus) {</li><li>    <span class="hljs-comment">// 设置连续自动变焦模式</span></li><li>    <span class="hljs-keyword">try</span> {</li><li>      photoSession.<span class="hljs-title function_">setFocusMode</span>(camera.<span class="hljs-property">FocusMode</span>.<span class="hljs-property">FOCUS_MODE_CONTINUOUS_AUTO</span>);</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set the focus mode. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-comment">// 获取相机支持的可变焦距比范围</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">zoomRatioRange</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">number</span>&gt; = [];</li><li>  <span class="hljs-keyword">try</span> {</li><li>    zoomRatioRange = photoSession.<span class="hljs-title function_">getZoomRatioRange</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to get the zoom ratio range. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (zoomRatioRange.<span class="hljs-property">length</span> &lt;= <span class="hljs-number">0</span>) {</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-comment">// 设置可变焦距比</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    photoSession.<span class="hljs-title function_">setZoomRatio</span>(zoomRatioRange[<span class="hljs-number">0</span>]);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Failed to set the zoom ratio value. errorCode = '</span> + err.<span class="hljs-property">code</span>);</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoCaptureSetting</span>: camera.<span class="hljs-property">PhotoCaptureSetting</span> = {</li><li>    <span class="hljs-attr">quality</span>: camera.<span class="hljs-property">QualityLevel</span>.<span class="hljs-property">QUALITY_LEVEL_HIGH</span>, <span class="hljs-comment">// 设置图片质量高</span></li><li>    <span class="hljs-attr">rotation</span>: camera.<span class="hljs-property">ImageRotation</span>.<span class="hljs-property">ROTATION_0</span> <span class="hljs-comment">// 设置图片旋转角度0</span></li><li>  }</li><li>  <span class="hljs-comment">// 使用当前拍照设置进行拍照，需要在拍照时主动调用该接口拍摄图片。</span></li><li>  photoOutput.<span class="hljs-title function_">capture</span>(photoCaptureSetting, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to capture the photo <span class="hljs-subst">${err.message}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Callback invoked to indicate the photo capture request success.'</span>);</li><li>  });</li><li>
</li><li>  <span class="hljs-comment">// 需要在拍照结束之后调用以下关闭摄像头和释放会话流程，避免拍照未结束就将会话释放。</span></li><li>  <span class="hljs-comment">// 停止当前会话</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">stop</span>();</li><li>
</li><li>  <span class="hljs-comment">// 释放相机输入流</span></li><li>  <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">close</span>();</li><li>
</li><li>  <span class="hljs-comment">// 释放预览输出流</span></li><li>  <span class="hljs-keyword">await</span> previewOutput.<span class="hljs-title function_">release</span>();</li><li>
</li><li>  <span class="hljs-comment">// 释放拍照输出流</span></li><li>  <span class="hljs-keyword">await</span> photoOutput.<span class="hljs-title function_">release</span>();</li><li>
</li><li>  <span class="hljs-comment">// 释放会话</span></li><li>  <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">release</span>();</li><li>
</li><li>  <span class="hljs-comment">// 会话置空</span></li><li>  photoSession = <span class="hljs-literal">undefined</span>;</li><li>}</li></ol></pre></div></div> </div> </div> <div></div></div>