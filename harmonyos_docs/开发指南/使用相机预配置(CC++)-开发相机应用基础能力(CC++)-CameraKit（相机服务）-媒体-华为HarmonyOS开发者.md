<h1 _ngcontent-cip-c119="" class="doc-title ng-star-inserted" title="使用相机预配置(C/C++)"> 使用相机预配置(C/C++) </h1>

<div _ngcontent-cip-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>相机预配置（Preconfig），对常用的场景和分辨率进行了预配置集成，可简化开发相机应用流程，提高应用的开发效率。</p> <p>开发者在开发相机应用时，在获取到CameraDevice之后，如果遵循通用流程开发，步骤较为繁琐。需要先查询当前相机在指定模式下所支持的各类输出的配置信息，拿到<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-outputcapability" target="_blank">Camera_OutputCapability</a>之后，应用开发者还需要对里面的各类数据进行解析，筛选，找到自己需要的配置数据<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-profile" target="_blank">Camera_Profile</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-videoprofile" target="_blank">Camera_VideoProfile</a>。最后使用对应的Profile以及VideoProfile创建对应的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-previewoutput" target="_blank">Camera_PreviewOutput</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-photooutput" target="_blank">Camera_PhotoOutput</a>以及<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-oh-camera-camera-videooutput" target="_blank">Camera_VideoOutput</a>。</p> <p>为了解决上述问题，优化应用开发流程，系统针对拍照、录像两类场景（即<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-h#camera_scenemode" target="_blank">Camera_SceneMode</a>为NORMAL_PHOTO或NORMAL_VIDEO），提供了<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_createpreviewoutputusedinpreconfig" target="_blank">OH_CameraManager_CreatePreviewOutputUsedInPreconfig</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_createphotooutputusedinpreconfig" target="_blank">OH_CameraManager_CreatePhotoOutputUsedInPreconfig</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-manager-h#oh_cameramanager_createvideooutputusedinpreconfig" target="_blank">OH_CameraManager_CreateVideoOutputUsedInPreconfig</a>接口帮助开发者快速完成相机参数配置。推荐仅需要自定义拍照界面的无需开发专业相机应用的开发者，使用相机预配置功能快速开发应用。</p> <div class="tiledSection"><h2 id="section1207155472118">规格说明<i class="anchor-icon anchor-icon-link" anchorid="section1207155472118" tips="复制节点链接"></i></h2><p>系统提供了4种预配置类型（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-h#camera_preconfigtype" target="_blank">Camera_PreconfigType</a>），分别为PRECONFIG_720P、PRECONFIG_1080P、PRECONFIG_4K、PRECONFIG_HIGH_QUALITY。以及3种画幅比例规格（<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-camera-h#camera_preconfigratio" target="_blank">Camera_PreconfigRatio</a>），1:1画幅（PRECONFIG_RATIO_1_1）、4:3画幅（PRECONFIG_RATIO_4_3）、16:9画幅（PRECONFIG_RATIO_16_9）。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>由于不同的设备所支持的能力不同。使用相机预配置（preconfig）功能时，需要先调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-capture-session-h#oh_capturesession_canpreconfig" target="_blank">OH_CaptureSession_CanPreconfig</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-capture-session-h#oh_capturesession_canpreconfigwithratio" target="_blank">OH_CaptureSession_CanPreconfigWithRatio</a>检查对应的PreconfigType和PreconfigRatio的组合在当前设备上是否支持。</p> </div></div></div> <p>在不同的画幅比例下，其分辨率规格不同，详见下表。</p> <ul><li>普通拍照模式下的预览输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.1.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.1.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1440</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1440</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2560x1440</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通拍照模式下的拍照输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.2.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的预览输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.3.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.3.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.3.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.3.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的录像输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.4.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.4.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.4.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.4.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>720x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>960x720</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1280x720</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1080x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1440x1080</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>1920x1080</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2160x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>2880x2160</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>3840x2160</p> </td> </tr>  </tbody></table></div> </div> </li><li>普通录像模式下的拍照输出 <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.5.5.1.1.5.1.1" valign="top" width="25%"><p>预配置类型PreconfigType</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.5.1.1.5.1.2" valign="top" width="25%"><p>PRECONFIG_RATIO_1_1</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.5.1.1.5.1.3" valign="top" width="25%"><p>PRECONFIG_RATIO_4_3</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.5.5.1.1.5.1.4" valign="top" width="25%"><p>PRECONFIG_RATIO_16_9</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_720P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_1080P</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_4K</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="25%"><p>PRECONFIG_HIGH_QUALITY</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> <td class="cellrowborder" valign="top" width="25%"><p>跟随Sensor最大能力</p> </td> </tr>  </tbody></table></div> </div> </li></ul> </div> <div class="tiledSection"><h2 id="完整示例">开发示例<i class="anchor-icon anchor-icon-link" anchorid="完整示例" tips="复制节点链接"></i></h2><ol><li><p>在CMake脚本中链接相关动态库。</p> <div _ngcontent-cip-c106="" class="highlight-div"><div _ngcontent-cip-c106="" class="highlight-div-header"><div _ngcontent-cip-c106="" class="highlight-div-header-left"><div _ngcontent-cip-c106="" class="handle-button expand-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cip-c106="" class="highlight-div-header-right"><div _ngcontent-cip-c106="" class="handle-button ai-button"></div><div _ngcontent-cip-c106="" class="handle-button line-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cip-c106="" class="handle-button theme-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cip-c106="" class="handle-button copy-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cip-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(entry PUBLIC libohcamera.so libhilog_ndk.z.so)</li></ol></pre></div></div> </li><li><p>cpp侧导入NDK接口，并根据传入的SurfaceId进行拍照。</p> <div _ngcontent-cip-c106="" class="highlight-div"><div _ngcontent-cip-c106="" class="highlight-div-header"><div _ngcontent-cip-c106="" class="highlight-div-header-left"><div _ngcontent-cip-c106="" class="handle-button expand-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cip-c106="" class="highlight-div-header-right"><div _ngcontent-cip-c106="" class="handle-button ai-button"></div><div _ngcontent-cip-c106="" class="handle-button line-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cip-c106="" class="handle-button theme-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cip-c106="" class="handle-button copy-button"><div _ngcontent-cip-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cip-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"hilog/log.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_input.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/capture_session.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/photo_output.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/preview_output.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/video_output.h"</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">"ohcamera/camera_manager.h"</span></span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">NDKCamera</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-built_in">NDKCamera</span>(<span class="hljs-type">char</span> *previewId, <span class="hljs-type">char</span> *photoId);</li><li>};</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CaptureSessionOnFocusStateChange</span><span class="hljs-params">(Camera_CaptureSession *session, Camera_FocusState focusState)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"CaptureSessionOnFocusStateChange"</span>);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CaptureSessionOnError</span><span class="hljs-params">(Camera_CaptureSession *session, Camera_ErrorCode errorCode)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"CaptureSessionOnError = %{public}d"</span>, errorCode);</li><li>}</li><li>
</li><li><span class="hljs-function">CaptureSession_Callbacks *<span class="hljs-title">GetCaptureSessionRegister</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{</li><li>    <span class="hljs-type">static</span> CaptureSession_Callbacks captureSessionCallbacks = {.onFocusStateChange = CaptureSessionOnFocusStateChange,</li><li>                                                               .onError = CaptureSessionOnError};</li><li>    <span class="hljs-keyword">return</span> &amp;captureSessionCallbacks;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PreviewOutputOnFrameStart</span><span class="hljs-params">(Camera_PreviewOutput *previewOutput)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"PreviewOutputOnFrameStart"</span>);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PreviewOutputOnFrameEnd</span><span class="hljs-params">(Camera_PreviewOutput *previewOutput, <span class="hljs-type">int32_t</span> frameCount)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"PreviewOutputOnFrameEnd = %{public}d"</span>, frameCount);</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">PreviewOutputOnError</span><span class="hljs-params">(Camera_PreviewOutput *previewOutput, Camera_ErrorCode errorCode)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"PreviewOutputOnError = %{public}d"</span>, errorCode);</li><li>}</li><li>
</li><li><span class="hljs-function">PreviewOutput_Callbacks *<span class="hljs-title">GetPreviewOutputListener</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{</li><li>    <span class="hljs-type">static</span> PreviewOutput_Callbacks previewOutputListener = {.onFrameStart = PreviewOutputOnFrameStart,</li><li>                                                            .onFrameEnd = PreviewOutputOnFrameEnd,</li><li>                                                            .onError = PreviewOutputOnError};</li><li>    <span class="hljs-keyword">return</span> &amp;previewOutputListener;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">OnCameraInputError</span><span class="hljs-params">(<span class="hljs-type">const</span> Camera_Input *cameraInput, Camera_ErrorCode errorCode)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OnCameraInput errorCode = %{public}d"</span>, errorCode);</li><li>}</li><li>
</li><li><span class="hljs-function">CameraInput_Callbacks *<span class="hljs-title">GetCameraInputListener</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> </span>{</li><li>    <span class="hljs-type">static</span> CameraInput_Callbacks cameraInputCallbacks = {.onError = OnCameraInputError};</li><li>    <span class="hljs-keyword">return</span> &amp;cameraInputCallbacks;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CameraManagerStatusCallback</span><span class="hljs-params">(Camera_Manager *cameraManager, Camera_StatusInfo *status)</span> </span>{</li><li>    <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"CameraManagerStatusCallback is called"</span>);</li><li>}</li><li>
</li><li><span class="hljs-function">CameraManager_Callbacks *<span class="hljs-title">GetCameraManagerListener</span><span class="hljs-params">()</span> </span>{</li><li>    <span class="hljs-type">static</span> CameraManager_Callbacks cameraManagerListener = {.onCameraStatus = CameraManagerStatusCallback};</li><li>    <span class="hljs-keyword">return</span> &amp;cameraManagerListener;</li><li>}</li><li>
</li><li>NDKCamera::<span class="hljs-built_in">NDKCamera</span>(<span class="hljs-type">char</span> *previewId, <span class="hljs-type">char</span> *photoId) {</li><li>    Camera_Manager *cameraManager = <span class="hljs-literal">nullptr</span>;</li><li>    Camera_Device *cameras = <span class="hljs-literal">nullptr</span>;</li><li>    Camera_CaptureSession *captureSession = <span class="hljs-literal">nullptr</span>;</li><li>    Camera_PreviewOutput *previewOutput = <span class="hljs-literal">nullptr</span>;</li><li>    Camera_PhotoOutput *photoOutput = <span class="hljs-literal">nullptr</span>;</li><li>    Camera_Input *cameraInput = <span class="hljs-literal">nullptr</span>;</li><li>    <span class="hljs-type">uint32_t</span> size = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">uint32_t</span> cameraDeviceIndex = <span class="hljs-number">0</span>;</li><li>    <span class="hljs-type">char</span> *previewSurfaceId = previewId;</li><li>    <span class="hljs-type">char</span> *photoSurfaceId = photoId;</li><li>    <span class="hljs-comment">// 创建CameraManager对象</span></li><li>    Camera_ErrorCode ret = <span class="hljs-built_in">OH_Camera_GetCameraManager</span>(&amp;cameraManager);</li><li>    <span class="hljs-keyword">if</span> (cameraManager == <span class="hljs-literal">nullptr</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_Camera_GetCameraMananger failed."</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 监听相机状态变化</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_RegisterCallback</span>(cameraManager, <span class="hljs-built_in">GetCameraManagerListener</span>());</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_RegisterCallback failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 获取相机列表</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_GetSupportedCameras</span>(cameraManager, &amp;cameras, &amp;size);</li><li>    <span class="hljs-keyword">if</span> (cameras == <span class="hljs-literal">nullptr</span> || size &lt; <span class="hljs-number">0</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_GetSupportedCameras failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 创建相机输入流</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_CreateCameraInput</span>(cameraManager, &amp;cameras[cameraDeviceIndex], &amp;cameraInput);</li><li>    <span class="hljs-keyword">if</span> (cameraInput == <span class="hljs-literal">nullptr</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_CreateCameraInput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 监听cameraInput错误信息</span></li><li>    ret = <span class="hljs-built_in">OH_CameraInput_RegisterCallback</span>(cameraInput, <span class="hljs-built_in">GetCameraInputListener</span>());</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraInput_RegisterCallback failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 打开相机</span></li><li>    ret = <span class="hljs-built_in">OH_CameraInput_Open</span>(cameraInput);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraInput_Open failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 创建会话</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_CreateCaptureSession</span>(cameraManager, &amp;captureSession);</li><li>    <span class="hljs-keyword">if</span> (captureSession == <span class="hljs-literal">nullptr</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_CreateCaptureSession failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 监听session错误信息</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_RegisterCallback</span>(captureSession, <span class="hljs-built_in">GetCaptureSessionRegister</span>());</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_RegisterCallback failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 查询Preconfig能力</span></li><li>    <span class="hljs-type">bool</span> canPreconfigResult = <span class="hljs-literal">false</span>;</li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_CanPreconfig</span>(captureSession, PRECONFIG_1080P, &amp;canPreconfigResult);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK || !canPreconfigResult) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_CanPreconfig failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 配置Preconfig</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_Preconfig</span>(captureSession, PRECONFIG_1080P);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Preconfig failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 创建预览输出流,其中参数 previewSurfaceId 参考上文 XComponent 组件，预览流为XComponent组件提供的surface</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_CreatePreviewOutputUsedInPreconfig</span>(cameraManager, previewSurfaceId, &amp;previewOutput);</li><li>    <span class="hljs-keyword">if</span> (previewOutput == <span class="hljs-literal">nullptr</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_CreatePreviewOutput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 监听预览输出错误信息</span></li><li>    ret = <span class="hljs-built_in">OH_PreviewOutput_RegisterCallback</span>(previewOutput, <span class="hljs-built_in">GetPreviewOutputListener</span>());</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_PreviewOutput_RegisterCallback failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 创建拍照输出流，其中参数 photoSurfaceId 参考上文 ImageReceiver获取的surface</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_CreatePhotoOutputUsedInPreconfig</span>(cameraManager, photoSurfaceId, &amp;photoOutput);</li><li>    <span class="hljs-keyword">if</span> (photoOutput == <span class="hljs-literal">nullptr</span> || ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_CreatePhotoOutput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 开始配置会话</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_BeginConfig</span>(captureSession);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_BeginConfig failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 向会话中添加相机输入流</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_AddInput</span>(captureSession, cameraInput);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_AddInput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 向会话中添加预览输出流</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_AddPreviewOutput</span>(captureSession, previewOutput);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_AddPreviewOutput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 向会话中添加拍照输出流</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_AddPhotoOutput</span>(captureSession, photoOutput);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_AddPhotoOutput failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 提交会话配置</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_CommitConfig</span>(captureSession);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_CommitConfig failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 启动会话</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_Start</span>(captureSession);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Start failed."</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 判断设备是否支持闪光灯</span></li><li>    Camera_FlashMode flashMode = FLASH_MODE_AUTO;</li><li>    <span class="hljs-type">bool</span> hasFlash = <span class="hljs-literal">false</span>;</li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_HasFlash</span>(captureSession, &amp;hasFlash);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_HasFlash failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (hasFlash) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"hasFlash success"</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"hasFlash fail"</span>);</li><li>    }</li><li>    <span class="hljs-comment">// 检测闪光灯模式是否支持</span></li><li>    <span class="hljs-type">bool</span> isSupported = <span class="hljs-literal">false</span>;</li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_IsFlashModeSupported</span>(captureSession, flashMode, &amp;isSupported);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_IsFlashModeSupported failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isSupported) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"isFlashModeSupported success"</span>);</li><li>        <span class="hljs-comment">// 设置闪光灯模式</span></li><li>        ret = <span class="hljs-built_in">OH_CaptureSession_SetFlashMode</span>(captureSession, flashMode);</li><li>        <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_SetFlashMode success."</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_SetFlashMode failed. %{public}d "</span>, ret);</li><li>        }</li><li>        <span class="hljs-comment">// 获取当前设备的闪光灯模式</span></li><li>        ret = <span class="hljs-built_in">OH_CaptureSession_GetFlashMode</span>(captureSession, &amp;flashMode);</li><li>        <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetFlashMode success. flashMode：%{public}d "</span>, flashMode);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetFlashMode failed. %d "</span>, ret);</li><li>        }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"isFlashModeSupported fail"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 判断是否支持连续自动变焦模式</span></li><li>    Camera_FocusMode focusMode = FOCUS_MODE_CONTINUOUS_AUTO;</li><li>    <span class="hljs-type">bool</span> isFocusModeSupported = <span class="hljs-literal">false</span>;</li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_IsFocusModeSupported</span>(captureSession, focusMode, &amp;isFocusModeSupported);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_IsFocusModeSupported failed."</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> (isFocusModeSupported) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"isFocusModeSupported success"</span>);</li><li>        ret = <span class="hljs-built_in">OH_CaptureSession_SetFocusMode</span>(captureSession, focusMode);</li><li>        <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_SetFocusMode failed. %{public}d "</span>, ret);</li><li>        }</li><li>        ret = <span class="hljs-built_in">OH_CaptureSession_GetFocusMode</span>(captureSession, &amp;focusMode);</li><li>        <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>            <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetFocusMode success. focusMode%{public}d "</span>, focusMode);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>            <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetFocusMode failed. %d "</span>, ret);</li><li>        }</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"isFocusModeSupported fail"</span>);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 获取相机支持的可变焦距比范围</span></li><li>    <span class="hljs-type">float</span> minZoom;</li><li>    <span class="hljs-type">float</span> maxZoom;</li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_GetZoomRatioRange</span>(captureSession, &amp;minZoom, &amp;maxZoom);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetZoomRatioRange failed."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetZoomRatioRange success. minZoom: %{public}f, maxZoom:%{public}f"</span>,</li><li>                    minZoom, maxZoom);</li><li>    }</li><li>    <span class="hljs-comment">// 设置变焦</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_SetZoomRatio</span>(captureSession, maxZoom);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_SetZoomRatio success."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_SetZoomRatio failed. %{public}d "</span>, ret);</li><li>    }</li><li>    <span class="hljs-comment">// 获取当前设备的变焦值</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_GetZoomRatio</span>(captureSession, &amp;maxZoom);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetZoomRatio success. zoom：%{public}f "</span>, maxZoom);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_GetZoomRatio failed. %{public}d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 无拍照设置进行拍照</span></li><li>    ret = <span class="hljs-built_in">OH_PhotoOutput_Capture</span>(photoOutput);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_PhotoOutput_Capture success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_PhotoOutput_Capture failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 停止当前会话</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_Stop</span>(captureSession);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Stop success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Stop failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 释放相机输入流</span></li><li>    ret = <span class="hljs-built_in">OH_CameraInput_Close</span>(cameraInput);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CameraInput_Close success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraInput_Close failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 释放预览输出流</span></li><li>    ret = <span class="hljs-built_in">OH_PreviewOutput_Release</span>(previewOutput);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_PreviewOutput_Release success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_PreviewOutput_Release failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 释放拍照输出流</span></li><li>    ret = <span class="hljs-built_in">OH_PhotoOutput_Release</span>(photoOutput);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_PhotoOutput_Release success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_PhotoOutput_Release failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 释放会话</span></li><li>    ret = <span class="hljs-built_in">OH_CaptureSession_Release</span>(captureSession);</li><li>    <span class="hljs-keyword">if</span> (ret == CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_INFO</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Release success "</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CaptureSession_Release failed. %d "</span>, ret);</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 资源释放</span></li><li>    ret = <span class="hljs-built_in">OH_CameraManager_DeleteSupportedCameras</span>(cameraManager, cameras, size);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"Delete Cameras failed."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_CameraManager_DeleteSupportedCameras. ok"</span>);</li><li>    }</li><li>
</li><li>    ret = <span class="hljs-built_in">OH_Camera_DeleteCameraManager</span>(cameraManager);</li><li>    <span class="hljs-keyword">if</span> (ret != CAMERA_OK) {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"Delete Cameras failed."</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>        <span class="hljs-built_in">OH_LOG_ERROR</span>(LOG_APP, <span class="hljs-string">"OH_Camera_DeleteCameraManager. ok"</span>);</li><li>    }</li><li>}</li></ol></pre></div></div> </li></ol> </div> </div> <div></div></div>