<h1 _ngcontent-uir-c119="" class="doc-title ng-star-inserted" title="使用硬件熵源生成安全随机数(ArkTS)"> 使用硬件熵源生成安全随机数(ArkTS) </h1>

<div _ngcontent-uir-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从API version 21开始，可以选择使用硬件熵源生成安全随机数。</p>    <p>随机数主要用于临时会话密钥生成和非对称加密算法密钥生成等场景。在加解密场景中，安全随机数生成器需要具备随机性、不可预测性和不可重现性。</p>    <p>使用更安全的熵源，对随机数而言，就意味着 “结果难以被猜测或复现”，是 “真随机性” 的量化体现。</p>    <p>当前硬件熵源的实现是通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-overview">HUKS</a>的相关接口完成的。</p>    <p>开发者可以调用接口，完成以下具体功能：</p>    <ul>     <li>      <p>生成指定长度的安全随机数，并将其用于生成对应的密钥。</p></li>     <li>      <p>开启硬件熵源。</p></li>     <li>      <p>指定随机种子，生成一系列的随机序列。</p></li>    </ul>    <p>在开发前，开发者应该先对加解密基础知识有一定了解，并熟知以下随机数相关的基本概念：</p>    <ul>     <li>      <p><strong>内部状态</strong></p>      <p>代表随机数生成器内存中的数值，当内部状态相同时，随机数生成器会生成固定的随机数序列。</p></li>     <li>      <p><strong>随机种子</strong></p>      <p>一个用来对伪随机数的内部状态进行初始化的数据，随机数生成器通过种子来生成一系列的随机序列。</p>      <p>当前OpenSSL实现方式，随机数生成器内部状态是不断变化的，即使设置相同的种子，生成的随机数序列也不会相同。</p></li>    </ul>    <div class="tiledSection">     <h2 id="支持的算法与规格">支持的算法与规格<i class="anchor-icon anchor-icon-link" anchorid="支持的算法与规格" tips="复制节点链接"></i></h2>          <p>安全随机数生成，设置硬件熵源之后，使用OpenSSL的RAND_priv_bytes接口生成。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.3.1.1" valign="top" width="50%">算法</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.3.1.3.1.2" valign="top" width="50%">长度（Byte）</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">CTR_DRBG</td>         <td class="cellrowborder" valign="top" width="50%">[1, INT_MAX]</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#cryptoframeworkcreaterandom" target="_blank">cryptoFramework.createRandom</a>，生成随机数实例。</p></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#enablehardwareentropy21" target="_blank">cryptoFramework.enableHardwareEntropy</a>，开启硬件熵源。</p></li>      <li>       <p>（可选）设置DataBlob数据，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#setseed" target="_blank">Random.setSeed</a>，为随机数生成器设置种子。</p></li>      <li>       <p>设置指定字节长度，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generaterandom" target="_blank">Random.generateRandom</a>或<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-cryptoframework#generaterandomsync10" target="_blank">Random.generateRandomSync</a>，生成安全随机数。</p>       <p>指定字节长度范围为1~INT_MAX。</p></li>     </ol>     <ul>      <li>       <p>通过await返回异步结果：</p>       <div _ngcontent-uir-c106="" class="highlight-div"><div _ngcontent-uir-c106="" class="highlight-div-header"><div _ngcontent-uir-c106="" class="highlight-div-header-left"><div _ngcontent-uir-c106="" class="handle-button expand-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uir-c106="" class="highlight-div-header-right"><div _ngcontent-uir-c106="" class="handle-button ai-button"></div><div _ngcontent-uir-c106="" class="handle-button line-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uir-c106="" class="handle-button theme-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uir-c106="" class="handle-button copy-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uir-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">doRand</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> rand = cryptoFramework.<span class="hljs-title function_">createRandom</span>();</li><li>  rand.<span class="hljs-title function_">enableHardwareEntropy</span>();</li><li>  <span class="hljs-keyword">let</span> seed = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>([<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>]);</li><li>  rand.<span class="hljs-title function_">setSeed</span>({ <span class="hljs-attr">data</span>: seed });</li><li>  <span class="hljs-keyword">let</span> len = <span class="hljs-number">12</span>;</li><li>  <span class="hljs-keyword">let</span> randOutput = <span class="hljs-keyword">await</span> rand.<span class="hljs-title function_">generateRandom</span>(len);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'rand output:'</span> + randOutput.<span class="hljs-property">data</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>同步返回结果：</p>       <div _ngcontent-uir-c106="" class="highlight-div"><div _ngcontent-uir-c106="" class="highlight-div-header"><div _ngcontent-uir-c106="" class="highlight-div-header-left"><div _ngcontent-uir-c106="" class="handle-button expand-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-uir-c106="" class="highlight-div-header-right"><div _ngcontent-uir-c106="" class="handle-button ai-button"></div><div _ngcontent-uir-c106="" class="handle-button line-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-uir-c106="" class="handle-button theme-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-uir-c106="" class="handle-button copy-button"><div _ngcontent-uir-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-uir-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">doRandBySync</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> rand = cryptoFramework.<span class="hljs-title function_">createRandom</span>();</li><li>  rand.<span class="hljs-title function_">enableHardwareEntropy</span>();</li><li>  <span class="hljs-keyword">let</span> len = <span class="hljs-number">24</span>; <span class="hljs-comment">// Generate a 24-byte random number.</span></li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> randData = rand.<span class="hljs-title function_">generateRandomSync</span>(len);</li><li>    <span class="hljs-keyword">if</span> (randData.<span class="hljs-property">data</span>.<span class="hljs-property">length</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"[Sync]: rand result: "</span> + randData.<span class="hljs-property">data</span>);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"[Sync]: get rand result fail!"</span>);</li><li>    }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`do rand failed, <span class="hljs-subst">${e.code}</span>, <span class="hljs-subst">${e.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>