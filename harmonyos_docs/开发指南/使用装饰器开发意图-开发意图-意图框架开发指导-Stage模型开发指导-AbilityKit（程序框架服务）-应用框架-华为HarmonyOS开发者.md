<h1 _ngcontent-jyl-c119="" class="doc-title ng-star-inserted" title="使用装饰器开发意图"> 使用装饰器开发意图 </h1>

<div _ngcontent-jyl-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="使用场景">使用场景<i class="anchor-icon anchor-icon-link" anchorid="使用场景" tips="复制节点链接"></i></h2>          <p>从 API version 20开始，支持通过装饰器开发意图，支持将现有功能通过装饰器快速集成至系统入口。典型场景介绍如下。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.4.1.1" valign="top" width="33.33333333333333%">意图调用场景</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.4.1.2" valign="top" width="33.33333333333333%">常见意图举例</th>         <th align="left" class="cellrowborder" id="mcps1.3.1.3.1.4.1.3" valign="top" width="33.33333333333333%">意图开发方式</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">拉起应用</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>- 播放音乐。</p>          <p>- 打开购物软件直达商品详情页。</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintententry" target="_blank">@InsightIntentEntry</a>创建新的意图逻辑，绑定UIAbility组件或UIExtensionAbility组件。</p>          <p>- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentlink" target="_blank">@InsightIntentLink</a>将uri链接转换为意图。</p>          <p>- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentpage" target="_blank">@InsightIntentPage</a> 将页面路由转换为意图。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">查询或更新信息</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>- 查询天气。</p>          <p>- 修改应用配置或更新。</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentfunctionmethod" target="_blank">@InsightIntentFunctionMethod</a> 将函数调用转换为系统意图。</p>          <p>- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintententry" target="_blank">@InsightIntentEntry</a>创建新的意图逻辑，绑定UIAbility组件的后台执行模式或ServiceExtensionAbility组件。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">添加服务卡片</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">- 添加天气卡片。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">- 通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentform" target="_blank">@InsightIntentForm</a>开发意图。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="运行机制">运行机制<i class="anchor-icon anchor-icon-link" anchorid="运行机制" tips="复制节点链接"></i></h2>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.4.1.1" valign="top" width="33.33333333333333%">功能</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.4.1.2" valign="top" width="33.33333333333333%">意图开发</th>         <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.4.1.3" valign="top" width="33.33333333333333%">意图执行</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintententry" target="_blank">@InsightIntentEntry</a>开发意图</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>1. 开发者新增意图执行文件，若该执行文件未被其他文件导入，需要通过insight_intent.json文件的"insightIntentsSrcEntry"字段配置意图执行文件路径，使其参与编译。</p>          <p>2. 通过装饰器定义意图需要绑定Ability组件、定义意图执行模式。</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">系统入口匹配意图，根据意图执行模式触发Ability组件的启动和意图执行。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentlink" target="_blank">@InsightIntentLink</a>开发意图</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开发者定义Link跳转意图，支持已有的uri链接和新增uri链接。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">系统入口匹配意图，传递uri链接，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inner-application-uiabilitycontext#openlink12" target="_blank">openLink</a>触发意图执行，意图执行时的入参处理见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#linkintentparammapping" target="_blank">LinkIntentParamMapping</a>的paramCategory说明。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentpage" target="_blank">@InsightIntentPage</a>开发意图</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开发者定义页面跳转意图，配置意图对应的UIAbility组件、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-routing">页面路由</a>的路径和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-navigation-navigation">Navigation</a>路径。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>1. 系统入口通过startAbility启动意图绑定的UIAbility组件。若意图未绑定UIAbility组件，则启动意图所在module的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#配置文件标签">mainElement</a>对应的UIAbility组件。</p>          <p>2. 意图执行时，若应用未启动，在UIAbility的首页加载后跳转到意图对应的页面；若应用已启动，由当前页面跳转到意图对应的页面。</p>          <p>3. 意图执行时，参数会被传递给目标页面。</p>          <p>4. "navigationId"字段或"navDestinationName"字段匹配失败时，退化为"pagePath"字段对应的页面跳转。</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentfunctionmethod" target="_blank">@InsightIntentFunctionMethod</a>开发意图</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开发者为静态方法定义意图，静态方法可以是已有方法或新增方法。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">系统入口通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#后台通信能力" target="_blank">Call调用</a>启动意图所在module的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#配置文件标签">mainElement</a>对应的UIAbility组件。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintentform" target="_blank">@InsightIntentForm</a>开发意图</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">开发者定义卡片意图，卡片可以是已有卡片或新增卡片。</td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">系统入口通过FormComponent组件创建意图卡片。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>本章节以通过@InsightIntentEntry开发标准意图和自定义意图举例，其他装饰器开发标准意图和自定义意图与@InsightIntentEntry相似，可以结合API参考开发其他类型的意图。</p>    </div>    <div class="tiledSection">     <h3 id="通过意图装饰器开发标准意图" class="firsth2">通过意图装饰器开发标准意图<i class="anchor-icon anchor-icon-link" anchorid="通过意图装饰器开发标准意图" tips="复制节点链接"></i></h3>          <p>以通过@InsightIntentEntry装饰器开发<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/insight-intent-access-specifications#查看快递">查看快递</a>标准意图举例。</p>     <ol>      <li>       <p>在insight_intent.json配置文件中的"insightIntentsSrcEntry"字段声明意图执行文件。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"insightIntentsSrcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/insightintents/ViewLogisticsImpl.ets"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>实现意图执行器。</p>       <p>开发标准意图无需开发者自行定义意图的大语言模型描述、意图参数定义和意图执行结果定义，根据"schema"字段和"intentVersion"字段匹配<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/insight-intent-access-specifications">附录：标准意图接入规范</a>中的标准意图。意图执行器需要从InsightIntentEntryExector&lt;T&gt;类继承，实现onExecute()方法。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InsightIntentEntryExecutor</span>, insightIntent, <span class="hljs-title class_">InsightIntentEntry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewLogisticsResultDef</span> {</li><li>  msg?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@InsightIntentEntry</span>({</li><li>  <span class="hljs-attr">intentName</span>: <span class="hljs-string">'ViewLogistics'</span>,</li><li>  <span class="hljs-attr">domain</span>: <span class="hljs-string">'LocalDomain'</span>,</li><li>  <span class="hljs-attr">intentVersion</span>: <span class="hljs-string">'1.0.1'</span>,</li><li>  <span class="hljs-attr">displayName</span>: <span class="hljs-string">'查询快递'</span>,</li><li>  <span class="hljs-attr">displayDescription</span>: <span class="hljs-string">'根据快递单号查询快递信息'</span>,</li><li>  <span class="hljs-attr">schema</span>: <span class="hljs-string">'ViewLogistics'</span>,</li><li>  <span class="hljs-attr">icon</span>: $r(<span class="hljs-string">'app.media.viewLogistics'</span>), <span class="hljs-comment">// $r表示本地图标，需要在资源目录中定义</span></li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,</li><li>  <span class="hljs-attr">executeMode</span>: [insightIntent.<span class="hljs-property">ExecuteMode</span>.<span class="hljs-property">UI_ABILITY_BACKGROUND</span>],</li><li>})</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ViewLogisticsImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InsightIntentEntryExecutor</span>&lt;<span class="hljs-title class_">ViewLogisticsResultDef</span>&gt; {</li><li>  trackingNo?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  entityId?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">onExecute</span>(): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-title class_">ViewLogisticsResultDef</span>&gt;&gt; {</li><li>    <span class="hljs-comment">// 执行查询快递逻辑</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-title class_">ViewLogisticsResultDef</span>&gt; = {</li><li>      <span class="hljs-attr">code</span>: <span class="hljs-number">0</span>,</li><li>      <span class="hljs-attr">result</span>: {</li><li>        <span class="hljs-attr">msg</span>: <span class="hljs-string">'the logistics is being delivered'</span></li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(result);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>     <p>意图执行过程：</p>     <ol>      <li>系统入口响应用户“查询单号为12345的快递”的请求，匹配到该应用的"ViewLogistics"意图，通过意图框架触发该应用的"ViewLogistics"意图执行。</li>      <li>由于意图绑定了"EntryAbility"组件、配置了insightIntent.ExecuteMode.UI_ABILITY_BACKGROUND执行模式，在意图执行过程中，"ViewLogistics"意图绑定的"EntryAbility"组件会通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiability#后台通信能力" target="_blank">Call调用</a>启动，意图执行过程中，ViewLogisticsImpl类的属性"trackingNo"会被赋值，进而执行onExecute()方法，将意图执行结果通过意图框架返回给系统入口。</li>      <li>系统入口将意图执行结果转换为自然语言呈现给用户。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="通过意图装饰器开发自定义意图">通过意图装饰器开发自定义意图<i class="anchor-icon anchor-icon-link" anchorid="通过意图装饰器开发自定义意图" tips="复制节点链接"></i></h3>          <p>以开发“播放音乐”自定义意图举例，需要定义意图的大语言模型描述、意图搜索关键字、意图参数定义和意图执行结果定义。</p>     <ol>      <li>       <p>在insight_intent.json配置文件中的"insightIntentsSrcEntry"字段声明意图执行文件。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-attr">"insightIntentsSrcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>    <span class="hljs-punctuation">{</span></li><li>      <span class="hljs-attr">"srcEntry"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"./ets/insightintents/PlayMusicImpl.ets"</span></li><li>    <span class="hljs-punctuation">}</span></li><li>  <span class="hljs-punctuation">]</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div></li>      <li>       <p>实现意图执行器。</p>       <p>开发自定义意图需要开发者定义意图的大语言模型描述、意图搜索关键字、意图参数定义和意图执行结果定义。意图执行器需要从InsightIntentEntryExector&lt;T&gt;类继承，实现onExecute()方法。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// `insight_intent.json`文件的"insightIntentsSrcEntry"字段的实现</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InsightIntentEntryExecutor</span>, insightIntent, <span class="hljs-title class_">InsightIntentEntity</span>, <span class="hljs-title class_">InsightIntentEntry</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-comment">// 意图执行返回值数据格式定义</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlayMusicResultDef</span> {</li><li>  msg?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 意图定义</span></li><li><span class="hljs-meta">@InsightIntentEntry</span>({</li><li>  <span class="hljs-attr">intentName</span>: <span class="hljs-string">'PlayMusic'</span>,</li><li>  <span class="hljs-attr">domain</span>: <span class="hljs-string">'MusicDomain'</span>,</li><li>  <span class="hljs-attr">intentVersion</span>: <span class="hljs-string">'1.0.1'</span>,</li><li>  <span class="hljs-attr">displayName</span>: <span class="hljs-string">'播放歌曲'</span>,</li><li>  <span class="hljs-attr">displayDescription</span>: <span class="hljs-string">'播放音乐意图'</span>,</li><li>  <span class="hljs-attr">icon</span>: $r(<span class="hljs-string">'app.media.playMusic'</span>), <span class="hljs-comment">// $r表示本地图标，需要在资源目录中定义</span></li><li>  <span class="hljs-attr">llmDescription</span>: <span class="hljs-string">'支持传递歌曲名称，播放音乐'</span>,</li><li>  <span class="hljs-attr">keywords</span>: [<span class="hljs-string">'音乐播放'</span>, <span class="hljs-string">'播放歌曲'</span>, <span class="hljs-string">'PlayMusic'</span>],</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,</li><li>  <span class="hljs-attr">executeMode</span>: [insightIntent.<span class="hljs-property">ExecuteMode</span>.<span class="hljs-property">UI_ABILITY_FOREGROUND</span>],</li><li>  <span class="hljs-attr">parameters</span>: {</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"object"</span>,</li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"A schema for describing songs and their artists"</span>,</li><li>    <span class="hljs-string">"properties"</span>: {</li><li>      <span class="hljs-string">"songName"</span>: {</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"The name of the song"</span>,</li><li>        <span class="hljs-string">"minLength"</span>: <span class="hljs-number">1</span></li><li>      },</li><li>      <span class="hljs-string">"singer"</span>: {</li><li>        <span class="hljs-string">"type"</span>: <span class="hljs-string">"string"</span>,</li><li>        <span class="hljs-string">"description"</span>: <span class="hljs-string">"The name of the singer"</span>,</li><li>        <span class="hljs-string">"minLength"</span>: <span class="hljs-number">1</span></li><li>      }</li><li>    },</li><li>    <span class="hljs-string">"required"</span>: [<span class="hljs-string">"songName"</span>]</li><li>  }</li><li>})</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlayMusicImpl</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InsightIntentEntryExecutor</span>&lt;<span class="hljs-title class_">PlayMusicResultDef</span>&gt; {</li><li>  <span class="hljs-attr">songName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  singer?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>
</li><li>  <span class="hljs-title function_">onExecute</span>(): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-title class_">PlayMusicResultDef</span>&gt;&gt; {</li><li>    <span class="hljs-comment">// 执行音乐播放逻辑</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-title class_">PlayMusicResultDef</span>&gt; = {</li><li>      <span class="hljs-attr">code</span>: <span class="hljs-number">123</span>,</li><li>      <span class="hljs-attr">result</span>: {</li><li>        <span class="hljs-attr">msg</span>: <span class="hljs-string">'play music succeed'</span></li><li>      }</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(result);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>     <p>意图执行过程：</p>     <ol>      <li>系统入口响应用户“播放歌手A的歌曲B”的请求，匹配到该应用的"PlayMusic"意图，通过意图框架触发该应用的"PlayMusic"意图执行。</li>      <li>意图绑定了"EntryAbility"组件、配置了insightIntent.ExecuteMode.UI_ABILITY_FOREGROUND执行模式，在意图执行过程中，"PlayMusic"意图绑定的"EntryAbility"组件会通过startAbility启动，PlayMusicImpl类的属性"songName"和"singer"会被赋值，进而执行onExecute()方法，将意图执行结果通过意图框架返回给系统入口。</li>      <li>系统入口将意图执行结果转换为自然语言呈现给用户。</li>     </ol>    </div>    <div class="tiledSection">     <h3 id="可选通过开发意图实体传递复杂参数">（可选）通过开发意图实体传递复杂参数<i class="anchor-icon anchor-icon-link" anchorid="可选通过开发意图实体传递复杂参数" tips="复制节点链接"></i></h3>          <p>由系统入口传递给应用的数据默认为基础类型。如果需要复杂数据（例如，播放音乐时需要传入的歌手信息包括歌手姓名、国籍等多个字段），需要采用对象类型，并使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintententity" target="_blank">@InsightIntentEntity</a>装饰器装饰。被装饰的对象称为意图实体。</p>     <p>以播放音乐为例，用户告诉小艺希望播放的音乐名称与歌手信息，小艺根据音乐名称和歌手信息拉起对应音乐界面，播放该音乐。</p>     <p>为了实现该场景，开发者可以将歌手信息定义为意图实体，并开发意图实体。具体步骤如下：</p>     <ol>      <li>       <p>定义意图实体。</p>       <p>开发者将歌手信息（包括名称、国家、城市）定义为类，并使用@InsightIntentEntity装饰器将该类定义为意图实体。装饰器的parameters属性列出了类的数据成员、数据格式及每个成员的必选性。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent, <span class="hljs-title class_">InsightIntentEntity</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li>
</li><li><span class="hljs-meta">@InsightIntentEntity</span>({</li><li>  <span class="hljs-attr">entityCategory</span>: <span class="hljs-string">'artist entity category'</span>,</li><li>  <span class="hljs-attr">parameters</span>: {</li><li>    <span class="hljs-string">'$id'</span>: <span class="hljs-string">'/schemas/ArtistClassDef'</span>,</li><li>    <span class="hljs-string">'type'</span>: <span class="hljs-string">'object'</span>,</li><li>    <span class="hljs-string">'description'</span>: <span class="hljs-string">'Information about the artist'</span>,</li><li>    <span class="hljs-string">'properties'</span>: {</li><li>      <span class="hljs-string">'country'</span>: {</li><li>        <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>        <span class="hljs-string">'description'</span>: <span class="hljs-string">'The artist\'s country of origin'</span>,</li><li>        <span class="hljs-string">'default'</span>: <span class="hljs-string">'zh'</span></li><li>      },</li><li>      <span class="hljs-string">'city'</span>: {</li><li>        <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>        <span class="hljs-string">'description'</span>: <span class="hljs-string">'The artist\'s city of origin'</span></li><li>      },</li><li>      <span class="hljs-string">'name'</span>: {</li><li>        <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>        <span class="hljs-string">'description'</span>: <span class="hljs-string">'The name of the artist'</span>,</li><li>        <span class="hljs-string">'minLength'</span>: <span class="hljs-number">1</span></li><li>      }</li><li>    },</li><li>    <span class="hljs-comment">// name为必选参数</span></li><li>    <span class="hljs-string">'required'</span>: [<span class="hljs-string">'name'</span>]</li><li>  }</li><li>})</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArtistClassDef</span> <span class="hljs-keyword">implements</span> insightIntent.<span class="hljs-property">IntentEntity</span> {</li><li>  <span class="hljs-attr">entityId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'0x11'</span>;</li><li>  country?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  city?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>使用意图实体。添加<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-insightintentdecorator#insightintententry" target="_blank">@InsightIntentEntry</a>装饰器的意图使用音乐名称和歌手信息（ArtistClassDef意图实体）作为播放音乐的入参。</p>       <div _ngcontent-jyl-c106="" class="highlight-div"><div _ngcontent-jyl-c106="" class="highlight-div-header"><div _ngcontent-jyl-c106="" class="highlight-div-header-left"><div _ngcontent-jyl-c106="" class="handle-button expand-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-jyl-c106="" class="highlight-div-header-right"><div _ngcontent-jyl-c106="" class="handle-button ai-button"></div><div _ngcontent-jyl-c106="" class="handle-button line-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-jyl-c106="" class="handle-button theme-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-jyl-c106="" class="handle-button copy-button"><div _ngcontent-jyl-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-jyl-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { insightIntent, <span class="hljs-title class_">InsightIntentEntry</span>, <span class="hljs-title class_">InsightIntentEntryExecutor</span>, <span class="hljs-title class_">InsightIntentEntity</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">LOG_TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'testTag-EntryIntent'</span>;</li><li>
</li><li><span class="hljs-meta">@InsightIntentEntity</span>({</li><li>  <span class="hljs-attr">entityCategory</span>: <span class="hljs-string">'artist entity category'</span>,</li><li>  <span class="hljs-comment">// @InsightIntentEntry装饰器中parameters中已描述ArtistClassDef意图实体信息，此处parameters可不写</span></li><li>})</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArtistClassDef</span> <span class="hljs-keyword">implements</span> insightIntent.<span class="hljs-property">IntentEntity</span> {</li><li>  <span class="hljs-attr">entityId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'0x11'</span>;</li><li>  country?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  city?: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-attr">name</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li>
</li><li><span class="hljs-comment">// 使用@InsightIntentEntry装饰器定义意图</span></li><li><span class="hljs-meta">@InsightIntentEntry</span>({</li><li>  <span class="hljs-attr">intentName</span>: <span class="hljs-string">'PlayMusic'</span>,</li><li>  <span class="hljs-attr">domain</span>: <span class="hljs-string">'MusicDomain'</span>,</li><li>  <span class="hljs-attr">intentVersion</span>: <span class="hljs-string">'1.0.1'</span>,</li><li>  <span class="hljs-attr">displayName</span>: <span class="hljs-string">'播放歌曲'</span>,</li><li>  <span class="hljs-attr">displayDescription</span>: <span class="hljs-string">'播放音乐意图'</span>,</li><li>  <span class="hljs-attr">icon</span>: $r(<span class="hljs-string">'app.media.app_icon'</span>), <span class="hljs-comment">// $r表示本地图标，需要在资源目录中定义</span></li><li>  <span class="hljs-attr">llmDescription</span>: <span class="hljs-string">'支持传递歌曲名称，播放音乐'</span>,</li><li>  <span class="hljs-attr">keywords</span>: [<span class="hljs-string">'音乐播放'</span>, <span class="hljs-string">'播放歌曲'</span>, <span class="hljs-string">'PlayMusic'</span>],</li><li>  <span class="hljs-attr">abilityName</span>: <span class="hljs-string">'EntryAbility'</span>,</li><li>  <span class="hljs-attr">executeMode</span>: [insightIntent.<span class="hljs-property">ExecuteMode</span>.<span class="hljs-property">UI_ABILITY_FOREGROUND</span>],</li><li>  <span class="hljs-attr">parameters</span>: {</li><li>    <span class="hljs-string">'schema'</span>: <span class="hljs-string">'http://json-schema.org/draft-07/schema#'</span>,</li><li>    <span class="hljs-string">'type'</span>: <span class="hljs-string">'object'</span>,</li><li>    <span class="hljs-string">'title'</span>: <span class="hljs-string">'Song Schema'</span>,</li><li>    <span class="hljs-string">'description'</span>: <span class="hljs-string">'A schema for describing songs and their artists'</span>,</li><li>    <span class="hljs-string">'properties'</span>: {</li><li>      <span class="hljs-string">'songName'</span>: {</li><li>        <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>        <span class="hljs-string">'description'</span>: <span class="hljs-string">'The name of the song'</span>,</li><li>        <span class="hljs-string">'minLength'</span>: <span class="hljs-number">1</span></li><li>      },</li><li>      <span class="hljs-string">'artist'</span>: {</li><li>        <span class="hljs-string">'type'</span>: <span class="hljs-string">'object'</span>,</li><li>        <span class="hljs-string">'description'</span>: <span class="hljs-string">'Information about the artist'</span>,</li><li>        <span class="hljs-string">'properties'</span>: {</li><li>          <span class="hljs-string">'country'</span>: {</li><li>            <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The artist\'s country of origin'</span>,</li><li>            <span class="hljs-string">'default'</span>: <span class="hljs-string">'zh'</span></li><li>          },</li><li>          <span class="hljs-string">'city'</span>: {</li><li>            <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The artist\'s city of origin'</span></li><li>          },</li><li>          <span class="hljs-string">'name'</span>: {</li><li>            <span class="hljs-string">'type'</span>: <span class="hljs-string">'string'</span>,</li><li>            <span class="hljs-string">'description'</span>: <span class="hljs-string">'The name of the artist'</span>,</li><li>            <span class="hljs-string">'minLength'</span>: <span class="hljs-number">1</span></li><li>          }</li><li>        },</li><li>        <span class="hljs-string">'required'</span>: [<span class="hljs-string">'name'</span>]</li><li>      }</li><li>    },</li><li>    <span class="hljs-string">'required'</span>: [<span class="hljs-string">'songName'</span>]</li><li>  }</li><li>})</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PlayMusicDemo</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">InsightIntentEntryExecutor</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>  <span class="hljs-attr">songName</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-comment">// 使用意图实体</span></li><li>  artist?: <span class="hljs-title class_">ArtistClassDef</span>;</li><li>
</li><li>  <span class="hljs-title function_">onExecute</span>(): <span class="hljs-title class_">Promise</span>&lt;insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-built_in">string</span>&gt;&gt; {</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">LOG_TAG</span>, <span class="hljs-string">'PlayMusicDemo executeMode %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">executeMode</span>));</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">LOG_TAG</span>, <span class="hljs-string">'PlayMusicDemo artist %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">artist</span>));</li><li>    <span class="hljs-keyword">let</span> storage = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LocalStorage</span>();</li><li>    storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'songName'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">songName</span>);</li><li>    storage.<span class="hljs-title function_">setOrCreate</span>(<span class="hljs-string">'artist'</span>, <span class="hljs-variable language_">this</span>.<span class="hljs-property">artist</span>);</li><li>    <span class="hljs-comment">// 根据 `executeMode` 参数的不同情况，提供不同的方式拉起 `PlayMusicPage` 页面。</span></li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">executeMode</span> == insightIntent.<span class="hljs-property">ExecuteMode</span>.<span class="hljs-property">UI_ABILITY_FOREGROUND</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">windowStage</span>?.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/PlayMusicPage'</span>, storage);</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">executeMode</span> == insightIntent.<span class="hljs-property">ExecuteMode</span>.<span class="hljs-property">UI_EXTENSION_ABILITY</span>) {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">uiExtensionSession</span>?.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/PlayMusicPage'</span>, storage);</li><li>    }</li><li>    <span class="hljs-comment">// 定义意图的执行结果</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">result</span>: insightIntent.<span class="hljs-property">IntentResult</span>&lt;<span class="hljs-built_in">string</span>&gt; = {</li><li>      <span class="hljs-attr">code</span>: <span class="hljs-number">123</span>,</li><li>      <span class="hljs-attr">result</span>: <span class="hljs-string">'execute success'</span></li><li>    }</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-variable constant_">LOG_TAG</span>, <span class="hljs-string">'PlayMusicDemo return %{public}s'</span>, <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(result));</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">resolve</span>(result);</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>