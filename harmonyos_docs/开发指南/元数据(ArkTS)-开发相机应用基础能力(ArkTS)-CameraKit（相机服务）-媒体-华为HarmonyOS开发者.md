<h1 _ngcontent-cjf-c119="" class="doc-title ng-star-inserted" title="元数据(ArkTS)"> 元数据(ArkTS) </h1>

<div _ngcontent-cjf-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在开发相机应用时，需要先<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preparation">申请相关权限</a>。</p>    <p>元数据（Metadata）是对相机返回的图像信息的描述和上下文。针对图像信息，提供更详细的数据，如照片或视频中，识别人像的取景框坐标的信息等。</p>    <p>Metadata主要是通过一个TAG（Key），去找对应的Data，用于传递参数和配置信息，减少内存拷贝操作。</p>    <div class="tiledSection">     <h2 id="适用场景">适用场景<i class="anchor-icon anchor-icon-link" anchorid="适用场景" tips="复制节点链接"></i></h2>          <p>检测图片中的人脸，返回高精度的人脸矩形框坐标。应用可基于人脸定位结果，灵活集成后处理算法，将其应用于多样化场景。</p>    </div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入相关接口，导入方法如下。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>中的supportedMetadataObjectTypes属性，获取当前设备支持的元数据类型，并通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createmetadataoutput" target="_blank">createMetadataOutput</a>方法创建元数据输出流。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getMetadataOutput</span>(<span class="hljs-params">cameraManager: camera.CameraManager, cameraOutputCapability: camera.CameraOutputCapability</span>): camera.<span class="hljs-property">MetadataOutput</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metadataObjectTypes</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">MetadataObjectType</span>&gt; = cameraOutputCapability.<span class="hljs-property">supportedMetadataObjectTypes</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">metadataOutput</span>: camera.<span class="hljs-property">MetadataOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    metadataOutput = cameraManager.<span class="hljs-title function_">createMetadataOutput</span>(metadataObjectTypes);</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createMetadataOutput, error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> metadataOutput;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#start11" target="_blank">Session.start</a>方法开启metadata数据输出，再通过监听事件metadataObjectsAvailable回调拿到数据，接口调用失败时，会返回相应错误码，错误码类型参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#cameraerrorcode" target="_blank">Camera错误码</a>。</p>       <p>previewOutput获取方式请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-preview#开发步骤">相机预览开发步骤</a>。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">startMetadataOutput</span>(<span class="hljs-params">previewOutput: camera.PreviewOutput, metadataOutput: camera.MetadataOutput, cameraManager: camera.CameraManager</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">CameraDevice</span>&gt; = [];</li><li>  <span class="hljs-keyword">try</span> {</li><li>    cameraArray = cameraManager.<span class="hljs-title function_">getSupportedCameras</span>();</li><li>    <span class="hljs-keyword">if</span> (cameraArray.<span class="hljs-property">length</span> == <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'no camera.'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 示例代码默认选择第一个镜头，实际开发需根据所需镜头。</span></li><li>    <span class="hljs-keyword">const</span> <span class="hljs-attr">cameraDevice</span>: camera.<span class="hljs-property">CameraDevice</span> = cameraArray[<span class="hljs-number">0</span>];</li><li>    <span class="hljs-comment">// 获取支持的模式类型。</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">sceneModes</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">SceneMode</span>&gt; = cameraManager.<span class="hljs-title function_">getSupportedSceneModes</span>(cameraDevice);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">isSupportPhotoMode</span>: <span class="hljs-built_in">boolean</span> = sceneModes.<span class="hljs-title function_">indexOf</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>) &gt;= <span class="hljs-number">0</span>;</li><li>    <span class="hljs-keyword">if</span> (!isSupportPhotoMode) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'photo mode not support'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">cameraInput</span>: camera.<span class="hljs-property">CameraInput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>    cameraInput = cameraManager.<span class="hljs-title function_">createCameraInput</span>(cameraDevice);</li><li>    <span class="hljs-keyword">if</span> (cameraInput === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'cameraInput is undefined'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 打开相机。</span></li><li>    <span class="hljs-keyword">await</span> cameraInput.<span class="hljs-title function_">open</span>();</li><li>    <span class="hljs-keyword">let</span> session = cameraManager.<span class="hljs-title function_">createSession</span>(camera.<span class="hljs-property">SceneMode</span>.<span class="hljs-property">NORMAL_PHOTO</span>);</li><li>    <span class="hljs-keyword">if</span> (!session) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'session is null'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">photoSession</span>: camera.<span class="hljs-property">PhotoSession</span> = session <span class="hljs-keyword">as</span> camera.<span class="hljs-property">PhotoSession</span>;</li><li>    photoSession.<span class="hljs-title function_">beginConfig</span>();</li><li>    photoSession.<span class="hljs-title function_">addInput</span>(cameraInput);</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(previewOutput);</li><li>    photoSession.<span class="hljs-title function_">addOutput</span>(metadataOutput);</li><li>    <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">commitConfig</span>();</li><li>    <span class="hljs-keyword">await</span> photoSession.<span class="hljs-title function_">start</span>();</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startMetadataOutput call failed'</span>);</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-session#stop11" target="_blank">Session.stop</a>方法停止输出metadata数据，接口调用失败会返回相应错误码，错误码类型参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#cameraerrorcode" target="_blank">Camera错误码</a>。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stopMetadataOutput</span>(<span class="hljs-params">session: camera.Session</span>): <span class="hljs-built_in">void</span> {</li><li>  session.<span class="hljs-title function_">stop</span>().<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'Callback returned with session stopped.'</span>);</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to session stop, error code: <span class="hljs-subst">${err.code}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听metadata数据以及输出流的状态。</p>     <ul>      <li>       <p>通过注册监听获取metadata对象，监听事件固定为metadataObjectsAvailable。检测到有效metadata数据时，callback返回相应的metadata数据信息，metadataOutput创建成功时可监听。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onMetadataObjectsAvailable</span>(<span class="hljs-params">metadataOutput: camera.MetadataOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  metadataOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'metadataObjectsAvailable'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, metadataObjectArr: <span class="hljs-built_in">Array</span>&lt;camera.MetadataObject&gt;</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'metadata output metadataObjectsAvailable'</span>);</li><li>  });</li><li>}</li></ol></pre></div></div>       <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">         <p>当前的元数据类型仅支持人脸检测（FACE_DETECTION）功能。元数据信息对象为识别到的人脸区域的矩形信息（Rect），包含矩形区域的左上角x坐标、y坐标和矩形的宽高数据。</p>        </div></div></div></li>      <li>       <p>通过注册回调函数，获取监听metadata流的错误结果，callback返回metadata输出接口使用错误时返回的错误码，错误码类型参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#cameraerrorcode" target="_blank">Camera错误码</a>。</p>       <div _ngcontent-cjf-c106="" class="highlight-div"><div _ngcontent-cjf-c106="" class="highlight-div-header"><div _ngcontent-cjf-c106="" class="highlight-div-header-left"><div _ngcontent-cjf-c106="" class="handle-button expand-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-cjf-c106="" class="highlight-div-header-right"><div _ngcontent-cjf-c106="" class="handle-button ai-button"></div><div _ngcontent-cjf-c106="" class="handle-button line-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-cjf-c106="" class="handle-button theme-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-cjf-c106="" class="handle-button copy-button"><div _ngcontent-cjf-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-cjf-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onMetadataError</span>(<span class="hljs-params">metadataOutput: camera.MetadataOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  metadataOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">metadataOutputError: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Metadata output error code: <span class="hljs-subst">${metadataOutputError.code}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>