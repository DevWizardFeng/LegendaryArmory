<h1 _ngcontent-njo-c119="" class="doc-title ng-star-inserted" title="全局配置项功能场景"> 全局配置项功能场景 </h1>

<div _ngcontent-njo-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>对于需要使用进程单例的场景，例如不同并发实例间需要数据保持一致的全局配置项功能，可以采用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-sendable-module">共享模块</a>来实现。</p> <p>以下示例展示了只有在Wi-Fi打开且用户登录的情况下才能进行下载的功能，具体步骤如下。</p> <ol><li><p>编写全局配置文件。</p>  <div _ngcontent-njo-c106="" class="highlight-div"><div _ngcontent-njo-c106="" class="highlight-div-header"><div _ngcontent-njo-c106="" class="highlight-div-header-left"><div _ngcontent-njo-c106="" class="handle-button expand-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-njo-c106="" class="highlight-div-header-right"><div _ngcontent-njo-c106="" class="handle-button ai-button"></div><div _ngcontent-njo-c106="" class="handle-button line-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-njo-c106="" class="handle-button theme-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-njo-c106="" class="handle-button copy-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-njo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Config.ets</span></li><li>
</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">ArkTSUtils</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-string">"use shared"</span></li><li>
</li><li><span class="hljs-meta">@Sendable</span></li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Config</span> {</li><li>  <span class="hljs-attr">lock</span>: <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLock</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-title class_">AsyncLock</span>();</li><li>  <span class="hljs-attr">isLogin</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  loginUser?: <span class="hljs-built_in">string</span>;</li><li>  <span class="hljs-attr">wifiOn</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">login</span>(<span class="hljs-params">user: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loginUser</span> = user;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">logout</span>(<span class="hljs-params">user?: <span class="hljs-built_in">string</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">false</span>;</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">loginUser</span> = <span class="hljs-string">""</span>;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getIsLogin</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span>;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">getUser</span>(): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">loginUser</span>!;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">setWifiState</span>(<span class="hljs-params">state: <span class="hljs-built_in">boolean</span></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">wifiOn</span> = state;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">EXCLUSIVE</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">isWifiOn</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">lock</span>.<span class="hljs-title function_">lockAsync</span>(<span class="hljs-function">() =&gt;</span> {</li><li>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">wifiOn</span>;</li><li>    }, <span class="hljs-title class_">ArkTSUtils</span>.<span class="hljs-property">locks</span>.<span class="hljs-property">AsyncLockMode</span>.<span class="hljs-property">SHARED</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">let</span> config = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Config</span>();</li></ol></pre></div></div>   </li><li><p>UI主线程及子线程访问全局配置项。</p>  <div _ngcontent-njo-c106="" class="highlight-div"><div _ngcontent-njo-c106="" class="highlight-div-header"><div _ngcontent-njo-c106="" class="highlight-div-header-left"><div _ngcontent-njo-c106="" class="handle-button expand-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-njo-c106="" class="highlight-div-header-right"><div _ngcontent-njo-c106="" class="handle-button ai-button"></div><div _ngcontent-njo-c106="" class="handle-button line-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-njo-c106="" class="handle-button theme-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-njo-c106="" class="handle-button copy-button"><div _ngcontent-njo-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-njo-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-keyword">import</span> { config } <span class="hljs-keyword">from</span> <span class="hljs-string">'./Config'</span>;</li><li><span class="hljs-keyword">import</span> { taskpool } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkTS'</span>;</li><li>
</li><li><span class="hljs-meta">@Concurrent</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">download</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">await</span> config.<span class="hljs-title function_">isWifiOn</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"wifi is off"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">await</span> config.<span class="hljs-title function_">getIsLogin</span>()) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">"not login"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`User[<span class="hljs-subst">${<span class="hljs-keyword">await</span> config.getUser()}</span>] start download ...`</span>);</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'not login'</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">wifiState</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">"wifi off"</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">downloadResult</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span>;</li><li>  <span class="hljs-attr">input</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">""</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Column</span>() {</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>        <span class="hljs-title class_">TextInput</span>({ <span class="hljs-attr">placeholder</span>: <span class="hljs-string">"请输入用户名"</span> })</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-function">(<span class="hljs-params">value</span>) =&gt;</span> {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span> = value;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"login"</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">await</span> config.<span class="hljs-title function_">getIsLogin</span>() &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span>) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"login: "</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span>;</li><li>              config.<span class="hljs-title function_">login</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">input</span>);</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xcccccc</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"logout"</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">await</span> config.<span class="hljs-title function_">getIsLogin</span>()) {</li><li>              <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">"not login"</span>;</li><li>              config.<span class="hljs-title function_">logout</span>();</li><li>            }</li><li>          })</li><li>          .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-number">0xcccccc</span>)</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">wifiState</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>        <span class="hljs-title class_">Toggle</span>({ <span class="hljs-attr">type</span>: <span class="hljs-title class_">ToggleType</span>.<span class="hljs-property">Switch</span> })</li><li>          .<span class="hljs-title function_">onChange</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">isOn</span>: <span class="hljs-built_in">boolean</span>) =&gt; {</li><li>            <span class="hljs-keyword">await</span> config.<span class="hljs-title function_">setWifiState</span>(isOn);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">wifiState</span> = isOn ? <span class="hljs-string">"wifi on"</span> : <span class="hljs-string">"wifi off"</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">"download"</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">50</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>          .<span class="hljs-title function_">onClick</span>(<span class="hljs-keyword">async</span> () =&gt; {</li><li>            <span class="hljs-keyword">let</span> ret = <span class="hljs-keyword">await</span> taskpool.<span class="hljs-title function_">execute</span>(download);</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadResult</span> = ret ? <span class="hljs-string">"download success"</span> : <span class="hljs-string">"download fail"</span>;</li><li>          })</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">downloadResult</span>)</li><li>          .<span class="hljs-title function_">fontSize</span>(<span class="hljs-number">20</span>)</li><li>          .<span class="hljs-title function_">fontWeight</span>(<span class="hljs-title class_">FontWeight</span>.<span class="hljs-property">Bold</span>)</li><li>          .<span class="hljs-title function_">alignRules</span>({</li><li>            <span class="hljs-attr">center</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">VerticalAlign</span>.<span class="hljs-property">Center</span> },</li><li>            <span class="hljs-attr">middle</span>: { <span class="hljs-attr">anchor</span>: <span class="hljs-string">'__container__'</span>, <span class="hljs-attr">align</span>: <span class="hljs-title class_">HorizontalAlign</span>.<span class="hljs-property">Center</span> }</li><li>          })</li><li>      }</li><li>      .<span class="hljs-title function_">width</span>(<span class="hljs-string">'100%'</span>)</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-string">'100%'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>  </li></ol> </div> <div></div></div>