<h1 _ngcontent-eoq-c119="" class="doc-title ng-star-inserted" title="全局闪控球开发指导"> 全局闪控球开发指导 </h1>

<div _ngcontent-eoq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section19519179171818">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="section19519179171818" tips="复制节点链接"></i></h2><p>闪控球是一种在设备屏幕上悬浮的非全屏应用窗口，为应用提供临时的全局能力，完成跨应用交互。</p> <p>应用可以将关键信息（如比价、搜题或抢单等）以小窗（闪控球）模式呈现。切换为小窗（闪控球）模式后，用户可以进行其他界面操作，提升使用体验。</p> <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>从API version 20开始，支持使用闪控球能力。</li><li>支持在DevEco Studio 6.0.1 Release及以上版本的模拟器中使用闪控球相关功能。</li></ul> </div></div></div> </div> <div class="tiledSection"><h2 id="section121816252291">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section121816252291" tips="复制节点链接"></i></h2><ul><li>基于安全考虑，仅允许应用在前台时启动闪控球，并且需要具有ohos.permission.USE_FLOAT_BALL权限。</li></ul> <ul><li>同一个应用只能启动一个闪控球，同一个设备最多同时存在两个闪控球，在超出闪控球最大个数限制时，打开新的闪控球会替换最早启动的闪控球。</li><li>仅支持手机和平板设备。</li></ul> </div> <div class="tiledSection"><h2 id="section5722124913301">接口说明<i class="anchor-icon anchor-icon-link" anchorid="section5722124913301" tips="复制节点链接"></i></h2><p>以下是闪控球功能的常用接口，更多接口及使用参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball" target="_blank">@ohos.window.floatingBall (闪控球窗口)</a> 。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.1" valign="top" width="50%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.3.1.2" valign="top" width="50%"><p>描述</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="50%"><p>isFloatingBallEnabled(): boolean</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>判断当前设备是否支持闪控球功能。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>create(config: FloatingBallConfiguration): Promise&lt;FloatingBallController&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>创建闪控球控制器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>startFloatingBall(params: FloatingBallParams): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>启动闪控球。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>updateFloatingBall(params: FloatingBallParams): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>更新闪控球。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>stopFloatingBall(): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>停止闪控球。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>on(type: 'stateChange', callback: Callback&lt;FloatingBallState&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>开启闪控球生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>off(type: 'stateChange', callback?: Callback&lt;FloatingBallState&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>关闭闪控球生命周期状态的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>on(type: 'click', callback: Callback&lt;void&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>开启闪控球点击事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>off(type: 'click', callback?: Callback&lt;void&gt;): void</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>关闭闪控球点击事件的监听。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>getFloatingBallWindowInfo(): Promise&lt;FloatingBallWindowInfo&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>获取闪控球窗口信息。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="50%"><p>restoreMainWindow(want: Want): Promise&lt;void&gt;</p> </td> <td class="cellrowborder" valign="top" width="50%"><p>恢复应用主窗口，加载指定页面。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section13787164103315">交互方式<i class="anchor-icon anchor-icon-link" anchorid="section13787164103315" tips="复制节点链接"></i></h2><p>闪控球提供以下交互方式：</p> <ul><li>单击闪控球：触发闪控球点击事件。</li><li>长按闪控球：长按闪控球震动变为待删除态，可以点击图标单个删除或全部删除。</li><li>拖动闪控球：可以手动拖拽闪控球改变位置，拖拽时自动避让状态栏、固定态软键盘（改变软键盘为固定态或者悬浮态方法详细介绍请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethodengine#changeflag10" target="_blank">输入法服务</a>）、导航条等其他组件，设备处于横屏场景时不会自动避让输入法。拖拽松手时闪控球自动吸附在最近的侧边，拖拽到垃圾桶区域（底部中部区域）松手即可删除。</li><li>闪控球位置记忆：关闭闪控球会记录当前位置，下一次打开功能时自动展示在上次关闭时的位置。旋转屏幕或重启设备会恢复到默认位置，默认位置位于屏幕右上侧。</li></ul> </div> <div class="tiledSection"><h2 id="section667310330439">闪控球规格与样式布局<i class="anchor-icon anchor-icon-link" anchorid="section667310330439" tips="复制节点链接"></i></h2><p>目前支持四种闪控球模板布局，具体可见闪控球模板类型枚举<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball#floatingballtemplate" target="_blank">FloatingBallTemplate</a>。</p> <ul><li>静态布局：支持图标和标题。</li><li>普通文本布局：支持标题和内容。</li><li>强调文本布局：支持图标、标题和内容。</li><li>纯文本布局：仅支持标题，可双行展示。</li></ul> <p>目前闪控球的规格为：整体尺寸宽为70vp-98vp之间，高为40vp，标题和内容不支持自定义字体大小。</p> <p>不同闪控球模板与样式布局示意如下，不同语言或内容以实际显示效果为准：</p> </div> <div class="fignone"><span class="figcap"><b>图1 </b>静态布局</span></div> <p><span><img originheight="160" originwidth="280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114746.41843162179424288787257287432382:50001231000000:2800:8EB3286E2AEC08AE4153539728872A46A0912EC57B72EC1D62D33AC904E624EB.png" class="notEnlarge" width="280" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图2 </b>静态布局-超长文本标题</span></div> <p><span><img originheight="160" originwidth="392" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114746.21214866255785710925858232511541:50001231000000:2800:DEE7EF0A2B2BCA256EFC21BF58ED6F7ADA5BA9A32B060D98BAD2C21D859FB7F0.png" width="392" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图3 </b>普通文本布局</span></div> <p><span><img originheight="160" originwidth="280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114746.95614449517314844047040583750613:50001231000000:2800:F8285CC0E37A80CD9AF6F9041B5A9606E02C7AD4E2D9E3E3D074045338AED8DB.png" class="notEnlarge" width="280" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图4 </b>普通文本布局-超长文本内容</span></div> <p><span><img originheight="160" originwidth="392" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114746.85538481870787971257828168843124:50001231000000:2800:850D00DEE24F685F8A4DCE50B5A8D44FC0CA8132768C350024BDC89282F6E4CF.png" width="392" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图5 </b>强调文本布局</span></div> <p><span><img originheight="160" originwidth="280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.89742542504133084944035834371963:50001231000000:2800:7734BFBABEE4156D34CF848C74FF16064D4F34CBD83765C0AA92C3DB049E0669.png" class="notEnlarge" width="280" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图6 </b>强调文本布局-超长文本内容</span></div> <p><span><img originheight="160" originwidth="392" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.41225929862504901020277963841151:50001231000000:2800:0710A071C45A49E924C08153D8FF6484F8CC770EB1387D6C3C4784FE9901526D.png" width="392" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图7 </b>强调文本布局-图标</span></div> <p><span><img originheight="160" originwidth="288" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.87023775812573135847552957789129:50001231000000:2800:050199E2C9195191F410ABFD1B3555F83C96FFD9CB13A94FFFD3D5B0DB8C1EB5.png" class="notEnlarge" width="288" height="160"></span></p> <div class="fignone"><span class="figcap"><b>图8 </b>强调文本布局-图标和超长文本内容</span><br><span><img originheight="160" originwidth="381" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.55086951870669730701632944850893:50001231000000:2800:3FB94B2034E5A665CF833324ABF83D8B6F8DA5A0FF3978C8FAA9331BFB8A2DC6.png" width="381" height="160"></span></div> <div class="fignone"><span class="figcap"><b>图9 </b>纯文本布局</span><br><span><img originheight="160" originwidth="280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.30131298675516867472249751963681:50001231000000:2800:A937C3EDDC53E3B96347CE82C5E8759FACE0919100456B27B93D0787D98FD3E8.png" class="notEnlarge" width="280" height="160"></span></div> <p></p> <div class="fignone"><span class="figcap"><b>图10 </b>纯文本布局-超长文本标题</span><br><span><img originheight="160" originwidth="392" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.90409153102646955382503329393457:50001231000000:2800:26EA38BB65DB86C95DB33F2F9645FBBC51FC5028B0D280E75969BE4D4F98C494.png" width="392" height="160"></span></div> <p>当有两个应用启动了闪控球后，闪控球将合并展示，如下图所示。整体高度为76vp。</p> <div class="fignone"><span class="figcap"><b>图11 </b>闪控球上下合并展示</span><br><span><img originheight="304" originwidth="280" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114747.83596296149520437312994027405917:50001231000000:2800:2A0F71AA7D578C8A4CB9E2E5138668AC73C1526A244B35CC1EA8EBD7EA090558.png" class="notEnlarge" width="280" height="304"></span></div> <div class="tiledSection"><h2 id="section10194103415618">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section10194103415618" tips="复制节点链接"></i></h2><ol><li>导入模块并声明闪控球控制器。</li><li>使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball#floatingballcreate" target="_blank">create()</a>接口创建闪控球控制器实例后注册点击事件回调和状态变化事件回调，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball#startfloatingball" target="_blank">startFloatingBall()</a>接口启动闪控球。</li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball#updatefloatingball" target="_blank">updateFloatingBall()</a>更新闪控球信息，以此控制闪控球展示的内容。</li><li>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-floatingball#stopfloatingball" target="_blank">stopFloatingBall()</a>停止闪控球。当不再需要显示闪控球时，可根据业务需要关闭闪控球。</li></ol> <div class="screenLinkPre"><div _ngcontent-eoq-c106="" class="highlight-div"><div _ngcontent-eoq-c106="" class="highlight-div-header"><div _ngcontent-eoq-c106="" class="highlight-div-header-left"><div _ngcontent-eoq-c106="" class="handle-button expand-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eoq-c106="" class="highlight-div-header-right"><div _ngcontent-eoq-c106="" class="handle-button ai-button"></div><div _ngcontent-eoq-c106="" class="handle-button line-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eoq-c106="" class="handle-button theme-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eoq-c106="" class="handle-button copy-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eoq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" codehub="https://gitee.com/harmonyos_samples/guide-snippets/blob/master/ArkUIKit/FloatingBall/entry/src/main/ets/util/Utils.ts#L17-L145" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Utils.ts</span></li><li><span class="hljs-comment">// 该页面提供工具类，展示闪控球的创建、更新、关闭逻辑</span></li><li><span class="hljs-keyword">import</span> <span class="hljs-package">hilog</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-package">image</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.multimedia.image'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">floatingBall</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">ContextUtil</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'./ContextUtil'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">DOMAIN</span>: <span class="hljs-title class_">number</span> = <span class="hljs-number">0xF811</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">TAG</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'[Sample_FloatingBall]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-variable">BUNDLE_NAME</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">ContextUtil</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">abilityInfo</span>.<span class="hljs-variable">bundleName</span>;</li><li>
</li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Utils</span> {</li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">getRawfilePixelMapSync</span>(<span class="hljs-variable">path</span>: <span class="hljs-title class_">string</span>): <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span> {</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">BUFFER</span> = <span class="hljs-variable">ContextUtil</span>.<span class="hljs-variable">context</span>.<span class="hljs-variable">resourceManager</span>.<span class="hljs-title function_">getRawFileContentSync</span>(<span class="hljs-variable">path</span>);</li><li>            <span class="hljs-keyword">const</span> <span class="hljs-variable">IMAGE_SOURCE</span>: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">ImageSource</span> = <span class="hljs-variable">image</span>.<span class="hljs-title function_">createImageSource</span>(<span class="hljs-variable">BUFFER</span>.<span class="hljs-variable">buffer</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">ArrayBuffer</span>);</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Get</span> <span class="hljs-variable">rawfile</span> <span class="hljs-variable">pixelMap</span> <span class="hljs-variable">path</span> <span class="hljs-string">'${path}'</span> <span class="hljs-variable">successfully</span>`);</li><li>            <span class="hljs-keyword">return</span> <span class="hljs-variable">IMAGE_SOURCE</span>.<span class="hljs-title function_">createPixelMapSync</span>();</li><li>        } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">e</span>) {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Get</span> <span class="hljs-variable">rawfile</span> <span class="hljs-variable">pixelMap</span> <span class="hljs-variable">path</span> <span class="hljs-string">'${path}'</span> <span class="hljs-variable">failed</span>, <span class="hljs-variable">error</span>: ${<span class="hljs-variable">e</span>}`);</li><li>            <span class="hljs-keyword">throw</span> <span class="hljs-variable">e</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">Error</span>;</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 闪控球启动逻辑</span></li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-variable">async</span> <span class="hljs-title function_">onClickCreateFloatingBall</span>(</li><li>        <span class="hljs-variable">floatingBallController</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallController</span> | <span class="hljs-title class_">undefined</span>,</li><li>        <span class="hljs-variable">template</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallTemplate</span>,</li><li>        <span class="hljs-variable">onActiveRowChange</span>: (<span class="hljs-variable">value</span>: <span class="hljs-title class_">number</span>) =&gt; <span class="hljs-variable">void</span>,  <span class="hljs-comment">// 接收状态更新回调函数</span></li><li>        <span class="hljs-variable">title</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'title'</span>,</li><li>        <span class="hljs-variable">content</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'content'</span>,</li><li>        <span class="hljs-variable">backgroundColor</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'#0ff77c'</span>,</li><li>        <span class="hljs-variable">icon</span>?: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-title class_">void</span>&gt; {</li><li>        <span class="hljs-comment">// 注册 监听点击回调事件</span></li><li>        <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">on</span>(<span class="hljs-string">'click'</span>, () =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">FloatingBall</span> <span class="hljs-variable">onClickEvent</span>`);</li><li>            <span class="hljs-keyword">let</span> <span class="hljs-variable">want</span>: <span class="hljs-title class_">Want</span> = {</li><li>                <span class="hljs-variable">bundleName</span>: <span class="hljs-title class_">BUNDLE_NAME</span>,</li><li>                <span class="hljs-variable">abilityName</span>: <span class="hljs-string">'MainAbility'</span></li><li>            }</li><li>            <span class="hljs-comment">// 使用promise异步回调</span></li><li>            <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">restoreMainWindow</span>(<span class="hljs-variable">want</span>)</li><li>            .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Success</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">restoring</span> <span class="hljs-variable">FloatingBall</span> <span class="hljs-keyword">main</span> <span class="hljs-variable">window</span>`);</li><li>            }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">restore</span> <span class="hljs-variable">FloatingBall</span> <span class="hljs-keyword">main</span> <span class="hljs-variable">window</span>. <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>            })</li><li>        })</li><li>        <span class="hljs-comment">// 注册 监听状态变化事件</span></li><li>        <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">on</span>(<span class="hljs-string">'stateChange'</span>,</li><li>        (<span class="hljs-variable">state</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallState</span>) =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">FloatingBall</span> <span class="hljs-variable">stateCange</span>: ${<span class="hljs-variable">state</span>}`);</li><li>            <span class="hljs-keyword">if</span>(<span class="hljs-variable">state</span> === <span class="hljs-variable">floatingBall</span>.<span class="hljs-variable">FloatingBallState</span>.<span class="hljs-variable">STOPPED</span>) {</li><li>                <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">off</span>(<span class="hljs-string">'click'</span>)</li><li>                <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">off</span>(<span class="hljs-string">'stateChange'</span>)</li><li>                <span class="hljs-variable">floatingBallController</span> = <span class="hljs-variable">undefined</span>;</li><li>                <span class="hljs-comment">// 执行状态更新回调</span></li><li>                <span class="hljs-variable">onActiveRowChange</span>?.(-<span class="hljs-number">1</span>);</li><li>            }</li><li>        })</li><li>        <span class="hljs-comment">// 最后启动闪控球</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">startParams</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallParams</span> = <span class="hljs-variable">icon</span>? {</li><li>            <span class="hljs-variable">template</span>: <span class="hljs-title class_">template</span>,</li><li>            <span class="hljs-variable">title</span>: <span class="hljs-title class_">title</span>,</li><li>            <span class="hljs-variable">content</span>: <span class="hljs-title class_">content</span>,</li><li>            <span class="hljs-variable">backgroundColor</span>: <span class="hljs-title class_">backgroundColor</span>,</li><li>            <span class="hljs-variable">icon</span>: <span class="hljs-title class_">icon</span></li><li>        } : {</li><li>            <span class="hljs-variable">template</span>: <span class="hljs-title class_">template</span>,</li><li>            <span class="hljs-variable">title</span>: <span class="hljs-title class_">title</span>,</li><li>            <span class="hljs-variable">content</span>: <span class="hljs-title class_">content</span>,</li><li>            <span class="hljs-variable">backgroundColor</span>: <span class="hljs-title class_">backgroundColor</span></li><li>        }</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">startFloatingBall</span>(<span class="hljs-variable">startParams</span>)</li><li>            .<span class="hljs-title function_">then</span>(() =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">succeed</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">starting</span> <span class="hljs-variable">FloatingBall</span>`);</li><li>            }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">start</span> <span class="hljs-variable">FloatingBall</span>. <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>            })</li><li>        } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">e</span>) {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startFloatingBall Error'</span>, <span class="hljs-variable">e</span>)</li><li>        }</li><li>    }</li><li>
</li><li><span class="hljs-comment">// 闪控球更新逻辑</span></li><li><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">onClickUpdateFloatingBall</span>(</li><li>    <span class="hljs-variable">floatingBallController</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallController</span> | <span class="hljs-title class_">undefined</span>,</li><li>    <span class="hljs-variable">template</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallTemplate</span>,</li><li>    <span class="hljs-variable">title</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'newTitle'</span>,</li><li>    <span class="hljs-variable">content</span>: <span class="hljs-title class_">string</span> = <span class="hljs-string">'newContent'</span>,</li><li>    <span class="hljs-variable">icon</span>?: <span class="hljs-title class_">image</span>.<span class="hljs-title class_">PixelMap</span>): <span class="hljs-title class_">void</span> {</li><li>        <span class="hljs-comment">// 更新时给标题、内容 随机使用数字后缀</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">random_string</span>: <span class="hljs-title class_">string</span> = <span class="hljs-variable">Math</span>.<span class="hljs-title function_">floor</span>(<span class="hljs-variable">Math</span>.<span class="hljs-title function_">random</span>() * <span class="hljs-number">100</span>).<span class="hljs-title function_">toString</span>();</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">updateParams</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallParams</span> = <span class="hljs-variable">icon</span> ? {</li><li>            <span class="hljs-variable">template</span>: <span class="hljs-title class_">template</span>,</li><li>            <span class="hljs-variable">title</span>: <span class="hljs-title class_">title</span> + <span class="hljs-title class_">random_string</span>,</li><li>            <span class="hljs-variable">content</span>: <span class="hljs-title class_">content</span> + <span class="hljs-title class_">random_string</span>,</li><li>            <span class="hljs-variable">backgroundColor</span>: <span class="hljs-string">'#f6ea0a'</span>,</li><li>            <span class="hljs-variable">icon</span>: <span class="hljs-title class_">icon</span></li><li>        } : {</li><li>            <span class="hljs-variable">template</span>: <span class="hljs-title class_">template</span>,</li><li>            <span class="hljs-variable">title</span>: <span class="hljs-title class_">title</span> + <span class="hljs-title class_">random_string</span>,</li><li>            <span class="hljs-variable">content</span>: <span class="hljs-title class_">content</span> + <span class="hljs-title class_">random_string</span>,</li><li>            <span class="hljs-variable">backgroundColor</span>: <span class="hljs-string">'#f6ea0a'</span>,</li><li>        }</li><li>        <span class="hljs-keyword">try</span> {</li><li>            <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">updateFloatingBall</span>(<span class="hljs-variable">updateParams</span>).<span class="hljs-title function_">then</span>(() =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Succeed</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">updating</span> <span class="hljs-variable">FloatingBall</span>`);</li><li>            }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>                <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">update</span> <span class="hljs-variable">FloatingBall</span>. <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>            })</li><li>        } <span class="hljs-keyword">catch</span> (<span class="hljs-variable">e</span>) {</li><li>            <span class="hljs-variable">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'updateFloatingBall Error:'</span>, <span class="hljs-variable">e</span>)</li><li>        }</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 闪控球停止逻辑</span></li><li>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-title function_">onClickStopFloatingBall</span>(<span class="hljs-variable">floatingBallController</span>: <span class="hljs-title class_">floatingBall</span>.<span class="hljs-title class_">FloatingBallController</span> | <span class="hljs-title class_">undefined</span>): <span class="hljs-title class_">void</span> {</li><li>        <span class="hljs-comment">// stop 是异步流程，需要通过 stateChange 状态回调获取实际删除结果</span></li><li>        <span class="hljs-variable">floatingBallController</span>?.<span class="hljs-title function_">stopFloatingBall</span>().<span class="hljs-title function_">then</span>(() =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">debug</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">Succeed</span> <span class="hljs-keyword">in</span> <span class="hljs-variable">stopping</span> <span class="hljs-variable">FloatingBall</span>`);</li><li>        }).<span class="hljs-keyword">catch</span>((<span class="hljs-variable">err</span>: <span class="hljs-title class_">BusinessError</span>) =&gt; {</li><li>            <span class="hljs-variable">hilog</span>.<span class="hljs-title function_">error</span>(<span class="hljs-variable">DOMAIN</span>, <span class="hljs-variable">TAG</span>, `<span class="hljs-variable">failed</span> <span class="hljs-variable">to</span> <span class="hljs-variable">stop</span> <span class="hljs-variable">FloatingBall</span>. <span class="hljs-variable">code</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">code</span>}, <span class="hljs-variable">message</span>: ${<span class="hljs-variable">err</span>.<span class="hljs-variable">message</span>}`);</li><li>        })</li><li>    }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/guide-snippets/blob/master/ArkUIKit/FloatingBall/entry/src/main/ets/util/Utils.ts#L17-L145" target="_blank">Utils.ts</a></div></div></div></div> <div class="screenLinkPre"><div _ngcontent-eoq-c106="" class="highlight-div"><div _ngcontent-eoq-c106="" class="highlight-div-header"><div _ngcontent-eoq-c106="" class="highlight-div-header-left"><div _ngcontent-eoq-c106="" class="handle-button expand-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-eoq-c106="" class="highlight-div-header-right"><div _ngcontent-eoq-c106="" class="handle-button ai-button"></div><div _ngcontent-eoq-c106="" class="handle-button line-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-eoq-c106="" class="handle-button theme-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-eoq-c106="" class="handle-button copy-button"><div _ngcontent-eoq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-eoq-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-kotlin" codehub="https://gitee.com/harmonyos_samples/guide-snippets/blob/master/ArkUIKit/FloatingBall/entry/src/main/ets/pages/Index.ets#L17-L191" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// Index.ets</span></li><li><span class="hljs-comment">// 该页面利用按钮点击事件展示闪控球基本操作</span></li><li><span class="hljs-keyword">import</span> hilog from <span class="hljs-string">'@ohos.hilog'</span>;</li><li><span class="hljs-keyword">import</span> image from <span class="hljs-string">'@ohos.multimedia.image'</span>;</li><li><span class="hljs-keyword">import</span> { floatingBall } from <span class="hljs-string">'@kit.ArkUI'</span>;</li><li><span class="hljs-keyword">import</span> { Utils } from <span class="hljs-string">'../util/Utils'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> DOMAIN: number = <span class="hljs-number">0xF811</span>;</li><li><span class="hljs-keyword">const</span> TAG: string = <span class="hljs-string">'[Sample_FloatingBall]'</span>;</li><li>
</li><li><span class="hljs-meta">@Entry</span> </li><li><span class="hljs-meta">@Component</span></li><li>struct Index {</li><li>  <span class="hljs-comment">// 当前可用的行，-1 表示全部行可见</span></li><li>  <span class="hljs-meta">@State</span> <span class="hljs-keyword">private</span> activeRow: number = -<span class="hljs-number">1</span>;</li><li>  <span class="hljs-comment">// 声明闪控球控制器</span></li><li>  <span class="hljs-keyword">private</span> floatingBallController: floatingBall.FloatingBallController | undefined = undefined;</li><li>  <span class="hljs-comment">// 缓存 icon 图标（静态布局）</span></li><li>  <span class="hljs-keyword">private</span> cachedIcon1: image.PixelMap | undefined = undefined;</li><li>  <span class="hljs-comment">// 缓存 icon 图标（强调文本布局）</span></li><li>  <span class="hljs-keyword">private</span> cachedIcon2: image.PixelMap | undefined = undefined;</li><li>
</li><li>  <span class="hljs-comment">// activeRow 的状态更新函数（确保闪控球销毁时，activeRow的值更新为-1）</span></li><li>  <span class="hljs-keyword">private</span> activeRowChange = (value: number) =&gt; {<span class="hljs-keyword">this</span>.activeRow = value};</li><li>
</li><li>  <span class="hljs-comment">// 判断某个布局是否可用（是否置灰）</span></li><li>  <span class="hljs-keyword">private</span> isEnabled(rowInex: number): boolean {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">this</span>.activeRow === -<span class="hljs-number">1</span> || <span class="hljs-keyword">this</span>.activeRow === rowInex;</li><li>  }</li><li>
</li><li>  build() {</li><li>    Column({space: <span class="hljs-number">12</span>}) {</li><li>      <span class="hljs-comment">// 静态布局，支持标题和图标，该布局在创建后无法修改</span></li><li>      Row({space: <span class="hljs-number">6</span>}) {</li><li>        Button(<span class="hljs-string">'STATIC'</span>).onClick( async () =&gt; {</li><li>          <span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回的结果是UIAbilityContext</span></li><li>          <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>            <span class="hljs-keyword">this</span>.floatingBallController = await floatingBall.create({</li><li>              context: <span class="hljs-keyword">this</span>.getUIContext().getHostContext()</li><li>            })</li><li>          }</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>            <span class="hljs-comment">// 仅当没有缓存 cachedIcon1 时才加载；有缓存时，直接使用；</span></li><li>            <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.cachedIcon1) {</li><li>              let pixelMap = Utils.getRawfilePixelMapSync(<span class="hljs-string">'books.png'</span>);  <span class="hljs-comment">// 图片尺寸有最大限制</span></li><li>              <span class="hljs-keyword">if</span> (pixelMap) {</li><li>                <span class="hljs-keyword">this</span>.cachedIcon1 = pixelMap;  <span class="hljs-comment">// 把图标缓存起了</span></li><li>                hilog.debug(DOMAIN, TAG, `Success to load icon PixelMap`);</li><li>              } <span class="hljs-keyword">else</span> {</li><li>                hilog.error(DOMAIN, TAG, `Failed to load icon PixelMap`);</li><li>              }</li><li>            }</li><li>            Utils.onClickCreateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>              floatingBall.FloatingBallTemplate.STATIC, <span class="hljs-keyword">this</span>.activeRowChange, <span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>, <span class="hljs-string">'#0ff77c'</span>, <span class="hljs-keyword">this</span>.cachedIcon1)</li><li>              <span class="hljs-keyword">this</span>.activeRow = <span class="hljs-number">0</span>;</li><li>          }</li><li>        })</li><li>        .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">0</span>))</li><li>        <span class="hljs-comment">// 更新闪控球信息（该布局在创建后无法更新，按钮永久置灰）</span></li><li>        Button(<span class="hljs-string">'Update1'</span>).enabled(<span class="hljs-literal">false</span>)</li><li>        <span class="hljs-comment">// 关闭闪控球</span></li><li>        Button(<span class="hljs-string">'Close1'</span>).onClick(() =&gt; {</li><li>          Utils.onClickStopFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController);</li><li>          <span class="hljs-keyword">this</span>.activeRow = -<span class="hljs-number">1</span>;  <span class="hljs-comment">// 关闭后恢复所有行显示</span></li><li>        })</li><li>        .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">0</span>))</li><li>      }</li><li>      .width(<span class="hljs-string">'100%'</span>)</li><li>      .justifyContent(FlexAlign.Center)</li><li>      </li><li>    <span class="hljs-comment">// 普通文本布局，支持标题和内容</span></li><li>    Row({space: <span class="hljs-number">6</span>}) {</li><li>      Button(<span class="hljs-string">'NORMAL'</span>).onClick( async () =&gt; {</li><li>        <span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回的结果是UIAbilityContext</span></li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          <span class="hljs-keyword">this</span>.floatingBallController = await floatingBall.create({</li><li>            context: <span class="hljs-keyword">this</span>.getUIContext().getHostContext()</li><li>          })</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          Utils.onClickCreateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>            floatingBall.FloatingBallTemplate.NORMAL, <span class="hljs-keyword">this</span>.activeRowChange, <span class="hljs-string">'title'</span>, <span class="hljs-string">'content'</span>)</li><li>            <span class="hljs-keyword">this</span>.activeRow = <span class="hljs-number">1</span>;</li><li>        }</li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">1</span>))</li><li>      <span class="hljs-comment">// 更新闪控球信息</span></li><li>      Button(<span class="hljs-string">'Update2'</span>).onClick(() =&gt; Utils.onClickUpdateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>        floatingBall.FloatingBallTemplate.NORMAL))</li><li>        .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">1</span>))</li><li>      <span class="hljs-comment">// 关闭闪控球</span></li><li>      Button(<span class="hljs-string">'Close2'</span>).onClick(() =&gt; {</li><li>        Utils.onClickStopFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController);</li><li>        <span class="hljs-keyword">this</span>.activeRow = -<span class="hljs-number">1</span>;  <span class="hljs-comment">// 关闭后恢复所有行显示</span></li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">1</span>))</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Center)</li><li>    </li><li>     <span class="hljs-comment">// 强调文本布局，支持标题、图标和内容</span></li><li>     Row({space: <span class="hljs-number">6</span>}) {</li><li>      Button(<span class="hljs-string">'EMPHATIC'</span>).onClick( async () =&gt; {</li><li>        <span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回的结果是UIAbilityContext</span></li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          <span class="hljs-keyword">this</span>.floatingBallController = await floatingBall.create({</li><li>            context: <span class="hljs-keyword">this</span>.getUIContext().getHostContext()</li><li>          })</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          <span class="hljs-comment">// 仅当没有缓存 cachedIcon2 时才加载；有缓存时，直接使用；</span></li><li>          <span class="hljs-keyword">if</span>(!<span class="hljs-keyword">this</span>.cachedIcon2) {</li><li>            let pixelMap = Utils.getRawfilePixelMapSync(<span class="hljs-string">'video.png'</span>);  <span class="hljs-comment">// 图片尺寸有最大限制</span></li><li>            <span class="hljs-keyword">if</span> (pixelMap) {</li><li>              <span class="hljs-keyword">this</span>.cachedIcon2 = pixelMap;  <span class="hljs-comment">// 把图标缓存起了</span></li><li>              hilog.debug(DOMAIN, TAG, `Success to load icon PixelMap`);</li><li>            } <span class="hljs-keyword">else</span> {</li><li>              hilog.debug(DOMAIN, TAG, `Failed to load icon PixelMap`);</li><li>            }</li><li>          }</li><li>          Utils.onClickCreateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>            floatingBall.FloatingBallTemplate.EMPHATIC, <span class="hljs-keyword">this</span>.activeRowChange, <span class="hljs-string">'16'</span>, <span class="hljs-string">'Min'</span>, <span class="hljs-string">'#0ff77c'</span>, <span class="hljs-keyword">this</span>.cachedIcon2)</li><li>            <span class="hljs-keyword">this</span>.activeRow = <span class="hljs-number">2</span>;</li><li>        }</li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">2</span>))</li><li>      <span class="hljs-comment">// 更新闪控球信息</span></li><li>      Button(<span class="hljs-string">'Update3'</span>).onClick(() =&gt; Utils.onClickUpdateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>        floatingBall.FloatingBallTemplate.EMPHATIC, <span class="hljs-string">''</span>, <span class="hljs-string">'Min'</span>, <span class="hljs-keyword">this</span>.cachedIcon2))</li><li>        .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">2</span>))</li><li>      <span class="hljs-comment">// 关闭闪控球</span></li><li>      Button(<span class="hljs-string">'Close3'</span>).onClick(() =&gt; {</li><li>        Utils.onClickStopFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController);</li><li>        <span class="hljs-keyword">this</span>.activeRow = -<span class="hljs-number">1</span>;  <span class="hljs-comment">// 关闭后恢复所有行显示</span></li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">2</span>))</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Center)</li><li>
</li><li>    <span class="hljs-comment">// 纯文本布局，只支持标题</span></li><li>    Row({space: <span class="hljs-number">6</span>}) {</li><li>      Button(<span class="hljs-string">'SIMPLE'</span>).onClick( async () =&gt; {</li><li>        <span class="hljs-comment">// 请在组件内获取context，确保this.getUIContext().getHostContext()返回的结果是UIAbilityContext</span></li><li>        <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          <span class="hljs-keyword">this</span>.floatingBallController = await floatingBall.create({</li><li>            context: <span class="hljs-keyword">this</span>.getUIContext().getHostContext()</li><li>          })</li><li>        }</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">this</span>.floatingBallController) {</li><li>          Utils.onClickCreateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>            floatingBall.FloatingBallTemplate.SIMPLE, <span class="hljs-keyword">this</span>.activeRowChange, <span class="hljs-string">'title'</span>)</li><li>            <span class="hljs-keyword">this</span>.activeRow = <span class="hljs-number">3</span>;</li><li>        }</li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">3</span>))</li><li>      <span class="hljs-comment">// 更新闪控球信息</span></li><li>      Button(<span class="hljs-string">'Update4'</span>).onClick(() =&gt; Utils.onClickUpdateFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController,</li><li>        floatingBall.FloatingBallTemplate.SIMPLE))</li><li>        .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">3</span>))</li><li>      <span class="hljs-comment">// 关闭闪控球</span></li><li>      Button(<span class="hljs-string">'Close4'</span>).onClick(() =&gt; {</li><li>        Utils.onClickStopFloatingBall(<span class="hljs-keyword">this</span>.floatingBallController);</li><li>        <span class="hljs-keyword">this</span>.activeRow = -<span class="hljs-number">1</span>;  <span class="hljs-comment">// 关闭后恢复所有行显示</span></li><li>      })</li><li>      .enabled(<span class="hljs-keyword">this</span>.isEnabled(<span class="hljs-number">3</span>))</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Center)</li><li>    }</li><li>    .width(<span class="hljs-string">'100%'</span>)</li><li>    .height(<span class="hljs-string">'100%'</span>)</li><li>    .justifyContent(FlexAlign.Center)</li><li>  }</li><li>}</li></ol></pre><div class="screen-link-div"><a href="https://gitee.com/harmonyos_samples/guide-snippets/blob/master/ArkUIKit/FloatingBall/entry/src/main/ets/pages/Index.ets#L17-L191" target="_blank">Index.ets</a></div></div></div></div> </div> <div class="tiledSection"><h2 id="section14723151274210">示例代码<i class="anchor-icon anchor-icon-link" anchorid="section14723151274210" tips="复制节点链接"></i></h2><p><a href="https://gitee.com/harmonyos_samples/guide-snippets/tree/master/ArkUIKit/FloatingBall" target="_blank">闪控球</a></p> </div> </div> <div></div></div>