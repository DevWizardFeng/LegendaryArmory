<h1 _ngcontent-dgk-c119="" class="doc-title ng-star-inserted" title="内容分享"> 内容分享 </h1>

<div _ngcontent-dgk-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="section28318213471">注册碰一碰事件<i class="anchor-icon anchor-icon-link" anchorid="section28318213471" tips="复制节点链接"></i></h2>          <p>当用户进入支持碰一碰分享的界面或场景时，给出适当的引导和提示，可有效提升用户分享意愿。</p>     <p>引导方式参考以下效果图：</p>     <ul>      <li>文本提示<strong>可碰一碰分享至 HarmonyOS 5 及以上版本手机</strong>。       <p><span><img height="592.6087650000001" originheight="1060" originwidth="496" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.99117907883576094480140994700936:50001231000000:2800:DBE5CB92DB77AADDDA8AC5BD068FC98BCED735A50D7E3DBD8A5C8FC57B041FA8.png" title="点击放大" width="277.305"></span></p>       <p></p></li>     </ul>     <ul>      <li>动图提示<strong>可碰一碰分享</strong>。       <p><span><img height="554.61" originheight="1062" originwidth="1002" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.24697978789994848340589354053759:50001231000000:2800:3D5AAAC7EA31D462B638C25914F12E58CDEE67A0D11956DAF8BA1CF595BBD133.png" title="点击放大" width="523.6875"></span></p>       <p></p>       <p></p>       <p>Share Kit提供统一的动图资源文件以方便应用接入。</p>       <ul>        <li>下载地址：<a href="https://gitcode.com/harmonyos_samples/share-kit_-sample-code_-clientdemo_-arkts/tree/master/entry/src/main/resources/rawfile" target="_blank">碰一碰引导资源</a>，请完整下载knock_share_guide目录所有文件，并放置于应用entry/src/main/resources/rawfile目录下。</li>        <li>示例代码：<a href="https://gitcode.com/harmonyos_samples/share-kit_-sample-code_-clientdemo_-arkts/blob/master/entry/src/main/ets/components/subpages/KnockShareTips.ets" target="_blank">碰一碰引导示例代码</a>。</li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="section1880197194811">设置分享预览<i class="anchor-icon anchor-icon-link" anchorid="section1880197194811" tips="复制节点链接"></i></h2>          <p>接入碰一碰分享时，需根据不同的分享数据类型，适配相应的卡片模板。详细参见：<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/onehop-0000002354602581" target="_blank">碰一碰分享设计指南</a>。</p>    </div>    <div class="tiledSection">     <h3 id="section17478126134817" class="firsth2">设置配套的卡片样式<i class="anchor-icon anchor-icon-link" anchorid="section17478126134817" tips="复制节点链接"></i></h3>          <p>为保证碰一碰分享用户体验，Share Kit支持三种卡片模板供手机发起碰一碰分享时选择。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.1" valign="top" width="11.360000000000001%">          <p>卡片模板类型</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.2" valign="top" width="45.46%">          <p>说明</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.3.3.1.4.1.3" valign="top" width="43.18%">          <p>效果图</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="11.360000000000001%">          <p>纯图片布局</p></td>         <td class="cellrowborder" valign="top" width="45.46%">          <p>纯图片布局只包括预览图。</p>          <p>当分享数据为文件、图片等无需添加标题及描述的场景，推荐使用此卡片模板。</p>          <ul>           <li>使用方法            <p>构造分享数据时，仅传递预览图（thumbnailUri）字段，即可生成此卡片模板。</p></li>           <li>            <p>布局要求</p>            <p>预览图：支持最小宽高比1:4，超出部分将被裁剪。</p></li>          </ul></td>         <td class="cellrowborder" valign="top" width="43.18%">          <p><span><img height="597.860669" originheight="779" originwidth="366" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.49641047121059176866253417118236:50001231000000:2800:3F9D8AE5B5F4A0A73471CD7FFB1718BD7ECD8882FCE9BE8DB7220742FF5433A1.png" title="点击放大" width="280.89506900000003"></span></p>          <p></p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="11.360000000000001%">          <p>沉浸式大卡布局</p></td>         <td class="cellrowborder" valign="top" width="45.46%">          <p>沉浸式大卡布局包括预览图、标题、描述、应用图标。</p>          <div class="p">           当分享数据为链接类型时，需要向用户传递链接的内容，推荐使用此卡片模板。           <ul>            <li>使用方法             <div class="p">              需同时满足以下2个条件：              <ul>               <li>构造分享数据时，需同时传入标题（title）、描述（description）字段和预览图（thumbnailUri）字段。</li>               <li><strong>预览图宽高比小于1:1</strong>。</li>              </ul>             </div></li>           </ul>          </div>          <ul>           <li>布局要求            <ol>             <li>预览图：支持最小宽高比1:4，超出部分将被裁剪。</li>             <li>标题：最大可显示2行，当文本超过2行时，未能正常在屏幕显示的文本用省略号代替。如果标题末尾有重要信息显示，需应用自行控制字数约20个中文左右。</li>             <li>描述：仅可显示1行，文本超过1行时，未能正常在屏幕上显示的文本用省略号代替。</li>             <li>应用图标：无需配置，系统将默认获取应用图标用于显示在卡片底部。</li>            </ol></li>          </ul></td>         <td class="cellrowborder" valign="top" width="43.18%">          <p><span><img height="598.063095" originheight="779" originwidth="366" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.30084686634972287525044644231517:50001231000000:2800:0A41318EB37F38DE452AAE13208DD9A27B7C909CD8A0E583640CB338D7007D49.png" title="点击放大" width="280.993755"></span></p>          <p></p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="11.360000000000001%">          <p>白卡上下布局</p></td>         <td class="cellrowborder" valign="top" width="45.46%">          <p>白卡上下布局包括预览图、标题、描述、应用图标。当分享数据为链接类型时，需要向用户传递链接的内容，推荐使用此卡片模板。</p>          <ul>           <li>使用方法            <div class="p">             需同时满足以下2个条件：             <ol>              <li>构造分享数据时，需同时传入标题(title)、描述(description)字段和预览图(thumbnailUri)字段。</li>              <li><strong>预览图宽高比大于1:1</strong>。</li>             </ol>            </div></li>           <li>布局要求            <ol>             <li>预览图：仅显示在卡片上方，不会铺满整个卡片。</li>             <li>标题：最大可显示2行，当文本超过2行时，未能正常在屏幕显示的文本用省略号代替。如果标题末尾有重要信息显示，需应用自行控制字数约20个中文左右。</li>             <li>描述：仅可显示1行，文本超过1行时，未能正常在屏幕上显示的文本用省略号代替。</li>             <li>应用图标：无需配置，系统将默认获取应用图标用于显示在卡片底部。</li>            </ol></li>          </ul></td>         <td class="cellrowborder" valign="top" width="43.18%">          <p><span><img height="603.050595" originheight="779" originwidth="366" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.67100234287407283652891995394610:50001231000000:2800:C6E58ADBDDC781C9319BC5BC475E45303469B8D4E3AB1E1E75B4A026F67AB09A.png" title="点击放大" width="283.332959"></span></p>          <p></p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section5566160174918">设置合适的预览图<i class="anchor-icon anchor-icon-link" anchorid="section5566160174918" tips="复制节点链接"></i></h3>          <p>预览图的质量直接影响碰一碰卡片的显示效果。预览图太大或太小，会导致加载较慢或显示模糊等体验问题，建议开发者按照下表的推荐比例和分辨率设置合适的预览图。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.4.1.1" valign="top" width="33.33333333333333%">          <p>预览图来源</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.4.1.2" valign="top" width="33.33333333333333%">          <p>推荐比例</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.4.3.1.4.1.3" valign="top" width="33.33333333333333%">          <p>推荐分辨率（单位：px）</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>应用创作的海报</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>3:4</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>最小分辨率：600*800</p>          <p>最大分辨率：3000*4000</p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>用户上传的图片</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>不限制</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>最小分辨率：不限制</p>          <p>最大分辨率：3000*4000</p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="section1972092574919">使用预览图更新能力<i class="anchor-icon anchor-icon-link" anchorid="section1972092574919" tips="复制节点链接"></i></h3>          <p>当应用使用云端存储的图片作为预览图时，碰一碰分享的回调触发时，可能存在无法及时下载到本地，而导致超时失败的情况。</p>     <p>针对以上场景，Share Kit提供预览图延迟更新的能力。</p>     <ol>      <li>开发者在接到碰一碰事件触发的回调时，可仅发送分享的核心数据内容，建立连接。</li>      <li>Share Kit会提供默认的预览图用于卡片展示。</li>      <li>待云端存储的图片下载完成时，调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section18386290710" target="_blank">sharableTarget.updateShareData</a>接口更新预览图信息。</li>     </ol>     <div _ngcontent-dgk-c106="" class="highlight-div"><div _ngcontent-dgk-c106="" class="highlight-div-header"><div _ngcontent-dgk-c106="" class="highlight-div-header-left"><div _ngcontent-dgk-c106="" class="handle-button expand-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgk-c106="" class="highlight-div-header-right"><div _ngcontent-dgk-c106="" class="handle-button ai-button"></div><div _ngcontent-dgk-c106="" class="handle-button line-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgk-c106="" class="handle-button theme-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgk-c106="" class="handle-button copy-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">uniformTypeDescriptor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">utd</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">systemShare</span>, <span class="hljs-variable">harmonyShare</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">fileUri</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SendCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>    }</li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-variable">capabilityRegistry</span>, (<span class="hljs-variable">sharableTarget</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SharableTarget</span>) =&gt; {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">systemShare</span>.<span class="hljs-title function_">SharedData</span>({</li><li>        <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">HYPERLINK</span>,</li><li>        <span class="hljs-variable">content</span>: <span class="hljs-string">'https://sharekitdemo.drcn.agconnect.link/ZB3p'</span>,</li><li>        <span class="hljs-comment">// 根据title,description,thumbnailUri会生成不同的卡片模板，具体可参考设置配套的卡片样式。</span></li><li>        <span class="hljs-variable">title</span>: <span class="hljs-string">'碰一碰分享卡片标题'</span>,</li><li>        <span class="hljs-variable">description</span>: <span class="hljs-string">'碰一碰分享卡片描述'</span></li><li>      });</li><li>      <span class="hljs-comment">// 若云端预览图无法及时下载 可先发送数据</span></li><li>      <span class="hljs-variable">sharableTarget</span>.<span class="hljs-title function_">share</span>(<span class="hljs-variable">shareData</span>);</li><li>
</li><li>      <span class="hljs-title function_">setTimeout</span>(() =&gt; {</li><li>        <span class="hljs-comment">// 待预览图下载完成后 补充更新预览图</span></li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">contextFaker</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">filePath</span> = <span class="hljs-variable">contextFaker</span>.<span class="hljs-variable">filesDir</span> + <span class="hljs-string">'/exampleKnock1.jpg'</span>; <span class="hljs-comment">// 仅为示例 请替换正确的文件路径</span></li><li>        <span class="hljs-variable">sharableTarget</span>.<span class="hljs-title function_">updateShareData</span>({</li><li>          <span class="hljs-variable">thumbnailUri</span>: <span class="hljs-title class_">fileUri</span>.<span class="hljs-title class_">getUriFromPath</span>(<span class="hljs-title class_">filePath</span>)</li><li>        });</li><li>      }, <span class="hljs-number">5000</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SendCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>    }</li><li>    <span class="hljs-comment">// 解除碰一碰分享'knockShare'监听事件</span></li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-variable">capabilityRegistry</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section7962195584919">安全策略<i class="anchor-icon anchor-icon-link" anchorid="section7962195584919" tips="复制节点链接"></i></h3>          <p>鉴于保护碰一碰发送端/接收端的信息安全考虑，在HarmonyOS NEXT 5.0.0.123 SP16及以上版本，碰一碰分享增加了对端华为账号或设备标识，帮助用户识别分享发送端/接收端的身份。具体规则如下：</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.1" valign="top" width="33.33333333333333%">          <p>设备</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.2" valign="top" width="33.33333333333333%">          <p>对端已登录华为账号</p></th>         <th align="left" class="cellrowborder" id="mcps1.3.6.3.1.4.1.3" valign="top" width="33.33333333333333%">          <p>对端未登录华为账号</p></th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>碰一碰发送端</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>若对端已登录华为账号，将展示接收端华为账号昵称和头像。</p>          <p><span><img height="581.5894490000001" originheight="804" originwidth="378" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.96660525281071254024798314360308:50001231000000:2800:839860BA0AEEB39A80177D7E6AF5A88ECA136354D1FA2D18F42A408C886FEC21.png" title="点击放大" width="273.43376900000004"></span></p>          <p></p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>若对端未登录华为账号，将展示接收端设备信息。</p>          <p><span><img height="580.554044" originheight="776" originwidth="364" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.74396641340768888847810881927313:50001231000000:2800:8265810FA943FC272EC58B6EE655126DF8388C238DAA50C60C925DAF8D1C0A86.png" title="点击放大" width="272.3175"></span></p>          <p></p></td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>碰一碰接收端</p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>若对端已登录华为账号，将展示发送端华为账号昵称和头像。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>若发送端为HarmonyOS NEXT 5.0.0.123 SP16之前的版本，则不会展示任何信息。</p>           </div></div></div>          <p><span><img height="581.3370150000001" originheight="804" originwidth="378" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.87991193579592553690763620748070:50001231000000:2800:43367609629E886B3CD62F23C56ADA76B4AF8ED39B36AA4EFB681C36CA29BC7D.png" title="点击放大" width="273.315"></span></p>          <p></p></td>         <td class="cellrowborder" valign="top" width="33.33333333333333%">          <p>若对端未登录华为账号，将展示发送端设备信息。</p>          <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">            <p>若发送端为HarmonyOS NEXT 5.0.0.123 SP16之前的版本，则不会展示任何信息。</p>           </div></div></div>          <p><span><img height="578.8601560000001" originheight="778" originwidth="366" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114658.87559321236715563247680754152979:50001231000000:2800:BFAE2ECECC129215BCA2E50595E660E80047FD8C710C70CDD5DF1CFA4B84C33F.png" title="点击放大" width="272.3175"></span></p>          <p></p></td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h2 id="section1083592311502">发送分享数据<i class="anchor-icon anchor-icon-link" anchorid="section1083592311502" tips="复制节点链接"></i></h2>          <p>通过链接形式指定应用跳转，通常有2种方式：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/app-linking-startup" target="_blank">使用App Linking实现应用间跳转</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/deep-linking-startup" target="_blank">使用Deep Linking实现应用间跳转</a>。</p>     <p>指定应用跳转时，utd类型需配置为"general.hyperlink"，确保Share Kit以正确的方式处理链接。</p>    </div>    <div class="tiledSection">     <h3 id="section11993134415016" class="firsth2">App Linking<i class="anchor-icon anchor-icon-link" anchorid="section11993134415016" tips="复制节点链接"></i></h3>          <p>使用App Linking进行跳转时，无论应用是否已安装，用户都可以访问到链接对应的内容。</p>     <p>结合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/applinking-introduction" target="_blank">App Linking Kit（应用链接服务）</a>能力，在指定应用未安装时，可实现直达应用市场等能力，进一步提升用户体验。</p>     <ul>      <li>当应用已安装时，App Linking可直接拉起应用。</li>      <li>当应用未安装时，App Linking的默认行为是通过系统浏览器打开链接对应的网页。通过App Linking Kit的直达应用市场能力，可以实现在应用未安装时直接跳转应用市场。详情参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/applinking-direct-to-ag" target="_blank">直达应用市场能力</a>。配合<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/applinking-deferredlink" target="_blank">延迟链接能力</a>，即便触发碰一碰分享时应用未安装，待下载启动后仍能获取之前分享的链接，提升了用户体验，也提升了链接转换率。</li>     </ul>     <p>示例代码：</p>     <div _ngcontent-dgk-c106="" class="highlight-div"><div _ngcontent-dgk-c106="" class="highlight-div-header"><div _ngcontent-dgk-c106="" class="highlight-div-header-left"><div _ngcontent-dgk-c106="" class="handle-button expand-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgk-c106="" class="highlight-div-header-right"><div _ngcontent-dgk-c106="" class="handle-button ai-button"></div><div _ngcontent-dgk-c106="" class="handle-button line-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgk-c106="" class="handle-button theme-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgk-c106="" class="handle-button copy-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">uniformTypeDescriptor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">utd</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">harmonyShare</span>, <span class="hljs-variable">systemShare</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">fileUri</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CoreFileKit'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">HarmonyShareScenes</span> {</li><li>  <span class="hljs-comment">// Entry Component 代码片段</span></li><li>  <span class="hljs-title function_">onPageHide</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>    <span class="hljs-variable">context</span>.<span class="hljs-variable">eventHub</span>.<span class="hljs-title function_">emit</span>(<span class="hljs-string">'onBackGround'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">immersiveListening</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>    <span class="hljs-variable">context</span>.<span class="hljs-variable">eventHub</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'onBackGround'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">onBackGround</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">immersiveDisablingListening</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>    <span class="hljs-variable">context</span>.<span class="hljs-variable">eventHub</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'onBackGround'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">onBackGround</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">onBackGround</span> = () =&gt; {</li><li>    <span class="hljs-keyword">this</span>.<span class="hljs-title function_">immersiveDisablingListening</span>();</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-variable">immersiveCallback</span> = (<span class="hljs-variable">sharableTarget</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">SharableTarget</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">contextFaker</span>: <span class="hljs-title class_">Context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">Context</span>;</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">filePath</span> = <span class="hljs-variable">contextFaker</span>.<span class="hljs-variable">filesDir</span> + <span class="hljs-string">'/exampleKnock1.jpg'</span>; <span class="hljs-comment">// 仅为示例 请替换正确的文件路径</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">shareData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span> = <span class="hljs-variable">new</span> <span class="hljs-variable">systemShare</span>.<span class="hljs-title function_">SharedData</span>({</li><li>      <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">HYPERLINK</span>,</li><li>      <span class="hljs-variable">content</span>: <span class="hljs-string">'https://sharekitdemo.drcn.agconnect.link/ZB3p'</span>,</li><li>      <span class="hljs-comment">// 根据title,description,thumbnailUri会生成不同的卡片模板，具体可参考设置配套的卡片样式。</span></li><li>      <span class="hljs-variable">thumbnailUri</span>: <span class="hljs-title class_">fileUri</span>.<span class="hljs-title class_">getUriFromPath</span>(<span class="hljs-title class_">filePath</span>),</li><li>      <span class="hljs-variable">title</span>: <span class="hljs-string">'碰一碰分享卡片标题'</span>,</li><li>      <span class="hljs-variable">description</span>: <span class="hljs-string">'碰一碰分享卡片描述'</span></li><li>    });</li><li>    <span class="hljs-variable">sharableTarget</span>.<span class="hljs-title function_">share</span>(<span class="hljs-variable">shareData</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">immersiveListening</span>() {</li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">immersiveCallback</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-title function_">immersiveDisablingListening</span>() {</li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-keyword">this</span>.<span class="hljs-variable">immersiveCallback</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="section137219725118">Deep Linking<i class="anchor-icon anchor-icon-link" anchorid="section137219725118" tips="复制节点链接"></i></h3>          <p>使用Deep Linking进行跳转时，系统仅会在本地已安装的应用中寻找到符合条件的应用。未找到时将弹出提示<strong>暂无可用打开方式</strong>。</p>    </div>    <div class="tiledSection">     <h2 id="section1142174216514">异常场景需终止分享<i class="anchor-icon anchor-icon-link" anchorid="section1142174216514" tips="复制节点链接"></i></h2>          <p>进入需要分享的页面，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section1215414133214" target="_blank">harmonyShare.on('knockShare')</a>注册碰一碰分享事件，当宿主应用接收到系统发出的碰一碰事件回调时，可能由于网络或者业务原因无法发起分享，此时开发者可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section063111381379" target="_blank">sharableTarget.reject()</a>终止本次分享，并提示用户终止的原因。</p>    </div>    <p>示例代码：</p>    <div _ngcontent-dgk-c106="" class="highlight-div"><div _ngcontent-dgk-c106="" class="highlight-div-header"><div _ngcontent-dgk-c106="" class="highlight-div-header-left"><div _ngcontent-dgk-c106="" class="handle-button expand-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-dgk-c106="" class="highlight-div-header-right"><div _ngcontent-dgk-c106="" class="handle-button ai-button"></div><div _ngcontent-dgk-c106="" class="handle-button line-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-dgk-c106="" class="handle-button theme-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-dgk-c106="" class="handle-button copy-button"><div _ngcontent-dgk-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-dgk-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { harmonyShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li>
</li><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-keyword">void</span> {</li><li>  harmonyShare.<span class="hljs-title function_">on</span>(<span class="hljs-string">'knockShare'</span>, <span class="hljs-function">(<span class="hljs-params">sharableTarget: harmonyShare.SharableTarget</span>) =&gt;</span> {</li><li>    sharableTarget.<span class="hljs-title function_">reject</span>(harmonyShare.<span class="hljs-property">SharableErrorCode</span>.<span class="hljs-property">NO_CONTENT_ERROR</span>);</li><li>  });</li><li>}</li></ol></pre></div></div>   </div>   <div></div></div>