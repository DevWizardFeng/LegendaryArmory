<h1 _ngcontent-ano-c119="" class="doc-title ng-star-inserted" title="内部关联接口"> 内部关联接口 </h1>

<div _ngcontent-ano-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>在进行算子原型注册、Tiling实现、shape推导过程中，使用到的外部开放接口中会调用到一些辅助数据结构和接口，称之为<strong>内部关联接口</strong>。开发者不会直接调用内部关联接口，此处仅作简单介绍。</p> <div class="tiledSection"><h2 id="section86102mcpsimp">CTilingDataClassFactory<i class="anchor-icon anchor-icon-link" anchorid="section86102mcpsimp" tips="复制节点链接"></i></h2><p>CTilingDataClassFactory类用于注册AscendC高阶API和开发者自定义tiling结构，通过单例实现的工厂类，在<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cannkit-tilingdata-structure-registration">TilingData结构注册</a>中REGISTER_TILING_DATA_CLASS中使用。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表1 </b>CTilingDataClassFactory成员函数</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.3.2.3.1.1" valign="top" width="18%"><p>函数名称</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.3.2.3.1.2" valign="top" width="82%"><p>含义</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18%"><p>GetInstance</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>获取CTilingDataClassFactory类的单例。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>RegisterTilingData</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>注册op_type的tiling结构constructor至CTilingDataClassFactory工厂类。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18%"><p>CreateTilingDataInstance</p> </td> <td class="cellrowborder" valign="top" width="82%"><p>根据算子名获取tiling结构。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section86134mcpsimp">OpDef相关接口<i class="anchor-icon anchor-icon-link" anchorid="section86134mcpsimp" tips="复制节点链接"></i></h2><p>原型注册相关类的一些非对外开放接口，包括OpDef、OpParamDef、OpAICoreConfig等，下述接口均为框架生成相关工程所需，开发者无需关心。</p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><caption><b>表2 </b>OpDef相关类及其成员函数</caption><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.1" valign="top" width="24%"><p>类名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.2" valign="top" width="31%"><p>接口名</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.4.1.3" valign="top" width="45%"><p>接口功能</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="24%"><p>OpAICoreDef</p> </td> <td class="cellrowborder" valign="top" width="31%"><p>GetTiling</p> </td> <td class="cellrowborder" valign="top" width="45%"><p>获取Tiling信息。</p> </td> </tr> <tr><td class="cellrowborder" rowspan="2" valign="top" width="24%"><p>OpDef</p> </td> <td class="cellrowborder" valign="top" width="31%"><p>GetInferShape</p> </td> <td class="cellrowborder" valign="top" width="45%"><p>获取Shape推导函数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top"><p>GetInferDataType</p> </td> <td class="cellrowborder" valign="top"><p>获取DataType推导函数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="24%"><p>OpDefFactory</p> </td> <td class="cellrowborder" valign="top" width="31%"><p>OpDefRegister</p> </td> <td class="cellrowborder" valign="top" width="45%"><p>注册算子。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section86230mcpsimp">Tiling定义辅助接口<i class="anchor-icon anchor-icon-link" anchorid="section86230mcpsimp" tips="复制节点链接"></i></h2><p>以下接口为Tiling定义辅助接口。AscendC提供了一系列Tiling类型定义宏，包含BEGIN_TILING_DATA_DEF、TILING_DATA_FIELD_DEF、TILING_DATA_FIELD_DEF_ARR、TILING_DATA_FIELD_DEF_STRUCT、REGISTER_TILING_DATA_CLASS。开发者调用该系列宏会调用以下接口对tiling信息进一步处理，包含结构信息保留、字节对齐等。</p> <div _ngcontent-ano-c106="" class="highlight-div"><div _ngcontent-ano-c106="" class="highlight-div-header"><div _ngcontent-ano-c106="" class="highlight-div-header-left"><div _ngcontent-ano-c106="" class="handle-button expand-button"><div _ngcontent-ano-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ano-c106="" class="highlight-div-header-right"><div _ngcontent-ano-c106="" class="handle-button ai-button"></div><div _ngcontent-ano-c106="" class="handle-button line-button"><div _ngcontent-ano-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ano-c106="" class="handle-button theme-button"><div _ngcontent-ano-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ano-c106="" class="handle-button copy-button"><div _ngcontent-ano-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ano-c106="" class="highlight-scroll-div"><pre class="cpp prettyprint linenums hljs language-cpp" hw-language="cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// TilingDef类 </span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SaveToBuffer</span><span class="hljs-params">(<span class="hljs-type">void</span> *pdata, <span class="hljs-type">size_t</span> capacity)</span></span>; </li><li><span class="hljs-function">std::vector&lt;FieldInfo&gt; <span class="hljs-title">GetFieldInfo</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>; </li><li><span class="hljs-function"><span class="hljs-type">const</span> <span class="hljs-type">char</span> *<span class="hljs-title">GetTilingClassName</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>; </li><li><span class="hljs-function"><span class="hljs-type">size_t</span> <span class="hljs-title">GetDataSize</span><span class="hljs-params">()</span> <span class="hljs-type">const</span></span>; </li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">SetDataPtr</span><span class="hljs-params">(<span class="hljs-type">void</span> *dataPtr)</span></span>; </li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CheckAlignAndGenPlaceHolder</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">size_t</span> typeSize)</span></span>; </li><li><span class="hljs-comment">// FieldInfo类 </span></li><li><span class="hljs-built_in">FieldInfo</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *dtype, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name) </li><li><span class="hljs-built_in">FieldInfo</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *dtype, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">size_t</span> arrSize) </li><li><span class="hljs-built_in">FieldInfo</span>(<span class="hljs-type">const</span> <span class="hljs-type">char</span> *dtype, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *name, <span class="hljs-type">const</span> <span class="hljs-type">char</span> *structType,<span class="hljs-type">size_t</span> structSize)</li></ol></pre></div></div> </div> </div> <div></div></div>