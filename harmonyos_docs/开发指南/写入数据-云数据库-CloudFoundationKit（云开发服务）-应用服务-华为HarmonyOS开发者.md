<h1 _ngcontent-unv-c119="" class="doc-title ng-star-inserted" title="写入数据"> 写入数据 </h1>

<div _ngcontent-unv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>开发者可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/cloudfoundation-clouddatabase#section686153211276" target="_blank">upsert()</a>将一个或者一组对象写入到当前存储区中。在写入对象时，如果在存储区已经存在主键相同的对象，则更新已有的对象；如果不存在，则写入一个新的对象。写入的数据可以来自于新建对象，或者从存储区查询出来的对象。</p>    <p>写入一组对象时，数据的写入操作是原子性的，即对象列表中的对象要么全部成功写入，要么全部失败。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>写入一组对象时，该组中的对象必须属于同一个对象类型，否则会导致写入失败。</li>       <li>写入一组对象时，数据总大小不能超过2MB，否则会导致写入失败。</li>       <li>写入一组对象时，数据总条数不能超过1000条，否则会导致写入失败。</li>       <li>调用写入数据方法，有两种返回方式，返回一个Promise对象或者在参数中传入一个callback对象返回，下面以Promise为例详细说明。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="section133632819295">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="section133632819295" tips="复制节点链接"></i></h2>          <p id="ZH-CN_TOPIC_0000002440774416__zh-cn_topic_0000002440774444_p176909276175">支持Phone、Tablet设备。并且从5.1.0(18)版本开始，新增支持Wearable设备；从5.1.1(19)版本开始，新增支持TV设备。</p>    </div>    <div class="tiledSection">     <h2 id="section160501863017">前提条件<i class="anchor-icon anchor-icon-link" anchorid="section160501863017" tips="复制节点链接"></i></h2>          <p>已<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-database-initialize">初始化数据库访问</a>。</p>    </div>    <div class="tiledSection">     <h2 id="section12798324133517">写入数据<i class="anchor-icon anchor-icon-link" anchorid="section12798324133517" tips="复制节点链接"></i></h2>          <p>Promise对象中封装了写入操作执行的结果，通过该Promise对象可以异步侦听执行结果：如果执行成功，可以获取写入的对象数量；如果执行失败，可以获取错误信息。</p>     <p><strong>代码示例：</strong></p>     <p>将BookInfo对象写入至存储区中，写入成功后，返回写入的数量；写入失败，抛出异常。</p>     <div _ngcontent-unv-c106="" class="highlight-div"><div _ngcontent-unv-c106="" class="highlight-div-header"><div _ngcontent-unv-c106="" class="highlight-div-header-left"><div _ngcontent-unv-c106="" class="handle-button expand-button"><div _ngcontent-unv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-unv-c106="" class="highlight-div-header-right"><div _ngcontent-unv-c106="" class="handle-button ai-button"></div><div _ngcontent-unv-c106="" class="handle-button line-button"><div _ngcontent-unv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-unv-c106="" class="handle-button theme-button"><div _ngcontent-unv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-unv-c106="" class="handle-button copy-button"><div _ngcontent-unv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-unv-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 更新”西游记”的借阅者信息</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-title function_">upsert</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> book = <span class="hljs-keyword">await</span> <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">queryBook</span>(<span class="hljs-string">'西游记'</span>); <span class="hljs-comment">// 查询出”西游记”的书籍信息</span></li><li>    book.<span class="hljs-property">borrowerId</span> = <span class="hljs-number">1</span>;</li><li>    book.<span class="hljs-property">borrowerName</span> = <span class="hljs-string">'小明'</span>;</li><li>    book.<span class="hljs-property">borrowerTime</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();</li><li>    <span class="hljs-keyword">let</span> record = <span class="hljs-keyword">await</span> databaseZone.<span class="hljs-title function_">upsert</span>(book);</li><li>    hilog.<span class="hljs-title function_">info</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Succeeded in upserting a book, result: <span class="hljs-subst">${<span class="hljs-built_in">JSON</span>.stringify(record)}</span>`</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    hilog.<span class="hljs-title function_">error</span>(<span class="hljs-number">0x0000</span>, <span class="hljs-string">'testTag'</span>, <span class="hljs-string">`Failed to upsert a book, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>