<h1 _ngcontent-vww-c119="" class="doc-title ng-star-inserted" title="分享内容直达应用界面"> 分享内容直达应用界面 </h1>

<div _ngcontent-vww-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>从6.0.0(20)版本开始，PC/2in1设备支持沙箱接收的能力。</p>    <p>PC/2in1设备创新交互方案：支持手机轻贴屏幕即可将单/多文件快速传输至PC/2in1设备应用沙箱，传输完成后通知目标应用接收文件列表，实现无缝预览与编辑。</p>    <p>沙箱接收仅支持文件类型的数据，应用需指定支持接收的文件类型和最大数量。</p>    <ul>     <li>若类型不匹配，则跳过已注册的沙箱接口能力，采用华为分享默认逻辑接收文件数据。参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/share-access-one-step">目标设备接收分享数据一步直达体验</a>。</li>     <li>若数量不匹配，则通过系统弹窗提示用户异常。</li>    </ul>    <div class="tiledSection">     <h2 id="section778185713171">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section778185713171" tips="复制节点链接"></i></h2>          <p>1. 导入相关模块。</p>     <div _ngcontent-vww-c106="" class="highlight-div"><div _ngcontent-vww-c106="" class="highlight-div-header"><div _ngcontent-vww-c106="" class="highlight-div-header-left"><div _ngcontent-vww-c106="" class="handle-button expand-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vww-c106="" class="highlight-div-header-right"><div _ngcontent-vww-c106="" class="handle-button ai-button"></div><div _ngcontent-vww-c106="" class="handle-button line-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vww-c106="" class="handle-button theme-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vww-c106="" class="handle-button copy-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vww-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-javascript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { uniformTypeDescriptor <span class="hljs-keyword">as</span> utd } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { systemShare, harmonyShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { common } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div>     <div class="p">      2. 进入可接收数据的窗口，注册沙箱接收事件。      <div _ngcontent-vww-c106="" class="highlight-div"><div _ngcontent-vww-c106="" class="highlight-div-header"><div _ngcontent-vww-c106="" class="highlight-div-header-left"><div _ngcontent-vww-c106="" class="handle-button expand-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vww-c106="" class="highlight-div-header-right"><div _ngcontent-vww-c106="" class="handle-button ai-button"></div><div _ngcontent-vww-c106="" class="handle-button line-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vww-c106="" class="handle-button theme-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vww-c106="" class="handle-button copy-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vww-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">RecvCapabilityRegistry</span> = {</li><li>    <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>    <span class="hljs-variable">capabilities</span>: [{ <span class="hljs-comment">// 设置接收端支持的数据类型及数量</span></li><li>      <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">IMAGE</span>,</li><li>      <span class="hljs-variable">maxSupportedCount</span>: <span class="hljs-number">1</span>,</li><li>    }]</li><li>  }</li><li>  <span class="hljs-comment">// 注册沙箱接收'dataReceive'监听事件</span></li><li>  <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-variable">capabilityRegistry</span>, (<span class="hljs-variable">receivableTarget</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">ReceivableTarget</span>) =&gt; {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">uiContext</span>: <span class="hljs-title class_">UIContext</span> = <span class="hljs-keyword">this</span>.<span class="hljs-title function_">getUIContext</span>();</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">context</span> = <span class="hljs-variable">uiContext</span>.<span class="hljs-title function_">getHostContext</span>() <span class="hljs-keyword">as</span> <span class="hljs-variable">common</span>.<span class="hljs-variable">UIAbilityContext</span>;</li><li>    <span class="hljs-variable">receivableTarget</span>.<span class="hljs-title function_">receive</span>(<span class="hljs-variable">context</span>.<span class="hljs-variable">filesDir</span>, { <span class="hljs-comment">// 此路径仅为示例 使用时请替换实际路径</span></li><li>      <span class="hljs-variable">onDataReceived</span>: (<span class="hljs-variable">sharedData</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedData</span>) =&gt; {</li><li>        <span class="hljs-keyword">let</span> <span class="hljs-variable">sharedRecords</span> = <span class="hljs-variable">sharedData</span>.<span class="hljs-title function_">getRecords</span>();</li><li>        <span class="hljs-variable">sharedRecords</span>.<span class="hljs-title function_">forEach</span>((<span class="hljs-variable">record</span>: <span class="hljs-title class_">systemShare</span>.<span class="hljs-title class_">SharedRecord</span>) =&gt; {</li><li>          <span class="hljs-comment">// 处理分享数据</span></li><li>        });</li><li>      },</li><li>      <span class="hljs-title function_">onResult</span>(<span class="hljs-variable">resultCode</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">ShareResultCode</span>) {</li><li>        <span class="hljs-keyword">if</span> (<span class="hljs-variable">resultCode</span> === <span class="hljs-variable">harmonyShare</span>.<span class="hljs-variable">ShareResultCode</span>.<span class="hljs-variable">SHARE_SUCCESS</span>) {</li><li>          <span class="hljs-comment">// To do things.</span></li><li>        }</li><li>      }</li><li>    });</li><li>  });</li><li>}</li></ol></pre></div></div>     </div>     <p>3. 关闭可接收数据的窗口，解除沙箱接收事件。</p>     <div _ngcontent-vww-c106="" class="highlight-div"><div _ngcontent-vww-c106="" class="highlight-div-header"><div _ngcontent-vww-c106="" class="highlight-div-header-left"><div _ngcontent-vww-c106="" class="handle-button expand-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vww-c106="" class="highlight-div-header-right"><div _ngcontent-vww-c106="" class="handle-button ai-button"></div><div _ngcontent-vww-c106="" class="handle-button line-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vww-c106="" class="handle-button theme-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vww-c106="" class="handle-button copy-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vww-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">RecvCapabilityRegistry</span> = {</li><li>    <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>    <span class="hljs-variable">capabilities</span>: [{</li><li>      <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">IMAGE</span>,</li><li>      <span class="hljs-variable">maxSupportedCount</span>: <span class="hljs-number">1</span>,</li><li>    }]</li><li>  }</li><li>  <span class="hljs-comment">// 解除沙箱接收'dataReceive'监听事件</span></li><li>  <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-variable">capabilityRegistry</span>);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="section92652014151813">拒绝本次沙箱接收<i class="anchor-icon anchor-icon-link" anchorid="section92652014151813" tips="复制节点链接"></i></h2>          <p>当本次沙箱接收回调触发时，如果应用因为业务实现需要拒绝本次接收时，可使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-harmony-share#section193871531171019" target="_blank">ReceivableTarget.reject()</a>方法拒绝本次接收。</p>     <div _ngcontent-vww-c106="" class="highlight-div"><div _ngcontent-vww-c106="" class="highlight-div-header"><div _ngcontent-vww-c106="" class="highlight-div-header-left"><div _ngcontent-vww-c106="" class="handle-button expand-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-vww-c106="" class="highlight-div-header-right"><div _ngcontent-vww-c106="" class="handle-button ai-button"></div><div _ngcontent-vww-c106="" class="handle-button line-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-vww-c106="" class="handle-button theme-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-vww-c106="" class="handle-button copy-button"><div _ngcontent-vww-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-vww-c106="" class="highlight-scroll-div"><pre class="screen prettyprint linenums hljs language-cangjie" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">uniformTypeDescriptor</span> <span class="hljs-keyword">as</span> <span class="hljs-variable">utd</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ArkData'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-variable">harmonyShare</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li>
</li><li>@<span class="hljs-title function_">Component</span></li><li><span class="hljs-variable">export</span> <span class="hljs-variable">default</span> <span class="hljs-keyword">struct</span> <span class="hljs-title class_">Index</span> {</li><li>  <span class="hljs-title function_">aboutToAppear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">RecvCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>      <span class="hljs-variable">capabilities</span>: [{</li><li>        <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">IMAGE</span>,</li><li>        <span class="hljs-variable">maxSupportedCount</span>: <span class="hljs-number">1</span>,</li><li>      }]</li><li>    }</li><li>    <span class="hljs-comment">// 注册沙箱接收'dataReceive'监听事件</span></li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">on</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-variable">capabilityRegistry</span>, (<span class="hljs-variable">receivableTarget</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">ReceivableTarget</span>) =&gt; {</li><li>      <span class="hljs-variable">receivableTarget</span>.<span class="hljs-title function_">reject</span>(<span class="hljs-variable">harmonyShare</span>.<span class="hljs-variable">ReceivableErrorCode</span>.<span class="hljs-variable">NO_RECEIVABLE_ERROR</span>);</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">aboutToDisappear</span>(): <span class="hljs-title class_">void</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-variable">capabilityRegistry</span>: <span class="hljs-title class_">harmonyShare</span>.<span class="hljs-title class_">RecvCapabilityRegistry</span> = {</li><li>      <span class="hljs-variable">windowId</span>: <span class="hljs-number">999</span>, <span class="hljs-comment">// 此值仅为示例 实际使用时请替换正确的windowId</span></li><li>      <span class="hljs-variable">capabilities</span>: [{</li><li>        <span class="hljs-variable">utd</span>: <span class="hljs-title class_">utd</span>.<span class="hljs-title class_">UniformDataType</span>.<span class="hljs-title class_">IMAGE</span>,</li><li>        <span class="hljs-variable">maxSupportedCount</span>: <span class="hljs-number">1</span>,</li><li>      }]</li><li>    }</li><li>    <span class="hljs-comment">// 解除沙箱接收'dataReceive'监听事件</span></li><li>    <span class="hljs-variable">harmonyShare</span>.<span class="hljs-title function_">off</span>(<span class="hljs-string">'dataReceive'</span>, <span class="hljs-variable">capabilityRegistry</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>() {</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>