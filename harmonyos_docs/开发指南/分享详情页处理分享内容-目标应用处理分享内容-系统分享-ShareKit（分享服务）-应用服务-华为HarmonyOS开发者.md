<h1 _ngcontent-drp-c119="" class="doc-title ng-star-inserted" title="分享详情页处理分享内容"> 分享详情页处理分享内容 </h1>

<div _ngcontent-drp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>分享详情页能力基于<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiextensionability" target="_blank">UIExtensionAbility</a>界面嵌入能力。目标应用可以通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-shareextensionability" target="_blank">ShareExtensionAbility</a>构建接收分享内容的分享详情页，并将应用显示到分享面板应用推荐区内，通过分享详情页便捷的处理分享内容。开发时需要接入方实现<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-shareextensionability" target="_blank">ShareExtensionAbility</a>并于module.json5中注册支持分享内容的能力。</p>    <p>通过此方式注册的应用，点击时将跳转到分享详情页，也可返回分享面板。参见：<a href="https://developer.huawei.com/consumer/cn/doc/design-guides/share-0000001957076313#section27599419404" target="_blank">分享详情页面</a>。</p>    <div class="tiledSection">     <h2 id="section177591936123411">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="section177591936123411" tips="复制节点链接"></i></h2>          <ol>      <li>导入相关模块。       <div _ngcontent-drp-c106="" class="highlight-div"><div _ngcontent-drp-c106="" class="highlight-div-header"><div _ngcontent-drp-c106="" class="highlight-div-header-left"><div _ngcontent-drp-c106="" class="handle-button expand-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drp-c106="" class="highlight-div-header-right"><div _ngcontent-drp-c106="" class="handle-button ai-button"></div><div _ngcontent-drp-c106="" class="handle-button line-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drp-c106="" class="handle-button theme-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drp-c106="" class="handle-button copy-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span>, <span class="hljs-title class_">ShareExtensionAbility</span>, <span class="hljs-title class_">UIExtensionContentSession</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { systemShare } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.ShareKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>目标应用可以使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-shareextensionability" target="_blank">ShareExtensionAbility</a>为基类构建分享能力Ability。在Ability被启动后，可以在其<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-app-ability-uiextensionability#onsessioncreate" target="_blank">onSessionCreate</a>回调中获取传入的want参数，将want参数通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/share-system-share#section661613319216" target="_blank">getSharedData</a>解析后得到分享数据。       <div _ngcontent-drp-c106="" class="highlight-div"><div _ngcontent-drp-c106="" class="highlight-div-header"><div _ngcontent-drp-c106="" class="highlight-div-header-left"><div _ngcontent-drp-c106="" class="handle-button expand-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drp-c106="" class="highlight-div-header-right"><div _ngcontent-drp-c106="" class="handle-button ai-button"></div><div _ngcontent-drp-c106="" class="handle-button line-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drp-c106="" class="handle-button theme-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drp-c106="" class="handle-button copy-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestShareAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ShareExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onSessionCreate</span>(<span class="hljs-params">want: Want, session: UIExtensionContentSession</span>) {</li><li>    systemShare.<span class="hljs-title function_">getSharedData</span>(want)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data: systemShare.SharedData</span>) =&gt;</span> {</li><li>        data.<span class="hljs-title function_">getRecords</span>().<span class="hljs-title function_">forEach</span>(<span class="hljs-function">(<span class="hljs-params">record: systemShare.SharedRecord</span>) =&gt;</span> {        </li><li>          <span class="hljs-comment">// 处理分享数据</span></li><li>        });</li><li>        session.<span class="hljs-title function_">loadContent</span>(<span class="hljs-string">'pages/Index'</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to getSharedData. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        session.<span class="hljs-title function_">terminateSelf</span>();</li><li>      });</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>（可选）社交类应用可通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/intents-introduction" target="_blank">意图框架</a>捐献联系人推荐信息。当用户在推荐区选择联系人进行内容分享时，社交应用注册的Ability可从接收的want数据中获取到联系人信息，直接分享数据到指定用户。       <div _ngcontent-drp-c106="" class="highlight-div"><div _ngcontent-drp-c106="" class="highlight-div-header"><div _ngcontent-drp-c106="" class="highlight-div-header-left"><div _ngcontent-drp-c106="" class="handle-button expand-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drp-c106="" class="highlight-div-header-right"><div _ngcontent-drp-c106="" class="handle-button ai-button"></div><div _ngcontent-drp-c106="" class="handle-button line-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drp-c106="" class="handle-button theme-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drp-c106="" class="handle-button copy-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestShareAbility</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">ShareExtensionAbility</span> {</li><li>  <span class="hljs-title function_">onSessionCreate</span>(<span class="hljs-params">want: Want, session: UIExtensionContentSession</span>) {</li><li>    systemShare.<span class="hljs-title function_">getContactInfo</span>(want)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-keyword">async</span> (<span class="hljs-attr">contact</span>: systemShare.<span class="hljs-property">ContactInfo</span>) =&gt; {</li><li>        <span class="hljs-comment">// 处理联系人信息，可通过联系人类型（如：个人，群组等），联系人ID，进行指定用户分享。</span></li><li>        <span class="hljs-comment">// 获取分享数据</span></li><li>        <span class="hljs-keyword">let</span> data = <span class="hljs-keyword">await</span> systemShare.<span class="hljs-title function_">getSharedData</span>(want);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to getContactInfo. Code: <span class="hljs-subst">${error.code}</span>, message: <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        <span class="hljs-comment">// 联系人不存在或数据获取异常</span></li><li>        session.<span class="hljs-title function_">terminateSelf</span>();</li><li>      });</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>构建完分享能力Ability，需要在应用配置文件（src/main/module.json5）的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/module-configuration-file#skills标签" target="_blank">skills</a>配置中注册。配置actions为ohos.want.action.sendData，并且uris需穷举所有支持的数据类型。       <div _ngcontent-drp-c106="" class="highlight-div"><div _ngcontent-drp-c106="" class="highlight-div-header"><div _ngcontent-drp-c106="" class="highlight-div-header-left"><div _ngcontent-drp-c106="" class="handle-button expand-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-drp-c106="" class="highlight-div-header-right"><div _ngcontent-drp-c106="" class="handle-button ai-button"></div><div _ngcontent-drp-c106="" class="handle-button line-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-drp-c106="" class="handle-button theme-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-drp-c106="" class="handle-button copy-button"><div _ngcontent-drp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-drp-c106="" class="highlight-scroll-div"><pre class="typescript prettyprint linenums hljs language-typescript" hw-language="typescript" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-string">"extensionAbilities"</span>: [  </li><li>  {</li><li>    <span class="hljs-string">"name"</span>: <span class="hljs-string">"TestShareAbility"</span>,</li><li>    <span class="hljs-string">"srcEntry"</span>: <span class="hljs-string">"./ets/abilities/TestShareAbility.ts"</span>,</li><li>    <span class="hljs-string">"type"</span>: <span class="hljs-string">"share"</span>, <span class="hljs-comment">// 支持分享数据处理</span></li><li>    <span class="hljs-string">"description"</span>: <span class="hljs-string">"xxx"</span>,</li><li>    <span class="hljs-string">"exported"</span>: <span class="hljs-literal">true</span>,</li><li>    <span class="hljs-string">"label"</span>: <span class="hljs-string">"$string:xx_label"</span>,</li><li>    <span class="hljs-string">"icon"</span>: <span class="hljs-string">"$media:icon"</span>,</li><li>    <span class="hljs-string">"skills"</span>: [</li><li>      {</li><li>        <span class="hljs-string">"actions"</span>: [</li><li>          <span class="hljs-string">"ohos.want.action.sendData"</span></li><li>        ],</li><li>        <span class="hljs-comment">// 目标应用在配置支持接收的数据类型时，需穷举支持的UTD，比如：支持全部图片类型，可声明：general.image</span></li><li>        <span class="hljs-comment">// maxFileSupported 对于归属指定类型的文件，标识一次支持接收的最大数量。默认为0，代表不支持此类文件的分享。文件类型归属关系参考：</span><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-data-uniformtypedescriptor" target="_blank"><span class="hljs-comment">@ohos.data.uniformTypeDescriptor (标准化数据定义与描述)</span></a></li><li>        <span class="hljs-string">"uris"</span>: [</li><li>          {</li><li>            <span class="hljs-string">"scheme"</span>: <span class="hljs-string">"file"</span>,</li><li>            <span class="hljs-string">"utd"</span>: <span class="hljs-string">"general.text"</span>,</li><li>            <span class="hljs-string">"maxFileSupported"</span>: <span class="hljs-number">1</span></li><li>          },</li><li>          {</li><li>            <span class="hljs-string">"scheme"</span>: <span class="hljs-string">"file"</span>,</li><li>            <span class="hljs-string">"utd"</span>: <span class="hljs-string">"general.png"</span>,</li><li>            <span class="hljs-string">"maxFileSupported"</span>: <span class="hljs-number">1</span></li><li>          },</li><li>          {</li><li>            <span class="hljs-string">"scheme"</span>: <span class="hljs-string">"file"</span>,</li><li>            <span class="hljs-string">"utd"</span>: <span class="hljs-string">"general.jpeg"</span>,</li><li>            <span class="hljs-string">"maxFileSupported"</span>: <span class="hljs-number">1</span></li><li>          }</li><li>        ]</li><li>      }</li><li>    ]</li><li>  }</li><li>]</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>