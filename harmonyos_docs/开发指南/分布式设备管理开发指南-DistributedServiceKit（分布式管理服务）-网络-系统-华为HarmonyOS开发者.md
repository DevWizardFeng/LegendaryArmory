<h1 _ngcontent-fgm-c119="" class="doc-title ng-star-inserted" title="分布式设备管理开发指南"> 分布式设备管理开发指南 </h1>

<div _ngcontent-fgm-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <div class="tiledSection">     <h2 id="分布式设备管理简介">分布式设备管理简介<i class="anchor-icon anchor-icon-link" anchorid="分布式设备管理简介" tips="复制节点链接"></i></h2>          <p>随着用户不同种类的终端设备数量不断增多，将不同设备作为本端设备能力的扩展，使设备之间协同合作完成各种复杂场景即为设备的分布式业务。</p>     <p>分布式设备管理是分布式业务入口，在分布式业务中对周边可信和非可信设备进行统一管理。</p>     <p>分布式设备管理提供如下四大功能：</p>     <ul>      <li>       <p><strong>发现</strong></p>       <p>发现周围终端设备并上报。周围设备需要连接同局域网或者同时打开蓝牙，可以根据设备类型、距离、设备是否可信等进行筛选。</p></li>      <li>       <p><strong>绑定</strong></p>       <p>不同设备协同合作完成分布式业务的前提是设备间可信，对于周边发现的不可信设备，可通过绑定使彼此建立可信关系，提供pin码、碰、扫、靠等设备认证框架，支持对接各种认证交互接口。</p></li>      <li>       <p><strong>查询</strong></p>       <p>查询功能包含：查询本机设备信息、查询周围的在线的可信设备、查询可信设备信息。</p></li>      <li>       <p><strong>监听</strong></p>       <p>监听设备上、下线。设备上线表示设备间已经可信，业务可以发起分布式操作；设备下线表示分布业务不可用。</p></li>     </ul>    </div>    <div class="tiledSection">     <h3 id="运作机制" class="firsth2">运作机制<i class="anchor-icon anchor-icon-link" anchorid="运作机制" tips="复制节点链接"></i></h3>          <p>设备管理作为分布式业务入口，需要应用在所使用的业务场景，向发现设备主动发起绑定建立可信关系；业务结束后由业务自主判断是否解除绑定关系，设备间可信关系的解除由业务自己控制。</p>    </div>    <div class="tiledSection">     <h3 id="约束与限制">约束与限制<i class="anchor-icon anchor-icon-link" anchorid="约束与限制" tips="复制节点链接"></i></h3>          <p>使用设备管理能力，需要用户确认不同设备已连接同一局域网或者蓝牙开关已开启，否则该能力不可用。</p>     <p>设备信息属于用户敏感数据，所以即使用户已连接同一局域网或者蓝牙开关已开启，应用在获取设备位置前仍需向用户申请数据同步权限。在用户确认允许后，系统才会向应用提供设备管理能力。</p>    </div>    <div class="tiledSection">     <h2 id="申请分布式数据同步权限开发指导">申请分布式数据同步权限开发指导<i class="anchor-icon anchor-icon-link" anchorid="申请分布式数据同步权限开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景概述" class="firsth2">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述" tips="复制节点链接"></i></h3>          <p>应用在使用分布式设备管理系统能力前，需要检查是否已经获取用户授权访问分布式数据同步信息。如未获得授权，可以向用户申请需要的分布式数据同步权限。</p>     <p>ohos.permission.DISTRIBUTED_DATASYNC：分布式数据同步权限</p>     <p>使用设备管理能力，必须申请权限，并且获得用户授权。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <p>适用于Stage应用模型。</p>     <ol>      <li>       <p>在module.json5配置文件中配置分布式数据同步权限ohos.permission.DISTRIBUTED_DATASYNC。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li>{</li><li>  <span class="hljs-string">"module"</span> : {</li><li>    <span class="hljs-string">"requestPermissions"</span>:[</li><li>      {</li><li>        <span class="hljs-string">"name"</span> : <span class="hljs-string">"ohos.permission.DISTRIBUTED_DATASYNC"</span>,</li><li>        <span class="hljs-string">"reason"</span>: <span class="hljs-string">"$string:distributed_permission"</span>,</li><li>        <span class="hljs-string">"usedScene"</span>: {</li><li>          <span class="hljs-string">"abilities"</span>: [</li><li>            <span class="hljs-string">"MainAbility"</span></li><li>          ],</li><li>          <span class="hljs-string">"when"</span>: <span class="hljs-string">"inuse"</span></li><li>        }</li><li>      }</li><li>    ]</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>导入abilityAccessCtrl模块，用于获取权限申请的能力。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { abilityAccessCtrl } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>分布式数据同步权限的授权方式为user_grant，因此需要调用requestPermissionsFromUser接口，以动态弹窗的方式向用户申请授权。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">let</span> context = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getUIContext</span>().<span class="hljs-title function_">getHostContext</span>();</li><li><span class="hljs-keyword">let</span> atManager = abilityAccessCtrl.<span class="hljs-title function_">createAtManager</span>();</li><li><span class="hljs-keyword">try</span> {</li><li>  atManager.<span class="hljs-title function_">requestPermissionsFromUser</span>(context, [<span class="hljs-string">'ohos.permission.DISTRIBUTED_DATASYNC'</span>]).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'data: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">err: <span class="hljs-built_in">object</span></span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'err: '</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>  })</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'catch err-&gt;'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(err));</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="设备发现开发指导">设备发现开发指导<i class="anchor-icon anchor-icon-link" anchorid="设备发现开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景概述-1" class="firsth2">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述-1" tips="复制节点链接"></i></h3>          <p>开发者可以调用DeviceManager设备发现相关接口，获取周边可用的设备。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3>          <p>startDiscovering(discoverParam: {[key: string]: Object;} , filterOptions?: {[key: string]: Object;} ): void;</p>     <p>发现周边同局域网或者开启蓝牙的设备。详细信息参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#startdiscovering" target="_blank">startDiscovering</a>。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤-1">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-1" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>申请分布式数据同步权限。</p></li>      <li>       <p>导入distributedDeviceManager模块，所有与设备管理相关的功能API，都是通过该模块提供的。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>导入BusinessError模块，用于获取distributedDeviceManager模块相关接口抛出的错误码。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建设备管理实例，设备管理实例是分布式设备管理方法的调用入口，并注册发现设备的回调。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'ohos.samples.jsHelloWorld'</span>);</li><li>  dmInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'discoverSuccess'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'discoverSuccess on:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)));</li><li>  dmInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'discoverFailure'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'discoverFailure on:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)));</li><li>} <span class="hljs-keyword">catch</span>(err) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createDeviceManager errCode:'</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + e.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>发现周边设备。发现状态持续两分钟，超过两分钟，会停止发现，最大发现数量99个。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">DiscoverParam</span> {</li><li>  <span class="hljs-attr">discoverTargetType</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li><span class="hljs-keyword">interface</span> <span class="hljs-title class_">FilterOptions</span> {</li><li>  <span class="hljs-attr">availableStatus</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">discoverDistance</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">authenticationStatus</span>: <span class="hljs-built_in">number</span>;</li><li>  <span class="hljs-attr">authorizationType</span>: <span class="hljs-built_in">number</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">discoverParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = {</li><li>  <span class="hljs-string">'discoverTargetType'</span>: <span class="hljs-number">1</span></li><li>};</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">filterOptions</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">number</span>&gt; = {</li><li>  <span class="hljs-string">'availableStatus'</span>: <span class="hljs-number">0</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'ohos.samples.jsHelloWorld'</span>);</li><li>  dmInstance.<span class="hljs-title function_">startDiscovering</span>(discoverParam, filterOptions);</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'startDiscovering errCode:'</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + e.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="设备绑定开发指导">设备绑定开发指导<i class="anchor-icon anchor-icon-link" anchorid="设备绑定开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景概述-2" class="firsth2">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述-2" tips="复制节点链接"></i></h3>          <p>开发者发现周边不可信设备后，通过绑定接口建立可信关系。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-1">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-1" tips="复制节点链接"></i></h3>          <p>bindTarget(deviceId: string, bindParam: {[key: string]: Object;} , callback: AsyncCallback&lt;{deviceId: string;}&gt;): void;</p>     <p>设备绑定。详细信息参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#bindtarget" target="_blank">bindTarget</a>。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤-2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-2" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>申请分布式数据同步权限。</p></li>      <li>       <p>发现周边不可信设备。</p></li>      <li>       <p>选择不可信设备id，发起设备绑定。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">Data</span> {</li><li>  <span class="hljs-attr">deviceId</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">''</span>;</li><li>}</li><li><span class="hljs-keyword">let</span> deviceId = <span class="hljs-string">'XXXXXXXX'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">bindParam</span>: <span class="hljs-title class_">Record</span>&lt;<span class="hljs-built_in">string</span>, <span class="hljs-built_in">string</span> | <span class="hljs-built_in">number</span>&gt; = {</li><li>  <span class="hljs-string">'bindType'</span>: <span class="hljs-number">1</span>,</li><li>  <span class="hljs-string">'targetPkgName'</span>: <span class="hljs-string">'xxxx'</span>,</li><li>  <span class="hljs-string">'appName'</span>: <span class="hljs-string">'xxxx'</span>,</li><li>  <span class="hljs-string">'appOperation'</span>: <span class="hljs-string">'xxxx'</span>,</li><li>  <span class="hljs-string">'customDescription'</span>: <span class="hljs-string">'xxxx'</span></li><li>};</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'ohos.samples.jsHelloWorld'</span>);</li><li>  dmInstance.<span class="hljs-title function_">bindTarget</span>(deviceId, bindParam, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, data: Data</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'bindTarget errCode:'</span> + err.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + err.<span class="hljs-property">message</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'bindTarget result:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data));</li><li>  });</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'bindTarget errCode:'</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + e.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="设备信息查询开发指导">设备信息查询开发指导<i class="anchor-icon anchor-icon-link" anchorid="设备信息查询开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景概述-3" class="firsth2">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述-3" tips="复制节点链接"></i></h3>          <p>设备与周边设备建立可信关系后，通过设备信息查询接口可以获取所有上线并且可信的设备。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-2" tips="复制节点链接"></i></h3>          <p>getAvailableDeviceListSync(): Array&lt;DeviceBasicInfo&gt;;</p>     <p>设备信息查询。详细信息参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#getavailabledevicelistsync" target="_blank">getAvailableDeviceListSync</a>。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤-3">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-3" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>申请分布式数据同步权限。</p></li>      <li>       <p>发现周边不可信设备。</p></li>      <li>       <p>建立设备间的可信关系。</p></li>      <li>       <p>查询周围上线并且可信的设备。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li>
</li><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'ohos.samples.jsHelloWorld'</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">deviceInfoList</span>: <span class="hljs-title class_">Array</span>&lt;distributedDeviceManager.<span class="hljs-property">DeviceBasicInfo</span>&gt; = dmInstance.<span class="hljs-title function_">getAvailableDeviceListSync</span>();</li><li>} <span class="hljs-keyword">catch</span> (err) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'getAvailableDeviceListSync errCode:'</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + e.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="设备上下线监听开发指导">设备上下线监听开发指导<i class="anchor-icon anchor-icon-link" anchorid="设备上下线监听开发指导" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景概述-4" class="firsth2">场景概述<i class="anchor-icon anchor-icon-link" anchorid="场景概述-4" tips="复制节点链接"></i></h3>          <p>周边可信设备可用后会给业务报上线通知，当设备不可用时会给业务报下线通知。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-3">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-3" tips="复制节点链接"></i></h3>          <p>on(type: 'deviceStateChange', callback: Callback&lt;{ action: DeviceStateChange; device: DeviceBasicInfo; }&gt;): void;</p>     <p>设备上下线监听。详细信息参见：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-distributeddevicemanager#ondevicestatechange" target="_blank">on('deviceStateChange')</a>。</p>    </div>    <div class="tiledSection">     <h3 id="开发步骤-4">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-4" tips="复制节点链接"></i></h3>          <ol>      <li>       <p>申请分布式数据同步权限。</p></li>      <li>       <p>导入distributedDeviceManager模块，所有与设备管理相关的功能API，都是通过该模块提供的。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { distributedDeviceManager } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.DistributedServiceKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>导入BusinessError模块，用于获取distributedDeviceManager模块相关接口抛出的错误码。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>创建设备管理实例，设备管理实例是分布式设备管理方法的调用入口，并注册设备上下线回调。</p>       <div _ngcontent-fgm-c106="" class="highlight-div"><div _ngcontent-fgm-c106="" class="highlight-div-header"><div _ngcontent-fgm-c106="" class="highlight-div-header-left"><div _ngcontent-fgm-c106="" class="handle-button expand-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fgm-c106="" class="highlight-div-header-right"><div _ngcontent-fgm-c106="" class="handle-button ai-button"></div><div _ngcontent-fgm-c106="" class="handle-button line-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fgm-c106="" class="handle-button theme-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fgm-c106="" class="handle-button copy-button"><div _ngcontent-fgm-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fgm-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">try</span> {</li><li>  <span class="hljs-keyword">let</span> dmInstance = distributedDeviceManager.<span class="hljs-title function_">createDeviceManager</span>(<span class="hljs-string">'ohos.samples.jsHelloWorld'</span>);</li><li>  dmInstance.<span class="hljs-title function_">on</span>(<span class="hljs-string">'deviceStateChange'</span>, <span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'deviceStateChange on:'</span> + <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">stringify</span>(data)));</li><li>} <span class="hljs-keyword">catch</span>(err) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">e</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'createDeviceManager errCode:'</span> + e.<span class="hljs-property">code</span> + <span class="hljs-string">',errMessage:'</span> + e.<span class="hljs-property">message</span>);</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>   </div>   <div></div></div>