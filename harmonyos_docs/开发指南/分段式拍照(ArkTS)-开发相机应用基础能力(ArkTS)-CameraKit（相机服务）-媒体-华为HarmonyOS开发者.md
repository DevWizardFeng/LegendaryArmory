<h1 _ngcontent-yan-c119="" class="doc-title ng-star-inserted" title="分段式拍照(ArkTS)"> 分段式拍照(ArkTS) </h1>

<div _ngcontent-yan-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>分段式拍照是相机的重要功能之一，即应用下发拍照任务后，系统将分多阶段上报不同质量的图片。</p>    <ul>     <li>在第一阶段，系统快速上报轻量处理的图片，轻量处理的图片比全质量图低，出图速度快。应用通过回调会收到一个PhotoAsset对象，通过该对象可调用媒体库接口，读取图片或落盘图片。</li>     <li>在第二阶段，相机框架会根据应用的请求图片诉求或在相机进入后台时，进行图像增强处理得到全质量图，并将处理好的图片传回给媒体库，替换轻量处理的图片。</li>    </ul>    <p>通过分段式拍照，优化了系统的拍照响应时延，从而提升用户体验。</p>    <p>应用开发分段式拍照主要分为以下步骤：</p>    <ul>     <li>通过PhotoOutput，监听photoAssetAvailable回调，获取<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper" target="_blank">photoAccessHelper</a>的PhotoAsset对象。</li>     <li>通过PhotoAsset对象，调用媒体库相关接口，读取或落盘图片。</li>    </ul>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ul>       <li>分段式拍照能力由<strong>设备</strong>和<strong>模式</strong>决定，不同的设备支持的模式各异，对应分段式能力也有所差异，因此应用在切换设备或模式后分段式能力可能会发生变化。</li>       <li>应用无需主动使能分段式拍照能力，相机框架会在配流期间判断设备和模式是否支持分段式，如果支持会使能该功能。</li>      </ul>     </div></div></div>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <p>详细的API说明请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera" target="_blank">Camera API参考</a>。</p>     <ol>      <li>       <p>导入依赖，需要导入相机框架、媒体库、图片相关领域依赖。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { camera } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CameraKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.BasicServicesKit'</span>;</li><li><span class="hljs-keyword">import</span> { photoAccessHelper } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.MediaLibraryKit'</span>;</li></ol></pre></div></div></li>      <li>       <p>确定拍照输出流。</p>       <p>通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#cameraoutputcapability" target="_blank">CameraOutputCapability</a>中的photoProfiles属性，可获取当前设备支持的拍照输出流，通过<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-cameramanager#createphotooutput11" target="_blank">createPhotoOutput</a>方法创建拍照输出流。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoOutput</span>(<span class="hljs-params">cameraManager: camera.CameraManager,</span></li><li><span class="hljs-params">  cameraOutputCapability: camera.CameraOutputCapability</span>): camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoProfilesArray</span>: <span class="hljs-title class_">Array</span>&lt;camera.<span class="hljs-property">Profile</span>&gt; = cameraOutputCapability.<span class="hljs-property">photoProfiles</span>;</li><li>  <span class="hljs-keyword">if</span> (photoProfilesArray===<span class="hljs-literal">null</span> || photoProfilesArray===<span class="hljs-literal">undefined</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"createOutput photoProfilesArray is null!"</span>);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>  }</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">photoOutput</span>: camera.<span class="hljs-property">PhotoOutput</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>   <span class="hljs-keyword">if</span> (photoProfilesArray.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>       photoOutput = cameraManager.<span class="hljs-title function_">createPhotoOutput</span>(photoProfilesArray[<span class="hljs-number">0</span>]);</li><li>   } <span class="hljs-keyword">else</span> {</li><li>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"the length of photoProfilesArray&lt;=0!"</span>);</li><li>       <span class="hljs-keyword">return</span> <span class="hljs-literal">undefined</span>;</li><li>   }</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-keyword">let</span> err = error <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to createPhotoOutput. error: <span class="hljs-subst">${err}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> photoOutput;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>设置拍照photoAssetAvailable的回调。</p>       <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">         <p>如果已经注册了photoAssetAvailable回调，并且在Session开始之后又注册了photoAvailable回调，photoAssetAvailable和photoAvailable同时注册，会导致流被重启，仅photoAssetAvailable生效。</p>         <p>不建议开发者同时注册<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#onphotoavailable11" target="_blank">photoAvailable</a>和<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-photooutput#onphotoassetavailable12" target="_blank">photoAssetAvailable</a>。</p>        </div></div></div>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotoAccessHelper</span>(<span class="hljs-params">context: Context</span>): photoAccessHelper.<span class="hljs-property">PhotoAccessHelper</span> {</li><li>  <span class="hljs-keyword">let</span> phAccessHelper = photoAccessHelper.<span class="hljs-title function_">getPhotoAccessHelper</span>(context);</li><li>  <span class="hljs-keyword">return</span> phAccessHelper;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputPhotoAssetAvailable</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput, context: Context</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'photoAssetAvailable'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, photoAsset: photoAccessHelper.PhotoAsset</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`photoAssetAvailable error: <span class="hljs-subst">${err}</span>.`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'photoOutPutCallBack photoAssetAvailable'</span>);</li><li>    <span class="hljs-comment">// 开发者可通过photoAsset调用媒体库相关接口，自定义处理图片。</span></li><li>    <span class="hljs-comment">// 处理方式一：调用媒体库落盘接口保存一阶段图，二阶段图就绪后媒体库会主动帮应用替换落盘图片。</span></li><li>    <span class="hljs-title function_">mediaLibSavePhoto</span>(photoAsset, <span class="hljs-title function_">getPhotoAccessHelper</span>(context));</li><li>    <span class="hljs-comment">// 处理方式二：调用媒体库接口请求图片并注册一阶段图或二阶段图buffer回调，自定义使用。</span></li><li>    <span class="hljs-title function_">mediaLibRequestBuffer</span>(photoAsset, context);</li><li>  });</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mediaLibSavePhoto</span>(<span class="hljs-params">photoAsset: photoAccessHelper.PhotoAsset,</span></li><li><span class="hljs-params">  phAccessHelper: photoAccessHelper.PhotoAccessHelper</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">void</span>&gt; {</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">assetChangeRequest</span>: photoAccessHelper.<span class="hljs-property">MediaAssetChangeRequest</span> = <span class="hljs-keyword">new</span> photoAccessHelper.<span class="hljs-title class_">MediaAssetChangeRequest</span>(photoAsset);</li><li>    assetChangeRequest.<span class="hljs-title function_">saveCameraPhoto</span>();</li><li>    <span class="hljs-keyword">await</span> phAccessHelper.<span class="hljs-title function_">applyChanges</span>(assetChangeRequest);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'apply saveCameraPhoto successfully'</span>);</li><li>  } <span class="hljs-keyword">catch</span> (err) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`apply saveCameraPhoto failed with error: <span class="hljs-subst">${err.code}</span>, <span class="hljs-subst">${err.message}</span>`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">MediaDataHandler</span> <span class="hljs-keyword">implements</span> photoAccessHelper.<span class="hljs-property">MediaAssetDataHandler</span>&lt;<span class="hljs-title class_">ArrayBuffer</span>&gt; {</li><li>  <span class="hljs-title function_">onDataPrepared</span>(<span class="hljs-params">data: <span class="hljs-built_in">ArrayBuffer</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (data === <span class="hljs-literal">undefined</span>) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">'Error occurred when preparing data'</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 应用获取到图片buffer后可自定义处理。</span></li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'on image data prepared'</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">mediaLibRequestBuffer</span>(<span class="hljs-params">photoAsset: photoAccessHelper.PhotoAsset, context: Context</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">requestOptions</span>: photoAccessHelper.<span class="hljs-property">RequestOptions</span> = {</li><li>    <span class="hljs-comment">// 按照业务需求配置回图模式。</span></li><li>    <span class="hljs-comment">// FAST_MODE：仅接收一阶段低质量图回调。</span></li><li>    <span class="hljs-comment">// HIGH_QUALITY_MODE：仅接收二阶段全质量图回调。</span></li><li>    <span class="hljs-comment">// BALANCE_MODE：接收一阶段及二阶段图片回调。</span></li><li>    <span class="hljs-attr">deliveryMode</span>: photoAccessHelper.<span class="hljs-property">DeliveryMode</span>.<span class="hljs-property">FAST_MODE</span>,</li><li>  }</li><li>  <span class="hljs-keyword">const</span> handler = <span class="hljs-keyword">new</span> <span class="hljs-title class_">MediaDataHandler</span>();</li><li>  <span class="hljs-keyword">await</span> photoAccessHelper.<span class="hljs-property">MediaAssetManager</span>.<span class="hljs-title function_">requestImageData</span>(context, photoAsset, requestOptions, handler);</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'requestImageData successfully'</span>);</li><li>}</li></ol></pre></div></div>       <p>落盘图片参考媒体库接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/kts-apis-photoaccesshelper-mediaassetchangerequest#savecameraphoto12" target="_blank">saveCameraPhoto</a></p>       <p>请求图片参考媒体库接口：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-mediaassetmanager#requestimagedata11" target="_blank">requestImageData</a> 和 <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-photoaccesshelper-mediaassetdatahandler#ondataprepared11" target="_blank">onDataPrepared</a></p></li>      <li>       <p>拍照时的会话配置及触发拍照的方式，与普通拍照相同，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/camera-shooting">拍照</a>的步骤4-5。</p></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="状态监听">状态监听<i class="anchor-icon anchor-icon-link" anchorid="状态监听" tips="复制节点链接"></i></h2>          <p>在相机应用开发过程中，可以随时监听拍照输出流状态，包括拍照流开始、拍照帧的开始与结束、拍照输出流的错误。</p>     <ul>      <li>       <p>通过注册固定的captureStartWithInfo回调函数获取监听拍照开始结果，photoOutput创建成功时即可监听，相机设备已经准备开始这次拍照时触发，该事件返回此次拍照的captureId。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureStart</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureStartWithInfo'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, captureStartInfo: camera.CaptureStartInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture started, captureId : <span class="hljs-subst">${captureStartInfo.captureId}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的captureEnd回调函数获取监听拍照结束结果，photoOutput创建成功时即可监听，该事件返回结果为拍照完全结束后的相关信息<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-i#captureendinfo" target="_blank">CaptureEndInfo</a>。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureEnd</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureEnd'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError, captureEndInfo: camera.CaptureEndInfo</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture end, captureId : <span class="hljs-subst">${captureEndInfo.captureId}</span>`</span>);</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`frameCount : <span class="hljs-subst">${captureEndInfo.frameCount}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的captureReady回调函数获取监听可拍下一张结果，photoOutput创建成功时即可监听，当下一张可拍时触发，该事件返回结果为下一张可拍的相关信息。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputCaptureReady</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'captureReady'</span>, <span class="hljs-function">(<span class="hljs-params">err: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-keyword">if</span> (err !== <span class="hljs-literal">undefined</span> &amp;&amp; err.<span class="hljs-property">code</span> !== <span class="hljs-number">0</span>) {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`photo capture ready`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>      <li>       <p>通过注册固定的error回调函数获取监听拍照输出流的错误结果。callback返回拍照输出接口使用错误时的对应错误码，错误码类型参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-camera-e#cameraerrorcode" target="_blank">Camera错误码</a>。</p>       <div _ngcontent-yan-c106="" class="highlight-div"><div _ngcontent-yan-c106="" class="highlight-div-header"><div _ngcontent-yan-c106="" class="highlight-div-header-left"><div _ngcontent-yan-c106="" class="handle-button expand-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-yan-c106="" class="highlight-div-header-right"><div _ngcontent-yan-c106="" class="handle-button ai-button"></div><div _ngcontent-yan-c106="" class="handle-button line-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-yan-c106="" class="handle-button theme-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-yan-c106="" class="handle-button copy-button"><div _ngcontent-yan-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-yan-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">onPhotoOutputError</span>(<span class="hljs-params">photoOutput: camera.PhotoOutput</span>): <span class="hljs-built_in">void</span> {</li><li>  photoOutput.<span class="hljs-title function_">on</span>(<span class="hljs-string">'error'</span>, <span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Photo output error code: <span class="hljs-subst">${error.code}</span>`</span>);</li><li>  });</li><li>}</li></ol></pre></div></div></li>     </ul>    </div>   </div>   <div></div></div>