<h1 _ngcontent-lvp-c119="" class="doc-title ng-star-inserted" title="切换输入法应用"> 切换输入法应用 </h1>

<div _ngcontent-lvp-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>输入法框架服务提供了切换输入法应用的API，支持切换输入法、切换输入法和子类型、切换当前输入法的子类型。</p>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <ol>       <li>        <p>以下接口的使用仅允许在当前输入法应用中调用。</p></li>       <li>        <p>本示例假设已经在输入法应用中执行，如何实现一个输入法应用，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/inputmethod-application-guide">实现一个输入法应用</a>开发指导。</p></li>      </ol>     </div></div></div>    <div class="tiledSection">     <h2 id="切换当前输入法子类型">切换当前输入法子类型<i class="anchor-icon anchor-icon-link" anchorid="切换当前输入法子类型" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>在已完成一个输入法应用的基础上，当输入法应用是当前输入法时，在输入法应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodswitchcurrentinputmethodsubtype9" target="_blank">switchCurrentInputMethodSubtype</a>接口，传入当前输入法的子类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod-subtype#inputmethodsubtype" target="_blank">InputMethodSubtype</a>作为参数即可切换当前输入法子类型。</p>       <div _ngcontent-lvp-c106="" class="highlight-div"><div _ngcontent-lvp-c106="" class="highlight-div-header"><div _ngcontent-lvp-c106="" class="highlight-div-header-left"><div _ngcontent-lvp-c106="" class="handle-button expand-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lvp-c106="" class="highlight-div-header-right"><div _ngcontent-lvp-c106="" class="handle-button ai-button"></div><div _ngcontent-lvp-c106="" class="handle-button line-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lvp-c106="" class="handle-button theme-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lvp-c106="" class="handle-button copy-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lvp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InputMethodSubtype</span>, inputMethod } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyboardController</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">switchCurrentInputMethodSubtype</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">subTypes</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-title class_">InputMethodSubtype</span>&gt; =</li><li>        <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">getSetting</span>().<span class="hljs-title function_">listCurrentInputMethodSubtype</span>(); <span class="hljs-comment">// 获取当前输入法的所有子类型</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">currentSubType</span>: <span class="hljs-title class_">InputMethodSubtype</span> = inputMethod.<span class="hljs-title function_">getCurrentInputMethodSubtype</span>(); <span class="hljs-comment">// 获取当前输入法当前的子类型</span></li><li>      <span class="hljs-keyword">if</span> (subTypes.<span class="hljs-property">length</span> === <span class="hljs-number">0</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>      }</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; subTypes.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-keyword">if</span> (subTypes[i].<span class="hljs-property">id</span> != currentSubType.<span class="hljs-property">id</span>) { <span class="hljs-comment">// 判断不是当前的子类型时切换，实际开发中可以根据需要填固定子类型</span></li><li>          <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">switchCurrentInputMethodSubtype</span>(subTypes[i]);</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to switchCurrentInputMethodSubtype, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>输入法应用中注册子类型变化事件，根据不同子类型加载不同的输入界面。</p>       <div _ngcontent-lvp-c106="" class="highlight-div"><div _ngcontent-lvp-c106="" class="highlight-div-header"><div _ngcontent-lvp-c106="" class="highlight-div-header-left"><div _ngcontent-lvp-c106="" class="handle-button expand-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lvp-c106="" class="highlight-div-header-right"><div _ngcontent-lvp-c106="" class="handle-button ai-button"></div><div _ngcontent-lvp-c106="" class="handle-button line-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lvp-c106="" class="handle-button theme-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lvp-c106="" class="handle-button copy-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lvp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">InputMethodSubtype</span>, inputMethodEngine, inputMethod } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyboardController</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">switchCurrentInputMethodSubtype</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">panel</span>: inputMethodEngine.<span class="hljs-property">Panel</span>; <span class="hljs-comment">// 此处panel需要在createPanel接口创建panel实例后使用</span></li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">inputMethodAbility</span>: inputMethodEngine.<span class="hljs-property">InputMethodAbility</span> = inputMethodEngine.<span class="hljs-title function_">getInputMethodAbility</span>();</li><li>    <span class="hljs-comment">// 设置监听子类型事件，改变输入法应用界面</span></li><li>    inputMethodAbility.<span class="hljs-title function_">on</span>(<span class="hljs-string">'setSubtype'</span>, <span class="hljs-function">(<span class="hljs-params">inputMethodSubtype: InputMethodSubtype</span>) =&gt;</span> {</li><li>      <span class="hljs-keyword">if</span>(inputMethodSubtype.<span class="hljs-property">id</span> == <span class="hljs-string">'InputMethodExtAbility'</span>) {</li><li>        panel.<span class="hljs-title function_">setUiContent</span>(<span class="hljs-string">'pages/Index'</span>); <span class="hljs-comment">// 假设在输入法应用中此时Panel已经在onCreate流程中创建</span></li><li>      }</li><li>      <span class="hljs-keyword">if</span>(inputMethodSubtype.<span class="hljs-property">id</span> == <span class="hljs-string">'InputMethodExtAbility1'</span>) {</li><li>        panel.<span class="hljs-title function_">setUiContent</span>(<span class="hljs-string">'pages/Index1'</span>); <span class="hljs-comment">// 假设在输入法应用中此时Panel已经在onCreate流程中创建</span></li><li>      }</li><li>    });</li><li>  }</li><li>}</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="切换输入法应用-1">切换输入法应用<i class="anchor-icon anchor-icon-link" anchorid="切换输入法应用-1" tips="复制节点链接"></i></h2>          <p>在已完成一个输入法应用的基础上，当输入法应用是当前输入法时，在输入法应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodswitchinputmethod9" target="_blank">switchInputMethod</a>接口，传入目标输入法的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodproperty8" target="_blank">InputMethodProperty</a>信息，即可切换输入法到目标输入法。</p>     <div _ngcontent-lvp-c106="" class="highlight-div"><div _ngcontent-lvp-c106="" class="highlight-div-header"><div _ngcontent-lvp-c106="" class="highlight-div-header-left"><div _ngcontent-lvp-c106="" class="handle-button expand-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lvp-c106="" class="highlight-div-header-right"><div _ngcontent-lvp-c106="" class="handle-button ai-button"></div><div _ngcontent-lvp-c106="" class="handle-button line-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lvp-c106="" class="handle-button theme-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lvp-c106="" class="handle-button copy-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lvp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inputMethod } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyboardController</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">switchInputMethod</span>(<span class="hljs-params"></span>){</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">inputMethods</span>: <span class="hljs-title class_">Array</span>&lt;inputMethod.<span class="hljs-property">InputMethodProperty</span>&gt; =</li><li>        <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">getSetting</span>().<span class="hljs-title function_">getInputMethods</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取已使能的输入法列表</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">currentInputMethod</span>: inputMethod.<span class="hljs-property">InputMethodProperty</span> = inputMethod.<span class="hljs-title function_">getCurrentInputMethod</span>(); <span class="hljs-comment">// 获取当前输入法</span></li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; inputMethods.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-keyword">if</span> (inputMethods[i].<span class="hljs-property">name</span> != currentInputMethod.<span class="hljs-property">name</span>) { <span class="hljs-comment">// 判断不是当前输入法时，切换到该输入法，实际开发中可以切换到固定输入法</span></li><li>          <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">switchInputMethod</span>(inputMethods[i]);</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to switchInputMethod, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="切换输入法应用和子类型">切换输入法应用和子类型<i class="anchor-icon anchor-icon-link" anchorid="切换输入法应用和子类型" tips="复制节点链接"></i></h2>          <p>在已完成一个输入法应用的基础上，当输入法应用是当前输入法时，在输入法应用中使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodswitchcurrentinputmethodandsubtype9" target="_blank">switchCurrentInputMethodAndSubtype</a>接口，传入目标输入法的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod#inputmethodproperty8" target="_blank">InputMethodProperty</a>，目标输入法的子类型<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-inputmethod-subtype#inputmethodsubtype" target="_blank">InputMethodSubtype</a>信息，即可切换输入法到目标输入法的指定子类型。</p>     <div _ngcontent-lvp-c106="" class="highlight-div"><div _ngcontent-lvp-c106="" class="highlight-div-header"><div _ngcontent-lvp-c106="" class="highlight-div-header-left"><div _ngcontent-lvp-c106="" class="handle-button expand-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-lvp-c106="" class="highlight-div-header-right"><div _ngcontent-lvp-c106="" class="handle-button ai-button"></div><div _ngcontent-lvp-c106="" class="handle-button line-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-lvp-c106="" class="handle-button theme-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-lvp-c106="" class="handle-button copy-button"><div _ngcontent-lvp-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-lvp-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { inputMethod } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IMEKit'</span>;</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">KeyboardController</span> {</li><li>  <span class="hljs-keyword">async</span> <span class="hljs-title function_">switchInputMethodAndSubtype</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">inputMethods</span>: <span class="hljs-title class_">Array</span>&lt;inputMethod.<span class="hljs-property">InputMethodProperty</span>&gt; =</li><li>        <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">getSetting</span>().<span class="hljs-title function_">getInputMethods</span>(<span class="hljs-literal">true</span>); <span class="hljs-comment">// 获取已使能的输入法列表</span></li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">currentInputMethod</span>: inputMethod.<span class="hljs-property">InputMethodProperty</span> = inputMethod.<span class="hljs-title function_">getCurrentInputMethod</span>(); <span class="hljs-comment">// 获取当前输入法</span></li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; inputMethods.<span class="hljs-property">length</span>; i++) {</li><li>        <span class="hljs-keyword">if</span> (inputMethods[i].<span class="hljs-property">name</span> != currentInputMethod.<span class="hljs-property">name</span>) { <span class="hljs-comment">// 判断不是当前输入法时，切换到该输入法，实际开发中可以切换到固定输入法</span></li><li>          <span class="hljs-keyword">let</span> subTypes = <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">getSetting</span>().<span class="hljs-title function_">listInputMethodSubtype</span>(inputMethods[i]); <span class="hljs-comment">// 获取目标输入法的子类型</span></li><li>          <span class="hljs-keyword">if</span> (subTypes.<span class="hljs-property">length</span> &gt; <span class="hljs-number">0</span>) {</li><li>            <span class="hljs-keyword">await</span> inputMethod.<span class="hljs-title function_">switchCurrentInputMethodAndSubtype</span>(inputMethods[i], subTypes[<span class="hljs-number">0</span>]); <span class="hljs-comment">// 本示例默认切换到获取的第一个子类型</span></li><li>          }</li><li>          <span class="hljs-keyword">return</span>;</li><li>        }</li><li>      }</li><li>    } <span class="hljs-keyword">catch</span> (err) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-attr">error</span>: <span class="hljs-title class_">BusinessError</span> = err <span class="hljs-keyword">as</span> <span class="hljs-title class_">BusinessError</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`Failed to switchCurrentInputMethodAndSubtype, code: <span class="hljs-subst">${err.code}</span>, message: <span class="hljs-subst">${err.message}</span>`</span>);</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>