<h1 _ngcontent-rgj-c119="" class="doc-title ng-star-inserted" title="创建DataAbility"> 创建DataAbility </h1>

<div _ngcontent-rgj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><p>实现DataAbility中Insert、Query、Update、Delete接口的业务内容。保证能够满足数据库存储业务的基本需求。BatchInsert与ExecuteBatch接口已经在系统中实现遍历逻辑，依赖Insert、Query、Update、Delete接口逻辑，来实现数据的批量处理。</p> <p>创建DataAbility的代码示例如下：</p> <div _ngcontent-rgj-c106="" class="highlight-div"><div _ngcontent-rgj-c106="" class="highlight-div-header"><div _ngcontent-rgj-c106="" class="highlight-div-header-left"><div _ngcontent-rgj-c106="" class="handle-button expand-button"><div _ngcontent-rgj-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-rgj-c106="" class="highlight-div-header-right"><div _ngcontent-rgj-c106="" class="handle-button ai-button"></div><div _ngcontent-rgj-c106="" class="handle-button line-button"><div _ngcontent-rgj-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-rgj-c106="" class="handle-button theme-button"><div _ngcontent-rgj-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-rgj-c106="" class="handle-button copy-button"><div _ngcontent-rgj-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-rgj-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> featureAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.ability.featureAbility'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> common <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.common'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> <span class="hljs-title class_">Want</span> <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.app.ability.Want'</span>;</li><li><span class="hljs-keyword">import</span> <span class="hljs-keyword">type</span> { <span class="hljs-title class_">AsyncCallback</span>, <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.base'</span>;</li><li><span class="hljs-keyword">import</span> dataAbility <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.dataAbility'</span>;</li><li><span class="hljs-keyword">import</span> rdb <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.data.rdb'</span>;</li><li><span class="hljs-keyword">import</span> hilog <span class="hljs-keyword">from</span> <span class="hljs-string">'@ohos.hilog'</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">TABLE_NAME</span> = <span class="hljs-string">'book'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">STORE_CONFIG</span>: rdb.<span class="hljs-property">StoreConfig</span> = { <span class="hljs-attr">name</span>: <span class="hljs-string">'book.db'</span> };</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">SQL_CREATE_TABLE</span> = <span class="hljs-string">'CREATE TABLE IF NOT EXISTS book(id INTEGER PRIMARY KEY AUTOINCREMENT, name TEXT NOT NULL, introduction TEXT NOT NULL)'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">rdbStore</span>: rdb.<span class="hljs-property">RdbStore</span> | <span class="hljs-literal">undefined</span> = <span class="hljs-literal">undefined</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[Sample_FAModelAbilityDevelop]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">DataAbility</span> {</li><li>  <span class="hljs-title function_">onInitialized</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility onInitialized, abilityInfo:'</span> + want.<span class="hljs-property">bundleName</span>);</li><li>    <span class="hljs-keyword">let</span> <span class="hljs-attr">context</span>: common.<span class="hljs-property">BaseContext</span> = { <span class="hljs-attr">stageMode</span>: featureAbility.<span class="hljs-title function_">getContext</span>().<span class="hljs-property">stageMode</span> };</li><li>    rdb.<span class="hljs-title function_">getRdbStore</span>(context, <span class="hljs-variable constant_">STORE_CONFIG</span>, <span class="hljs-number">1</span>, <span class="hljs-function">(<span class="hljs-params">err, store</span>) =&gt;</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility getRdbStore callback'</span>);</li><li>      store.<span class="hljs-title function_">executeSql</span>(<span class="hljs-variable constant_">SQL_CREATE_TABLE</span>, []);</li><li>      rdbStore = store;</li><li>    });</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">insert</span>(<span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">valueBucket</span>: rdb.<span class="hljs-property">ValuesBucket</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility insert start'</span>);</li><li>    <span class="hljs-keyword">if</span> (rdbStore) {</li><li>      rdbStore.<span class="hljs-title function_">insert</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, valueBucket, callback);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">batchInsert</span>(<span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">valueBuckets</span>: <span class="hljs-title class_">Array</span>&lt;rdb.<span class="hljs-property">ValuesBucket</span>&gt;, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility batch insert start'</span>);</li><li>    <span class="hljs-keyword">if</span> (rdbStore) {</li><li>      <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; valueBuckets.<span class="hljs-property">length</span>; i++) {</li><li>        hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility batch insert i='</span> + i);</li><li>        <span class="hljs-keyword">if</span> (i &lt; valueBuckets.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>) {</li><li>          rdbStore.<span class="hljs-title function_">insert</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, valueBuckets[i], <span class="hljs-function">(<span class="hljs-params">err: BusinessError, num: <span class="hljs-built_in">number</span></span>) =&gt;</span> {</li><li>            hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility batch insert ret='</span> + num);</li><li>          });</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          rdbStore.<span class="hljs-title function_">insert</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, valueBuckets[i], callback);</li><li>        }</li><li>      }</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">query</span>(<span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">columns</span>: <span class="hljs-title class_">Array</span>&lt;<span class="hljs-built_in">string</span>&gt;, <span class="hljs-attr">predicates</span>: dataAbility.<span class="hljs-property">DataAbilityPredicates</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;rdb.<span class="hljs-property">ResultSet</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility query start'</span>);</li><li>    <span class="hljs-keyword">let</span> rdbPredicates = dataAbility.<span class="hljs-title function_">createRdbPredicates</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, predicates);</li><li>    <span class="hljs-keyword">if</span> (rdbStore) {</li><li>      rdbStore.<span class="hljs-title function_">query</span>(rdbPredicates, columns, callback);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">update</span>(<span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">valueBucket</span>: rdb.<span class="hljs-property">ValuesBucket</span>, <span class="hljs-attr">predicates</span>: dataAbility.<span class="hljs-property">DataAbilityPredicates</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility update start'</span>);</li><li>    <span class="hljs-keyword">let</span> rdbPredicates = dataAbility.<span class="hljs-title function_">createRdbPredicates</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, predicates);</li><li>    <span class="hljs-keyword">if</span> (rdbStore) {</li><li>      rdbStore.<span class="hljs-title function_">update</span>(valueBucket, rdbPredicates, callback);</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">delete</span>(<span class="hljs-attr">uri</span>: <span class="hljs-built_in">string</span>, <span class="hljs-attr">predicates</span>: dataAbility.<span class="hljs-property">DataAbilityPredicates</span>, <span class="hljs-attr">callback</span>: <span class="hljs-title class_">AsyncCallback</span>&lt;<span class="hljs-built_in">number</span>&gt;): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'DataAbility delete start'</span>);</li><li>    <span class="hljs-keyword">let</span> rdbPredicates = dataAbility.<span class="hljs-title function_">createRdbPredicates</span>(<span class="hljs-variable constant_">TABLE_NAME</span>, predicates);</li><li>    <span class="hljs-keyword">if</span> (rdbStore) {</li><li>      rdbStore.<span class="hljs-title function_">delete</span>(rdbPredicates, callback);</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataAbility</span>();</li></ol></pre></div></div> </div> <div></div></div>