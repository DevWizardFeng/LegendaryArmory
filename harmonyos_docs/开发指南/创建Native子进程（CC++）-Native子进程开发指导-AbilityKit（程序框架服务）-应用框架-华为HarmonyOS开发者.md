<h1 _ngcontent-aed-c119="" class="doc-title ng-star-inserted" title="创建Native子进程（C/C++）"> 创建Native子进程（C/C++） </h1>

<div _ngcontent-aed-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>本模块提供了两种创建<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ability-terminology#native子进程">Native子进程</a>的方式，开发者可根据需要进行选择。</p>    <ul>     <li><a href="/consumer/cn/doc/harmonyos-guides/capi_nativechildprocess_development_guideline#创建支持ipc通信的native子进程">创建支持IPC通信的Native子进程</a>：创建子进程，并在父子进程间建立IPC通道，适用于父子进程需要IPC通信的场景。对<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ipc-capi-development-guideline">IPCKit</a>存在依赖。</li>     <li><a href="/consumer/cn/doc/harmonyos-guides/capi_nativechildprocess_development_guideline#创建支持参数传递的native子进程">创建支持参数传递的Native子进程</a>：创建子进程，并传递字符串和fd句柄参数到子进程。适用于需要传递参数到子进程的场景。</li>    </ul>    <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">      <p>创建的子进程会随着父进程的退出而退出，无法脱离父进程独立运行。</p>     </div></div></div>    <div class="tiledSection">     <h2 id="创建支持ipc通信的native子进程">创建支持IPC通信的Native子进程<i class="anchor-icon anchor-icon-link" anchorid="创建支持ipc通信的native子进程" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景介绍" class="firsth2">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍" tips="复制节点链接"></i></h3>          <p>本章节介绍如何在主进程中创建Native子进程，并在父子进程间建立IPC通道，方便开发者在Native层进行多进程编程。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.6.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%">int <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_createnativechildprocess" target="_blank">OH_Ability_CreateNativeChildProcess</a> (const char *libName, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_onnativechildprocessstarted" target="_blank">OH_Ability_OnNativeChildProcessStarted</a> onProcessStarted)</td>         <td class="cellrowborder" valign="top" width="50%">创建子进程并加载参数中指定的动态链接库文件，进程启动结果通过参数中的回调函数onProcessStarted异步通知。回调函数运行在独立线程，如果需要访问共享资源在实现时需要注意线程同步，由于系统对于单个进程拥有的回调线程数量有限制，因此不建议在回调函数中执行高耗时操作。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 14开始，支持2in1和Tablet设备。API version 13及之前版本，仅支持2in1设备。</p>       <p>从API version 15开始，单个进程最多支持启动50个Native子进程。API version 14及之前版本，单个进程只能启动1个Native子进程。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h3>          <p>基于已创建完成的Native应用开发工程，在此基础上介绍如何使用AbilityKit提供的C API接口，创建Native子进程，并同时在父子进程间建立IPC通道。</p>     <p><strong>动态库文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libipc_capi.so</li><li>libchild_process.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_kit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>子进程-实现必要的导出方法。</p>       <p>在子进程中，实现必要的两个函数<strong>NativeChildProcess_OnConnect</strong>及<strong>NativeChildProcess_MainProc</strong>并导出（假设代码所在的文件名为ChildProcessSample.cpp）。其中NativeChildProcess_OnConnect方法返回的OHIPCRemoteStub对象负责与主进程进行IPC通信，具体实现方法请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ipc-capi-development-guideline">IPC通信开发指导（C/C++)</a>，本文不再赘述。</p>       <p>子进程启动后会先调用NativeChildProcess_OnConnect获取IPC Stub对象，之后再调用NativeChildProcess_MainProc移交主线程控制权，该函数返回后子进程随即退出。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_kit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_cremote_object.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_cparcel.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_error_code.h&gt;</span></span></li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">IpcCapiStubTest</span> {</li><li><span class="hljs-keyword">public</span>:</li><li>    <span class="hljs-function"><span class="hljs-keyword">explicit</span> <span class="hljs-title">IpcCapiStubTest</span><span class="hljs-params">()</span></span>;</li><li>    ~<span class="hljs-built_in">IpcCapiStubTest</span>();</li><li>    <span class="hljs-function">OHIPCRemoteStub* <span class="hljs-title">GetRemoteStub</span><span class="hljs-params">()</span></span>;</li><li>    <span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">int</span> <span class="hljs-title">OnRemoteRequest</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> OHIPCParcel *data,  OHIPCParcel *reply, <span class="hljs-type">void</span>  *userData)</span></span>;</li><li><span class="hljs-keyword">private</span>:</li><li>    OHIPCRemoteStub *stub_{<span class="hljs-literal">nullptr</span>};</li><li>};</li><li>
</li><li>IpcCapiStubTest::<span class="hljs-built_in">IpcCapiStubTest</span>() {</li><li>    <span class="hljs-comment">// 创建stub对象</span></li><li>    stub_ = <span class="hljs-built_in">OH_IPCRemoteStub_Create</span>(<span class="hljs-string">"testIpc"</span>,  &amp;IpcCapiStubTest::OnRemoteRequest,</li><li>        <span class="hljs-literal">nullptr</span>, <span class="hljs-keyword">this</span>);</li><li>}</li><li>
</li><li>IpcCapiStubTest::~<span class="hljs-built_in">IpcCapiStubTest</span>() {</li><li>    <span class="hljs-keyword">if</span> (stub_ != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-built_in">OH_IPCRemoteStub_Destroy</span>(stub_);</li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-function">OHIPCRemoteStub* <span class="hljs-title">IpcCapiStubTest::GetRemoteStub</span><span class="hljs-params">()</span> </span>{</li><li>    <span class="hljs-keyword">return</span> stub_;</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">int</span> <span class="hljs-title">IpcCapiStubTest::OnRemoteRequest</span><span class="hljs-params">(<span class="hljs-type">uint32_t</span> code, <span class="hljs-type">const</span> OHIPCParcel *data,  OHIPCParcel *reply, <span class="hljs-type">void</span>  *userData)</span> </span>{</li><li>    <span class="hljs-keyword">return</span> OH_IPC_SUCCESS;</li><li>}</li><li>
</li><li>
</li><li>IpcCapiStubTest ipcStubObj;</li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {</li><li>
</li><li><span class="hljs-function">OHIPCRemoteStub* <span class="hljs-title">NativeChildProcess_OnConnect</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// ipcRemoteStub指向子进程实现的ipc stub对象，用于接收来自主进程的IPC消息并响应</span></li><li>    <span class="hljs-comment">// 子进程根据业务逻辑控制其生命周期</span></li><li>    <span class="hljs-keyword">return</span> ipcStubObj.<span class="hljs-built_in">GetRemoteStub</span>();</li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">NativeChildProcess_MainProc</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 相当于子进程的Main函数，实现子进程的业务逻辑</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-comment">// 函数返回后子进程随即退出</span></li><li>}</li><li>
</li><li>} <span class="hljs-comment">// extern "C"</span></li></ol></pre></div></div></li>      <li>       <p>子进程-编译为动态链接库。</p>       <p>修改CMakeList.txt文件，编译为动态链接库（假设需要编译出的库文件名称为libchildprocesssample.so），并添加IPC动态库依赖。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>add_library(childprocesssample SHARED</li><li>    # 实现必要导出方法的源文件</li><li>    ChildProcessSample.cpp</li><li>    </li><li>    # 其它代码源文件</li><li>    # ...</li><li>)</li><li>
</li><li>target_link_libraries(childprocesssample PUBLIC</li><li>    # 添加依赖的IPC动态库</li><li>    libipc_capi.so</li><li>   </li><li>    # 其它所依赖的动态库</li><li>    # ...</li><li>)</li></ol></pre></div></div></li>      <li>       <p>主进程-实现子进程启动结果回调函数。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_kit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnNativeChildProcessStarted</span><span class="hljs-params">(<span class="hljs-type">int</span> errCode, OHIPCRemoteProxy *remoteProxy)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">if</span> (errCode != NCP_NO_ERROR) {</li><li>        <span class="hljs-comment">// 子进程未能正常启动时的异常处理</span></li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 保存remoteProxy对象，后续基于IPC Kit提供的API同子进程间进行IPC通信</span></li><li>    <span class="hljs-comment">// 耗时操作建议转移到独立线程去处理，避免长时间阻塞回调线程</span></li><li>    <span class="hljs-comment">// IPC对象使用完毕后，需要调用OH_IPCRemoteProxy_Destroy方法释放</span></li><li>    <span class="hljs-comment">// ...</span></li><li>}</li></ol></pre></div></div>       <p>回调函数传递的第二个参数OHIPCRemoteProxy对象，会与子进程实现的<strong>NativeChildProcess_OnConnect</strong>方法返回的OHIPCRemoteStub对象间建立IPC通道，具体使用方法参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/ipc-capi-development-guideline">IPC通信开发指导（C/C++)</a>，本文不再赘述；OHIPCRemoteProxy对象使用完毕后，需要调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-ipc-cremote-object-h#oh_ipcremoteproxy_destroy" target="_blank">OH_IPCRemoteProxy_Destroy</a>函数释放。</p></li>      <li>       <p>主进程-启动Native子进程。</p>       <p>调用API启动Native子进程，需要注意返回值为NCP_NO_ERROR仅代表成功调用native子进程启动逻辑，实际的启动结果通过第二个参数中指定的回调函数异步通知。需注意<strong>仅允许在主进程中创建子进程</strong>。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;IPCKit/ipc_kit.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">OnNativeChildProcessStarted</span><span class="hljs-params">(<span class="hljs-type">int</span> errCode, OHIPCRemoteProxy *remoteProxy)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-keyword">if</span> (errCode != NCP_NO_ERROR) {</li><li>        <span class="hljs-comment">// 子进程未能正常启动时的异常处理</span></li><li>        <span class="hljs-comment">// ...</span></li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    </li><li>    <span class="hljs-comment">// 保存remoteProxy对象，后续基于IPC Kit提供的API同子进程间进行IPC通信</span></li><li>    <span class="hljs-comment">// 耗时操作建议转移到独立线程去处理，避免长时间阻塞回调线程</span></li><li>    <span class="hljs-comment">// IPC对象使用完毕后，需要调用OH_IPCRemoteProxy_Destroy方法释放</span></li><li>    <span class="hljs-comment">// ...</span></li><li>}</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">CreateNativeChildProcess</span><span class="hljs-params">()</span> </span>{</li><li>    <span class="hljs-comment">// 第一个参数"libchildprocesssample.so"为实现了子进程必要导出方法的动态库文件名称</span></li><li>    <span class="hljs-type">int32_t</span> ret = <span class="hljs-built_in">OH_Ability_CreateNativeChildProcess</span>(<span class="hljs-string">"libchildprocesssample.so"</span>, OnNativeChildProcessStarted);</li><li>    <span class="hljs-keyword">if</span> (ret != NCP_NO_ERROR) {</li><li>        <span class="hljs-comment">// 子进程未能正常启动时的异常处理</span></li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>主进程-添加编译依赖项。</p>       <p>修改CMaklist.txt添加必要的依赖库，假设主进程所在的so名称为libmainprocesssample.so（主进程和子进程的实现也可以选择编译到同一个动态库文件）。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(mainprocesssample PUBLIC</li><li>    # 添加依赖的IPC及元能力动态库</li><li>    libipc_capi.so</li><li>    libchild_process.so</li><li>   </li><li>    # 其它依赖的动态库</li><li>    # ...</li><li>)</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="创建支持参数传递的native子进程">创建支持参数传递的Native子进程<i class="anchor-icon anchor-icon-link" anchorid="创建支持参数传递的native子进程" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景介绍-1" class="firsth2">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍-1" tips="复制节点链接"></i></h3>          <p>本章节介绍如何创建Native子进程，并传递参数到子进程。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-1">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-1" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.10.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#ability_nativechildprocess_errcode" target="_blank">Ability_NativeChildProcess_ErrCode</a> <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_startnativechildprocess" target="_blank">OH_Ability_StartNativeChildProcess</a> (const char *entry, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativechildprocess-args" target="_blank">NativeChildProcess_Args</a> args, <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativechildprocess-options" target="_blank">NativeChildProcess_Options</a> options, int32_t *pid)</td>         <td class="cellrowborder" valign="top" width="50%">启动子进程并返回子进程pid。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="开发步骤-1">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-1" tips="复制节点链接"></i></h3>          <p><strong>动态库文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libchild_process.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li></ol></pre></div></div>     <ol>      <li>       <p>子进程-实现必要的导出方法。</p>       <p>在子进程中，实现参数为<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativechildprocess-args" target="_blank">NativeChildProcess_Args</a>的入口函数并导出（假设代码所在的文件名为ChildProcessSample.cpp）。子进程启动后会调用该入口函数，该函数返回后子进程随即退出。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 子进程的入口函数，实现子进程的业务逻辑</span></li><li><span class="hljs-comment"> * 函数名称可以自定义，在主进程调用OH_Ability_StartNativeChildProcess方法时指定，此示例中为Main</span></li><li><span class="hljs-comment"> * 函数返回后子进程退出</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(NativeChildProcess_Args args)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取传入的entryPrams</span></li><li>    <span class="hljs-type">char</span> *entryParams = args.entryParams;</li><li>    <span class="hljs-comment">// 获取传入的fd列表</span></li><li>    NativeChildProcess_Fd *current = args.fdList.head;</li><li>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-type">char</span> *fdName = current-&gt;fdName;</li><li>        <span class="hljs-type">int32_t</span> fd = current-&gt;fd;</li><li>        current = current-&gt;next;</li><li>        <span class="hljs-comment">// 业务逻辑..</span></li><li>    }</li><li>}</li><li>} <span class="hljs-comment">// extern "C"</span></li></ol></pre></div></div></li>      <li>       <p>子进程-编译为动态链接库。</p>       <p>修改CMakeList.txt文件，编译为动态链接库（假设需要编译出的库文件名称为libchildprocesssample.so），并添加元能力动态库依赖。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>add_library(childprocesssample SHARED</li><li>    # 实现必要导出方法的源文件</li><li>    ChildProcessSample.cpp</li><li>    </li><li>    # 其它代码源文件</li><li>    # ...</li><li>)</li><li>
</li><li>target_link_libraries(childprocesssample PUBLIC</li><li>    # 添加依赖的元能力动态库</li><li>    libchild_process.so</li><li>
</li><li>    # 其它所依赖的动态库</li><li>    # ...</li><li>)</li></ol></pre></div></div></li>      <li>       <p>主进程-启动Native子进程。</p>       <p>调用API启动Native子进程，返回值为NCP_NO_ERROR代表成功启动native子进程。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;string.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;fcntl.h&gt;</span></span></li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">startNativeChildProcess</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// ...</span></li><li>    NativeChildProcess_Args args;</li><li>    <span class="hljs-comment">// 设置entryParams，支持传输的最大数据量为150KB</span></li><li>    args.entryParams = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>) * <span class="hljs-number">10</span>);</li><li>    (<span class="hljs-type">void</span>)<span class="hljs-built_in">strcpy</span>(args.entryParams, <span class="hljs-string">"testParam"</span>);</li><li>
</li><li>    <span class="hljs-comment">// 插入节点到链表头节点中</span></li><li>    args.fdList.head = (NativeChildProcess_Fd*)<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(NativeChildProcess_Fd));</li><li>    <span class="hljs-comment">// fd关键字，最多不超过20个字符</span></li><li>    args.fdList.head-&gt;fdName = (<span class="hljs-type">char</span>*)<span class="hljs-built_in">malloc</span>(<span class="hljs-built_in">sizeof</span>(<span class="hljs-type">char</span>) * <span class="hljs-number">4</span>);</li><li>    (<span class="hljs-type">void</span>)<span class="hljs-built_in">strcpy</span>(args.fdList.head-&gt;fdName, <span class="hljs-string">"fd1"</span>);</li><li>    <span class="hljs-comment">// 获取fd逻辑</span></li><li>    <span class="hljs-type">int32_t</span> fd = <span class="hljs-built_in">open</span>(<span class="hljs-string">"/data/storage/el2/base/haps/entry/files/test.txt"</span>, O_RDWR | O_CREAT, <span class="hljs-number">0644</span>);</li><li>    args.fdList.head-&gt;fd = fd;</li><li>    <span class="hljs-comment">// 此处只插入一个fd记录，根据需求可以插入更多fd记录到链表中，最多不超过16个</span></li><li>    args.fdList.head-&gt;next = <span class="hljs-literal">NULL</span>;</li><li>    NativeChildProcess_Options options = {</li><li>        .isolationMode = NCP_ISOLATION_MODE_ISOLATED</li><li>    };</li><li>
</li><li>    <span class="hljs-comment">// 第一个参数"libchildprocesssample.so:Main"为实现了子进程Main方法的动态库文件名称和入口方法名</span></li><li>    <span class="hljs-type">int32_t</span> pid = <span class="hljs-number">-1</span>;</li><li>    Ability_NativeChildProcess_ErrCode ret = <span class="hljs-built_in">OH_Ability_StartNativeChildProcess</span>(</li><li>        <span class="hljs-string">"libchildprocesssample.so:Main"</span>, args, options, &amp;pid);</li><li>    <span class="hljs-keyword">if</span> (ret != NCP_NO_ERROR) {</li><li>        <span class="hljs-comment">// 释放NativeChildProcess_Args中的内存空间防止内存泄漏</span></li><li>        <span class="hljs-comment">// 子进程未能正常启动时的异常处理</span></li><li>        <span class="hljs-comment">// ...</span></li><li>    }</li><li>
</li><li>    <span class="hljs-comment">// 其他逻辑</span></li><li>    <span class="hljs-comment">// ...</span></li><li>
</li><li>    <span class="hljs-comment">// 释放NativeChildProcess_Args中的内存空间防止内存泄漏</span></li><li>}</li></ol></pre></div></div></li>      <li>       <p>主进程-添加编译依赖项。</p>       <p>修改CMaklist.txt添加必要的依赖库，假设主进程所在的so名称为libmainprocesssample.so（主进程和子进程的实现也可以选择编译到同一个动态库文件）。</p>       <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>target_link_libraries(mainprocesssample PUBLIC</li><li>    # 添加依赖的元能力动态库</li><li>    libchild_process.so</li><li>   </li><li>    # 其它依赖的动态库</li><li>    # ...</li><li>)</li></ol></pre></div></div></li>     </ol>    </div>    <div class="tiledSection">     <h2 id="子进程获取启动参数">子进程获取启动参数<i class="anchor-icon anchor-icon-link" anchorid="子进程获取启动参数" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="场景介绍-2" class="firsth2">场景介绍<i class="anchor-icon anchor-icon-link" anchorid="场景介绍-2" tips="复制节点链接"></i></h3>          <p>从API version 17开始，支持子进程获取启动参数。</p>    </div>    <div class="tiledSection">     <h3 id="接口说明-2">接口说明<i class="anchor-icon anchor-icon-link" anchorid="接口说明-2" tips="复制节点链接"></i></h3>          <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.14.2.1.3.1.1" valign="top" width="50%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.14.2.1.3.1.2" valign="top" width="50%">描述</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="50%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativechildprocess-args" target="_blank">NativeChildProcess_Args</a>* <a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_getcurrentchildprocessargs" target="_blank">OH_Ability_GetCurrentChildProcessArgs</a>()</td>         <td class="cellrowborder" valign="top" width="50%">返回子进程自身的启动参数。</td>        </tr>             </tbody></table></div>     </div>    </div>    <div class="tiledSection">     <h3 id="开发步骤-2">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤-2" tips="复制节点链接"></i></h3>          <p><strong>动态库文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="txt prettyprint linenums hljs language-plaintext" hw-language="txt" data-highlighted="yes"><ol class="linenums"><li>libchild_process.so</li></ol></pre></div></div>     <p><strong>头文件</strong></p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li></ol></pre></div></div>     <p><strong>获取启动参数</strong></p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_startnativechildprocess" target="_blank">OH_Ability_StartNativeChildProcess</a>创建子进程后，子进程内的任意so和任意子线程可以通过调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-native-child-process-h#oh_ability_getcurrentchildprocessargs" target="_blank">OH_Ability_GetCurrentChildProcessArgs</a>()获取到子进程的启动参数<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/capi-nativechildprocess-args" target="_blank">NativeChildProcess_Args</a>，便于操作相关的文件描述符。</p>     <div _ngcontent-aed-c106="" class="highlight-div"><div _ngcontent-aed-c106="" class="highlight-div-header"><div _ngcontent-aed-c106="" class="highlight-div-header-left"><div _ngcontent-aed-c106="" class="handle-button expand-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-aed-c106="" class="highlight-div-header-right"><div _ngcontent-aed-c106="" class="handle-button ai-button"></div><div _ngcontent-aed-c106="" class="handle-button line-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-aed-c106="" class="handle-button theme-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-aed-c106="" class="handle-button copy-button"><div _ngcontent-aed-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-aed-c106="" class="highlight-scroll-div"><pre class="prettyprint linenums hljs language-cpp" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;AbilityKit/native_child_process.h&gt;</span></span></li><li><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;thread&gt;</span></span></li><li>
</li><li><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span> {</li><li>
</li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">ThreadFunc</span><span class="hljs-params">()</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 获取子进程的启动参数</span></li><li>    NativeChildProcess_Args *args = <span class="hljs-built_in">OH_Ability_GetCurrentChildProcessArgs</span>();</li><li>    <span class="hljs-comment">// 获取启动参数失败时返回nullptr</span></li><li>    <span class="hljs-keyword">if</span> (args == <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 获取启动参数中的entryPrams</span></li><li>    <span class="hljs-type">char</span> *entryParams = args-&gt;entryParams;</li><li>    <span class="hljs-comment">// 获取fd列表</span></li><li>    NativeChildProcess_Fd *current = args-&gt;fdList.head;</li><li>    <span class="hljs-keyword">while</span> (current != <span class="hljs-literal">nullptr</span>) {</li><li>        <span class="hljs-type">char</span> *fdName = current-&gt;fdName;</li><li>        <span class="hljs-type">int32_t</span> fd = current-&gt;fd;</li><li>        current = current-&gt;next;</li><li>        <span class="hljs-comment">// 业务逻辑..</span></li><li>    }</li><li>}</li><li>
</li><li><span class="hljs-comment">/**</span></li><li><span class="hljs-comment"> * 子进程的入口函数，实现子进程的业务逻辑</span></li><li><span class="hljs-comment"> * args是子进程的启动参数</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-function"><span class="hljs-type">void</span> <span class="hljs-title">Main</span><span class="hljs-params">(NativeChildProcess_Args args)</span></span></li><li><span class="hljs-function"></span>{</li><li>    <span class="hljs-comment">// 业务逻辑..</span></li><li>
</li><li>    <span class="hljs-comment">// 创建线程</span></li><li>    <span class="hljs-function">std::thread <span class="hljs-title">tObj</span><span class="hljs-params">(ThreadFunc)</span></span>;</li><li>}</li><li>
</li><li>} <span class="hljs-comment">// extern "C"</span></li></ol></pre></div></div>    </div>   </div>   <div></div></div>