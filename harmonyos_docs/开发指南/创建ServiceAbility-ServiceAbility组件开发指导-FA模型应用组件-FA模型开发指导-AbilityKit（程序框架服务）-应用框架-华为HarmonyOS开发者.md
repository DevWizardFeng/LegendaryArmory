<h1 _ngcontent-ydq-c119="" class="doc-title ng-star-inserted" title="创建ServiceAbility"> 创建ServiceAbility </h1>

<div _ngcontent-ydq-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><ol><li><p>创建ServiceAbility。</p>  <p> 通过DevEco Studio开发平台创建ServiceAbility时，DevEco Studio会默认生成onStart、onStop、onCommand方法，其他方法需要开发者自行实现，接口说明参见前述章节。开发者也可以添加其他Ability请求与ServiceAbility交互时的处理方法，示例如下：</p>  <div _ngcontent-ydq-c106="" class="highlight-div"><div _ngcontent-ydq-c106="" class="highlight-div-header"><div _ngcontent-ydq-c106="" class="highlight-div-header-left"><div _ngcontent-ydq-c106="" class="handle-button expand-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydq-c106="" class="highlight-div-header-right"><div _ngcontent-ydq-c106="" class="handle-button ai-button"></div><div _ngcontent-ydq-c106="" class="handle-button line-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydq-c106="" class="handle-button theme-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydq-c106="" class="handle-button copy-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydq-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">Want</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.AbilityKit'</span>;</li><li><span class="hljs-keyword">import</span> { rpc } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.IPCKit'</span>;</li><li><span class="hljs-keyword">import</span> { hilog } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.PerformanceAnalysisKit'</span>;</li><li>
</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">TAG</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'[Sample_FAModelAbilityDevelop]'</span>;</li><li><span class="hljs-keyword">const</span> <span class="hljs-attr">domain</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0xFF00</span>;</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">FirstServiceAbilityStub</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_ inherited__">rpc.RemoteObject</span> {</li><li>  <span class="hljs-title function_">constructor</span>(<span class="hljs-params">des: <span class="hljs-built_in">Object</span></span>) {</li><li>    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> des === <span class="hljs-string">'string'</span>) {</li><li>      <span class="hljs-variable language_">super</span>(des);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onRemoteMessageRequest</span>(<span class="hljs-attr">code</span>: <span class="hljs-built_in">number</span>, <span class="hljs-attr">data</span>: rpc.<span class="hljs-property">MessageSequence</span>, <span class="hljs-attr">reply</span>: rpc.<span class="hljs-property">MessageSequence</span>, <span class="hljs-attr">option</span>: rpc.<span class="hljs-property">MessageOption</span>): <span class="hljs-built_in">boolean</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onRemoteRequest called'</span>);</li><li>    <span class="hljs-keyword">if</span> (code === <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-keyword">let</span> <span class="hljs-built_in">string</span> = data.<span class="hljs-title function_">readString</span>();</li><li>      hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ServiceAbility string=<span class="hljs-subst">${<span class="hljs-built_in">string</span>}</span>`</span>);</li><li>      <span class="hljs-keyword">let</span> result = <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(<span class="hljs-built_in">string</span>).<span class="hljs-title function_">sort</span>().<span class="hljs-title function_">join</span>(<span class="hljs-string">''</span>);</li><li>      hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">`ServiceAbility result=<span class="hljs-subst">${result}</span>`</span>);</li><li>      reply.<span class="hljs-title function_">writeString</span>(result);</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility unknown request code'</span>);</li><li>    }</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">class</span> <span class="hljs-title class_">ServiceAbility</span> {</li><li>  <span class="hljs-title function_">onStart</span>(): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onStart'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onStop</span>(): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onStop'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onCommand</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>, <span class="hljs-attr">startId</span>: <span class="hljs-built_in">number</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onCommand'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onConnect</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): rpc.<span class="hljs-property">RemoteObject</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onConnect'</span> + want);</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FirstServiceAbilityStub</span>(<span class="hljs-string">'test'</span>);</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">onDisconnect</span>(<span class="hljs-attr">want</span>: <span class="hljs-title class_">Want</span>): <span class="hljs-built_in">void</span> {</li><li>    hilog.<span class="hljs-title function_">info</span>(domain, <span class="hljs-variable constant_">TAG</span>, <span class="hljs-string">'ServiceAbility onDisconnect'</span> + want);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ServiceAbility</span>();</li></ol></pre></div></div>  </li><li><p>注册ServiceAbility。</p>  <p> ServiceAbility需要在应用配置文件config.json中进行注册，注册类型type需要设置为service。"visible"属性表示ServiceAbility是否可以被其他应用调用，true表示可以被其他应用调用，false表示不能被其他应用调用（仅应用内可以调用）。若ServiceAbility需要被其他应用调用，注册ServiceAbility时需要设置"visible"为true，同时需要设置支持关联启动。ServiceAbility的启动规则详见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/component-startup-rules">组件启动规则</a>章节。</p>  <div _ngcontent-ydq-c106="" class="highlight-div"><div _ngcontent-ydq-c106="" class="highlight-div-header"><div _ngcontent-ydq-c106="" class="highlight-div-header-left"><div _ngcontent-ydq-c106="" class="handle-button expand-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-ydq-c106="" class="highlight-div-header-right"><div _ngcontent-ydq-c106="" class="handle-button ai-button"></div><div _ngcontent-ydq-c106="" class="handle-button line-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-ydq-c106="" class="handle-button theme-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-ydq-c106="" class="handle-button copy-button"><div _ngcontent-ydq-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-ydq-c106="" class="highlight-scroll-div"><pre class="json prettyprint linenums hljs language-json" hw-language="json" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-punctuation">{</span></li><li>  <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-attr">"module"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">{</span></li><li>    <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-attr">"abilities"</span><span class="hljs-punctuation">:</span> <span class="hljs-punctuation">[</span></li><li>      <span class="hljs-comment">// ...</span></li><li>      <span class="hljs-punctuation">{</span></li><li>        <span class="hljs-attr">"name"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">".ServiceAbility"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"srcLanguage"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ets"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"srcPath"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"ServiceAbility"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"icon"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$media:icon"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"description"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"$string:ServiceAbility_desc"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"type"</span><span class="hljs-punctuation">:</span> <span class="hljs-string">"service"</span><span class="hljs-punctuation">,</span></li><li>        <span class="hljs-attr">"visible"</span><span class="hljs-punctuation">:</span> <span class="hljs-literal"><span class="hljs-keyword">true</span></span></li><li>      <span class="hljs-punctuation">}</span><span class="hljs-punctuation">,</span></li><li>      <span class="hljs-comment">// ...</span></li><li>    <span class="hljs-punctuation">]</span></li><li>    <span class="hljs-comment">// ...</span></li><li>  <span class="hljs-punctuation">}</span></li><li><span class="hljs-punctuation">}</span></li></ol></pre></div></div>  </li></ol> </div> <div></div></div>