<h1 _ngcontent-vii-c119="" class="doc-title ng-star-inserted" title="创建函数"> 创建函数 </h1>

<div _ngcontent-vii-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div><div class="tiledSection"><h2 id="section15530732134">创建函数<i class="anchor-icon anchor-icon-link" anchorid="section15530732134" tips="复制节点链接"></i></h2><p>开通云函数服务后，首先需要在AGC中创建函数，并添加函数执行的代码。</p> <ol><li>登录<a href="https://developer.huawei.com/consumer/cn/service/josp/agc/index.html" target="_blank">AppGallery Connect</a>，点击“开发与服务”。</li><li>在项目列表中点击需要创建云函数的项目。</li><li>在左侧导航栏选择“云开发（Serverless） &gt; 云函数”，进入云函数主界面。</li><li>选择“函数”页签，点击“创建函数”。<p><span><img originheight="674" originwidth="1074" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114653.03525171539475802394680756549113:50001231000000:2800:354ED64620721EC83EDE41522B1E0F921522DEF7E80C4A16CF495C29FD48770D.png" width="920" height="577.3556797020484"></span></p> </li><li>页面右侧抽屉式滑出“创建函数”窗口，按照“函数配置 -&gt; 触发器 -&gt; 函数代码 -&gt; 层配置”引导顺序配置函数。<p><span><img originheight="811" originwidth="1123" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114653.77429231232289001340284212050500:50001231000000:2800:124FA6B477E99202F9FACFC4CA2A6A8EDA4FBA5DCB9DEA970E097AEAE3DA4D80.png" width="920" height="664.3989314336599"></span></p> </li></ol> </div> <div class="tiledSection"><h2 id="section1642414486331">函数配置<i class="anchor-icon anchor-icon-link" anchorid="section1642414486331" tips="复制节点链接"></i></h2><ol><li>在“函数配置”页面，配置“函数名称”、“触发方式”、“超时时长”等函数信息。<p><span><img originheight="802" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114653.38172505726731741954202730524482:50001231000000:2800:ADB8F38FDAF05E5D806D5280C5CE67D785939310A4E55DB258433A0FF6D30628.png" width="920" height="745.2929292929293"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.2.2.1.2.1.3.1.1" valign="top" width="18.310000000000002%"><p>配置项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.2.2.1.2.1.3.1.2" valign="top" width="81.69%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>函数名称</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p>函数的名称。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>描述</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p>函数的描述信息。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>触发方式</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p><strong>请配置为“事件调用”。</strong></p> <p>“事件调用”表示通过触发器方式调用函数。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>超时时长</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p>函数最大运行时长，超过该时长，则默认函数执行失败，单位为秒，取值范围为1~1800。不同调用方式下，函数最大运行时长不同：</p> <ul><li>“同步”调用方式时，函数最大运行时长为55秒。</li></ul> <ul><li>“异步”调用方式时，函数最大运行时长为1800秒。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>实例并发</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p>函数请求并发量上限，单位为个，取值范围为1~10000。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.310000000000002%"><p>环境变量</p> </td> <td class="cellrowborder" valign="top" width="81.69%"><p>key-value形式，可以将需要的变量配置信息传入函数执行环境中，用于函数在运行时读取和使用。</p> </td> </tr>  </tbody></table></div> </div> </li><li>（可选）可根据需要添加环境变量，支持<strong>表单格式</strong>和<strong>JSON格式</strong>两种编辑方式。添加完成后，还可以点击“JSON格式导出”，导出以“函数名称.json”格式命名的环境变量文件，以备后续使用。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><ul><li>环境变量的key值具有唯一性，且“PROJECT_CREDENTIAL”和“AGC_”为系统级环境变量标识，不允许添加以其命名或以其为前缀的环境变量。</li><li>环境变量总数不超过1000个。</li></ul> </div></div></div> <ul><li>表单格式编辑<p>点击“新增变量”，输入key和value值，如下图中所示，env1为环境变量的key值，test为value值。点击<span><img originheight="15" originwidth="23" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.24075128324312584619064999474533:50001231000000:2800:9FB28165EF6CC5F9220B500024A3326689B4EC8B8064D19548BAC2AC898CCF59.png" class="IconPic notEnlarge" width="23" height="15"></span>可将变量删除。</p> <p><span><img originheight="357" originwidth="984" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.66409699322265211955834993410202:50001231000000:2800:9B9F0F834DCF69D0CE26A522C4011DBD9BD0AABBD1491A408EF1DF423A90765E.png" width="920" height="333.780487804878"></span></p> </li><li>JSON格式编辑<p>选中“JSON格式编辑”，在文本框中以key-value键值对JSON格式添加环境变量。当添加的环境变量比较多时，为了方便核对，可点击“format”对变量进行格式化排列。</p> <p><span><img originheight="465" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.29660299857912582496994462452523:50001231000000:2800:C3CA4576E95FAAE9F3534A2FF9EA887313E4A88FA018FC1FBC5892BA690A834B.png" width="920" height="432.1212121212121"></span></p> </li></ul> </li><li>“函数配置”页面配置完成后点击“下一步”。</li></ol> </div> <div class="tiledSection"><h2 id="section898842219323">触发器<i class="anchor-icon anchor-icon-link" anchorid="section898842219323" tips="复制节点链接"></i></h2><p>进入“触发器”页面，可基于函数触发场景配置需要的触发器，本场景下添加HTTP触发器。“触发器类型”和“请求方式”保持默认选择，并配置“认证类型”，配置完成后点击“下一步”。</p> <div class="p"><span><img originheight="800" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.65278125652843552160993741308899:50001231000000:2800:C1784F550A3DE930757D4A94A51112F16CB42DD35A055660099CD282FFB1DBAE.png" width="920" height="743.4343434343434"></span> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.3.3.2.1.3.1.1" valign="top" width="20.02%"><p>参数</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.3.3.2.1.3.1.2" valign="top" width="79.97999999999999%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20.02%"><p>触发器类型</p> </td> <td class="cellrowborder" valign="top" width="79.97999999999999%"><p>HTTP触发器。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.02%"><p>请求方式</p> </td> <td class="cellrowborder" valign="top" width="79.97999999999999%"><p>HTTP触发器目前仅支持POST请求方式。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.02%"><p>认证类型</p> </td> <td class="cellrowborder" valign="top" width="79.97999999999999%"><p>HTTP触发器的认证类型。</p> <ul><li>API客户端鉴权（Client适用）：端侧网关认证，适用于来自APP客户端侧（即本地应用或者项目）的函数调用。</li><li>API客户端鉴权（Server适用）：云侧网关认证，适用于来自APP服务器侧（即云函数）的函数调用。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.02%"><p>启用decode</p> </td> <td class="cellrowborder" valign="top" width="79.97999999999999%"><p>通过HTTP触发器触发函数时，对于contentType为“application/x-www-form-urlencoded”的触发请求，是否使用URLDecoder对请求body进行解码再传入到函数中。</p> </td> </tr>  </tbody></table></div> </div> </div> </div> <div class="tiledSection"><h2 id="section199191428193411">函数代码<i class="anchor-icon anchor-icon-link" anchorid="section199191428193411" tips="复制节点链接"></i></h2><p>进入“函数代码”页面，配置“运行环境”、“内存配置”、“代码输入类型”等信息，配置完成后点击“下一步”。</p> <p><span><img originheight="804" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.77314628320172666897318609320239:50001231000000:2800:A56D8C805666BBF3932084FC01141C03A7FBB3B3D273E5267FCCB9330B4B4CFC.png" width="920" height="747.1515151515151"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.4.1.3.1.1" valign="top" width="18.22%"><p>配置项</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.4.1.3.1.2" valign="top" width="81.78%"><p><strong>说明</strong></p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="18.22%"><p>运行环境</p> </td> <td class="cellrowborder" valign="top" width="81.78%"><p>函数容器的运行环境。请选择nodejs 20.x/latest，其中latest表示使用最新版本。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.22%"><p>内存配置</p> </td> <td class="cellrowborder" valign="top" width="81.78%"><p>函数容器所占有的内存大小，单位为MB，取值范围：500，1000，2000，4000。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.22%"><p>代码输入类型</p> </td> <td class="cellrowborder" valign="top" width="81.78%"><p>包括“在线编辑”与“*.zip文件”两种方式，默认值为“在线编辑”。</p> <p>选择“*.zip文件”方式部署云函数时，入口方法文件的编写方法请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-develop-function-nodejs#section69815160394">入口方法</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.22%"><p>函数入口</p> </td> <td class="cellrowborder" valign="top" width="81.78%"><p>包括入口文件名称和入口方法名称，通过“.”连接。例如handler.myHandler，其中handler为入口文件名称，myHandler为入口方法名称。</p> <p>nodejs运行环境下入口文件必须放置在函数部署包的根目录下，具体请参见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/cloudfoundation-develop-function-nodejs#section527564201715">准备函数部署包</a>。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="18.22%"><p>代码文件</p> </td> <td class="cellrowborder" valign="top" width="81.78%"><p>用于在线编辑函数代码或上传函数部署包。</p> <ul><li>“代码输入类型”配置项选择“在线编辑”时，可在创建函数界面集成的WebIDE区域在线编辑函数代码。WebIDE的详细使用方法见下文。</li><li>“代码输入类型”配置项选择“*.zip文件”时，点击<span><img originheight="20" originwidth="24" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.55902016332015909707097540714949:50001231000000:2800:3EA69E151B609173C54F056FAE045F7EFF35949540C3962882E34527CCF0D977.png" class="IconPic notEnlarge" width="24" height="20"></span>即可上传函数部署包，也可直接拖曳zip文件至虚线框内。</li></ul> </td> </tr>  </tbody></table></div> </div> <p><strong>WebIDE</strong></p> <p class="MsoBodyTextFirstIndent">当“代码输入类型”配置项选择“在线编辑”时，创建函数界面中集成了WebIDE功能，支持在线编辑函数代码。</p> <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content"><p>如果在函数实例已经运行的情况下进行函数代码或配置更新，AGC后台会滚动更新函数实例，请耐心等待10-20秒。</p> </div></div></div> <p class="MsoBodyTextFirstIndent">WebIDE从左至右分两个部分：目录树、代码编辑器和最大化，如下图所示。编辑完成后平台会生成部署包并上传。</p> <p><span><img originheight="388" originwidth="782" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.79377574941436761582239136501766:50001231000000:2800:E9E65345CBC87F26B0419F91765DFD6C0A9E9278170E1374D8D52CAA2DFE523D.png" width="782" height="388"></span></p>  <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.1" valign="top" width="24.48%"><p>组成</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.4.10.1.3.1.2" valign="top" width="75.52%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="24.48%"><p>目录树</p> </td> <td class="cellrowborder" valign="top" width="75.52%"><p>目录树支持如下能力：</p> <ul><li>新增文件夹：选中一个文件或文件夹，点击右上角新增文件夹按钮“<span><img originheight="18" originwidth="22" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.78493884970769192705016110913897:50001231000000:2800:969F66577DB3BDBD5686B8E9E95D8C52DA7E11647F8B117B2FE222D13D4800D5.png" class="IconPic notEnlarge" width="22" height="18"></span>”。若选中的是文件夹，则新增一个子文件夹。若选中的是文件，则新增一个同级文件夹。</li><li>新增文件：选中一个文件或文件夹，点击右上角新增文件按钮“<span><img originheight="22" originwidth="18" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.27750402387889081334625806755017:50001231000000:2800:E4041F275A2896E6D3C30E3AA363FCC10A52390A862C17FD9BAEA3A1CF775BB4.png" class="IconPic notEnlarge" width="18" height="22"></span>”。若选中的是文件夹，则新增一个子文件。若选中的是文件，则新增一个同级文件。</li><li>删除文件：选中一个文件或文件夹，点击右侧删除按钮“<span><img originheight="16" originwidth="16" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.92331956817524413137212099018432:50001231000000:2800:83684F1BF1A6A343606818CC2BA7DAB93CF332A28E914D6986B8285375A8E3C1.png" class="IconPic notEnlarge" width="16" height="16"></span>”，删除文件或文件夹。不允许删除根目录。</li><li>重命名：双击文件或文件夹，输入新命名（仅支持字母、数字、下划线和中划线），完毕后按Enter键完成重命名。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="24.48%"><p>编辑器</p> </td> <td class="cellrowborder" valign="top" width="75.52%"><p>编辑器具有如下能力：</p> <ul><li>语法高亮：按照node.js语法高亮显示代码。</li><li>语法校验：语法有错误时会给出错误提示。</li><li>代码提示：输出代码自动给出相关代码提示。</li><li>代码填充：选择后系统代码可自动填充。</li><li>格式化：快捷键Ctrl+Shift+B。</li><li>支持快捷键操作：Ctrl+v, Ctrl+c, Ctrl+z, Ctrl+x, Ctrl+f, Ctrl+/等。</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="24.48%"><p>最大化</p> </td> <td class="cellrowborder" valign="top" width="75.52%"><p>点击最大化按钮<span><img originheight="18" originwidth="19" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.39517831568603261825824073244984:50001231000000:2800:12ED26410956D37AF3415E249248166F3A534F557912603EBFE87AFF11E0EE6D.png" class="IconPic notEnlarge" width="19" height="18"></span>，可以最大化在线编辑区，再次点击<span><img originheight="20" originwidth="21" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.20539391159003233228110873761579:50001231000000:2800:500DFDBFF7F8982D761EF80CE9FE74B86B9563E5E790857EF4DB10C295BA7F72.png" class="IconPic notEnlarge" width="21" height="20"></span>按钮或按ESC键退出最大化。</p> </td> </tr>  </tbody></table></div> </div> </div> <div class="tiledSection"><h2 id="section1054343663416">层配置<i class="anchor-icon anchor-icon-link" anchorid="section1054343663416" tips="复制节点链接"></i></h2><p>层可以提供公共依赖库的发布与部署能力。开发者可以将函数依赖的公共库和相关依赖项提炼到层，通过为函数绑定层，便可以在函数中使用库，而不必将库包含在函数的代码包中，从而达到缩小函数代码包体积与缩短函数部署时间的效果，也避免了使用函数代码安装和打包依赖项时可能出现的错误。详细的层管理功能，请参见<a href="https://developer.huawei.com/consumer/cn/doc/AppGallery-connect-Guides/agc-cloud-function-layer-0000001517762624" target="_blank">层管理</a>。</p> <p>如果尚未创建层，可跳过下述步骤，直接点击页面底部的“创建”完成函数定义，后续创建层之后可在函数详情页再进行层配置，为函数绑定层。如果在创建函数之前已创建层，可按照下述步骤进行操作。</p> <ol><li>进入“层配置”页面，点击“绑定层”。<p><span><img originheight="801" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.62651289009360145511109894933517:50001231000000:2800:6439470DB5A6EEB3E3F0F303AE19AFDDE1CFF27B5270B3DBE6E5200F51C6D66F.png" width="920" height="744.3636363636364"></span></p> </li><li>在右侧弹出的“绑定层”界面中，下拉框选择“层名称”和“版本”，“层范围”等信息根据层的配置将被自动填充，完成层绑定后点击“确定”。一个函数最多可以绑定5个层。<div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content"><p>选择层时，层的兼容运行时需与函数运行环境相符，系统会自动完成过滤。如果无匹配的层，请参考<a href="https://developer.huawei.com/consumer/cn/doc/AppGallery-connect-Guides/agc-cloud-function-layer-0000001517762624#section11358162018572" target="_blank">创建层</a>创建相同运行环境的层后再进行绑定。</p> </div></div></div> <div class="p"><span><img originheight="809" originwidth="989" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.47548370522026657446012734764830:50001231000000:2800:C834DE7CB4EC58BBADA8E0C508A024C6171B39AD778646BDD4A93FD7B56C0304.png" width="920" height="752.5581395348837"></span> <div class="tablenoborder"><div class="tbBox"><table class="layoutFixed idpTab"><thead><tr><th align="left" class="cellrowborder" id="mcps1.3.5.4.2.2.2.1.3.1.1" valign="top" width="20.13%"><p>参数</p> </th> <th align="left" class="cellrowborder" id="mcps1.3.5.4.2.2.2.1.3.1.2" valign="top" width="79.86999999999999%"><p>说明</p> </th> </tr> </thead> <tbody><tr><td class="cellrowborder" valign="top" width="20.13%"><p>层名称</p> </td> <td class="cellrowborder" valign="top" width="79.86999999999999%"><p>层的名称。重复时自动在同名的层中创建一个新版本。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.13%"><p>版本</p> </td> <td class="cellrowborder" valign="top" width="79.86999999999999%"><p>存在多个层版本时，选择函数绑定的层版本。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.13%"><p>层范围</p> </td> <td class="cellrowborder" valign="top" width="79.86999999999999%"><p>层的共享范围。</p> <ul><li>项目内共享</li><li>团队内共享</li></ul> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.13%"><p>兼容运行时</p> </td> <td class="cellrowborder" valign="top" width="79.86999999999999%"><p>层使用的语言环境。请选择“nodejs”。</p> </td> </tr> <tr><td class="cellrowborder" valign="top" width="20.13%"><p>层描述</p> </td> <td class="cellrowborder" valign="top" width="79.86999999999999%"><p>层的附加说明，长度不超过1024位。</p> </td> </tr>  </tbody></table></div> </div> </div> </li><li>返回到“层配置”界面，绑定成功的层将展示在层列表中。如果需要解除层与函数的绑定关系，点击“解绑”即可。<p><span><img originheight="799" originwidth="990" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114654.43043185550713083055326771323199:50001231000000:2800:BE8E9F74EF7A92F304B70823F31479E9CE43E399FE1C124B24BED67B7706DDAC.png" width="920" height="742.5050505050505"></span></p> </li><li>按照“函数配置 -&gt; 触发器 -&gt; 函数代码 -&gt; 层配置”顺序配置过程中，如果需要修改前面步骤中的配置，可点击“上一步”进行回退，配置完成后点击“创建”提交函数定义。</li></ol> </div> <div class="tiledSection"><h2 id="section366910579499">更多信息<i class="anchor-icon anchor-icon-link" anchorid="section366910579499" tips="复制节点链接"></i></h2><p>函数配置完成后，可以<a href="https://developer.huawei.com/consumer/cn/doc/AppGallery-connect-Guides/modify-function-advanced-config-0000001734287937" target="_blank">修改函数高级配置</a>。</p> </div> </div> <div></div></div>