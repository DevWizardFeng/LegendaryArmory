<h1 _ngcontent-xcv-c119="" class="doc-title ng-star-inserted" title="创建自定义组件"> 创建自定义组件 </h1>

<div _ngcontent-xcv-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>在ArkUI中，UI显示的内容均为组件，由框架直接提供的称为系统组件，由开发者定义的称为自定义组件。进行UI界面开发时，不仅要组合使用系统组件，还需考虑代码的可复用性、业务逻辑与UI的分离，以及后续版本的演进等因素。因此，将UI和部分业务逻辑封装成自定义组件是不可或缺的能力。</p>    <p>自定义组件具有以下特点：</p>    <ul>     <li>      <p>可组合：允许开发者组合使用系统组件及其属性和方法。</p></li>     <li>      <p>可重用：自定义组件可以被其他组件重用，并作为不同的实例在不同的父组件或容器中使用。</p></li>     <li>      <p>数据驱动UI更新：通过状态变量的改变，来驱动UI的刷新。</p></li>    </ul>    <div class="tiledSection">     <h2 id="自定义组件的基本用法">自定义组件的基本用法<i class="anchor-icon anchor-icon-link" anchorid="自定义组件的基本用法" tips="复制节点链接"></i></h2>          <p>以下示例展示了自定义组件的基本用法。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">HelloComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">message</span>: <span class="hljs-built_in">string</span> = <span class="hljs-string">'Hello, World!'</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// HelloComponent自定义组件组合系统组件Row和Text</span></li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-comment">// 状态变量message的改变驱动UI刷新，UI从'Hello, World!'刷新为'Hello, ArkUI!'</span></li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">message</span> = <span class="hljs-string">'Hello, ArkUI!'</span>;</li><li>        })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip warn"><div class="title">注意</div><div class="content">       <p>如果在其他文件中引用自定义组件，需要使用export关键字导出组件，并在使用的页面import该自定义组件。</p>      </div></div></div>     <p>可以在其他自定义组件的build()函数中多次创建HelloComponent，以实现自定义组件的重用。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'ArkUI message'</span>)</li><li>      <span class="hljs-title class_">HelloComponent</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'Hello World!'</span> });</li><li>      <span class="hljs-title class_">Divider</span>()</li><li>      <span class="hljs-title class_">HelloComponent</span>({ <span class="hljs-attr">message</span>: <span class="hljs-string">'你好，世界!'</span> });</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>要完全理解上面的示例，需要了解自定义组件的以下概念定义，本文将在后面的小节中介绍：</p>     <ul>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#自定义组件的基本结构">自定义组件的基本结构</a></p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#成员函数变量">成员函数/变量</a></p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#自定义组件的参数规定">自定义组件的参数规定</a></p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#build函数">build()函数</a></p></li>      <li>       <p><a href="/consumer/cn/doc/harmonyos-guides/arkts-create-custom-components#自定义组件通用样式">自定义组件通用样式</a></p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="自定义组件的基本结构">自定义组件的基本结构<i class="anchor-icon anchor-icon-link" anchorid="自定义组件的基本结构" tips="复制节点链接"></i></h2>         </div>    <div class="tiledSection">     <h3 id="struct" class="firsth2">struct<i class="anchor-icon anchor-icon-link" anchorid="struct" tips="复制节点链接"></i></h3>          <p>自定义组件基于struct实现，struct + 自定义组件名 + {...}的组合构成自定义组件，不能有继承关系。对于struct的实例化，可以省略new。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>自定义组件名、类名、函数名不得与系统组件名重复。</p>      </div></div></div>    </div>    <div class="tiledSection">     <h3 id="component">@Component<i class="anchor-icon anchor-icon-link" anchorid="component" tips="复制节点链接"></i></h3>          <p>@Component装饰器仅装饰struct关键字声明的数据结构。被装饰的struct具备组件化的能力，需要实现build方法描述UI，一个struct只能被一个@Component装饰。@Component可以接受一个可选的boolean类型参数。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 9开始，该装饰器支持在ArkTS卡片中使用。</p>       <p>从API version 11开始，@Component可以接受一个可选的boolean类型参数。</p>       <p>从API version 11开始，该装饰器支持在元服务中使用。</p>      </div></div></div>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>}</li></ol></pre></div></div>     <p><strong>freezeWhenInactive<sup>11+</sup></strong></p>     <p><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-custom-components-freeze">组件冻结</a>选项。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.6.1.1" valign="top" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.6.1.2" valign="top" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.6.1.3" valign="top" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.6.1.4" valign="top" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.7.7.1.6.1.5" valign="top" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="20%">freezeWhenInactive</td>         <td class="cellrowborder" valign="top" width="20%">boolean</td>         <td class="cellrowborder" valign="top" width="20%">否</td>         <td class="cellrowborder" valign="top" width="20%">否</td>         <td class="cellrowborder" valign="top" width="20%">是否开启组件冻结。默认值false。true表示开启组件冻结，false表示不开启组件冻结。</td>        </tr>             </tbody></table></div>     </div>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span>({ <span class="hljs-attr">freezeWhenInactive</span>: <span class="hljs-literal">true</span> })</li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="build函数">build()函数<i class="anchor-icon anchor-icon-link" anchorid="build函数" tips="复制节点链接"></i></h3>          <p>build()函数用于定义自定义组件的声明式UI描述，自定义组件必须定义build()函数。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="entry">@Entry<i class="anchor-icon anchor-icon-link" anchorid="entry" tips="复制节点链接"></i></h3>          <p>@Entry装饰的自定义组件将作为UI页面的入口。在单个UI页面中，仅允许存在一个由@Entry装饰的自定义组件作为页面的入口。@Entry可以接受一个可选的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>参数。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 9开始，该装饰器支持在ArkTS卡片中使用。</p>       <p>从API version 10开始，@Entry可以接受一个可选的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>参数或者一个可选的EntryOptions<sup>10+</sup>参数。</p>       <p>从API version 11开始，该装饰器支持在元服务中使用。</p>      </div></div></div>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>}</li></ol></pre></div></div>     <p><strong>EntryOptions<sup>10+</sup></strong></p>     <p>命名路由跳转选项。</p>     <div class="tablenoborder">      <div class="tbBox"><table class="layoutFixed idpTab">       <thead>        <tr>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.1" valign="top" width="20%">名称</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.2" valign="top" width="20%">类型</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.3" valign="top" width="20%">只读</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.4" valign="top" width="20%">可选</th>         <th align="left" class="cellrowborder" id="mcps1.3.9.7.1.6.1.5" valign="top" width="20%">说明</th>        </tr>       </thead>               <tbody><tr>         <td class="cellrowborder" valign="top" width="20%">routeName</td>         <td class="cellrowborder" valign="top" width="20%">string</td>         <td class="cellrowborder" valign="top" width="20%">否</td>         <td class="cellrowborder" valign="top" width="20%">是</td>         <td class="cellrowborder" valign="top" width="20%">表示作为命名路由页面的名字。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">storage</td>         <td class="cellrowborder" valign="top" width="20%"><a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a></td>         <td class="cellrowborder" valign="top" width="20%">否</td>         <td class="cellrowborder" valign="top" width="20%">是</td>         <td class="cellrowborder" valign="top" width="20%">页面级的UI状态存储。当未传入时，框架会创建一个新的LocalStorage实例作为默认值。</td>        </tr>        <tr>         <td class="cellrowborder" valign="top" width="20%">useSharedStorage<sup>12+</sup></td>         <td class="cellrowborder" valign="top" width="20%">boolean</td>         <td class="cellrowborder" valign="top" width="20%">否</td>         <td class="cellrowborder" valign="top" width="20%">是</td>         <td class="cellrowborder" valign="top" width="20%">是否使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/arkts-apis-window-windowstage#loadcontent9" target="_blank">loadContent</a>传入的LocalStorage实例对象。默认值false。true：使用共享的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>实例对象。false：不使用共享的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-localstorage">LocalStorage</a>实例对象。</td>        </tr>             </tbody></table></div>     </div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>当useSharedStorage设置为true且storage已赋值时，useSharedStorage的值优先级更高。</p>      </div></div></div>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span>({ routeName : <span class="hljs-string">'myPage'</span> })</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h3 id="reusable">@Reusable<i class="anchor-icon anchor-icon-link" anchorid="reusable" tips="复制节点链接"></i></h3>          <p>@Reusable装饰的自定义组件具备可复用能力。详细请参考：<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-reusable#使用场景">@Reusable装饰器：组件复用</a>。</p>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>从API version 10开始，该装饰器支持在ArkTS卡片中使用。</p>      </div></div></div>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Reusable</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="成员函数变量">成员函数/变量<i class="anchor-icon anchor-icon-link" anchorid="成员函数变量" tips="复制节点链接"></i></h2>          <p>自定义组件除了必须要实现build()函数外，还可以实现其他成员函数，成员函数具有以下约束：</p>     <ul>      <li>自定义组件的成员函数仅能从组件内部访问，且不建议声明为静态函数。</li>     </ul>     <p>自定义组件可以包含成员变量，成员变量具有以下约束：</p>     <ul>      <li>       <p>自定义组件的成员变量仅能从组件内部访问，且不建议声明为静态变量。</p></li>      <li>       <p>自定义组件的成员变量本地初始化有些是可选的，有些是必选的。具体是否需要本地初始化，是否需要从父组件通过参数传递初始化子组件的成员变量，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state-management-overview">状态管理</a>。</p></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="自定义组件的参数规定">自定义组件的参数规定<i class="anchor-icon anchor-icon-link" anchorid="自定义组件的参数规定" tips="复制节点链接"></i></h2>          <p>以下示例展示了如何在build方法里创建自定义组件，并在创建自定义组件的过程中，根据装饰器的规则来初始化自定义组件的参数。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">countDownFrom</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">color</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Blue</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComponent</span> {</li><li>  <span class="hljs-keyword">private</span> <span class="hljs-attr">someColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>;</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 创建MyComponent实例，并将创建MyComponent成员变量countDownFrom初始化为10，将成员变量color初始化为this.someColor</span></li><li>      <span class="hljs-title class_">MyComponent</span>({ <span class="hljs-attr">countDownFrom</span>: <span class="hljs-number">10</span>, <span class="hljs-attr">color</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">someColor</span> })</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <p>以下示例代码将父组件中的函数传递给子组件，并在子组件中调用。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Parent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">cnt</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span></li><li>  <span class="hljs-attr">submit</span>: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span> = <span class="hljs-function">() =&gt;</span> {</li><li>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">cnt</span>++;</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.cnt}</span>`</span>)</li><li>      <span class="hljs-title class_">Son</span>({ <span class="hljs-attr">submitArrow</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">submit</span> })</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">Son</span> {</li><li>  submitArrow?: <span class="hljs-function">() =&gt;</span> <span class="hljs-built_in">void</span></li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">'add'</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">80</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">submitArrow</span>) {</li><li>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">submitArrow</span>()</li><li>          }</li><li>        })</li><li>    }</li><li>    .<span class="hljs-title function_">height</span>(<span class="hljs-number">56</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="build函数-1">build()函数<i class="anchor-icon anchor-icon-link" anchorid="build函数-1" tips="复制节点链接"></i></h2>          <p>所有在build()函数中声明的语句统称为UI描述，UI描述需要遵循以下规则：</p>     <ul>      <li>       <p>@Entry装饰的自定义组件，其build()函数下的根节点唯一且必要，且必须为容器组件，其中ForEach禁止作为根节点。</p>       <p>@Component装饰的自定义组件，其build()函数下的根节点唯一且必要，可以为非容器组件，其中ForEach禁止作为根节点。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 根节点唯一且必要，必须为容器组件</span></li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>()</li><li>    }</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-comment">// 根节点唯一且必要，可为非容器组件</span></li><li>    <span class="hljs-title class_">Image</span>(<span class="hljs-string">'test.jpg'</span>)</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许声明本地变量，反例如下。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 反例：不允许声明本地变量</span></li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">num</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许在UI描述里直接使用console.info，但允许在方法或者函数里使用，反例如下。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 反例：不允许console.info</span></li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">'print debug log'</span>);</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许创建本地的作用域，反例如下。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">// 反例：不允许本地作用域</span></li><li>  {</li><li>    <span class="hljs-comment">// ...</span></li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许调用没有用@Builder装饰的方法，允许系统组件的参数是TS方法的返回值。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ParentComponent</span> {</li><li>  <span class="hljs-title function_">doSomeCalculations</span>(<span class="hljs-params"></span>) {</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">calcTextValue</span>(): <span class="hljs-built_in">string</span> {</li><li>    <span class="hljs-keyword">return</span> <span class="hljs-string">'Hello World'</span>;</li><li>  }</li><li>
</li><li>  <span class="hljs-meta">@Builder</span> <span class="hljs-title function_">doSomeRender</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Text</span>(<span class="hljs-string">`Hello World`</span>)</li><li>  }</li><li>
</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 反例：不能调用没有用@Builder装饰的方法</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doSomeCalculations</span>();</li><li>      <span class="hljs-comment">// 正例：可以调用</span></li><li>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">doSomeRender</span>();</li><li>      <span class="hljs-comment">// 正例：参数可以为调用TS方法的返回值</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-title function_">calcTextValue</span>())</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许使用switch语法，当需要使用条件判断时，请使用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-rendering-control-ifelse">if</a>。示例如下。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-comment">// 反例：不允许使用switch语法</span></li><li>    <span class="hljs-keyword">switch</span> (expression) {</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-number">1</span>:</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>)</li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-keyword">case</span> <span class="hljs-number">2</span>:</li><li>        <span class="hljs-title class_">Image</span>(<span class="hljs-string">'...'</span>)</li><li>        <span class="hljs-keyword">break</span>;</li><li>      <span class="hljs-attr">default</span>:</li><li>        <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>)</li><li>        <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    <span class="hljs-comment">// 正例：使用if</span></li><li>    <span class="hljs-keyword">if</span>(expression == <span class="hljs-number">1</span>) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>)</li><li>    } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(expression == <span class="hljs-number">2</span>) {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-string">'...'</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许使用表达式，请使用if组件，示例如下。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-title class_">Column</span>() {</li><li>    <span class="hljs-comment">// 反例：不允许使用表达式</span></li><li>    (<span class="hljs-variable language_">this</span>.<span class="hljs-property">aVar</span> &gt; <span class="hljs-number">10</span>) ? <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>) : <span class="hljs-title class_">Image</span>(<span class="hljs-string">'...'</span>)</li><li>
</li><li>    <span class="hljs-comment">// 正例：使用if判断</span></li><li>    <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">aVar</span> &gt; <span class="hljs-number">10</span>) {</li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">'...'</span>)</li><li>    } <span class="hljs-keyword">else</span> {</li><li>      <span class="hljs-title class_">Image</span>(<span class="hljs-string">'...'</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div></li>      <li>       <p>不允许直接改变状态变量，反例如下。详细分析见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/arkts-state#不允许在build里改状态变量">@State常见问题：不允许在build里改状态变量</a>。</p>       <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">textColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Yellow</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">columnColor</span>: <span class="hljs-title class_">Color</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Green</span>;</li><li>  <span class="hljs-meta">@State</span> <span class="hljs-attr">count</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">1</span>;</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Column</span>() {</li><li>      <span class="hljs-comment">// 应避免直接在Text组件内改变count的值</span></li><li>      <span class="hljs-title class_">Text</span>(<span class="hljs-string">`<span class="hljs-subst">${<span class="hljs-variable language_">this</span>.count++}</span>`</span>)</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">50</span>)</li><li>        .<span class="hljs-title function_">fontColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span>)</li><li>        .<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span> {</li><li>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">columnColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>;</li><li>        })</li><li>      <span class="hljs-title class_">Button</span>(<span class="hljs-string">"change textColor"</span>).<span class="hljs-title function_">onClick</span>(<span class="hljs-function">() =&gt;</span>{</li><li>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">textColor</span> = <span class="hljs-title class_">Color</span>.<span class="hljs-property">Pink</span>;</li><li>      })</li><li>    }</li><li>    .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">columnColor</span>)</li><li>  }</li><li>}</li></ol></pre></div></div>       <p>在ArkUI状态管理中，状态驱动UI更新。</p>       <p><span><img originheight="89" originwidth="265" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251211114858.59726086933064788996965396053156:50001231000000:2800:906F59A32363B07333E19F9FBBD30285DA3F8DCC28E3D7A3B4AE86962C2082AD.png" class="notEnlarge" width="265" height="89"></span></p>       <p>所以，不能在自定义组件的build()或@Builder方法里直接改变状态变量，这可能会造成循环渲染的风险。Text('${this.count++}')在全量更新或最小化更新会产生不同的影响：</p>       <ul>        <li>全量更新（API8及以前版本）： ArkUI可能会陷入一个无限的重渲染的循环里，因为Text组件的每一次渲染都会改变应用的状态，就会再引起下一轮渲染的开启。 当 this.columnColor 更改时，都会执行整个build构建函数，因此，Text(${this.count++})绑定的文本也会更改，每次重新渲染Text(${this.count++})，又会使this.count状态变量更新，导致新一轮的build执行，从而陷入无限循环。</li>        <li>最小化更新（API9及以上版本）：当this.columnColor更新时，仅Column组件更新，Text组件不会更新。只有当this.textColor更改时，会去更新整个Text组件，其所有属性函数都会执行，所以会看到Text(${this.count++})自增。因为目前UI以组件为单位进行更新，如果组件上某一个属性发生改变，会更新整个的组件。所以整体的更新链路是：this.textColor = Color.Pink -&gt;Text组件整个更新-&gt;this.count++ -&gt;Text组件整个更新。值得注意的是，这种写法在初次渲染时会导致Text组件渲染两次，影响性能。</li>       </ul>       <p>build函数中更改应用状态的行为可能比上面的示例更加隐蔽，例如：</p>       <ul>        <li>         <p>在@Builder，@Extend或@Styles方法内改变状态变量 。</p></li>        <li>         <p>在计算参数时调用函数中改变应用状态变量，例如 Text('${this.calcLabel()}')。</p></li>        <li>         <p>对当前数组做出修改，sort()改变了数组this.arr，随后的filter方法会返回一个新的数组。</p>         <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-comment">// 反例</span></li><li><span class="hljs-meta">@State</span> arr : <span class="hljs-title class_">Array</span>&lt;...&gt; = [ ... ];</li><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">sort</span>().<span class="hljs-title function_">filter</span>(...),</li><li>  <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>})</li><li><span class="hljs-comment">// 正确的执行方式为：filter返回一个新数组，后面的sort方法才不会改变原数组this.arr</span></li><li><span class="hljs-title class_">ForEach</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">arr</span>.<span class="hljs-title function_">filter</span>(...).<span class="hljs-title function_">sort</span>(),</li><li>  <span class="hljs-function"><span class="hljs-params">item</span> =&gt;</span> {</li><li>  <span class="hljs-comment">// ...</span></li><li>})</li></ol></pre></div></div></li>       </ul></li>     </ul>    </div>    <div class="tiledSection">     <h2 id="自定义组件通用样式">自定义组件通用样式<i class="anchor-icon anchor-icon-link" anchorid="自定义组件通用样式" tips="复制节点链接"></i></h2>          <p>自定义组件通过“.”链式调用设置通用样式。</p>     <div _ngcontent-xcv-c106="" class="highlight-div"><div _ngcontent-xcv-c106="" class="highlight-div-header"><div _ngcontent-xcv-c106="" class="highlight-div-header-left"><div _ngcontent-xcv-c106="" class="handle-button expand-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-xcv-c106="" class="highlight-div-header-right"><div _ngcontent-xcv-c106="" class="handle-button ai-button"></div><div _ngcontent-xcv-c106="" class="handle-button line-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-xcv-c106="" class="handle-button theme-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-xcv-c106="" class="handle-button copy-button"><div _ngcontent-xcv-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-xcv-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">ChildComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Button</span>(<span class="hljs-string">`Hello World`</span>)</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-meta">@Entry</span></li><li><span class="hljs-meta">@Component</span></li><li>struct <span class="hljs-title class_">MyComponent</span> {</li><li>  <span class="hljs-title function_">build</span>(<span class="hljs-params"></span>) {</li><li>    <span class="hljs-title class_">Row</span>() {</li><li>      <span class="hljs-title class_">ChildComponent</span>()</li><li>        .<span class="hljs-title function_">width</span>(<span class="hljs-number">200</span>)</li><li>        .<span class="hljs-title function_">height</span>(<span class="hljs-number">300</span>)</li><li>        .<span class="hljs-title function_">backgroundColor</span>(<span class="hljs-title class_">Color</span>.<span class="hljs-property">Red</span>)</li><li>    }</li><li>  }</li><li>}</li></ol></pre></div></div>     <div><div class="hw-editor-tip info"><div class="title">说明</div><div class="content">       <p>ArkUI给自定义组件设置样式时，相当于给ChildComponent套了一个不可见的容器组件，这些样式是设置在容器组件上，而非直接设置给ChildComponent的Button组件。渲染结果显示，背景颜色红色并没有直接设置到Button上，而是设置在Button所在的不可见容器组件上。</p>      </div></div></div>    </div>   </div>   <div></div></div>