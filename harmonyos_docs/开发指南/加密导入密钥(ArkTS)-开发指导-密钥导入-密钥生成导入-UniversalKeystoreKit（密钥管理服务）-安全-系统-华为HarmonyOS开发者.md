<h1 _ngcontent-fws-c119="" class="doc-title ng-star-inserted" title="加密导入密钥(ArkTS)"> 加密导入密钥(ArkTS) </h1>

<div _ngcontent-fws-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;">   <div>    <p>以加密导入ECDH密钥对为例，涉及业务侧加密密钥的<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-key-generation-overview">密钥生成</a>、<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-key-agreement-overview">协商</a>等操作不在本示例中体现。</p>    <p>具体的场景介绍及支持的算法规格，请参考<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-key-import-overview#支持的算法">密钥导入支持的算法</a>。</p>    <div class="tiledSection">     <h2 id="开发步骤">开发步骤<i class="anchor-icon anchor-icon-link" anchorid="开发步骤" tips="复制节点链接"></i></h2>          <ol>      <li>       <p>设备A（导入设备）将待导入密钥转换成<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-concepts#密钥材料格式">HUKS密钥材料格式</a>To_Import_Key（仅针对非对称密钥，若待导入密钥是对称密钥则可省略此步骤）。</p></li>      <li>       <p>设备B（被导入设备）生成一个加密导入用途的、用于协商的非对称密钥对Wrapping_Key（公钥Wrapping_Pk，私钥Wrapping_Sk），其密钥用途设置为unwrap，导出Wrapping_Key的公钥材料Wrapping_Pk并保存。</p></li>      <li>       <p>设备A使用和设备B同样的算法，生成一个加密导入用途的、用于协商的非对称密钥对Caller_Key（公钥Caller_Pk，私钥Caller_Sk），导出Caller_Key的公钥材料Caller_Pk并保存。</p></li>      <li>       <p>设备A生成一个对称密钥Caller_Kek，该密钥后续将用于加密To_Import_Key。</p></li>      <li>       <p>设备A基于Caller_Key的私钥Caller_Sk和设备B Wrapping_Key的公钥Wrapping_Pk，协商出Shared_Key。</p></li>      <li>       <p>设备A使用Caller_Kek加密To_Import_Key，生成To_Import_Key_Enc。</p></li>      <li>       <p>设备A使用Shared_Key加密Caller_Kek，生成Caller_Kek_Enc。</p></li>      <li>       <p>设备A封装Caller_Pk、Caller_Kek_Enc、To_Import_Key_Enc等加密导入的密钥材料并发送给设备B，加密导入密钥材料格式见<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-guides/huks-key-import-overview#加密导入密钥材料格式">加密导入密钥材料格式</a>。</p></li>      <li>       <p>设备B导入封装的加密密钥材料。</p></li>      <li>       <p>设备A、B删除用于加密导入的密钥。</p></li>     </ol>     <div _ngcontent-fws-c106="" class="highlight-div"><div _ngcontent-fws-c106="" class="highlight-div-header"><div _ngcontent-fws-c106="" class="highlight-div-header-left"><div _ngcontent-fws-c106="" class="handle-button expand-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fws-c106="" class="highlight-div-header-right"><div _ngcontent-fws-c106="" class="handle-button ai-button"></div><div _ngcontent-fws-c106="" class="handle-button line-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fws-c106="" class="handle-button theme-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fws-c106="" class="handle-button copy-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fws-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { huks } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UniversalKeystoreKit'</span>;</li><li><span class="hljs-keyword">import</span> { cryptoFramework } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.CryptoArchitectureKit'</span></li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">IV</span> = cryptoFramework.<span class="hljs-title function_">createRandom</span>().<span class="hljs-title function_">generateRandomSync</span>(<span class="hljs-number">16</span>).<span class="hljs-property">data</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">AAD</span> = <span class="hljs-string">"abababababababab"</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">NONCE</span> = cryptoFramework.<span class="hljs-title function_">createRandom</span>().<span class="hljs-title function_">generateRandomSync</span>(<span class="hljs-number">12</span>).<span class="hljs-property">data</span></li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">TAG_SIZE</span> = <span class="hljs-number">16</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-variable constant_">FILED_LENGTH</span> = <span class="hljs-number">4</span>;</li><li><span class="hljs-keyword">let</span> importedAes192PlainKey = <span class="hljs-string">"The aes192 key to import"</span>;</li><li><span class="hljs-keyword">let</span> callerAes256Kek = <span class="hljs-string">"It's a kek to encrypt aes192 key"</span>;</li><li><span class="hljs-keyword">let</span> callerKeyAlias = <span class="hljs-string">"test_caller_key_ecdh_aes192"</span>;</li><li><span class="hljs-keyword">let</span> callerKekAliasAes256 = <span class="hljs-string">"test_caller_kek_ecdh_aes256"</span>;</li><li><span class="hljs-keyword">let</span> callerAgreeKeyAliasAes256 = <span class="hljs-string">"test_caller_agree_key_ecdh_aes256"</span>;</li><li><span class="hljs-keyword">let</span> importedKeyAliasAes192 = <span class="hljs-string">"test_import_key_ecdh_aes192"</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">huksPubKey</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">callerSelfPublicKey</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">outSharedKey</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">outPlainKeyEncData</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">outKekEncData</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">outKekEncTag</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">outAgreeKeyEncTag</span>: <span class="hljs-title class_">Uint8Array</span>;</li><li><span class="hljs-keyword">let</span> mask = [<span class="hljs-number">0x000000FF</span>, <span class="hljs-number">0x0000FF00</span>, <span class="hljs-number">0x00FF0000</span>, <span class="hljs-number">0xFF000000</span>];</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">subUint8ArrayOf</span>(<span class="hljs-params">arrayBuf: <span class="hljs-built_in">Uint8Array</span>, start: <span class="hljs-built_in">number</span>, end: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = start; i &lt; end &amp;&amp; i &lt; arrayBuf.<span class="hljs-property">length</span>; ++i) {</li><li>    arr.<span class="hljs-title function_">push</span>(arrayBuf[i]);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-params">str: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">arr</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>, j = str.<span class="hljs-property">length</span>; i &lt; j; ++i) {</li><li>    arr.<span class="hljs-title function_">push</span>(str.<span class="hljs-title function_">charCodeAt</span>(i));</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(arr);</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">Uint8ArrayToString</span>(<span class="hljs-params">fileData: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> dataString = <span class="hljs-string">''</span>;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; fileData.<span class="hljs-property">length</span>; i++) {</li><li>    dataString += <span class="hljs-title class_">String</span>.<span class="hljs-title function_">fromCharCode</span>(fileData[i]);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> dataString;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">assignLength</span>(<span class="hljs-params">length: <span class="hljs-built_in">number</span>, arrayBuf: <span class="hljs-built_in">Uint8Array</span>, startIndex: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">let</span> index = startIndex;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; <span class="hljs-number">4</span>; i++) {</li><li>    arrayBuf[index++] = (length &amp; mask[i]) &gt;&gt; (i * <span class="hljs-number">8</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">function</span> <span class="hljs-title function_">assignData</span>(<span class="hljs-params">data: <span class="hljs-built_in">Uint8Array</span>, arrayBuf: <span class="hljs-built_in">Uint8Array</span>, startIndex: <span class="hljs-built_in">number</span></span>) {</li><li>  <span class="hljs-keyword">let</span> index = startIndex;</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; data.<span class="hljs-property">length</span>; i++) {</li><li>    arrayBuf[index++] = data[i];</li><li>  }</li><li>  <span class="hljs-keyword">return</span> data.<span class="hljs-property">length</span>;</li><li>}</li><li>
</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">genWrappingKeyParams</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_ECC</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_UNWRAP</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_ECC_KEY_SIZE_256</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PADDING</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPadding</span>.<span class="hljs-property">HUKS_PADDING_NONE</span></li><li>    }</li><li>  )</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">genCallerEcdhParams</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_ECC</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_AGREE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_ECC_KEY_SIZE_256</span></li><li>    }</li><li>  )</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">importParamsCallerKek</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_AES</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_AES_KEY_SIZE_256</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PADDING</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPadding</span>.<span class="hljs-property">HUKS_PADDING_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_BLOCK_MODE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksCipherMode</span>.<span class="hljs-property">HUKS_MODE_GCM</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_DIGEST</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyDigest</span>.<span class="hljs-property">HUKS_DIGEST_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_IV</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-variable constant_">IV</span></li><li>    }</li><li>  ),</li><li>  <span class="hljs-attr">inData</span>: <span class="hljs-title function_">stringToUint8Array</span>(callerAes256Kek)</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">importParamsAgreeKey</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_AES</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_AES_KEY_SIZE_256</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PADDING</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPadding</span>.<span class="hljs-property">HUKS_PADDING_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_BLOCK_MODE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksCipherMode</span>.<span class="hljs-property">HUKS_MODE_GCM</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_DIGEST</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyDigest</span>.<span class="hljs-property">HUKS_DIGEST_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_IV</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-variable constant_">IV</span></li><li>    }</li><li>  ),</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">callerAgreeParams</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_ECDH</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_AGREE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_CURVE25519_KEY_SIZE_256</span></li><li>    }</li><li>  )</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">encryptKeyCommonParams</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_AES</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_ENCRYPT</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_AES_KEY_SIZE_256</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PADDING</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPadding</span>.<span class="hljs-property">HUKS_PADDING_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_BLOCK_MODE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksCipherMode</span>.<span class="hljs-property">HUKS_MODE_GCM</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_NONCE</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-variable constant_">NONCE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ASSOCIATED_DATA</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-variable constant_">AAD</span>)</li><li>    }</li><li>  ),</li><li>}</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">importWrappedAes192Params</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt;({</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_AES</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PURPOSE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_ENCRYPT</span> |</li><li>      huks.<span class="hljs-property">HuksKeyPurpose</span>.<span class="hljs-property">HUKS_KEY_PURPOSE_DECRYPT</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_KEY_SIZE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeySize</span>.<span class="hljs-property">HUKS_AES_KEY_SIZE_192</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_PADDING</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyPadding</span>.<span class="hljs-property">HUKS_PADDING_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_BLOCK_MODE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksCipherMode</span>.<span class="hljs-property">HUKS_MODE_CBC</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_DIGEST</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyDigest</span>.<span class="hljs-property">HUKS_DIGEST_NONE</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_UNWRAP_ALGORITHM_SUITE</span>,</li><li>      <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksUnwrapSuite</span>.<span class="hljs-property">HUKS_UNWRAP_SUITE_ECDH_AES_256_GCM_NOPADDING</span></li><li>    }, {</li><li>      <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_IV</span>,</li><li>      <span class="hljs-attr">value</span>: <span class="hljs-variable constant_">IV</span></li><li>    }</li><li>  )</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicGenerateItemFunc</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise generateKeyItem`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">generateKeyItem</span>(keyAlias, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: generateKeyItem success`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: generateKeyItem failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: generateKeyItem invalid`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicImportKeyItemFunc</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise importKeyItem`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.importKeyItem(keyAlias, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: importKeyItem success`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: importKeyItem failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: importKeyItem input arg invalid`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicDeleteKeyItemFunc</span>(<span class="hljs-params">KeyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise deleteKeyItem`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">deleteKeyItem</span>(<span class="hljs-title class_">KeyAlias</span>, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: deleteKeyItem key success`</span>);</li><li>      })</li><li>      .<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: deleteKeyItem failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: deleteKeyItem input arg invalid`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">importWrappedKeyItem</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, wrappingKeyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise importWrappedKeyItem`</span>);</li><li>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; huksOptions.<span class="hljs-property">inData</span>!.<span class="hljs-property">length</span>; i++) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`<span class="hljs-subst">${i}</span>: <span class="hljs-subst">${huksOptions.inData![i]}</span>`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.importWrappedKeyItem(keyAlias, wrappingKeyAlias, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">() =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: importWrappedKeyItem success`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: importWrappedKeyItem failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: importWrappedKeyItem input arg invalid`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicImportWrappedKeyFunc</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, wrappingKeyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-keyword">await</span> importWrappedKeyItem(keyAlias, wrappingKeyAlias, huksOptions);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicInitFunc</span>(<span class="hljs-params">srcKeyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">handle</span>: <span class="hljs-built_in">number</span> = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doInit`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">initSession</span>(srcKeyAlias, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: doInit success`</span>);</li><li>        handle = data.<span class="hljs-property">handle</span>;</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doInit key failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doInit input arg invalid`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> handle;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicUpdateSessionFunction</span>(<span class="hljs-params">handle: <span class="hljs-built_in">number</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-keyword">const</span> maxUpdateSize = <span class="hljs-number">64</span>;</li><li>  <span class="hljs-keyword">const</span> inData = huksOptions.<span class="hljs-property">inData</span>!;</li><li>  <span class="hljs-keyword">const</span> lastInDataPosition = inData.<span class="hljs-property">length</span> - <span class="hljs-number">1</span>;</li><li>  <span class="hljs-keyword">let</span> inDataSegSize = maxUpdateSize;</li><li>  <span class="hljs-keyword">let</span> inDataSegPosition = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> isFinished = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">outData</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>
</li><li>  <span class="hljs-keyword">while</span> (inDataSegPosition &lt;= lastInDataPosition) {</li><li>    <span class="hljs-keyword">if</span> (inDataSegPosition + maxUpdateSize &gt; lastInDataPosition) {</li><li>      isFinished = <span class="hljs-literal">true</span>;</li><li>      inDataSegSize = lastInDataPosition - inDataSegPosition + <span class="hljs-number">1</span>;</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doUpdate`</span>);</li><li>      <span class="hljs-keyword">break</span>;</li><li>    }</li><li>    huksOptions.<span class="hljs-property">inData</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(</li><li>      <span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(inData).<span class="hljs-title function_">slice</span>(inDataSegPosition, inDataSegPosition + inDataSegSize)</li><li>    );</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doUpdate`</span>);</li><li>    <span class="hljs-keyword">try</span> {</li><li>      <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">updateSession</span>(handle, huksOptions)</li><li>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>          outData = outData.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(data.<span class="hljs-property">outData</span>!));</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: doUpdate success, data = <span class="hljs-subst">${outData}</span>`</span>);</li><li>        }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doUpdate failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>        });</li><li>    } <span class="hljs-keyword">catch</span> (error) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doUpdate input arg invalid`</span>);</li><li>    }</li><li>    <span class="hljs-keyword">if</span> ((!isFinished) &amp;&amp; (inDataSegPosition + maxUpdateSize &gt; lastInDataPosition)) {</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`update size invalid isFinished = <span class="hljs-subst">${isFinished}</span>`</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`inDataSegPosition = <span class="hljs-subst">${inDataSegPosition}</span>`</span>);</li><li>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`lastInDataPosition = <span class="hljs-subst">${lastInDataPosition}</span>`</span>);</li><li>      <span class="hljs-keyword">return</span>;</li><li>    }</li><li>    inDataSegPosition += maxUpdateSize;</li><li>  }</li><li>  <span class="hljs-keyword">return</span> outData;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">publicFinishSession</span>(<span class="hljs-params">handle: <span class="hljs-built_in">number</span>, huksOptions: huks.HuksOptions, inData: <span class="hljs-built_in">number</span>[]</span>) {</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">outData</span>: <span class="hljs-built_in">number</span>[] = [];</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doFinish`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">finishSession</span>(handle, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        outData = inData.<span class="hljs-title function_">concat</span>(<span class="hljs-title class_">Array</span>.<span class="hljs-title function_">from</span>(data.<span class="hljs-property">outData</span>!));</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: doFinish success, data = <span class="hljs-subst">${outData}</span>`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doFinish key failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doFinish input arg invalid`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(outData);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">cipherFunction</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions</span>) {</li><li>  <span class="hljs-keyword">let</span> handle = <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicInitFunc</span>(keyAlias, huksOptions);</li><li>  <span class="hljs-keyword">let</span> tmpData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicUpdateSessionFunction</span>(handle, huksOptions);</li><li>  <span class="hljs-keyword">let</span> outData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicFinishSession</span>(handle, huksOptions, tmpData!);</li><li>  <span class="hljs-keyword">return</span> outData;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">agreeFunction</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions, huksPublicKey: <span class="hljs-built_in">Uint8Array</span></span>) {</li><li>  <span class="hljs-keyword">let</span> handle = <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicInitFunc</span>(keyAlias, huksOptions);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">outSharedKey</span>: <span class="hljs-title class_">Uint8Array</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>();</li><li>  huksOptions.<span class="hljs-property">inData</span> = huksPublicKey;</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doUpdate`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">updateSession</span>(handle, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: doUpdate success, data = <span class="hljs-subst">${Uint8ArrayToString(outSharedKey)}</span>`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doUpdate failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doUpdate input arg invalid`</span>);</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`enter promise doFinish`</span>);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">finishSession</span>(handle, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        outSharedKey = data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>;</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: doFinish success, data = <span class="hljs-subst">${Uint8ArrayToString(outSharedKey)}</span>`</span>);</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doFinish key failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: doFinish input arg invalid`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> outSharedKey;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportKekAndAgreeSharedSecret</span>(<span class="hljs-params">callerKekAlias: <span class="hljs-built_in">string</span>, importKekParams: huks.HuksOptions,</span></li><li><span class="hljs-params">  callerKeyAlias: <span class="hljs-built_in">string</span>, huksPublicKey: <span class="hljs-built_in">Uint8Array</span>, agreeParams: huks.HuksOptions</span>) {</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicImportKeyItemFunc</span>(callerKekAlias, importKekParams);</li><li>  outSharedKey = <span class="hljs-keyword">await</span> <span class="hljs-title function_">agreeFunction</span>(callerKeyAlias, agreeParams, huksPublicKey);</li><li>  importParamsAgreeKey.<span class="hljs-property">inData</span> = outSharedKey;</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicImportKeyItemFunc</span>(callerAgreeKeyAliasAes256, importParamsAgreeKey);</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">generateAndExportPublicKey</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, huksOptions: huks.HuksOptions, caller: <span class="hljs-built_in">Boolean</span></span>) {</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicGenerateItemFunc</span>(keyAlias, huksOptions);</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">exportKeyItem</span>(keyAlias, huksOptions)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-keyword">if</span> (caller) {</li><li>          callerSelfPublicKey = data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: exportKeyItem success, caller data = <span class="hljs-subst">${Uint8ArrayToString(callerSelfPublicKey)}</span>`</span>);</li><li>        } <span class="hljs-keyword">else</span> {</li><li>          huksPubKey = data.<span class="hljs-property">outData</span> <span class="hljs-keyword">as</span> <span class="hljs-title class_">Uint8Array</span>;</li><li>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: exportKeyItem success, data = <span class="hljs-subst">${Uint8ArrayToString(huksPubKey)}</span>`</span>);</li><li>        }</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: exportKeyItem failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      });</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: generate pubKey failed`</span>);</li><li>  }</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">EncryptImportedPlainKeyAndKek</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span></span>) {</li><li>  encryptKeyCommonParams.<span class="hljs-property">inData</span> = <span class="hljs-title function_">stringToUint8Array</span>(keyAlias)</li><li>  <span class="hljs-keyword">let</span> plainKeyEncData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">cipherFunction</span>(callerKekAliasAes256, encryptKeyCommonParams);</li><li>  outKekEncTag = <span class="hljs-title function_">subUint8ArrayOf</span>(plainKeyEncData, plainKeyEncData.<span class="hljs-property">length</span> - <span class="hljs-variable constant_">TAG_SIZE</span>, plainKeyEncData.<span class="hljs-property">length</span>)</li><li>  outPlainKeyEncData = <span class="hljs-title function_">subUint8ArrayOf</span>(plainKeyEncData, <span class="hljs-number">0</span>, plainKeyEncData.<span class="hljs-property">length</span> - <span class="hljs-variable constant_">TAG_SIZE</span>)</li><li>  encryptKeyCommonParams.<span class="hljs-property">inData</span> = <span class="hljs-title function_">stringToUint8Array</span>(callerAes256Kek)</li><li>  <span class="hljs-keyword">let</span> kekEncData = <span class="hljs-keyword">await</span> <span class="hljs-title function_">cipherFunction</span>(callerAgreeKeyAliasAes256, encryptKeyCommonParams)</li><li>  outAgreeKeyEncTag = <span class="hljs-title function_">subUint8ArrayOf</span>(kekEncData, kekEncData.<span class="hljs-property">length</span> - <span class="hljs-variable constant_">TAG_SIZE</span>, kekEncData.<span class="hljs-property">length</span>)</li><li>  outKekEncData = <span class="hljs-title function_">subUint8ArrayOf</span>(kekEncData, <span class="hljs-number">0</span>, kekEncData.<span class="hljs-property">length</span> - <span class="hljs-variable constant_">TAG_SIZE</span>)</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">BuildWrappedDataAndImportWrappedKey</span>(<span class="hljs-params">plainKey: <span class="hljs-built_in">string</span></span>) {</li><li>  <span class="hljs-keyword">let</span> plainKeySizeBuff = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-number">4</span>);</li><li>  <span class="hljs-title function_">assignLength</span>(plainKey.<span class="hljs-property">length</span>, plainKeySizeBuff, <span class="hljs-number">0</span>);</li><li>  <span class="hljs-keyword">let</span> wrappedData = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + huksPubKey.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">AAD</span>.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">NONCE</span>.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">TAG_SIZE</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + outKekEncData.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">AAD</span>.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">NONCE</span>.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + <span class="hljs-variable constant_">TAG_SIZE</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + plainKeySizeBuff.<span class="hljs-property">length</span> +</li><li>    <span class="hljs-variable constant_">FILED_LENGTH</span> + outPlainKeyEncData.<span class="hljs-property">length</span></li><li>  );</li><li>  <span class="hljs-keyword">let</span> index = <span class="hljs-number">0</span>;</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">AADUint8Array</span> = <span class="hljs-title function_">stringToUint8Array</span>(<span class="hljs-variable constant_">AAD</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-title class_">NonceArray</span> = <span class="hljs-variable constant_">NONCE</span>;</li><li>  index += <span class="hljs-title function_">assignLength</span>(callerSelfPublicKey.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(callerSelfPublicKey, wrappedData, index); <span class="hljs-comment">// 91</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(<span class="hljs-title class_">AADUint8Array</span>.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(<span class="hljs-title class_">AADUint8Array</span>, wrappedData, index); <span class="hljs-comment">// 16</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(<span class="hljs-title class_">NonceArray</span>.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(<span class="hljs-title class_">NonceArray</span>, wrappedData, index); <span class="hljs-comment">// 12</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(outAgreeKeyEncTag.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(outAgreeKeyEncTag, wrappedData, index); <span class="hljs-comment">// 16</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(outKekEncData.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(outKekEncData, wrappedData, index); <span class="hljs-comment">// 32</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(<span class="hljs-title class_">AADUint8Array</span>.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(<span class="hljs-title class_">AADUint8Array</span>, wrappedData, index); <span class="hljs-comment">// 16</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(<span class="hljs-title class_">NonceArray</span>.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(<span class="hljs-title class_">NonceArray</span>, wrappedData, index); <span class="hljs-comment">// 12</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(outKekEncTag.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(outKekEncTag, wrappedData, index); <span class="hljs-comment">// 16</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(plainKeySizeBuff.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(plainKeySizeBuff, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignLength</span>(outPlainKeyEncData.<span class="hljs-property">length</span>, wrappedData, index); <span class="hljs-comment">// 4</span></li><li>  index += <span class="hljs-title function_">assignData</span>(outPlainKeyEncData, wrappedData, index); <span class="hljs-comment">// 24</span></li><li>  <span class="hljs-keyword">return</span> wrappedData;</li><li>}</li><li>
</li><li><span class="hljs-comment">/* 模拟加密导入密钥场景，设备A为远端设备（导入设备），设备B为本端设备（被导入设备） */</span></li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">ImportWrappedKey</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 1.设备A将待导入密钥转换成HUKS密钥材料格式To_Import_Key（仅针对非对称密钥，若待导入密钥是对称密钥则可省略此步骤）。</span></li><li><span class="hljs-comment">   *   本示例使用importedAes192PlainKey（对称密钥）作为模拟。</span></li><li><span class="hljs-comment">   */</span></li><li>
</li><li>  <span class="hljs-comment">/* 2.设备B生成一个加密导入用途的、用于协商的非对称密钥对Wrapping_Key（公钥Wrapping_Pk，私钥Wrapping_Sk），其密钥用途设置为unwrap，导出Wrapping_Key公钥Wrapping_Pk存放在变量huksPubKey中 */</span></li><li>  <span class="hljs-keyword">const</span> srcKeyAliasWrap = <span class="hljs-string">'HUKS_Basic_Capability_Import_0200'</span>;</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateAndExportPublicKey</span>(srcKeyAliasWrap, genWrappingKeyParams, <span class="hljs-literal">false</span>);</li><li>
</li><li>  <span class="hljs-comment">/* 3.设备A使用和设备B同样的算法，生成一个加密导入用途的、用于协商的非对称密钥对Caller_Key（公钥Caller_Pk，私钥Caller_Sk），导出Caller_Key公钥Caller_Pk存放在变量callerSelfPublicKey中 */</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">generateAndExportPublicKey</span>(callerKeyAlias, genCallerEcdhParams, <span class="hljs-literal">true</span>);</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 4.设备A生成一个对称密钥Caller_Kek，该密钥后续将用于加密To_Import_Key</span></li><li><span class="hljs-comment">   * 5.设备A基于Caller_Key的私钥Caller_Sk和Wrapping_Key的公钥Wrapping_Pk，协商出Shared_Key</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title class_">ImportKekAndAgreeSharedSecret</span>(callerKekAliasAes256, importParamsCallerKek, callerKeyAlias, huksPubKey,</li><li>    callerAgreeParams);</li><li>
</li><li>  <span class="hljs-comment">/**</span></li><li><span class="hljs-comment">   * 6.设备A使用Caller_Kek加密To_Import_Key，生成To_Import_Key_Enc</span></li><li><span class="hljs-comment">   * 7.设备A使用Shared_Key加密Caller_Kek，生成Caller_Kek_Enc</span></li><li><span class="hljs-comment">   */</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title class_">EncryptImportedPlainKeyAndKek</span>(importedAes192PlainKey);</li><li>
</li><li>  <span class="hljs-comment">/* 8.设备A封装Caller_Pk、To_Import_Key_Enc、Caller_Kek_Enc等加密导入的材料并发送给设备B。本示例作为变量存放在callerSelfPublicKey，PlainKeyEncData，KekEncData */</span></li><li>  <span class="hljs-keyword">let</span> wrappedData = <span class="hljs-keyword">await</span> <span class="hljs-title class_">BuildWrappedDataAndImportWrappedKey</span>(importedAes192PlainKey);</li><li>  importWrappedAes192Params.<span class="hljs-property">inData</span> = wrappedData;</li><li>
</li><li>  <span class="hljs-comment">/* 9.设备B导入封装的加密密钥材料 */</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicImportWrappedKeyFunc</span>(importedKeyAliasAes192, srcKeyAliasWrap, importWrappedAes192Params);</li><li>
</li><li>  <span class="hljs-comment">/* 10.设备A、B删除用于加密导入的密钥 */</span></li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicDeleteKeyItemFunc</span>(srcKeyAliasWrap, genWrappingKeyParams);</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicDeleteKeyItemFunc</span>(callerKeyAlias, genCallerEcdhParams);</li><li>  <span class="hljs-keyword">await</span> <span class="hljs-title function_">publicDeleteKeyItemFunc</span>(callerKekAliasAes256, callerAgreeParams);</li><li>}</li></ol></pre></div></div>    </div>    <div class="tiledSection">     <h2 id="调测验证">调测验证<i class="anchor-icon anchor-icon-link" anchorid="调测验证" tips="复制节点链接"></i></h2>          <p>调用<a href="https://developer.huawei.com/consumer/cn/doc/harmonyos-references/js-apis-huks#huksiskeyitemexist9" target="_blank">huks.isKeyItemExist</a>验证密钥是否存在，如密钥存在即表示密钥导入成功。</p>     <div _ngcontent-fws-c106="" class="highlight-div"><div _ngcontent-fws-c106="" class="highlight-div-header"><div _ngcontent-fws-c106="" class="highlight-div-header-left"><div _ngcontent-fws-c106="" class="handle-button expand-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">收起</div></div></div><div _ngcontent-fws-c106="" class="highlight-div-header-right"><div _ngcontent-fws-c106="" class="handle-button ai-button"></div><div _ngcontent-fws-c106="" class="handle-button line-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">自动换行</div></div><div _ngcontent-fws-c106="" class="handle-button theme-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">深色代码主题</div></div><div _ngcontent-fws-c106="" class="handle-button copy-button"><div _ngcontent-fws-c106="" class="handle-hover-tips">复制</div></div></div></div><div _ngcontent-fws-c106="" class="highlight-scroll-div"><pre class="ts prettyprint linenums hljs language-typescript" hw-language="ts" data-highlighted="yes"><ol class="linenums"><li><span class="hljs-keyword">import</span> { huks } <span class="hljs-keyword">from</span> <span class="hljs-string">'@kit.UniversalKeystoreKit'</span>;</li><li><span class="hljs-keyword">import</span> { <span class="hljs-title class_">BusinessError</span> } <span class="hljs-keyword">from</span> <span class="hljs-string">"@kit.BasicServicesKit"</span>;</li><li>
</li><li><span class="hljs-comment">/*</span></li><li><span class="hljs-comment"> * 确定密钥别名和封装密钥属性参数集</span></li><li><span class="hljs-comment"> */</span></li><li><span class="hljs-keyword">let</span> keyAlias = <span class="hljs-string">'test_import_key_ecdh_aes192'</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">isKeyExist</span>: <span class="hljs-title class_">Boolean</span>;</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">keyProperties</span>: <span class="hljs-title class_">Array</span>&lt;huks.<span class="hljs-property">HuksParam</span>&gt; = [{</li><li>  <span class="hljs-attr">tag</span>: huks.<span class="hljs-property">HuksTag</span>.<span class="hljs-property">HUKS_TAG_ALGORITHM</span>,</li><li>  <span class="hljs-attr">value</span>: huks.<span class="hljs-property">HuksKeyAlg</span>.<span class="hljs-property">HUKS_ALG_AES</span>,</li><li>}];</li><li><span class="hljs-keyword">let</span> <span class="hljs-attr">huksOptions</span>: huks.<span class="hljs-property">HuksOptions</span> = {</li><li>  <span class="hljs-attr">properties</span>: keyProperties, <span class="hljs-comment">// 非空填充。</span></li><li>  <span class="hljs-attr">inData</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Uint8Array</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Array</span>()) <span class="hljs-comment">// 非空填充。</span></li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">isKeyItemExist</span>(<span class="hljs-params">keyAlias: <span class="hljs-built_in">string</span>, options: huks.HuksOptions</span>): <span class="hljs-title class_">Promise</span>&lt;<span class="hljs-built_in">boolean</span>&gt; {</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: enter isKeyItemExist`</span>);</li><li>  <span class="hljs-keyword">let</span> <span class="hljs-attr">ret</span>: <span class="hljs-built_in">boolean</span> = <span class="hljs-literal">false</span>;</li><li>  <span class="hljs-keyword">try</span> {</li><li>    <span class="hljs-keyword">await</span> huks.<span class="hljs-title function_">isKeyItemExist</span>(keyAlias, options)</li><li>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">`promise: isKeyItemExist success, data = <span class="hljs-subst">${data}</span>`</span>);</li><li>        ret = <span class="hljs-literal">true</span>;</li><li>      }).<span class="hljs-title function_">catch</span>(<span class="hljs-function">(<span class="hljs-params">error: BusinessError</span>) =&gt;</span> {</li><li>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: isKeyItemExist failed, errCode : <span class="hljs-subst">${error.code}</span>, errMsg : <span class="hljs-subst">${error.message}</span>`</span>);</li><li>      })</li><li>  } <span class="hljs-keyword">catch</span> (error) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">`promise: isKeyItemExist input arg invalid`</span>);</li><li>  }</li><li>  <span class="hljs-keyword">return</span> ret;</li><li>}</li><li>
</li><li><span class="hljs-keyword">async</span> <span class="hljs-keyword">function</span> <span class="hljs-title function_">importWrappedKeyExistTest</span>(<span class="hljs-params"></span>) {</li><li>  <span class="hljs-keyword">let</span> retImp = <span class="hljs-keyword">await</span> <span class="hljs-title function_">isKeyItemExist</span>(keyAlias, huksOptions);</li><li>  <span class="hljs-keyword">if</span> (retImp == <span class="hljs-literal">false</span>) {</li><li>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"importWrappedKeyExistTest failed"</span>);</li><li>    <span class="hljs-keyword">return</span>;</li><li>  }</li><li>  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">"importWrappedKeyExistTest success"</span>);</li><li>}</li></ol></pre></div></div>    </div>   </div>   <div></div></div>