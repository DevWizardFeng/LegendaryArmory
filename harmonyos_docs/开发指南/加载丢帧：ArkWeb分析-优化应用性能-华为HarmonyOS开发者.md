<h1 _ngcontent-nfj-c119="" class="doc-title ng-star-inserted" title="加载丢帧：ArkWeb分析"> 加载丢帧：ArkWeb分析 </h1>

<div _ngcontent-nfj-c106="" auitextselectionexpansion="" class="markdown-body ng-star-inserted" style="position: relative;"> <div id="body0000001972769365"><p id="ZH-CN_TOPIC_0000002510294527__p1028017214547">应用开发过程中，会通过在APP中嵌入WebView以提高开发效率，可能面临ArkWeb加载和丢帧等问题。DevEco Profiler提供ArkWeb分析模板，可以结合ArkWeb执行流程的关键trace点来定位问题发生的阶段。如果问题发生在渲染阶段，可以结合H:RosenWeb数据，线程运行状态以及帧渲染流程打点数据，进一步分析丢帧问题。</p> <p id="ZH-CN_TOPIC_0000002510294527__p2152183203814"></p> <div class="tiledSection"><h2 id="section480731912299">ArkWeb加载问题分析<i class="anchor-icon anchor-icon-link" anchorid="section480731912299" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002510294527__ol1536210497314"><li id="li14443171015213"><span>创建ArkWeb模板，完成一次录制，录制期间触发Web相关场景。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p217418276253"></p> <p></p></li><li id="li186731597383"><span>定界Web问题发生的阶段，分析Web加载问题。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p158131911105819">根据Web页面加载过程中的关键trace点，划分了五个阶段，分别是：点击事件（Click Event）， 组件初始化（Component Initialization），主资源下载（Primary Resource Download），子资源下载（Sub-resource Download），渲染输出（Render And Output）。</p> <p id="ZH-CN_TOPIC_0000002510294527__p1033725014310"><span><img height="332.72144702842377" originheight="556" originwidth="1548" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104925.10887268814193318756328744629617:50001231000000:2800:4ADBA41A32F9CAA22093B5494F7B7C4F838C72C4E942AC64B68478A2B53CFB3B.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li1033714501433"><span id="ZH-CN_TOPIC_0000002510294527__p53371250124316">详情区可以跳转关键trace所在泳道，进一步分析加载问题。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p113371050134317">框选可以查看泳道的耗时阶段划分的关键trace点，并可以根据trace信息，关联到所在线程信息。</p> <p></p></li></ol> </div> <div class="tiledSection"><h2 id="section9400110183017">ArkWeb丢帧问题分析<i class="anchor-icon anchor-icon-link" anchorid="section9400110183017" tips="复制节点链接"></i></h2><ol id="ZH-CN_TOPIC_0000002510294527__ol1720595320516"><li id="li11939132810599"><span>ArkWeb子泳道聚合了Web相关线程的trace信息，通过分析Web渲染过程的关键函数的trace点，可以分析出每一帧的执行流程。聚合的Web线程信息如下：</span><p></p><ul id="ZH-CN_TOPIC_0000002510294527__ul4939162815916"><li id="li14493527145818">H:RosenWeb：用于记录准备提交给Render Service进行统一渲染的数据量。</li><li id="li1893982895911">Compositor：合成线程，负责图层CPU指令合成，承载动态效果。</li><li id="li201673841111">CompositorGpuTh：用于从GPU获取渲染结果和将合成的buffer送至图形子系统执行渲染。</li><li id="li168121439151111">Chrome_InProcGpu：光栅化。</li><li id="li16409164181118">VsyncGenerator：图形侧vsync信号，用于定时生成vsync信号，通知渲染线程或动画线程准备下一帧的渲染。</li><li id="li1242694511111">VSync-webview：用于接收图形侧发送的vsync信号，并根据信号触发WebView页面的渲染或重绘。</li><li id="li12945155411118">VizCompositorTh：绘制信号监听线程，向图形请求Web本身的vsync信号，触发系统Web相关绘制或执行。</li><li id="li125011848191115">Web应用Render线程：以 :render 结尾的线程，主要用于图形渲染任务，包括html、css解析，进行分层布局绘制。</li></ul> <p id="ZH-CN_TOPIC_0000002510294527__p99391628155911"><span><img height="338.1498473549399" originheight="677" originwidth="1871" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104925.53139085561559097967643473620939:50001231000000:2800:8B76F0537C08A7A2A9E96ACF0583DCCE56B0F581AD10F0E4EB5077DFBC5AD8CE.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li13205135375116"><span>一般结合H:RosenWeb泳道和Present Fence泳道来分析是否存在丢帧。H:RosenWeb上标识有待提交给渲染服务的数据量。正常情况下，每个数据量都会提交给硬件进行上屏，即Present Fence泳道上的H:Waiting for Present Fence trace点。如果某个数据量在Present Fence泳道上没有该trace点，那么很可能是存在丢帧问题。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p11944135419517"><span><img height="315.76812339331616" originheight="526" originwidth="1544" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104925.12652182241643612073844046823884:50001231000000:2800:4756F23AD4EDE078370637C05CF435F8AD1E011622511A7624C946D7E00BA9CD.png" title="点击放大" width="920"></span></p> <p></p></li></ol><ol id="ZH-CN_TOPIC_0000002510294527__ol18204953105118" start="3"><li id="li17204653165117"><span id="ZH-CN_TOPIC_0000002510294527__p1120455318513">在 ArkWeb 的子泳道中，Web应用Render线程提供了分析子资源加载各阶段具体耗时的能力。切换到 "Sub Resource" 页签，可查看详细信息。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p098820312198">包括统一资源定位符、缓存类型、是否为本地资源替换、请求资源时间（ns）、队列时间（ns）、停滞时间（ms）、dns解析时间（ms）、连接耗时（ms）、ssl连接时间（ms）、服务器响应耗时（ms）、下载耗时（ms）、传输时间（ms）、请求方法、状态码、编码前资源大小、编码后资源大小以及HTTP版本。</p> <p id="ZH-CN_TOPIC_0000002510294527__p567219943017"><span><img height="347.35376623376624" originheight="583" originwidth="1554" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104925.00840180472974820022680686565156:50001231000000:2800:EC216D250B501C1A11957FBD18CCDB2A875CA247250165E138B74180F5048E6A.png" title="点击放大" width="920"></span></p> <p></p></li><li id="li911604834118"><span>点选某一行，可以查看该URL对应的缓存信息。包括缓存存在时长、最后修改时刻、过期时刻、缓存指令、资源的唯一标识符以及资源是否过期。</span><p></p><p id="ZH-CN_TOPIC_0000002510294527__p669971110540"><span><img height="141.72088888888888" originheight="289" originwidth="1909" src="https://alliance-communityfile-drcn.dbankcdn.com/FileServer/getFile/cmtyPub/011/111/111/0000000000011111111.20251212104925.23269010584159545122515393140362:50001231000000:2800:1295377AAEADFC566D5B72E61B4D6CBB13ED2AA90624AFCF35E75AC60AC339A6.png" title="点击放大" width="920"></span></p> <p></p></li></ol> <p id="ZH-CN_TOPIC_0000002510294527__p1715546144117"></p> </div> </div> <div></div></div>